var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.checkStringArgs=function(w,N,T){if(null==w)throw new TypeError("The 'this' value for String.prototype."+T+" must not be null or undefined");if(N instanceof RegExp)throw new TypeError("First argument to String.prototype."+T+" must not be a regular expression");return w+""};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.SIMPLE_FROUND_POLYFILL=!1;$jscomp.ISOLATE_POLYFILLS=!1;
$jscomp.FORCE_POLYFILL_PROMISE=!1;$jscomp.FORCE_POLYFILL_PROMISE_WHEN_NO_UNHANDLED_REJECTION=!1;$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(w,N,T){if(w==Array.prototype||w==Object.prototype)return w;w[N]=T.value;return w};
$jscomp.getGlobal=function(w){w=["object"==typeof globalThis&&globalThis,w,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof global&&global];for(var N=0;N<w.length;++N){var T=w[N];if(T&&T.Math==Math)return T}throw Error("Cannot find global object");};$jscomp.global=$jscomp.getGlobal(this);$jscomp.IS_SYMBOL_NATIVE="function"===typeof Symbol&&"symbol"===typeof Symbol("x");$jscomp.TRUST_ES6_POLYFILLS=!$jscomp.ISOLATE_POLYFILLS||$jscomp.IS_SYMBOL_NATIVE;$jscomp.polyfills={};
$jscomp.propertyToPolyfillSymbol={};$jscomp.POLYFILL_PREFIX="$jscp$";var $jscomp$lookupPolyfilledValue=function(w,N){var T=$jscomp.propertyToPolyfillSymbol[N];if(null==T)return w[N];T=w[T];return void 0!==T?T:w[N]};$jscomp.polyfill=function(w,N,T,Z){N&&($jscomp.ISOLATE_POLYFILLS?$jscomp.polyfillIsolated(w,N,T,Z):$jscomp.polyfillUnisolated(w,N,T,Z))};
$jscomp.polyfillUnisolated=function(w,N,T,Z){T=$jscomp.global;w=w.split(".");for(Z=0;Z<w.length-1;Z++){var aa=w[Z];if(!(aa in T))return;T=T[aa]}w=w[w.length-1];Z=T[w];N=N(Z);N!=Z&&null!=N&&$jscomp.defineProperty(T,w,{configurable:!0,writable:!0,value:N})};
$jscomp.polyfillIsolated=function(w,N,T,Z){var aa=w.split(".");w=1===aa.length;Z=aa[0];Z=!w&&Z in $jscomp.polyfills?$jscomp.polyfills:$jscomp.global;for(var na=0;na<aa.length-1;na++){var da=aa[na];if(!(da in Z))return;Z=Z[da]}aa=aa[aa.length-1];T=$jscomp.IS_SYMBOL_NATIVE&&"es6"===T?Z[aa]:null;N=N(T);null!=N&&(w?$jscomp.defineProperty($jscomp.polyfills,aa,{configurable:!0,writable:!0,value:N}):N!==T&&($jscomp.propertyToPolyfillSymbol[aa]=$jscomp.IS_SYMBOL_NATIVE?$jscomp.global.Symbol(aa):$jscomp.POLYFILL_PREFIX+
aa,aa=$jscomp.propertyToPolyfillSymbol[aa],$jscomp.defineProperty(Z,aa,{configurable:!0,writable:!0,value:N})))};$jscomp.polyfill("String.prototype.startsWith",function(w){return w?w:function(N,T){var Z=$jscomp.checkStringArgs(this,N,"startsWith");N+="";var aa=Z.length,na=N.length;T=Math.max(0,Math.min(T|0,Z.length));for(var da=0;da<na&&T<aa;)if(Z[T++]!=N[da++])return!1;return da>=na}},"es6","es3");
$jscomp.checkEs6ConformanceViaProxy=function(){try{var w={},N=Object.create(new $jscomp.global.Proxy(w,{get:function(T,Z,aa){return T==w&&"q"==Z&&aa==N}}));return!0===N.q}catch(T){return!1}};$jscomp.USE_PROXY_FOR_ES6_CONFORMANCE_CHECKS=!1;$jscomp.ES6_CONFORMANCE=$jscomp.USE_PROXY_FOR_ES6_CONFORMANCE_CHECKS&&$jscomp.checkEs6ConformanceViaProxy();$jscomp.arrayIteratorImpl=function(w){var N=0;return function(){return N<w.length?{done:!1,value:w[N++]}:{done:!0}}};$jscomp.arrayIterator=function(w){return{next:$jscomp.arrayIteratorImpl(w)}};
$jscomp.initSymbol=function(){};$jscomp.polyfill("Symbol",function(w){if(w)return w;var N=function(aa,na){this.$jscomp$symbol$id_=aa;$jscomp.defineProperty(this,"description",{configurable:!0,writable:!0,value:na})};N.prototype.toString=function(){return this.$jscomp$symbol$id_};var T=0,Z=function(aa){if(this instanceof Z)throw new TypeError("Symbol is not a constructor");return new N("jscomp_symbol_"+(aa||"")+"_"+T++,aa)};return Z},"es6","es3");
$jscomp.polyfill("Symbol.iterator",function(w){if(w)return w;w=Symbol("Symbol.iterator");for(var N="Array Int8Array Uint8Array Uint8ClampedArray Int16Array Uint16Array Int32Array Uint32Array Float32Array Float64Array".split(" "),T=0;T<N.length;T++){var Z=$jscomp.global[N[T]];"function"===typeof Z&&"function"!=typeof Z.prototype[w]&&$jscomp.defineProperty(Z.prototype,w,{configurable:!0,writable:!0,value:function(){return $jscomp.iteratorPrototype($jscomp.arrayIteratorImpl(this))}})}return w},"es6",
"es3");$jscomp.iteratorPrototype=function(w){w={next:w};w[Symbol.iterator]=function(){return this};return w};$jscomp.makeIterator=function(w){var N="undefined"!=typeof Symbol&&Symbol.iterator&&w[Symbol.iterator];return N?N.call(w):$jscomp.arrayIterator(w)};$jscomp.owns=function(w,N){return Object.prototype.hasOwnProperty.call(w,N)};
$jscomp.polyfill("WeakMap",function(w){function N(){if(!w||!Object.seal)return!1;try{var P=Object.seal({}),U=Object.seal({}),ka=new w([[P,2],[U,3]]);if(2!=ka.get(P)||3!=ka.get(U))return!1;ka.delete(P);ka.set(U,4);return!ka.has(P)&&4==ka.get(U)}catch(Va){return!1}}function T(){}function Z(P){var U=typeof P;return"object"===U&&null!==P||"function"===U}function aa(P){if(!$jscomp.owns(P,da)){var U=new T;$jscomp.defineProperty(P,da,{value:U})}}function na(P){if(!$jscomp.ISOLATE_POLYFILLS){var U=Object[P];
U&&(Object[P]=function(ka){if(ka instanceof T)return ka;Object.isExtensible(ka)&&aa(ka);return U(ka)})}}if($jscomp.USE_PROXY_FOR_ES6_CONFORMANCE_CHECKS){if(w&&$jscomp.ES6_CONFORMANCE)return w}else if(N())return w;var da="$jscomp_hidden_"+Math.random();na("freeze");na("preventExtensions");na("seal");var Qa=0,R=function(P){this.id_=(Qa+=Math.random()+1).toString();if(P){P=$jscomp.makeIterator(P);for(var U;!(U=P.next()).done;)U=U.value,this.set(U[0],U[1])}};R.prototype.set=function(P,U){if(!Z(P))throw Error("Invalid WeakMap key");
aa(P);if(!$jscomp.owns(P,da))throw Error("WeakMap key fail: "+P);P[da][this.id_]=U;return this};R.prototype.get=function(P){return Z(P)&&$jscomp.owns(P,da)?P[da][this.id_]:void 0};R.prototype.has=function(P){return Z(P)&&$jscomp.owns(P,da)&&$jscomp.owns(P[da],this.id_)};R.prototype.delete=function(P){return Z(P)&&$jscomp.owns(P,da)&&$jscomp.owns(P[da],this.id_)?delete P[da][this.id_]:!1};return R},"es6","es3");$jscomp.MapEntry=function(){};
$jscomp.polyfill("Map",function(w){function N(){if($jscomp.ASSUME_NO_NATIVE_MAP||!w||"function"!=typeof w||!w.prototype.entries||"function"!=typeof Object.seal)return!1;try{var R=Object.seal({x:4}),P=new w($jscomp.makeIterator([[R,"s"]]));if("s"!=P.get(R)||1!=P.size||P.get({x:4})||P.set({x:4},"t")!=P||2!=P.size)return!1;var U=P.entries(),ka=U.next();if(ka.done||ka.value[0]!=R||"s"!=ka.value[1])return!1;ka=U.next();return ka.done||4!=ka.value[0].x||"t"!=ka.value[1]||!U.next().done?!1:!0}catch(Va){return!1}}
if($jscomp.USE_PROXY_FOR_ES6_CONFORMANCE_CHECKS){if(w&&$jscomp.ES6_CONFORMANCE)return w}else if(N())return w;var T=new WeakMap,Z=function(R){this.data_={};this.head_=da();this.size=0;if(R){R=$jscomp.makeIterator(R);for(var P;!(P=R.next()).done;)P=P.value,this.set(P[0],P[1])}};Z.prototype.set=function(R,P){R=0===R?0:R;var U=aa(this,R);U.list||(U.list=this.data_[U.id]=[]);U.entry?U.entry.value=P:(U.entry={next:this.head_,previous:this.head_.previous,head:this.head_,key:R,value:P},U.list.push(U.entry),
this.head_.previous.next=U.entry,this.head_.previous=U.entry,this.size++);return this};Z.prototype.delete=function(R){R=aa(this,R);return R.entry&&R.list?(R.list.splice(R.index,1),R.list.length||delete this.data_[R.id],R.entry.previous.next=R.entry.next,R.entry.next.previous=R.entry.previous,R.entry.head=null,this.size--,!0):!1};Z.prototype.clear=function(){this.data_={};this.head_=this.head_.previous=da();this.size=0};Z.prototype.has=function(R){return!!aa(this,R).entry};Z.prototype.get=function(R){return(R=
aa(this,R).entry)&&R.value};Z.prototype.entries=function(){return na(this,function(R){return[R.key,R.value]})};Z.prototype.keys=function(){return na(this,function(R){return R.key})};Z.prototype.values=function(){return na(this,function(R){return R.value})};Z.prototype.forEach=function(R,P){for(var U=this.entries(),ka;!(ka=U.next()).done;)ka=ka.value,R.call(P,ka[1],ka[0],this)};Z.prototype[Symbol.iterator]=Z.prototype.entries;var aa=function(R,P){var U=P&&typeof P;"object"==U||"function"==U?T.has(P)?
U=T.get(P):(U=""+ ++Qa,T.set(P,U)):U="p_"+P;var ka=R.data_[U];if(ka&&$jscomp.owns(R.data_,U))for(R=0;R<ka.length;R++){var Va=ka[R];if(P!==P&&Va.key!==Va.key||P===Va.key)return{id:U,list:ka,index:R,entry:Va}}return{id:U,list:ka,index:-1,entry:void 0}},na=function(R,P){var U=R.head_;return $jscomp.iteratorPrototype(function(){if(U){for(;U.head!=R.head_;)U=U.previous;for(;U.next!=U.head;)return U=U.next,{done:!1,value:P(U)};U=null}return{done:!0,value:void 0}})},da=function(){var R={};return R.previous=
R.next=R.head=R},Qa=0;return Z},"es6","es3");$jscomp.findInternal=function(w,N,T){w instanceof String&&(w=String(w));for(var Z=w.length,aa=0;aa<Z;aa++){var na=w[aa];if(N.call(T,na,aa,w))return{i:aa,v:na}}return{i:-1,v:void 0}};$jscomp.polyfill("Array.prototype.findIndex",function(w){return w?w:function(N,T){return $jscomp.findInternal(this,N,T).i}},"es6","es3");var svManager={getInstance:function(){var w=window.$rdp;return w&&w.running&&w.running()?w:null}};svGlobal.getInstance=svManager.getInstance;
function connvertServer(w){var N={};N.id=w.id;N.server=w.id;N.displayName=w.displayName||w.id;if(w=w.rdp){for(var T in w)N[T]=w[T];N.user=w.username||"";N.pwd=w.password||"";N.useConsole=w.console||!1;N.legacyMode=w.leagacyMode||w.legacyMode||!1;N.server_bpp=w.color||16;N.exe=w.remoteProgram||"";N.args=w.remoteArgs||"";N.startProgram=0<N.exe.length?"app":N.command&&0<N.command.length?"shell":"noapp"}return N}
function Rdp2(w){w=svGlobal.util.getServerArgs(w);if(!w||!w.gateway)return hi5.notifications.notify({msg:__svi18n.noauth}),null;var N=w.gateway||"",T=0,Z=0,aa=16,na=1==w.useSSL||"true"==w.useSSL||"on"==w.useSSL||null;w.width&&(T=parseInt(w.width,10));w.height&&(Z=parseInt(w.height,10));w.color&&(aa=parseInt(w.color,10));w.server_bpp&&(aa=parseInt(w.server_bpp,10));w=hi5.browser.obj2url(w);null===na&&(na="https:"==location.protocol);return new Rdp((na?"wss://":"ws://")+N+"/RDP?"+w,T,Z,aa)}
svGlobal.Rdp2||(svGlobal.Rdp2=Rdp2);
function Rdp(w,N,T,Z){var aa,na;function da(a){return"on"==a||"true"==a||1==a}function Qa(){var a=l.gateway;l.ongetgatewayaddress&&(a=l.ongetgatewayaddress(a));return a}function R(){var a=hi5.storage.get("SV_CONN_SHARE_ID");a||(a=hi5.tool.uuid(),hi5.storage.set("SV_CONN_SHARE_ID",a));return a}function P(a,b){a=M[a]||b;a.startsWith("/")||a.toLowerCase().startsWith("http")||(a=hi5.libPath+a);return a}function U(){return D.displayName||D.server||D.symlink||D.id||"undefined"}function ka(a){l.loadbalanceToken||
(l.loadbalanceToken=M.loadbalanceTokenName?M.loadbalanceTokenName+"="+a:"")}function Va(a,b,c){l.ontitlechange&&(a=l.ontitlechange(a,c));l.setTitle&&a&&(b=b||window,b.document.title=a)}function nb(a,b){switch(a){case 16:case 8:case 24:case 32:break;case 15:return D.invitation||l.showMessage("15 bit color is not supported anymore."),!1;default:return!1}Xa=a;b&&(va?va.postMessage({type:0,cmd:1,data:a}):ja&&ja.setColor(a));return!0}function bb(a,b,c,e){ta=a;ua=b;Db=Eb=0;Fb=ta-1;Gb=ua-1;Ja&&(ta=(D.waWidth||
hi5.browser.getScreenWidth())|0,ua=(D.waHeight||hi5.browser.getScreenHeight())|0);D.minWidth&&ta<D.minWidth&&(ta=D.minWidth|0);D.minHeight&&ua<D.minHeight&&(ua=D.minHeight|0);ta&=-4;ua&=-4;svGlobal.logger.warn("resolution changed, w:"+ta+" h:"+ua);var d=ta,n=ua;Y?Y.resize(d,n):Y=new Zb(d,n);L.setSize(ta,ua,Ja?"hidden":null);if(c||ta!=a||ua!=b)va?va.postMessage({type:0,cmd:2,data:{w:ta,h:ua}}):ja&&ja.setResolution(ta,ua);if(l.onresolutionchange&&!e)l.onresolutionchange(a,b)}function ha(a){!Ra&&sa&&
(va?(Hb.data=a,"string"!=typeof a?va.postMessage(Hb,[a]):va.postMessage(Hb)):ja.writeRawInput(a))}function $b(a){switch(a){case "\r":break;case "\n":l.writeScancode(28);break;case "\t":l.writeScancode(15);break;default:ha("86"+a)}}function Ib(a){var b=this;a||(a=143);this.send=function(c){var e=!!c.buffer,d=e?c:c.getData(),n=64==a;c=e?d.length:c.getEnd()||d.length;c<d.length&&(d=e?d.subarray(0,c):d.slice(0,c));e=n?5:9;c=new Uint8Array(e+c);c[0]=a;if(n)c[1]=b.id,c[2]=b.id>>8,c[3]=b.id>>16,c[4]=b.id>>
24;else{n=b.name;for(var f=Math.min(n.length,8),A=0;A<f;A++)c[1+A]=n.charCodeAt(A)}c.set(d,e);ha(c.buffer)};this.name="";this.count=this.id=this.flags=0}function tb(a){if(l){var b=__svi18n.errorCode[a];a={name:a,message:b,msg:b};l.displayMsg&&l.showMessage(a);0<svGlobal.log&&console.error&&console.error(a);if(l.onerror)l.onerror(a)}}function Jb(a){if(l){var b=__svi18n.info[a];b||(b="info "+a);l.displayMsg&&l.showMessage(b);svGlobal.logger.info(b)}}function Kb(){var a=sa;gb=sa=!1;va?va.postMessage({type:0,
cmd:3}):ja&&ja.resetStatus();a&&(sa=a)}function Lb(a){wa||(wa=new hi5.file.UploadManager(new hi5.file.WsFileService(ha)),wa.addEvent("beforeupload",function(b,c,e){if(l.beforeupload)return l.beforeupload(b,c,e)}),wa.addEvent("fileuploaded",function(b,c,e){if(l.onfileuploaded)l.onfileuploaded(b,c,e)}),wa.addEvent("uploaded",function(b,c){if(l.onuploaded)l.onuploaded(b,c)}),wa.addEvent("uploadingCancelled",function(){if(l.onuploadingCancelled)l.onuploadingCancelled()}));a.setFileHandler(wa)}function ac(a,
b,c){var e=!1;this.exe=a;this.args=b||"";this._dir=c||"";var d=this;this.close=function(){!e&&sa&&(e=!0,ha("8C5"+d.exe+"\t"+d.args+"\t"+l.sessionInfo.appInfo.session))}}function zc(){var a=window.opener;if(a)try{if(a.__sparkUser&&a.__sparkUser.session)return a.__sparkUser;if(a.opener&&a.opener.__sparkUser.session)return a.opener.__sparkUser}catch(b){}return null}function Ac(){var a=0,b=0,c=new l.GatewayChannel;c.name="MESSGSTB";c.onopen=function(){svGlobal.logger.info("Message Channel open")};c.process=
function(e){if(0==e.getByte())e.getByte(),e.getByte(),e.getByte();else{var d=e.getByte(),n=e.getLittleEndian16(),f=e.getLittleEndian16();if(0!=d)svGlobal.logger.warn("Invalid AUTODETECT_REQUEST");else switch(f){case 1:case 4097:f=new RdpBuffer(new Uint8Array(6),0,6);f.setByte(6);f.setByte(1);f.setLittleEndian16(n);f.setLittleEndian16(0);f.markEnd();c.send(f);break;case 20:case 276:case 4116:a=6;b=Date.now();break;case 2:n=e.getLittleEndian16();a+=n;break;case 43:case 1065:case 1577:43==f&&(d=e.getLittleEndian16(),
a=a+d+8,e.skipPosition(d));e=e.has(4)?e.getLittleEndian32():0;a+=e;e=Date.now()-b;d=new RdpBuffer(new Uint8Array(14),0,14);d.setByte(14);d.setByte(1);d.setLittleEndian16(n);d.setLittleEndian16(43==f?3:11);d.setLittleEndian32(e);d.setLittleEndian32(a);d.markEnd();c.send(d);break;case 2112:case 2176:case 2240:n=e.getLittleEndian32();f=e.getLittleEndian32();e=e.getLittleEndian32();ub={baseRTT:n,bandwidth:f,averageRTT:e};if(l.onnetworkresult)l.onnetworkresult(ub);svGlobal.logger.warn("Network Characteristics Result:");
svGlobal.logger.warn(ub);break;default:svGlobal.logger.warn("Invalid network detect PDU",e)}}};c.onclose=function(){svGlobal.logger.info("MSG channel close")};l.addGatewayChannel(c)}function Bc(a,b,c,e,d){Mb.set(a,b);Nb.set(a,e);b="<b>User:&nbsp;</b>"+c+"&nbsp;("+e+")&nbsp;&nbsp;&nbsp;&nbsp;<b>Expire Date:</b> "+d;c=document.createElement("div");e=document.createElement("input");e.type="radio";e.name="scard_name";e.value=a;0==a&&(e.defaultChecked=!0);c.appendChild(e);c.innerHTML+=b;c.innerHTML+="<br>";
return c}function Cc(a,b){var c=document.createElement("div"),e=document.createElement("input");e.type="radio";e.name="ds_name";e.value=a;0==a&&(e.defaultChecked=!0);c.appendChild(e);c.innerHTML+=b;c.innerHTML+="<br>";return c}function bc(){var a="";D&&da(D.connectif)&&D.symlink&&"sessionStorage"in window&&(a="SV_"+D.symlink,D.domain&&(a+=D.domain),D.user&&(a+=D.user));return a}function Dc(){var a=hi5.appcfg.persistentId?window.localStorage:window.sessionStorage;if(!a)return"";var b=a.getItem("appInfo.session");
if(!b)return"";b="&_session="+b;(a=a.getItem("appInfo.numericId"))&&(b+="&_numericId="+a);return b}function Ob(){if(!sa){gb=!1;var a="";Ra?la.init(!1,!0,!1,0,!1,!1):a=l.getRuntimeURL();void 0==M.wsPost&&(M.wsPost=!1);l.oncreatewebsocket&&(va=null);va?(Ra&&(Ra.onopen=Pb,Ra.onclose=ob,Ra.onmessage=function(c){Qb.data=c.data;va.postMessage(Qb,[Qb.data])}),va.postMessage({type:0,cmd:0,data:{addr:a,width:ta,height:ua,server_bpp:Xa,libPath:hi5.libPath,libMin:hi5.libMin,wsPost:M.wsPost}})):(ja=new RdpGeneral(Ra||
a,ta,ua,Xa,Y,!1,M.wsPost),ja.oncreatewebsocket=l.oncreatewebsocket,ja.run());va?va.addEventListener("message",cc,!1):(ja.onopen=Pb,ja.onmessage=dc,ja.onclose=ob,ja.onerror=tb,ja.oninfo=Jb,ja.onloggedin=Rb,ja.onresolutionchange=function(c,e){bb(c,e,!1,D.monitorDef&&0<=D.monitor?!0:!1)},ja.onAltSecWindows=ec,ja.onMoveCursor=Sb,ja.onCloseSurface=fc,ja.onColorChange=nb,ja.onHistoryReceived=function(){Tb()},ja.onLockKeyState=function(c){if(l.onLockKeyState)l.onLockKeyState(c)});if(a=L.getSurface(L.size()-
1))Ja?a&&(a.remoteApp=new ac(D.exe,D.args,"")):Va(U(),a.getWindow());if(D.invitation&&!da(D.shadow)){var b=null;a&&(b=a.initChat(D.expert));pb=new l.GatewayChannel;pb.name="C_H_A_T";pb.process=function(c){c=c.getUnicodeString(c.getEnd()-c.getPosition(),!0);b&&b.add(c,D.novice)};b&&(b.onchat=function(c){if(sa){var e=Array(2*c.length);e=new hi5.DataBuffer(e,0,e.length);e.setUnicodeString(c);e.markEnd();pb.send(e)}});l.addGatewayChannel(pb)}hi5.browser.isIE&&!qb&&(0==D.playSound||0<l.mode)&&(qb=hi5.browser.loadFlash(M.flash||
hi5.libPath+"plugin.swf"))&&(gc=!0)}}function cc(a){a=a.data;switch(a.type){case 1:switch(a.event){case 0:Pb();break;case 1:ob(a.expected);break;case 2:tb(a.code);break;case 3:Jb(a.code);break;case 4:Rb();break;case 5:bb(a.w,a.h,!1,D.monitorDef&&0<=D.monitor?!0:!1);break;case 6:Sb(a.x,a.y,!0);break;case 7:fc();break;case 8:0==a.id&&Tb();Ba&&Ba.check(1<a.id?15555:0);break;case 9:nb(a.color);break;case 10:if(l.onLockKeyState)l.onLockKeyState(a.state);break;default:svGlobal.logger.warn("Invalid worker event "+
a.type)}break;case 2:Y.setRGBs(a.x,a.y,a.w,a.h,a.pixel,a.offset,a.scansize);break;case 3:Y.moveArea(a.srcx,a.srcy,a.cx,a.cy,a.dx,a.dy);break;case 5:Y.fillRect(a.l,a.t,a.w,a.h,a.color);break;case 6:Y.drawLine(a.x1,a.y1,a.x2,a.y2,a.color);break;case 7:Y.bitBlt(a.opcode,a.dstwidth,a.x,a.y,a.cx,a.cy,a.src,a.srcwidth,a.srcx,a.srcy);break;case 8:Y.drawLineExt(a.x1,a.y1,a.x2,a.y2,a.color,a.opcode);break;case 9:hc(a);break;case 10:dc(a);break;case 11:Ga.attach(a.data,0,a.data.length);ec(Ga,a.size);break;
case 12:Y.drawText(a.font,a.flags,a.mixmode,a.foregroundColor,a.backgroundColor,a.clipLeft,a.clipTop,a.clipcx,a.clipcy,a.boxLeft,a.boxTop,a.boxcx,a.boxcy,a.x,a.y,a.length,a.text,a._left,a._top,a._right,a._bottom);break;case 13:Y.drawBitmap(a.cacheID,a.cacheIDX,a.x,a.y,a.cx,a.cy,a.srcx,a.srcy,a.opcode);break;case 14:Y.saveDesktop(a.x,a.y,a.cx,a.cy,a.offset);break;case 15:Y.restoreDesktop(a.x,a.y,a.cx,a.cy,a.offset);break;case 16:Y.putFont(a.font,a.character,a.glyph);break;case 17:Y.putCursor(a.idx,
a.cursor);break;case 18:Y.setCursor(a.idx);break;case 19:Y.getHistory(ha,function(){va.postMessage({type:0,cmd:7})});Ba&&Ba.check(15555);break;case 20:Ga.attach(a.data,a.off,a.data.length-a.off);Y.setHistory(a.order,Ga);break;case 21:Y.putBitmap(a.id,a.idx,a.bitmap);break;default:svGlobal.logger.warn("Invalid worker msg "+a.type)}}function ic(a){Ba&&Ba.check(a)}function Pb(){sa=!0;var a="87"+navigator.userAgent+"\t";vb=hi5.tool.uuid();document.cookie=vb+"=sv";ha(a+vb);if(l.onopen)l.onopen();M.joinCloseMode&&
l.setJoinCloseMode(M.joinCloseMode)}function fc(){L&&L.close()}function dc(a){var b=a.data;if("string"!=typeof b){a=new Uint8Array(b);Ga.attach(a,0,b.byteLength);var c=Ga.getLittleEndian16();switch(c){case 28:a=Ga;b=a.getAscllString(8);c=cb[b];null!=c?c.process(a):svGlobal.logger.warn("Channel "+b+" not found");break;case 55:a=Ga;switch(a.getByte()){case 0:aa=a.getLittleEndian16();na=a.getLittleEndian16();Ya=a.getLittleEndian32();a.skipPosition(6);db=a.getLittleEndian16();svGlobal.logger.info("Audio Format, tag="+
aa+" channels="+na+" bitsPerSample="+db+" samplePerSec="+Ya);jc();break;case 1:Ec(a)}Ba&&Ba.check();break;case 56:kc(Ga.getUnicodeString(Ga.getEnd()-Ga.getPosition(),!1));break;case 60:lc(Ga);break;case 62:mc(Ga.getUnicodeString(Ga.getEnd()-Ga.getPosition(),!1));break;case 63:nc(Ga);Ba&&Ba.check();break;case 64:b=Ga;c=b.getByte();a=b.getLittleEndian32();switch(c){case 1:b=b.getAscllString();if(la[b]&&(svGlobal.logger.info("DVC create, name:"+b+" id:"+a),la[b].newInstance?(la[a]=la[b].newInstance(),
la[a].id=a):(la[b].id=a,la[a]=la[b]),la[a].onopen))la[a].onopen();break;case 3:la[a]&&la[a].process(b);break;case 4:if(la[a]&&la[a].onclose)la[a].onclose();svGlobal.logger.info("close DVC, id:"+a)}Ba&&Ba.check();break;case 146:a:switch(a=Ga,b=a.getByte(),b){case 0:a=new Uint8Array(2);a[0]=146;a[1]=1;ha(a.buffer);break;case 1:break;case 5:b=a.getByte();a=a.getLittleEndian32();0!=b||a&4||(Sa^=65536,L.execute("setFeature",[Sa]));break;case 6:Ca.remoteLockFlags=a.getLittleEndian32();Ca.checkLockFlags=
!0;if(l.onLockKeyState)l.onLockKeyState({capsLock:0!=(Ca.remoteLockFlags&4),numLock:0!=(Ca.remoteLockFlags&2),scrollLock:0!=(Ca.remoteLockFlags&1)},{capsLock:0!=(Ca.localLockFlags&4),numLock:0!=(Ca.localLockFlags&2),scrollLock:0!=(Ca.localLockFlags&1)});svGlobal.logger.info("remoteLockFlags: "+Ca.remoteLockFlags);break;case 7:b=a.getByte();l.sessionInfo.appInfo.twoFAEnabled=0<b;switch(b){case 0:b=a.getByte();c=a.getLittleEndian32();a=a.getBytes(c);l.sessionInfo.appInfo.twoFAQR=a;l.ontwofaqr&&l.ontwofaqr(a)||
2==b&&L.execute("showTwoFAQR");break;case 1:Y.pause(!0,!0);if(l.ontwofacode&&l.ontwofacode())break a;(a=L.getFocused())&&a.showTwoFACode();break;case 2:if(b=a.getByte(),a=1==a.getByte(),(!l.ontwofaresult||!l.ontwofaresult(b,a))&&Ca.onauthcoderesult)Ca.onauthcoderesult(b,a)}break;default:svGlobal.logger.warn("Invalid Client Control: "+b)}break;default:if(l.onunknownmessage)l.onunknownmessage(c,Ga);else svGlobal.logger.warn("@TODO:"+c+"\n")}}else switch(c=parseInt(b.substring(0,2),16),a=b.substring(2),
c){case 0:ha("87"+navigator.userAgent);break;case 15:if(l){Ub=!1;jb=l.reconnectTimes;(l&&0==l.mode||da(D.connectif))&&Tb();b="";for(b in eb)if((c=eb[b])&&c.onopen)c.onopen();for(b in cb)if((c=cb[b])&&c.onopen)c.onopen();a&&(a=JSON.parse(a),a.capability&&l&&(l.sessionInfo.suppressOutput=!!a.capability.suppressOutput))}break;case 26:b=JSON.parse(a);if(b.name){isNaN(b.name)||(b.name="S"+b.name);b.message||(b.message=b.msg);if(l.onnotify)l.onnotify(b);svGlobal.logger.info("msg="+a);if(2==b.type&&l.onerror)l.onerror(b);
if(a=__svi18n.errorCode[b.name])b.msg=a+" "+b.msg;l.showMessage(b)}else 0<svGlobal.log&&console.erro("No error code for message:"+a);break;case 27:L.drawLicense(a);break;case 50:if(sa)switch(b=parseInt(a.substring(0,1),10),a=a.substring(1),b){case 1:Fc(a);break;case 2:rb?(rb.type==a?l.writeRawInput("881"+a+"\t"+rb.text):l.writeRawInput("881ERROR\t"),rb=null):!(b=L.getFocused())||b.processClipReq(a)||!M.clipWarnAlways&&oc||!D||D.leagacyMode||(l.showMessage(__svi18n.info.menucopy,null,5E3),oc=!0);break;
case 5:(b=L.getFocused())&&"0"!=a&&b.setIgnorePaste(!0)}break;case 51:L.setReadOnly("1"==a);break;case 54:b=a.split("\t");a=Qa()+b[0];a=l.modifyURL(a);svGlobal.logger.info("Downloading file:"+a+" name:"+b[1]+" driver:"+b[2]);l.onprintingready&&l.onprintingready({link:a,printerName:b[1],pinterDriver:b[2]})||(b=L.getFocused())&&b.showPDF(a);break;case 55:b=parseInt(a.substring(0,1),16);a=a.substring(1);switch(b){case 0:a=a.split("\t");aa=parseInt(a[0],10);na=parseInt(a[1],10);db=parseInt(a[2],10);Ya=
parseInt(a[3],10);svGlobal.logger.debug("Audio Format, tag="+aa+" channels="+na+" bitsPerSample="+db+" samplePerSec="+Ya);jc();break;case 1:Gc(a)}break;case 56:kc(a);break;case 57:b=a.split("\t");svGlobal.logger.debug(a);if(a=L.getWinById(parseInt(b[0]))){if(!L.hasApp(b[1])){(c=L.getOwnerSurface(a))&&c.railWin&&(c.railWin.appId=b[1],c.railWin.addApp(b[1]));if(l.onremoteappstart)l.onremoteappstart({id:b[1]});if(a.isVisible()&&a.titleInfo&&l.ontitlechange)l.ontitlechange(c.railWin.getFullTitle(a.id),
b[1])}a.appId=b[1]}break;case 58:Hc(a);break;case 59:a=hi5.Base64.dec(a,0);Sa=(new RdpBuffer(a,0,a.length)).getLittleEndian32();Za||!(Sa&16||Sa&65536)?(wb=!1,wa=null):(Sa&16&&(wb=!0),wa||(a=L.getFocused())&&Lb(a));Sa&64&&l.showMessage(__svi18n.info.recording);wa&&(wa.setUpload(!(Sa&128)),wa.setDownload(!(Sa&131072)),wa.canCopyFile=0!=(Sa&65536));L.execute("setFeature",[Sa]);break;case 60:lc(b64ToBuffer(a));break;case 61:a=JSON.parse(a);switch(a.type){case 0:bb(a.width,a.height,!0,!1);nb(a.color);
(b=a.server)&&l&&(l.server=a.server);pc=a.length;c=L.getFocused();Ja=1==a.isRail;c&&(1!=l.mode&&c.setAutoScale(!Ja),b&&Va(U(),c.getWindow()),b=a.keyboard,"undefined"!=typeof b&&0==b&&c.setUnicode(!0),b=a.mapDisk)&&(wb=!0,Lb(c));if(l.onopened)l.onopened(a);break;case 1:a=a.duration;if(l.onprogress)l.onprogress(a,pc);break;case 2:2==a.status?(Kb(),sa=!0):(b=0==a.status,b==Y.isPaused()||l.onsessionpause&&l.onsessionpause(b,a)||(Y.pause(b),b||L.repaint(0,0,Y.width-1,Y.height-1),a.warn&&l.showMessage(b?
__svi18n.info.sessionPaused:__svi18n.info.sessionResumed)))}break;case 62:mc(a);break;case 63:nc(b64ToBuffer(a));break;default:if(l.onunknownmessage)l.onunknownmessage(c,a);else svGlobal.logger.warn("@TODO:"+b+"\n")}}function Tb(){if(!Za&&!Ka&&(Ka=!0,l&&(M.pingInterval&&l.startPing(M.pingInterval),l.onready)))l.onready()}function Ic(a,b){var c=0,e=!1;this.width=a;this.interval=b;var d=0;this.start=function(){e||(e=!0,c=setInterval(function(){var n=L.getFocused();n&&sa&&(n=n.getThumbnail(a))&&n.length!=
d&&(ha("8E7"+n),d=n.length)},b))};this.stop=function(){clearInterval(c)}}function Jc(a,b){!Ma||Ma.width==a&&Ma.interval==b||(Ma.stop(),Ma=null);Ma||(Ma=new Ic(a,b));Ma.start()}function nc(a){var b=a.getAscllString(8);(b=eb[b])&&b.process&&b.process(a)}function mc(a){var b=parseInt(a.substring(0,1),16),c=a.substring(1);a=!1;var e=l.sessionInfo.appInfo;switch(b){case 0:var d=JSON.parse(c);Kb();sa=!0;a=d.width;e=d.height;if(a==ta&&e==ua)break;bb(a,e,!1,!1);break;case 1:d=JSON.parse(c);l.sessionInfo.joinedSessions.push(d.numericId);
l.sessionInfo.joiners.push(d);e.sessions[d.numericId]=d.name||d.__ip;if(!e.joined||M.alertJoin)l.onsessionjoin&&(a=l.onsessionjoin(d)),!a&&__svi18n.info.joinsession&&l.showMessage(__svi18n.info.joinsession.applyArgs([d.numericId,d.__ip,d.name]));break;case 2:d=JSON.parse(c);l.sessionInfo.joinedSessions.removeElm(d.numericId);delete e.sessions[d.numericId];b=l.sessionInfo.joiners;c=0;for(var n=b.length;c<n;c++)if(b[c].numericId==d.numericId){b.splice(c,1);break}if(!e.joined||M.alertJoin)l.onsessionexit&&
(a=l.onsessionexit(d)),!a&&__svi18n.info.exitsession&&l.showMessage(__svi18n.info.exitsession.applyArgs([d.numericId,d.__ip,d.name]));break;case 3:d=JSON.parse(c);e.joinMode!=d.mode&&(e.joinMode=d.mode,b=hi5.$("joinSelect"))&&(b.value=d.mode);if(e.hasControl)break;e.hasControl=!0;L.setReadOnly(!1,2==d.mode);if(e=hi5.$("requestControl"))e.disabled=!0;l.ongivecontrol&&(a=l.ongivecontrol());if(a)break;l.showMessage(__svi18n.info.givecontrol,null,5E3);break;case 4:d=JSON.parse(c);L.setReadOnly(!0,2==
d.mode);e.hasControl=!1;if(e=hi5.$("requestControl"))e.disabled=!1;l.ontakebackcontrol&&(a=l.ontakebackcontrol());if(a)break;l.showMessage(__svi18n.info.nocontrol,null,5E3);break;case 5:d=JSON.parse(c);l.onrequirecontrol&&(a=l.onrequirecontrol(d));if(a)break;a=__svi18n.info.title.applyArgs([d.name,d.numericId,d.__ip]);e=__svi18n.info.recontrol;Y.isPaused&&(e+="<br><br>"+(__svi18n.info.autoresume||""));l.showMessage({title:a,msg:e,cbYes:function(){l.giveControl(d.numericId);this.destroy();Y.isPaused()&&
l.pauseSession(l.sessionInfo.appInfo.numericId,!1)},cbNo:function(){l.refuseControl(d.numericId);this.destroy()}});break;case 6:L.execute("setTouchRemoting",[!0]);break;case 7:d=JSON.parse(c);d.width&&d.height&&bb(d.width,d.height,!0,D.monitorDef&&0<=D.monitor?!0:!1);d.color&&(nb(d.color,!0),svGlobal.logger.warn("Color depth changed to:"+d.color));d.version&&(l.sessionInfo.protocolVersion=d.version);break;case 8:d=JSON.parse(c);Ub=!0;if(l.onrequestcredential&&l.onrequestcredential(d,Ca.reconnect))break;
if(l.onautherror&&l.onautherror(d,Ca.reconnect))break;L.getFocused().requestCredential(d,Ca.reconnect);break;case 9:d=JSON.parse(c);0<d.interval&&0<d.width?Jc(d.width,d.interval):Ma&&(Ma.stop(),Ma=null);break;case 11:d=JSON.parse(c);l.onrequirejoin&&(a=l.onrequirejoin(d));if(a)break;a=__svi18n.info.title.applyArgs([d.name,d.numericId,d.__ip]);l.showMessage({title:a,msg:__svi18n.info.reqjoin,cbYes:function(){l.allowJoin(d.numericId,!0);this.destroy()},cbNo:function(){l.allowJoin(d.numericId,!1);this.destroy()}});
break;case 13:d=JSON.parse(c);"login"==d.type&&Rb();break;case 14:if(d=JSON.parse(c),l.oncontrolchange)l.oncontrolchange(d)}}function lc(a){switch(a.getByte()){case 32:if(!Y.isPaused()){var b=a.getLittleEndian16(),c=a.getLittleEndian16(),e=a.getLittleEndian16(),d=void 0,n=void 0;M.noCursorName||(d=a.getLittleEndian32(),l.sessionInfo.appInfo&&(n=l.sessionInfo.appInfo.sessions[d]));Sb(c,e,!0,n,d,b)}}}function Sb(a,b,c,e,d,n){Y.isPaused()||L.getFocused().moveCursor(a,b,c,e,d,n)}function hc(a){L.setCursor(a)}
function Kc(a){var b=M.page&&M.page.join||"";if(b.startsWith("http://")||b.startsWith("https://"))return b;if(b.startsWith("/"))return location.origin+b;var c=location.href,e=c.lastIndexOf("/");if(b)return c.substring(0,e+1)+b;b=Qa();c.toLowerCase().startsWith(b.toLowerCase())&&(b=c.substring(0,e));return b+"/"+a}function kc(a){a=JSON.parse(a);Vb=a.session;var b=a.numericId,c=hi5.appcfg.persistentId?window.localStorage:window.sessionStorage;c&&(c.setItem("appInfo.session",Vb),c.setItem("appInfo.numericId",
b));ka(a.appId);a.server||(a.server=U());if(b=hi5.$("joinSelect"))b.value=a.joinMode;if(b=hi5.$("requestControl"))b.disabled=a.hasControl;a.joined?1!=l.mode&&L.execute("setAutoScale",[!0]):(l.mode=0,da(D.connectif)&&L.setSize(ta,ua),M.disableJoinedAppResize&&(l.windowState=0));var e=Qa();b=Kc("join.html")+"?id="+(a.joined||a.numericId);(c=a.webAddress)&&0<c.length&&c.toLowerCase()!=e.toLowerCase()&&(e=c.indexOf("://"),l.protocol="http"==c.substring(0,e)?"ws":"wss",l.gateway=c,b+="&gateway="+encodeURIComponent(c));
b=l.modifyURL(b);a.joinLink=b;l.sessionInfo.appInfo=a;"isApp"in a&&Ja!==a.isApp&&(Ja=a.isApp,bb(ta,ua,!0,!0),gb||1==l.mode||L.execute("setAutoScale",[!0]));a.ver&&a.ver!=svGlobal.version&&svGlobal.logger.warn("Client:"+svGlobal.version+" server:"+a.ver);M.cursorNameOnly=a.isAssistance;if(l.onsessionstart)l.onsessionstart(l.sessionInfo)}function Hc(a){if(wa){var b=parseInt(a.charAt(0),10);a=a.substring(1);if(5==b)wa.notifyFiles(JSON.parse(a));else{var c=a.split("\t");switch(b){case 1:wa.confirmId(c[0],
c[1],c[2]);break;case 2:wa.read(c[0],parseInt(c[1],10),parseInt(c[2],10));break;case 4:wa.close(c[0]);break;case 9:a='<a href="'+l.modifyURL(Qa()+c[0])+'" download="'+c[1]+'" target="_blank">'+__svi18n.info.fileReady+": "+c[1]+"</a>",__svi18n.info.download&&L.getFocused().showMessage({msg:a,title:__svi18n.info.download,cbNo:function(){wa.removeFile(c[0],!0);this.destroy()},onclick:function(e){"A"==e.target.tagName&&this.destroy()}})}}}}function Gc(a){function b(H){var F=0;H*=n;for(f=0;f<n;f++)F|=
(d[H+f]&255)<<8*f;F>A?(F-=G,F/=-B):F/=A;return F}if(xa.available&&!Y.isPaused()){var c=a.indexOf("\t"),e=a.substring(0,c),d=hi5.Base64.dec(a,c+1);1!=aa&&(kb||(kb=new MSGSM),d=kb.decode(d,0,d.length));a=db;var n=a>>3,f=0,A=Math.pow(2,a-1)-1,B=-A-1,G=Math.pow(2,a);a=0;c=na;var S=Math.floor(Math.floor(d.length/n)/c),C=xa.getBuffer(S),v=C.getChannelData(0),q=C.getChannelData(1);for(a=0;a<S;){var h=2*a,r=b(h);1==c?(v[a]=r,q[a]=r):(v[a]=r,q[a]=b(h+1));a++}a=xa.playBuffer(C);setTimeout(function(H){return function(){ha("8A"+
H)}}(e),1E3*(a-xa.delay))}}function Ec(a){function b(n){return function(){ha("8A"+n)}}var c=a.getByte(),e=a.getLittleEndian16(),d=Date.now();a.skipPosition(8);a=Wb(a,c,e,0);a=1E3*(a-xa.delay);Za||(e+=Date.now()-d+a,setTimeout(b(c+","+e),a))}function Wb(a,b,c,e){if(!gc||Y.isPaused())return 0;var d=c=0,n=a.getPosition();b=a.getData();e||(e=a.getEnd()-n);var f=e;if(41222==aa)return(c=xa.getContext())&&c.decodeAudioData(b.buffer.slice(n),function(v){v=xa.playBuffer(v);Za||setTimeout(sendLater(Jb),1E3*
(v-xa.delay))},function(v){svGlobal.logger.warn(v)}),0;if(d=1!=aa)kb||(kb=new MSGSM),b=kb.decode(b,n,f),n=0,f=b.length;var A=db,B=A>>3,G=Math.floor(f/B),S=a=0,C=0;d||(a=Math.pow(2,A-1)-1,S=-a-1,C=Math.pow(2,A));A=na;if(qb){n="";if(d){for(;c<f;c++)0<c&&(n+=","),n+=b[c]+","+b[c]+","+b[c]+","+b[c];qb.write(n);return e/65*.025}for(;c<f;)0<c&&(n+=","),d=b[c++]|b[c++]<<8,9>d?d=0:d>a?(d-=C,d/=-S):d/=a,n+=d,1==A&&(n+=","+d);qb.write(n);return e/B/Ya*.6}e=n;n=Math.floor(G/A);f=xa.getBuffer(n);B=f.getChannelData(0);
G=f.getChannelData(1);c=0;if(d)for(;c<n;)1==A?G[c]=B[c]=b[e++]:(B[c]=b[e++],G[c]=b[e++]),c++;else for(;c<n;)d=b[e++]|b[e++]<<8,d>a?(d-=C,d/=-S):d/=a,1==A?B[c]=d:(B[c]=d,d=b[e++]|b[e++]<<8,d>a?(d-=C,d/=-S):d/=a),G[c]=d,c++;return xa.playBuffer(f)}function jc(){va&&va.postMessage({type:0,cmd:5,data:{tag:aa,channels:na,samplePerSec:Ya,bitsPerSample:db}})}function qc(a){if(!l.openLink||2E3<a.length)return!1;var b=a.indexOf(";");0<b&&(a=a.substring(b+1));b=a;a=a.toLowerCase();var c=0==a.indexOf("http://")||
0==a.indexOf("https://")||0==a.indexOf("ftp://")||0==a.indexOf("mailto:")||0==a.indexOf("tel:")||0==a.indexOf("callto:");c||(0==a.indexOf("www.")?(c=!0,a="http://"+a):0==a.indexOf("ftp.")&&(c=!0,a="ftp://"+a));return c?0<a.indexOf("\r")||0<a.indexOf("\n")?!1:l.onurlredirection&&l.onurlredirection(b)?!0:(a=L.getFocused())?a.processLink(b):!1:!1}function Lc(a){if(a.startsWith("text/html;<img data-sv-img")){var b=a.indexOf('src="');if(0<b){b+=5;var c=a.indexOf('"',b),e=a.substring(b,c);e=l.modifyURL(e);
a=a.substring(0,b)+e+a.substring(c)}}return a}function Fc(a){if("text/plain;"!=a){if(1666<Date.now()-Ca.reqCopyTime&&!(l.onservercopy&&l.onservercopy(a)||qc(a))){var b=L.getFocused();b&&b.copyToClip(Lc(a))}setTimeout(function(){ha("883")},999)}}function Rb(){if(!gb&&(setTimeout(function(){sa&&ha("884")},333),l.onloggedin))l.onloggedin();Xb=gb=!0;Ja&&1!=l.mode&&L.execute("setAutoScale",[!1]);wa&&(wa.enabled=!0);xb&&!Ja&&(Y.setContext(L.getFocused().context),L.repaint(0,0,Y.width-1,Y.height-1))}function ob(a){if(l){hi5.browser.cookie.delete(vb);
svGlobal.logger.warn("closed "+(l.sessionInfo.appInfo?l.sessionInfo.appInfo.numericId:0));l.onagentmessage&&(l.onagentmessage=null);if(l.onagentclose)l.onagentclose();var b=bc();b&&l.sessionInfo.appInfo&&0==l.mode&&(sessionStorage[b]=l.sessionInfo.appInfo.session);if(l&&(b=1!=l.mode,!sa&&b&&tb("connection"),b=b&&(sa||jb<l.reconnectTimes)&&0<jb&&!a,Ka=sa=!1,b)){jb--;__svi18n.info.reconnecting&&l.showMessage(__svi18n.info.reconnecting+" "+(l.reconnectTimes-jb)+"/"+l.reconnectTimes,null,3E3);setTimeout(Ob,
M.reconnectInterval||5E3);svGlobal.logger.info("Reconnecting..."+jb);return}if(Ub)svGlobal.logger.info("Req credential");else{Ba&&(l.stopPing(),Ba=null);va&&(va.removeEventListener("message",cc,!1),va.postMessage({type:0,cmd:4}),va.terminate(),va=null);wa&&(wa.release(),wa=null);Da=w=null;la&&(la.close(),la=null);eb&&hi5.Arrays.release(eb);cb&&hi5.Arrays.release(cb);Ma&&(Ma.stop(),Ma=null);xa&&(xa.close(),xa=null);sb=null;try{if(l.onclose)l.onclose(a);else if(svGlobal.logger.info("onclose: null"),
hi5.appcfg&&hi5.appcfg.returnUrl){window.location.href=hi5.appcfg.returnUrl;return}L&&(L.close(),L=null)}catch(c){svGlobal.logger.warn(c)}Ga=null;ja&&(ja.onopen=null,ja.onmessage=null,ja.onclose=null,ja.onerror=null,ja.close(),ja=null);L=Ca=null;Y&&(Y.release(),Y=null);hi5.browser.isChromeApp?chrome.runtime.onSuspend.removeListener(l.close):window.removeEventListener("unload",l.close,!1);window&&window.$rdp==l&&(window.$rdp=null);l=null}}}function rc(){ja&&sa?ja.close():ob(!0)}function ec(a,b){var c=
a.getLittleEndian32();if(0!=(c&16777216))if(b=a.getLittleEndian32(),0!=(c&1073741824)){a.getLittleEndian16();a.getByte();c=a.getByte();var e=a.getLittleEndian16(),d=a.getLittleEndian16(),n=0;16>c&&(n=a.getLittleEndian16());var f=a.getLittleEndian16(),A=a.getLittleEndian16();a.getBytes(f);n&&a.getBytes(n);if(8<=c&&(n=L.getFocused())&&n.onremoteappicon){f=new hi5.graphic.Bitmap(e,d,32);a.getPosition();e=new Uint8Array(e*d*4);d=a.getPosition();A=d+A;var B;a=a.getData();for(var G=0,S,C;d<A;)switch(c){case 16:(B=
a[d++]|a[d++]<<8)?(C=B>>7&248,S=B>>2&248,B=B<<3&248,C|=C>>5,S|=S>>5,B|=B>>5,e[G++]=B,e[G++]=S,e[G++]=C,e[G++]=255):G+=4;break;case 32:e[G++]=a[d++],e[G++]=a[d++],e[G++]=a[d++],e[G++]=a[d++]}f.putPixels(e,0,e.length);a=L.getWinById(b);n.onremoteappicon(a,f)}}else 0!=(c&2147483648)?svGlobal.logger.info("XXX rail cache icon, winId="+b):0!=(c&536870912)?(svGlobal.logger.info("***** delete winId="+b),L.delWin(b)):Mc(a,c,b);else if(0!=(c&33554432))svGlobal.logger.info("XXX Alt Sec window Notify="+c);else if(0!=
(c&67108864))if(svGlobal.logger.info("*** -- Alt Sec window Desktop, flags:"+c),0!=(c&1))svGlobal.logger.info("Desktop non monitored flags="+c);else{if(0!=(c&32)&&(b=a.getLittleEndian32(),svGlobal.logger.info("Desktop monitored flags="+c+" winId="+b),0<b&&((n=L.getOwnerSurfaceById(b))&&n.railWin&&n.railWin.setActiveWinId(b,3==M.windowState),L.setTitle(b),Y.getContext()||(b=L.getFocused())&&Y.setContext(b.context))),0!=(c&16)&&(b=a.getByte(),0<b))for(c=L.zOrders,c.length=b,n=0;n<b;n++)c[n]=a.getLittleEndian32(),
svGlobal.logger.info("---zorders:"+c[n])}else svGlobal.logger.info("XXX Alt Sec window order flgas="+c)}function sc(a){var b=L.getFocused();if(b&&b.railWin){var c=a||b.railWin.mainWin;if(c&&2<c.showState){var e=b.getFreeSpace();a=Math.max(Math.abs(c.winHeight-e.height),Math.abs(c.winWidth-e.width));svGlobal.logger.info("--- fitMainWin offset:"+a+" _hOffset:"+c._hOffset+" appId:"+c.appId+" spaceH:"+e.height);0<a?(b=a==c._hOffset,c._hOffset&&b||(c._hOffset=a,setTimeout(function(){c.resize(0,0,e.width,
e.height)},333))):c._hOffset=0}}}function Mc(a,b,c){Ja||(Ja=!0);var e=0==(b&268435456),d=L.getWinById(c);d?e=!0:d=new L.LocalWin(c);svGlobal.logger.info("\n\n=========== winId="+c+" existed="+e);if(d){0!=(b&2)&&(d.ownerWinid=a.getLittleEndian32(),svGlobal.logger.info("***** ownerWinid="+d.ownerWinid));0!=(b&8)&&(d.style=a.getLittleEndian32(),d.extStyle=a.getLittleEndian32(),svGlobal.logger.info("***** winId="+c+" style="+d.style+" extStyle="+d.extStyle),svGlobal.logger.info("*****--- WS_POPUP="+(0!=
(d.style&2147483648))),svGlobal.logger.info("*****--- WS_DLGFRAME="+(0!=(d.style&4194304))),svGlobal.logger.info("*****--- DS_MODALFRAME="+(0!=(d.style&128))),svGlobal.logger.info("*****--- WS_EX_DLGMODALFRAME="+(0!=(d.extStyle&1))),svGlobal.logger.info("*****--- WS_EX_TOOLWINDOW="+(0!=(d.extStyle&128))),svGlobal.logger.info("*****--- WS_BORDER="+(0!=(d.style&8388608))),svGlobal.logger.info("*****--- WS_CAPTION="+(0!=(d.style&12582912))),svGlobal.logger.info("*****--- WS_OVERLAPPED="+(0!=(d.style&
0))),svGlobal.logger.info("*****--- WS_OVERLAPPEDWINDOW="+(0!=(d.style&13565952))),svGlobal.logger.info("*****--- WS_POPUPWINDOW="+(0!=(d.style&2156396544))),svGlobal.logger.info("*****--- WS_SIZEBOX="+(0!=(d.style&262144))),svGlobal.logger.info("*****--- WS_CHILD="+(0!=(d.style&1073741824))),svGlobal.logger.info("*****--- WS_SIZEBOX="+(0!=(d.style&262144))),svGlobal.logger.info("*****--- WS_EX_MDICHILD="+(0!=(d.extStyle&64))),svGlobal.logger.info("*****--- WS_EX_LAYERED="+(0!=(d.extStyle&524288))));
if(0!=(b&16)){d.setShowState(a.getByte());svGlobal.logger.info("***** winId="+c+" showState="+d.showState);var n=d.showState;(2==n&&0!=M.noMinimize||!e&&3==n&&5==M.windowState)&&setTimeout(function(){d.exeCommand(61728)},50)}if(n=0!=(b&4)){var f=a.getLittleEndian16();d.titleInfo=a.getUnicodeString(f,!1);svGlobal.logger.info("***** winId="+c+" title="+d.titleInfo)}0!=(b&16384)&&(d.clientOffsetX=a.getLittleEndian32(),d.clientOffsetY=a.getLittleEndian32(),svGlobal.logger.info("***** winId="+c+" coffX"+
d.clientOffsetX+" coffY="+d.clientOffsetY));0!=(b&65536)&&(d.clientAreaWidth=a.getLittleEndian32(),d.clientAreaHeight=a.getLittleEndian32(),svGlobal.logger.info("***** winId="+c+" cw"+d.clientAreaWidth+" ch="+d.clientAreaHeight));0!=(b&131072)&&(d.rpContent=a.getLittleEndian32());0!=(b&262144)&&(d.rootParentHandle=a.getLittleEndian32());if(0!=(b&2048)){f=a.getLittleEndian32();var A=a.getLittleEndian32();d.winOffsetX=f;d.winOffsetY=A;svGlobal.logger.info("***** winId="+c+" offX"+d.winOffsetX+" offY="+
d.winOffsetY)}0!=(b&32768)&&(d.winClientDeltaX=a.getLittleEndian32(),d.winClientDeltaY=a.getLittleEndian32(),svGlobal.logger.info("***** winId="+c+" dX"+d.winClientDeltaX+" dY="+d.winClientDeltaY));0!=(b&1024)&&(d.winWidth=a.getLittleEndian32(),d.winHeight=a.getLittleEndian32(),svGlobal.logger.info("***** winId="+c+" w"+d.winWidth+" h="+d.winHeight));if(!e)if(d.isMainWin())3==l.windowState?sc(d):setTimeout(function(){d.activate(1)},666);else if(2<d.showState&&(f=L.getFocused())){f=f.getFreeSpace();
var B=d.winWidth,G=d.winHeight;if(d.winOffsetX>f.width||d.winOffsetY>f.height||0>B+d.winOffsetX||0>G+d.winOffsetY){var S=(f.width-d.winWidth)/2|0,C=(f.height-d.winHeight)/2|0;0>S&&(S=0);0>C&&(C=0);setTimeout(function(){d.resize(S,C,B,G)},50)}}0!=(b&256)&&(f=a.getLittleEndian16(),0<f&&a.skipPosition(8*f));0!=(b&4096)&&(d.visibleOffsetX=a.getLittleEndian32(),d.visibleOffsetY=a.getLittleEndian32());0!=(b&512)&&(b=a.getLittleEndian16(),d.numVisibilityRects=b,0<b&&a.skipPosition(8*b));if(e)L.onWinChange(d);
else L.addWin(d);n&&L.setTitle(c);c==L.zOrders[0]?svGlobal.logger.info("zzz zorders win: "+c):svGlobal.logger.info("zzz win: "+c,L.zOrders)}else svGlobal.logger.warn("XXX, No win with id:"+c)}function Zb(a,b){function c(k,m,g,p,t){0<t.width?t.union(k,m,g,p):(t.x=k,t.y=m,t.width=g,t.height=p)}function e(k,m,g,p){for(ea=0;ea<Aa;ea++){var t=ba[ea];if(k>=t[0]&&m>=t[1]&&g<=t[2]&&p<=t[3])return ma[ea]}return null}function d(k,m,g,p){if(Aa){var t=e(k,m,k+g-1,m+p-1);t&&c(k,m,g,p,t)}else c(k,m,g,p,r)}function n(k,
m,g,p,t,u,y){for(var x=t*g+p,z=k.setRGB,I=k.getRGB,E=0;E<y;E++){for(var O=0;O<u;O++){if(k){var qa=I(p+O,t+E);z(p+O,t+E,~qa&16777215)}else m[x]=~m[x]&16777215;x++}x+=g-u}}function f(k,m,g,p,t,u,y,x,z,I){m=I*x+z;null==y&&(y=k);for(k=0;k<u;k++){for(z=0;z<t;z++)q[p+k][g+z]=q[p+k][g+z]&y[m]&16777215|4278190080,m++;m+=x-t}}function A(k,m,g,p,t,u,y,x,z,I){m=I*x+z;z=k.setRGB;I=k.getRGB;null==y&&(y=k);for(k=0;k<u;k++){for(var E=0;E<t;E++){var O=I(g+E,p+k);z(g+E,p+k,O|y[m]&16777215);m++}m+=x-t}}function B(k,
m,g,p){var t=ya;if(t){var u=t.getRGB(m,g);switch(k){case 0:t.setRGB(m,g,0);break;case 1:t.setRGB(m,g,~(u|p)&16777215);break;case 2:t.setRGB(m,g,u&~p&16777215);break;case 3:t.setRGB(m,g,~p&16777215);break;case 4:t.setRGB(m,g,16777215*(~u&p));break;case 5:t.setRGB(m,g,~u&16777215);break;case 6:t.setRGB(m,g,u^p&16777215);break;case 7:t.setRGB(m,g,~u&p&16777215);break;case 8:t.setRGB(m,g,u&p&16777215);break;case 9:t.setRGB(m,g,u^~p&16777215);break;case 10:break;case 11:t.setRGB(m,g,u|~p&16777215);break;
case 12:t.setRGB(m,g,p);break;case 13:t.setRGB(m,g,(~u|p)&16777215);break;case 14:t.setRGB(m,g,u|p&16777215);break;case 15:t.setRGB(m,g,16777215);break;default:svGlobal.logger.warn("unsupported pixel opcode: "+k),t.setRGB(m,g,p)}}}function G(k,m,g,p,t,u,y,x,z){k>x||m>z||(g=k+g-1,g>x&&(g=x),k<u&&(k=u),g=g-k+1,p=m+p-1,p>z&&(p=z),m<y&&(m=y),p=p-m+1,1>g||1>p||ya.fillRect(k,m,g,p,t))}function S(k,m,g,p,t,u,y,x,z,I,E,O){if(!(m>E||g>O)){var qa=m+p-1;qa>E&&(qa=E);z=m<z?z:m;qa=qa-m+1;E=g+t-1;E>O&&(E=O);I=
g<I?I:g;O=E-g+1;if(!(1>qa||1>O)){E=128;var ia=0;y|=4278190080;x|=4278190080;if(z==m&&I==g&&qa==p&&O==t)if(0==k)for(var fa=0;fa<t;fa++){k=g+fa;for(var oa=0;oa<p;oa++)0==E&&(ia++,E=128),0!=(u[ia]&E)&&(q[k][m+oa]=x),E>>=1;ia++;E=128;ia==u.length&&(ia=0)}else for(fa=0;fa<t;fa++){k=g+fa;for(oa=0;oa<p;oa++)0==E&&(ia++,E=128),q[k][m+oa]=0!=(u[ia]&E)?x:y,E>>=1;ia++;E=128;ia==u.length&&(ia=0)}else if(0==k)for(fa=0;fa<O;fa++){k=g+fa;for(oa=0;oa<qa;oa++)0==E&&(ia++,E=128),m+oa>=z&&k>=I&&0!=(u[ia]&E)&&(q[k][m+
oa]=x),E>>=1;ia++;E=128;ia==u.length&&(ia=0)}else for(fa=0;fa<O;fa++){k=g+fa;for(oa=0;oa<qa;oa++)0==E&&(ia++,E=128),m+oa>=z&&g+fa>=I&&(q[k][m+oa]=0!=(u[ia]&E)?x:y),E>>=1;ia++;E=128;ia==u.length&&(ia=0)}}}}function C(k,m,g,p,t){this.offset=k;this.baseLine=m;this.width=g;this.height=p;this.fontData=t}function v(k,m,g,p,t,u,y,x,z){this.cache_idx=k;this.rawData=m;this.none=!m;this.hotX=g;this.hotY=p;this.width=t;this.height=u;this.xorSize=x;this.andSize=z;this.result="";this.distance=0;this.bpp=y;this.system=
"";if(m){if(!this.distance){k=0;if(m){y=0;for(var I=m.length;y<I;y++)0!=m[y]&&(k+=y%t+(y/t|0))}this.distance=k}if(!this.system){a:switch(this.distance){case 507:k="text";break a;case 2046:case 4359:k="default";break a;default:k=""}this.system=k}}k="";if(!this.system&&m){y=t*u*4;k=62+y+x+z;I=new Uint8Array(k);k=new hi5.DataBuffer(I,0,k);k.setLittleEndian16(0);k.setLittleEndian16(2);k.setLittleEndian16(1);k.setByte(t);k.setByte(u);k.setByte(0);k.setByte(0);k.setLittleEndian16(g);k.setLittleEndian16(p);
k.setLittleEndian32(40+y+x+z);k.setLittleEndian32(22);k.setLittleEndian32(40);k.setLittleEndian32(t);k.setLittleEndian32(2*u);k.setLittleEndian16(1);k.setLittleEndian16(32);k.setLittleEndian32(0);k.setLittleEndian32(x+z);k.setLittleEndian32(0);k.setLittleEndian32(0);k.setLittleEndian32(0);k.setLittleEndian32(0);for(g=u-1;0<=g;g--)for(p=0;p<t;p++)u=m[t*g+p],k.setByte(u&255),k.setByte(u>>8&255),k.setByte(u>>16&255),k.setByte(u>>24&255);k="data:image/x-icon;base64,"+hi5.Base64.enc(k.getData())}this.url=
k}var q=[],h=null,r=new hi5.graphic.Rectangle(0,0,0,0),H="Uint8ClampedArray"in window,F=null,K=0,J=0,X=0,ca=0,Q=null,ba,ma,ea=0,Aa=0;this.width=a;this.height=b;var Na=!1,ya=this,pa={imgData:null,left:0,top:0,width:0,height:0};this.setProfiler=function(k){F=k};this.getDirtyArea=function(){return r};this.setImgRect=function(k,m,g,p){K=k;J=m;X=g;ca=p};this.parseMonitorDef=function(k){var m=k.split(","),g=m.length,p=[];if(1<g){for(var t=!1,u=0;u<g;u++){var y=m[u].split(":");if(4==y.length)p[u]=Array(5),
p[u][0]=parseInt(y[0]),p[u][1]=parseInt(y[1]),p[u][2]=parseInt(y[2]),p[u][3]=parseInt(y[3]),p[u][4]=0==p[u][0]&&0==p[u][1]?1:0;else{t=!0;break}}t&&(svGlobal.logger.warn("invaiid monitorDef:"+k),p.length=0)}return p};this.setMonitorLayout=function(k){var m=k.length,g=0;ba=k;for(ma=Array(m);g<m;g++)ma[g]=new hi5.graphic.Rectangle(0,0,0,0);Aa=m};this.setMonitorCount=function(k){Aa=k};this.addImg=function(k){X&&(Q&&URL.revokeObjectURL(Q.src),Q=k)};this.flushImgs=function(){Q&&(URL.revokeObjectURL(Q.src),
Q=null,X=0)};this.getData=function(){return q};this.pause=function(k,m){Na=k;m&&h&&h.fillRect(0,0,a,b)};this.release=function(){r=null;hi5.Arrays.release(ma);ya.flushImgs();q=h=ya=null;pa=pa.imgData=null};this.isPaused=function(){return Na};this.setContext=function(k){k!=h&&(h||!k||k.createImageData(1,1).data.buffer||(H=!1),h=k,null!=h&&(pa.imgData=h.createImageData(a,b)))};this.getContext=function(){return h};this.resize=function(k,m){if(q.length!=m||q[0].length!=k){for(var g=0;g<m;g++)q[g]=new Uint32Array(k);
q.length=m;ya.width=a=k;ya.height=b=m;null!=h&&(pa.imgData=h.createImageData(a,b))}};ya.resize(a,b);this.getBuffer=function(){return q};this.setRGB=function(k,m,g){q[m][k]=g|4278190080};this.getRGB=function(k,m){return q[m][k]};this.setRGBs=function(k,m,g,p,t,u,y){var x=k+g,z=m+p;z>b&&(z=b);if(!(k>=a)){x>a&&(g-=x-a);for(x=m;x<z;x++,u+=y)q[x].set(t.subarray(u,u+g),k);d(k,m,g,p)}};this.moveArea=function(k,m,g,p,t,u){if(0<u){var y=k+t,x=m+u,z;for(z=p-1;0<=z;z--)q[x+z].set(q[m+z].subarray(k,k+g),y)}else if(0>
u)for(y=k+t,x=m+u,z=0;z<p;z++)q[x+z].set(q[m+z].subarray(k,k+g),y);else if(0<t){y=k+t;x=m+u;var I;for(z=g-1;0<=z;z--){var E=y+z;var O=k+z;for(I=0;I<p;I++)q[x+I][E]=q[m+I][O]}}else for(y=k+t,x=m+u,z=0;z<g;z++)for(E=y+z,O=k+z,I=0;I<p;I++)q[x+I][E]=q[m+I][O];d(k+t,m+u,g,p)};this.getRGBs=function(k,m,g,p,t){var u=new Uint32Array(g*p),y=k+g;p=m+p;for(var x=0;m<p;m++)u.set(q[m].subarray(k,y),x),x+=g;return t?(t(u),null):u};this.repaint=function(k,m,g,p){var t=pa.imgData.data,u=0,y,x;F&&F.begin("paint");
0>k&&(g+=k,k=0);0>m&&(p+=m,m=0);k+g>a&&(g=a-k);m+p>b&&(p=b-m);var z=k+g;var I=m+p;if(H)for(t=new Uint32Array(t.buffer),x=m;x<I;x++)t.set(q[x].subarray(k,z),u),u+=a;else{var E=4*(a-g)|0;for(x=m;x<I;x++){for(y=k;y<z;y++){var O=q[x][y];t[u++]=O&255;t[u++]=O>>8&255;t[u++]=O>>16&255;t[u++]=255}u+=E}}pa.left=k;pa.top=m;pa.width=g;pa.height=p;F&&F.end("paint");return pa};this.postPaint=d;this.draw=function(k,m,g,p){if(h&&!Na)if(Q&&Q.complete&&(h.drawImage(Q,K,J,X,ca),URL.revokeObjectURL(Q.src),Q=null),Aa){if(k=
e(k,m,g,p),k.width)return ya.repaint(k.x,k.y,k.width,k.height),k.width=0,pa}else if(r.width)return ya.repaint(r.x,r.y,r.width,r.height),r.width=0,pa;return null};this.fillRect=function(k,m,g,p,t){var u=k+g,y=m+p;if(q[0].fill)for(var x,z=m;z<y;z++)q[z].fill(t,k,u);else for(z=m;z<y;z++)for(x=k;x<u;x++)q[z][x]=t;d(k,m,g,p)};this.drawLine=function(k,m,g,p,t){if(m==p){if(k>g){var u=k;k=g;g=u}var y=q[m];g++;if(y.fill)y.fill(t,k,g);else for(u=k;u<g;u++)y[u]=t}else if(k==g)for(m>p&&(u=m,m=p,p=u),p++,u=m;u<
p;u++)q[u][k]=t;else{var x=Math.abs(g-k),z=Math.abs(p-m);u=k;y=m;g=g>=k?k=1:k=-1;m=p>=m?p=1:p=-1;if(x>=z){m=k=0;var I=x;var E=x/2|0;var O=z}else p=g=0,I=z,E=z/2|0,O=x,x=z;if(!(1>x))for(x++,z=0;z<x;z++)q[y][u]=t,E+=O,E>=I&&(E-=I,u+=k,y+=p),u+=g,y+=m}};this.bitBlt=function(k,m,g,p,t,u,y,x,z,I){var E=ya;switch(k){case 0:x=E.setRGB;for(E=g;E<g+t;E++)for(z=p;z<p+u;z++)x(E,z,0);break;case 1:k=y;z=I*x+z;I=E.setRGB;m=E.getRGB;null==k&&(k=E);for(E=0;E<u;E++){for(y=0;y<t;y++)I(g+t,p+u,~(m(g+t,p+u)|k[z])&16777215);
z+=x-t}break;case 2:k=y;z=I*x+z;I=E.setRGB;m=E.getRGB;null==k&&(k=E);for(E=0;E<u;E++){for(y=0;y<t;y++){var O=m(g+t,p+u);I(g+t,p+u,O&~k[z]&16777215);z++}z+=x-t}break;case 3:n(E,y,x,z,I,t,u);y?E.setRGBs(g,p,t,u,y,I*x+z,x):E.moveArea(z,I,t,u,g-z,p-I);break;case 4:n(E,null,m,g,p,t,u);f(E,m,g,p,t,u,y,x,z,I);break;case 5:n(E,null,m,g,p,t,u);break;case 6:k=y;z=I*x+z;null==k&&(k=E);for(E=0;E<u;E++){for(I=0;I<t;I++)q[p+E][g+I]=q[p+E][g+I]^k[z]&16777215|4278190080,z++;z+=x-t}break;case 7:k=y;z=I*x+z;I=E.setRGB;
m=E.getRGB;null==k&&(k=E);for(E=0;E<u;E++){for(y=0;y<t;y++)O=m(g+y,p+E),I(g+y,p+E,~(O&k[z])&16777215),z++;z+=x-t}break;case 8:f(E,m,g,p,t,u,y,x,z,I);break;case 9:k=y;z=I*x+z;I=E.setRGB;m=E.getRGB;null==k&&(k=E);for(E=0;E<u;E++){for(y=0;y<t;y++)O=m(g+y,p+E),I(g+y,p+E,O^~k[z]&16777215),z++;z+=x-t}break;case 10:break;case 11:k=y;z=I*x+z;I=E.setRGB;m=E.getRGB;null==k&&(k=E);for(E=0;E<u;E++){for(y=0;y<t;y++)O=m(g+y,p+E),I(g+y,p+E,O|~k[z]&16777215),z++;z+=x-t}break;case 12:y?E.setRGBs(g,p,t,u,y,I*x+z,x):
E.moveArea(z,I,t,u,g-z,p-I);break;case 13:n(E,null,m,g,p,t,u);A(E,m,g,p,t,u,y,x,z,I);break;case 14:A(E,m,g,p,t,u,y,x,z,I);break;case 15:x=E.setRGB;for(E=g;E<g+t;E++)for(z=p;z<p+u;z++)x(E,z,16777215);break;default:svGlobal.logger.warn("unsupported opcode: "+k)}d(g,p,t,u)};this.drawLineExt=function(k,m,g,p,t,u){if(k==g||m==p){var y;if(m==p)if(g>k){var x=g-k;if(!(1>x))for(y=0;y<x;y++)B(u,k+y,m,t)}else{if(x=k-g,!(1>x))for(y=0;y<x;y++)B(u,g+y,m,t)}else if(p>m){if(x=p-m,!(1>x))for(y=0;y<x;y++)B(u,k,m+y,
t)}else if(x=m-p,!(1>x))for(y=0;y<x;y++)B(u,k,p+y,t)}else{var z=Math.abs(g-k),I=Math.abs(p-m);y=k;x=m;var E,O;var qa=g>=k?E=1:E=-1;var ia=p>=m?O=1:O=-1;if(z>=I){ia=E=0;var fa=z;var oa=z/2>>0;var Fa=I}else O=qa=0,fa=I,oa=I/2>>0,Fa=z,z=I;if(1>z)return;for(I=0;I<=z;I++)B(u,y,x,t),oa+=Fa,oa>=fa&&(oa-=fa,y+=E,x+=O),y+=qa,x+=ia}t=Math.min(k,g);k=Math.max(k,g);g=Math.min(m,p);m=Math.max(m,p);0>k-t||0>m-g||d(t,g,k-t+1,m-g+1)};this.drawText=function(k,m,g,p,t,u,y,x,z,I,E,O,qa,ia,fa,oa,Fa,yb,zb,Ab,Bb){var Ha=
0;1<O?G(I,E,O,qa,t,yb,zb,Ab,Bb):1==g&&G(u,y,x,z,t,yb,zb,Ab,Bb);for(var Nc=oa,za=0;za<oa;)switch(Fa[Ha+za]){case 255:var Ea=Fa[Ha+za+2];if(Ea>Nc-Ha){za=oa=0;break}Ea=Fa.slice?Fa.slice(Ha,Ha+Ea):Fa.subarray(Ha,Ha+Ea);Oa[Fa[Ha+za+1]]=Ea;za+=3;oa-=za;Ha=za;za=0;break;case 254:var Wa=(Ea=Oa[Fa[Ha+za+1]])?Ea:null;Wa&&0==Wa[1]&&0==(m&32)&&(0!=(m&4)?fa+=Fa[Ha+za+2]:ia+=Fa[Ha+za+2]);za=za+2<oa?za+3:za+2;oa-=za;Ha=za;za=0;if(!Wa)break;for(var Oc=Wa.length,$a=0;$a<Oc;$a++){Ea=Ia.getFont(k,Wa[$a]);if(0==(m&32)){var hb=
Wa[++$a];0!=(hb&128)?(0!=(m&4)?fa+=Wa[$a+1]|Wa[$a+2]<<8:ia+=Wa[$a+1]|Wa[$a+2]<<8,$a+=2):0!=(m&4)?fa+=hb:ia+=hb}Ea&&(S(g,ia+Ea.offset&65535,fa+Ea.baseLine&65535,Ea.width,Ea.height,Ea.fontData,t,p,yb,zb,Ab,Bb),0!=(m&32)&&(ia+=Ea.width))}break;default:Ea=Ia.getFont(k,Fa[Ha+za]),0==(m&32)&&(hb=Fa[Ha+ ++za],0!=(hb&128)?(0!=(m&4)?fa+=Fa[Ha+za+1]|Fa[Ha+za+2]<<8:ia+=Fa[Ha+za+1]|Fa[Ha+za+2]<<8,za+=2):0!=(m&4)?fa+=hb:ia+=hb),Ea&&(S(g,ia+Ea.offset&65535,fa+Ea.baseLine&65535,Ea.width,Ea.height,Ea.fontData,t,
p,yb,zb,Ab,Bb),0!=(m&32)&&(ia+=Ea.width)),za++}1<O?0<qa&&d(I,E,O,qa):0<x&&0<z&&d(u,y,x,z)};this.drawBitmap=function(k,m,g,p,t,u,y,x,z){var I=La.getBitmap(k,m);I?(k=I.width,m=I.height,t>k&&(t=k),u>m&&(u=m),12==z?ya.setRGBs(g,p,t,u,I.data,x*k+y,k):ya.bitBlt(z,a,g,p,t,u,I.data,k,y,x)):svGlobal.logger.warn("Failed to get bitmap from cache, id:"+k+" idx="+m)};this.saveDesktop=function(k,m,g,p,t){ya.getRGBs(k,m,g,p,function(u){ra.save(k,m,g,p,t,u)})};this.restoreDesktop=function(k,m,g,p,t){(t=ra.restore(k,
m,g,p,t))?ya.setRGBs(k,m,g,p,t,0,g):svGlobal.logger.warn("XXX no matched desktop save.")};this.putFont=function(k,m,g){Ia.putFont(k,m,g)};this.putBitmap=function(k,m,g){La.putBitmap(k,m,g)};this.putCursor=function(k,m){V.set(k,m)};this.setCursor=function(k){if(!Na&&-1!=k){var m=V.get(k);if(m)ya.onSetCursor(m);else svGlobal.logger.warn("invalid cursor"+k)}};var W=0;this.isSendingHistory=function(){return 2E3>Date.now()-W};this.getHistory=function(k,m){var g=null;F&&F.begin("his_bitmap");La.forEach(function(x,
z,I){if(x){var E=0,O=0;I=0;for(var qa=x.length;I<qa;I++)x[I]&&x[I].data&&(E++,O+=x[I].raw?x[I].raw.length:4*x[I].data.length);if(E&&O){g=new Uint8Array(O+20*E+8);g[0]=29;g[2]=1;g[3]=4;O=new hi5.DataBuffer(g,4,g.length);O.setLittleEndian32(E);for(I=0;I<qa;I++)(E=x[I])&&E.data&&(O.setLittleEndian16(z),O.setLittleEndian16(I),O.setLittleEndian16(E.left),O.setLittleEndian16(E.top),O.setLittleEndian16(E.width),O.setLittleEndian16(E.height),O.setLittleEndian16(E.bitsperpixel),O.setLittleEndian16(E.codec),
O.setLittleEndian32(E.raw?E.raw.length:4*E.data.length),O.setBytes(E.raw||new Uint8Array(E.data.buffer)));k(g.buffer)}}});F&&F.end("his_bitmap");F&&F.begin("his_font");(g=Ia.toPDU())&&k(g.buffer);F&&F.end("his_font");(g=V.toPDU())&&k(g.buffer);for(var p=4,t=0,u=Oa.length;t<u;t++)Oa[t]&&(p+=Oa[t].length+6);if(4<p){g=new Uint8Array(p);g[0]=29;g[2]=1;g[3]=7;var y=4;t=0;for(u=Oa.length;t<u;t++)Oa[t]&&Oa[t].length&&(g[y++]=t,g[y++]=t>>8,p=Oa[t].length,g[y++]=p,g[y++]=p>>8,g[y++]=p>>16,g[y++]=p>>24,g.set(Oa[t],
y),y+=p);k(g.buffer)}(g=ra.toPDU())&&k(g.buffer);m();W=Date.now()};this.setHistory=function(k,m){switch(k){case 4:F&&F.begin("his_bitmap_dec");var g=m.getLittleEndian32();for(k=0;k<g;k++){var p=m.getLittleEndian16(),t=m.getLittleEndian16(),u=m.getLittleEndian16(),y=m.getLittleEndian16(),x=m.getLittleEndian16(),z=m.getLittleEndian16(),I=m.getLittleEndian16(),E=m.getLittleEndian16(),O=m.getLittleEndian32(),qa=new Uint8Array(m.getData().buffer,m.getPosition(),O),ia=new Uint8Array(O);ia.set(qa);qa=rdpcodecs.bitmap;
switch(E){case 0:var fa=new Uint32Array(ia.buffer);m.skipPosition(O);break;case 1:switch(I){case 16:fa=qa.decompressInt16(x,z,O,ia,0);break;case 24:fa=qa.decompressInt24(x,z,O,ia,0);break;case 32:fa=qa.decompressInt32(x,z,O,ia,0)}m.skipPosition(O);break;case 2:fa=new rdpcodecs.NSCodec,fa.process(m,I,x,z),O=fa.getData(),fa=fa.getDataSize(),fa=new Uint32Array(fa),rdpcodecs.flipimage(O,0,fa,x,z,1)}La.putBitmap(p,t,new rdpcodecs.Bitmap(fa,x,z,u,y,I,0==E?null:ia,E))}F&&F.end("his_bitmap_dec");break;case 5:Ia.fromStream(m);
break;case 6:V.fromStream(m);break;case 7:for(;m.has(6);)if(k=m.getLittleEndian16(),O=m.getLittleEndian32())g=m.getData().subarray(m.getPosition(),m.getPosition()+O),Oa[k]=g,m.skipPosition(O);break;case 9:ra.fromStream(m)}};var V=new function(){var k=[],m=!1;this.useRemoteCursor=function(g){m=g};this.set=function(g,p){m&&(p.system="");k[g]=p};this.get=function(g){return k[g]};this.total=function(){return k.length};this.toPDU=function(){for(var g=2,p=2,t=0,u=0,y=k.length,x;u<y;u++)if(x=k[u])t++,p=
p+7+(x.rawData?x.rawData.length:0);if(!t)return null;p=new Uint32Array(p);p[0]=100728861;p[1]=t;for(u=0;u<y;u++)if(x=k[u])if(t=x.rawData?x.rawData.length:0,p[g++]=x.cache_idx|x.bpp<<16,p[g++]=x.hotX|x.hotY<<16,p[g++]=x.width|x.height<<16,p[g++]=x.xorSize,p[g++]=x.andSize,p[g++]=x.distance,p[g++]=t)p.set(x.rawData,g),g+=t;return p};this.fromStream=function(g){var p=g.getPosition();g=new Uint32Array(g.getData().buffer,p);var t=g[0],u=0;for(p=1;u<t;u++){var y=g[p]&65535;var x=g[p++]>>16;var z=g[p]&65535;
var I=g[p++]>>16;var E=g[p]&65535;var O=g[p++]>>16;var qa=g[p++];var ia=g[p++];var fa=g[p++];var oa=g[p++];var Fa=null;oa&&(Fa=new Uint32Array(oa),Fa.set(g.subarray(p,p+oa)),p+=oa);x=new v(y,Fa,z,I,E,O,x,qa,ia);fa&&(x.distance=fa);m&&(x.system="");k[y]=x}}};V.useRemoteCursor(!!M.remoteCursor);var ra=new function(){function k(g,p,t,u,y,x){this.x=g;this.y=p;this.cx=t;this.cy=u;this.offset=y;this.data=x}var m=[];this.save=function(g,p,t,u,y,x){g=new k(g,p,t,u,y,x);p=0;for(t=m.length;p<t;p++)if(!m[p]){m[p]=
g;return}m.push(g)};this.restore=function(g,p,t,u,y){for(var x,z=0,I=m.length;z<I;z++)if((x=m[z])&&x.x==g&&x.y==p&&x.cx==t&&x.cy==u){if(x.offset==y)return g=x.data,m[z]=null,g;svGlobal.logger.warn("TODO: offset")}return null};this.toPDU=function(){for(var g=0,p=2,t=0,u=m.length;t<u;t++)m[t]&&(g++,p+=m[t].data.length+6);if(!g||!p)return null;p=new Uint32Array(p);var y=2;p[0]=151060509;p[1]=g;for(t=0;t<u;t++)if(g=m[t])p[y++]=g.x,p[y++]=g.y,p[y++]=g.cx,p[y++]=g.cy,p[y++]=g.offset,p[y++]=g.data.length,
p.set(g.data,y),y+=g.data.length;return p};this.fromStream=function(g){g=new Uint32Array(g.getData().buffer,g.getPosition());for(var p=1,t=g[0],u,y,x,z,I,E,O,qa=0;qa<t;qa++)u=g[p++],y=g[p++],x=g[p++],z=g[p++],I=g[p++],E=g[p++],O=new Uint32Array(E),E=p+E,O.set(g.subarray(p,E)),p=E,this.save(u,y,x,z,I,O)}},Oa=[],Ia=new function(){var k=[];this.putFont=function(m,g,p){k[m]||(k[m]=[]);k[m][g]=p};this.getFont=function(m,g){return k[m]?k[m][g]:null};this.toPDU=function(){var m=0,g,p,t;var u=4;for(var y,
x=k.length;m<x;m++)if((t=k[m])&&t.length)for(y=t.length,g=0;g<y;g++)(p=t[g])&&(u+=15+p.fontData.length);if(5>u)return null;var z=new Uint8Array(u);u=new hi5.DataBuffer(z,0,u);z[0]=29;z[2]=1;z[3]=5;u.skipPosition(4);m=0;for(x=k.length;m<x;m++)if((t=k[m])&&t.length)for(y=t.length,g=0;g<y;g++)if(p=t[g])u.setByte(m),u.setLittleEndian16(g),u.setLittleEndian16(p.offset),u.setLittleEndian16(p.baseLine),u.setLittleEndian16(p.width),u.setLittleEndian16(p.height),u.setLittleEndian32(p.fontData.length),u.setBytes(p.fontData);
return z};this.fromStream=function(m){for(;m.has(15);){var g=m.getByte(),p=m.getLittleEndian16(),t=m.getLittleEndian16(),u=m.getLittleEndian16(),y=m.getLittleEndian16(),x=m.getLittleEndian16(),z=m.getLittleEndian32();z=m.getBytes(z);this.putFont(g,p,new C(t,u,y,x,z))}}},La=new function(){var k=[],m=[];this.putBitmap=function(g,p,t){if(32767==p)m[g]&&(m[g].data=null,m[g]=null),m[g]=t;else{var u=k[g];u?u[p]&&(u[p].data=null,u[p]=null):k[g]=u=[];u[p]=t}};this.getBitmap=function(g,p){return 32767==p?
m[g]:k[g]?k[g][p]:null};this.forEach=function(g){for(var p=k.length,t=0;t<p;t++)g(k[t],t,k)}}}function Pc(a,b){function c(q,h,r){this.pixels=q;this.width=h;this.height=r}var e=new rdpcodecs.RemoteFX(!1),d=new rdpcodecs.RDP8BulkData,n=new function(){this.process=function(q){var h=q.getByte();q.getPosition();if(224==h)q=d.decompress(q.getData(),q.getPosition(),q.getEnd()-q.getPosition());else{h=q.getLittleEndian16();for(var r=q.getLittleEndian32(),H=new Uint8Array(r),F,K=0,J,X=0;X<h;X++)F=q.getLittleEndian32(),
1>F||(J=d.decompress(q.getData(),q.getPosition(),F),q.skipPosition(F),F=J.getEnd(),H.set(J.getData().subarray(0,F),K),K+=F);K!=r&&console.error("wrong size");q=new RdpBuffer(H,0,r)}return q}},f=new a.DynamicChannel;f.name="Microsoft::Windows::RDS::Graphics";f.process=function(q){for(q=n.process(q);q.has(8);){var h=q.getLittleEndian16();q.getLittleEndian16();var r=q.getLittleEndian32();r=q.getPosition()+r-8;switch(h){case 1:h=q;var H=h.getLittleEndian16(),F=h.getLittleEndian16();h.getByte();var K=
h.getLittleEndian16(),J=h.getLittleEndian16(),X=h.getLittleEndian16(),ca=h.getLittleEndian16(),Q=X-K+1,ba=ca-J+1,ma=h.getLittleEndian32(),ea=h.getPosition()+ma;H=A[H];switch(F){case 0:Q*ba*4>ma&&(Q--,ba--);F=rdpBitmap.byte2int(h.getData(),ma,h.getPosition());H.setRGBs(K,J,Q,ba,F,0,Q);break;case 3:ma=e.decode(h,ma);Q=ma.getRects();ba=ma.getTiles();F=ma.getTileSize();ma=ma.getRectSize();for(var Aa,Na,ya,pa,W=0;W<F;W++){var V=ba[W];if(ma){Aa=V.x+64;Na=V.y+64;for(var ra=0;ra<ma;ra++)pa=Q[ra],ya=pa.x+
pa.width,pa=pa.y+pa.height,Aa<=ya?Na<=pa?H.setRGBs(V.x+K,V.y+J,64,64,V.data,0,64):H.setRGBs(V.x+K,V.y+J,64,pa-V.y,V.data,0,64):Na<=pa?H.setRGBs(V.x+K,V.y+J,ya-V.x,64,V.data,0,64):H.setRGBs(V.x+K,V.y+J,ya-V.x,pa-V.y,V.data,0,64)}else H.setRGBs(V.x,V.y,64,64,V.data,0,64)}break;case 8:console.log("TODO: clear");break;case 10:break;case 11:console.log("TODO: x264..");break;case 12:console.log("TODO: RDPGFX_CODECID_ALPHA..");break;default:console.log("TODO: "+F)}h.setPosition(ea);H.repaint(K,J,X-K,ca-
J);break;case 2:console.log("TODO: RDPGFX_WIRE_TO_SURFACE_PDU_2");break;case 3:console.log("TODO: RDPGFX_CMDID_DELETEENCODINGCONTEXT");break;case 4:h=q;X=h.getLittleEndian16();K=-16777216|h.getByte()<<16|h.getByte()<<8|h.getByte()|h.getByte()<<24;J=h.getLittleEndian16();X=A[X];for(ca=0;ca<J;ca++)ea=h.getLittleEndian16(),H=h.getLittleEndian16(),Q=h.getLittleEndian16()-ea,ba=h.getLittleEndian16()-H,X.fillRect(ea,H,Q,ba,K),X.postPaint(ea,H,Q,ba);break;case 5:h=q;ba=h.getLittleEndian16();F=h.getLittleEndian16();
K=h.getLittleEndian16();J=h.getLittleEndian16();X=h.getLittleEndian16()-K;ca=h.getLittleEndian16()-J;ea=h.getLittleEndian16();H=A[ba];Q=A[F];ba=ba==F?null:H.getRGBs(K,J,X,ca);for(F=0;F<ea;F++)ma=h.getLittleEndian16(),Aa=h.getLittleEndian16(),ba?Q.setRGBs(ma,Aa,X,ca,ba,0,X):H.moveArea(K,J,X,ca,ma-K,Aa-J);break;case 6:ea=q;h=ea.getLittleEndian16();ea.getLittleEndian32().toString(16);ea.getLittleEndian32().toString(16);K=ea.getLittleEndian16();J=ea.getLittleEndian16();X=ea.getLittleEndian16();ca=ea.getLittleEndian16()-
J;ea=ea.getLittleEndian16()-X;v[K]=new c(A[h].getRGBs(J,X,ca,ea),ca,ea);break;case 7:h=q;J=h.getLittleEndian16();ea=h.getLittleEndian16();K=h.getLittleEndian16();ca=v[J];J=ca.pixels;X=ca.width;ca=ca.height;ea=A[ea];for(H=0;H<K;H++)Q=h.getLittleEndian16(),ba=h.getLittleEndian16(),ea.setRGBs(Q,ba,X,ca,J,0,X);break;case 8:h=q.getLittleEndian16();v[h]=null;break;case 9:h=q;K=h.getLittleEndian16();J=h.getLittleEndian16();X=h.getLittleEndian16();ca=b;ca.id=K;ca.pixelFormat=h.getByte();a.setResolution(J,
X);A[K]=ca;break;case 10:h=q.getLittleEndian16();A[h]=null;break;case 11:h=q;h.getLittleEndian32();h.getLittleEndian32();break;case 12:h=q.getLittleEndian32();K=new Uint8Array(20);J=new RdpBuffer(K);J.setLittleEndian16(13);J.setLittleEndian16(0);J.setLittleEndian32(20);J.setLittleEndian32(0);J.setLittleEndian32(h);B++;J.setLittleEndian32(B);f.send(K);break;case 14:J=q;h=J.getLittleEndian32();K=J.getLittleEndian32();J=J.getLittleEndian32();svGlobal.logger.info("reset graphic, w:"+h+" h:"+K+" monitors:"+
J);b.resize(h,K);break;case 15:h=q;G=h.getLittleEndian16();S=h.getLittleEndian32();C=h.getLittleEndian32();svGlobal.logger.info("s-o map: id:"+G+" x:"+S+" y:"+C);break;case 19:J=q;h=J.getLittleEndian32();K=J.getLittleEndian32();J=J.getLittleEndian32();svGlobal.logger.info("GFX Cap confirm, ver :"+h+" len:"+K+"flags:"+J);break;default:console.log("TODO: xxx gfx:"+h)}q.setPosition(r)}};f.onopen=function(){var q=new Uint8Array(34),h=new RdpBuffer(q);h.setLittleEndian16(18);h.setLittleEndian16(0);h.setLittleEndian32(34);
h.setLittleEndian16(2);h.setLittleEndian32(524292);h.setLittleEndian32(4);h.setLittleEndian32(1);h.setLittleEndian32(524549);h.setLittleEndian32(4);h.setLittleEndian32(1);h.markEnd();f.send(q)};f.onclose=function(){};var A={},B=0,G=0,S=0,C=0,v=[];return f}this.displayMsg=this.reconnectOnResize=!0;this.appTimeout=1600;this.reconnectTimes=0;this.windowState=3;this.setTitle=this.openLink=!0;this.audioBuffer=0;this.sessionInfo={domain:"",userName:"",sessionId:0,joinedSessions:[],suppressOutput:!1,appInfo:null,
joiners:[]};this.mode=0;this.remoteAppLogin=!0;var xb=!1,eb={},cb={},pb=null,l=this,Ub=!1,Ka=!1,Sa=0,qb=null,rb=null,tc=0;hi5.appcfg||(hi5.appcfg={img:{},toolbar:{fadable:!0},displayMsg:!0});var M=hi5.appcfg,vb="";this.setConfig=function(a){M=a};var Ra="object"==typeof w?w:null,D=Ra?{}:hi5.tool.queryToObj(w.substring(w.indexOf("?")+1));void 0==D.mapClipboard&&M.clipboard&&void 0!=M.clipboard.enabled&&(D.mapClipboard=M.clipboard.enabled);var ta=0,ua=0,Xa=(Z||D.color||D.server_bpp||16)|0,kb=null,uc=
null,Ba=null,ub=null,vc="/DOWNLOAD?",wc="/CLIP?";24==Xa&&(Xa=16);D.gfx=D.gfx||D.remotefx;da(D.gfx)&&(Xa=32);this.setLinks=function(a){a.download&&(vc=a.download);a.clipboard&&(wc=a.clipboard)};this.protocol=Ra?"":w.substring(0,w.indexOf("://")).toLowerCase();this.hasSmartCard=function(){return da(D.smartCard)||da(D.mapSmartCard)||da(D.passwordIsPin)};this.hasScanner=function(){return da(D.scanner)};this.hasUSB=function(){return da(D.mapUSB)&&!!navigator.usb};this.getUSB=function(){return D.usb||hi5.appcfg.usb||
{filters:[{classCode:0},{classCode:2},{classCode:5},{classCode:6},{classCode:10},{classCode:13},{classCode:239},{classCode:220},{classCode:239},{classCode:254},{classCode:255}]}};this.setProfiler=function(a){uc=a};this.getProfiler=function(){return uc};this.gateway=function(){if(Ra)return"";var a=w.lastIndexOf("/RDP?");-1==a&&(a=w.lastIndexOf("/JOIN?"));-1==a&&(a=w.lastIndexOf("/PLAY?"));return w.substring(0,a).replace(/wss:\/\//ig,"https://").replace(/ws:\/\//ig,"http://")}();svGlobal.logger.warn("Ver:"+
svGlobal.version+" build:"+svGlobal.build);this.getGatewayAddr=Qa;var Za="object"==typeof w||0<w.indexOf("/PLAY?"),xc=!Za&&0<w.indexOf("invitation=");if(xc){var Yb=decodeURIComponent(w),Cb=Yb.indexOf(' USERNAME="');if(0<Cb){Cb+=11;var Qc=Yb.substring(Cb,Yb.indexOf('"',Cb));w+="&novice="+Qc}w+="&mapClipboard=on";D.mapClipboard="on";this.reconnectOnResize=!1}if(Za)this.mode=1,Ra?w="":(ta=640,ua=480),w+="&touchpad=on",D.touchpad="on",this.reconnectOnResize=!1;else if(0<w.indexOf("/JOIN?")||xc)this.mode=
2,this.reconnectOnResize=!1;N?ta=parseInt(N):D.width&&(ta=parseInt(D.width));T?ua=parseInt(T):D.height&&(ua=parseInt(D.height));-1==ta&&(ta=hi5.browser.getScreenWidth());-1==ua&&(ua=hi5.browser.getScreenHeight());D.symlink&&D.parameters&&hi5.tool.queryToObj(D.parameters,D);D.gateway||(w+="&gateway="+encodeURIComponent(l.gateway));!D.minWidth&&M.minWidth&&(D.minWidth=M.minWidth);!D.minHeight&&M.minHeight&&(D.minHeight=M.minHeight);D.minWidth&&(D.minWidth=parseInt(D.minWidth));D.minHeight&&(D.minHeight=
parseInt(D.minHeight));D.waWidth=D.waWidth?parseInt(D.waWidth):hi5.browser.isAndroid||hi5.browser.isiOS?Math.max(screen.width,screen.height):screen.width;D.waWidth&=-4;D.waHeight=D.waHeight?parseInt(D.waHeight):hi5.browser.isAndroid||hi5.browser.isiOS?Math.max(screen.width,screen.height):screen.height;D.waHeight&=-4;"useSSL"in D||(w+="&useSSL="+("wss"==l.protocol));hi5.storage.isAvailable&&(da(D.shareClipboard)||D.shareClipboardId)&&(w+="&shareClipboardId="+(D.shareClipboardId||R()));M&&(void 0!=
M.displayMsg?this.displayMsg=M.displayMsg:M.displayMsg=this.displayMsg,M.appTimeout&&(this.appTimeout=M.appTimeout),void 0!=M.reconnectOnResize&&(this.reconnectOnResize=M.reconnectOnResize),M.reconnectTimes&&(this.reconnectTimes=M.reconnectTimes),void 0!=M.windowState&&(this.windowState=M.windowState),void 0!=M.openLink&&(this.openLink=M.openLink),void 0!=M.setTitle&&(this.setTitle=M.setTitle),M.audioBuffer&&(this.audioBuffer=M.audioBuffer),"boolean"==typeof M.useWSS&&(w=(M.useWSS?"wss":"ws")+w.substring(w.indexOf("://"))),
"boolean"==typeof M.remoteAppLogin&&(this.remoteAppLogin=M.remoteAppLogin,xb=!M.remoteAppLogin,svGlobal.logger.warn("remoteAppLogin deprecated, use hideLogin in appcfg.js instead")),"boolean"==typeof M.hideLogin&&(xb=M.hideLogin),void 0!=M.localPrinter&&void 0==D.localPrinter&&(D.localPrinter=M.localPrinter));da(D.nocurosr);var Ja="app"==D.startProgram,wb=da(D.mapDisk),fb=0,wa=null;void 0==M.useWorker&&(M.useWorker=!1);M.useWorker&&(!window.Worker||hi5.browser.isFirefox||Ja&&!hi5.browser.isIE||"file:"==
location.protocol||0<navigator.userAgent.indexOf("MSIE 10."))&&(M.useWorker=!1);void 0==hi5.libMin&&(hi5.libMin=!0);var va=M.useWorker?new Worker(P("rdpworker",hi5.libMin?"rdpworker_min.js":"rdpworker.js")):null,jb=this.reconnectTimes,Hb=va?{type:5,data:null}:null;this.getDisplayName=U;this.server=U();this.port=parseInt(D.port,10);this.loadbalanceToken="";M.loadbalanceTokenName&&(D[M.loadbalanceTokenName]?ka(D[M.loadbalanceTokenName]):!1!==M.randomAppId?ka(hi5.tool.uuid()):svGlobal.logger.info("Using app.id as loadbalanceToken"));
this.modifyURL=function(a){l.loadbalanceToken&&(a+=-1==a.indexOf("?")?"?"+l.loadbalanceToken:"&"+l.loadbalanceToken,a+="&loadbalanceTokenName="+M.loadbalanceTokenName);return a};this.getURL=function(){return w};this.getRuntimeURL=function(){var a=w+"&width="+ta+"&height="+ua+"&server_bpp="+Xa+"&audio="+(xa.available||hi5.browser.isIE),b=bc(),c="";b&&(c=sessionStorage[b]||"")&&(c="&preSymJoin="+c);a+=c;var e=D.monitorDef,d=D.monitor,n=0;b=L.size();var f=Array(b);c=Array(b);var A=0,B=0,G=0,S=0,C=0,
v=0,q="";if(e){c=Y.parseMonitorDef(e);for(b=c.length;n<b;n++){var h=c[n];h[0]<G&&(G=h[0]);h[1]<S&&(S=h[1]);h[2]>C&&(C=h[2]);h[3]>v&&(v=h[3])}0>G&&(A=-G);0>S&&(B=-S);h=0>d?[G,S,C,v]:c[d];D.width=h[2]-h[0]+1;D.height=h[3]-h[1]+1;n=L.getSurface(0);n.setMonitor(h[0],h[1],h[2],h[3]);if(A||B)for(h=n.getMousePosition(),h.left+=A,h.right+=A,h.top+=B,h.bottom+=B,n=0;n<b;n++)h=c[n],h[0]+=A,h[1]+=B,h[2]+=A,h[3]+=B;Y.setMonitorLayout(c);0>d&&Y.setMonitorCount(0);l.reconnectOnResize=!1;b="&monitorDef="+e+"&width="+
D.width+"&height="+D.height}else{if(1<b&&!Ja){for(L.verifyMonitors();n<b;n++)e=L.getSurface(n),h=e.getMousePosition(),h.left<G&&(G=h.left),h.top<S&&(S=h.top),h.right>C&&(C=h.right),h.bottom>v&&(v=h.bottom),f[n]=h,q&&(q+=","),q+=h.left+":"+h.top+":"+h.right+":"+h.bottom;0>G&&(A=-G);0>S&&(B=-S);for(n=0;n<b;n++){h=L.getSurface(n).getMousePosition();if(A||B)h.left+=A,h.right+=A,h.top+=B,h.bottom+=B;c[n]=[h.left,h.top,h.right,h.bottom,h.left==A&&h.top==B?1:0]}Y.setMonitorLayout(c);l.reconnectOnResize=
!1}q&&(svGlobal.logger.warn("MonitorDef:"+q),D.width=C-G+1,D.height=v-S+1,q="&monitorDef="+q+"&width="+D.width+"&height="+D.height);b=q}a+=b;0>w.indexOf("waWidth")&&(b=(b=L.getFocused())?b.getWindow():window,a+="&waWidth="+D.waWidth+"&waHeight="+D.waHeight+"&dpWidth="+b.innerWidth+"&dpHeight="+b.innerHeight);b=new Date;D.tzOffset||(a+="&tzOffset="+b.getTimezoneOffset());D.timezone||(c=hi5.timezone.getTimeZone())&&(a+="&timezone="+encodeURIComponent(c.standardName));a+="&time="+b.getTime();void 0==
D.soundPref&&(D.soundPref=0,a+="&soundPref=0");A=c=b="";for(A in eb)B=eb[A],"flags"in B&&(b&&(b+=",",c+=","),b+=B.name,c+=B.flags);b&&(a=a+("&channelName="+b)+("&channelFlags="+c));b="";for(A in cb)B=cb[A],"flags"in B&&(b&&(b+=","),b+=B.name);b&&(a+="&gwChannelName="+b);if(c=zc())b=c.account,c=c.session,b&&(a+="&account="+b),c&&(a+="&session="+c);b=hi5.browser.isTouch&&(1024<=window.innerWidth||768<=window.innerHeight);D.audioRecord=da(D.audioRecord)&&hi5.audio.recordable;la.init(b,da(D.gfx),D.audioRecord,
D.soundPref,da(D.mapCamera)&&!!navigator.mediaDevices,da(D.mapUSB)&&!!navigator.usb);D.audioRecord&&(a+="&audioRecord=on");D.decompressingRDP61&&(a+="&decompressingRDP61=on");0<la.count&&(a+="&dvcChannels="+la.names.join(","));a+="&binary=on";M.existingFile&&(a+="&existingFile="+M.existingFile);a+="&isTouch="+b+"&gatewayAddr="+encodeURIComponent(Qa());a=l.modifyURL(a);M.copyTextOnly&&da(D.mapClipboard)&&(a+="&copyTextOnly=on");(b=hi5.browser.cookie.get("__SV_TOKEN_A"))&&(a+="&__SV_TOKEN_A="+encodeURIComponent(b));
(b=svGlobal.Rdp.languageToKeyboard.detect())&&(a+="&_keyboard="+b);da(D.textPrinter)&&(a+="&printerDriver="+encodeURIComponent("Generic / Text Only"));return a+=Dc()};this.getColor=function(){return Xa};this.changeTitle=Va;hi5.browser.isTouch&&Math.max(ta,ua)>Math.max(window.innerWidth,window.innerHeight)&&(this.reconnectOnResize=!1);this.isRemoteApp=function(){return Ja};var ja=null,sa=!1,gb=!1,Xb=!1,xa=new function(a){var b=null;this.available=!1;this.delay=a;this.supportWebAudio=!1;(0==D.playSound||
0<l.mode)&&(b=hi5.audio.getAudioContext())&&hi5.audio.playable&&(this.supportWebAudio=this.available=!0);this.getContext=function(){return b};this.getBuffer=function(n){return b.createBuffer(2,n,Ya)};var c=0,e=null,d=null;this.setVolume=function(n){1==n?e=null:(e||(e=b.createGain()),e.gain.value=n)};this.playBuffer=function(n){d=b.createBufferSource();d.buffer=n;e?(d.connect(e),e.connect(b.destination)):d.connect(b.destination);var f=b.currentTime,A=0<c?c:f+a;A<f&&(A=f);c=A+n.duration;d.start?d.start(A):
d.noteOn(A);return c-f};this.iOSFix=function(){if(b&&hi5.browser.isSafari){var n=this.getBuffer(1024),f=b.createBufferSource();f.buffer=n;f.connect(b.destination);f.start?f.start(0):f.noteOn(0)}};this.close=function(){b&&(e&&e.disconnect(),d&&d.disconnect(),hi5.audio.releaseAudioContext())}}(l.audioBuffer),gc=xa.available,Y=new Zb(200,200);Y.onSetCursor=hc;this.setVolume=function(a){xa&&xa.setVolume(a)};this.setAudioBuffer=function(a){l.audioBuffer=a;xa.delay=a};var Eb=0,Db=0,Fb=ta-1,Gb=ua-1,Vb="";
window.$rdp||(window.$rdp=this);nb(Xa);this.setResolution=bb;this.running=function(){return sa};this.setJoinMode=function(a){sa&&ha("8E1"+a)};this.setJoinCloseMode=function(a){sa&&ha("8EB3\t"+a)};this.refuseControl=function(a){sa&&ha("8E3"+a)};this.giveControl=function(a){sa&&ha("8E4"+a)};this.pauseSession=function(a,b){sa&&ha("8EB"+(b?1:0)+"\t"+a)};this.closeSession=function(a){sa&&ha("8EB2\t"+a)};this.requestControl=function(){sa&&ha("8E2")};this.saveSession=function(a){sa&&ha("8E9"+(a.save?1:0)+
"\t"+(a.timeout||0)+"\t"+(a.id||0))};this.allowJoin=function(a,b){sa&&ha("8EA"+a+"\t"+(b?1:0))};var sb=new function(){function a(){if(c&&0<c.length){var n=c.shift();n.key?sb.sendSingleKey(n.down,n.key):n.char&&$b(n.char);0<c.length?setTimeout(a,e):(c=null,d&&d())}}var b={" ":57,space:57,pgup:201,pageup:201,pgdn:209,pagedown:209,end:207,home:199,left:203,up:200,right:205,down:208,printscreen:183,insert:210,del:211,"delete":211,altgr:184,windows:219,windowsright:220,context:221,esc:1,backspace:14,back:14,
tab:15,enter:28,meta:29,command:29,ctrl:29,shift:42,alt:56,capslock:58,f1:59,f2:60,f3:61,f4:62,f5:63,f6:64,f7:65,f8:66,f9:67,f10:68,f11:87,f12:88,numlock:69,scrolllock:70,add:78};this.sendSingleKey=function(n,f){var A=b[f.toLowerCase()];A?l.writeScancode(n,A):(A=f.length,0!=A&&(1==A?l.writeKeyCode(n,f.toUpperCase().charCodeAt(0)):n&&l.writeText(f)))};var c=null,e=0,d=null;this.sendKeyComb=function(n,f,A){if(Ka){n=n.split("+");var B=n.length,G;if(0!=B){var S=null,C=[];for(G=0;G<B;G++){var v=n[G];""==
v&&""==S&&(v="Add");""!=v&&C.push({key:v,down:!0});S=v}B=C.length;for(G=B-1;0<=G;G--)C.push({key:C[G].key,down:!1});if(f)c=C,e=f,d=A,a();else for(G=0,B=C.length;G<B;G++)sb.sendSingleKey(C[G].down,C[G].key)}}};this.sendText=function(n,f,A){for(var B=[],G=0,S=n.length;G<S;G++)B.push({"char":n.charAt(G)});c=B;e=f;d=A;a()}};this.writeKeyComb=function(a,b,c){Ka&&sb.sendKeyComb(a,b,c)};this.writeText=function(a,b,c){if(Ka)if(b)sb.sendText(a,b,c);else for(b=0,c=a.length;b<c;b++)$b(a.charAt(b))};this.writeClipboard=
function(a,b){a&&(b||(b="text/plain"),l.writeRawInput("880"+b+"\t"+a.hashCode()),rb={type:b,text:a})};var L=new function(a,b){function c(){function d(C){for(;0<C.ownerWinid;){var v=G.getWinById(C.ownerWinid);if(v&&v.isVisible())C=v;else break}return C}function n(C){for(var v="";C;)C.titleInfo&&(v=C.titleInfo),C=G.getWinById(C.ownerWinid);return v}var f=[],A=[],B=0,G=this;this.mainWin=null;this.appId="";var S=0;this.getActiveWinId=function(){return S};this.setActiveWinId=function(C,v){svGlobal.logger.info("setActiveWinId: "+
C+" old: "+S+" max: "+v);if(S!=C){var q=0==S;S=C;(C=G.getMainByWinId(C))&&C.isMainWin()&&G.mainWin!=C&&(G.mainWin=C);q&&v&&(v=L.getFocused())&&(v=v.getFreeSpace(),C=v.width,l.resetSize(C,v.height))}};this.onchange=function(C){C.isVisible()||C!=G.mainWin?C.isVisible()&&!G.mainWin&&C.isMainWin()&&(G.mainWin=C,3==a.windowState&&C.exeCommand(61488)):G.mainWin=null};this.addWin=function(C){for(var v=f.length,q=!1,h=0;h<v;h++)if(C.id==f[h].id){f[h]=C;q=!0;break}q||f.push(C);1==f.length&&(B=Date.now());
v=C.isMainWin();svGlobal.logger.info("is mainwin:"+v+" id:"+C.id);v&&!G.mainWin&&(G.mainWin=C)};this.popWins=function(C){C=G.getWinById(C);var v=[];if(C){C=0<C.ownerWinid?C.ownerWinid:C.id;for(var q=f.length-1;0<=q;q--)if(f[q].ownerWinid==C||f[q].id==C)v.push(f[q]),f.splice(q,1)}return v};this.hasApp=function(C){return-1!=A.indexOf(C)};this.addApp=function(C){return-1==A.indexOf(C)?(A.push(C),!0):!1};this.isNew=function(){return 3E4>Date.now()-B};this.getAll=function(){return f};this.hasWin=function(C){return 0<=
f.indexOf(C)};this.close=function(){for(var C=0,v=f.length;C<v;C++)f[C].close()};this.clear=function(){f.length=0};this.delWin=function(C){for(var v=0,q=f.length;v<q;v++)if(f[v].id==C)return f.splice(v,1),v;return-1};this.isRunning=function(){var C=f.length;if(1>C)return!1;var v=0;for(C=f.length;v<C;v++){var q=f[v];if(q.showState)return!0}return!1};this.getWinById=function(C){var v=f.length;if(1>v)return null;for(var q=0;q<v;q++){var h=f[q];if(h.id==C)return h}return null};this.getMainWinByAppId=
function(C){var v=null,q=0;for(len=f.length;q<len;){v=f[q];if(v.appId==C&&v.isVisible()&&1>v.ownerWinid)break;q++}return v};this.getTopWin=function(C){var v=null,q,h=C.length;for(q=0;q<h&&(!(v=G.getWinById(C[q]))||!v.isVisible());q++)v=null;if(!v)for(svGlobal.logger.warn("No win found"),h=f.length,q=h-1;0<=q&&(v=f[q],!v.isVisible());q--)v=null;return v};this.getMain=function(C){return(C=G.getTopWin(C))?d(C):null};this.getMainByWinId=function(C){return(C=G.getWinById(C))?d(C):null};this.getOtherApps=
function(C,v,q){var h=f.length;if(0!=h&&f[h-1])if(h=f[h-1].appId,q||!h)setTimeout(function(){G.getOtherApps(C,v)},q||3E3);else{q=[];if(h=G.getTopWin(C)){var r=0<h.ownerWinid?h.ownerWinid:h.id,H=[],F=0;for(h=f.length;F<h;F++)f[F].ownerWinid!=r&&f[F].id!=r&&f[F].isVisible()&&H.push(f[F]);F=0;for(h=H.length;F<h;F++)H[F].ownerWinid!=r&&H[F].id!=r&&(q.push({title:n(H[F]),win:d(H[F])}),r=0<H[F].ownerWinid?H[F].ownerWinid:H[F].id)}v(q)}};this.getFullTitle=function(C){for(var v,q="";;){v=G.getWinById(C);
if(!v)break;v.titleInfo&&v.isVisible()&&(q&&(q=" > "+q),q=v.titleInfo+q);if(1>C)break;C=v.ownerWinid}return q}}var e=[];this.tryCloseRemoteApps=function(){if(a&&a.isRemoteApp())for(var d=e.length,n=0;n<d;n++)e[n].railWin&&e[n].railWin.close()};this.verifyMonitors=function(){for(var d=e.length,n=Array(d),f=0;f<d;f++)e[f].configMonitor(),n[f]=e[f].getMousePosition();n.sort(function(G,S){var C=G.left-S.left;return 0!=C?C:G.top-S.top});var A=n.findIndex(function(G){return 0==G.left&&0==G.top});svGlobal.logger.info("monitor layout",
n,A);-1==A&&(l.showMessage("* Primary monitor not found. Please make your browser window full screen."),svGlobal.logger.warn("Primary monitor not found (left=top=0)",n));for(f=A-1;0<=f;){if(n[f].right<n[f+1].left){var B=n[f+1].left-n[f].right-1;0<B&&(n[f].right+=B,n[f].left+=B)}n[f].bottom<n[f+1].top&&(B=n[f+1].top-n[f].bottom-1,0<B&&(n[f].top+=B,n[f].bottom+=B));f--}for(f=A+1;f<d;)n[f-1].right<n[f].left&&(B=n[f].left-n[f-1].right-1,0<B&&(n[f].right-=B,n[f].left-=B)),n[f-1].bottom<n[f].top&&(B=n[f].top-
n[f-1].bottom-1,0<B&&(n[f].top-=B,n[f].bottom-=B)),f++};this.repaint=function(d,n,f,A){for(var B=0,G=e.length;B<G;B++)e[B].repaint(d,n,f,A)};this.size=function(){return e.length};this.getSurface=function(d){return e[d]};this.addSurface=function(d){e.push(d)};this.hasSurface=function(d){for(var n=e.length,f=0;f<n;f++)if(e[f].equals(d))return!0;return!1};this.fromSyncedSurface=function(d){var n=e.length;Date.now();for(var f=0;f<n;f++)if(e[f].isClipSynced(d))return!0;return!1};this.setSize=function(d,
n,f){for(var A=0,B=e.length;A<B;A++)e[A].setSize(d,n,f)};this.zOrders=[];this.drawLicense=function(d){for(var n=0,f=e.length;n<f;n++)e[n].drawLicense(d)};this.setReadOnly=function(d,n){for(var f=0,A=e.length;f<A;f++)e[f].setReadOnly(d,n)};this.setVisible=function(d,n){svGlobal.logger.info("TODO: setVisible")};this.setCursor=function(d){for(var n=0,f=e.length;n<f;n++)e[n]&&e[n].setCursor(d)};this.hide=function(d){d=0;for(var n=e.length;d<n;d++)e[d]&&e[d].hide()};this.execute=function(d,n){for(var f=
0,A=e.length;f<A;f++)e[f][d].apply(e[f],n)};this.addWin=function(d){var n=this.getFocused();n||(svGlobal.logger.warn("Focused surface not found!"),n=e[e.length-1]);n?(Ja=!0,n.railWin||(n.railWin=new c,n.onunload=function(){hi5.appcfg.closeRemoteApp&&n.railWin&&n.railWin.close();n.remoteApp&&n.remoteApp.close();n.railWin&&(n.railWin.clear(),n.railWin=null);e.removeElm(n)}),n.context&&b.setContext(n.context),n.railWin.addWin(d),n.railWin.mainWin==d&&(setTimeout(function(){var f=n.getFreeSpace();a.writeRawInput("8C661441\t"+
f.width+"\t"+f.height);svGlobal.logger.info("-- main win dp change:"+f.height);3==a.windowState?d.resizable()&&setTimeout(function(){d.exeCommand(61488);svGlobal.logger.info("-- max")},50):5==a.windowState&&3==d.showState&&setTimeout(function(){d.exeCommand(3856);svGlobal.logger.info("-- restor")},50)},111),Ca.sendKeyboardSyncFlags(Ca.localLockFlags,500)),hi5.browser.isIE&&n.focus()):svGlobal.logger.warn("No surface available!")};this.delWin=function(d){for(var n,f=e.length-1;0<=f;f--){var A=e[f];
n=A.railWin;var B=n.getWinById(d),G=B&&B.appId&&-1!=B.appId.toLowerCase().indexOf("runonce");if(0<=n.delWin(d)){B==n.mainWin&&(n.mainWin=null);if(A.toolbar){d="win"+d;var S=A.toolbar.querySelector("#"+d);S&&A.toolbar.removeChild(S)}if(!n.isRunning()&&0==l.mode){if(B.isMainWin()&&A.onremoteappclose)A.onremoteappclose(B);B=a.appTimeout;if(G||n.isNew())B*=10;svGlobal.logger.debug("Prepare del:"+Date.now());setTimeout(function(C){return function(){svGlobal.logger.info("Start del:"+Date.now());C.railWin&&
C.railWin.isRunning()||(C.remoteApp&&C.remoteApp.close(),L&&L.delSurface(C))}}(A),B)}}}};this.popWins=function(d){return e[0]&&e[0].railWin?e[0].railWin.popWins(d):[]};this.getWinById=function(d){for(var n,f=0,A=e.length;f<A;f++)if(e[f]&&e[f].railWin&&(n=e[f].railWin.getWinById(d)))return n;return null};this.getMainWinByAppId=function(d){for(var n,f=0,A=e.length;f<A;f++)if(e[f].railWin&&(n=e[f].railWin.getMainWinByAppId(d)))return n;return null};this.onWinChange=function(d){for(var n,f=0,A=e.length;f<
A;f++)if(e[f].railWin&&(n=e[f].railWin.getWinById(d.id)))e[f].railWin.onchange(d)};this.setTitle=function(d){for(var n,f=0,A=e.length;f<A;f++)if(e[f].railWin){n=e[f].railWin.getWinById(d);var B=e[f].railWin.getFullTitle(d);if(B){a.changeTitle(B,e[f].getWindow(),n.appId);break}}};this.hasApp=function(d){for(var n=0,f=e.length;n<f;n++)if(e[n].railWin.hasApp(d))return!0;return!1};this.delSurface=function(d){!d||d.railWin&&d.railWin.isRunning()||(svGlobal.logger.info("delete surface..."),e.removeElm(d),
d.close(),0==e.length&&a._unload())};this.getOwnerSurface=function(d){for(var n=0,f=e.length;n<f;n++)if(e[n].railWin&&e[n].railWin.hasWin(d))return e[n];return null};this.getOwnerSurfaceById=function(d){for(var n,f=0,A=e.length;f<A;f++)if(e[f].railWin&&(n=e[f].railWin.getWinById(d)))return e[f];return null};this.getFocused=function(){for(var d=e.length,n=0;n<d;n++)if(e[n].focused)return e[n];return e[d-1]};this.close=function(){for(var d=0,n=e.length;d<n;d++)e[d]&&(e[d].remoteApp&&e[d].remoteApp.close(),
e[d].close(),e[d]=null)};this.LocalWin=function(d){function n(){a.writeRawInput("8C0"+d)}this.id=d;this.appId="";var f=this;this.resizable=function(){return f.isVisible?0!=(f.style&262144)||0!=(f.style&65536)||0!=(f.style&16777216)||3==f.showState:!1};this.setShowState=function(A){f.showState=A};this.parent=function(){return L.getWinById(f.ownerWinid)};this.resize=function(A,B,G,S){svGlobal.logger.info("www resize, l "+A+" w "+G);hi5.appcfg.disableJoinedAppResize&&2==a.mode||a.writeRawInput("8C1"+
f.id+"\t"+A+"\t"+B+"\t"+G+"\t"+S)};this.exeCommand=function(A){svGlobal.logger.info("www exeCommand, cmd "+A);a.writeRawInput("8C4"+d+"\t"+A)};this.activate=function(A){svGlobal.logger.info("www activate, enable "+A+" id:"+d);2==f.showState?(f.exeCommand(61728),setTimeout(function(){a.writeRawInput("8C3"+d+"\t"+A)},50)):a.writeRawInput("8C3"+d+"\t"+A)};this.close=function(){svGlobal.logger.info("www close");f.exeCommand(61536)};this.getAppId=n;this.isVisible=function(){return f.winWidth&&f.winHeight&&
f.showState&&45<f.winHeight&&45<f.winWidth};this.isMainWin=function(){if(!(f.isVisible()&&f.winWidth&&f.winHeight&&45<f.winHeight&&45<f.winWidth))return!1;var A=1>f.ownerWinid;if(!A)return A;var B=f.style;if(0!=(B&4194304))return!0;if(0!=(B&2147483648)&&(0==(B&8388608)||0==(B&12582912)))return!1;var G=0!=(f.extStyle&128);(A=A&&!G)&&0!=(B&2147483648)&&0==(B&2156396544)&&(A=!1);return A};n()}}(l,Y);this.getSurfaces=function(){return L};this.hide=function(){L&&L.hide()};this.getFileUrl=function(a,b,
c){var e=Qa(),d=vc,n=d.indexOf("://");e=(0<n&&11>n?d:e+d)+"s="+Vb+"&f="+encodeURIComponent(a);b&&(e+="&src="+b);c&&(e+="&action="+c);return l.modifyURL(e)};this.listFiles=function(a,b){wa&&Ka&&wa.list(a,b)};this.writeRawInput=function(a){if(Ka){ha(a);if(l.onactivity)l.onactivity(a);return!0}return!1};this.authWithCode=function(a,b){var c=a.length,e=new Uint8Array(5+c);e[0]=146;e[1]=7;e[2]=b;e[3]=c&255;e[4]=c>>8&255;for(b=0;b<c;b++)e[5+b]=a.charCodeAt(b);ha(e.buffer)};var yc=0;if(M.numLock||M.numlock||
da(D.numLock)||hi5.browser.isMacOS||hi5.browser.isiOS||hi5.browser.isCrOS)yc|=2;var Ca=new function(a,b,c,e){this.setJoinMode=a.setJoinMode;this.requestControl=a.requestControl;this.writeKeyComb=a.writeKeyComb;this.writeText=a.writeText;this.localLockFlags=e||0;this.remoteLockFlags=0;this.checkLockFlags=!0;this.reqCopyTime=0;this.draw=c.draw;var d=a.isRemoteApp(),n=void 0;this.saveResize=function(f){n=a.reconnectOnResize;a.reconnectOnResize=f};this.restoreResize=function(){void 0!=n&&(a.reconnectOnResize=
n)};this.refresh=function(f,A,B,G){return c.repaint(f,A,B-f+1,G-A+1)};this.getAppMode=function(){return a.mode};this.getAgentStatus=function(){return a.getAgentStatus()};this.send=a.writeRawInput;this.saveSession=function(f){a.saveSession(f)};this.sendInput=a.writeRawInput;this.getAppInfo=function(){return a.sessionInfo.appInfo};this.resumeAudio=function(){xa.supportWebAudio&&xa.iOSFix()};this.onresize=function(f){if(f=f.target.svSurface){var A=f.getFreeSpace(),B=A.width;A=A.height;Ca.checkLockFlags=
!0;M.scale?f.scaleTo(B,A,!1):a.resetSize(B,A)}};this.onorientationchange=function(f){a.resetSize(f.innerWidth,f.innerHeight)};this.getClipData=function(f,A){this.reqCopyTime=Date.now();var B=a.getGatewayAddr(),G=wc,S=G.indexOf("://");B=(0<S&&11>S?G:B+G)+"s="+a.sessionInfo.appInfo.session+"&t="+Date.now()+"&type="+f;f=hi5.httpGet(a.modifyURL(B),A);this.reqCopyTime=Date.now();qc(f);return f};this.onfocus=function(f){var A=L.getFocused();d&&A&&A.railWin&&(f=A.railWin.mainWin)&&a.running()&&(A=A.context)&&
A!=c.getContext()&&(c.setContext(null),f.activate(1),svGlobal.logger.info("Activate win:"+f.id))};this.getShareFiles=a.listFiles;this.getFile=function(f,A,B){a.reconnectOnResize=!1;var G=a.getFileUrl(f,A,B);l.ondownload&&l.ondownload({fileName:f,url:G,source:A,action:B})||window.open(G)};this.getFileLink=a.getFileUrl;this.getGateway=function(){return w};this.reconnect=function(f,A,B){D.symlink?(f="user="+f+"&pwd="+A,B&&(f+="&domain="+B),w=hi5.tool.replaceQuery(w,"parameters",f)):(w=hi5.tool.replaceQuery(w,
"user",f),w=hi5.tool.replaceQuery(w,"pwd",A),w=hi5.tool.replaceQuery(w,"domain",B));a.run()};this.sendKeyboardSyncFlags=function(f,A){return Ka?(this.remoteLockFlags=this.localLockFlags=f,setTimeout(function(){a.writeRawInput("8E5"+f)},A||333),!0):!1};this.sendKeyboardSynchronize=function(f,A,B){var G=0;B&&(G|=4);A&&(G|=2);f&&(G|=1);this.sendKeyboardSyncFlags(G)};this.fromSyncedSurface=function(f){return b.fromSyncedSurface(f)};this.setWorkDir=function(f){a.writeKeyComb("Windows+R",20,function(){setTimeout(function(){a.writeText(f,
10,function(){a.writeScancode(!0,28);a.writeScancode(!1,28)})},666)})};this.authWithCode=function(f,A){a.authWithCode(f,A)};this.getPrinters=function(f){a.getPrinters(f)};this.attachPrinter=function(f){a.attachPrinter(f)}}(l,L,Y,yc);this.sendKeyboardSynchronize=function(a,b,c){Ca.sendKeyboardSynchronize(a,b,c)};this.VirtualChannel=function(){return new Ib(143)};this.GatewayChannel=function(){return new Ib(28)};this.DynamicChannel=function(){return new Ib(64)};this.addChannel=function(a){eb[a.name]=
a};this.addGatewayChannel=function(a){cb[a.name]=a};this.addDynamicChannel=function(a){la.names.push(a.name);la[a.name]=a;la.count++};var Da=null,la={count:0,names:[],usbChannel:null,close:function(){for(var a=la.names,b=0,c=a.length;b<c;b++)la[a[b]].onclose&&(la[a[b]].onclose(),la[a[b]]=null);a.length=0;la.usbChannel=null},init:function(a,b,c,e,d,n){function f(){this.WAVE_FORMAT_PCM=1;this.WAVE_FORMAT_ADPCM=2;this.WAVE_FORMAT_ALAW=6;this.WAVE_FORMAT_MULAW=7;this.WAVE_FORMAT_GSM=49;this.WAVE_FORMAT_MPEGLAYER3=
85;this.WAVE_FORMAT_AAC=41222;this.cbSize=this.bitsPerSample=this.nBlockAlign=this.nAvgBytesPerSec=this.nSamplesPerSec=this.nChannels=this.formatTag=0;this.extenstion=null;var v=this;this.fromBuffer=function(q,h){v.formatTag=q.getLittleEndian16();v.nChannels=q.getLittleEndian16();v.nSamplesPerSec=q.getLittleEndian32();v.nAvgBytesPerSec=q.getLittleEndian32();v.nBlockAlign=q.getLittleEndian16();v.bitsPerSample=q.getLittleEndian16();var r=q.getLittleEndian16();v.cbSize=r;0<r&&!0!==h&&(v.extenstion=Array(r),
q.copyToByteArray(v.extenstion,0,q.getPosition(),r),q.skipPosition(r))};this.toBuffer=function(q){q.setLittleEndian16(v.formatTag);q.setLittleEndian16(v.nChannels);q.setLittleEndian32(v.nSamplesPerSec);q.setLittleEndian32(v.nAvgBytesPerSec);q.setLittleEndian16(v.nBlockAlign);q.setLittleEndian16(v.bitsPerSample);q.setLittleEndian16(v.cbSize);0<v.cbSize&&q.setBytes(v.extenstion)};this.getSize=function(){return 18+v.cbSize};this.toString=function(){return"Audio Format, tag="+v.formatTag+" nChannels="+
v.nChannels+" nSamplesPerSec="+v.nSamplesPerSec+" nAvgBytesPerSec="+v.nAvgBytesPerSec+" nBlockAlign="+v.nBlockAlign+" bitsPerSample="+v.bitsPerSample+" cbSize="+v.cbSize}}function A(){Da=new l.DynamicChannel;Da.name="Microsoft::Windows::RDS::DisplayControl";Da.enabled=!1;Da.process=function(v){var q=v.getLittleEndian32();v.getLittleEndian32();switch(q){case 5:q=v.getLittleEndian32(),Da.maxMonitorAreaFactorA=v.getLittleEndian32(),Da.maxMonitorAreaFactorB=v.getLittleEndian32(),Da.enabled=!0,svGlobal.logger.warn("Display control maxNumMonitors:"+
q+" factorA:"+Da.maxMonitorAreaFactorA+" factorB:"+Da.maxMonitorAreaFactorB),v=new Uint8Array(2),v[0]=146,v[1]=4,ha(v.buffer),Ba&&setTimeout(function(){Ba&&Ba.check(5E3)},1900)}};Da.applyResolution=function(v,q){if(Da.enabled){var h=new Uint8Array(56),r=new RdpBuffer(h,0,56);v=v>Da.maxMonitorAreaFactorA?Da.maxMonitorAreaFactorA:v&-4;q=q>Da.maxMonitorAreaFactorB?Da.maxMonitorAreaFactorB:q&-4;r.setLittleEndian32(2);r.setLittleEndian32(56);r.setLittleEndian32(40);r.setLittleEndian32(1);r.setLittleEndian32(1);
r.setLittleEndian32(0);r.setLittleEndian32(0);r.setLittleEndian32(v);r.setLittleEndian32(q);r.setLittleEndian32(.26458*v|0);r.setLittleEndian32(.26458*q|0);r.setLittleEndian32(v>q?0:90);r.setLittleEndian32(100);r.setLittleEndian32(100);Da.send(h);svGlobal.logger.warn("Display control: "+v+"x"+q)}else svGlobal.logger.warn("Display control disabled.")};return Da}if(!M.disableDVC){if(M.enableEcho){var B=new l.DynamicChannel;B.name="ECHO";B.process=function(v){var q=v.getPosition(),h=v.getEnd(),r=new Uint8Array(h-
q);r.set(v.getData().subarray(q,h));B.send(r)};l.addDynamicChannel(B)}if(a){var G=new l.DynamicChannel;G.name="Microsoft::Windows::RDS::Input";G.process=function(v){var q=v.getLittleEndian16();v.getLittleEndian32();switch(q){case 1:v.skipPosition(4),v=new RdpBuffer(new Uint8Array(16),0,16),v.setLittleEndian16(2),v.setLittleEndian32(16),v.setLittleEndian32(3),v.setLittleEndian32(65536),v.setLittleEndian16(256),v.markEnd(),G.send(v);case 5:L.execute("setTouchRemoting",[!0]);la.isTouchReady=!0;svGlobal.logger.info("Touch remoting start");
break;case 4:L.execute("setTouchRemoting",[!1]),la.isTouchReady=!1,svGlobal.logger.info("Touch remoting suspend")}};l.addDynamicChannel(G)}b&&(a=Pc(l,Y),l.addDynamicChannel(a));if(c){svGlobal.logger.warn("Audio input on");var S=new l.DynamicChannel;(function(){function v(Q){var ba=new RdpBuffer(new Uint8Array(5),0,5);ba.setByte(7);ba.setLittleEndian32(Q);ba.markEnd();S.send(ba)}function q(Q){var ba=Q.getLittleEndian32(),ma=Q.getLittleEndian32(),ea=new f;ea.fromBuffer(Q,!0);var Aa=0,Na=0;0<ea.cbSize&&
(22==ea.cbSize?(Aa=Q.getLittleEndian16(),Na=Q.getLittleEndian32(),Q.skipPosition(16)):(svGlobal.logger.warn("Wrong cbsize: "+ea.cbSize),Q.skipPosition(ea.cbSize)));Q=r[ma];svGlobal.logger.info("Selceted rec fmt, framesPerPacket: "+ba+" initial: "+ma+", "+Q.toString());svGlobal.logger.info("Open fmt: "+ea.toString()+" validBits:"+Aa+" mask:"+Na);F=!0;K=l.reconnectOnResize;l.reconnectOnResize=!1;ca.onopen||(ca.onopen=function(ya){if(sa){h=ya;l.reconnectOnResize=K;v(ma);var pa=new RdpBuffer(new Uint8Array(5),
0,5);pa.setByte(4);pa.setLittleEndian32(ya?0:1);pa.markEnd();S.send(pa)}});ca.ondata||(ca.ondata=function(ya,pa){h&&(J.length!=pa+1&&(J=new Uint8Array(pa+1),J[0]=6),S.send(H),J.set(ya,1),S.send(J))});ca.start(Q,ba)}S.name="AUDIO_INPUT";S.process=function(Q){var ba=Q.getByte();switch(ba){case 1:Q=Q.getLittleEndian32();ba=new RdpBuffer(new Uint8Array(5),0,5);ba.setByte(1);ba.setLittleEndian32(Q);ba.markEnd();S.send(ba);break;case 2:var ma=Q.getLittleEndian32();Q.getLittleEndian32();var ea=xa.getContext().sampleRate;
for(ba=r.length=0;ba<ma;ba++){var Aa=new f;Aa.fromBuffer(Q);svGlobal.logger.info("Server rec fmt "+ba+":"+Aa.toString());0==e&&49==Aa.formatTag&&22050==Aa.nSamplesPerSec?r.push(Aa):1==Aa.formatTag&&Aa.nSamplesPerSec<=ea&&r.push(Aa)}S.send(H);ma=0;Q=r.length;for(ba=0;ba<Q;ba++)ma+=r[ba].getSize();ea=new RdpBuffer(new Uint8Array(1024),0,1024);ea.setByte(2);ea.setLittleEndian32(Q);ea.setLittleEndian32(ma+9);for(ba=0;ba<Q;ba++)r[ba].toBuffer(ea),svGlobal.logger.info("Client rec fmt: "+r[ba].toString());
ea.skipPosition(1024-ma-9);ea.markEnd();S.send(ea);break;case 3:q(Q);break;case 7:ba=Q.getLittleEndian32();svGlobal.logger.info("Rec fmt change, "+r[ba].toString()+" by client:"+F);F||(v(ba),F=!1);break;default:svGlobal.logger.warn("audioInput: invalid tag:"+ba)}};var h=!1,r=[];S.onclose=function(){h=!1;ca&&ca.close()};var H=new Uint8Array(1);H[0]=5;var F=!1,K=l.reconnectOnResize,J=new Uint8Array(0),X=P("audiorecorder",hi5.libMin?"audiorecorder_min.js?v=0":"audiorecorder.js?v=0"),ca=window.AudioWorkletNode?
new hi5.audio.WorkletRecorder(xa.getContext(),X):new hi5.audio.Recorder(xa.getContext())})();l.addDynamicChannel(S)}l.addDynamicChannel(function(){var v=new l.DynamicChannel;v.name="TSMF";var q={type:"image/jpeg"},h=Array(1);v.process=function(r){r.getPosition();var H=r.getLittleEndian32()&1073741823;var F=r.getLittleEndian32();var K=r.getLittleEndian32();switch(H){case 2:if(256==K){r.getLittleEndian32();K=new Uint8Array(16);var J=new RdpBuffer(K,0,16);J.setLittleEndian32(2);J.setLittleEndian32(F);
J.setLittleEndian32(1);J.setLittleEndian32(0);v.send(K)}break;case 0:switch(K){case 257:r.getBytes(16);r.getLittleEndian32();break;case 256:H=r.getPosition();J=r.getLittleEndian32();for(K=0;K<J;K++){r.getLittleEndian32();var X=r.getLittleEndian32();r.getLittleEndian32();r.skipPosition(X-4)}K=r.getPosition()-H;J=K+8+4;K=new Uint8Array(J);J=new RdpBuffer(K,0,J);J.setLittleEndian32(-2147483648);J.setLittleEndian32(F);K.set(r.getData().subarray(H,r.getPosition()),8);v.send(K);break;case 261:r.getBytes(16);
r.getLittleEndian32();break;case 264:H=r.getLittleEndian32();r.skipPosition(4);r.getLittleEndian32();X=r.getBytes(16);var ca=r.getBytes(16);r.getLittleEndian32();r.getLittleEndian32();r.getLittleEndian32();var Q=r.getBytes(16);K=r.getLittleEndian32();r.skipPosition(K);K=new Uint8Array(20);J=new RdpBuffer(K,0,20);J.setLittleEndian32(-2147483648);J.setLittleEndian32(F);hi5.Arrays.equals([118,105,100,115,0,0,16,0,128,0,0,170,0,56,155,113],X)&&hi5.Arrays.equals([77,74,80,71,0,0,16,0,128,0,0,170,0,56,
155,113],ca)&&hi5.Arrays.equals([128,159,88,5,86,195,206,17,191,1,0,170,0,85,89,90],Q)?J.setLittleEndian32(1):(J.setLittleEndian32(0),svGlobal.logger.warn("Format is not supported:"),svGlobal.logger.warn(X),svGlobal.logger.warn(ca),svGlobal.logger.warn(Q));J.setLittleEndian32(H);v.send(K);break;case 258:r.getBytes(16);r.getLittleEndian32();H=r.getLittleEndian32();r.skipPosition(H);break;case 263:r.getBytes(16),K=new Uint8Array(16),J=new RdpBuffer(K,0,16),J.setLittleEndian32(-2147483648),J.setLittleEndian32(F),
J.setLittleEndian32(1),v.send(K);case 277:r.getBytes(16);r.getLittleEndian32();break;case 262:r.getBytes(16);Y.flushImgs();Y.setImgRect(0,0,0,0);K=new Uint8Array(12);J=new RdpBuffer(K,0,12);J.setLittleEndian32(-2147483648);J.setLittleEndian32(F);v.send(K);break;case 278:r.getBytes(16);F=r.getLittleEndian32();K=r.getLittleEndian32();H=r.getLittleEndian32();r=r.getLittleEndian32();Y.setImgRect(F,K,H-F,r-K);break;case 265:r.getBytes(16);r.getLittleEndian64();r.getLittleEndian32();break;case 266:r.getBytes(16);
break;case 268:r.getBytes(16);break;case 267:r.getBytes(16);break;case 269:r.getBytes(16);r.getLittleEndian32();break;case 274:break;case 275:break;case 259:r.getBytes(16);r.getLittleEndian32();r.getLittleEndian32();r.skipPosition(32);K=r.getLittleEndian32();F=new Image;H=r.getPosition();h[0]=r.getData().subarray(H,H+K);r=new Blob(h,q);F.src=URL.createObjectURL(r);Y.addImg(F);break;case 270:Y.flushImgs();break;case 273:break;case 260:break;case 276:r.getBytes(16);K=r.getLittleEndian32();H=r.getPosition()+
K;r.skipPosition(8);F=r.getLittleEndian32();svGlobal.logger.info("window state:"+F);J=r.getLittleEndian32();X=r.getLittleEndian32();F=r.getLittleEndian32();K=r.getLittleEndian32();r.skipPosition(8);ca=r.getLittleEndian32();Q=r.getLittleEndian32();svGlobal.logger.info("Window rect, left:"+F+" top:"+K+" w:"+J+" h:"+X+" cl:"+ca+" ct:"+Q);r.setPosition(H);H=r.getLittleEndian32();for(H=r.getPosition()+H;r.getPosition()<H;){ca=r.getLittleEndian32();Q=r.getLittleEndian32();var ba=r.getLittleEndian32(),ma=
r.getLittleEndian32();svGlobal.logger.info("visible region, l:"+Q+" t:"+ca+" r:"+ma+" b:"+ba)}Y.setImgRect(F,K,J,X);break;case 1:case 2:break;default:svGlobal.logger.warn("unknown function:"+K)}break;default:svGlobal.logger.warn("unkown interface:"+H)}};return v}());Za||l.addDynamicChannel(A());M.enableDVCAudio&&l.addDynamicChannel(function(v){var q=!1,h=0,r=0,H=0,F=0,K=[],J=new Uint8Array(4),X=new l.DynamicChannel;X.name="AUDIO_PLAYBACK_DVC";X.onclose=function(){};X.process=function(ca){function Q(W){W.skipPosition(14);
var V=W.getLittleEndian16();W.getByte();var ra=W.getLittleEndian16();W.skipPosition(1);for(var Oa,Ia=K.length=0;Ia<V;Ia++){var La=new f;La.fromBuffer(W);(Oa=22050<=La.nSamplesPerSec&&(1==La.formatTag||49==La.formatTag&&22050==La.nSamplesPerSec&&0==v))&&K.push(La)}La=20;W=K.length;for(Ia=0;Ia<W;Ia++)La+=K[Ia].getSize();Ia=La+4;V=new RdpBuffer(new Uint8Array(Ia),0,Ia);V.setByte(7);V.setByte(2);V.setLittleEndian16(La);V.setLittleEndian32(3);V.setLittleEndian32(4294967295);V.setLittleEndian32(0);V.setLittleEndian16(0);
V.setLittleEndian16(W);V.skipPosition(1);V.setLittleEndian16(ra);V.setByte(124);for(Ia=0;Ia<W;Ia++)La=K[Ia],La.toBuffer(V);V.markEnd();X.send(V);5<ra&&(V=new RdpBuffer(new Uint8Array(8),0,8),V.setByte(12),V.skipPosition(1),V.setLittleEndian16(4),V.setLittleEndian16(0),V.setLittleEndian16(0),V.markEnd(),X.send(V))}function ba(W){var V=W.getLittleEndian16();W=W.getLittleEndian16();var ra=new RdpBuffer(new Uint8Array(8),0,8);ra.setByte(6);ra.setByte(35);ra.setLittleEndian16(4);ra.setLittleEndian16(V);
ra.setLittleEndian16(W);ra.markEnd();X.send(ra)}function ma(){var W=K[H];if(W.formatTag!=aa||W.nSamplesPerSec!=Ya||na!=W.nChannels)aa=W.formatTag,na=W.nChannels,Ya=W.nSamplesPerSec,db=49==W.formatTag?8:W.bitsPerSample}function ea(W){r=W.getLittleEndian16();H=W.getLittleEndian16();F=W.getByte();W.skipPosition(3);J[0]=W.getByte();J[1]=W.getByte();J[2]=W.getByte();J[3]=W.getByte();q=!0;ma()}function Aa(W,V){var ra=new RdpBuffer(new Uint8Array(8),0,8);ra.setByte(5);ra.skipPosition(1);ra.setLittleEndian16(4);
ra.setLittleEndian16(W);ra.setByte(V);ra.skipPosition(1);ra.markEnd();X.send(ra)}function Na(W){q=!1;var V=h-8,ra=Date.now();W.copyFromByteArray(J,0,W.getPosition(),4);W=Wb(W,F,r,V);W=1E3*(W-xa.delay);ra=r+(Date.now()-ra)+W;Aa(ra,F)}function ya(W){var V=Date.now();r=W.getLittleEndian16();H=W.getLittleEndian16();F=W.getByte();W.skipPosition(7);ma();W=Wb(W,F,r,0);W=1E3*(W-xa.delay);V=r+(Date.now()-V)+W;Aa(V,F)}if(q)Na(ca);else{var pa=ca.getByte();ca.skipPosition(1);h=ca.getLittleEndian16();switch(pa){case 7:Q(ca);
break;case 6:ba(ca);break;case 2:ea(ca);break;case 1:closed=!0;break;case 3:ca.getLittleEndian16();ca.getLittleEndian16();break;case 13:ya(ca)}}};return X}(e));svGlobal.DCVC_EXTENSION||(svGlobal.DCVC_EXTENSION={});var C=svGlobal.DCVC_EXTENSION;C.videoMedia={video:null,track:null,canvas:null,ctx:null,resolutions:null,minFrameRate:16,type:2,activate:function(v,q){svGlobal.logger.info("activate webcam");C.videoMedia.resolutions?v():hi5.video.resolutions(function(h){h.length?(C.videoMedia.resolutions=
h,v()):q()})},deactivate:function(){var v=C.videoMedia;v.track&&(v.track.stop(),v.track=null);v.ctx=null;v.canvas=null;v.video=null;svGlobal.logger.info("deactivate cam")},startStream:function(v,q,h,r,H){svGlobal.logger.info("startStream, width:"+v+" height:"+q+" frameRate:"+h);var F=C.videoMedia,K=F.track;if(K){var J=K.getSettings();if("live"==K.readyState)if(v!=J.width||q!=J.height||h!=J.frameRate&&2!=F.type)K.stop();else return}navigator.mediaDevices.getUserMedia({video:{frameRate:2==F.type?F.minFrameRate:
h,width:{exact:v},height:{exact:q}}}).then(function(X){var ca=document.createElement("video");ca.srcObject=X;ca.play();if(window.OffscreenCanvas)var Q=new OffscreenCanvas(100,100);else Q=document.createElement("canvas"),Q.style.position="absolute",Q.style.left=0,Q.style.top=0;F.track=X.getVideoTracks()[0];F.canvas=Q;F.ctx=Q.getContext("2d");F.video=ca;X=F.track.getSettings();F.canvas.width=X.width;F.canvas.height=X.height;r()}).catch(function(X){svGlobal.logger.warn(X);H()})},stopStream:function(){svGlobal.logger.info("stopStream");
var v=C.videoMedia;v.track&&"live"==v.track.readyState&&v.track.stop()},grabFrame:function(v){function q(r){r.arrayBuffer().then(v)}var h=C.videoMedia;h.ctx.drawImage(h.video,0,0);h=h.canvas;h.convertToBlob?h.convertToBlob({type:"image/jpeg",quality:.6}).then(q):h.toBlob(q,"image/jpeg",.6)},propertyList:[[{propertyId:1,capabilities:3,min:4294967286,max:4294967294,step:1,default:4294967291},null,{propertyId:3,capabilities:101,min:4294967280,max:16,step:1,default:0},{propertyId:4,capabilities:1,min:0,
max:3,step:1,default:0},{propertyId:5,capabilities:1,min:4294967280,max:16,step:1,default:0},{propertyId:6,capabilities:1,min:100,max:400,step:10,default:100}],[{propertyId:1,capabilities:1,min:0,max:2,step:1,default:1},{propertyId:2,capabilities:199,min:4294967232,max:64,step:1,default:0},{propertyId:3,capabilities:1,min:0,max:95,step:1,default:0},{propertyId:4,capabilities:1,min:4294965296,max:2E3,step:1,default:0},{propertyId:5,capabilities:67,min:2800,max:6500,step:1,default:4600}]]};C.WEBCAM=
function(v){var q=new v;q.name="RDCamera_Device_0";q.version=2;q.newInstance=function(){return C.WEBCAM(v)};q.onopen=function(){svGlobal.logger.info("cam open")};q.onclose=function(){svGlobal.logger.info("cam close")};q.sendSucess=function(){var h=new hi5.DataBuffer(new Uint8Array(2));h.setByte(q.version);h.setByte(1);h.markEnd();q.send(h)};q.sendError=function(h){var r=new hi5.DataBuffer(new Uint8Array(6));r.setByte(q.version);r.setByte(2);r.setLittleEndian32(h||1);r.markEnd();q.send(r)};q.sendSteamListResp=
function(){var h=new hi5.DataBuffer(new Uint8Array(7));h.setByte(q.version);h.setByte(10);h.setLittleEndian16(1);h.setByte(1);h.setByte(1);h.setByte(0);h.markEnd();q.send(h)};q.sendMediaTypeListResp=function(h){var r=C.videoMedia.resolutions,H=r.length,F=new hi5.DataBuffer(new Uint8Array(2+26*H));F.setByte(q.version);F.setByte(12);for(var K=1==h,J=0;J<H;J++){F.setByte(h);var X=r[J];F.setLittleEndian32(X.width);F.setLittleEndian32(X.height);F.setLittleEndian32(K?X.frameRate:C.videoMedia.minFrameRate);
F.setLittleEndian32(1);F.setLittleEndian32(1);F.setLittleEndian32(1);F.setByte(1)}F.markEnd();q.send(F)};q.sendCurrentMediaType=function(h,r){var H=new hi5.DataBuffer(new Uint8Array(28));H.setByte(q.version);H.setByte(14);r=C.videoMedia.resolutions[r];H.setByte(h);H.setLittleEndian32(r.width);H.setLittleEndian32(r.height);H.setLittleEndian32(1==h?r.frameRate:C.videoMedia.minFrameRate);H.setLittleEndian32(1);H.setLittleEndian32(1);H.setLittleEndian32(1);H.setByte(1);H.markEnd();q.send(H)};q.sendSampleResp=
function(h){C.videoMedia.grabFrame(function(r){var H=new hi5.DataBuffer(new Uint8Array(r.byteLength+3));H.setByte(q.version);H.setByte(18);H.setByte(h);H.setBytes(new Uint8Array(r));H.markEnd();q.send(H)})};q.sendPropertyListResp=function(){for(var h=0,r,H,F=C.videoMedia.propertyList,K=0;2>K;K++){H=F[K];r=H.length;for(var J=0;J<r;J++)null!=H[J]&&h++}h=new hi5.DataBuffer(new Uint8Array(2+19*h));h.setByte(q.version);h.setByte(21);for(K=0;2>K;K++)for(H=F[K],r=H.length,J=0;J<r;J++)null!=H[J]&&(h.setByte(K),
h.setByte(H.propertyId),h.setByte(H.capabilities),h.setLittleEndian32(H.min),h.setLittleEndian32(H.max),h.setLittleEndian32(H.step),h.setLittleEndian32(H.default));h.markEnd();q.send(h)};q.sendPropertyValueResp=function(h,r){(h=C.videoMedia.propertyList[h][r-1])?(r=new hi5.DataBuffer(new Uint8Array(7)),r.setByte(q.version),r.setByte(23),r.setByte(1),r.setLittleEndian32(h.value||h.default),r.markEnd(),q.send(r)):q.sendError(8)};q.process=function(h){h.getByte();var r=h.getByte();switch(r){case 7:C.videoMedia.activate(q.sendSucess,
q.sendError);break;case 8:C.videoMedia.deactivate();q.sendSucess();break;case 9:q.sendSteamListResp();break;case 11:h=h.getByte();0!=h&&svGlobal.logger.warn("Invalid stream index: "+h);q.sendMediaTypeListResp(C.videoMedia.type);break;case 13:h=h.getByte();q.sendCurrentMediaType(C.videoMedia.type,h);break;case 15:h.getByte();r=h.getByte();if(r!=C.videoMedia.type){svGlobal.warn("Invalid video format req:"+r);q.sendError(6);break}r=h.getLittleEndian32();var H=h.getLittleEndian32();h=h.getLittleEndian32()/
h.getLittleEndian32();C.videoMedia.startStream(r,H,h,q.sendSucess,q.sendError);break;case 16:C.videoMedia.stopStream();q.sendSucess();break;case 17:h=h.getByte();0!=h&&svGlobal.logger.info("Invalid stream index for SampleRequest: "+h);q.sendSampleResp(h);break;case 20:q.sendPropertyListResp();break;case 22:r=h.getByte();h=h.getByte();q.sendPropertyValueResp(r,h);break;case 24:q.sendError(10);break;default:q.sendError(10),svGlobal.logger.warn("Invalid cam msg: "+r)}};return q};C.WEBCAM_ENUM=function(v,
q){var h=new v;h.name="RDCamera_Device_Enumerator";h.onopen=function(){var r=new hi5.DataBuffer(new Uint8Array(2));r.setByte(q.version);r.setByte(3);r.markEnd();h.send(r);svGlobal.logger.info("camEnum open")};h.onclose=function(){svGlobal.logger.info("camEnum closed");C.videoMedia.deactivate()};h.addDevice=function(r){r+="\x00";var H=q.name+"\x00",F=new hi5.DataBuffer(new Uint8Array(2+2*r.length+H.length));F.setByte(q.version);F.setByte(5);F.setUnicodeString(r);F.setAscllString(H);F.markEnd();h.send(F)};
h.process=function(r){var H=r.getByte();r=r.getByte();switch(r){case 4:svGlobal.logger.info("camEnum ver resp: "+H);q.version=H;h.addDevice(hi5.video.webcam&&hi5.video.webcam.label||"Web Camera");break;default:svGlobal.logger.warn("invalid messageId on camEnum: "+r)}};return h};d&&(c=C.WEBCAM(l.DynamicChannel),d=C.WEBCAM_ENUM(l.DynamicChannel,c),l.addDynamicChannel(d),l.addDynamicChannel(c));n&&(svGlobal.logger.info("Mapping USB..."),l.addDynamicChannel(la.usbChannel))}}},Ta=null;svGlobal.DCVC_EXTENSION&&
!Za&&(l.hasUSB()&&svGlobal.DCVC_EXTENSION.WEBUSB&&(la.usbChannel=svGlobal.DCVC_EXTENSION.WEBUSB(l.DynamicChannel)),svGlobal.DCVC_EXTENSION.DRIVE&&(Ta=svGlobal.DCVC_EXTENSION.DRIVE(l.GatewayChannel),l.addGatewayChannel(Ta)));this.getPrinters=function(a){if(!l.onagentmessage||!Ta)return null;var b=new hi5.DataBuffer(new Uint8Array(2));b.setByte(6);b.setByte(1);b.markEnd();l.onagentmessage(b.getData());Ta.listCallback=a};this.attachPrinter=function(a){Ta&&Ta.attachPrinter(a,l)};this.showError=tb;this.resetStatus=
Kb;this.exeAppCmd=function(a){var b=L.getFocused();b&&b.exeCommand(a)};this.activateApp=function(a){var b;(b=hi5.tool.isNumber(a)?L.getWinById(a):L.getMainWinByAppId(a))?b.activate(1):svGlobal.logger.warn("No window found in "+a)};this.reconnect=function(a,b,c){void 0==c&&(c=M.forceReconnect||!1);if(!sa&&!c)return!1;D.minWidth&&a<D.minWidth&&(a<D.minWidth&&svGlobal.logger.warn("Width "+a+" is samller than minWidth "+D.minWidth),a=D.minWidth);D.minHeight&&b<D.minHeight&&(b<D.minHeight&&svGlobal.logger.warn("Height "+
b+" is samller than minHeight "+D.minHeight),b=D.minHeight);a&=-4;b&=-4;if(!c&&4>Math.abs(a-ta)&&4>Math.abs(b-ua))return!1;if(Da&&Da.enabled&&!1!==M.displayVC)Da.applyResolution(a,b);else if(Xb&&gb||c||Ka&&!Xb)gb=!1,svGlobal.logger.info("reconnecting..."),ha("8E0"+a+"\t"+b),Ca&&(Ca.remoteLockFlags=0,Ca.checkLockFlags=!0);return!0};this.notify=function(a,b){a="8E6"+a;b&&(a+="\t"+b.join(";"));ha(a)};this.getUploadManager=function(){return wa};this.addSurface=function(a){if(!L.hasSurface(a)&&(xb||Y.setContext(a.context),
!L.hasSurface(a)||!a.railWin)){Za&&a.setPlayerMode();D.mouseMoveEmu&&(a.mouseMoveEmu=da(D.mouseMoveEmu));a.setSize(50,50,"hidden");var b=a.getFreeSpace();0==ta&&(ta=b.width);0==ua&&(ua=b.height);a.setConfig(M);L.addSurface(a);bb(ta,ua,!0,D.monitorDef?!0:!1);a.setController(Ca);a.setTouchpad(da(D.touchpad));var c=b=da(D.mapClipboard),e=b;void 0!=D.copyToLocal?c=da(D.copyToLocal):void 0!=M.copyToLocal&&(c=M.copyToLocal);void 0!=D.copyToRemote?e=da(D.copyToRemote):void 0!=M.copyToRemote&&(e=M.copyToRemote);
a.setClipboard(b,c,e);wb&&Lb(a);D.invitation&&!da(D.control)&&(L.setReadOnly(!0),b=hi5.$("requestControl"))&&(b.disabled=!1);b=void 0!=D.ctrlToWin?da(D.ctrlToWin):void 0!=M.ctrlToWin?M.ctrlToWin:!0;c=void 0!=D.cmdToCtrl?da(D.cmdToCtrl):void 0!=M.cmdToCtrl?M.cmdToCtrl:!0;a.run(parseInt(D.keyboard||1033,10),b,!!M.noKeyStuck,c)}};this.getRunninApps=this.getRunningApps=function(){for(var a=[],b=0,c=L.size();b<c;b++)L.getSurface(b).railWin.getMain(L.zOrders)&&a.push(L.getSurface(b).railWin.getMain(L.zOrders).titleInfo);
return a};this.startApp=function(a,b,c){b=b||"";c=c||"";ha("8C2"+a+"\t"+b+"\t"+c);var e=L.getSurface(L.size()-1);e&&(e.remoteApp=new ac(a,b,c))};this.startExitingApp=function(a){a=L.popWins(a);for(var b=a.length-1;0<=b;b--)L.addWin(a[b])};var lb=new l.DynamicChannel;lb.name="PNPDR";lb.onopen=function(){svGlobal.logger.info("PNPDR DVC onopen()")};lb.process=function(a){a.getLittleEndian32();var b=a.getLittleEndian32();switch(b){case 101:a.getLittleEndian32(),a.getLittleEndian32(),a.getLittleEndian32(),
a=new RdpBuffer(new Uint8Array(20),0,20),a.setLittleEndian32(20),a.setLittleEndian32(b),a.setLittleEndian32(1),a.setLittleEndian32(5),a.setLittleEndian32(1),lb.send(a)}};lb.onclose=function(){svGlobal.logger.info("PNPDR DVC onclose()")};l.addDynamicChannel(lb);var ab=null;da(D.scanner)&&(ab=new l.DynamicChannel,ab.name="SCANNERDVC",ab.onopen=function(){svGlobal.logger.info("scanner DVC onopen().")},ab.process=function(a){var b=a.getByte();switch(b){case 0:var c=a.getByte(),e=a.getByte();b=new Uint8Array(10);
b[0]=4;b[1]=7;b[2]=c;b[3]=e;b.set(a.getBytes(2),4);b.set(a.getBytes(2),6);b.set(a.getBytes(2),8);if(l.onagentmessage)l.onagentmessage(b);break;case 1:break;case 2:c=a.getEnd()-a.getPosition();b=new Uint8Array(c+2);b[0]=4;b[1]=3;b.set(a.getBytes(c),2);if(l.onagentmessage)l.onagentmessage(b);break;case 3:c=a.getEnd()-a.getPosition();b=new Uint8Array(c+3);b[0]=4;b[1]=9;b[2]=0;b.set(a.getBytes(c),3);if(l.onagentmessage)l.onagentmessage(b);break;default:svGlobal.logger.info('Warning: Unknown type "'+b+
'" received from DVC, ignored.')}},ab.onclose=function(){var a=new Uint8Array(2);a[0]=4;a[1]=4;if(l.onagentmessage)l.onagentmessage(a)},l.addDynamicChannel(ab));var Pa=null;l.hasSmartCard()&&(Pa=new l.GatewayChannel,Pa.name="SCARDSTB",Pa.onopen=function(){var a=new Uint8Array(2);a[0]=3;a[1]=1;if(l.onagentmessage)l.onagentmessage(a);da(D.passwordIsPin)&&l.onagentmessage&&!hi5.browser.isMacOS&&hi5.notifications.notify({msg:__svi18n.info.scardAuth||"Smart card authentication in progress. Please wait...",
type:0,timeout:1E4})},Pa.process=function(a){var b=a.getEnd()-a.getPosition(),c=a.getByte(),e=a.getByte();switch(c){case 1:switch(e){case 1:c=new Uint8Array(2);c[0]=3;c[1]=7;if(l.onagentmessage)l.onagentmessage(c);break;case 3:a=a.getBytes(b-2);b=b+4+4+4;mb&&(b+=mb.length);Ua&&(b+=Ua.length);b=new hi5.DataBuffer(new Uint8Array(b));b.setByte(3);b.setByte(9);mb?(b.setLittleEndian32(mb.length),b.setBytes(mb)):b.setLittleEndian32(0);Ua?(b.setLittleEndian32(Ua.length),b.setBytes(Ua)):b.setLittleEndian32(0);
b.setLittleEndian32(a.length);b.setBytes(a);b.markEnd();if(l.onagentmessage)l.onagentmessage(b.getData());break;case 5:a=a.getBytes(b);c=new Uint8Array(b);c[0]=3;c[1]=11;c.set(a,2);if(l.onagentmessage)l.onagentmessage(c);break;case 2:case 4:break;default:svGlobal.logger.warn("Invalid smart card channel auth data received: unknown sub-type ["+a[1]+"].")}break;case 2:if(Pa)if(1==e){if(c=new Uint8Array(b),c[0]=3,c[1]=3,c.set(a.getBytes(b),2),l.onagentmessage)l.onagentmessage(c)}else svGlobal.logger.warn("Invalid smart card channel pcsc data received: unknown sub-type ["+
a[1]+"].");break;default:svGlobal.logger.warn("Invalid smart card channel data received: unknown type ["+a[0]+"].")}},Pa.onclose=function(){var a=new Uint8Array(2);a[0]=3;a[1]=4;if(l.onagentmessage)l.onagentmessage(a)},l.addGatewayChannel(Pa));M.detectNetwork&&(w+="&connectType=7",Ac());this.getNetworkResult=function(){return ub};this.getAgentLink=function(){var a=navigator.userAgentData?navigator.userAgentData.platform:navigator.platform||navigator.appVersion;return-1!=a.indexOf("Win")?"agent_setup.exe":
-1!=a.indexOf("macOS")||-1!=a.indexOf("Mac")?"agent_setup.pkg":""};var Mb=new Map,Nb=new Map;this.writeAgent=function(a){a.byteLength&&(a=new Uint8Array(a));switch(a[0]){case 3:if(Pa){var b=a.slice?new hi5.DataBuffer(a.slice(2,a.length)):new hi5.DataBuffer(a.subarray(2,a.length));switch(a[1]){case 1:case 4:case 5:case 6:case 7:case 9:case 11:break;case 2:break;case 3:a[0]=2;a[1]=1;Pa.send(a);break;case 8:Mb.clear();Nb.clear();a=b.getLittleEndian32();if(0!=a)a=b.getLittleEndian32(),b=b.getAscllString(a,
!1),hi5.notifications.notify({msg:b});else{var c=b.getLittleEndian32(),e=document.getElementById("scardSelection");e||(e=document.createElement("div"),e.id="scardSelection",e.className="appdlg",document.body.appendChild(e));if(e)if(0==c)e&&(e.innerHTML="<p>Error: Could not find any connected smart card. Please make check the connectivity and then refresh the page",b=new hi5.ui.Lightbox(e),b.onclose=function(){location.reload()},b.show());else{e.innerHTML=1<c?'<p><b>PLEASE SELECT A SMART CARD, ENTER YOUR CREDENTIAL AND CLICK "Continue".</b></p>':
'<p><b>PLEASE ENTER YOUR CREDENTIAL AND CLICK "Continue".</b></p>';for(a=0;a<c;a++){var d=b.getLittleEndian32();d=b.getBytes(d);var n=b.getLittleEndian32();n=b.getAscllString(n,!1);var f=b.getLittleEndian32();f=b.getAscllString(f,!1);var A=b.getLittleEndian32();b.getAscllString(A,!1);A=b.getLittleEndian64();A=(new Date(1E3*A)).toDateString();d=Bc(a,d,f,n,A);e.appendChild(d)}e.innerHTML+="<br>";b=document.createElement("div");b.innerHTML+="Smart card credential: ";a=document.createElement("input");
a.type="text";a.id="userPin";a.placeholder="PIN";a.value="";a.required=!0;b.appendChild(a);e.appendChild(b);e.innerHTML+="<br>";b=new hi5.ui.LightboxWithBtn(e);b.onclose=function(){var B,G=document.querySelector('input[name="scard_name"]:checked');G&&(B=parseInt(G.value));mb=Mb.get(B);ib=Nb.get(B);B=document.getElementById("userPin").value;Ua=(new TextEncoder("utf-8")).encode(B);B=2;B=Ua?B+4+Ua.length:B+4;B=ib?B+4+ib.length:B+4;B=new Uint8Array(B);B=new hi5.DataBuffer(B);B.setByte(1);B.setByte(2);
Ua?(B.setLittleEndian32(Ua.length),B.setBytes(Ua)):B.setLittleEndian32(0);ib?(B.setLittleEndian32(ib.length),B.setAsciiString(ib,ib.length)):B.setLittleEndian32(0);Pa&&Pa.send(B)};document.getElementById("userPin").addEventListener("keypress",function(B){"Enter"===B.key&&(B.preventDefault(),document.getElementById("continue_button").click())});b.show()}}break;case 10:a=b.getLittleEndian32();0!=a?(a=b.getLittleEndian32(),b=b.getAscllString(a,!1),hi5.notifications.notify({msg:b})):(a=b.getLittleEndian32(),
a=b.getBytes(a),b=new Uint8Array(6+a.length),b=new hi5.DataBuffer(b),b.setByte(1),b.setByte(4),b.setLittleEndian32(a.length),b.setBytes(a),Pa.send(b));break;case 12:a[0]=1;a[1]=6;Pa.send(a);break;default:svGlobal.logger.warn("Warning: Unknown smart card response header: [3 / "+a[1]+"], ignored.")}}break;case 4:if(ab)switch(a[1]){case 2:b=a.slice?new hi5.DataBuffer(a.slice(2,a.length)):new hi5.DataBuffer(a.subarray(2,a.length));e=document.getElementById("dsSelection");e||(e=document.createElement("div"),
e.id="dsSelection",e.className="appdlg",document.body.appendChild(e));if(0!=b.getLittleEndian16())e&&(e.innerHTML="<p>Error on local: failed to get the list of connected scanners. Close to continue without scanning.</p>",b=new hi5.ui.Lightbox(e),b.onclose=function(){l.run()},b.show());else if(c=(a.byteLength-4)/41,0==c)e&&(e.innerHTML="<p>Error: Could not find any connected scanner. Please:<ul><li>Power on or connect the scanner and then refresh the page; or</li><li>Close this dialog to connect to the machine without using scanner.</li></ul></p>",
b=new hi5.ui.Lightbox(e),b.onclose=function(){l.run()},b.show());else if(1==c){if(b=new Uint8Array(3),b[0]=4,b[1]=5,b[2]=0,l.onagentmessage)l.onagentmessage(b)}else if(e){e.innerHTML='<p> Please choose a scanner &lt;DriverType: DeviceName&gt; and click "Continue".</a></p>';for(a=0;a<c;a++)d=b.getAscllString(41,!0),d=Cc(a,d),e.appendChild(d);e.innerHTML+="<br>";b=new hi5.ui.LightboxWithBtn(e);b.onclose=function(){var B=0,G=document.querySelector('input[name="ds_name"]:checked');G&&(B=G.value);G=new Uint8Array(3);
G[0]=4;G[1]=5;G[2]=B;if(l.onagentmessage)l.onagentmessage(G)};b.show()}break;case 3:case 8:case 10:b=a.slice?new hi5.DataBuffer(a.slice(2,a.length)):new hi5.DataBuffer(a.subarray(2,a.length));ab.send(b);break;case 4:b=a.slice?new hi5.DataBuffer(a.slice(2,a.length)):new hi5.DataBuffer(a.subarray(2,a.length));ab.send(b);hi5.notifications.notify({msg:__svi18n.info.TwainNotSupported,type:2});break;case 6:b=a.slice?new hi5.DataBuffer(a.slice(2,a.length)):new hi5.DataBuffer(a.subarray(2,a.length));b.getLittleEndian16();
l.run();break;default:svGlobal.logger.warn("Warning: Unknown response header: [4 / "+a[1]+"], ignored.")}break;case 5:switch(a[1]){case 1:b=a[2]|a[3]<<8,a=a[4]|a[5]<<8,svGlobal.logger.info("Agent version, major: "+b+" minor: "+a),(e=hi5.appcfg.agent&&hi5.appcfg.agent.version)&&(e.major>b||e.major==b&&e.minor>a)&&(b=__svi18n.info.newVersion||"New versoin available",a=__svi18n.info.updateAgent||"Please download and install the new gateway agent",e=l.getAgentLink(),hi5.notifications.notify({title:b,
msg:a+(': <a href="'+e+'">'+e+"</a>")}))}break;case 6:switch(a[1]){case 1:b=new hi5.DataBuffer(a);b.skipPosition(2);e=b.getLittleEndian32();c=[];for(a=0;a<e;a++)n=b.getLittleEndian32(),d=b.getUnicodeString(n),n=b.getLittleEndian32(),n=b.getUnicodeString(n),c.push({name:d,driver:n});Ta&&Ta.listCallback&&(Ta.listCallback(c),Ta.listCallback=null)}break;case 7:Ta.send(a.subarray(1));break;default:svGlobal.logger.warn("Invalid channel data received: unknown type ["+a[0]+"].")}};var mb,Ua,ib,Qb={type:6,
data:null};this.setAgentStatus=function(a){tc=a};this.getAgentStatus=function(){return tc};this.run=function(){var a;if(a=null==l.onagentmessage)a=1==l.mode?!1:l.hasSmartCard()||l.hasScanner()||da(D.localPrinter);a&&window.startGatewayAgent?startGatewayAgent(l):(l.hasUSB()?L.getFocused().requestUsbDevices(l.getUSB(),function(b){la.usbChannel.openDevices(b);Ob()}):Ob(),xa.supportWebAudio&&xa.iOSFix())};this.getDesktop=function(){return Y};this.mouseDown=function(a,b,c){Ka&&ha("80"+a+"\t"+b+"\t"+c)};
this.mouseMove=function(a,b){Ka&&ha("82"+a+"\t"+b)};this.mouseUp=function(a,b,c){Ka&&ha("81"+a+"\t"+b+"\t"+c)};this.writeKeyCode=function(a,b){Ka&&ha("8B"+(a?0:49152)+"\t"+b)};this.writeScancode=function(a,b){Ka&&("number"==typeof a?(ha("840\t"+a),ha("8449152\t"+a)):ha("84"+(a?0:49152)+"\t"+b))};this.resetSize=function(a,b){l.reconnectOnResize&&(Ja?(fb&&(clearTimeout(fb),fb=0),a&=-4,b&=-4,fb=setTimeout(function(){Da&&Da.enabled&&Da.applyResolution(a,b);setTimeout(function(){l.writeRawInput("8C661441\t"+
a+"\t"+b);3==l.windowState&&sc()},150);svGlobal.logger.info("-- displayChange, h:"+b)},777)):l.running()&&(fb&&(clearTimeout(fb),fb=0),fb=setTimeout(function(){l.reconnect(a,b)},555)))};var Ga=new RdpBuffer([],0,0);this.suppressOutput=function(a){if(!l.sessionInfo.suppressOutput)return!1;void 0==a&&(a=!0);var b=new Uint8Array(a?3:11);b[0]=146;b[1]=3;b[2]=a?1:0;a||(b[3]=Eb,b[4]=Eb>>8,b[5]=Db,b[6]=Db>>8,b[7]=Fb,b[8]=Fb>>8,b[9]=Gb,b[10]=Gb>>8);ha(b.buffer);return!0};this.refreshOutput=function(a,b,c,
e){var d=new Uint8Array(c?11:3);d[0]=146;d[1]=3;d[2]=2;c&&(d[3]=a,d[4]=a>>8,d[5]=b,d[6]=b>>8,d[7]=c,d[8]=c>>8,d[9]=e,d[10]=e>>8);ha(d.buffer)};this.sendPing=function(a){var b=new Uint8Array(a?2+a.length:2);b[0]=146;b[1]=0;a&&b.set(a,2);ha(b.buffer)};this.startPing=function(a,b){b=b||0;Ba||(Ba=new hi5.tool.ResponseMonitor(function(){Ka&&l.sendPing()},function(){if(Ka&&l.onnoresponse)return l.onnoresponse()}));Ba.setInterval(a,b);var c=new Uint8Array(4);c[0]=146;c[1]=2;c[2]=a;c[3]=b;ha(c.buffer);setTimeout(function(){Ba&&
Ba.check()},1E3*(a+b));va?va.postMessage({type:0,cmd:6,start:1}):(ja.onSlowPath=ja.onFastPath=ic,ja.onReqHistory=function(){ic(15555)})};this.stopPing=function(){Ba&&Ba.stop();va?va.postMessage({type:0,cmd:6,start:0}):ja.onSlowPath=ja.onFastPath=ja.onReqHistory=null};var Ma=null,pc=0;this.play=function(){ha("F3")};this.pause=function(){ha("F2")};this.scan=function(a){ha("F4"+(a?"1":"0"))};this.seek=function(a){var b=L.getFocused();b&&sa&&(ha("F4"+(a?"1":"0")+"\t"+(a/b.getScale().x|0)),Y.pause(!0))};
var db=na=aa=0;var Ya=22050;var oc=!1;this.showMessage=function(a,b,c){l&&l.displayMsg&&a&&((b=b||L.getFocused())?b.showMessage(a,c):("string"==typeof a&&(a={msg:a,timeout:c||0}),hi5.notifications.notify(a)))};this._unload=ob;this.close=function(){svGlobal.logger.info("closing...");sa&&Ja&&L&&M.closeRemoteApp&&L.tryCloseRemoteApps();Y&&Y.isSendingHistory()?(svGlobal.logger.warn("In the middle of sending history, close delayed"),setTimeout(rc,2222)):rc()};hi5.browser.isChromeApp?chrome.runtime.onSuspend.addListener(l.close):
window.addEventListener("unload",l.close,!1)}
Rdp.languageToKeyboard={af:0,sq:0,ar:1025,"ar-SA":1025,"ar-IQ":0,"ar-EG":0,"ar-LY":0,"ar-DZ":0,"ar-MA":0,"ar-TN":0,"ar-OM":0,"ar-YE":0,"ar-SY":0,"ar-JO":0,"ar-LB":0,"ar-KW":0,"ar-AE":0,"ar-BH":0,"ar-QA":0,eu:0,bg:0,be:0,ca:0,zh:2052,"zh-TW":1028,"zh-CN":2052,"zh-HK":1028,"zh-SG":2052,hr:0,cs:0,da:0,nl:1043,"nl-BE":2067,en:1033,"en-US":1033,"en-GB":2057,"en-AU":0,"en-CA":4105,"en-NA":0,"en-IE":0,"en-ZA":0,"en-JM":0,"en-BZ":0,et:0,fo:0,fa:0,fi:0,fr:1036,"fr-BE":2060,"fr-CA":3084,"fr-CH":4108,"fr-LU":0,
gd:0,"gd-IE":0,de:1031,"de-CH":2055,"de-AT":0,"de-LU":0,"de-LI":0,el:0,he:1037,hi:0,hu:0,is:1039,id:0,it:1040,"it-CH":66576,ja:3758162961,ko:3758162962,lv:0,lt:0,mk:0,mt:0,nb:1044,nn:1083,no:1044,pl:1045,pt:2070,"pt-BR":1046,rm:0,ro:0,"ro-MO":0,ru:1049,"ru-MO":0,sr:0,sk:0,sl:0,sb:0,es:1034,"es-AR":0,"es-GT":0,"es-CR":0,"es-PA":0,"es-DO":0,"es-MX":2058,"es-VE":0,"es-CO":0,"es-PE":0,"es-EC":0,"es-CL":0,"es-UY":0,"es-PY":0,"es-BO":0,"es-SV":0,"es-HN":0,"es-NI":0,"es-PR":0,sx:0,sv:1053,"sv-FI":0,th:0,
ts:0,tn:0,tr:1055,uk:0,ur:0,ve:0,vi:0,xh:0,ji:0,zu:0,detect:function(){var w=navigator&&(navigator.language||navigator.userLanguage||""),N=Rdp.languageToKeyboard[w];if(!N){var T=w.indexOf("-");T&&(N=Rdp.languageToKeyboard[w.substring(0,T)])}N||(svGlobal.logger.info("No valid layout for "+w),N=1033);return N}};svGlobal.Rdp||(svGlobal.Rdp=Rdp);var RdpBuffer=hi5.DataBuffer;
