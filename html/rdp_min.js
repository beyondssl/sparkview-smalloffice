var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.checkStringArgs=function(w,L,P){if(null==w)throw new TypeError("The 'this' value for String.prototype."+P+" must not be null or undefined");if(L instanceof RegExp)throw new TypeError("First argument to String.prototype."+P+" must not be a regular expression");return w+""};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.SIMPLE_FROUND_POLYFILL=!1;$jscomp.ISOLATE_POLYFILLS=!1;
$jscomp.FORCE_POLYFILL_PROMISE=!1;$jscomp.FORCE_POLYFILL_PROMISE_WHEN_NO_UNHANDLED_REJECTION=!1;$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(w,L,P){if(w==Array.prototype||w==Object.prototype)return w;w[L]=P.value;return w};
$jscomp.getGlobal=function(w){w=["object"==typeof globalThis&&globalThis,w,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof global&&global];for(var L=0;L<w.length;++L){var P=w[L];if(P&&P.Math==Math)return P}throw Error("Cannot find global object");};$jscomp.global=$jscomp.getGlobal(this);$jscomp.IS_SYMBOL_NATIVE="function"===typeof Symbol&&"symbol"===typeof Symbol("x");$jscomp.TRUST_ES6_POLYFILLS=!$jscomp.ISOLATE_POLYFILLS||$jscomp.IS_SYMBOL_NATIVE;$jscomp.polyfills={};
$jscomp.propertyToPolyfillSymbol={};$jscomp.POLYFILL_PREFIX="$jscp$";var $jscomp$lookupPolyfilledValue=function(w,L){var P=$jscomp.propertyToPolyfillSymbol[L];if(null==P)return w[L];P=w[P];return void 0!==P?P:w[L]};$jscomp.polyfill=function(w,L,P,U){L&&($jscomp.ISOLATE_POLYFILLS?$jscomp.polyfillIsolated(w,L,P,U):$jscomp.polyfillUnisolated(w,L,P,U))};
$jscomp.polyfillUnisolated=function(w,L,P,U){P=$jscomp.global;w=w.split(".");for(U=0;U<w.length-1;U++){var V=w[U];if(!(V in P))return;P=P[V]}w=w[w.length-1];U=P[w];L=L(U);L!=U&&null!=L&&$jscomp.defineProperty(P,w,{configurable:!0,writable:!0,value:L})};
$jscomp.polyfillIsolated=function(w,L,P,U){var V=w.split(".");w=1===V.length;U=V[0];U=!w&&U in $jscomp.polyfills?$jscomp.polyfills:$jscomp.global;for(var ka=0;ka<V.length-1;ka++){var X=V[ka];if(!(X in U))return;U=U[X]}V=V[V.length-1];P=$jscomp.IS_SYMBOL_NATIVE&&"es6"===P?U[V]:null;L=L(P);null!=L&&(w?$jscomp.defineProperty($jscomp.polyfills,V,{configurable:!0,writable:!0,value:L}):L!==P&&($jscomp.propertyToPolyfillSymbol[V]=$jscomp.IS_SYMBOL_NATIVE?$jscomp.global.Symbol(V):$jscomp.POLYFILL_PREFIX+
V,V=$jscomp.propertyToPolyfillSymbol[V],$jscomp.defineProperty(U,V,{configurable:!0,writable:!0,value:L})))};$jscomp.polyfill("String.prototype.startsWith",function(w){return w?w:function(L,P){var U=$jscomp.checkStringArgs(this,L,"startsWith");L+="";var V=U.length,ka=L.length;P=Math.max(0,Math.min(P|0,U.length));for(var X=0;X<ka&&P<V;)if(U[P++]!=L[X++])return!1;return X>=ka}},"es6","es3");
$jscomp.checkEs6ConformanceViaProxy=function(){try{var w={},L=Object.create(new $jscomp.global.Proxy(w,{get:function(P,U,V){return P==w&&"q"==U&&V==L}}));return!0===L.q}catch(P){return!1}};$jscomp.USE_PROXY_FOR_ES6_CONFORMANCE_CHECKS=!1;$jscomp.ES6_CONFORMANCE=$jscomp.USE_PROXY_FOR_ES6_CONFORMANCE_CHECKS&&$jscomp.checkEs6ConformanceViaProxy();$jscomp.arrayIteratorImpl=function(w){var L=0;return function(){return L<w.length?{done:!1,value:w[L++]}:{done:!0}}};$jscomp.arrayIterator=function(w){return{next:$jscomp.arrayIteratorImpl(w)}};
$jscomp.initSymbol=function(){};$jscomp.polyfill("Symbol",function(w){if(w)return w;var L=function(V,ka){this.$jscomp$symbol$id_=V;$jscomp.defineProperty(this,"description",{configurable:!0,writable:!0,value:ka})};L.prototype.toString=function(){return this.$jscomp$symbol$id_};var P=0,U=function(V){if(this instanceof U)throw new TypeError("Symbol is not a constructor");return new L("jscomp_symbol_"+(V||"")+"_"+P++,V)};return U},"es6","es3");
$jscomp.polyfill("Symbol.iterator",function(w){if(w)return w;w=Symbol("Symbol.iterator");for(var L="Array Int8Array Uint8Array Uint8ClampedArray Int16Array Uint16Array Int32Array Uint32Array Float32Array Float64Array".split(" "),P=0;P<L.length;P++){var U=$jscomp.global[L[P]];"function"===typeof U&&"function"!=typeof U.prototype[w]&&$jscomp.defineProperty(U.prototype,w,{configurable:!0,writable:!0,value:function(){return $jscomp.iteratorPrototype($jscomp.arrayIteratorImpl(this))}})}return w},"es6",
"es3");$jscomp.iteratorPrototype=function(w){w={next:w};w[Symbol.iterator]=function(){return this};return w};$jscomp.makeIterator=function(w){var L="undefined"!=typeof Symbol&&Symbol.iterator&&w[Symbol.iterator];return L?L.call(w):$jscomp.arrayIterator(w)};$jscomp.owns=function(w,L){return Object.prototype.hasOwnProperty.call(w,L)};
$jscomp.polyfill("WeakMap",function(w){function L(){if(!w||!Object.seal)return!1;try{var N=Object.seal({}),Q=Object.seal({}),ha=new w([[N,2],[Q,3]]);if(2!=ha.get(N)||3!=ha.get(Q))return!1;ha.delete(N);ha.set(Q,4);return!ha.has(N)&&4==ha.get(Q)}catch(Ua){return!1}}function P(){}function U(N){var Q=typeof N;return"object"===Q&&null!==N||"function"===Q}function V(N){if(!$jscomp.owns(N,X)){var Q=new P;$jscomp.defineProperty(N,X,{value:Q})}}function ka(N){if(!$jscomp.ISOLATE_POLYFILLS){var Q=Object[N];
Q&&(Object[N]=function(ha){if(ha instanceof P)return ha;Object.isExtensible(ha)&&V(ha);return Q(ha)})}}if($jscomp.USE_PROXY_FOR_ES6_CONFORMANCE_CHECKS){if(w&&$jscomp.ES6_CONFORMANCE)return w}else if(L())return w;var X="$jscomp_hidden_"+Math.random();ka("freeze");ka("preventExtensions");ka("seal");var Pa=0,O=function(N){this.id_=(Pa+=Math.random()+1).toString();if(N){N=$jscomp.makeIterator(N);for(var Q;!(Q=N.next()).done;)Q=Q.value,this.set(Q[0],Q[1])}};O.prototype.set=function(N,Q){if(!U(N))throw Error("Invalid WeakMap key");
V(N);if(!$jscomp.owns(N,X))throw Error("WeakMap key fail: "+N);N[X][this.id_]=Q;return this};O.prototype.get=function(N){return U(N)&&$jscomp.owns(N,X)?N[X][this.id_]:void 0};O.prototype.has=function(N){return U(N)&&$jscomp.owns(N,X)&&$jscomp.owns(N[X],this.id_)};O.prototype.delete=function(N){return U(N)&&$jscomp.owns(N,X)&&$jscomp.owns(N[X],this.id_)?delete N[X][this.id_]:!1};return O},"es6","es3");$jscomp.MapEntry=function(){};
$jscomp.polyfill("Map",function(w){function L(){if($jscomp.ASSUME_NO_NATIVE_MAP||!w||"function"!=typeof w||!w.prototype.entries||"function"!=typeof Object.seal)return!1;try{var O=Object.seal({x:4}),N=new w($jscomp.makeIterator([[O,"s"]]));if("s"!=N.get(O)||1!=N.size||N.get({x:4})||N.set({x:4},"t")!=N||2!=N.size)return!1;var Q=N.entries(),ha=Q.next();if(ha.done||ha.value[0]!=O||"s"!=ha.value[1])return!1;ha=Q.next();return ha.done||4!=ha.value[0].x||"t"!=ha.value[1]||!Q.next().done?!1:!0}catch(Ua){return!1}}
if($jscomp.USE_PROXY_FOR_ES6_CONFORMANCE_CHECKS){if(w&&$jscomp.ES6_CONFORMANCE)return w}else if(L())return w;var P=new WeakMap,U=function(O){this.data_={};this.head_=X();this.size=0;if(O){O=$jscomp.makeIterator(O);for(var N;!(N=O.next()).done;)N=N.value,this.set(N[0],N[1])}};U.prototype.set=function(O,N){O=0===O?0:O;var Q=V(this,O);Q.list||(Q.list=this.data_[Q.id]=[]);Q.entry?Q.entry.value=N:(Q.entry={next:this.head_,previous:this.head_.previous,head:this.head_,key:O,value:N},Q.list.push(Q.entry),
this.head_.previous.next=Q.entry,this.head_.previous=Q.entry,this.size++);return this};U.prototype.delete=function(O){O=V(this,O);return O.entry&&O.list?(O.list.splice(O.index,1),O.list.length||delete this.data_[O.id],O.entry.previous.next=O.entry.next,O.entry.next.previous=O.entry.previous,O.entry.head=null,this.size--,!0):!1};U.prototype.clear=function(){this.data_={};this.head_=this.head_.previous=X();this.size=0};U.prototype.has=function(O){return!!V(this,O).entry};U.prototype.get=function(O){return(O=
V(this,O).entry)&&O.value};U.prototype.entries=function(){return ka(this,function(O){return[O.key,O.value]})};U.prototype.keys=function(){return ka(this,function(O){return O.key})};U.prototype.values=function(){return ka(this,function(O){return O.value})};U.prototype.forEach=function(O,N){for(var Q=this.entries(),ha;!(ha=Q.next()).done;)ha=ha.value,O.call(N,ha[1],ha[0],this)};U.prototype[Symbol.iterator]=U.prototype.entries;var V=function(O,N){var Q=N&&typeof N;"object"==Q||"function"==Q?P.has(N)?
Q=P.get(N):(Q=""+ ++Pa,P.set(N,Q)):Q="p_"+N;var ha=O.data_[Q];if(ha&&$jscomp.owns(O.data_,Q))for(O=0;O<ha.length;O++){var Ua=ha[O];if(N!==N&&Ua.key!==Ua.key||N===Ua.key)return{id:Q,list:ha,index:O,entry:Ua}}return{id:Q,list:ha,index:-1,entry:void 0}},ka=function(O,N){var Q=O.head_;return $jscomp.iteratorPrototype(function(){if(Q){for(;Q.head!=O.head_;)Q=Q.previous;for(;Q.next!=Q.head;)return Q=Q.next,{done:!1,value:N(Q)};Q=null}return{done:!0,value:void 0}})},X=function(){var O={};return O.previous=
O.next=O.head=O},Pa=0;return U},"es6","es3");$jscomp.findInternal=function(w,L,P){w instanceof String&&(w=String(w));for(var U=w.length,V=0;V<U;V++){var ka=w[V];if(L.call(P,ka,V,w))return{i:V,v:ka}}return{i:-1,v:void 0}};$jscomp.polyfill("Array.prototype.findIndex",function(w){return w?w:function(L,P){return $jscomp.findInternal(this,L,P).i}},"es6","es3");var svManager={getInstance:function(){var w=window.$rdp;return w&&w.running&&w.running()?w:null}};svGlobal.getInstance=svManager.getInstance;
function connvertServer(w){var L={};L.id=w.id;L.server=w.id;L.displayName=w.displayName||w.id;if(w=w.rdp){for(var P in w)L[P]=w[P];L.user=w.username||"";L.pwd=w.password||"";L.useConsole=w.console||!1;L.legacyMode=w.leagacyMode||w.legacyMode||!1;L.server_bpp=w.color||16;L.exe=w.remoteProgram||"";L.args=w.remoteArgs||"";L.startProgram=0<L.exe.length?"app":L.command&&0<L.command.length?"shell":"noapp"}return L}
function Rdp2(w){w=svGlobal.util.getServerArgs(w);if(!w||!w.gateway)return hi5.notifications.notify({msg:__svi18n.noauth}),null;var L=w.gateway||"",P=0,U=0,V=16,ka=1==w.useSSL||"true"==w.useSSL||"on"==w.useSSL||null;w.width&&(P=parseInt(w.width,10));w.height&&(U=parseInt(w.height,10));w.color&&(V=parseInt(w.color,10));w.server_bpp&&(V=parseInt(w.server_bpp,10));w=hi5.browser.obj2url(w);null===ka&&(ka="https:"==location.protocol);return new Rdp((ka?"wss://":"ws://")+L+"/RDP?"+w,P,U,V)}
svGlobal.Rdp2||(svGlobal.Rdp2=Rdp2);
function Rdp(w,L,P,U){var V,ka;function X(a){return"on"==a||"true"==a||1==a}function Pa(){var a=k.gateway;k.ongetgatewayaddress&&(a=k.ongetgatewayaddress(a));return a}function O(){var a=hi5.storage.get("SV_CONN_SHARE_ID");a||(a=hi5.tool.uuid(),hi5.storage.set("SV_CONN_SHARE_ID",a));return a}function N(a,b){a=K[a]||b;a.startsWith("/")||a.toLowerCase().startsWith("http")||(a=hi5.libPath+a);return a}function Q(){return D.displayName||D.server||D.symlink||D.id||"undefined"}function ha(a){k.loadbalanceToken||
(k.loadbalanceToken=K.loadbalanceTokenName?K.loadbalanceTokenName+"="+a:"")}function Ua(a,b,c){k.ontitlechange&&(a=k.ontitlechange(a,c));k.setTitle&&a&&(b=b||window,b.document.title=a)}function nb(a,b){switch(a){case 16:case 8:case 24:case 32:break;case 15:return D.invitation||k.showMessage("15 bit color is not supported anymore."),!1;default:return!1}Wa=a;b&&(sa?sa.postMessage({type:0,cmd:1,data:a}):ea&&ea.setColor(a));return!0}function bb(a,b,c,e){qa=a;ra=b;Db=Eb=0;Fb=qa-1;Gb=ra-1;Ja&&(qa=(D.waWidth||
hi5.browser.getScreenWidth())|0,ra=(D.waHeight||hi5.browser.getScreenHeight())|0);D.minWidth&&qa<D.minWidth&&(qa=D.minWidth|0);D.minHeight&&ra<D.minHeight&&(ra=D.minHeight|0);qa&=-4;ra&=-4;svGlobal.logger.warn("resolution changed, w:"+qa+" h:"+ra);var d=qa,m=ra;W?W.resize(d,m):W=new $b(d,m);I.setSize(qa,ra,Ja?"hidden":null);if(c||qa!=a||ra!=b)sa?sa.postMessage({type:0,cmd:2,data:{w:qa,h:ra}}):ea&&ea.setResolution(qa,ra);if(k.onresolutionchange&&!e)k.onresolutionchange(a,b)}function ba(a){!Qa&&oa&&
(sa?(Hb.data=a,"string"!=typeof a?sa.postMessage(Hb,[a]):sa.postMessage(Hb)):ea.writeRawInput(a))}function ac(a){switch(a){case "\r":break;case "\n":k.writeScancode(28);break;case "\t":k.writeScancode(15);break;default:ba("86"+a)}}function Ib(a){var b=this;a||(a=143);this.send=function(c){var e=!!c.buffer,d=e?c:c.getData(),m=64==a;c=e?d.length:c.getEnd()||d.length;c<d.length&&(d=e?d.subarray(0,c):d.slice(0,c));e=m?5:9;c=new Uint8Array(e+c);c[0]=a;if(m)c[1]=b.id,c[2]=b.id>>8,c[3]=b.id>>16,c[4]=b.id>>
24;else{m=b.name;for(var h=Math.min(m.length,8),E=0;E<h;E++)c[1+E]=m.charCodeAt(E)}c.set(d,e);ba(c.buffer)};this.name="";this.count=this.id=this.flags=0}function tb(a){if(k){var b=__svi18n.errorCode[a];a={name:a,message:b,msg:b};k.displayMsg&&k.showMessage(a);0<svGlobal.log&&console.error&&console.error(a);if(k.onerror)k.onerror(a)}}function Jb(a){if(k){var b=__svi18n.info[a];b||(b="info "+a);k.displayMsg&&k.showMessage(b);svGlobal.logger.info(b)}}function Kb(){var a=oa;gb=oa=!1;sa?sa.postMessage({type:0,
cmd:3}):ea&&ea.resetStatus();a&&(oa=a)}function Lb(a){ua||(ua=new hi5.file.UploadManager(new hi5.file.WsFileService(ba)),ua.addEvent("beforeupload",function(b,c,e){if(k.beforeupload)return k.beforeupload(b,c,e)}),ua.addEvent("fileuploaded",function(b,c,e){if(k.onfileuploaded)k.onfileuploaded(b,c,e)}),ua.addEvent("uploaded",function(b,c){if(k.onuploaded)k.onuploaded(b,c)}),ua.addEvent("uploadingCancelled",function(){if(k.onuploadingCancelled)k.onuploadingCancelled()}));a.setFileHandler(ua)}function bc(a,
b,c){var e=!1;this.exe=a;this.args=b||"";this._dir=c||"";var d=this;this.close=function(){!e&&oa&&(e=!0,ba("8C5"+d.exe+"\t"+d.args+"\t"+k.sessionInfo.appInfo.session))}}function Ac(){var a=window.opener;if(a)try{if(a.__sparkUser&&a.__sparkUser.session)return a.__sparkUser;if(a.opener&&a.opener.__sparkUser.session)return a.opener.__sparkUser}catch(b){}return null}function Bc(){var a=0,b=0,c=new k.GatewayChannel;c.name="MESSGSTB";c.onopen=function(){svGlobal.logger.info("Message Channel open")};c.process=
function(e){if(0==e.getByte())e.getByte(),e.getByte(),e.getByte();else{var d=e.getByte(),m=e.getLittleEndian16(),h=e.getLittleEndian16();if(0!=d)svGlobal.logger.warn("Invalid AUTODETECT_REQUEST");else switch(h){case 1:case 4097:h=new RdpBuffer(new Uint8Array(6),0,6);h.setByte(6);h.setByte(1);h.setLittleEndian16(m);h.setLittleEndian16(0);h.markEnd();c.send(h);break;case 20:case 276:case 4116:a=6;b=Date.now();break;case 2:m=e.getLittleEndian16();a+=m;break;case 43:case 1065:case 1577:43==h&&(d=e.getLittleEndian16(),
a=a+d+8,e.skipPosition(d));e=e.has(4)?e.getLittleEndian32():0;a+=e;e=Date.now()-b;d=new RdpBuffer(new Uint8Array(14),0,14);d.setByte(14);d.setByte(1);d.setLittleEndian16(m);d.setLittleEndian16(43==h?3:11);d.setLittleEndian32(e);d.setLittleEndian32(a);d.markEnd();c.send(d);break;case 2112:case 2176:case 2240:m=e.getLittleEndian32();h=e.getLittleEndian32();e=e.getLittleEndian32();ub={baseRTT:m,bandwidth:h,averageRTT:e};if(k.onnetworkresult)k.onnetworkresult(ub);svGlobal.logger.warn("Network Characteristics Result:");
svGlobal.logger.warn(ub);break;default:svGlobal.logger.warn("Invalid network detect PDU",e)}}};c.onclose=function(){svGlobal.logger.info("MSG channel close")};k.addGatewayChannel(c)}function Cc(a,b,c,e,d){Mb.set(a,b);Nb.set(a,e);b="<b>User:&nbsp;</b>"+c+"&nbsp;("+e+")&nbsp;&nbsp;&nbsp;&nbsp;<b>Expire Date:</b> "+d;c=document.createElement("div");e=document.createElement("input");e.type="radio";e.name="scard_name";e.value=a;0==a&&(e.defaultChecked=!0);c.appendChild(e);c.innerHTML+=b;c.innerHTML+="<br>";
return c}function Dc(a,b){var c=document.createElement("div"),e=document.createElement("input");e.type="radio";e.name="ds_name";e.value=a;0==a&&(e.defaultChecked=!0);c.appendChild(e);c.innerHTML+=b;c.innerHTML+="<br>";return c}function cc(){var a="";D&&X(D.connectif)&&D.symlink&&"sessionStorage"in window&&(a="SV_"+D.symlink,D.domain&&(a+=D.domain),D.user&&(a+=D.user));return a}function Ec(){var a=hi5.appcfg.persistentId?window.localStorage:window.sessionStorage;if(!a)return"";var b=a.getItem("appInfo.session");
if(!b)return"";b="&_session="+b;(a=a.getItem("appInfo.numericId"))&&(b+="&_numericId="+a);return b}function Ob(){if(!oa){gb=!1;var a="";Qa?ia.init(!1,!0,!1,0,!1,!1):a=k.getRuntimeURL();void 0==K.wsPost&&(K.wsPost=!1);k.oncreatewebsocket&&(sa=null);sa?(Qa&&(Qa.onopen=Pb,Qa.onclose=ob,Qa.onmessage=function(c){Qb.data=c.data;sa.postMessage(Qb,[Qb.data])}),sa.postMessage({type:0,cmd:0,data:{addr:a,width:qa,height:ra,server_bpp:Wa,libPath:hi5.libPath,libMin:hi5.libMin,wsPost:K.wsPost}})):(ea=new RdpGeneral(Qa||
a,qa,ra,Wa,W,!1,K.wsPost),ea.oncreatewebsocket=k.oncreatewebsocket,ea.run());sa?sa.addEventListener("message",dc,!1):(ea.onopen=Pb,ea.onmessage=ec,ea.onclose=ob,ea.onerror=tb,ea.oninfo=Jb,ea.onloggedin=Rb,ea.onresolutionchange=function(c,e){bb(c,e,!1,D.monitorDef&&0<=D.monitor?!0:!1)},ea.onAltSecWindows=fc,ea.onMoveCursor=Sb,ea.onCloseSurface=gc,ea.onColorChange=nb,ea.onHistoryReceived=function(){Tb()},ea.onLockKeyState=function(c){if(k.onLockKeyState)k.onLockKeyState(c)});if(a=I.getSurface(I.size()-
1))Ja?a&&(a.remoteApp=new bc(D.exe,D.args,"")):Ua(Q(),a.getWindow());if(D.invitation&&!X(D.shadow)){var b=null;a&&(b=a.initChat(D.expert));pb=new k.GatewayChannel;pb.name="C_H_A_T";pb.process=function(c){c=c.getUnicodeString(c.getEnd()-c.getPosition(),!0);b&&b.add(c,D.novice)};b&&(b.onchat=function(c){if(oa){var e=Array(2*c.length);e=new hi5.DataBuffer(e,0,e.length);e.setUnicodeString(c);e.markEnd();pb.send(e)}});k.addGatewayChannel(pb)}hi5.browser.isIE&&!qb&&(0==D.playSound||0<k.mode)&&(qb=hi5.browser.loadFlash(K.flash||
hi5.libPath+"plugin.swf"))&&(hc=!0)}}function dc(a){a=a.data;switch(a.type){case 1:switch(a.event){case 0:Pb();break;case 1:ob(a.expected);break;case 2:tb(a.code);break;case 3:Jb(a.code);break;case 4:Rb();break;case 5:bb(a.w,a.h,!1,D.monitorDef&&0<=D.monitor?!0:!1);break;case 6:Sb(a.x,a.y,!0);break;case 7:gc();break;case 8:0==a.id&&Tb();xa&&xa.check(1<a.id?15555:0);break;case 9:nb(a.color);break;case 10:if(k.onLockKeyState)k.onLockKeyState(a.state);break;default:svGlobal.logger.warn("Invalid worker event "+
a.type)}break;case 2:W.setRGBs(a.x,a.y,a.w,a.h,a.pixel,a.offset,a.scansize);break;case 3:W.moveArea(a.srcx,a.srcy,a.cx,a.cy,a.dx,a.dy);break;case 5:W.fillRect(a.l,a.t,a.w,a.h,a.color);break;case 6:W.drawLine(a.x1,a.y1,a.x2,a.y2,a.color);break;case 7:W.bitBlt(a.opcode,a.dstwidth,a.x,a.y,a.cx,a.cy,a.src,a.srcwidth,a.srcx,a.srcy);break;case 8:W.drawLineExt(a.x1,a.y1,a.x2,a.y2,a.color,a.opcode);break;case 9:ic(a);break;case 10:ec(a);break;case 11:Ea.attach(a.data,0,a.data.length);fc(Ea,a.size);break;
case 12:W.drawText(a.font,a.flags,a.mixmode,a.foregroundColor,a.backgroundColor,a.clipLeft,a.clipTop,a.clipcx,a.clipcy,a.boxLeft,a.boxTop,a.boxcx,a.boxcy,a.x,a.y,a.length,a.text,a._left,a._top,a._right,a._bottom);break;case 13:W.drawBitmap(a.cacheID,a.cacheIDX,a.x,a.y,a.cx,a.cy,a.srcx,a.srcy,a.opcode);break;case 14:W.saveDesktop(a.x,a.y,a.cx,a.cy,a.offset);break;case 15:W.restoreDesktop(a.x,a.y,a.cx,a.cy,a.offset);break;case 16:W.putFont(a.font,a.character,a.glyph);break;case 17:W.putCursor(a.idx,
a.cursor);break;case 18:W.setCursor(a.idx);break;case 19:W.getHistory(ba,function(){sa.postMessage({type:0,cmd:7})});xa&&xa.check(15555);break;case 20:Ea.attach(a.data,a.off,a.data.length-a.off);W.setHistory(a.order,Ea);break;case 21:W.putBitmap(a.id,a.idx,a.bitmap);break;default:svGlobal.logger.warn("Invalid worker msg "+a.type)}}function jc(a){xa&&xa.check(a)}function Pb(){oa=!0;var a="87"+navigator.userAgent+"\t";vb=hi5.tool.uuid();document.cookie=vb+"=sv";ba(a+vb);if(k.onopen)k.onopen();K.joinCloseMode&&
k.setJoinCloseMode(K.joinCloseMode)}function gc(){I&&I.close()}function ec(a){var b=a.data;if("string"!=typeof b){a=new Uint8Array(b);Ea.attach(a,0,b.byteLength);var c=Ea.getLittleEndian16();switch(c){case 28:a=Ea;b=a.getAscllString(8);c=cb[b];null!=c?c.process(a):svGlobal.logger.warn("Channel "+b+" not found");break;case 55:a=Ea;switch(a.getByte()){case 0:V=a.getLittleEndian16();ka=a.getLittleEndian16();Xa=a.getLittleEndian32();a.skipPosition(6);db=a.getLittleEndian16();svGlobal.logger.info("Audio Format, tag="+
V+" channels="+ka+" bitsPerSample="+db+" samplePerSec="+Xa);kc();break;case 1:Fc(a)}xa&&xa.check();break;case 56:lc(Ea.getUnicodeString(Ea.getEnd()-Ea.getPosition(),!1));break;case 60:mc(Ea);break;case 62:nc(Ea.getUnicodeString(Ea.getEnd()-Ea.getPosition(),!1));break;case 63:oc(Ea);xa&&xa.check();break;case 64:b=Ea;c=b.getByte();a=b.getLittleEndian32();switch(c){case 1:b=b.getAscllString();if(ia[b]){if(svGlobal.logger.info("DVC create, name:"+b+" id:"+a),ia[b].newInstance?(ia[a]=ia[b].newInstance(),
ia[a].id=a):(ia[b].id=a,ia[a]=ia[b]),ia[a].onopen)ia[a].onopen()}else svGlobal.logger.info("DVC create, name not found:"+b+" id:"+a);break;case 3:ia[a]&&ia[a].process(b);break;case 4:if(ia[a]&&ia[a].onclose)ia[a].onclose();svGlobal.logger.info("close DVC, id:"+a)}xa&&xa.check();break;case 146:a:switch(a=Ea,b=a.getByte(),b){case 0:a=new Uint8Array(2);a[0]=146;a[1]=1;ba(a.buffer);break;case 1:break;case 5:b=a.getByte();a=a.getLittleEndian32();0!=b||a&4||(Ra^=65536,I.execute("setFeature",[Ra]));break;
case 6:ya.remoteLockFlags=a.getLittleEndian32();ya.checkLockFlags=!0;if(k.onLockKeyState)k.onLockKeyState({capsLock:0!=(ya.remoteLockFlags&4),numLock:0!=(ya.remoteLockFlags&2),scrollLock:0!=(ya.remoteLockFlags&1)},{capsLock:0!=(ya.localLockFlags&4),numLock:0!=(ya.localLockFlags&2),scrollLock:0!=(ya.localLockFlags&1)});svGlobal.logger.info("remoteLockFlags: "+ya.remoteLockFlags);break;case 7:b=a.getByte();k.sessionInfo.appInfo.twoFAEnabled=0<b;switch(b){case 0:b=a.getByte();c=a.getLittleEndian32();
a=a.getBytes(c);k.sessionInfo.appInfo.twoFAQR=a;k.ontwofaqr&&k.ontwofaqr(a)||2==b&&I.execute("showTwoFAQR");break;case 1:W.pause(!0,!0);if(k.ontwofacode&&k.ontwofacode())break a;(a=I.getFocused())&&a.showTwoFACode();break;case 2:if(b=a.getByte(),a=1==a.getByte(),(!k.ontwofaresult||!k.ontwofaresult(b,a))&&ya.onauthcoderesult)ya.onauthcoderesult(b,a)}break;default:svGlobal.logger.warn("Invalid Client Control: "+b)}break;default:if(k.onunknownmessage)k.onunknownmessage(c,Ea);else svGlobal.logger.warn("@TODO:"+
c+"\n")}}else switch(c=parseInt(b.substring(0,2),16),a=b.substring(2),c){case 0:ba("87"+navigator.userAgent);break;case 15:if(k){Ub=!1;jb=k.reconnectTimes;(k&&0==k.mode||X(D.connectif))&&Tb();b="";for(b in eb)if((c=eb[b])&&c.onopen)c.onopen();for(b in cb)if((c=cb[b])&&c.onopen)c.onopen();a&&(a=JSON.parse(a),a.capability&&k&&(k.sessionInfo.suppressOutput=!!a.capability.suppressOutput))}break;case 26:b=JSON.parse(a);if(b.name){isNaN(b.name)||(b.name="S"+b.name);b.message||(b.message=b.msg);if(k.onnotify)k.onnotify(b);
svGlobal.logger.info("msg="+a);if(2==b.type&&k.onerror)k.onerror(b);if(a=__svi18n.errorCode[b.name])b.msg=a+" "+b.msg;k.showMessage(b)}else 0<svGlobal.log&&console.erro("No error code for message:"+a);break;case 27:I.drawLicense(a);break;case 50:if(oa)switch(b=parseInt(a.substring(0,1),10),a=a.substring(1),b){case 1:Gc(a);break;case 2:rb?(rb.type==a?k.writeRawInput("881"+a+"\t"+rb.text):k.writeRawInput("881ERROR\t"),rb=null):!(b=I.getFocused())||b.processClipReq(a)||!K.clipWarnAlways&&pc||!D||D.leagacyMode||
(k.showMessage(__svi18n.info.menucopy,null,5E3),pc=!0);break;case 5:(b=I.getFocused())&&"0"!=a&&b.setIgnorePaste(!0)}break;case 51:I.setReadOnly("1"==a);break;case 54:b=a.split("\t");a=Pa()+b[0];a=k.modifyURL(a);svGlobal.logger.info("Downloading file:"+a+" name:"+b[1]+" driver:"+b[2]);k.onprintingready&&k.onprintingready({link:a,printerName:b[1],pinterDriver:b[2]})||(b=I.getFocused())&&b.showPDF(a);break;case 55:b=parseInt(a.substring(0,1),16);a=a.substring(1);switch(b){case 0:a=a.split("\t");V=parseInt(a[0],
10);ka=parseInt(a[1],10);db=parseInt(a[2],10);Xa=parseInt(a[3],10);svGlobal.logger.debug("Audio Format, tag="+V+" channels="+ka+" bitsPerSample="+db+" samplePerSec="+Xa);kc();break;case 1:Hc(a)}break;case 56:lc(a);break;case 57:b=a.split("\t");svGlobal.logger.debug(a);if(a=I.getWinById(parseInt(b[0]))){if(!I.hasApp(b[1])){(c=I.getOwnerSurface(a))&&c.railWin&&(c.railWin.appId=b[1],c.railWin.addApp(b[1]));if(k.onremoteappstart)k.onremoteappstart({id:b[1]});if(a.isVisible()&&a.titleInfo&&k.ontitlechange)k.ontitlechange(c.railWin.getFullTitle(a.id),
b[1])}a.appId=b[1]}break;case 58:Ic(a);break;case 59:a=hi5.Base64.dec(a,0);Ra=(new RdpBuffer(a,0,a.length)).getLittleEndian32();Ya||!(Ra&16||Ra&65536)?(wb=!1,ua=null):(Ra&16&&(wb=!0),ua||(a=I.getFocused())&&Lb(a));Ra&64&&k.showMessage(__svi18n.info.recording);ua&&(ua.setUpload(!(Ra&128)),ua.setDownload(!(Ra&131072)),ua.canCopyFile=0!=(Ra&65536));I.execute("setFeature",[Ra]);break;case 60:mc(b64ToBuffer(a));break;case 61:a=JSON.parse(a);switch(a.type){case 0:bb(a.width,a.height,!0,!1);nb(a.color);
(b=a.server)&&k&&(k.server=a.server);qc=a.length;c=I.getFocused();Ja=1==a.isRail;c&&(1!=k.mode&&c.setAutoScale(!Ja),b&&Ua(Q(),c.getWindow()),b=a.keyboard,"undefined"!=typeof b&&0==b&&c.setUnicode(!0),b=a.mapDisk)&&(wb=!0,Lb(c));if(k.onopened)k.onopened(a);break;case 1:a=a.duration;if(k.onprogress)k.onprogress(a,qc);break;case 2:2==a.status?(Kb(),oa=!0):(b=0==a.status,b==W.isPaused()||k.onsessionpause&&k.onsessionpause(b,a)||(W.pause(b),b||I.repaint(0,0,W.width-1,W.height-1),a.warn&&k.showMessage(b?
__svi18n.info.sessionPaused:__svi18n.info.sessionResumed)))}break;case 62:nc(a);break;case 63:oc(b64ToBuffer(a));break;default:if(k.onunknownmessage)k.onunknownmessage(c,a);else svGlobal.logger.warn("@TODO:"+b+"\n")}}function Tb(){if(!Ya&&!Ka&&(Ka=!0,k&&(K.pingInterval&&k.startPing(K.pingInterval),k.onready)))k.onready()}function Jc(a,b){var c=0,e=!1;this.width=a;this.interval=b;var d=0;this.start=function(){e||(e=!0,c=setInterval(function(){var m=I.getFocused();m&&oa&&(m=m.getThumbnail(a))&&m.length!=
d&&(ba("8E7"+m),d=m.length)},b))};this.stop=function(){clearInterval(c)}}function Kc(a,b){!Ma||Ma.width==a&&Ma.interval==b||(Ma.stop(),Ma=null);Ma||(Ma=new Jc(a,b));Ma.start()}function oc(a){var b=a.getAscllString(8);(b=eb[b])&&b.process&&b.process(a)}function nc(a){var b=parseInt(a.substring(0,1),16),c=a.substring(1);a=!1;var e=k.sessionInfo.appInfo;switch(b){case 0:var d=JSON.parse(c);Kb();oa=!0;a=d.width;e=d.height;if(a==qa&&e==ra)break;bb(a,e,!1,!1);break;case 1:d=JSON.parse(c);k.sessionInfo.joinedSessions.push(d.numericId);
k.sessionInfo.joiners.push(d);e.sessions[d.numericId]=d.name||d.__ip;if(!e.joined||K.alertJoin)k.onsessionjoin&&(a=k.onsessionjoin(d)),!a&&__svi18n.info.joinsession&&k.showMessage(__svi18n.info.joinsession.applyArgs([d.numericId,d.__ip,d.name]));break;case 2:d=JSON.parse(c);k.sessionInfo.joinedSessions.removeElm(d.numericId);delete e.sessions[d.numericId];b=k.sessionInfo.joiners;c=0;for(var m=b.length;c<m;c++)if(b[c].numericId==d.numericId){b.splice(c,1);break}if(!e.joined||K.alertJoin)k.onsessionexit&&
(a=k.onsessionexit(d)),!a&&__svi18n.info.exitsession&&k.showMessage(__svi18n.info.exitsession.applyArgs([d.numericId,d.__ip,d.name]));break;case 3:d=JSON.parse(c);e.joinMode!=d.mode&&(e.joinMode=d.mode,b=hi5.$("joinSelect"))&&(b.value=d.mode);if(e.hasControl)break;e.hasControl=!0;I.setReadOnly(!1,2==d.mode);if(e=hi5.$("requestControl"))e.disabled=!0;k.ongivecontrol&&(a=k.ongivecontrol());if(a)break;k.showMessage(__svi18n.info.givecontrol,null,5E3);break;case 4:d=JSON.parse(c);I.setReadOnly(!0,2==
d.mode);e.hasControl=!1;if(e=hi5.$("requestControl"))e.disabled=!1;k.ontakebackcontrol&&(a=k.ontakebackcontrol());if(a)break;k.showMessage(__svi18n.info.nocontrol,null,5E3);break;case 5:d=JSON.parse(c);k.onrequirecontrol&&(a=k.onrequirecontrol(d));if(a)break;a=__svi18n.info.title.applyArgs([d.name,d.numericId,d.__ip]);e=__svi18n.info.recontrol;W.isPaused&&(e+="<br><br>"+(__svi18n.info.autoresume||""));k.showMessage({title:a,msg:e,cbYes:function(){k.giveControl(d.numericId);this.destroy();W.isPaused()&&
k.pauseSession(k.sessionInfo.appInfo.numericId,!1)},cbNo:function(){k.refuseControl(d.numericId);this.destroy()}});break;case 6:I.execute("setTouchRemoting",[!0]);break;case 7:d=JSON.parse(c);d.width&&d.height&&bb(d.width,d.height,!0,D.monitorDef&&0<=D.monitor?!0:!1);d.color&&(nb(d.color,!0),svGlobal.logger.warn("Color depth changed to:"+d.color));d.version&&(k.sessionInfo.protocolVersion=d.version);break;case 8:d=JSON.parse(c);Ub=!0;if(k.onrequestcredential&&k.onrequestcredential(d,ya.reconnect))break;
if(k.onautherror&&k.onautherror(d,ya.reconnect))break;I.getFocused().requestCredential(d,ya.reconnect);break;case 9:d=JSON.parse(c);0<d.interval&&0<d.width?Kc(d.width,d.interval):Ma&&(Ma.stop(),Ma=null);break;case 11:d=JSON.parse(c);k.onrequirejoin&&(a=k.onrequirejoin(d));if(a)break;a=__svi18n.info.title.applyArgs([d.name,d.numericId,d.__ip]);k.showMessage({title:a,msg:__svi18n.info.reqjoin,cbYes:function(){k.allowJoin(d.numericId,!0);this.destroy()},cbNo:function(){k.allowJoin(d.numericId,!1);this.destroy()}});
break;case 13:d=JSON.parse(c);"login"==d.type&&Rb();break;case 14:if(d=JSON.parse(c),k.oncontrolchange)k.oncontrolchange(d)}}function mc(a){switch(a.getByte()){case 32:if(!W.isPaused()){var b=a.getLittleEndian16(),c=a.getLittleEndian16(),e=a.getLittleEndian16(),d=void 0,m=void 0;K.noCursorName||(d=a.getLittleEndian32(),k.sessionInfo.appInfo&&(m=k.sessionInfo.appInfo.sessions[d]));Sb(c,e,!0,m,d,b)}}}function Sb(a,b,c,e,d,m){W.isPaused()||I.getFocused().moveCursor(a,b,c,e,d,m)}function ic(a){I.setCursor(a)}
function Lc(a){var b=K.page&&K.page.join||"";if(b.startsWith("http://")||b.startsWith("https://"))return b;if(b.startsWith("/"))return location.origin+b;var c=location.href,e=c.lastIndexOf("/");if(b)return c.substring(0,e+1)+b;b=Pa();c.toLowerCase().startsWith(b.toLowerCase())&&(b=c.substring(0,e));return b+"/"+a}function lc(a){a=JSON.parse(a);Vb=a.session;var b=a.numericId,c=hi5.appcfg.persistentId?window.localStorage:window.sessionStorage;c&&(c.setItem("appInfo.session",Vb),c.setItem("appInfo.numericId",
b));ha(a.appId);a.server||(a.server=Q());if(b=hi5.$("joinSelect"))b.value=a.joinMode;if(b=hi5.$("requestControl"))b.disabled=a.hasControl;a.joined?1!=k.mode&&I.execute("setAutoScale",[!0]):(k.mode=0,X(D.connectif)&&I.setSize(qa,ra),K.disableJoinedAppResize&&(k.windowState=0));var e=Pa();b=Lc("join.html")+"?id="+(a.joined||a.numericId);(c=a.webAddress)&&0<c.length&&c.toLowerCase()!=e.toLowerCase()&&(e=c.indexOf("://"),k.protocol="http"==c.substring(0,e)?"ws":"wss",k.gateway=c,b+="&gateway="+encodeURIComponent(c));
b=k.modifyURL(b);a.joinLink=b;k.sessionInfo.appInfo=a;"isApp"in a&&Ja!==a.isApp&&(Ja=a.isApp,bb(qa,ra,!0,!0),gb||1==k.mode||I.execute("setAutoScale",[!0]));a.ver&&a.ver!=svGlobal.version&&svGlobal.logger.warn("Client:"+svGlobal.version+" server:"+a.ver);K.cursorNameOnly=a.isAssistance;if(k.onsessionstart)k.onsessionstart(k.sessionInfo)}function Ic(a){if(ua){var b=parseInt(a.charAt(0),10);a=a.substring(1);if(5==b)ua.notifyFiles(JSON.parse(a));else{var c=a.split("\t");switch(b){case 1:ua.confirmId(c[0],
c[1],c[2]);break;case 2:ua.read(c[0],parseInt(c[1],10),parseInt(c[2],10));break;case 4:ua.close(c[0]);break;case 9:a='<a href="'+k.modifyURL(Pa()+c[0])+'" download="'+c[1]+'" target="_blank">'+__svi18n.info.fileReady+": "+c[1]+"</a>",__svi18n.info.download&&I.getFocused().showMessage({msg:a,title:__svi18n.info.download,cbNo:function(){ua.removeFile(c[0],!0);this.destroy()},onclick:function(e){"A"==e.target.tagName&&this.destroy()}})}}}}function Hc(a){function b(J){var H=0;J*=m;for(h=0;h<m;h++)H|=
(d[J+h]&255)<<8*h;H>E?(H-=F,H/=-B):H/=E;return H}if(Da.available&&!W.isPaused()){var c=a.indexOf("\t"),e=a.substring(0,c),d=hi5.Base64.dec(a,c+1);1!=V&&(kb||(kb=new MSGSM),d=kb.decode(d,0,d.length));a=db;var m=a>>3,h=0,E=Math.pow(2,a-1)-1,B=-E-1,F=Math.pow(2,a);a=0;c=ka;var S=Math.floor(Math.floor(d.length/m)/c),A=Da.getBuffer(S),v=A.getChannelData(0),t=A.getChannelData(1);for(a=0;a<S;){var p=2*a,r=b(p);1==c?(v[a]=r,t[a]=r):(v[a]=r,t[a]=b(p+1));a++}a=Da.playBuffer(A);setTimeout(function(J){return function(){ba("8A"+
J)}}(e),1E3*a)}}function Fc(a){function b(m){return function(){ba("8A"+m)}}var c=a.getByte(),e=a.getLittleEndian16(),d=Date.now();a.skipPosition(8);a=Wb(a,c,e,0);a*=1E3;Ya||(e+=Date.now()-d+a,setTimeout(b(c+","+e),a))}function Wb(a,b,c,e){if(!hc||W.isPaused())return 0;var d=c=0,m=a.getPosition();b=a.getData();e||(e=a.getEnd()-m);var h=e;if(41222==V)return(c=Da.getContext())&&c.decodeAudioData(b.buffer.slice(m),function(v){v=Da.playBuffer(v);Ya||setTimeout(sendLater(Jb),1E3*v)},function(v){svGlobal.logger.warn(v)}),
0;if(d=1!=V)kb||(kb=new MSGSM),b=kb.decode(b,m,h),m=0,h=b.length;var E=db,B=E>>3,F=Math.floor(h/B),S=a=0,A=0;d||(a=Math.pow(2,E-1)-1,S=-a-1,A=Math.pow(2,E));E=ka;if(qb){m="";if(d){for(;c<h;c++)0<c&&(m+=","),m+=b[c]+","+b[c]+","+b[c]+","+b[c];qb.write(m);return e/65*.025}for(;c<h;)0<c&&(m+=","),d=b[c++]|b[c++]<<8,9>d?d=0:d>a?(d-=A,d/=-S):d/=a,m+=d,1==E&&(m+=","+d);qb.write(m);return e/B/Xa*.6}e=m;m=Math.floor(F/E);h=Da.getBuffer(m);B=h.getChannelData(0);F=h.getChannelData(1);c=0;if(d)for(;c<m;)1==
E?F[c]=B[c]=b[e++]:(B[c]=b[e++],F[c]=b[e++]),c++;else for(;c<m;)d=b[e++]|b[e++]<<8,d>a?(d-=A,d/=-S):d/=a,1==E?B[c]=d:(B[c]=d,d=b[e++]|b[e++]<<8,d>a?(d-=A,d/=-S):d/=a),F[c]=d,c++;return Da.playBuffer(h)}function kc(){sa&&sa.postMessage({type:0,cmd:5,data:{tag:V,channels:ka,samplePerSec:Xa,bitsPerSample:db}})}function rc(a){if(!k.openLink||2E3<a.length)return!1;var b=a.indexOf(";");0<b&&(a=a.substring(b+1));b=a;a=a.toLowerCase();var c=0==a.indexOf("http://")||0==a.indexOf("https://")||0==a.indexOf("ftp://")||
0==a.indexOf("mailto:")||0==a.indexOf("tel:")||0==a.indexOf("callto:");c||(0==a.indexOf("www.")?(c=!0,a="http://"+a):0==a.indexOf("ftp.")&&(c=!0,a="ftp://"+a));return c?0<a.indexOf("\r")||0<a.indexOf("\n")?!1:k.onurlredirection&&k.onurlredirection(b)?!0:(a=I.getFocused())?a.processLink(b):!1:!1}function Mc(a){if(a.startsWith("text/html;<img data-sv-img")){var b=a.indexOf('src="');if(0<b){b+=5;var c=a.indexOf('"',b),e=a.substring(b,c);e=k.modifyURL(e);a=a.substring(0,b)+e+a.substring(c)}}return a}
function Gc(a){if("text/plain;"!=a){if(1666<Date.now()-ya.reqCopyTime&&!(k.onservercopy&&k.onservercopy(a)||rc(a))){var b=I.getFocused();b&&b.copyToClip(Mc(a))}setTimeout(function(){ba("883")},999)}}function Rb(){if(!gb&&(setTimeout(function(){oa&&ba("884")},333),k.onloggedin))k.onloggedin();Xb=gb=!0;Ja&&1!=k.mode&&I.execute("setAutoScale",[!1]);ua&&(ua.enabled=!0);xb&&!Ja&&(W.setContext(I.getFocused().context),I.repaint(0,0,W.width-1,W.height-1))}function ob(a){if(k){hi5.browser.cookie.delete(vb);
svGlobal.logger.warn("closed "+(k.sessionInfo.appInfo?k.sessionInfo.appInfo.numericId:0));k.onagentmessage&&(k.onagentmessage=null);if(k.onagentclose)k.onagentclose();var b=cc();b&&k.sessionInfo.appInfo&&0==k.mode&&(sessionStorage[b]=k.sessionInfo.appInfo.session);if(k&&(b=1!=k.mode,!oa&&b&&tb("connection"),b=b&&(oa||jb<k.reconnectTimes)&&0<jb&&!a,Ka=oa=!1,b)){jb--;__svi18n.info.reconnecting&&k.showMessage(__svi18n.info.reconnecting+" "+(k.reconnectTimes-jb)+"/"+k.reconnectTimes,null,3E3);setTimeout(Ob,
K.reconnectInterval||5E3);svGlobal.logger.info("Reconnecting..."+jb);return}if(Ub)svGlobal.logger.info("Req credential");else{xa&&(k.stopPing(),xa=null);sa&&(sa.removeEventListener("message",dc,!1),sa.postMessage({type:0,cmd:4}),sa.terminate(),sa=null);ua&&(ua.release(),ua=null);za=w=null;ia&&(ia.close(),ia=null);eb&&hi5.Arrays.release(eb);cb&&hi5.Arrays.release(cb);Ma&&(Ma.stop(),Ma=null);Da&&(Da.close(),Da=null);sb=null;try{if(k.onclose)k.onclose(a);else if(svGlobal.logger.info("onclose: null"),
hi5.appcfg&&hi5.appcfg.returnUrl){window.location.href=hi5.appcfg.returnUrl;return}I&&(I.close(),I=null)}catch(c){svGlobal.logger.warn(c)}Ea=null;ea&&(ea.onopen=null,ea.onmessage=null,ea.onclose=null,ea.onerror=null,ea.close(),ea=null);I=ya=null;W&&(W.release(),W=null);hi5.browser.isChromeApp?chrome.runtime.onSuspend.removeListener(k.close):window.removeEventListener("unload",k.close,!1);window&&window.$rdp==k&&(window.$rdp=null);k=null}}}function sc(){ea&&oa?ea.close():ob(!0)}function fc(a,b){var c=
a.getLittleEndian32();if(0!=(c&16777216))if(b=a.getLittleEndian32(),0!=(c&1073741824)){a.getLittleEndian16();a.getByte();c=a.getByte();var e=a.getLittleEndian16(),d=a.getLittleEndian16(),m=0;16>c&&(m=a.getLittleEndian16());var h=a.getLittleEndian16(),E=a.getLittleEndian16();a.getBytes(h);m&&a.getBytes(m);if(8<=c&&(m=I.getFocused())&&m.onremoteappicon){h=new hi5.graphic.Bitmap(e,d,32);a.getPosition();e=new Uint8Array(e*d*4);d=a.getPosition();E=d+E;var B;a=a.getData();for(var F=0,S,A;d<E;)switch(c){case 16:(B=
a[d++]|a[d++]<<8)?(A=B>>7&248,S=B>>2&248,B=B<<3&248,A|=A>>5,S|=S>>5,B|=B>>5,e[F++]=B,e[F++]=S,e[F++]=A,e[F++]=255):F+=4;break;case 32:e[F++]=a[d++],e[F++]=a[d++],e[F++]=a[d++],e[F++]=a[d++]}h.putPixels(e,0,e.length);a=I.getWinById(b);m.onremoteappicon(a,h)}}else 0!=(c&2147483648)?svGlobal.logger.info("XXX rail cache icon, winId="+b):0!=(c&536870912)?(svGlobal.logger.info("***** delete winId="+b),I.delWin(b)):Nc(a,c,b);else if(0!=(c&33554432))svGlobal.logger.info("XXX Alt Sec window Notify="+c);else if(0!=
(c&67108864))if(svGlobal.logger.info("*** -- Alt Sec window Desktop, flags:"+c),0!=(c&1))svGlobal.logger.info("Desktop non monitored flags="+c);else{if(0!=(c&32)&&(b=a.getLittleEndian32(),svGlobal.logger.info("Desktop monitored flags="+c+" winId="+b),0<b&&((m=I.getOwnerSurfaceById(b))&&m.railWin&&m.railWin.setActiveWinId(b,3==K.windowState),I.setTitle(b),W.getContext()||(b=I.getFocused())&&W.setContext(b.context))),0!=(c&16)&&(b=a.getByte(),0<b))for(c=I.zOrders,c.length=b,m=0;m<b;m++)c[m]=a.getLittleEndian32(),
svGlobal.logger.info("---zorders:"+c[m])}else svGlobal.logger.info("XXX Alt Sec window order flgas="+c)}function tc(a){var b=I.getFocused();if(b&&b.railWin){var c=a||b.railWin.mainWin;if(c&&2<c.showState){var e=b.getFreeSpace();a=Math.max(Math.abs(c.winHeight-e.height),Math.abs(c.winWidth-e.width));svGlobal.logger.info("--- fitMainWin offset:"+a+" _hOffset:"+c._hOffset+" appId:"+c.appId+" spaceH:"+e.height);0<a?(b=a==c._hOffset,c._hOffset&&b||(c._hOffset=a,setTimeout(function(){c.resize(0,0,e.width,
e.height)},333))):c._hOffset=0}}}function Nc(a,b,c){Ja||(Ja=!0);var e=0==(b&268435456),d=I.getWinById(c);d?e=!0:d=new I.LocalWin(c);svGlobal.logger.info("\n\n=========== winId="+c+" existed="+e);if(d){0!=(b&2)&&(d.ownerWinid=a.getLittleEndian32(),svGlobal.logger.info("***** ownerWinid="+d.ownerWinid));0!=(b&8)&&(d.style=a.getLittleEndian32(),d.extStyle=a.getLittleEndian32(),svGlobal.logger.info("***** winId="+c+" style="+d.style+" extStyle="+d.extStyle),svGlobal.logger.info("*****--- WS_POPUP="+(0!=
(d.style&2147483648))),svGlobal.logger.info("*****--- WS_DLGFRAME="+(0!=(d.style&4194304))),svGlobal.logger.info("*****--- DS_MODALFRAME="+(0!=(d.style&128))),svGlobal.logger.info("*****--- WS_EX_DLGMODALFRAME="+(0!=(d.extStyle&1))),svGlobal.logger.info("*****--- WS_EX_TOOLWINDOW="+(0!=(d.extStyle&128))),svGlobal.logger.info("*****--- WS_BORDER="+(0!=(d.style&8388608))),svGlobal.logger.info("*****--- WS_CAPTION="+(0!=(d.style&12582912))),svGlobal.logger.info("*****--- WS_OVERLAPPED="+(0!=(d.style&
0))),svGlobal.logger.info("*****--- WS_OVERLAPPEDWINDOW="+(0!=(d.style&13565952))),svGlobal.logger.info("*****--- WS_POPUPWINDOW="+(0!=(d.style&2156396544))),svGlobal.logger.info("*****--- WS_SIZEBOX="+(0!=(d.style&262144))),svGlobal.logger.info("*****--- WS_CHILD="+(0!=(d.style&1073741824))),svGlobal.logger.info("*****--- WS_SIZEBOX="+(0!=(d.style&262144))),svGlobal.logger.info("*****--- WS_EX_MDICHILD="+(0!=(d.extStyle&64))),svGlobal.logger.info("*****--- WS_EX_LAYERED="+(0!=(d.extStyle&524288))));
if(0!=(b&16)){d.setShowState(a.getByte());svGlobal.logger.info("***** winId="+c+" showState="+d.showState);var m=d.showState;(2==m&&0!=K.noMinimize||!e&&3==m&&5==K.windowState)&&setTimeout(function(){d.exeCommand(61728)},50)}if(m=0!=(b&4)){var h=a.getLittleEndian16();d.titleInfo=a.getUnicodeString(h,!1);svGlobal.logger.info("***** winId="+c+" title="+d.titleInfo)}0!=(b&16384)&&(d.clientOffsetX=a.getLittleEndian32(),d.clientOffsetY=a.getLittleEndian32(),svGlobal.logger.info("***** winId="+c+" coffX"+
d.clientOffsetX+" coffY="+d.clientOffsetY));0!=(b&65536)&&(d.clientAreaWidth=a.getLittleEndian32(),d.clientAreaHeight=a.getLittleEndian32(),svGlobal.logger.info("***** winId="+c+" cw"+d.clientAreaWidth+" ch="+d.clientAreaHeight));0!=(b&131072)&&(d.rpContent=a.getLittleEndian32());0!=(b&262144)&&(d.rootParentHandle=a.getLittleEndian32());if(0!=(b&2048)){h=a.getLittleEndian32();var E=a.getLittleEndian32();d.winOffsetX=h;d.winOffsetY=E;svGlobal.logger.info("***** winId="+c+" offX"+d.winOffsetX+" offY="+
d.winOffsetY)}0!=(b&32768)&&(d.winClientDeltaX=a.getLittleEndian32(),d.winClientDeltaY=a.getLittleEndian32(),svGlobal.logger.info("***** winId="+c+" dX"+d.winClientDeltaX+" dY="+d.winClientDeltaY));0!=(b&1024)&&(d.winWidth=a.getLittleEndian32(),d.winHeight=a.getLittleEndian32(),svGlobal.logger.info("***** winId="+c+" w"+d.winWidth+" h="+d.winHeight));if(!e)if(d.isMainWin())3==k.windowState?tc(d):setTimeout(function(){d.activate(1)},666);else if(2<d.showState&&(h=I.getFocused())){h=h.getFreeSpace();
var B=d.winWidth,F=d.winHeight;if(d.winOffsetX>h.width||d.winOffsetY>h.height||0>B+d.winOffsetX||0>F+d.winOffsetY){var S=(h.width-d.winWidth)/2|0,A=(h.height-d.winHeight)/2|0;0>S&&(S=0);0>A&&(A=0);setTimeout(function(){d.resize(S,A,B,F)},50)}}0!=(b&256)&&(h=a.getLittleEndian16(),0<h&&a.skipPosition(8*h));0!=(b&4096)&&(d.visibleOffsetX=a.getLittleEndian32(),d.visibleOffsetY=a.getLittleEndian32());0!=(b&512)&&(b=a.getLittleEndian16(),d.numVisibilityRects=b,0<b&&a.skipPosition(8*b));if(e)I.onWinChange(d);
else I.addWin(d);m&&I.setTitle(c);c==I.zOrders[0]?svGlobal.logger.info("zzz zorders win: "+c):svGlobal.logger.info("zzz win: "+c,I.zOrders)}else svGlobal.logger.warn("XXX, No win with id:"+c)}function $b(a,b){function c(g,l,f,n,q){0<q.width?q.union(g,l,f,n):(q.x=g,q.y=l,q.width=f,q.height=n)}function e(g,l,f,n){for(Aa=0;Aa<Fa;Aa++){var q=fa[Aa];if(g>=q[0]&&l>=q[1]&&f<=q[2]&&n<=q[3])return Ga[Aa]}return null}function d(g,l,f,n){if(Fa){var q=e(g,l,g+f-1,l+n-1);q&&c(g,l,f,n,q)}else c(g,l,f,n,r)}function m(g,
l,f,n,q,u,y){for(var x=q*f+n,z=g.setRGB,G=g.getRGB,C=0;C<y;C++){for(var M=0;M<u;M++){if(g){var ma=G(n+M,q+C);z(n+M,q+C,~ma&16777215)}else l[x]=~l[x]&16777215;x++}x+=f-u}}function h(g,l,f,n,q,u,y,x,z,G){l=G*x+z;null==y&&(y=g);for(g=0;g<u;g++){for(z=0;z<q;z++)t[n+g][f+z]=t[n+g][f+z]&y[l]&16777215|4278190080,l++;l+=x-q}}function E(g,l,f,n,q,u,y,x,z,G){l=G*x+z;z=g.setRGB;G=g.getRGB;null==y&&(y=g);for(g=0;g<u;g++){for(var C=0;C<q;C++){var M=G(f+C,n+g);z(f+C,n+g,M|y[l]&16777215);l++}l+=x-q}}function B(g,
l,f,n){var q=wa;if(q){var u=q.getRGB(l,f);switch(g){case 0:q.setRGB(l,f,0);break;case 1:q.setRGB(l,f,~(u|n)&16777215);break;case 2:q.setRGB(l,f,u&~n&16777215);break;case 3:q.setRGB(l,f,~n&16777215);break;case 4:q.setRGB(l,f,16777215*(~u&n));break;case 5:q.setRGB(l,f,~u&16777215);break;case 6:q.setRGB(l,f,u^n&16777215);break;case 7:q.setRGB(l,f,~u&n&16777215);break;case 8:q.setRGB(l,f,u&n&16777215);break;case 9:q.setRGB(l,f,u^~n&16777215);break;case 10:break;case 11:q.setRGB(l,f,u|~n&16777215);break;
case 12:q.setRGB(l,f,n);break;case 13:q.setRGB(l,f,(~u|n)&16777215);break;case 14:q.setRGB(l,f,u|n&16777215);break;case 15:q.setRGB(l,f,16777215);break;default:svGlobal.logger.warn("unsupported pixel opcode: "+g),q.setRGB(l,f,n)}}}function F(g,l,f,n,q,u,y,x,z){g>x||l>z||(f=g+f-1,f>x&&(f=x),g<u&&(g=u),f=f-g+1,n=l+n-1,n>z&&(n=z),l<y&&(l=y),n=n-l+1,1>f||1>n||wa.fillRect(g,l,f,n,q))}function S(g,l,f,n,q,u,y,x,z,G,C,M){if(!(l>C||f>M)){var ma=l+n-1;ma>C&&(ma=C);z=l<z?z:l;ma=ma-l+1;C=f+q-1;C>M&&(C=M);G=
f<G?G:f;M=C-f+1;if(!(1>ma||1>M)){C=128;var ca=0;y|=4278190080;x|=4278190080;if(z==l&&G==f&&ma==n&&M==q)if(0==g)for(var aa=0;aa<q;aa++){g=f+aa;for(var la=0;la<n;la++)0==C&&(ca++,C=128),0!=(u[ca]&C)&&(t[g][l+la]=x),C>>=1;ca++;C=128;ca==u.length&&(ca=0)}else for(aa=0;aa<q;aa++){g=f+aa;for(la=0;la<n;la++)0==C&&(ca++,C=128),t[g][l+la]=0!=(u[ca]&C)?x:y,C>>=1;ca++;C=128;ca==u.length&&(ca=0)}else if(0==g)for(aa=0;aa<M;aa++){g=f+aa;for(la=0;la<ma;la++)0==C&&(ca++,C=128),l+la>=z&&g>=G&&0!=(u[ca]&C)&&(t[g][l+
la]=x),C>>=1;ca++;C=128;ca==u.length&&(ca=0)}else for(aa=0;aa<M;aa++){g=f+aa;for(la=0;la<ma;la++)0==C&&(ca++,C=128),l+la>=z&&f+aa>=G&&(t[g][l+la]=0!=(u[ca]&C)?x:y),C>>=1;ca++;C=128;ca==u.length&&(ca=0)}}}}function A(g,l,f,n,q){this.offset=g;this.baseLine=l;this.width=f;this.height=n;this.fontData=q}function v(g,l,f,n,q,u,y,x,z){this.cache_idx=g;this.rawData=l;this.none=!l;this.hotX=f;this.hotY=n;this.width=q;this.height=u;this.xorSize=x;this.andSize=z;this.result="";this.distance=0;this.bpp=y;this.system=
"";if(l){if(!this.distance){g=0;if(l){y=0;for(var G=l.length;y<G;y++)0!=l[y]&&(g+=y%q+(y/q|0))}this.distance=g}if(!this.system){a:switch(this.distance){case 507:g="text";break a;case 2046:case 4359:g="default";break a;default:g=""}this.system=g}}g="";if(!this.system&&l){y=q*u*4;g=62+y+x+z;G=new Uint8Array(g);g=new hi5.DataBuffer(G,0,g);g.setLittleEndian16(0);g.setLittleEndian16(2);g.setLittleEndian16(1);g.setByte(q);g.setByte(u);g.setByte(0);g.setByte(0);g.setLittleEndian16(f);g.setLittleEndian16(n);
g.setLittleEndian32(40+y+x+z);g.setLittleEndian32(22);g.setLittleEndian32(40);g.setLittleEndian32(q);g.setLittleEndian32(2*u);g.setLittleEndian16(1);g.setLittleEndian16(32);g.setLittleEndian32(0);g.setLittleEndian32(x+z);g.setLittleEndian32(0);g.setLittleEndian32(0);g.setLittleEndian32(0);g.setLittleEndian32(0);for(f=u-1;0<=f;f--)for(n=0;n<q;n++)u=l[q*f+n],g.setByte(u&255),g.setByte(u>>8&255),g.setByte(u>>16&255),g.setByte(u>>24&255);g="data:image/x-icon;base64,"+hi5.Base64.enc(g.getData())}this.url=
g}var t=[],p=null,r=new hi5.graphic.Rectangle(0,0,0,0),J="Uint8ClampedArray"in window,H=null,R=0,T=0,ja=0,na=0,Y=null,fa,Ga,Aa=0,Fa=0;this.width=a;this.height=b;var Za=!1,wa=this,pa={imgData:null,left:0,top:0,width:0,height:0,drawable:null};this.setProfiler=function(g){H=g};this.getDirtyArea=function(){return r};this.setImgRect=function(g,l,f,n){R=g;T=l;ja=f;na=n};this.setDrawable=function(g){pa.drawable=g};this.getDrawable=function(){return pa.drawable};this.parseMonitorDef=function(g){var l=g.split(","),
f=l.length,n=[];if(1<f){for(var q=!1,u=0;u<f;u++){var y=l[u].split(":");if(4==y.length)n[u]=Array(5),n[u][0]=parseInt(y[0]),n[u][1]=parseInt(y[1]),n[u][2]=parseInt(y[2]),n[u][3]=parseInt(y[3]),n[u][4]=0==n[u][0]&&0==n[u][1]?1:0;else{q=!0;break}}q&&(svGlobal.logger.warn("invaiid monitorDef:"+g),n.length=0)}return n};this.setMonitorLayout=function(g){var l=g.length,f=0;fa=g;for(Ga=Array(l);f<l;f++)Ga[f]=new hi5.graphic.Rectangle(0,0,0,0);Fa=l};this.setMonitorCount=function(g){Fa=g};this.addImg=function(g){ja&&
(Y&&URL.revokeObjectURL(Y.src),Y=g)};this.flushImgs=function(){Y&&(URL.revokeObjectURL(Y.src),Y=null,ja=0)};this.getData=function(){return t};this.pause=function(g,l){Za=g;l&&p&&p.fillRect(0,0,a,b)};this.release=function(){r=null;hi5.Arrays.release(Ga);wa.flushImgs();t=p=wa=null;pa=pa.imgData=null};this.isPaused=function(){return Za};this.setContext=function(g){g!=p&&(p||!g||g.createImageData(1,1).data.buffer||(J=!1),p=g,null!=p&&(pa.imgData=p.createImageData(a,b)))};this.getContext=function(){return p};
this.resize=function(g,l){if(t.length!=l||t[0].length!=g){for(var f=0;f<l;f++)t[f]=new Uint32Array(g);t.length=l;wa.width=a=g;wa.height=b=l;null!=p&&(pa.imgData=p.createImageData(a,b))}};wa.resize(a,b);this.getBuffer=function(){return t};this.setRGB=function(g,l,f){t[l][g]=f|4278190080};this.getRGB=function(g,l){return t[l][g]};this.setRGBs=function(g,l,f,n,q,u,y){var x=g+f,z=l+n;z>b&&(z=b);if(!(g>=a)){x>a&&(f-=x-a);for(x=l;x<z;x++,u+=y)t[x].set(q.subarray(u,u+f),g);d(g,l,f,n)}};this.moveArea=function(g,
l,f,n,q,u){if(0<u){var y=g+q,x=l+u,z;for(z=n-1;0<=z;z--)t[x+z].set(t[l+z].subarray(g,g+f),y)}else if(0>u)for(y=g+q,x=l+u,z=0;z<n;z++)t[x+z].set(t[l+z].subarray(g,g+f),y);else if(0<q){y=g+q;x=l+u;var G;for(z=f-1;0<=z;z--){var C=y+z;var M=g+z;for(G=0;G<n;G++)t[x+G][C]=t[l+G][M]}}else for(y=g+q,x=l+u,z=0;z<f;z++)for(C=y+z,M=g+z,G=0;G<n;G++)t[x+G][C]=t[l+G][M];d(g+q,l+u,f,n)};this.getRGBs=function(g,l,f,n,q){var u=new Uint32Array(f*n),y=g+f;n=l+n;for(var x=0;l<n;l++)u.set(t[l].subarray(g,y),x),x+=f;return q?
(q(u),null):u};this.repaint=function(g,l,f,n){var q=pa.imgData.data,u=0,y,x;H&&H.begin("paint");0>g&&(f+=g,g=0);0>l&&(n+=l,l=0);g+f>a&&(f=a-g);l+n>b&&(n=b-l);var z=g+f;var G=l+n;if(J)for(q=new Uint32Array(q.buffer),x=l;x<G;x++)q.set(t[x].subarray(g,z),u),u+=a;else{var C=4*(a-f)|0;for(x=l;x<G;x++){for(y=g;y<z;y++){var M=t[x][y];q[u++]=M&255;q[u++]=M>>8&255;q[u++]=M>>16&255;q[u++]=255}u+=C}}pa.left=g;pa.top=l;pa.width=f;pa.height=n;H&&H.end("paint");return pa};this.postPaint=d;this.draw=function(g,
l,f,n){if(!Za)if(pa.drawable){if(r.width)return pa.left=r.x,pa.top=r.y,pa.width=r.width,pa.height=r.height,r.width=0,pa}else if(p)if(Y&&Y.complete&&(p.drawImage(Y,R,T,ja,na),URL.revokeObjectURL(Y.src),Y=null),Fa){if(g=e(g,l,f,n),g.width)return wa.repaint(g.x,g.y,g.width,g.height),g.width=0,pa}else if(r.width)return wa.repaint(r.x,r.y,r.width,r.height),r.width=0,pa;return null};this.fillRect=function(g,l,f,n,q){var u=g+f,y=l+n;if(t[0].fill)for(var x,z=l;z<y;z++)t[z].fill(q,g,u);else for(z=l;z<y;z++)for(x=
g;x<u;x++)t[z][x]=q;d(g,l,f,n)};this.drawLine=function(g,l,f,n,q){if(l==n){if(g>f){var u=g;g=f;f=u}var y=t[l];f++;if(y.fill)y.fill(q,g,f);else for(u=g;u<f;u++)y[u]=q}else if(g==f)for(l>n&&(u=l,l=n,n=u),n++,u=l;u<n;u++)t[u][g]=q;else{var x=Math.abs(f-g),z=Math.abs(n-l);u=g;y=l;f=f>=g?g=1:g=-1;l=n>=l?n=1:n=-1;if(x>=z){l=g=0;var G=x;var C=x/2|0;var M=z}else n=f=0,G=z,C=z/2|0,M=x,x=z;if(!(1>x))for(x++,z=0;z<x;z++)t[y][u]=q,C+=M,C>=G&&(C-=G,u+=g,y+=n),u+=f,y+=l}};this.bitBlt=function(g,l,f,n,q,u,y,x,z,
G){var C=wa;switch(g){case 0:x=C.setRGB;for(C=f;C<f+q;C++)for(z=n;z<n+u;z++)x(C,z,0);break;case 1:g=y;z=G*x+z;G=C.setRGB;l=C.getRGB;null==g&&(g=C);for(C=0;C<u;C++){for(y=0;y<q;y++)G(f+q,n+u,~(l(f+q,n+u)|g[z])&16777215);z+=x-q}break;case 2:g=y;z=G*x+z;G=C.setRGB;l=C.getRGB;null==g&&(g=C);for(C=0;C<u;C++){for(y=0;y<q;y++){var M=l(f+q,n+u);G(f+q,n+u,M&~g[z]&16777215);z++}z+=x-q}break;case 3:m(C,y,x,z,G,q,u);y?C.setRGBs(f,n,q,u,y,G*x+z,x):C.moveArea(z,G,q,u,f-z,n-G);break;case 4:m(C,null,l,f,n,q,u);h(C,
l,f,n,q,u,y,x,z,G);break;case 5:m(C,null,l,f,n,q,u);break;case 6:g=y;z=G*x+z;null==g&&(g=C);for(C=0;C<u;C++){for(G=0;G<q;G++)t[n+C][f+G]=t[n+C][f+G]^g[z]&16777215|4278190080,z++;z+=x-q}break;case 7:g=y;z=G*x+z;G=C.setRGB;l=C.getRGB;null==g&&(g=C);for(C=0;C<u;C++){for(y=0;y<q;y++)M=l(f+y,n+C),G(f+y,n+C,~(M&g[z])&16777215),z++;z+=x-q}break;case 8:h(C,l,f,n,q,u,y,x,z,G);break;case 9:g=y;z=G*x+z;G=C.setRGB;l=C.getRGB;null==g&&(g=C);for(C=0;C<u;C++){for(y=0;y<q;y++)M=l(f+y,n+C),G(f+y,n+C,M^~g[z]&16777215),
z++;z+=x-q}break;case 10:break;case 11:g=y;z=G*x+z;G=C.setRGB;l=C.getRGB;null==g&&(g=C);for(C=0;C<u;C++){for(y=0;y<q;y++)M=l(f+y,n+C),G(f+y,n+C,M|~g[z]&16777215),z++;z+=x-q}break;case 12:y?C.setRGBs(f,n,q,u,y,G*x+z,x):C.moveArea(z,G,q,u,f-z,n-G);break;case 13:m(C,null,l,f,n,q,u);E(C,l,f,n,q,u,y,x,z,G);break;case 14:E(C,l,f,n,q,u,y,x,z,G);break;case 15:x=C.setRGB;for(C=f;C<f+q;C++)for(z=n;z<n+u;z++)x(C,z,16777215);break;default:svGlobal.logger.warn("unsupported opcode: "+g)}d(f,n,q,u)};this.drawLineExt=
function(g,l,f,n,q,u){if(g==f||l==n){var y;if(l==n)if(f>g){var x=f-g;if(!(1>x))for(y=0;y<x;y++)B(u,g+y,l,q)}else{if(x=g-f,!(1>x))for(y=0;y<x;y++)B(u,f+y,l,q)}else if(n>l){if(x=n-l,!(1>x))for(y=0;y<x;y++)B(u,g,l+y,q)}else if(x=l-n,!(1>x))for(y=0;y<x;y++)B(u,g,n+y,q)}else{var z=Math.abs(f-g),G=Math.abs(n-l);y=g;x=l;var C,M;var ma=f>=g?C=1:C=-1;var ca=n>=l?M=1:M=-1;if(z>=G){ca=C=0;var aa=z;var la=z/2>>0;var Ca=G}else M=ma=0,aa=G,la=G/2>>0,Ca=z,z=G;if(1>z)return;for(G=0;G<=z;G++)B(u,y,x,q),la+=Ca,la>=
aa&&(la-=aa,y+=C,x+=M),y+=ma,x+=ca}q=Math.min(g,f);g=Math.max(g,f);f=Math.min(l,n);l=Math.max(l,n);0>g-q||0>l-f||d(q,f,g-q+1,l-f+1)};this.drawText=function(g,l,f,n,q,u,y,x,z,G,C,M,ma,ca,aa,la,Ca,yb,zb,Ab,Bb){var Ha=0;1<M?F(G,C,M,ma,q,yb,zb,Ab,Bb):1==f&&F(u,y,x,z,q,yb,zb,Ab,Bb);for(var Oc=la,va=0;va<la;)switch(Ca[Ha+va]){case 255:var Ba=Ca[Ha+va+2];if(Ba>Oc-Ha){va=la=0;break}Ba=Ca.slice?Ca.slice(Ha,Ha+Ba):Ca.subarray(Ha,Ha+Ba);Na[Ca[Ha+va+1]]=Ba;va+=3;la-=va;Ha=va;va=0;break;case 254:var Va=(Ba=Na[Ca[Ha+
va+1]])?Ba:null;Va&&0==Va[1]&&0==(l&32)&&(0!=(l&4)?aa+=Ca[Ha+va+2]:ca+=Ca[Ha+va+2]);va=va+2<la?va+3:va+2;la-=va;Ha=va;va=0;if(!Va)break;for(var Pc=Va.length,$a=0;$a<Pc;$a++){Ba=Ia.getFont(g,Va[$a]);if(0==(l&32)){var hb=Va[++$a];0!=(hb&128)?(0!=(l&4)?aa+=Va[$a+1]|Va[$a+2]<<8:ca+=Va[$a+1]|Va[$a+2]<<8,$a+=2):0!=(l&4)?aa+=hb:ca+=hb}Ba&&(S(f,ca+Ba.offset&65535,aa+Ba.baseLine&65535,Ba.width,Ba.height,Ba.fontData,q,n,yb,zb,Ab,Bb),0!=(l&32)&&(ca+=Ba.width))}break;default:Ba=Ia.getFont(g,Ca[Ha+va]),0==(l&
32)&&(hb=Ca[Ha+ ++va],0!=(hb&128)?(0!=(l&4)?aa+=Ca[Ha+va+1]|Ca[Ha+va+2]<<8:ca+=Ca[Ha+va+1]|Ca[Ha+va+2]<<8,va+=2):0!=(l&4)?aa+=hb:ca+=hb),Ba&&(S(f,ca+Ba.offset&65535,aa+Ba.baseLine&65535,Ba.width,Ba.height,Ba.fontData,q,n,yb,zb,Ab,Bb),0!=(l&32)&&(ca+=Ba.width)),va++}1<M?0<ma&&d(G,C,M,ma):0<x&&0<z&&d(u,y,x,z)};this.drawBitmap=function(g,l,f,n,q,u,y,x,z){var G=La.getBitmap(g,l);G?(g=G.width,l=G.height,q>g&&(q=g),u>l&&(u=l),12==z?wa.setRGBs(f,n,q,u,G.data,x*g+y,g):wa.bitBlt(z,a,f,n,q,u,G.data,g,y,x)):
svGlobal.logger.warn("Failed to get bitmap from cache, id:"+g+" idx="+l)};this.saveDesktop=function(g,l,f,n,q){wa.getRGBs(g,l,f,n,function(u){ta.save(g,l,f,n,q,u)})};this.restoreDesktop=function(g,l,f,n,q){(q=ta.restore(g,l,f,n,q))?wa.setRGBs(g,l,f,n,q,0,f):svGlobal.logger.warn("XXX no matched desktop save.")};this.putFont=function(g,l,f){Ia.putFont(g,l,f)};this.putBitmap=function(g,l,f){La.putBitmap(g,l,f)};this.putCursor=function(g,l){da.set(g,l)};this.setCursor=function(g){if(!Za&&-1!=g){var l=
da.get(g);if(l)wa.onSetCursor(l);else svGlobal.logger.warn("invalid cursor"+g)}};var Z=0;this.isSendingHistory=function(){return 2E3>Date.now()-Z};this.getHistory=function(g,l){var f=null;(f=da.toPDU())&&g(f.buffer);if(wa.onGetGfxHistory)wa.onGetGfxHistory(g,l);else{H&&H.begin("his_bitmap");La.forEach(function(x,z,G){if(x){var C=0,M=0;G=0;for(var ma=x.length;G<ma;G++)x[G]&&x[G].data&&(C++,M+=x[G].raw?x[G].raw.length:4*x[G].data.length);if(C&&M){f=new Uint8Array(M+20*C+8);f[0]=29;f[2]=1;f[3]=4;M=new hi5.DataBuffer(f,
4,f.length);M.setLittleEndian32(C);for(G=0;G<ma;G++)(C=x[G])&&C.data&&(M.setLittleEndian16(z),M.setLittleEndian16(G),M.setLittleEndian16(C.left),M.setLittleEndian16(C.top),M.setLittleEndian16(C.width),M.setLittleEndian16(C.height),M.setLittleEndian16(C.bitsperpixel),M.setLittleEndian16(C.codec),M.setLittleEndian32(C.raw?C.raw.length:4*C.data.length),M.setBytes(C.raw||new Uint8Array(C.data.buffer)));g(f.buffer)}}});H&&H.end("his_bitmap");H&&H.begin("his_font");(f=Ia.toPDU())&&g(f.buffer);H&&H.end("his_font");
for(var n=4,q=0,u=Na.length;q<u;q++)Na[q]&&(n+=Na[q].length+6);if(4<n){f=new Uint8Array(n);f[0]=29;f[2]=1;f[3]=7;var y=4;q=0;for(u=Na.length;q<u;q++)Na[q]&&Na[q].length&&(f[y++]=q,f[y++]=q>>8,n=Na[q].length,f[y++]=n,f[y++]=n>>8,f[y++]=n>>16,f[y++]=n>>24,f.set(Na[q],y),y+=n);g(f.buffer)}(f=ta.toPDU())&&g(f.buffer);l();Z=Date.now()}};this.onHistoryDone=function(){pa.drawable&&k.reconnect(a,b,!0)};this.setHistory=function(g,l){svGlobal.logger.info("setHistory type:"+g);switch(g){case 4:H&&H.begin("his_bitmap_dec");
var f=l.getLittleEndian32();for(g=0;g<f;g++){var n=l.getLittleEndian16(),q=l.getLittleEndian16(),u=l.getLittleEndian16(),y=l.getLittleEndian16(),x=l.getLittleEndian16(),z=l.getLittleEndian16(),G=l.getLittleEndian16(),C=l.getLittleEndian16(),M=l.getLittleEndian32(),ma=new Uint8Array(l.getData().buffer,l.getPosition(),M),ca=new Uint8Array(M);ca.set(ma);ma=rdpcodecs.bitmap;switch(C){case 0:var aa=new Uint32Array(ca.buffer);l.skipPosition(M);break;case 1:switch(G){case 16:aa=ma.decompressInt16(x,z,M,
ca,0);break;case 24:aa=ma.decompressInt24(x,z,M,ca,0);break;case 32:aa=ma.decompressInt32(x,z,M,ca,0)}l.skipPosition(M);break;case 2:aa=new rdpcodecs.NSCodec,aa.process(l,G,x,z),M=aa.getData(),aa=aa.getDataSize(),aa=new Uint32Array(aa),rdpcodecs.flipimage(M,0,aa,x,z,1)}La.putBitmap(n,q,new rdpcodecs.Bitmap(aa,x,z,u,y,G,0==C?null:ca,C))}H&&H.end("his_bitmap_dec");break;case 5:Ia.fromStream(l);break;case 6:da.fromStream(l);break;case 7:for(;l.has(6);)if(g=l.getLittleEndian16(),M=l.getLittleEndian32())f=
l.getData().subarray(l.getPosition(),l.getPosition()+M),Na[g]=f,l.skipPosition(M);break;case 9:ta.fromStream(l);break;default:if(wa.onSetGfxHistory)wa.onSetGfxHistory(g,l)}};var da=new function(){var g=[],l=!1;this.useRemoteCursor=function(f){l=f};this.set=function(f,n){l&&(n.system="");g[f]=n};this.get=function(f){return g[f]};this.total=function(){return g.length};this.toPDU=function(){for(var f=2,n=2,q=0,u=0,y=g.length,x;u<y;u++)if(x=g[u])q++,n=n+7+(x.rawData?x.rawData.length:0);if(!q)return null;
n=new Uint32Array(n);n[0]=100728861;n[1]=q;for(u=0;u<y;u++)if(x=g[u])if(q=x.rawData?x.rawData.length:0,n[f++]=x.cache_idx|x.bpp<<16,n[f++]=x.hotX|x.hotY<<16,n[f++]=x.width|x.height<<16,n[f++]=x.xorSize,n[f++]=x.andSize,n[f++]=x.distance,n[f++]=q)n.set(x.rawData,f),f+=q;return n};this.fromStream=function(f){var n=f.getPosition();f=new Uint32Array(f.getData().buffer,n);var q=f[0],u=0;for(n=1;u<q;u++){var y=f[n]&65535;var x=f[n++]>>16;var z=f[n]&65535;var G=f[n++]>>16;var C=f[n]&65535;var M=f[n++]>>
16;var ma=f[n++];var ca=f[n++];var aa=f[n++];var la=f[n++];var Ca=null;la&&(Ca=new Uint32Array(la),Ca.set(f.subarray(n,n+la)),n+=la);x=new v(y,Ca,z,G,C,M,x,ma,ca);aa&&(x.distance=aa);l&&(x.system="");g[y]=x}}};da.useRemoteCursor(!!K.remoteCursor);var ta=new function(){function g(f,n,q,u,y,x){this.x=f;this.y=n;this.cx=q;this.cy=u;this.offset=y;this.data=x}var l=[];this.save=function(f,n,q,u,y,x){f=new g(f,n,q,u,y,x);n=0;for(q=l.length;n<q;n++)if(!l[n]){l[n]=f;return}l.push(f)};this.restore=function(f,
n,q,u,y){for(var x,z=0,G=l.length;z<G;z++)if((x=l[z])&&x.x==f&&x.y==n&&x.cx==q&&x.cy==u){if(x.offset==y)return f=x.data,l[z]=null,f;svGlobal.logger.warn("TODO: offset")}return null};this.toPDU=function(){for(var f=0,n=2,q=0,u=l.length;q<u;q++)l[q]&&(f++,n+=l[q].data.length+6);if(!f||!n)return null;n=new Uint32Array(n);var y=2;n[0]=151060509;n[1]=f;for(q=0;q<u;q++)if(f=l[q])n[y++]=f.x,n[y++]=f.y,n[y++]=f.cx,n[y++]=f.cy,n[y++]=f.offset,n[y++]=f.data.length,n.set(f.data,y),y+=f.data.length;return n};
this.fromStream=function(f){f=new Uint32Array(f.getData().buffer,f.getPosition());for(var n=1,q=f[0],u,y,x,z,G,C,M,ma=0;ma<q;ma++)u=f[n++],y=f[n++],x=f[n++],z=f[n++],G=f[n++],C=f[n++],M=new Uint32Array(C),C=n+C,M.set(f.subarray(n,C)),n=C,this.save(u,y,x,z,G,M)}},Na=[],Ia=new function(){var g=[];this.putFont=function(l,f,n){g[l]||(g[l]=[]);g[l][f]=n};this.getFont=function(l,f){return g[l]?g[l][f]:null};this.toPDU=function(){var l=0,f,n,q;var u=4;for(var y,x=g.length;l<x;l++)if((q=g[l])&&q.length)for(y=
q.length,f=0;f<y;f++)(n=q[f])&&(u+=15+n.fontData.length);if(5>u)return null;var z=new Uint8Array(u);u=new hi5.DataBuffer(z,0,u);z[0]=29;z[2]=1;z[3]=5;u.skipPosition(4);l=0;for(x=g.length;l<x;l++)if((q=g[l])&&q.length)for(y=q.length,f=0;f<y;f++)if(n=q[f])u.setByte(l),u.setLittleEndian16(f),u.setLittleEndian16(n.offset),u.setLittleEndian16(n.baseLine),u.setLittleEndian16(n.width),u.setLittleEndian16(n.height),u.setLittleEndian32(n.fontData.length),u.setBytes(n.fontData);return z};this.fromStream=function(l){for(;l.has(15);){var f=
l.getByte(),n=l.getLittleEndian16(),q=l.getLittleEndian16(),u=l.getLittleEndian16(),y=l.getLittleEndian16(),x=l.getLittleEndian16(),z=l.getLittleEndian32();z=l.getBytes(z);this.putFont(f,n,new A(q,u,y,x,z))}}},La=new function(){var g=[],l=[];this.putBitmap=function(f,n,q){if(32767==n)l[f]&&(l[f].data=null,l[f]=null),l[f]=q;else{var u=g[f];u?u[n]&&(u[n].data=null,u[n]=null):g[f]=u=[];u[n]=q}};this.getBitmap=function(f,n){return 32767==n?l[f]:g[f]?g[f][n]:null};this.forEach=function(f){for(var n=g.length,
q=0;q<n;q++)f(g[q],q,g)}}}this.displayMsg=this.reconnectOnResize=!0;this.appTimeout=1600;this.reconnectTimes=0;this.windowState=3;this.setTitle=this.openLink=!0;this.sessionInfo={domain:"",userName:"",sessionId:0,joinedSessions:[],suppressOutput:!1,appInfo:null,joiners:[]};this.mode=0;this.remoteAppLogin=!0;var xb=!1,eb={},cb={},pb=null,k=this,Ub=!1,Ka=!1,Ra=0,qb=null,rb=null,uc=0;hi5.appcfg||(hi5.appcfg={img:{},toolbar:{fadable:!0},displayMsg:!0});var K=hi5.appcfg,vb="";this.setConfig=function(a){K=
a};var Qa="object"==typeof w?w:null,D=Qa?{}:hi5.tool.queryToObj(w.substring(w.indexOf("?")+1));void 0==D.mapClipboard&&K.clipboard&&void 0!=K.clipboard.enabled&&(D.mapClipboard=K.clipboard.enabled);var qa=0,ra=0,Wa=(U||D.color||D.server_bpp||16)|0,kb=null,vc=null,xa=null,ub=null,wc="/DOWNLOAD?",xc="/CLIP?";24==Wa&&(Wa=16);var Ja="app"==D.startProgram,wb=X(D.mapDisk),fb=0;this.setLinks=function(a){a.download&&(wc=a.download);a.clipboard&&(xc=a.clipboard)};this.protocol=Qa?"":w.substring(0,w.indexOf("://")).toLowerCase();
this.hasSmartCard=function(){return X(D.smartCard)||X(D.mapSmartCard)||X(D.passwordIsPin)};this.hasScanner=function(){return X(D.scanner)};this.hasUSB=function(){return X(D.mapUSB)&&!!navigator.usb};this.getUSB=function(){return D.usb||hi5.appcfg.usb||{filters:[{classCode:0},{classCode:2},{classCode:5},{classCode:6},{classCode:10},{classCode:13},{classCode:239},{classCode:220},{classCode:239},{classCode:254},{classCode:255}]}};this.setProfiler=function(a){vc=a};this.getProfiler=function(){return vc};
this.gateway=function(){if(Qa)return"";var a=w.lastIndexOf("/RDP?");-1==a&&(a=w.lastIndexOf("/JOIN?"));-1==a&&(a=w.lastIndexOf("/PLAY?"));return w.substring(0,a).replace(/wss:\/\//ig,"https://").replace(/ws:\/\//ig,"http://")}();svGlobal.logger.warn("Ver:"+svGlobal.version+" build:"+svGlobal.build);this.getGatewayAddr=Pa;var Ya="object"==typeof w||0<w.indexOf("/PLAY?"),yc=!Ya&&0<w.indexOf("invitation=");if(yc){var Yb=decodeURIComponent(w),Cb=Yb.indexOf(' USERNAME="');if(0<Cb){Cb+=11;var Qc=Yb.substring(Cb,
Yb.indexOf('"',Cb));w+="&novice="+Qc}w+="&mapClipboard=on";D.mapClipboard="on";this.reconnectOnResize=!1}if(Ya)this.mode=1,Qa?w="":(qa=640,ra=480),w+="&touchpad=on",D.touchpad="on",this.reconnectOnResize=!1;else if(0<w.indexOf("/JOIN?")||yc)this.mode=2,this.reconnectOnResize=!1;var Zb=X(D.gfx)||X(D.remotefx)||0<k.mode;Zb&&(Ja?Zb=!1:Wa=32);L?qa=parseInt(L):D.width&&(qa=parseInt(D.width));P?ra=parseInt(P):D.height&&(ra=parseInt(D.height));-1==qa&&(qa=hi5.browser.getScreenWidth());-1==ra&&(ra=hi5.browser.getScreenHeight());
D.symlink&&D.parameters&&hi5.tool.queryToObj(D.parameters,D);D.gateway||(w+="&gateway="+encodeURIComponent(k.gateway));!D.minWidth&&K.minWidth&&(D.minWidth=K.minWidth);!D.minHeight&&K.minHeight&&(D.minHeight=K.minHeight);D.minWidth&&(D.minWidth=parseInt(D.minWidth));D.minHeight&&(D.minHeight=parseInt(D.minHeight));D.waWidth=D.waWidth?parseInt(D.waWidth):hi5.browser.isAndroid||hi5.browser.isiOS?Math.max(screen.width,screen.height):screen.width;D.waWidth&=-4;D.waHeight=D.waHeight?parseInt(D.waHeight):
hi5.browser.isAndroid||hi5.browser.isiOS?Math.max(screen.width,screen.height):screen.height;D.waHeight&=-4;"useSSL"in D||(w+="&useSSL="+("wss"==k.protocol));hi5.storage.isAvailable&&(X(D.shareClipboard)||D.shareClipboardId)&&(w+="&shareClipboardId="+(D.shareClipboardId||O()));K&&(void 0!=K.displayMsg?this.displayMsg=K.displayMsg:K.displayMsg=this.displayMsg,K.appTimeout&&(this.appTimeout=K.appTimeout),void 0!=K.reconnectOnResize&&(this.reconnectOnResize=K.reconnectOnResize),K.reconnectTimes&&(this.reconnectTimes=
K.reconnectTimes),void 0!=K.windowState&&(this.windowState=K.windowState),void 0!=K.openLink&&(this.openLink=K.openLink),void 0!=K.setTitle&&(this.setTitle=K.setTitle),"boolean"==typeof K.useWSS&&(w=(K.useWSS?"wss":"ws")+w.substring(w.indexOf("://"))),"boolean"==typeof K.remoteAppLogin&&(this.remoteAppLogin=K.remoteAppLogin,xb=!K.remoteAppLogin,svGlobal.logger.warn("remoteAppLogin deprecated, use hideLogin in appcfg.js instead")),"boolean"==typeof K.hideLogin&&(xb=K.hideLogin),void 0!=K.localPrinter&&
void 0==D.localPrinter&&(D.localPrinter=K.localPrinter));var ua=null;void 0==K.useWorker&&(K.useWorker=!1);K.useWorker&&(!window.Worker||hi5.browser.isFirefox||Ja&&!hi5.browser.isIE||"file:"==location.protocol||0<navigator.userAgent.indexOf("MSIE 10."))&&(K.useWorker=!1);void 0==hi5.libMin&&(hi5.libMin=!0);var sa=K.useWorker?new Worker(N("rdpworker",hi5.libMin?"rdpworker_min.js":"rdpworker.js")):null,jb=this.reconnectTimes,Hb=sa?{type:5,data:null}:null;this.getDisplayName=Q;this.server=Q();this.port=
parseInt(D.port,10);this.loadbalanceToken="";K.loadbalanceTokenName&&(D[K.loadbalanceTokenName]?ha(D[K.loadbalanceTokenName]):!1!==K.randomAppId?ha(hi5.tool.uuid()):svGlobal.logger.info("Using app.id as loadbalanceToken"));this.modifyURL=function(a){k.loadbalanceToken&&(a+=-1==a.indexOf("?")?"?"+k.loadbalanceToken:"&"+k.loadbalanceToken,a+="&loadbalanceTokenName="+K.loadbalanceTokenName);return a};this.getURL=function(){return w};this.getRuntimeURL=function(){var a=w+"&width="+qa+"&height="+ra+"&server_bpp="+
Wa+"&audio="+(Da.available||hi5.browser.isIE),b=cc(),c="";b&&(c=sessionStorage[b]||"")&&(c="&preSymJoin="+c);a+=c;var e=D.monitorDef,d=D.monitor,m=0;b=I.size();var h=Array(b);c=Array(b);var E=0,B=0,F=0,S=0,A=0,v=0,t="";if(e){c=W.parseMonitorDef(e);for(b=c.length;m<b;m++){var p=c[m];p[0]<F&&(F=p[0]);p[1]<S&&(S=p[1]);p[2]>A&&(A=p[2]);p[3]>v&&(v=p[3])}0>F&&(E=-F);0>S&&(B=-S);p=0>d?[F,S,A,v]:c[d];D.width=p[2]-p[0]+1;D.height=p[3]-p[1]+1;m=I.getSurface(0);m.setMonitor(p[0],p[1],p[2],p[3]);if(E||B)for(p=
m.getMousePosition(),p.left+=E,p.right+=E,p.top+=B,p.bottom+=B,m=0;m<b;m++)p=c[m],p[0]+=E,p[1]+=B,p[2]+=E,p[3]+=B;W.setMonitorLayout(c);0>d&&W.setMonitorCount(0);k.reconnectOnResize=!1;b="&monitorDef="+e+"&width="+D.width+"&height="+D.height}else{if(1<b&&!Ja){for(I.verifyMonitors();m<b;m++)e=I.getSurface(m),p=e.getMousePosition(),p.left<F&&(F=p.left),p.top<S&&(S=p.top),p.right>A&&(A=p.right),p.bottom>v&&(v=p.bottom),h[m]=p,t&&(t+=","),t+=p.left+":"+p.top+":"+p.right+":"+p.bottom;0>F&&(E=-F);0>S&&
(B=-S);for(m=0;m<b;m++){p=I.getSurface(m).getMousePosition();if(E||B)p.left+=E,p.right+=E,p.top+=B,p.bottom+=B;c[m]=[p.left,p.top,p.right,p.bottom,p.left==E&&p.top==B?1:0]}W.setMonitorLayout(c);k.reconnectOnResize=!1}t&&(svGlobal.logger.warn("MonitorDef:"+t),D.width=A-F+1,D.height=v-S+1,t="&monitorDef="+t+"&width="+D.width+"&height="+D.height);b=t}a+=b;0>w.indexOf("waWidth")&&(b=(b=I.getFocused())?b.getWindow():window,a+="&waWidth="+D.waWidth+"&waHeight="+D.waHeight+"&dpWidth="+b.innerWidth+"&dpHeight="+
b.innerHeight);b=new Date;D.tzOffset||(a+="&tzOffset="+b.getTimezoneOffset());D.timezone||(c=hi5.timezone.getTimeZone())&&(a+="&timezone="+encodeURIComponent(c.standardName));a+="&time="+b.getTime();void 0==D.soundPref&&(D.soundPref=0,a+="&soundPref=0");E=c=b="";for(E in eb)B=eb[E],"flags"in B&&(b&&(b+=",",c+=","),b+=B.name,c+=B.flags);b&&(a=a+("&channelName="+b)+("&channelFlags="+c));b="";for(E in cb)B=cb[E],"flags"in B&&(b&&(b+=","),b+=B.name);b&&(a+="&gwChannelName="+b);if(c=Ac())b=c.account,c=
c.session,b&&(a+="&account="+b),c&&(a+="&session="+c);b=hi5.browser.isTouch&&(1024<=window.innerWidth||768<=window.innerHeight);D.audioRecord=X(D.audioRecord)&&hi5.audio.recordable;ia.init(b,Zb,D.audioRecord,D.soundPref,X(D.mapCamera)&&!!navigator.mediaDevices,X(D.mapUSB)&&!!navigator.usb);D.audioRecord&&(a+="&audioRecord=on");D.decompressingRDP61&&(a+="&decompressingRDP61=on");0<ia.count&&(a+="&dvcChannels="+ia.names.join(","));a+="&binary=on";K.existingFile&&(a+="&existingFile="+K.existingFile);
a+="&isTouch="+b+"&gatewayAddr="+encodeURIComponent(Pa());a=k.modifyURL(a);K.copyTextOnly&&X(D.mapClipboard)&&(a+="&copyTextOnly=on");(b=hi5.browser.cookie.get("__SV_TOKEN_A"))&&(a+="&__SV_TOKEN_A="+encodeURIComponent(b));(b=svGlobal.Rdp.languageToKeyboard.detect())&&(a+="&_keyboard="+b);X(D.textPrinter)&&(a+="&printerDriver="+encodeURIComponent("Generic / Text Only"));return a+=Ec()};this.getColor=function(){return Wa};this.changeTitle=Ua;hi5.browser.isTouch&&Math.max(qa,ra)>Math.max(window.innerWidth,
window.innerHeight)&&(this.reconnectOnResize=!1);this.isRemoteApp=function(){return Ja};var ea=null,oa=!1,gb=!1,Xb=!1,Da=new function(){var a=null;this.supportWebAudio=this.available=!1;(0==D.playSound||0<k.mode)&&(a=hi5.audio.getAudioContext())&&hi5.audio.playable&&(this.supportWebAudio=this.available=!0);this.getContext=function(){return a};this.getBuffer=function(d){return a.createBuffer(2,d,Xa)};var b=0,c=null,e=null;this.setVolume=function(d){1==d?c=null:(c||(c=a.createGain()),c.gain.value=d)};
this.playBuffer=function(d){e=a.createBufferSource();e.buffer=d;c?(e.connect(c),c.connect(a.destination)):e.connect(a.destination);var m=a.currentTime,h=0<b?b:m;h<m&&(h=m);b=h+d.duration;e.start?e.start(h):e.noteOn(h);return b-m};this.iOSFix=function(){if(a&&hi5.browser.isSafari){var d=this.getBuffer(1024),m=a.createBufferSource();m.buffer=d;m.connect(a.destination);m.start?m.start(0):m.noteOn(0)}};this.close=function(){a&&(c&&c.disconnect(),e&&e.disconnect(),hi5.audio.releaseAudioContext())}},hc=
Da.available,W=new $b(200,200);W.onSetCursor=ic;this.setVolume=function(a){Da&&Da.setVolume(a)};this.setAudioBuffer=function(a){};var Eb=0,Db=0,Fb=qa-1,Gb=ra-1,Vb="";window.$rdp||(window.$rdp=this);nb(Wa);this.setResolution=bb;this.running=function(){return oa};this.setJoinMode=function(a){oa&&ba("8E1"+a)};this.setJoinCloseMode=function(a){oa&&ba("8EB3\t"+a)};this.refuseControl=function(a){oa&&ba("8E3"+a)};this.giveControl=function(a){oa&&ba("8E4"+a)};this.pauseSession=function(a,b){oa&&ba("8EB"+
(b?1:0)+"\t"+a)};this.closeSession=function(a){oa&&ba("8EB2\t"+a)};this.requestControl=function(){oa&&ba("8E2")};this.saveSession=function(a){oa&&ba("8E9"+(a.save?1:0)+"\t"+(a.timeout||0)+"\t"+(a.id||0))};this.allowJoin=function(a,b){oa&&ba("8EA"+a+"\t"+(b?1:0))};var sb=new function(){function a(){if(c&&0<c.length){var m=c.shift();m.key?sb.sendSingleKey(m.down,m.key):m.char&&ac(m.char);0<c.length?setTimeout(a,e):(c=null,d&&d())}}var b={" ":57,space:57,pgup:201,pageup:201,pgdn:209,pagedown:209,end:207,
home:199,left:203,up:200,right:205,down:208,printscreen:183,insert:210,del:211,"delete":211,altgr:184,windows:219,windowsright:220,context:221,esc:1,backspace:14,back:14,tab:15,enter:28,meta:29,command:29,ctrl:29,shift:42,alt:56,capslock:58,f1:59,f2:60,f3:61,f4:62,f5:63,f6:64,f7:65,f8:66,f9:67,f10:68,f11:87,f12:88,numlock:69,scrolllock:70,add:78};this.sendSingleKey=function(m,h){var E=b[h.toLowerCase()];E?k.writeScancode(m,E):(E=h.length,0!=E&&(1==E?k.writeKeyCode(m,h.toUpperCase().charCodeAt(0)):
m&&k.writeText(h)))};var c=null,e=0,d=null;this.sendKeyComb=function(m,h,E){if(Ka){m=m.split("+");var B=m.length,F;if(0!=B){var S=null,A=[];for(F=0;F<B;F++){var v=m[F];""==v&&""==S&&(v="Add");""!=v&&A.push({key:v,down:!0});S=v}B=A.length;for(F=B-1;0<=F;F--)A.push({key:A[F].key,down:!1});if(h)c=A,e=h,d=E,a();else for(F=0,B=A.length;F<B;F++)sb.sendSingleKey(A[F].down,A[F].key)}}};this.sendText=function(m,h,E){for(var B=[],F=0,S=m.length;F<S;F++)B.push({"char":m.charAt(F)});c=B;e=h;d=E;a()}};this.writeKeyComb=
function(a,b,c){Ka&&sb.sendKeyComb(a,b,c)};this.writeText=function(a,b,c){if(Ka)if(b)sb.sendText(a,b,c);else for(b=0,c=a.length;b<c;b++)ac(a.charAt(b))};this.writeClipboard=function(a,b){a&&(b||(b="text/plain"),k.writeRawInput("880"+b+"\t"+a.hashCode()),rb={type:b,text:a})};var I=new function(a,b){function c(){function d(A){for(;0<A.ownerWinid;){var v=F.getWinById(A.ownerWinid);if(v&&v.isVisible())A=v;else break}return A}function m(A){for(var v="";A;)A.titleInfo&&(v=A.titleInfo),A=F.getWinById(A.ownerWinid);
return v}var h=[],E=[],B=0,F=this;this.mainWin=null;this.appId="";var S=0;this.getActiveWinId=function(){return S};this.setActiveWinId=function(A,v){svGlobal.logger.info("setActiveWinId: "+A+" old: "+S+" max: "+v);if(S!=A){var t=0==S;S=A;(A=F.getMainByWinId(A))&&A.isMainWin()&&F.mainWin!=A&&(F.mainWin=A);t&&v&&(v=I.getFocused())&&(v=v.getFreeSpace(),A=v.width,k.resetSize(A,v.height))}};this.onchange=function(A){A.isVisible()||A!=F.mainWin?A.isVisible()&&!F.mainWin&&A.isMainWin()&&(F.mainWin=A,3==
a.windowState&&A.exeCommand(61488)):F.mainWin=null};this.addWin=function(A){for(var v=h.length,t=!1,p=0;p<v;p++)if(A.id==h[p].id){h[p]=A;t=!0;break}t||h.push(A);1==h.length&&(B=Date.now());v=A.isMainWin();svGlobal.logger.info("is mainwin:"+v+" id:"+A.id);v&&!F.mainWin&&(F.mainWin=A)};this.popWins=function(A){A=F.getWinById(A);var v=[];if(A){A=0<A.ownerWinid?A.ownerWinid:A.id;for(var t=h.length-1;0<=t;t--)if(h[t].ownerWinid==A||h[t].id==A)v.push(h[t]),h.splice(t,1)}return v};this.hasApp=function(A){return-1!=
E.indexOf(A)};this.addApp=function(A){return-1==E.indexOf(A)?(E.push(A),!0):!1};this.isNew=function(){return 3E4>Date.now()-B};this.getAll=function(){return h};this.hasWin=function(A){return 0<=h.indexOf(A)};this.close=function(){for(var A=0,v=h.length;A<v;A++)h[A].close()};this.clear=function(){h.length=0};this.delWin=function(A){for(var v=0,t=h.length;v<t;v++)if(h[v].id==A)return h.splice(v,1),v;return-1};this.isRunning=function(){var A=h.length;if(1>A)return!1;var v=0;for(A=h.length;v<A;v++){var t=
h[v];if(t.showState)return!0}return!1};this.getWinById=function(A){var v=h.length;if(1>v)return null;for(var t=0;t<v;t++){var p=h[t];if(p.id==A)return p}return null};this.getMainWinByAppId=function(A){var v=null,t=0;for(len=h.length;t<len;){v=h[t];if(v.appId==A&&v.isVisible()&&1>v.ownerWinid)break;t++}return v};this.getTopWin=function(A){var v=null,t,p=A.length;for(t=0;t<p&&(!(v=F.getWinById(A[t]))||!v.isVisible());t++)v=null;if(!v)for(svGlobal.logger.warn("No win found"),p=h.length,t=p-1;0<=t&&(v=
h[t],!v.isVisible());t--)v=null;return v};this.getMain=function(A){return(A=F.getTopWin(A))?d(A):null};this.getMainByWinId=function(A){return(A=F.getWinById(A))?d(A):null};this.getOtherApps=function(A,v,t){var p=h.length;if(0!=p&&h[p-1])if(p=h[p-1].appId,t||!p)setTimeout(function(){F.getOtherApps(A,v)},t||3E3);else{t=[];if(p=F.getTopWin(A)){var r=0<p.ownerWinid?p.ownerWinid:p.id,J=[],H=0;for(p=h.length;H<p;H++)h[H].ownerWinid!=r&&h[H].id!=r&&h[H].isVisible()&&J.push(h[H]);H=0;for(p=J.length;H<p;H++)J[H].ownerWinid!=
r&&J[H].id!=r&&(t.push({title:m(J[H]),win:d(J[H])}),r=0<J[H].ownerWinid?J[H].ownerWinid:J[H].id)}v(t)}};this.getFullTitle=function(A){for(var v,t="";;){v=F.getWinById(A);if(!v)break;v.titleInfo&&v.isVisible()&&(t&&(t=" > "+t),t=v.titleInfo+t);if(1>A)break;A=v.ownerWinid}return t}}var e=[];this.tryCloseRemoteApps=function(){if(a&&a.isRemoteApp())for(var d=e.length,m=0;m<d;m++)e[m].railWin&&e[m].railWin.close()};this.verifyMonitors=function(){for(var d=e.length,m=Array(d),h=0;h<d;h++)e[h].configMonitor(),
m[h]=e[h].getMousePosition();m.sort(function(F,S){var A=F.left-S.left;return 0!=A?A:F.top-S.top});var E=m.findIndex(function(F){return 0==F.left&&0==F.top});svGlobal.logger.info("monitor layout",m,E);-1==E&&(k.showMessage("* Primary monitor not found. Please make your browser window full screen."),svGlobal.logger.warn("Primary monitor not found (left=top=0)",m));for(h=E-1;0<=h;){if(m[h].right<m[h+1].left){var B=m[h+1].left-m[h].right-1;0<B&&(m[h].right+=B,m[h].left+=B)}m[h].bottom<m[h+1].top&&(B=
m[h+1].top-m[h].bottom-1,0<B&&(m[h].top+=B,m[h].bottom+=B));h--}for(h=E+1;h<d;)m[h-1].right<m[h].left&&(B=m[h].left-m[h-1].right-1,0<B&&(m[h].right-=B,m[h].left-=B)),m[h-1].bottom<m[h].top&&(B=m[h].top-m[h-1].bottom-1,0<B&&(m[h].top-=B,m[h].bottom-=B)),h++};this.repaint=function(d,m,h,E){for(var B=0,F=e.length;B<F;B++)e[B].repaint(d,m,h,E)};this.size=function(){return e.length};this.getSurface=function(d){return e[d]};this.addSurface=function(d){e.push(d)};this.hasSurface=function(d){for(var m=e.length,
h=0;h<m;h++)if(e[h].equals(d))return!0;return!1};this.fromSyncedSurface=function(d){var m=e.length;Date.now();for(var h=0;h<m;h++)if(e[h].isClipSynced(d))return!0;return!1};this.setSize=function(d,m,h){for(var E=0,B=e.length;E<B;E++)e[E].setSize(d,m,h)};this.zOrders=[];this.drawLicense=function(d){for(var m=0,h=e.length;m<h;m++)e[m].drawLicense(d)};this.setReadOnly=function(d,m){for(var h=0,E=e.length;h<E;h++)e[h].setReadOnly(d,m)};this.setVisible=function(d,m){svGlobal.logger.info("TODO: setVisible")};
this.setCursor=function(d){for(var m=0,h=e.length;m<h;m++)e[m]&&e[m].setCursor(d)};this.hide=function(d){d=0;for(var m=e.length;d<m;d++)e[d]&&e[d].hide()};this.execute=function(d,m){for(var h=0,E=e.length;h<E;h++)e[h][d].apply(e[h],m)};this.addWin=function(d){var m=this.getFocused();m||(svGlobal.logger.warn("Focused surface not found!"),m=e[e.length-1]);m?(Ja=!0,m.railWin||(m.railWin=new c,m.onunload=function(){hi5.appcfg.closeRemoteApp&&m.railWin&&m.railWin.close();m.remoteApp&&m.remoteApp.close();
m.railWin&&(m.railWin.clear(),m.railWin=null);e.removeElm(m)}),m.context&&b.setContext(m.context),m.railWin.addWin(d),m.railWin.mainWin==d&&(setTimeout(function(){var h=m.getFreeSpace();a.writeRawInput("8C661441\t"+h.width+"\t"+h.height);svGlobal.logger.info("-- main win dp change:"+h.height);3==a.windowState?d.resizable()&&setTimeout(function(){d.exeCommand(61488);svGlobal.logger.info("-- max")},50):5==a.windowState&&3==d.showState&&setTimeout(function(){d.exeCommand(3856);svGlobal.logger.info("-- restor")},
50)},111),ya.sendKeyboardSyncFlags(ya.localLockFlags,500)),hi5.browser.isIE&&m.focus()):svGlobal.logger.warn("No surface available!")};this.delWin=function(d){for(var m,h=e.length-1;0<=h;h--){var E=e[h];m=E.railWin;var B=m.getWinById(d),F=B&&B.appId&&-1!=B.appId.toLowerCase().indexOf("runonce");if(0<=m.delWin(d)){B==m.mainWin&&(m.mainWin=null);if(E.toolbar){d="win"+d;var S=E.toolbar.querySelector("#"+d);S&&E.toolbar.removeChild(S)}if(!m.isRunning()&&0==k.mode){if(B.isMainWin()&&E.onremoteappclose)E.onremoteappclose(B);
B=a.appTimeout;if(F||m.isNew())B*=10;svGlobal.logger.debug("Prepare del:"+Date.now());setTimeout(function(A){return function(){svGlobal.logger.info("Start del:"+Date.now());A.railWin&&A.railWin.isRunning()||(A.remoteApp&&A.remoteApp.close(),I&&I.delSurface(A))}}(E),B)}}}};this.popWins=function(d){return e[0]&&e[0].railWin?e[0].railWin.popWins(d):[]};this.getWinById=function(d){for(var m,h=0,E=e.length;h<E;h++)if(e[h]&&e[h].railWin&&(m=e[h].railWin.getWinById(d)))return m;return null};this.getMainWinByAppId=
function(d){for(var m,h=0,E=e.length;h<E;h++)if(e[h].railWin&&(m=e[h].railWin.getMainWinByAppId(d)))return m;return null};this.onWinChange=function(d){for(var m,h=0,E=e.length;h<E;h++)if(e[h].railWin&&(m=e[h].railWin.getWinById(d.id)))e[h].railWin.onchange(d)};this.setTitle=function(d){for(var m,h=0,E=e.length;h<E;h++)if(e[h].railWin){m=e[h].railWin.getWinById(d);var B=e[h].railWin.getFullTitle(d);if(B){a.changeTitle(B,e[h].getWindow(),m.appId);break}}};this.hasApp=function(d){for(var m=0,h=e.length;m<
h;m++)if(e[m].railWin.hasApp(d))return!0;return!1};this.delSurface=function(d){!d||d.railWin&&d.railWin.isRunning()||(svGlobal.logger.info("delete surface..."),e.removeElm(d),d.close(),0==e.length&&a._unload())};this.getOwnerSurface=function(d){for(var m=0,h=e.length;m<h;m++)if(e[m].railWin&&e[m].railWin.hasWin(d))return e[m];return null};this.getOwnerSurfaceById=function(d){for(var m,h=0,E=e.length;h<E;h++)if(e[h].railWin&&(m=e[h].railWin.getWinById(d)))return e[h];return null};this.getFocused=function(){for(var d=
e.length,m=0;m<d;m++)if(e[m].focused)return e[m];return e[d-1]};this.close=function(){for(var d=0,m=e.length;d<m;d++)e[d]&&(e[d].remoteApp&&e[d].remoteApp.close(),e[d].close(),e[d]=null)};this.LocalWin=function(d){function m(){a.writeRawInput("8C0"+d)}this.id=d;this.appId="";var h=this;this.resizable=function(){return h.isVisible?0!=(h.style&262144)||0!=(h.style&65536)||0!=(h.style&16777216)||3==h.showState:!1};this.setShowState=function(E){h.showState=E};this.parent=function(){return I.getWinById(h.ownerWinid)};
this.resize=function(E,B,F,S){svGlobal.logger.info("www resize, l "+E+" w "+F);hi5.appcfg.disableJoinedAppResize&&2==a.mode||a.writeRawInput("8C1"+h.id+"\t"+E+"\t"+B+"\t"+F+"\t"+S)};this.exeCommand=function(E){svGlobal.logger.info("www exeCommand, cmd "+E);a.writeRawInput("8C4"+d+"\t"+E)};this.activate=function(E){svGlobal.logger.info("www activate, enable "+E+" id:"+d);2==h.showState?(h.exeCommand(61728),setTimeout(function(){a.writeRawInput("8C3"+d+"\t"+E)},50)):a.writeRawInput("8C3"+d+"\t"+E)};
this.close=function(){svGlobal.logger.info("www close");h.exeCommand(61536)};this.getAppId=m;this.isVisible=function(){return h.winWidth&&h.winHeight&&h.showState&&45<h.winHeight&&45<h.winWidth};this.isMainWin=function(){if(!(h.isVisible()&&h.winWidth&&h.winHeight&&45<h.winHeight&&45<h.winWidth))return!1;var E=1>h.ownerWinid;if(!E)return E;var B=h.style;if(0!=(B&4194304))return!0;if(0!=(B&2147483648)&&(0==(B&8388608)||0==(B&12582912)))return!1;var F=0!=(h.extStyle&128);(E=E&&!F)&&0!=(B&2147483648)&&
0==(B&2156396544)&&(E=!1);return E};m()}}(k,W);this.getSurfaces=function(){return I};this.hide=function(){I&&I.hide()};this.getFileUrl=function(a,b,c){var e=Pa(),d=wc,m=d.indexOf("://");e=(0<m&&11>m?d:e+d)+"s="+Vb+"&f="+encodeURIComponent(a);b&&(e+="&src="+b);c&&(e+="&action="+c);return k.modifyURL(e)};this.listFiles=function(a,b){ua&&Ka&&ua.list(a,b)};this.writeRawInput=function(a){if(Ka){ba(a);if(k.onactivity)k.onactivity(a);return!0}return!1};this.authWithCode=function(a,b){var c=a.length,e=new Uint8Array(5+
c);e[0]=146;e[1]=7;e[2]=b;e[3]=c&255;e[4]=c>>8&255;for(b=0;b<c;b++)e[5+b]=a.charCodeAt(b);ba(e.buffer)};var zc=0;if(K.numLock||K.numlock||X(D.numLock)||hi5.browser.isMacOS||hi5.browser.isiOS||hi5.browser.isCrOS)zc|=2;var ya=new function(a,b,c,e){this.setJoinMode=a.setJoinMode;this.requestControl=a.requestControl;this.writeKeyComb=a.writeKeyComb;this.writeText=a.writeText;this.localLockFlags=e||0;this.remoteLockFlags=0;this.checkLockFlags=!0;this.reqCopyTime=0;this.draw=c.draw;var d=a.isRemoteApp(),
m=void 0;this.saveResize=function(h){m=a.reconnectOnResize;a.reconnectOnResize=h};this.restoreResize=function(){void 0!=m&&(a.reconnectOnResize=m)};this.refresh=function(h,E,B,F){return c.repaint(h,E,B-h+1,F-E+1)};this.getAppMode=function(){return a.mode};this.getAgentStatus=function(){return a.getAgentStatus()};this.send=a.writeRawInput;this.saveSession=function(h){a.saveSession(h)};this.sendInput=a.writeRawInput;this.getAppInfo=function(){return a.sessionInfo.appInfo};this.resumeAudio=function(){Da.supportWebAudio&&
Da.iOSFix()};this.onresize=function(h){if(h=h.target.svSurface){var E=h.getFreeSpace(),B=E.width;E=E.height;ya.checkLockFlags=!0;K.scale?h.scaleTo(B,E,!1):a.resetSize(B,E)}};this.onorientationchange=function(h){a.resetSize(h.innerWidth,h.innerHeight)};this.getClipData=function(h,E){this.reqCopyTime=Date.now();var B=a.getGatewayAddr(),F=xc,S=F.indexOf("://");B=(0<S&&11>S?F:B+F)+"s="+a.sessionInfo.appInfo.session+"&t="+Date.now()+"&type="+h;h=hi5.httpGet(a.modifyURL(B),E);this.reqCopyTime=Date.now();
rc(h);return h};this.onfocus=function(h){var E=I.getFocused();d&&E&&E.railWin&&(h=E.railWin.mainWin)&&a.running()&&(E=E.context)&&E!=c.getContext()&&(c.setContext(null),h.activate(1),svGlobal.logger.info("Activate win:"+h.id))};this.getShareFiles=a.listFiles;this.getFile=function(h,E,B){a.reconnectOnResize=!1;var F=a.getFileUrl(h,E,B);k.ondownload&&k.ondownload({fileName:h,url:F,source:E,action:B})||window.open(F)};this.getFileLink=a.getFileUrl;this.getGateway=function(){return w};this.reconnect=
function(h,E,B){D.symlink?(h="user="+h+"&pwd="+E,B&&(h+="&domain="+B),w=hi5.tool.replaceQuery(w,"parameters",h)):(w=hi5.tool.replaceQuery(w,"user",h),w=hi5.tool.replaceQuery(w,"pwd",E),w=hi5.tool.replaceQuery(w,"domain",B));a.run()};this.sendKeyboardSyncFlags=function(h,E){return Ka?(this.remoteLockFlags=this.localLockFlags=h,setTimeout(function(){a.writeRawInput("8E5"+h)},E||333),!0):!1};this.sendKeyboardSynchronize=function(h,E,B){var F=0;B&&(F|=4);E&&(F|=2);h&&(F|=1);this.sendKeyboardSyncFlags(F)};
this.fromSyncedSurface=function(h){return b.fromSyncedSurface(h)};this.setWorkDir=function(h){a.writeKeyComb("Windows+R",20,function(){setTimeout(function(){a.writeText(h,10,function(){a.writeScancode(!0,28);a.writeScancode(!1,28)})},666)})};this.authWithCode=function(h,E){a.authWithCode(h,E)};this.getPrinters=function(h){a.getPrinters(h)};this.attachPrinter=function(h){a.attachPrinter(h)}}(k,I,W,zc);this.sendKeyboardSynchronize=function(a,b,c){ya.sendKeyboardSynchronize(a,b,c)};this.VirtualChannel=
function(){return new Ib(143)};this.GatewayChannel=function(){return new Ib(28)};this.DynamicChannel=function(){return new Ib(64)};this.addChannel=function(a){eb[a.name]=a};this.addGatewayChannel=function(a){cb[a.name]=a};this.addDynamicChannel=function(a){ia.names.push(a.name);ia[a.name]=a;ia.count++};var za=null,ia={count:0,names:[],usbChannel:null,close:function(){for(var a=ia.names,b=0,c=a.length;b<c;b++)ia[a[b]].onclose&&(ia[a[b]].onclose(),ia[a[b]]=null);a.length=0;ia.usbChannel=null},init:function(a,
b,c,e,d,m){function h(){this.WAVE_FORMAT_PCM=1;this.WAVE_FORMAT_ADPCM=2;this.WAVE_FORMAT_ALAW=6;this.WAVE_FORMAT_MULAW=7;this.WAVE_FORMAT_GSM=49;this.WAVE_FORMAT_MPEGLAYER3=85;this.WAVE_FORMAT_AAC=41222;this.cbSize=this.bitsPerSample=this.nBlockAlign=this.nAvgBytesPerSec=this.nSamplesPerSec=this.nChannels=this.formatTag=0;this.extenstion=null;var v=this;this.fromBuffer=function(t,p){v.formatTag=t.getLittleEndian16();v.nChannels=t.getLittleEndian16();v.nSamplesPerSec=t.getLittleEndian32();v.nAvgBytesPerSec=
t.getLittleEndian32();v.nBlockAlign=t.getLittleEndian16();v.bitsPerSample=t.getLittleEndian16();var r=t.getLittleEndian16();v.cbSize=r;0<r&&!0!==p&&(v.extenstion=Array(r),t.copyToByteArray(v.extenstion,0,t.getPosition(),r),t.skipPosition(r))};this.toBuffer=function(t){t.setLittleEndian16(v.formatTag);t.setLittleEndian16(v.nChannels);t.setLittleEndian32(v.nSamplesPerSec);t.setLittleEndian32(v.nAvgBytesPerSec);t.setLittleEndian16(v.nBlockAlign);t.setLittleEndian16(v.bitsPerSample);t.setLittleEndian16(v.cbSize);
0<v.cbSize&&t.setBytes(v.extenstion)};this.getSize=function(){return 18+v.cbSize};this.toString=function(){return"Audio Format, tag="+v.formatTag+" nChannels="+v.nChannels+" nSamplesPerSec="+v.nSamplesPerSec+" nAvgBytesPerSec="+v.nAvgBytesPerSec+" nBlockAlign="+v.nBlockAlign+" bitsPerSample="+v.bitsPerSample+" cbSize="+v.cbSize}}function E(){za=new k.DynamicChannel;za.name="Microsoft::Windows::RDS::DisplayControl";za.enabled=!1;za.process=function(v){var t=v.getLittleEndian32();v.getLittleEndian32();
switch(t){case 5:t=v.getLittleEndian32(),za.maxMonitorAreaFactorA=v.getLittleEndian32(),za.maxMonitorAreaFactorB=v.getLittleEndian32(),za.enabled=!0,svGlobal.logger.warn("Display control maxNumMonitors:"+t+" factorA:"+za.maxMonitorAreaFactorA+" factorB:"+za.maxMonitorAreaFactorB),v=new Uint8Array(2),v[0]=146,v[1]=4,ba(v.buffer),xa&&setTimeout(function(){xa&&xa.check(5E3)},1900)}};za.applyResolution=function(v,t){if(za.enabled){var p=new Uint8Array(56),r=new RdpBuffer(p,0,56);v=v>za.maxMonitorAreaFactorA?
za.maxMonitorAreaFactorA:v&-4;t=t>za.maxMonitorAreaFactorB?za.maxMonitorAreaFactorB:t&-4;r.setLittleEndian32(2);r.setLittleEndian32(56);r.setLittleEndian32(40);r.setLittleEndian32(1);r.setLittleEndian32(1);r.setLittleEndian32(0);r.setLittleEndian32(0);r.setLittleEndian32(v);r.setLittleEndian32(t);r.setLittleEndian32(.26458*v|0);r.setLittleEndian32(.26458*t|0);r.setLittleEndian32(v>t?0:90);r.setLittleEndian32(100);r.setLittleEndian32(100);za.send(p);svGlobal.logger.warn("Display control: "+v+"x"+t)}else svGlobal.logger.warn("Display control disabled.")};
return za}if(!K.disableDVC){if(K.enableEcho){var B=new k.DynamicChannel;B.name="ECHO";B.process=function(v){var t=v.getPosition(),p=v.getEnd(),r=new Uint8Array(p-t);r.set(v.getData().subarray(t,p));B.send(r)};k.addDynamicChannel(B)}if(a){var F=new k.DynamicChannel;F.name="Microsoft::Windows::RDS::Input";F.process=function(v){var t=v.getLittleEndian16();v.getLittleEndian32();switch(t){case 1:v.skipPosition(4),v=new RdpBuffer(new Uint8Array(16),0,16),v.setLittleEndian16(2),v.setLittleEndian32(16),v.setLittleEndian32(3),
v.setLittleEndian32(65536),v.setLittleEndian16(256),v.markEnd(),F.send(v);case 5:I.execute("setTouchRemoting",[!0]);ia.isTouchReady=!0;svGlobal.logger.info("Touch remoting start");break;case 4:I.execute("setTouchRemoting",[!1]),ia.isTouchReady=!1,svGlobal.logger.info("Touch remoting suspend")}};k.addDynamicChannel(F)}if(c){svGlobal.logger.warn("Audio input on");var S=new k.DynamicChannel;(function(){function v(Y){var fa=new RdpBuffer(new Uint8Array(5),0,5);fa.setByte(7);fa.setLittleEndian32(Y);fa.markEnd();
S.send(fa)}function t(Y){var fa=Y.getLittleEndian32(),Ga=Y.getLittleEndian32(),Aa=new h;Aa.fromBuffer(Y,!0);var Fa=0,Za=0;0<Aa.cbSize&&(22==Aa.cbSize?(Fa=Y.getLittleEndian16(),Za=Y.getLittleEndian32(),Y.skipPosition(16)):(svGlobal.logger.warn("Wrong cbsize: "+Aa.cbSize),Y.skipPosition(Aa.cbSize)));Y=r[Ga];svGlobal.logger.info("Selceted rec fmt, framesPerPacket: "+fa+" initial: "+Ga+", "+Y.toString());svGlobal.logger.info("Open fmt: "+Aa.toString()+" validBits:"+Fa+" mask:"+Za);H=!0;R=k.reconnectOnResize;
k.reconnectOnResize=!1;na.onopen||(na.onopen=function(wa){if(oa){p=wa;k.reconnectOnResize=R;v(Ga);var pa=new RdpBuffer(new Uint8Array(5),0,5);pa.setByte(4);pa.setLittleEndian32(wa?0:1);pa.markEnd();S.send(pa)}});na.ondata||(na.ondata=function(wa,pa){p&&(T.length!=pa+1&&(T=new Uint8Array(pa+1),T[0]=6),S.send(J),T.set(wa,1),S.send(T))});na.start(Y,fa)}S.name="AUDIO_INPUT";S.process=function(Y){var fa=Y.getByte();switch(fa){case 1:Y=Y.getLittleEndian32();fa=new RdpBuffer(new Uint8Array(5),0,5);fa.setByte(1);
fa.setLittleEndian32(Y);fa.markEnd();S.send(fa);break;case 2:var Ga=Y.getLittleEndian32();Y.getLittleEndian32();var Aa=Da.getContext().sampleRate;for(fa=r.length=0;fa<Ga;fa++){var Fa=new h;Fa.fromBuffer(Y);svGlobal.logger.info("Server rec fmt "+fa+":"+Fa.toString());0==e&&49==Fa.formatTag&&22050==Fa.nSamplesPerSec?r.push(Fa):1==Fa.formatTag&&Fa.nSamplesPerSec<=Aa&&r.push(Fa)}S.send(J);Ga=0;Y=r.length;for(fa=0;fa<Y;fa++)Ga+=r[fa].getSize();Aa=new RdpBuffer(new Uint8Array(1024),0,1024);Aa.setByte(2);
Aa.setLittleEndian32(Y);Aa.setLittleEndian32(Ga+9);for(fa=0;fa<Y;fa++)r[fa].toBuffer(Aa),svGlobal.logger.info("Client rec fmt: "+r[fa].toString());Aa.skipPosition(1024-Ga-9);Aa.markEnd();S.send(Aa);break;case 3:t(Y);break;case 7:fa=Y.getLittleEndian32();svGlobal.logger.info("Rec fmt change, "+r[fa].toString()+" by client:"+H);H||(v(fa),H=!1);break;default:svGlobal.logger.warn("audioInput: invalid tag:"+fa)}};var p=!1,r=[];S.onclose=function(){p=!1;na&&na.close()};var J=new Uint8Array(1);J[0]=5;var H=
!1,R=k.reconnectOnResize,T=new Uint8Array(0),ja=N("audiorecorder",hi5.libMin?"audiorecorder_min.js?v=0":"audiorecorder.js?v=0"),na=window.AudioWorkletNode?new hi5.audio.WorkletRecorder(Da.getContext(),ja):new hi5.audio.Recorder(Da.getContext())})();k.addDynamicChannel(S)}k.addDynamicChannel(function(){var v=new k.DynamicChannel;v.name="TSMF";var t={type:"image/jpeg"},p=Array(1);v.process=function(r){r.getPosition();var J=r.getLittleEndian32()&1073741823;var H=r.getLittleEndian32();var R=r.getLittleEndian32();
switch(J){case 2:if(256==R){r.getLittleEndian32();R=new Uint8Array(16);var T=new RdpBuffer(R,0,16);T.setLittleEndian32(2);T.setLittleEndian32(H);T.setLittleEndian32(1);T.setLittleEndian32(0);v.send(R)}break;case 0:switch(R){case 257:r.getBytes(16);r.getLittleEndian32();break;case 256:J=r.getPosition();T=r.getLittleEndian32();for(R=0;R<T;R++){r.getLittleEndian32();var ja=r.getLittleEndian32();r.getLittleEndian32();r.skipPosition(ja-4)}R=r.getPosition()-J;T=R+8+4;R=new Uint8Array(T);T=new RdpBuffer(R,
0,T);T.setLittleEndian32(-2147483648);T.setLittleEndian32(H);R.set(r.getData().subarray(J,r.getPosition()),8);v.send(R);break;case 261:r.getBytes(16);r.getLittleEndian32();break;case 264:J=r.getLittleEndian32();r.skipPosition(4);r.getLittleEndian32();ja=r.getBytes(16);var na=r.getBytes(16);r.getLittleEndian32();r.getLittleEndian32();r.getLittleEndian32();var Y=r.getBytes(16);R=r.getLittleEndian32();r.skipPosition(R);R=new Uint8Array(20);T=new RdpBuffer(R,0,20);T.setLittleEndian32(-2147483648);T.setLittleEndian32(H);
hi5.Arrays.equals([118,105,100,115,0,0,16,0,128,0,0,170,0,56,155,113],ja)&&hi5.Arrays.equals([77,74,80,71,0,0,16,0,128,0,0,170,0,56,155,113],na)&&hi5.Arrays.equals([128,159,88,5,86,195,206,17,191,1,0,170,0,85,89,90],Y)?T.setLittleEndian32(1):(T.setLittleEndian32(0),svGlobal.logger.warn("Format is not supported:"),svGlobal.logger.warn(ja),svGlobal.logger.warn(na),svGlobal.logger.warn(Y));T.setLittleEndian32(J);v.send(R);break;case 258:r.getBytes(16);r.getLittleEndian32();J=r.getLittleEndian32();r.skipPosition(J);
break;case 263:r.getBytes(16),R=new Uint8Array(16),T=new RdpBuffer(R,0,16),T.setLittleEndian32(-2147483648),T.setLittleEndian32(H),T.setLittleEndian32(1),v.send(R);case 277:r.getBytes(16);r.getLittleEndian32();break;case 262:r.getBytes(16);W.flushImgs();W.setImgRect(0,0,0,0);R=new Uint8Array(12);T=new RdpBuffer(R,0,12);T.setLittleEndian32(-2147483648);T.setLittleEndian32(H);v.send(R);break;case 278:r.getBytes(16);H=r.getLittleEndian32();R=r.getLittleEndian32();J=r.getLittleEndian32();r=r.getLittleEndian32();
W.setImgRect(H,R,J-H,r-R);break;case 265:r.getBytes(16);r.getLittleEndian64();r.getLittleEndian32();break;case 266:r.getBytes(16);break;case 268:r.getBytes(16);break;case 267:r.getBytes(16);break;case 269:r.getBytes(16);r.getLittleEndian32();break;case 274:break;case 275:break;case 259:r.getBytes(16);r.getLittleEndian32();r.getLittleEndian32();r.skipPosition(32);R=r.getLittleEndian32();H=new Image;J=r.getPosition();p[0]=r.getData().subarray(J,J+R);r=new Blob(p,t);H.src=URL.createObjectURL(r);W.addImg(H);
break;case 270:W.flushImgs();break;case 273:break;case 260:break;case 276:r.getBytes(16);R=r.getLittleEndian32();J=r.getPosition()+R;r.skipPosition(8);H=r.getLittleEndian32();svGlobal.logger.info("window state:"+H);T=r.getLittleEndian32();ja=r.getLittleEndian32();H=r.getLittleEndian32();R=r.getLittleEndian32();r.skipPosition(8);na=r.getLittleEndian32();Y=r.getLittleEndian32();svGlobal.logger.info("Window rect, left:"+H+" top:"+R+" w:"+T+" h:"+ja+" cl:"+na+" ct:"+Y);r.setPosition(J);J=r.getLittleEndian32();
for(J=r.getPosition()+J;r.getPosition()<J;){na=r.getLittleEndian32();Y=r.getLittleEndian32();var fa=r.getLittleEndian32(),Ga=r.getLittleEndian32();svGlobal.logger.info("visible region, l:"+Y+" t:"+na+" r:"+Ga+" b:"+fa)}W.setImgRect(H,R,T,ja);break;case 1:case 2:break;default:svGlobal.logger.warn("unknown function:"+R)}break;default:svGlobal.logger.warn("unkown interface:"+J)}};return v}());Ya||k.addDynamicChannel(E());K.enableDVCAudio&&k.addDynamicChannel(function(v){var t=!1,p=0,r=0,J=0,H=0,R=[],
T=new Uint8Array(4),ja=new k.DynamicChannel;ja.name="AUDIO_PLAYBACK_DVC";ja.onclose=function(){};ja.process=function(na){function Y(Z){Z.skipPosition(14);var da=Z.getLittleEndian16();Z.getByte();var ta=Z.getLittleEndian16();Z.skipPosition(1);for(var Na,Ia=R.length=0;Ia<da;Ia++){var La=new h;La.fromBuffer(Z);(Na=22050<=La.nSamplesPerSec&&(1==La.formatTag||49==La.formatTag&&22050==La.nSamplesPerSec&&0==v))&&R.push(La)}La=20;Z=R.length;for(Ia=0;Ia<Z;Ia++)La+=R[Ia].getSize();Ia=La+4;da=new RdpBuffer(new Uint8Array(Ia),
0,Ia);da.setByte(7);da.setByte(2);da.setLittleEndian16(La);da.setLittleEndian32(3);da.setLittleEndian32(4294967295);da.setLittleEndian32(0);da.setLittleEndian16(0);da.setLittleEndian16(Z);da.skipPosition(1);da.setLittleEndian16(ta);da.setByte(124);for(Ia=0;Ia<Z;Ia++)La=R[Ia],La.toBuffer(da);da.markEnd();ja.send(da);5<ta&&(da=new RdpBuffer(new Uint8Array(8),0,8),da.setByte(12),da.skipPosition(1),da.setLittleEndian16(4),da.setLittleEndian16(0),da.setLittleEndian16(0),da.markEnd(),ja.send(da))}function fa(Z){var da=
Z.getLittleEndian16();Z=Z.getLittleEndian16();var ta=new RdpBuffer(new Uint8Array(8),0,8);ta.setByte(6);ta.setByte(35);ta.setLittleEndian16(4);ta.setLittleEndian16(da);ta.setLittleEndian16(Z);ta.markEnd();ja.send(ta)}function Ga(){var Z=R[J];if(Z.formatTag!=V||Z.nSamplesPerSec!=Xa||ka!=Z.nChannels)V=Z.formatTag,ka=Z.nChannels,Xa=Z.nSamplesPerSec,db=49==Z.formatTag?8:Z.bitsPerSample}function Aa(Z){r=Z.getLittleEndian16();J=Z.getLittleEndian16();H=Z.getByte();Z.skipPosition(3);T[0]=Z.getByte();T[1]=
Z.getByte();T[2]=Z.getByte();T[3]=Z.getByte();t=!0;Ga()}function Fa(Z,da){var ta=new RdpBuffer(new Uint8Array(8),0,8);ta.setByte(5);ta.skipPosition(1);ta.setLittleEndian16(4);ta.setLittleEndian16(Z);ta.setByte(da);ta.skipPosition(1);ta.markEnd();ja.send(ta)}function Za(Z){t=!1;var da=p-8,ta=Date.now();Z.copyFromByteArray(T,0,Z.getPosition(),4);Z=Wb(Z,H,r,da);Z*=1E3;ta=r+(Date.now()-ta)+Z;Fa(ta,H)}function wa(Z){var da=Date.now();r=Z.getLittleEndian16();J=Z.getLittleEndian16();H=Z.getByte();Z.skipPosition(7);
Ga();Z=Wb(Z,H,r,0);Z*=1E3;da=r+(Date.now()-da)+Z;Fa(da,H)}if(t)Za(na);else{var pa=na.getByte();na.skipPosition(1);p=na.getLittleEndian16();switch(pa){case 7:Y(na);break;case 6:fa(na);break;case 2:Aa(na);break;case 1:closed=!0;break;case 3:na.getLittleEndian16();na.getLittleEndian16();break;case 13:wa(na)}}};return ja}(e));svGlobal.DCVC_EXTENSION||(svGlobal.DCVC_EXTENSION={});var A=svGlobal.DCVC_EXTENSION;A.videoMedia={video:null,track:null,canvas:null,ctx:null,resolutions:null,minFrameRate:16,type:2,
activate:function(v,t){svGlobal.logger.info("activate webcam");A.videoMedia.resolutions?v():hi5.video.resolutions(function(p){p.length?(A.videoMedia.resolutions=p,v()):t()})},deactivate:function(){var v=A.videoMedia;v.track&&(v.track.stop(),v.track=null);v.ctx=null;v.canvas=null;v.video=null;svGlobal.logger.info("deactivate cam")},startStream:function(v,t,p,r,J){svGlobal.logger.info("startStream, width:"+v+" height:"+t+" frameRate:"+p);var H=A.videoMedia,R=H.track;if(R){var T=R.getSettings();if("live"==
R.readyState)if(v!=T.width||t!=T.height||p!=T.frameRate&&2!=H.type)R.stop();else return}navigator.mediaDevices.getUserMedia({video:{frameRate:2==H.type?H.minFrameRate:p,width:{exact:v},height:{exact:t}}}).then(function(ja){var na=document.createElement("video");na.srcObject=ja;na.play();if(window.OffscreenCanvas)var Y=new OffscreenCanvas(100,100);else Y=document.createElement("canvas"),Y.style.position="absolute",Y.style.left=0,Y.style.top=0;H.track=ja.getVideoTracks()[0];H.canvas=Y;H.ctx=Y.getContext("2d");
H.video=na;ja=H.track.getSettings();H.canvas.width=ja.width;H.canvas.height=ja.height;r()}).catch(function(ja){svGlobal.logger.warn(ja);J()})},stopStream:function(){svGlobal.logger.info("stopStream");var v=A.videoMedia;v.track&&"live"==v.track.readyState&&v.track.stop()},grabFrame:function(v){function t(r){r.arrayBuffer().then(v)}var p=A.videoMedia;p.ctx.drawImage(p.video,0,0);p=p.canvas;p.convertToBlob?p.convertToBlob({type:"image/jpeg",quality:.6}).then(t):p.toBlob(t,"image/jpeg",.6)},propertyList:[[{propertyId:1,
capabilities:3,min:4294967286,max:4294967294,step:1,default:4294967291},null,{propertyId:3,capabilities:101,min:4294967280,max:16,step:1,default:0},{propertyId:4,capabilities:1,min:0,max:3,step:1,default:0},{propertyId:5,capabilities:1,min:4294967280,max:16,step:1,default:0},{propertyId:6,capabilities:1,min:100,max:400,step:10,default:100}],[{propertyId:1,capabilities:1,min:0,max:2,step:1,default:1},{propertyId:2,capabilities:199,min:4294967232,max:64,step:1,default:0},{propertyId:3,capabilities:1,
min:0,max:95,step:1,default:0},{propertyId:4,capabilities:1,min:4294965296,max:2E3,step:1,default:0},{propertyId:5,capabilities:67,min:2800,max:6500,step:1,default:4600}]]};A.WEBCAM=function(v){var t=new v;t.name="RDCamera_Device_0";t.version=2;t.newInstance=function(){return A.WEBCAM(v)};t.onopen=function(){svGlobal.logger.info("cam open")};t.onclose=function(){svGlobal.logger.info("cam close")};t.sendSucess=function(){var p=new hi5.DataBuffer(new Uint8Array(2));p.setByte(t.version);p.setByte(1);
p.markEnd();t.send(p)};t.sendError=function(p){var r=new hi5.DataBuffer(new Uint8Array(6));r.setByte(t.version);r.setByte(2);r.setLittleEndian32(p||1);r.markEnd();t.send(r)};t.sendSteamListResp=function(){var p=new hi5.DataBuffer(new Uint8Array(7));p.setByte(t.version);p.setByte(10);p.setLittleEndian16(1);p.setByte(1);p.setByte(1);p.setByte(0);p.markEnd();t.send(p)};t.sendMediaTypeListResp=function(p){var r=A.videoMedia.resolutions,J=r.length,H=new hi5.DataBuffer(new Uint8Array(2+26*J));H.setByte(t.version);
H.setByte(12);for(var R=1==p,T=0;T<J;T++){H.setByte(p);var ja=r[T];H.setLittleEndian32(ja.width);H.setLittleEndian32(ja.height);H.setLittleEndian32(R?ja.frameRate:A.videoMedia.minFrameRate);H.setLittleEndian32(1);H.setLittleEndian32(1);H.setLittleEndian32(1);H.setByte(1)}H.markEnd();t.send(H)};t.sendCurrentMediaType=function(p,r){var J=new hi5.DataBuffer(new Uint8Array(28));J.setByte(t.version);J.setByte(14);r=A.videoMedia.resolutions[r];J.setByte(p);J.setLittleEndian32(r.width);J.setLittleEndian32(r.height);
J.setLittleEndian32(1==p?r.frameRate:A.videoMedia.minFrameRate);J.setLittleEndian32(1);J.setLittleEndian32(1);J.setLittleEndian32(1);J.setByte(1);J.markEnd();t.send(J)};t.sendSampleResp=function(p){A.videoMedia.grabFrame(function(r){var J=new hi5.DataBuffer(new Uint8Array(r.byteLength+3));J.setByte(t.version);J.setByte(18);J.setByte(p);J.setBytes(new Uint8Array(r));J.markEnd();t.send(J)})};t.sendPropertyListResp=function(){for(var p=0,r,J,H=A.videoMedia.propertyList,R=0;2>R;R++){J=H[R];r=J.length;
for(var T=0;T<r;T++)null!=J[T]&&p++}p=new hi5.DataBuffer(new Uint8Array(2+19*p));p.setByte(t.version);p.setByte(21);for(R=0;2>R;R++)for(J=H[R],r=J.length,T=0;T<r;T++)null!=J[T]&&(p.setByte(R),p.setByte(J.propertyId),p.setByte(J.capabilities),p.setLittleEndian32(J.min),p.setLittleEndian32(J.max),p.setLittleEndian32(J.step),p.setLittleEndian32(J.default));p.markEnd();t.send(p)};t.sendPropertyValueResp=function(p,r){(p=A.videoMedia.propertyList[p][r-1])?(r=new hi5.DataBuffer(new Uint8Array(7)),r.setByte(t.version),
r.setByte(23),r.setByte(1),r.setLittleEndian32(p.value||p.default),r.markEnd(),t.send(r)):t.sendError(8)};t.process=function(p){p.getByte();var r=p.getByte();switch(r){case 7:A.videoMedia.activate(t.sendSucess,t.sendError);break;case 8:A.videoMedia.deactivate();t.sendSucess();break;case 9:t.sendSteamListResp();break;case 11:p=p.getByte();0!=p&&svGlobal.logger.warn("Invalid stream index: "+p);t.sendMediaTypeListResp(A.videoMedia.type);break;case 13:p=p.getByte();t.sendCurrentMediaType(A.videoMedia.type,
p);break;case 15:p.getByte();r=p.getByte();if(r!=A.videoMedia.type){svGlobal.warn("Invalid video format req:"+r);t.sendError(6);break}r=p.getLittleEndian32();var J=p.getLittleEndian32();p=p.getLittleEndian32()/p.getLittleEndian32();A.videoMedia.startStream(r,J,p,t.sendSucess,t.sendError);break;case 16:A.videoMedia.stopStream();t.sendSucess();break;case 17:p=p.getByte();0!=p&&svGlobal.logger.info("Invalid stream index for SampleRequest: "+p);t.sendSampleResp(p);break;case 20:t.sendPropertyListResp();
break;case 22:r=p.getByte();p=p.getByte();t.sendPropertyValueResp(r,p);break;case 24:t.sendError(10);break;default:t.sendError(10),svGlobal.logger.warn("Invalid cam msg: "+r)}};return t};A.WEBCAM_ENUM=function(v,t){var p=new v;p.name="RDCamera_Device_Enumerator";p.onopen=function(){var r=new hi5.DataBuffer(new Uint8Array(2));r.setByte(t.version);r.setByte(3);r.markEnd();p.send(r);svGlobal.logger.info("camEnum open")};p.onclose=function(){svGlobal.logger.info("camEnum closed");A.videoMedia.deactivate()};
p.addDevice=function(r){r+="\x00";var J=t.name+"\x00",H=new hi5.DataBuffer(new Uint8Array(2+2*r.length+J.length));H.setByte(t.version);H.setByte(5);H.setUnicodeString(r);H.setAscllString(J);H.markEnd();p.send(H)};p.process=function(r){var J=r.getByte();r=r.getByte();switch(r){case 4:svGlobal.logger.info("camEnum ver resp: "+J);t.version=J;p.addDevice(hi5.video.webcam&&hi5.video.webcam.label||"Web Camera");break;default:svGlobal.logger.warn("invalid messageId on camEnum: "+r)}};return p};d&&(a=A.WEBCAM(k.DynamicChannel),
c=A.WEBCAM_ENUM(k.DynamicChannel,a),k.addDynamicChannel(c),k.addDynamicChannel(a));m&&(svGlobal.logger.info("Mapping USB..."),k.addDynamicChannel(ia.usbChannel));b&&A.GFX&&k.addDynamicChannel(A.GFX(k,X(D.remotefx)&&!X(D.gfx)))}}},Sa=null;svGlobal.DCVC_EXTENSION&&!Ya&&(k.hasUSB()&&svGlobal.DCVC_EXTENSION.WEBUSB&&(ia.usbChannel=svGlobal.DCVC_EXTENSION.WEBUSB(k.DynamicChannel)),svGlobal.DCVC_EXTENSION.DRIVE&&(Sa=svGlobal.DCVC_EXTENSION.DRIVE(k.GatewayChannel),k.addGatewayChannel(Sa)));this.getPrinters=
function(a){if(!k.onagentmessage||!Sa)return null;var b=new hi5.DataBuffer(new Uint8Array(2));b.setByte(6);b.setByte(1);b.markEnd();k.onagentmessage(b.getData());Sa.listCallback=a};this.attachPrinter=function(a){Sa&&Sa.attachPrinter(a,k)};this.showError=tb;this.resetStatus=Kb;this.exeAppCmd=function(a){var b=I.getFocused();b&&b.exeCommand(a)};this.activateApp=function(a){var b;(b=hi5.tool.isNumber(a)?I.getWinById(a):I.getMainWinByAppId(a))?b.activate(1):svGlobal.logger.warn("No window found in "+
a)};this.reconnect=function(a,b,c){void 0==c&&(c=K.forceReconnect||!1);if(!oa&&!c)return!1;D.minWidth&&a<D.minWidth&&(a<D.minWidth&&svGlobal.logger.warn("Width "+a+" is samller than minWidth "+D.minWidth),a=D.minWidth);D.minHeight&&b<D.minHeight&&(b<D.minHeight&&svGlobal.logger.warn("Height "+b+" is samller than minHeight "+D.minHeight),b=D.minHeight);a&=-4;b&=-4;if(!c&&4>Math.abs(a-qa)&&4>Math.abs(b-ra))return!1;if(za&&za.enabled&&!1!==K.displayVC)za.applyResolution(a,b);else if(Xb&&gb||c||Ka&&!Xb)gb=
!1,svGlobal.logger.info("reconnecting..."),ba("8E0"+a+"\t"+b),ya&&(ya.remoteLockFlags=0,ya.checkLockFlags=!0);return!0};this.notify=function(a,b){a="8E6"+a;b&&(a+="\t"+b.join(";"));ba(a)};this.getUploadManager=function(){return ua};this.setFPS=function(a){I.execute("setFPS",[a])};this.addSurface=function(a){if(!I.hasSurface(a)&&(xb||W.setContext(a.context),!I.hasSurface(a)||!a.railWin)){Ya&&a.setPlayerMode();D.mouseMoveEmu&&(a.mouseMoveEmu=X(D.mouseMoveEmu));a.setSize(50,50,"hidden");var b=a.getFreeSpace();
0==qa&&(qa=b.width);0==ra&&(ra=b.height);a.setConfig(K);I.addSurface(a);bb(qa,ra,!0,D.monitorDef?!0:!1);a.setController(ya);a.setTouchpad(X(D.touchpad));var c=b=X(D.mapClipboard),e=b;void 0!=D.copyToLocal?c=X(D.copyToLocal):void 0!=K.copyToLocal&&(c=K.copyToLocal);void 0!=D.copyToRemote?e=X(D.copyToRemote):void 0!=K.copyToRemote&&(e=K.copyToRemote);a.setClipboard(b,c,e);wb&&Lb(a);D.invitation&&!X(D.control)&&(I.setReadOnly(!0),b=hi5.$("requestControl"))&&(b.disabled=!1);b=void 0!=D.ctrlToWin?X(D.ctrlToWin):
void 0!=K.ctrlToWin?K.ctrlToWin:!0;c=void 0!=D.cmdToCtrl?X(D.cmdToCtrl):void 0!=K.cmdToCtrl?K.cmdToCtrl:!0;a.run(parseInt(D.keyboard||1033,10),b,!!K.noKeyStuck,c)}};this.getRunninApps=this.getRunningApps=function(){for(var a=[],b=0,c=I.size();b<c;b++)I.getSurface(b).railWin.getMain(I.zOrders)&&a.push(I.getSurface(b).railWin.getMain(I.zOrders).titleInfo);return a};this.startApp=function(a,b,c){b=b||"";c=c||"";ba("8C2"+a+"\t"+b+"\t"+c);var e=I.getSurface(I.size()-1);e&&(e.remoteApp=new bc(a,b,c))};
this.startExitingApp=function(a){a=I.popWins(a);for(var b=a.length-1;0<=b;b--)I.addWin(a[b])};var lb=new k.DynamicChannel;lb.name="PNPDR";lb.onopen=function(){svGlobal.logger.info("PNPDR DVC onopen()")};lb.process=function(a){a.getLittleEndian32();var b=a.getLittleEndian32();switch(b){case 101:a.getLittleEndian32(),a.getLittleEndian32(),a.getLittleEndian32(),a=new RdpBuffer(new Uint8Array(20),0,20),a.setLittleEndian32(20),a.setLittleEndian32(b),a.setLittleEndian32(1),a.setLittleEndian32(5),a.setLittleEndian32(1),
lb.send(a)}};lb.onclose=function(){svGlobal.logger.info("PNPDR DVC onclose()")};k.addDynamicChannel(lb);var ab=null;X(D.scanner)&&(ab=new k.DynamicChannel,ab.name="SCANNERDVC",ab.onopen=function(){svGlobal.logger.info("scanner DVC onopen().")},ab.process=function(a){var b=a.getByte();switch(b){case 0:var c=a.getByte(),e=a.getByte();b=new Uint8Array(10);b[0]=4;b[1]=7;b[2]=c;b[3]=e;b.set(a.getBytes(2),4);b.set(a.getBytes(2),6);b.set(a.getBytes(2),8);if(k.onagentmessage)k.onagentmessage(b);break;case 1:break;
case 2:c=a.getEnd()-a.getPosition();b=new Uint8Array(c+2);b[0]=4;b[1]=3;b.set(a.getBytes(c),2);if(k.onagentmessage)k.onagentmessage(b);break;case 3:c=a.getEnd()-a.getPosition();b=new Uint8Array(c+3);b[0]=4;b[1]=9;b[2]=0;b.set(a.getBytes(c),3);if(k.onagentmessage)k.onagentmessage(b);break;default:svGlobal.logger.info('Warning: Unknown type "'+b+'" received from DVC, ignored.')}},ab.onclose=function(){var a=new Uint8Array(2);a[0]=4;a[1]=4;if(k.onagentmessage)k.onagentmessage(a)},k.addDynamicChannel(ab));
var Oa=null;k.hasSmartCard()&&(Oa=new k.GatewayChannel,Oa.name="SCARDSTB",Oa.onopen=function(){var a=new Uint8Array(2);a[0]=3;a[1]=1;if(k.onagentmessage)k.onagentmessage(a);X(D.passwordIsPin)&&k.onagentmessage&&!hi5.browser.isMacOS&&hi5.notifications.notify({msg:__svi18n.info.scardAuth||"Smart card authentication in progress. Please wait...",type:0,timeout:1E4})},Oa.process=function(a){var b=a.getEnd()-a.getPosition(),c=a.getByte(),e=a.getByte();switch(c){case 1:switch(e){case 1:c=new Uint8Array(2);
c[0]=3;c[1]=7;if(k.onagentmessage)k.onagentmessage(c);break;case 3:a=a.getBytes(b-2);b=b+4+4+4;mb&&(b+=mb.length);Ta&&(b+=Ta.length);b=new hi5.DataBuffer(new Uint8Array(b));b.setByte(3);b.setByte(9);mb?(b.setLittleEndian32(mb.length),b.setBytes(mb)):b.setLittleEndian32(0);Ta?(b.setLittleEndian32(Ta.length),b.setBytes(Ta)):b.setLittleEndian32(0);b.setLittleEndian32(a.length);b.setBytes(a);b.markEnd();if(k.onagentmessage)k.onagentmessage(b.getData());break;case 5:a=a.getBytes(b);c=new Uint8Array(b);
c[0]=3;c[1]=11;c.set(a,2);if(k.onagentmessage)k.onagentmessage(c);break;case 2:case 4:break;default:svGlobal.logger.warn("Invalid smart card channel auth data received: unknown sub-type ["+a[1]+"].")}break;case 2:if(Oa)if(1==e){if(c=new Uint8Array(b),c[0]=3,c[1]=3,c.set(a.getBytes(b),2),k.onagentmessage)k.onagentmessage(c)}else svGlobal.logger.warn("Invalid smart card channel pcsc data received: unknown sub-type ["+a[1]+"].");break;default:svGlobal.logger.warn("Invalid smart card channel data received: unknown type ["+
a[0]+"].")}},Oa.onclose=function(){var a=new Uint8Array(2);a[0]=3;a[1]=4;if(k.onagentmessage)k.onagentmessage(a)},k.addGatewayChannel(Oa));K.detectNetwork&&(w+="&connectType=7",Bc());this.getNetworkResult=function(){return ub};this.getAgentLink=function(){var a=navigator.userAgentData?navigator.userAgentData.platform:navigator.platform||navigator.appVersion;return-1!=a.indexOf("Win")?"agent_setup.exe":-1!=a.indexOf("macOS")||-1!=a.indexOf("Mac")?"agent_setup.pkg":""};var Mb=new Map,Nb=new Map;this.writeAgent=
function(a){a.byteLength&&(a=new Uint8Array(a));switch(a[0]){case 3:if(Oa){var b=a.slice?new hi5.DataBuffer(a.slice(2,a.length)):new hi5.DataBuffer(a.subarray(2,a.length));switch(a[1]){case 1:case 4:case 5:case 6:case 7:case 9:case 11:break;case 2:break;case 3:a[0]=2;a[1]=1;Oa.send(a);break;case 8:Mb.clear();Nb.clear();a=b.getLittleEndian32();if(0!=a)a=b.getLittleEndian32(),b=b.getAscllString(a,!1),hi5.notifications.notify({msg:b});else{var c=b.getLittleEndian32(),e=document.getElementById("scardSelection");
e||(e=document.createElement("div"),e.id="scardSelection",e.className="appdlg",document.body.appendChild(e));if(e)if(0==c)e&&(e.innerHTML="<p>Error: Could not find any connected smart card. Please make check the connectivity and then refresh the page",b=new hi5.ui.Lightbox(e),b.onclose=function(){location.reload()},b.show());else{e.innerHTML=1<c?'<p><b>PLEASE SELECT A SMART CARD, ENTER YOUR CREDENTIAL AND CLICK "Continue".</b></p>':'<p><b>PLEASE ENTER YOUR CREDENTIAL AND CLICK "Continue".</b></p>';
for(a=0;a<c;a++){var d=b.getLittleEndian32();d=b.getBytes(d);var m=b.getLittleEndian32();m=b.getAscllString(m,!1);var h=b.getLittleEndian32();h=b.getAscllString(h,!1);var E=b.getLittleEndian32();b.getAscllString(E,!1);E=b.getLittleEndian64();E=(new Date(1E3*E)).toDateString();d=Cc(a,d,h,m,E);e.appendChild(d)}e.innerHTML+="<br>";b=document.createElement("div");b.innerHTML+="Smart card credential: ";a=document.createElement("input");a.type="text";a.id="userPin";a.placeholder="PIN";a.value="";a.required=
!0;b.appendChild(a);e.appendChild(b);e.innerHTML+="<br>";b=new hi5.ui.LightboxWithBtn(e);b.onclose=function(){var B,F=document.querySelector('input[name="scard_name"]:checked');F&&(B=parseInt(F.value));mb=Mb.get(B);ib=Nb.get(B);B=document.getElementById("userPin").value;Ta=(new TextEncoder("utf-8")).encode(B);B=2;B=Ta?B+4+Ta.length:B+4;B=ib?B+4+ib.length:B+4;B=new Uint8Array(B);B=new hi5.DataBuffer(B);B.setByte(1);B.setByte(2);Ta?(B.setLittleEndian32(Ta.length),B.setBytes(Ta)):B.setLittleEndian32(0);
ib?(B.setLittleEndian32(ib.length),B.setAsciiString(ib,ib.length)):B.setLittleEndian32(0);Oa&&Oa.send(B)};document.getElementById("userPin").addEventListener("keypress",function(B){"Enter"===B.key&&(B.preventDefault(),document.getElementById("continue_button").click())});b.show()}}break;case 10:a=b.getLittleEndian32();0!=a?(a=b.getLittleEndian32(),b=b.getAscllString(a,!1),hi5.notifications.notify({msg:b})):(a=b.getLittleEndian32(),a=b.getBytes(a),b=new Uint8Array(6+a.length),b=new hi5.DataBuffer(b),
b.setByte(1),b.setByte(4),b.setLittleEndian32(a.length),b.setBytes(a),Oa.send(b));break;case 12:a[0]=1;a[1]=6;Oa.send(a);break;default:svGlobal.logger.warn("Warning: Unknown smart card response header: [3 / "+a[1]+"], ignored.")}}break;case 4:if(ab)switch(a[1]){case 2:b=a.slice?new hi5.DataBuffer(a.slice(2,a.length)):new hi5.DataBuffer(a.subarray(2,a.length));e=document.getElementById("dsSelection");e||(e=document.createElement("div"),e.id="dsSelection",e.className="appdlg",document.body.appendChild(e));
if(0!=b.getLittleEndian16())e&&(e.innerHTML="<p>Error on local: failed to get the list of connected scanners. Close to continue without scanning.</p>",b=new hi5.ui.Lightbox(e),b.onclose=function(){k.run()},b.show());else if(c=(a.byteLength-4)/41,0==c)e&&(e.innerHTML="<p>Error: Could not find any connected scanner. Please:<ul><li>Power on or connect the scanner and then refresh the page; or</li><li>Close this dialog to connect to the machine without using scanner.</li></ul></p>",b=new hi5.ui.Lightbox(e),
b.onclose=function(){k.run()},b.show());else if(1==c){if(b=new Uint8Array(3),b[0]=4,b[1]=5,b[2]=0,k.onagentmessage)k.onagentmessage(b)}else if(e){e.innerHTML='<p> Please choose a scanner &lt;DriverType: DeviceName&gt; and click "Continue".</a></p>';for(a=0;a<c;a++)d=b.getAscllString(41,!0),d=Dc(a,d),e.appendChild(d);e.innerHTML+="<br>";b=new hi5.ui.LightboxWithBtn(e);b.onclose=function(){var B=0,F=document.querySelector('input[name="ds_name"]:checked');F&&(B=F.value);F=new Uint8Array(3);F[0]=4;F[1]=
5;F[2]=B;if(k.onagentmessage)k.onagentmessage(F)};b.show()}break;case 3:case 8:case 10:b=a.slice?new hi5.DataBuffer(a.slice(2,a.length)):new hi5.DataBuffer(a.subarray(2,a.length));ab.send(b);break;case 4:b=a.slice?new hi5.DataBuffer(a.slice(2,a.length)):new hi5.DataBuffer(a.subarray(2,a.length));ab.send(b);hi5.notifications.notify({msg:__svi18n.info.TwainNotSupported,type:2});break;case 6:b=a.slice?new hi5.DataBuffer(a.slice(2,a.length)):new hi5.DataBuffer(a.subarray(2,a.length));b.getLittleEndian16();
k.run();break;default:svGlobal.logger.warn("Warning: Unknown response header: [4 / "+a[1]+"], ignored.")}break;case 5:switch(a[1]){case 1:b=a[2]|a[3]<<8,a=a[4]|a[5]<<8,svGlobal.logger.info("Agent version, major: "+b+" minor: "+a),(e=hi5.appcfg.agent&&hi5.appcfg.agent.version)&&(e.major>b||e.major==b&&e.minor>a)&&(b=__svi18n.info.newVersion||"New versoin available",a=__svi18n.info.updateAgent||"Please download and install the new gateway agent",e=k.getAgentLink(),hi5.notifications.notify({title:b,
msg:a+(': <a href="'+e+'">'+e+"</a>")}))}break;case 6:switch(a[1]){case 1:b=new hi5.DataBuffer(a);b.skipPosition(2);e=b.getLittleEndian32();c=[];for(a=0;a<e;a++)m=b.getLittleEndian32(),d=b.getUnicodeString(m),m=b.getLittleEndian32(),m=b.getUnicodeString(m),c.push({name:d,driver:m});Sa&&Sa.listCallback&&(Sa.listCallback(c),Sa.listCallback=null)}break;case 7:Sa.send(a.subarray(1));break;default:svGlobal.logger.warn("Invalid channel data received: unknown type ["+a[0]+"].")}};var mb,Ta,ib,Qb={type:6,
data:null};this.setAgentStatus=function(a){uc=a};this.getAgentStatus=function(){return uc};this.run=function(){var a;if(a=null==k.onagentmessage)a=1==k.mode?!1:k.hasSmartCard()||k.hasScanner()||X(D.localPrinter);a&&window.startGatewayAgent?startGatewayAgent(k):(k.hasUSB()?I.getFocused().requestUsbDevices(k.getUSB(),function(b){ia.usbChannel.openDevices(b);Ob()}):Ob(),Da.supportWebAudio&&Da.iOSFix())};this.getDesktop=function(){return W};this.mouseDown=function(a,b,c){Ka&&ba("80"+a+"\t"+b+"\t"+c)};
this.mouseMove=function(a,b){Ka&&ba("82"+a+"\t"+b)};this.mouseUp=function(a,b,c){Ka&&ba("81"+a+"\t"+b+"\t"+c)};this.writeKeyCode=function(a,b){Ka&&ba("8B"+(a?0:49152)+"\t"+b)};this.writeScancode=function(a,b){Ka&&("number"==typeof a?(ba("840\t"+a),ba("8449152\t"+a)):ba("84"+(a?0:49152)+"\t"+b))};this.resetSize=function(a,b){k.reconnectOnResize&&(Ja?(fb&&(clearTimeout(fb),fb=0),a&=-4,b&=-4,fb=setTimeout(function(){za&&za.enabled&&za.applyResolution(a,b);setTimeout(function(){k.writeRawInput("8C661441\t"+
a+"\t"+b);3==k.windowState&&tc()},150);svGlobal.logger.info("-- displayChange, h:"+b)},777)):k.running()&&(fb&&(clearTimeout(fb),fb=0),fb=setTimeout(function(){k.reconnect(a,b)},555)))};var Ea=new RdpBuffer([],0,0);this.suppressOutput=function(a){if(!k.sessionInfo.suppressOutput)return!1;void 0==a&&(a=!0);var b=new Uint8Array(a?3:11);b[0]=146;b[1]=3;b[2]=a?1:0;a||(b[3]=Eb,b[4]=Eb>>8,b[5]=Db,b[6]=Db>>8,b[7]=Fb,b[8]=Fb>>8,b[9]=Gb,b[10]=Gb>>8);ba(b.buffer);return!0};this.refreshOutput=function(a,b,c,
e){var d=new Uint8Array(c?11:3);d[0]=146;d[1]=3;d[2]=2;c&&(d[3]=a,d[4]=a>>8,d[5]=b,d[6]=b>>8,d[7]=c,d[8]=c>>8,d[9]=e,d[10]=e>>8);ba(d.buffer)};this.sendPing=function(a){var b=new Uint8Array(a?2+a.length:2);b[0]=146;b[1]=0;a&&b.set(a,2);ba(b.buffer)};this.startPing=function(a,b){b=b||0;xa||(xa=new hi5.tool.ResponseMonitor(function(){Ka&&k.sendPing()},function(){if(Ka&&k.onnoresponse)return k.onnoresponse()}));xa.setInterval(a,b);var c=new Uint8Array(4);c[0]=146;c[1]=2;c[2]=a;c[3]=b;ba(c.buffer);setTimeout(function(){xa&&
xa.check()},1E3*(a+b));sa?sa.postMessage({type:0,cmd:6,start:1}):(ea.onSlowPath=ea.onFastPath=jc,ea.onReqHistory=function(){jc(15555)})};this.stopPing=function(){xa&&xa.stop();sa?sa.postMessage({type:0,cmd:6,start:0}):ea.onSlowPath=ea.onFastPath=ea.onReqHistory=null};var Ma=null,qc=0;this.play=function(){ba("F3")};this.pause=function(){ba("F2")};this.scan=function(a){ba("F4"+(a?"1":"0"))};this.seek=function(a){var b=I.getFocused();b&&oa&&(ba("F4"+(a?"1":"0")+"\t"+(a/b.getScale().x|0)),W.pause(!0))};
var db=ka=V=0;var Xa=22050;var pc=!1;this.showMessage=function(a,b,c){k&&k.displayMsg&&a&&((b=b||I.getFocused())?b.showMessage(a,c):("string"==typeof a&&(a={msg:a,timeout:c||0}),hi5.notifications.notify(a)))};this._unload=ob;this.close=function(){svGlobal.logger.info("closing...");oa&&Ja&&I&&K.closeRemoteApp&&I.tryCloseRemoteApps();W&&W.isSendingHistory()?(svGlobal.logger.warn("In the middle of sending history, close delayed"),setTimeout(sc,2222)):sc()};hi5.browser.isChromeApp?chrome.runtime.onSuspend.addListener(k.close):
window.addEventListener("unload",k.close,!1)}
Rdp.languageToKeyboard={af:0,sq:0,ar:1025,"ar-SA":1025,"ar-IQ":0,"ar-EG":0,"ar-LY":0,"ar-DZ":0,"ar-MA":0,"ar-TN":0,"ar-OM":0,"ar-YE":0,"ar-SY":0,"ar-JO":0,"ar-LB":0,"ar-KW":0,"ar-AE":0,"ar-BH":0,"ar-QA":0,eu:0,bg:0,be:0,ca:0,zh:2052,"zh-TW":1028,"zh-CN":2052,"zh-HK":1028,"zh-SG":2052,hr:0,cs:0,da:0,nl:1043,"nl-BE":2067,en:1033,"en-US":1033,"en-GB":2057,"en-AU":0,"en-CA":4105,"en-NA":0,"en-IE":0,"en-ZA":0,"en-JM":0,"en-BZ":0,et:0,fo:0,fa:0,fi:0,fr:1036,"fr-BE":2060,"fr-CA":3084,"fr-CH":4108,"fr-LU":0,
gd:0,"gd-IE":0,de:1031,"de-CH":2055,"de-AT":0,"de-LU":0,"de-LI":0,el:0,he:1037,hi:0,hu:0,is:1039,id:0,it:1040,"it-CH":66576,ja:3758162961,ko:3758162962,lv:0,lt:0,mk:0,mt:0,nb:1044,nn:1083,no:1044,pl:1045,pt:2070,"pt-BR":1046,rm:0,ro:0,"ro-MO":0,ru:1049,"ru-MO":0,sr:0,sk:0,sl:0,sb:0,es:1034,"es-AR":0,"es-GT":0,"es-CR":0,"es-PA":0,"es-DO":0,"es-MX":2058,"es-VE":0,"es-CO":0,"es-PE":0,"es-EC":0,"es-CL":0,"es-UY":0,"es-PY":0,"es-BO":0,"es-SV":0,"es-HN":0,"es-NI":0,"es-PR":0,sx:0,sv:1053,"sv-FI":0,th:0,
ts:0,tn:0,tr:1055,uk:0,ur:0,ve:0,vi:0,xh:0,ji:0,zu:0,detect:function(){var w=navigator&&(navigator.language||navigator.userLanguage||""),L=Rdp.languageToKeyboard[w];if(!L){var P=w.indexOf("-");P&&(L=Rdp.languageToKeyboard[w.substring(0,P)])}L||(svGlobal.logger.info("No valid layout for "+w),L=1033);return L}};svGlobal.Rdp||(svGlobal.Rdp=Rdp);var RdpBuffer=hi5.DataBuffer;
