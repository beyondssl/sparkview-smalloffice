var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.checkStringArgs=function(D,M,T){if(null==D)throw new TypeError("The 'this' value for String.prototype."+T+" must not be null or undefined");if(M instanceof RegExp)throw new TypeError("First argument to String.prototype."+T+" must not be a regular expression");return D+""};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.SIMPLE_FROUND_POLYFILL=!1;$jscomp.ISOLATE_POLYFILLS=!1;
$jscomp.FORCE_POLYFILL_PROMISE=!1;$jscomp.FORCE_POLYFILL_PROMISE_WHEN_NO_UNHANDLED_REJECTION=!1;$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(D,M,T){if(D==Array.prototype||D==Object.prototype)return D;D[M]=T.value;return D};
$jscomp.getGlobal=function(D){D=["object"==typeof globalThis&&globalThis,D,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof global&&global];for(var M=0;M<D.length;++M){var T=D[M];if(T&&T.Math==Math)return T}throw Error("Cannot find global object");};$jscomp.global=$jscomp.getGlobal(this);$jscomp.IS_SYMBOL_NATIVE="function"===typeof Symbol&&"symbol"===typeof Symbol("x");$jscomp.TRUST_ES6_POLYFILLS=!$jscomp.ISOLATE_POLYFILLS||$jscomp.IS_SYMBOL_NATIVE;$jscomp.polyfills={};
$jscomp.propertyToPolyfillSymbol={};$jscomp.POLYFILL_PREFIX="$jscp$";var $jscomp$lookupPolyfilledValue=function(D,M){var T=$jscomp.propertyToPolyfillSymbol[M];if(null==T)return D[M];T=D[T];return void 0!==T?T:D[M]};$jscomp.polyfill=function(D,M,T,ja){M&&($jscomp.ISOLATE_POLYFILLS?$jscomp.polyfillIsolated(D,M,T,ja):$jscomp.polyfillUnisolated(D,M,T,ja))};
$jscomp.polyfillUnisolated=function(D,M,T,ja){T=$jscomp.global;D=D.split(".");for(ja=0;ja<D.length-1;ja++){var X=D[ja];if(!(X in T))return;T=T[X]}D=D[D.length-1];ja=T[D];M=M(ja);M!=ja&&null!=M&&$jscomp.defineProperty(T,D,{configurable:!0,writable:!0,value:M})};
$jscomp.polyfillIsolated=function(D,M,T,ja){var X=D.split(".");D=1===X.length;ja=X[0];ja=!D&&ja in $jscomp.polyfills?$jscomp.polyfills:$jscomp.global;for(var ra=0;ra<X.length-1;ra++){var ba=X[ra];if(!(ba in ja))return;ja=ja[ba]}X=X[X.length-1];T=$jscomp.IS_SYMBOL_NATIVE&&"es6"===T?ja[X]:null;M=M(T);null!=M&&(D?$jscomp.defineProperty($jscomp.polyfills,X,{configurable:!0,writable:!0,value:M}):M!==T&&($jscomp.propertyToPolyfillSymbol[X]=$jscomp.IS_SYMBOL_NATIVE?$jscomp.global.Symbol(X):$jscomp.POLYFILL_PREFIX+
X,X=$jscomp.propertyToPolyfillSymbol[X],$jscomp.defineProperty(ja,X,{configurable:!0,writable:!0,value:M})))};$jscomp.polyfill("String.prototype.startsWith",function(D){return D?D:function(M,T){var ja=$jscomp.checkStringArgs(this,M,"startsWith");M+="";var X=ja.length,ra=M.length;T=Math.max(0,Math.min(T|0,ja.length));for(var ba=0;ba<ra&&T<X;)if(ja[T++]!=M[ba++])return!1;return ba>=ra}},"es6","es3");
$jscomp.findInternal=function(D,M,T){D instanceof String&&(D=String(D));for(var ja=D.length,X=0;X<ja;X++){var ra=D[X];if(M.call(T,ra,X,D))return{i:X,v:ra}}return{i:-1,v:void 0}};$jscomp.polyfill("Array.prototype.findIndex",function(D){return D?D:function(M,T){return $jscomp.findInternal(this,M,T).i}},"es6","es3");var svManager={getInstance:function(){var D=window.$rdp;return D&&D.running&&D.running()?D:null}};svGlobal.getInstance=svManager.getInstance;
function connvertServer(D){var M={};M.id=D.id;M.server=D.id;M.displayName=D.displayName||D.id;if(D=D.rdp){for(var T in D)M[T]=D[T];M.user=D.username||"";M.pwd=D.password||"";M.useConsole=D.console||!1;M.legacyMode=D.leagacyMode||D.legacyMode||!1;M.server_bpp=D.color||16;M.exe=D.remoteProgram||"";M.args=D.remoteArgs||"";M.startProgram=0<M.exe.length?"app":M.command&&0<M.command.length?"shell":"noapp"}return M}
function Rdp2(D){D=svGlobal.util.getServerArgs(D);if(!D||!D.gateway)return hi5.notifications.notify({msg:__svi18n.noauth}),null;var M=D.gateway||"",T=0,ja=0,X=16,ra=1==D.useSSL||"true"==D.useSSL||"on"==D.useSSL||null;D.width&&(T=parseInt(D.width,10));D.height&&(ja=parseInt(D.height,10));D.color&&(X=parseInt(D.color,10));D.server_bpp&&(X=parseInt(D.server_bpp,10));D=hi5.browser.obj2url(D);null===ra&&(ra="https:"==location.protocol);return new Rdp((ra?"wss://":"ws://")+M+"/RDP?"+D,T,ja,X)}
svGlobal.Rdp2||(svGlobal.Rdp2=Rdp2);
function Rdp(D,M,T,ja){var X,ra;function ba(a){return"on"==a||"true"==a||1==a}function Za(){var a=l.gateway;l.ongetgatewayaddress&&(a=l.ongetgatewayaddress(a));return a}function uc(){var a=hi5.storage.get("SV_CONN_SHARE_ID");a||(a=hi5.tool.uuid(),hi5.storage.set("SV_CONN_SHARE_ID",a));return a}function Sb(a,b){a=K[a]||b;a.startsWith("/")||a.toLowerCase().startsWith("http")||(a=hi5.libPath+a);return a}function fb(){return C.displayName||C.server||C.symlink||C.id||"undefined"}function wb(a){l.loadbalanceToken||
(l.loadbalanceToken=K.loadbalanceTokenName?K.loadbalanceTokenName+"="+a:"")}function xb(a,b,c){l.ontitlechange&&(a=l.ontitlechange(a,c));l.setTitle&&a&&(b=b||window,b.document.title=a)}function gb(a,b){switch(a){case 16:case 8:case 24:case 32:break;case 15:return C.invitation||l.showMessage("15 bit color is not supported anymore."),!1;default:return!1}Ta=a;b&&(na?na.postMessage({type:0,cmd:1,data:a}):aa&&aa.setColor(a));return!0}function $a(a,b,c,k){ka=a;la=b;yb=zb=0;Ab=ka-1;Bb=la-1;Fa&&(ka=(C.waWidth||
hi5.browser.getScreenWidth())|0,la=(C.waHeight||hi5.browser.getScreenHeight())|0);C.minWidth&&ka<C.minWidth&&(ka=C.minWidth|0);C.minHeight&&la<C.minHeight&&(la=C.minHeight|0);ka&=-4;la&=-4;svGlobal.logger.warn("resolution changed, w:"+ka+" h:"+la);var d=ka,n=la;Q?Q.resize(d,n):Q=new Tb(d,n);I.setSize(ka,la,Fa?"hidden":null);if(c||ka!=a||la!=b)na?na.postMessage({type:0,cmd:2,data:{w:ka,h:la}}):aa&&aa.setResolution(ka,la);if(l.onresolutionchange&&!k)l.onresolutionchange(a,b)}function V(a){!Ka&&ia&&
(na?(Cb.data=a,"string"!=typeof a?na.postMessage(Cb,[a]):na.postMessage(Cb)):aa.writeRawInput(a))}function Ub(a){switch(a){case "\r":break;case "\n":l.writeScancode(28);break;case "\t":l.writeScancode(15);break;default:V("86"+a)}}function Db(a){var b=this;a||(a=143);this.send=function(c){var k=!!c.buffer,d=k?c:c.getData(),n=64==a;c=k?d.length:c.getEnd()||d.length;c<d.length&&(d=k?d.subarray(0,c):d.slice(0,c));k=n?5:9;c=new Uint8Array(k+c);c[0]=a;if(n)c[1]=b.id,c[2]=b.id>>8,c[3]=b.id>>16,c[4]=b.id>>
24;else{n=b.name;for(var e=Math.min(n.length,8),z=0;z<e;z++)c[1+z]=n.charCodeAt(z)}c.set(d,k);V(c.buffer)};this.name="";this.count=this.id=this.flags=0}function mb(a){if(l){var b=__svi18n.errorCode[a];l.displayMsg&&b&&l.showMessage(b);0<svGlobal.log&&console.error&&console.error(b||"error code: "+a);if(l.onerror)l.onerror({name:a,message:b})}}function Eb(a){if(l){var b=__svi18n.info[a];b||(b="info "+a);l.displayMsg&&l.showMessage(b);svGlobal.logger.info(b)}}function Fb(){var a=ia;ab=ia=!1;na?na.postMessage({type:0,
cmd:3}):aa&&aa.resetStatus();a&&(ia=a)}function vc(){var a=I.getFocused();a=a?a.getWindow():window;return"&waWidth="+C.waWidth+"&waHeight="+C.waHeight+"&dpWidth="+a.innerWidth+"&dpHeight="+a.innerHeight}function Gb(a){oa||(oa=new hi5.file.UploadManager(new hi5.file.WsFileService(V)),oa.addEvent("beforeupload",function(b,c,k){if(l.beforeupload)return l.beforeupload(b,c,k)}),oa.addEvent("fileuploaded",function(b,c,k){if(l.onfileuploaded)l.onfileuploaded(b,c,k)}),oa.addEvent("uploaded",function(b,c){if(l.onuploaded)l.onuploaded(b,
c)}),oa.addEvent("uploadingCancelled",function(){if(l.onuploadingCancelled)l.onuploadingCancelled()}));a.setFileHandler(oa)}function Vb(a,b,c){var k=!1;this.exe=a;this.args=b||"";this._dir=c||"";var d=this;this.close=function(){!k&&ia&&(k=!0,V("8C5"+d.exe+"\t"+d.args+"\t"+l.sessionInfo.appInfo.session))}}function wc(){var a=window.opener;if(a)try{if(a.__sparkUser&&a.__sparkUser.session)return a.__sparkUser;if(a.opener&&a.opener.__sparkUser.session)return a.opener.__sparkUser}catch(b){}return null}
function xc(){var a=0,b=0,c=new l.GatewayChannel;c.name="MESSGSTB";c.onopen=function(){svGlobal.logger.info("Message Channel open")};c.process=function(k){if(0==k.getByte())k.getByte(),k.getByte(),k.getByte();else{var d=k.getByte(),n=k.getLittleEndian16(),e=k.getLittleEndian16();if(0!=d)svGlobal.logger.warn("Invalid AUTODETECT_REQUEST");else switch(e){case 1:case 4097:e=new RdpBuffer(new Uint8Array(6),0,6);e.setByte(6);e.setByte(1);e.setLittleEndian16(n);e.setLittleEndian16(0);e.markEnd();c.send(e);
break;case 20:case 276:case 4116:a=6;b=Date.now();break;case 2:n=k.getLittleEndian16();a+=n;break;case 43:case 1065:case 1577:43==e&&(d=k.getLittleEndian16(),a=a+d+8,k.skipPosition(d));k=k.has(4)?k.getLittleEndian32():0;a+=k;k=Date.now()-b;d=new RdpBuffer(new Uint8Array(14),0,14);d.setByte(14);d.setByte(1);d.setLittleEndian16(n);d.setLittleEndian16(43==e?3:11);d.setLittleEndian32(k);d.setLittleEndian32(a);d.markEnd();c.send(d);break;case 2112:case 2176:case 2240:n=k.getLittleEndian32();e=k.getLittleEndian32();
k=k.getLittleEndian32();nb={baseRTT:n,bandwidth:e,averageRTT:k};if(l.onnetworkresult)l.onnetworkresult(nb);svGlobal.logger.warn("Network Characteristics Result:");svGlobal.logger.warn(nb);break;default:svGlobal.logger.warn("Invalid network detect PDU",k)}}};c.onclose=function(){svGlobal.logger.info("MSG channel close")};l.addGatewayChannel(c)}function yc(a,b){var c=document.createElement("div"),k=document.createElement("input");k.type="radio";k.name="ds_name";k.value=a;0==a&&(k.defaultChecked=!0);
c.appendChild(k);c.innerHTML+=b;c.innerHTML+="<br>";return c}function Wb(){var a="";C&&ba(C.connectif)&&C.symlink&&"sessionStorage"in window&&(a="SV_"+C.symlink,C.domain&&(a+=C.domain),C.user&&(a+=C.user));return a}function zc(){var a=Wb(),b="";a&&(b=sessionStorage[a]||"")&&(b="&preSymJoin="+b);return b}function Ac(a,b){var c=0,k=I.size(),d=Array(k),n=Array(k),e=0,z=0,E=0,H=0,O=0,y=0,u="";if(a){n=Q.parseMonitorDef(a);for(k=n.length;c<k;c++){var p=n[c];p[0]<E&&(E=p[0]);p[1]<H&&(H=p[1]);p[2]>O&&(O=
p[2]);p[3]>y&&(y=p[3])}0>E&&(e=-E);0>H&&(z=-H);p=0>b?[E,H,O,y]:n[b];C.width=p[2]-p[0]+1;C.height=p[3]-p[1]+1;c=I.getSurface(0);c.setMonitor(p[0],p[1],p[2],p[3]);if(e||z)for(p=c.getMousePosition(),p.left+=e,p.right+=e,p.top+=z,p.bottom+=z,c=0;c<k;c++)p=n[c],p[0]+=e,p[1]+=z,p[2]+=e,p[3]+=z;Q.setMonitorLayout(n);0>b&&Q.setMonitorCount(0);l.reconnectOnResize=!1;return"&monitorDef="+a+"&width="+C.width+"&height="+C.height}if(1<k&&!Fa){for(I.verifyMonitors();c<k;c++)a=I.getSurface(c),p=a.getMousePosition(),
p.left<E&&(E=p.left),p.top<H&&(H=p.top),p.right>O&&(O=p.right),p.bottom>y&&(y=p.bottom),d[c]=p,u&&(u+=","),u+=p.left+":"+p.top+":"+p.right+":"+p.bottom;0>E&&(e=-E);0>H&&(z=-H);for(c=0;c<k;c++){p=I.getSurface(c).getMousePosition();if(e||z)p.left+=e,p.right+=e,p.top+=z,p.bottom+=z;n[c]=[p.left,p.top,p.right,p.bottom,p.left==e&&p.top==z?1:0]}Q.setMonitorLayout(n);l.reconnectOnResize=!1}u&&(svGlobal.logger.warn("MonitorDef:"+u),C.width=O-E+1,C.height=y-H+1,u="&monitorDef="+u+"&width="+C.width+"&height="+
C.height);return u}function Bc(){if(!sessionStorage)return"";var a=sessionStorage.getItem("appInfo.session");if(!a)return"";a="&_session="+a;var b=sessionStorage.getItem("appInfo.numericId");b&&(a+="&_numericId="+b);return a}function Hb(){if(!ia){ab=!1;var a="";if(Ka)ca.init(!1,!0,!1,0,!1,!1);else{a=D+"&width="+ka+"&height="+la+"&server_bpp="+Ta+"&audio="+(pa.available||hi5.browser.isIE)+zc()+Ac(C.monitorDef,C.monitor);0>D.indexOf("waWidth")&&(a+=vc());var b=new Date;C.tzOffset||(a+="&tzOffset="+
b.getTimezoneOffset());if(!C.timezone){var c=hi5.timezone.getTimeZone();c&&(a+="&timezone="+encodeURIComponent(c.standardName))}a+="&time="+b.getTime();void 0==C.soundPref&&(C.soundPref=0,a+="&soundPref=0");var k=c=b="";for(k in Ua){var d=Ua[k];"flags"in d&&(b&&(b+=",",c+=","),b+=d.name,c+=d.flags)}b&&(a=a+("&channelName="+b)+("&channelFlags="+c));b="";for(k in Va)d=Va[k],"flags"in d&&(b&&(b+=","),b+=d.name);b&&(a+="&gwChannelName="+b);if(c=wc())b=c.account,c=c.session,b&&(a+="&account="+b),c&&(a+=
"&session="+c);b=hi5.browser.isTouch&&(1024<=window.innerWidth||768<=window.innerHeight);C.audioRecord=ba(C.audioRecord)&&hi5.audio.recordable;ca.init(b,!!C.remotefx,C.audioRecord,C.soundPref,ba(C.mapCamera)&&!!navigator.mediaDevices,ba(C.mapUSB)&&!!navigator.usb);C.audioRecord&&(a+="&audioRecord=on");C.decompressingRDP61&&(a+="&decompressingRDP61=on");0<ca.count&&(a+="&dvcChannels="+ca.names.join(","));hi5.browser.binaryWS()&&(a+="&binary=on");K.existingFile&&(a+="&existingFile="+K.existingFile);
a+="&isTouch="+b+"&gatewayAddr="+encodeURIComponent(Za());a=l.modifyURL(a);K.copyTextOnly&&ba(C.mapClipboard)&&(a+="&copyTextOnly=on");(b=hi5.browser.cookie.get("__SV_TOKEN_A"))&&(a+="&__SV_TOKEN_A="+encodeURIComponent(b));(b=svGlobal.Rdp.languageToKeyboard.detect())&&(a+="&_keyboard="+b);ba(C.textPrinter)&&(a+="&printerDriver="+encodeURIComponent("Generic / Text Only"));a+=Bc()}void 0==K.wsPost&&(K.wsPost=!1);na?(Ka&&(Ka.onopen=Ib,Ka.onclose=hb,Ka.onmessage=function(e){Jb.data=e.data;na.postMessage(Jb,
[Jb.data])}),na.postMessage({type:0,cmd:0,data:{addr:a,width:ka,height:la,server_bpp:Ta,libPath:hi5.libPath,libMin:hi5.libMin,wsPost:K.wsPost}})):(aa=new RdpGeneral(Ka||a,ka,la,Ta,Q,!1,K.wsPost),aa.run());na?na.addEventListener("message",Xb,!1):(aa.onopen=Ib,aa.onmessage=Yb,aa.onclose=hb,aa.onerror=mb,aa.oninfo=Eb,aa.onloggedin=Kb,aa.onresolutionchange=function(e,z){$a(e,z,!1,C.monitorDef&&0<=C.monitor?!0:!1)},aa.onAltSecWindows=Zb,aa.onMoveCursor=Lb,aa.onCloseSurface=$b,aa.onColorChange=gb,aa.onHistoryReceived=
function(){Mb()},aa.onLockKeyState=function(e){if(l.onLockKeyState)l.onLockKeyState(e)});if(a=I.getSurface(I.size()-1))Fa?a&&(a.remoteApp=new Vb(C.exe,C.args,"")):xb(fb(),a.getWindow());if(C.invitation&&!ba(C.shadow)){var n=null;a&&(n=a.initChat(C.expert));ib=new l.GatewayChannel;ib.name="C_H_A_T";ib.process=function(e){e=e.getUnicodeString(e.getEnd()-e.getPosition(),!0);n&&n.add(e,C.novice)};n&&(n.onchat=function(e){if(ia){var z=Array(2*e.length);z=new hi5.DataBuffer(z,0,z.length);z.setUnicodeString(e);
z.markEnd();ib.send(z)}});l.addGatewayChannel(ib)}hi5.browser.isIE&&!jb&&(0==C.playSound||0<l.mode)&&(jb=hi5.browser.loadFlash(K.flash||hi5.libPath+"plugin.swf"))&&(ac=!0)}}function Xb(a){a=a.data;switch(a.type){case 1:switch(a.event){case 0:Ib();break;case 1:hb(a.expected);break;case 2:mb(a.code);break;case 3:Eb(a.code);break;case 4:Kb();break;case 5:$a(a.w,a.h,!1,C.monitorDef&&0<=C.monitor?!0:!1);break;case 6:Lb(a.x,a.y,!0);break;case 7:$b();break;case 8:0==a.id&&Mb();sa&&sa.check(1<a.id?15555:
0);break;case 9:gb(a.color);break;case 10:if(l.onLockKeyState)l.onLockKeyState(a.state);break;default:svGlobal.logger.warn("Invalid worker event "+a.type)}break;case 2:Q.setRGBs(a.x,a.y,a.w,a.h,a.pixel,a.offset,a.scansize);break;case 3:Q.moveArea(a.srcx,a.srcy,a.cx,a.cy,a.dx,a.dy);break;case 5:Q.fillRect(a.l,a.t,a.w,a.h,a.color);break;case 6:Q.drawLine(a.x1,a.y1,a.x2,a.y2,a.color);break;case 7:Q.bitBlt(a.opcode,a.dstwidth,a.x,a.y,a.cx,a.cy,a.src,a.srcwidth,a.srcx,a.srcy);break;case 8:Q.drawLineExt(a.x1,
a.y1,a.x2,a.y2,a.color,a.opcode);break;case 9:bc(a);break;case 10:Yb(a);break;case 11:Aa.attach(a.data,0,a.data.length);Zb(Aa,a.size);break;case 12:Q.drawText(a.font,a.flags,a.mixmode,a.foregroundColor,a.backgroundColor,a.clipLeft,a.clipTop,a.clipcx,a.clipcy,a.boxLeft,a.boxTop,a.boxcx,a.boxcy,a.x,a.y,a.length,a.text,a._left,a._top,a._right,a._bottom);break;case 13:Q.drawBitmap(a.cacheID,a.cacheIDX,a.x,a.y,a.cx,a.cy,a.srcx,a.srcy,a.opcode);break;case 14:Q.saveDesktop(a.x,a.y,a.cx,a.cy,a.offset);break;
case 15:Q.restoreDesktop(a.x,a.y,a.cx,a.cy,a.offset);break;case 16:Q.putFont(a.font,a.character,a.glyph);break;case 17:Q.putCursor(a.idx,a.cursor);break;case 18:Q.setCursor(a.idx);break;case 19:Q.getHistory(V,function(){na.postMessage({type:0,cmd:7})});sa&&sa.check(15555);break;case 20:Aa.attach(a.data,a.off,a.data.length-a.off);Q.setHistory(a.order,Aa);break;case 21:Q.putBitmap(a.id,a.idx,a.bitmap);break;default:svGlobal.logger.warn("Invalid worker msg "+a.type)}}function cc(a){sa&&sa.check(a)}function Ib(){ia=
!0;var a="87"+navigator.userAgent+"\t";ob=hi5.tool.uuid();document.cookie=ob+"=sv";V(a+ob);if(l.onopen)l.onopen();K.joinCloseMode&&l.setJoinCloseMode(K.joinCloseMode)}function $b(){I&&I.close()}function Yb(a){var b=a.data;if("string"!=typeof b){a=new Uint8Array(b);Aa.attach(a,0,b.byteLength);var c=Aa.getLittleEndian16();switch(c){case 28:a=Aa;b=a.getAscllString(8);c=Va[b];null!=c?c.process(a):svGlobal.logger.warn("Channel "+b+" not found");break;case 55:a=Aa;switch(a.getByte()){case 0:X=a.getLittleEndian16();
ra=a.getLittleEndian16();Oa=a.getLittleEndian32();a.skipPosition(6);Wa=a.getLittleEndian16();svGlobal.logger.info("Audio Format, tag="+X+" channels="+ra+" bitsPerSample="+Wa+" samplePerSec="+Oa);dc();break;case 1:Cc(a)}sa&&sa.check();break;case 56:ec(Aa.getUnicodeString(Aa.getEnd()-Aa.getPosition(),!1));break;case 60:fc(Aa);break;case 62:gc(Aa.getUnicodeString(Aa.getEnd()-Aa.getPosition(),!1));break;case 63:hc(Aa);sa&&sa.check();break;case 64:b=Aa;c=b.getByte();a=b.getLittleEndian32();switch(c){case 1:b=
b.getAscllString();if(ca[b]&&(svGlobal.logger.info("DVC create, name:"+b+" id:"+a),ca[b].newInstance?(ca[a]=ca[b].newInstance(),ca[a].id=a):(ca[b].id=a,ca[a]=ca[b]),ca[a].onopen))ca[a].onopen();break;case 3:ca[a]&&ca[a].process(b);break;case 4:if(ca[a]&&ca[a].onclose)ca[a].onclose();svGlobal.logger.info("close DVC, id:"+a)}sa&&sa.check();break;case 146:a:switch(a=Aa,b=a.getByte(),b){case 0:a=new Uint8Array(2);a[0]=146;a[1]=1;V(a.buffer);break;case 1:break;case 5:b=a.getByte();a=a.getLittleEndian32();
0!=b||a&4||(La^=65536,I.execute("setFeature",[La]));break;case 6:ta.remoteLockFlags=a.getLittleEndian32();ta.checkLockFlags=!0;if(l.onLockKeyState)l.onLockKeyState({capsLock:0!=(ta.remoteLockFlags&4),numLock:0!=(ta.remoteLockFlags&2),scrollLock:0!=(ta.remoteLockFlags&1)},{capsLock:0!=(ta.localLockFlags&4),numLock:0!=(ta.localLockFlags&2),scrollLock:0!=(ta.localLockFlags&1)});svGlobal.logger.info("remoteLockFlags: "+ta.remoteLockFlags);break;case 7:b=a.getByte();l.sessionInfo.appInfo.twoFAEnabled=
0<b;switch(b){case 0:b=a.getByte();c=a.getLittleEndian32();a=a.getBytes(c);l.sessionInfo.appInfo.twoFAQR=a;l.ontwofaqr&&l.ontwofaqr(a)||2==b&&I.execute("showTwoFAQR");break;case 1:Q.pause(!0,!0);if(l.ontwofacode&&l.ontwofacode())break a;(a=I.getFocused())&&a.showTwoFACode();break;case 2:if(b=a.getByte(),a=1==a.getByte(),(!l.ontwofaresult||!l.ontwofaresult(b,a))&&ta.onauthcoderesult)ta.onauthcoderesult(b,a)}break;default:svGlobal.logger.warn("Invalid Client Control: "+b)}break;default:if(l.onunknownmessage)l.onunknownmessage(c,
Aa);else svGlobal.logger.warn("@TODO:"+c+"\n")}}else switch(c=parseInt(b.substring(0,2),16),a=b.substring(2),c){case 0:V("87"+navigator.userAgent);break;case 15:if(l){Nb=!1;cb=l.reconnectTimes;(l&&0==l.mode||ba(C.connectif))&&Mb();b="";for(b in Ua)if((c=Ua[b])&&c.onopen)c.onopen();for(b in Va)if((c=Va[b])&&c.onopen)c.onopen();a&&(a=JSON.parse(a),a.capability&&l&&(l.sessionInfo.suppressOutput=!!a.capability.suppressOutput))}break;case 26:b=JSON.parse(a);if(b.name){isNaN(b.name)||(b.name="S"+b.name);
b.message||(b.message=b.msg);if(l.onnotify)l.onnotify(b);svGlobal.logger.info("msg="+a);if(2==b.type&&l.onerror)l.onerror(b);if(a=__svi18n.errorCode[b.name])b.msg=a+" "+b.msg;l.showMessage(b)}else 0<svGlobal.log&&console.erro("No error code for message:"+a);break;case 27:I.drawLicense(a);break;case 50:if(ia)switch(b=parseInt(a.substring(0,1),10),a=a.substring(1),b){case 1:Dc(a);break;case 2:kb?(kb.type==a?l.writeRawInput("881"+a+"\t"+kb.text):l.writeRawInput("881ERROR\t"),kb=null):!(b=I.getFocused())||
b.processClipReq(a)||!K.clipWarnAlways&&ic||!C||C.leagacyMode||(l.showMessage(__svi18n.info.menucopy,null,5E3),ic=!0);break;case 5:(b=I.getFocused())&&"0"!=a&&b.setIgnorePaste(!0)}break;case 51:I.setReadOnly("1"==a);break;case 54:b=a.split("\t");a=Za()+b[0];a=l.modifyURL(a);svGlobal.logger.info("Downloading file:"+a+" name:"+b[1]+" driver:"+b[2]);l.onprintingready&&l.onprintingready({link:a,printerName:b[1],pinterDriver:b[2]})||(b=I.getFocused())&&b.showPDF(a);break;case 55:b=parseInt(a.substring(0,
1),16);a=a.substring(1);switch(b){case 0:a=a.split("\t");X=parseInt(a[0],10);ra=parseInt(a[1],10);Wa=parseInt(a[2],10);Oa=parseInt(a[3],10);svGlobal.logger.debug("Audio Format, tag="+X+" channels="+ra+" bitsPerSample="+Wa+" samplePerSec="+Oa);dc();break;case 1:Ec(a)}break;case 56:ec(a);break;case 57:b=a.split("\t");svGlobal.logger.debug(a);if(a=I.getWinById(parseInt(b[0]))){if(!I.hasApp(b[1])){(c=I.getOwnerSurface(a))&&c.railWin&&(c.railWin.appId=b[1],c.railWin.addApp(b[1]));if(l.onremoteappstart)l.onremoteappstart({id:b[1]});
if(a.isVisible()&&a.titleInfo&&l.ontitlechange)l.ontitlechange(c.railWin.getFullTitle(a.id),b[1])}a.appId=b[1]}break;case 58:Fc(a);break;case 59:a=hi5.Base64.dec(a,0);La=(new RdpBuffer(a,0,a.length)).getLittleEndian32();Pa||!(La&16||La&65536)?(pb=!1,oa=null):(La&16&&(pb=!0),oa||(a=I.getFocused())&&Gb(a));La&64&&l.showMessage(__svi18n.info.recording);oa&&(oa.setUpload(!(La&128)),oa.setDownload(!(La&131072)),oa.canCopyFile=0!=(La&65536));I.execute("setFeature",[La]);break;case 60:fc(b64ToBuffer(a));
break;case 61:a=JSON.parse(a);switch(a.type){case 0:$a(a.width,a.height,!0,!1);gb(a.color);(b=a.server)&&l&&(l.server=a.server);jc=a.length;c=I.getFocused();Fa=1==a.isRail;c&&(c.setAutoScale(!Fa),b&&xb(fb(),c.getWindow()),b=a.keyboard,"undefined"!=typeof b&&0==b&&c.setUnicode(!0),b=a.mapDisk)&&(pb=!0,Gb(c));if(l.onopened)l.onopened(a);break;case 1:a=a.duration;if(l.onprogress)l.onprogress(a,jc);break;case 2:2==a.status?(Fb(),ia=!0):(b=0==a.status,b==Q.isPaused()||l.onsessionpause&&l.onsessionpause(b,
a)||(Q.pause(b),b||I.repaint(0,0,Q.width-1,Q.height-1),a.warn&&l.showMessage(b?__svi18n.info.sessionPaused:__svi18n.info.sessionResumed)))}break;case 62:gc(a);break;case 63:hc(b64ToBuffer(a));break;default:if(l.onunknownmessage)l.onunknownmessage(c,a);else svGlobal.logger.warn("@TODO:"+b+"\n")}}function Mb(){if(!Pa&&!Ga&&(Ga=!0,l&&(K.pingInterval&&l.startPing(K.pingInterval),l.onready)))l.onready()}function Gc(a,b){var c=0,k=!1;this.width=a;this.interval=b;var d=0;this.start=function(){k||(k=!0,c=
setInterval(function(){var n=I.getFocused();n&&ia&&(n=n.getThumbnail(a))&&n.length!=d&&(V("8E7"+n),d=n.length)},b))};this.stop=function(){clearInterval(c)}}function Hc(a,b){!Ia||Ia.width==a&&Ia.interval==b||(Ia.stop(),Ia=null);Ia||(Ia=new Gc(a,b));Ia.start()}function hc(a){var b=a.getAscllString(8);(b=Ua[b])&&b.process&&b.process(a)}function gc(a){var b=parseInt(a.substring(0,1),16),c=a.substring(1);a=!1;var k=l.sessionInfo.appInfo;switch(b){case 0:var d=JSON.parse(c);Fb();ia=!0;a=d.width;k=d.height;
if(a==ka&&k==la)break;$a(a,k,!1,!1);break;case 1:d=JSON.parse(c);l.sessionInfo.joinedSessions.push(d.numericId);l.sessionInfo.joiners.push(d);k.sessions[d.numericId]=d.name||d.__ip;if(!k.joined||K.alertJoin)l.onsessionjoin&&(a=l.onsessionjoin(d)),!a&&__svi18n.info.joinsession&&l.showMessage(__svi18n.info.joinsession.applyArgs([d.numericId,d.__ip,d.name]));break;case 2:d=JSON.parse(c);l.sessionInfo.joinedSessions.removeElm(d.numericId);delete k.sessions[d.numericId];b=l.sessionInfo.joiners;c=0;for(var n=
b.length;c<n;c++)if(b[c].numericId==d.numericId){b.splice(c,1);break}if(!k.joined||K.alertJoin)l.onsessionexit&&(a=l.onsessionexit(d)),!a&&__svi18n.info.exitsession&&l.showMessage(__svi18n.info.exitsession.applyArgs([d.numericId,d.__ip,d.name]));break;case 3:d=JSON.parse(c);k.joinMode!=d.mode&&(k.joinMode=d.mode,b=hi5.$("joinSelect"))&&(b.value=d.mode);if(k.hasControl)break;k.hasControl=!0;I.setReadOnly(!1,2==d.mode);if(k=hi5.$("requestControl"))k.disabled=!0;l.ongivecontrol&&(a=l.ongivecontrol());
if(a)break;l.showMessage(__svi18n.info.givecontrol,null,5E3);break;case 4:d=JSON.parse(c);I.setReadOnly(!0,2==d.mode);k.hasControl=!1;if(k=hi5.$("requestControl"))k.disabled=!1;l.ontakebackcontrol&&(a=l.ontakebackcontrol());if(a)break;l.showMessage(__svi18n.info.nocontrol,null,5E3);break;case 5:d=JSON.parse(c);l.onrequirecontrol&&(a=l.onrequirecontrol(d));if(a)break;a=__svi18n.info.title.applyArgs([d.name,d.numericId,d.__ip]);k=__svi18n.info.recontrol;Q.isPaused&&(k+="<br><br>"+(__svi18n.info.autoresume||
""));l.showMessage({title:a,msg:k,cbYes:function(){l.giveControl(d.numericId);this.destroy();Q.isPaused()&&l.pauseSession(l.sessionInfo.appInfo.numericId,!1)},cbNo:function(){l.refuseControl(d.numericId);this.destroy()}});break;case 6:I.execute("setTouchRemoting",[!0]);break;case 7:d=JSON.parse(c);d.width&&d.height&&$a(d.width,d.height,!0,C.monitorDef&&0<=C.monitor?!0:!1);d.color&&(gb(d.color,!0),svGlobal.logger.warn("Color depth changed to:"+d.color));d.version&&(l.sessionInfo.protocolVersion=d.version);
break;case 8:d=JSON.parse(c);Nb=!0;if(l.onrequestcredential&&l.onrequestcredential(d,ta.reconnect))break;if(l.onautherror&&l.onautherror(d,ta.reconnect))break;I.getFocused().requestCredential(d,ta.reconnect);break;case 9:d=JSON.parse(c);0<d.interval&&0<d.width?Hc(d.width,d.interval):Ia&&(Ia.stop(),Ia=null);break;case 11:d=JSON.parse(c);l.onrequirejoin&&(a=l.onrequirejoin(d));if(a)break;a=__svi18n.info.title.applyArgs([d.name,d.numericId,d.__ip]);l.showMessage({title:a,msg:__svi18n.info.reqjoin,cbYes:function(){l.allowJoin(d.numericId,
!0);this.destroy()},cbNo:function(){l.allowJoin(d.numericId,!1);this.destroy()}});break;case 13:d=JSON.parse(c);"login"==d.type&&Kb();break;case 14:if(d=JSON.parse(c),l.oncontrolchange)l.oncontrolchange(d)}}function fc(a){switch(a.getByte()){case 32:if(!Q.isPaused()){var b=a.getLittleEndian16(),c=a.getLittleEndian16(),k=a.getLittleEndian16(),d=void 0,n=void 0;K.noCursorName||(d=a.getLittleEndian32(),l.sessionInfo.appInfo&&(n=l.sessionInfo.appInfo.sessions[d]));Lb(c,k,!0,n,d,b)}}}function Lb(a,b,c,
k,d,n){Q.isPaused()||I.getFocused().moveCursor(a,b,c,k,d,n)}function bc(a){I.setCursor(a)}function Ic(a){var b=K.page&&K.page.join||"";if(b.startsWith("http://")||b.startsWith("https://"))return b;if(b.startsWith("/"))return location.origin+b;var c=location.href,k=c.lastIndexOf("/");if(b)return c.substring(0,k+1)+b;b=Za();c.toLowerCase().startsWith(b.toLowerCase())&&(b=c.substring(0,k));return b+"/"+a}function ec(a){a=JSON.parse(a);Ob=a.session;var b=a.numericId;sessionStorage&&(sessionStorage.setItem("appInfo.session",
Ob),sessionStorage.setItem("appInfo.numericId",b));wb(a.appId);a.server||(a.server=fb());if(b=hi5.$("joinSelect"))b.value=a.joinMode;if(b=hi5.$("requestControl"))b.disabled=a.hasControl;a.joined?I.execute("setAutoScale",[!0]):(l.mode=0,ba(C.connectif)&&I.setSize(ka,la),K.disableJoinedAppResize&&(l.windowState=0));var c=Za();b=Ic("join.html")+"?id="+(a.joined||a.numericId);var k=a.webAddress;k&&0<k.length&&k.toLowerCase()!=c.toLowerCase()&&(c=k.indexOf("://"),l.protocol="http"==k.substring(0,c)?"ws":
"wss",l.gateway=k,b+="&gateway="+encodeURIComponent(k));b=l.modifyURL(b);a.joinLink=b;l.sessionInfo.appInfo=a;"isApp"in a&&Fa!==a.isApp&&(Fa=a.isApp,$a(ka,la,!0,!0),ab||I.execute("setAutoScale",[!0]));a.ver&&a.ver!=svGlobal.version&&svGlobal.logger.warn("Client:"+svGlobal.version+" server:"+a.ver);K.cursorNameOnly=a.isAssistance;if(l.onsessionstart)l.onsessionstart(l.sessionInfo)}function Fc(a){if(oa){var b=parseInt(a.charAt(0),10);a=a.substring(1);if(5==b)oa.notifyFiles(JSON.parse(a));else{var c=
a.split("\t");switch(b){case 1:oa.confirmId(c[0],c[1],c[2]);break;case 2:oa.read(c[0],parseInt(c[1],10),parseInt(c[2],10));break;case 4:oa.close(c[0]);break;case 9:a='<a href="'+l.modifyURL(Za()+c[0])+'" download="'+c[1]+'" target="_blank">'+__svi18n.info.fileReady+": "+c[1]+"</a>",__svi18n.info.download&&I.getFocused().showMessage({msg:a,title:__svi18n.info.download,cbNo:function(){oa.removeFile(c[0],!0);this.destroy()},onclick:function(k){"A"==k.target.tagName&&this.destroy()}})}}}}function Ec(a){function b(J){var G=
0;J*=n;for(e=0;e<n;e++)G|=(d[J+e]&255)<<8*e;G>z?(G-=H,G/=-E):G/=z;return G}if(pa.available&&!Q.isPaused()){var c=a.indexOf("\t"),k=a.substring(0,c),d=hi5.Base64.dec(a,c+1);1!=X&&(db||(db=new MSGSM),d=db.decode(d,0,d.length));a=Wa;var n=a>>3,e=0,z=Math.pow(2,a-1)-1,E=-z-1,H=Math.pow(2,a);a=0;c=ra;var O=Math.floor(Math.floor(d.length/n)/c),y=pa.getBuffer(O),u=y.getChannelData(0),p=y.getChannelData(1);for(a=0;a<O;){var A=2*a,r=b(A);1==c?(u[a]=r,p[a]=r):(u[a]=r,p[a]=b(A+1));a++}a=pa.playBuffer(y);setTimeout(function(J){return function(){V("8A"+
J)}}(k),1E3*(a-pa.delay))}}function Cc(a){function b(n){return function(){V("8A"+n)}}var c=a.getByte(),k=a.getLittleEndian16(),d=Date.now();a.skipPosition(8);a=Pb(a,c,k,0);a=1E3*(a-pa.delay);Pa||(k+=Date.now()-d+a,setTimeout(b(c+","+k),a))}function Pb(a,b,c,k){if(!ac||Q.isPaused())return 0;var d=c=0,n=a.getPosition();b=a.getData();k||(k=a.getEnd()-n);var e=k;if(41222==X)return(c=pa.getContext())&&c.decodeAudioData(b.buffer.slice(n),function(u){u=pa.playBuffer(u);Pa||setTimeout(sendLater(Eb),1E3*(u-
pa.delay))},function(u){svGlobal.logger.warn(u)}),0;if(d=1!=X)db||(db=new MSGSM),b=db.decode(b,n,e),n=0,e=b.length;var z=Wa,E=z>>3,H=Math.floor(e/E),O=a=0,y=0;d||(a=Math.pow(2,z-1)-1,O=-a-1,y=Math.pow(2,z));z=ra;if(jb){n="";if(d){for(;c<e;c++)0<c&&(n+=","),n+=b[c]+","+b[c]+","+b[c]+","+b[c];jb.write(n);return k/65*.025}for(;c<e;)0<c&&(n+=","),d=b[c++]|b[c++]<<8,9>d?d=0:d>a?(d-=y,d/=-O):d/=a,n+=d,1==z&&(n+=","+d);jb.write(n);return k/E/Oa*.6}k=n;n=Math.floor(H/z);e=pa.getBuffer(n);E=e.getChannelData(0);
H=e.getChannelData(1);c=0;if(d)for(;c<n;)1==z?H[c]=E[c]=b[k++]:(E[c]=b[k++],H[c]=b[k++]),c++;else for(;c<n;)d=b[k++]|b[k++]<<8,d>a?(d-=y,d/=-O):d/=a,1==z?E[c]=d:(E[c]=d,d=b[k++]|b[k++]<<8,d>a?(d-=y,d/=-O):d/=a),H[c]=d,c++;return pa.playBuffer(e)}function dc(){na&&na.postMessage({type:0,cmd:5,data:{tag:X,channels:ra,samplePerSec:Oa,bitsPerSample:Wa}})}function kc(a){if(!l.openLink||2E3<a.length)return!1;var b=a.indexOf(";");0<b&&(a=a.substring(b+1));b=a;a=a.toLowerCase();var c=0==a.indexOf("http://")||
0==a.indexOf("https://")||0==a.indexOf("ftp://")||0==a.indexOf("mailto:")||0==a.indexOf("tel:")||0==a.indexOf("callto:");c||(0==a.indexOf("www.")?(c=!0,a="http://"+a):0==a.indexOf("ftp.")&&(c=!0,a="ftp://"+a));return c?0<a.indexOf("\r")||0<a.indexOf("\n")?!1:l.onurlredirection&&l.onurlredirection(b)?!0:(a=I.getFocused())?a.processLink(b):!1:!1}function Jc(a){if(a.startsWith("text/html;<img data-sv-img")){var b=a.indexOf('src="');if(0<b){b+=5;var c=a.indexOf('"',b),k=a.substring(b,c);k=l.modifyURL(k);
a=a.substring(0,b)+k+a.substring(c)}}return a}function Dc(a){if("text/plain;"!=a){if(1666<Date.now()-ta.reqCopyTime&&!(l.onservercopy&&l.onservercopy(a)||kc(a))){var b=I.getFocused();b&&b.copyToClip(Jc(a))}setTimeout(function(){V("883")},999)}}function Kb(){if(!ab&&(setTimeout(function(){ia&&V("884")},333),l.onloggedin))l.onloggedin();Qb=ab=!0;Fa&&I.execute("setAutoScale",[!1]);oa&&(oa.enabled=!0);qb&&!Fa&&(Q.setContext(I.getFocused().context),I.repaint(0,0,Q.width-1,Q.height-1))}function hb(a){if(l){hi5.browser.cookie.delete(ob);
svGlobal.logger.warn("closed "+(l.sessionInfo.appInfo?l.sessionInfo.appInfo.numericId:0));l.onagentmessage&&(l.onagentmessage=null);if(l.onagentclose)l.onagentclose();var b=Wb();b&&l.sessionInfo.appInfo&&0==l.mode&&(sessionStorage[b]=l.sessionInfo.appInfo.session);if(l&&(b=0==l.mode,!ia&&b&&mb("connection"),b=b&&(ia||cb<l.reconnectTimes)&&0<cb&&!a,Ga=ia=!1,b)){cb--;__svi18n.info.reconnecting&&l.showMessage(__svi18n.info.reconnecting+" "+(l.reconnectTimes-cb)+"/"+l.reconnectTimes,null,3E3);setTimeout(Hb,
5);svGlobal.logger.info("Reconnecting..."+cb);return}if(Nb)svGlobal.logger.info("Req credential");else{sa&&(l.stopPing(),sa=null);na&&(na.removeEventListener("message",Xb,!1),na.postMessage({type:0,cmd:4}),na.terminate(),na=null);oa&&(oa.release(),oa=null);ua=D=null;ca&&(ca.close(),ca=null);Ua&&hi5.Arrays.release(Ua);Va&&hi5.Arrays.release(Va);Ia&&(Ia.stop(),Ia=null);pa&&(pa.close(),pa=null);lb=null;try{if(l.onclose)l.onclose(a);else svGlobal.logger.info("onclose: null");I&&(I.close(),I=null)}catch(c){svGlobal.logger.warn(c)}Aa=
null;aa&&(aa.onopen=null,aa.onmessage=null,aa.onclose=null,aa.onerror=null,aa.close(),aa=null);I=ta=null;Q&&(Q.release(),Q=null);hi5.browser.isChromeApp?chrome.runtime.onSuspend.removeListener(l.close):window.removeEventListener("unload",l.close,!1);window&&window.$rdp==l&&(window.$rdp=null);l=null}}}function lc(){aa&&ia?aa.close():hb(!0)}function Zb(a,b){var c=a.getLittleEndian32();if(0!=(c&16777216))if(b=a.getLittleEndian32(),0!=(c&1073741824)){a.getLittleEndian16();a.getByte();c=a.getByte();var k=
a.getLittleEndian16(),d=a.getLittleEndian16(),n=0;16>c&&(n=a.getLittleEndian16());var e=a.getLittleEndian16(),z=a.getLittleEndian16();a.getBytes(e);n&&a.getBytes(n);if(8<=c&&(n=I.getFocused())&&n.onremoteappicon){e=new hi5.graphic.Bitmap(k,d,32);a.getPosition();k=new Uint8Array(k*d*4);d=a.getPosition();z=d+z;var E;a=a.getData();for(var H=0,O,y;d<z;)switch(c){case 16:(E=a[d++]|a[d++]<<8)?(y=E>>7&248,O=E>>2&248,E=E<<3&248,y|=y>>5,O|=O>>5,E|=E>>5,k[H++]=E,k[H++]=O,k[H++]=y,k[H++]=255):H+=4;break;case 32:k[H++]=
a[d++],k[H++]=a[d++],k[H++]=a[d++],k[H++]=a[d++]}e.putPixels(k,0,k.length);a=I.getWinById(b);n.onremoteappicon(a,e)}}else 0!=(c&2147483648)?svGlobal.logger.info("XXX rail cache icon, winId="+b):0!=(c&536870912)?(svGlobal.logger.info("***** delete winId="+b),I.delWin(b)):Kc(a,c,b);else if(0!=(c&33554432))svGlobal.logger.info("XXX Alt Sec window Notify="+c);else if(0!=(c&67108864))if(svGlobal.logger.info("*** -- Alt Sec window Desktop, flags:"+c),0!=(c&1))svGlobal.logger.info("Desktop non monitored flags="+
c);else{if(0!=(c&32)&&(b=a.getLittleEndian32(),svGlobal.logger.info("Desktop monitored flags="+c+" winId="+b),(n=I.getOwnerSurfaceById(b))&&n.railWin&&n.railWin.setActiveWinId(b),I.setTitle(b),Q.getContext()||(b=I.getFocused())&&Q.setContext(b.context),0!=(c&16)&&(b=a.getByte(),0<b)))for(c=I.zOrders,c.length=b,n=0;n<b;n++)c[n]=a.getLittleEndian32(),svGlobal.logger.info("---zorders:"+c[n])}else svGlobal.logger.info("XXX Alt Sec window order flgas="+c)}function mc(a){var b=I.getFocused();if(b&&b.railWin){var c=
a||b.railWin.mainWin;if(c&&2<c.showState&&l.windowState){var k=b.getFreeSpace();a=Math.max(Math.abs(c.winHeight-k.height),Math.abs(c.winWidth-k.width));svGlobal.logger.info("--- fitMainWin offset:"+a+" _hOffset:"+c._hOffset+" appId:"+c.appId+" spaceH:"+k.height);0<a?(b=a==c._hOffset,c._hOffset&&b||(c._hOffset=a,setTimeout(function(){c.resize(0,0,k.width,k.height)},333))):c._hOffset=0}}}function Kc(a,b,c){Fa||(Fa=!0);var k=0==(b&268435456),d=I.getWinById(c);d?k=!0:d=new I.LocalWin(c);svGlobal.logger.info("\n\n=========== winId="+
c+" existed="+k);if(d){0!=(b&2)&&(d.ownerWinid=a.getLittleEndian32(),svGlobal.logger.info("***** ownerWinid="+d.ownerWinid));0!=(b&8)&&(d.style=a.getLittleEndian32(),d.extStyle=a.getLittleEndian32(),svGlobal.logger.info("***** winId="+c+" style="+d.style+" extStyle="+d.extStyle),svGlobal.logger.info("*****--- WS_POPUP="+(0!=(d.style&2147483648))),svGlobal.logger.info("*****--- WS_DLGFRAME="+(0!=(d.style&4194304))),svGlobal.logger.info("*****--- DS_MODALFRAME="+(0!=(d.style&128))),svGlobal.logger.info("*****--- WS_EX_DLGMODALFRAME="+
(0!=(d.extStyle&1))),svGlobal.logger.info("*****--- WS_EX_TOOLWINDOW="+(0!=(d.extStyle&128))),svGlobal.logger.info("*****--- WS_BORDER="+(0!=(d.style&8388608))),svGlobal.logger.info("*****--- WS_CAPTION="+(0!=(d.style&12582912))),svGlobal.logger.info("*****--- WS_OVERLAPPED="+(0!=(d.style&0))),svGlobal.logger.info("*****--- WS_OVERLAPPEDWINDOW="+(0!=(d.style&13565952))),svGlobal.logger.info("*****--- WS_POPUPWINDOW="+(0!=(d.style&2156396544))),svGlobal.logger.info("*****--- WS_SIZEBOX="+(0!=(d.style&
262144))),svGlobal.logger.info("*****--- WS_CHILD="+(0!=(d.style&1073741824))),svGlobal.logger.info("*****--- WS_SIZEBOX="+(0!=(d.style&262144))),svGlobal.logger.info("*****--- WS_EX_MDICHILD="+(0!=(d.extStyle&64))),svGlobal.logger.info("*****--- WS_EX_LAYERED="+(0!=(d.extStyle&524288))));0!=(b&16)&&(d.setShowState(a.getByte()),svGlobal.logger.info("***** winId="+c+" showState="+d.showState),2==d.showState&&0!=K.noMinimize&&setTimeout(function(){d.exeCommand(61728)},50));var n=0!=(b&4);if(n){var e=
a.getLittleEndian16();d.titleInfo=a.getUnicodeString(e,!1);svGlobal.logger.info("***** winId="+c+" title="+d.titleInfo)}0!=(b&16384)&&(d.clientOffsetX=a.getLittleEndian32(),d.clientOffsetY=a.getLittleEndian32(),svGlobal.logger.info("***** winId="+c+" coffX"+d.clientOffsetX+" coffY="+d.clientOffsetY));0!=(b&65536)&&(d.clientAreaWidth=a.getLittleEndian32(),d.clientAreaHeight=a.getLittleEndian32(),svGlobal.logger.info("***** winId="+c+" cw"+d.clientAreaWidth+" ch="+d.clientAreaHeight));0!=(b&131072)&&
(d.rpContent=a.getLittleEndian32());0!=(b&262144)&&(d.rootParentHandle=a.getLittleEndian32());if(0!=(b&2048)){e=a.getLittleEndian32();var z=a.getLittleEndian32();d.winOffsetX=e;d.winOffsetY=z;svGlobal.logger.info("***** winId="+c+" offX"+d.winOffsetX+" offY="+d.winOffsetY)}0!=(b&32768)&&(d.winClientDeltaX=a.getLittleEndian32(),d.winClientDeltaY=a.getLittleEndian32(),svGlobal.logger.info("***** winId="+c+" dX"+d.winClientDeltaX+" dY="+d.winClientDeltaY));0!=(b&1024)&&(d.winWidth=a.getLittleEndian32(),
d.winHeight=a.getLittleEndian32(),svGlobal.logger.info("***** winId="+c+" w"+d.winWidth+" h="+d.winHeight));if(!k)if(d.isMainWin()||3==d.showState)mc(d);else if(2<d.showState&&(e=I.getFocused())){e=e.getFreeSpace();var E=d.winWidth,H=d.winHeight;if(d.winOffsetX>e.width||d.winOffsetY>e.height||0>E+d.winOffsetX||0>H+d.winOffsetY){var O=(e.width-d.winWidth)/2|0,y=(e.height-d.winHeight)/2|0;0>O&&(O=0);0>y&&(y=0);setTimeout(function(){d.resize(O,y,E,H)},50)}}0!=(b&256)&&(e=a.getLittleEndian16(),0<e&&a.skipPosition(8*
e));0!=(b&4096)&&(d.visibleOffsetX=a.getLittleEndian32(),d.visibleOffsetY=a.getLittleEndian32());0!=(b&512)&&(b=a.getLittleEndian16(),d.numVisibilityRects=b,0<b&&a.skipPosition(8*b));if(k)I.onWinChange(d);else I.addWin(d);n&&I.setTitle(c)}else svGlobal.logger.warn("XXX, No win with id:"+c)}function Tb(a,b){function c(g,h,f,m,q){0<q.width?q.union(g,h,f,m):(q.x=g,q.y=h,q.width=f,q.height=m)}function k(g,h,f,m){for(va=0;va<Ba;va++){var q=Z[va];if(g>=q[0]&&h>=q[1]&&f<=q[2]&&m<=q[3])return Ca[va]}return null}
function d(g,h,f,m){if(Ba){var q=k(g,h,g+f-1,h+m-1);q&&c(g,h,f,m,q)}else c(g,h,f,m,r)}function n(g,h,f,m,q,t,w){for(var v=q*f+m,x=g.setRGB,F=g.getRGB,B=0;B<w;B++){for(var L=0;L<t;L++){if(g){var fa=F(m+L,q+B);x(m+L,q+B,~fa&16777215)}else h[v]=~h[v]&16777215;v++}v+=f-t}}function e(g,h,f,m,q,t,w,v,x,F){h=F*v+x;null==w&&(w=g);for(g=0;g<t;g++){for(x=0;x<q;x++)p[m+g][f+x]=p[m+g][f+x]&w[h]&16777215|4278190080,h++;h+=v-q}}function z(g,h,f,m,q,t,w,v,x,F){h=F*v+x;x=g.setRGB;F=g.getRGB;null==w&&(w=g);for(g=
0;g<t;g++){for(var B=0;B<q;B++){var L=F(f+B,m+g);x(f+B,m+g,L|w[h]&16777215);h++}h+=v-q}}function E(g,h,f,m){var q=xa;if(q){var t=q.getRGB(h,f);switch(g){case 0:q.setRGB(h,f,0);break;case 1:q.setRGB(h,f,~(t|m)&16777215);break;case 2:q.setRGB(h,f,t&~m&16777215);break;case 3:q.setRGB(h,f,~m&16777215);break;case 4:q.setRGB(h,f,16777215*(~t&m));break;case 5:q.setRGB(h,f,~t&16777215);break;case 6:q.setRGB(h,f,t^m&16777215);break;case 7:q.setRGB(h,f,~t&m&16777215);break;case 8:q.setRGB(h,f,t&m&16777215);
break;case 9:q.setRGB(h,f,t^~m&16777215);break;case 10:break;case 11:q.setRGB(h,f,t|~m&16777215);break;case 12:q.setRGB(h,f,m);break;case 13:q.setRGB(h,f,(~t|m)&16777215);break;case 14:q.setRGB(h,f,t|m&16777215);break;case 15:q.setRGB(h,f,16777215);break;default:svGlobal.logger.warn("unsupported pixel opcode: "+g),q.setRGB(h,f,m)}}}function H(g,h,f,m,q,t,w,v,x){g>v||h>x||(f=g+f-1,f>v&&(f=v),g<t&&(g=t),f=f-g+1,m=h+m-1,m>x&&(m=x),h<w&&(h=w),m=m-h+1,1>f||1>m||xa.fillRect(g,h,f,m,q))}function O(g,h,f,
m,q,t,w,v,x,F,B,L){if(!(h>B||f>L)){var fa=h+m-1;fa>B&&(fa=B);x=h<x?x:h;fa=fa-h+1;B=f+q-1;B>L&&(B=L);F=f<F?F:f;L=B-f+1;if(!(1>fa||1>L)){B=128;var W=0;w|=4278190080;v|=4278190080;if(x==h&&F==f&&fa==m&&L==q)if(0==g)for(var U=0;U<q;U++){g=f+U;for(var ea=0;ea<m;ea++)0==B&&(W++,B=128),0!=(t[W]&B)&&(p[g][h+ea]=v),B>>=1;W++;B=128;W==t.length&&(W=0)}else for(U=0;U<q;U++){g=f+U;for(ea=0;ea<m;ea++)0==B&&(W++,B=128),p[g][h+ea]=0!=(t[W]&B)?v:w,B>>=1;W++;B=128;W==t.length&&(W=0)}else if(0==g)for(U=0;U<L;U++){g=
f+U;for(ea=0;ea<fa;ea++)0==B&&(W++,B=128),h+ea>=x&&g>=F&&0!=(t[W]&B)&&(p[g][h+ea]=v),B>>=1;W++;B=128;W==t.length&&(W=0)}else for(U=0;U<L;U++){g=f+U;for(ea=0;ea<fa;ea++)0==B&&(W++,B=128),h+ea>=x&&f+U>=F&&(p[g][h+ea]=0!=(t[W]&B)?v:w),B>>=1;W++;B=128;W==t.length&&(W=0)}}}}function y(g,h,f,m,q){this.offset=g;this.baseLine=h;this.width=f;this.height=m;this.fontData=q}function u(g,h,f,m,q,t,w,v,x){this.cache_idx=g;this.rawData=h;this.none=!h;this.hotX=f;this.hotY=m;this.width=q;this.height=t;this.xorSize=
v;this.andSize=x;this.result="";this.distance=0;this.bpp=w;this.system="";if(h){if(!this.distance){g=0;if(h){w=0;for(var F=h.length;w<F;w++)0!=h[w]&&(g+=w%q+(w/q|0))}this.distance=g}if(!this.system){a:switch(this.distance){case 507:g="text";break a;case 2046:case 4359:g="default";break a;default:g=""}this.system=g}}g="";if(!this.system&&h){w=q*t*4;g=62+w+v+x;F=new Uint8Array(g);g=new hi5.DataBuffer(F,0,g);g.setLittleEndian16(0);g.setLittleEndian16(2);g.setLittleEndian16(1);g.setByte(q);g.setByte(t);
g.setByte(0);g.setByte(0);g.setLittleEndian16(f);g.setLittleEndian16(m);g.setLittleEndian32(40+w+v+x);g.setLittleEndian32(22);g.setLittleEndian32(40);g.setLittleEndian32(q);g.setLittleEndian32(2*t);g.setLittleEndian16(1);g.setLittleEndian16(32);g.setLittleEndian32(0);g.setLittleEndian32(v+x);g.setLittleEndian32(0);g.setLittleEndian32(0);g.setLittleEndian32(0);g.setLittleEndian32(0);for(f=t-1;0<=f;f--)for(m=0;m<q;m++)t=h[q*f+m],g.setByte(t&255),g.setByte(t>>8&255),g.setByte(t>>16&255),g.setByte(t>>
24&255);g="data:image/x-icon;base64,"+hi5.Base64.enc(g.getData())}this.url=g}var p=[],A=null,r=new hi5.graphic.Rectangle(0,0,0,0),J="Uint8ClampedArray"in window,G=null,N=0,P=0,da=0,ha=0,S=null,Z,Ca,va=0,Ba=0;this.width=a;this.height=b;var Qa=!1,xa=this,ya={imgData:null,left:0,top:0,width:0,height:0};this.setProfiler=function(g){G=g};this.getDirtyArea=function(){return r};this.setImgRect=function(g,h,f,m){N=g;P=h;da=f;ha=m};this.parseMonitorDef=function(g){var h=g.split(","),f=h.length,m=[];if(1<f){for(var q=
!1,t=0;t<f;t++){var w=h[t].split(":");if(4==w.length)m[t]=Array(5),m[t][0]=parseInt(w[0]),m[t][1]=parseInt(w[1]),m[t][2]=parseInt(w[2]),m[t][3]=parseInt(w[3]),m[t][4]=0==m[t][0]&&0==m[t][1]?1:0;else{q=!0;break}}q&&(svGlobal.logger.warn("invaiid monitorDef:"+g),m.length=0)}return m};this.setMonitorLayout=function(g){var h=g.length,f=0;Z=g;for(Ca=Array(h);f<h;f++)Ca[f]=new hi5.graphic.Rectangle(0,0,0,0);Ba=h};this.setMonitorCount=function(g){Ba=g};this.addImg=function(g){da&&(S&&URL.revokeObjectURL(S.src),
S=g)};this.flushImgs=function(){S&&(URL.revokeObjectURL(S.src),S=null,da=0)};this.getData=function(){return p};this.pause=function(g,h){Qa=g;h&&A&&A.fillRect(0,0,a,b)};this.release=function(){r=null;hi5.Arrays.release(Ca);xa.flushImgs();p=A=xa=null;ya=ya.imgData=null};this.isPaused=function(){return Qa};this.setContext=function(g){g!=A&&(A||!g||g.createImageData(1,1).data.buffer||(J=!1),A=g,null!=A&&(ya.imgData=A.createImageData(a,b)))};this.getContext=function(){return A};this.resize=function(g,
h){if(p.length!=h||p[0].length!=g){for(var f=0;f<h;f++)p[f]=new Uint32Array(g);p.length=h;xa.width=a=g;xa.height=b=h;null!=A&&(ya.imgData=A.createImageData(a,b))}};xa.resize(a,b);this.getBuffer=function(){return p};this.setRGB=function(g,h,f){p[h][g]=f|4278190080};this.getRGB=function(g,h){return p[h][g]};this.setRGBs=function(g,h,f,m,q,t,w){var v=g+f,x=h+m;x>b&&(x=b);if(!(g>=a)){v>a&&(f-=v-a);for(v=h;v<x;v++,t+=w)p[v].set(q.subarray(t,t+f),g);d(g,h,f,m)}};this.moveArea=function(g,h,f,m,q,t){if(0<
t){var w=g+q,v=h+t,x;for(x=m-1;0<=x;x--)p[v+x].set(p[h+x].subarray(g,g+f),w)}else if(0>t)for(w=g+q,v=h+t,x=0;x<m;x++)p[v+x].set(p[h+x].subarray(g,g+f),w);else if(0<q){w=g+q;v=h+t;var F;for(x=f-1;0<=x;x--){var B=w+x;var L=g+x;for(F=0;F<m;F++)p[v+F][B]=p[h+F][L]}}else for(w=g+q,v=h+t,x=0;x<f;x++)for(B=w+x,L=g+x,F=0;F<m;F++)p[v+F][B]=p[h+F][L];d(g+q,h+t,f,m)};this.getRGBs=function(g,h,f,m,q){var t=new Uint32Array(f*m),w=g+f;m=h+m;for(var v=0;h<m;h++)t.set(p[h].subarray(g,w),v),v+=f;q(t)};this.repaint=
function(g,h,f,m){var q=ya.imgData.data,t=0,w,v;G&&G.begin("paint");0>g&&(f+=g,g=0);0>h&&(m+=h,h=0);g+f>a&&(f=a-g);h+m>b&&(m=b-h);var x=g+f;var F=h+m;if(J)for(q=new Uint32Array(q.buffer),v=h;v<F;v++)q.set(p[v].subarray(g,x),t),t+=a;else{var B=4*(a-f)|0;for(v=h;v<F;v++){for(w=g;w<x;w++){var L=p[v][w];q[t++]=L&255;q[t++]=L>>8&255;q[t++]=L>>16&255;q[t++]=255}t+=B}}ya.left=g;ya.top=h;ya.width=f;ya.height=m;G&&G.end("paint");return ya};this.postPaint=d;this.draw=function(g,h,f,m){if(A&&!Qa)if(S&&S.complete&&
(A.drawImage(S,N,P,da,ha),URL.revokeObjectURL(S.src),S=null),Ba){if(g=k(g,h,f,m),g.width)return xa.repaint(g.x,g.y,g.width,g.height),g.width=0,ya}else if(r.width)return xa.repaint(r.x,r.y,r.width,r.height),r.width=0,ya;return null};this.fillRect=function(g,h,f,m,q){var t=g+f,w=h+m;if(p[0].fill)for(var v,x=h;x<w;x++)p[x].fill(q,g,t);else for(x=h;x<w;x++)for(v=g;v<t;v++)p[x][v]=q;d(g,h,f,m)};this.drawLine=function(g,h,f,m,q){if(h==m){if(g>f){var t=g;g=f;f=t}var w=p[h];f++;if(w.fill)w.fill(q,g,f);else for(t=
g;t<f;t++)w[t]=q}else if(g==f)for(h>m&&(t=h,h=m,m=t),m++,t=h;t<m;t++)p[t][g]=q;else{var v=Math.abs(f-g),x=Math.abs(m-h);t=g;w=h;f=f>=g?g=1:g=-1;h=m>=h?m=1:m=-1;if(v>=x){h=g=0;var F=v;var B=v/2|0;var L=x}else m=f=0,F=x,B=x/2|0,L=v,v=x;if(!(1>v))for(v++,x=0;x<v;x++)p[w][t]=q,B+=L,B>=F&&(B-=F,t+=g,w+=m),t+=f,w+=h}};this.bitBlt=function(g,h,f,m,q,t,w,v,x,F){var B=xa;switch(g){case 0:v=B.setRGB;for(B=f;B<f+q;B++)for(x=m;x<m+t;x++)v(B,x,0);break;case 1:g=w;x=F*v+x;F=B.setRGB;h=B.getRGB;null==g&&(g=B);for(B=
0;B<t;B++){for(w=0;w<q;w++)F(f+q,m+t,~(h(f+q,m+t)|g[x])&16777215);x+=v-q}break;case 2:g=w;x=F*v+x;F=B.setRGB;h=B.getRGB;null==g&&(g=B);for(B=0;B<t;B++){for(w=0;w<q;w++){var L=h(f+q,m+t);F(f+q,m+t,L&~g[x]&16777215);x++}x+=v-q}break;case 3:n(B,w,v,x,F,q,t);w?B.setRGBs(f,m,q,t,w,F*v+x,v):B.moveArea(x,F,q,t,f-x,m-F);break;case 4:n(B,null,h,f,m,q,t);e(B,h,f,m,q,t,w,v,x,F);break;case 5:n(B,null,h,f,m,q,t);break;case 6:g=w;x=F*v+x;null==g&&(g=B);for(B=0;B<t;B++){for(F=0;F<q;F++)p[m+B][f+F]=p[m+B][f+F]^g[x]&
16777215|4278190080,x++;x+=v-q}break;case 7:g=w;x=F*v+x;F=B.setRGB;h=B.getRGB;null==g&&(g=B);for(B=0;B<t;B++){for(w=0;w<q;w++)L=h(f+w,m+B),F(f+w,m+B,~(L&g[x])&16777215),x++;x+=v-q}break;case 8:e(B,h,f,m,q,t,w,v,x,F);break;case 9:g=w;x=F*v+x;F=B.setRGB;h=B.getRGB;null==g&&(g=B);for(B=0;B<t;B++){for(w=0;w<q;w++)L=h(f+w,m+B),F(f+w,m+B,L^~g[x]&16777215),x++;x+=v-q}break;case 10:break;case 11:g=w;x=F*v+x;F=B.setRGB;h=B.getRGB;null==g&&(g=B);for(B=0;B<t;B++){for(w=0;w<q;w++)L=h(f+w,m+B),F(f+w,m+B,L|~g[x]&
16777215),x++;x+=v-q}break;case 12:w?B.setRGBs(f,m,q,t,w,F*v+x,v):B.moveArea(x,F,q,t,f-x,m-F);break;case 13:n(B,null,h,f,m,q,t);z(B,h,f,m,q,t,w,v,x,F);break;case 14:z(B,h,f,m,q,t,w,v,x,F);break;case 15:v=B.setRGB;for(B=f;B<f+q;B++)for(x=m;x<m+t;x++)v(B,x,16777215);break;default:svGlobal.logger.warn("unsupported opcode: "+g)}d(f,m,q,t)};this.drawLineExt=function(g,h,f,m,q,t){if(g==f||h==m){var w;if(h==m)if(f>g){var v=f-g;if(!(1>v))for(w=0;w<v;w++)E(t,g+w,h,q)}else{if(v=g-f,!(1>v))for(w=0;w<v;w++)E(t,
f+w,h,q)}else if(m>h){if(v=m-h,!(1>v))for(w=0;w<v;w++)E(t,g,h+w,q)}else if(v=h-m,!(1>v))for(w=0;w<v;w++)E(t,g,m+w,q)}else{var x=Math.abs(f-g),F=Math.abs(m-h);w=g;v=h;var B,L;var fa=f>=g?B=1:B=-1;var W=m>=h?L=1:L=-1;if(x>=F){W=B=0;var U=x;var ea=x/2>>0;var za=F}else L=fa=0,U=F,ea=F/2>>0,za=x,x=F;if(1>x)return;for(F=0;F<=x;F++)E(t,w,v,q),ea+=za,ea>=U&&(ea-=U,w+=B,v+=L),w+=fa,v+=W}q=Math.min(g,f);g=Math.max(g,f);f=Math.min(h,m);h=Math.max(h,m);0>g-q||0>h-f||d(q,f,g-q+1,h-f+1)};this.drawText=function(g,
h,f,m,q,t,w,v,x,F,B,L,fa,W,U,ea,za,rb,sb,tb,ub){var Da=0;1<L?H(F,B,L,fa,q,rb,sb,tb,ub):1==f&&H(t,w,v,x,q,rb,sb,tb,ub);for(var Lc=ea,qa=0;qa<ea;)switch(za[Da+qa]){case 255:var wa=za[Da+qa+2];if(wa>Lc-Da){qa=ea=0;break}wa=za.slice?za.slice(Da,Da+wa):za.subarray(Da,Da+wa);Ja[za[Da+qa+1]]=wa;qa+=3;ea-=qa;Da=qa;qa=0;break;case 254:var Na=(wa=Ja[za[Da+qa+1]])?wa:null;Na&&0==Na[1]&&0==(h&32)&&(0!=(h&4)?U+=za[Da+qa+2]:W+=za[Da+qa+2]);qa=qa+2<ea?qa+3:qa+2;ea-=qa;Da=qa;qa=0;if(!Na)break;for(var Mc=Na.length,
Ra=0;Ra<Mc;Ra++){wa=Ea.getFont(g,Na[Ra]);if(0==(h&32)){var bb=Na[++Ra];0!=(bb&128)?(0!=(h&4)?U+=Na[Ra+1]|Na[Ra+2]<<8:W+=Na[Ra+1]|Na[Ra+2]<<8,Ra+=2):0!=(h&4)?U+=bb:W+=bb}wa&&(O(f,W+wa.offset&65535,U+wa.baseLine&65535,wa.width,wa.height,wa.fontData,q,m,rb,sb,tb,ub),0!=(h&32)&&(W+=wa.width))}break;default:wa=Ea.getFont(g,za[Da+qa]),0==(h&32)&&(bb=za[Da+ ++qa],0!=(bb&128)?(0!=(h&4)?U+=za[Da+qa+1]|za[Da+qa+2]<<8:W+=za[Da+qa+1]|za[Da+qa+2]<<8,qa+=2):0!=(h&4)?U+=bb:W+=bb),wa&&(O(f,W+wa.offset&65535,U+wa.baseLine&
65535,wa.width,wa.height,wa.fontData,q,m,rb,sb,tb,ub),0!=(h&32)&&(W+=wa.width)),qa++}1<L?0<fa&&d(F,B,L,fa):0<v&&0<x&&d(t,w,v,x)};this.drawBitmap=function(g,h,f,m,q,t,w,v,x){var F=Ha.getBitmap(g,h);F?(g=F.width,h=F.height,q>g&&(q=g),t>h&&(t=h),12==x?xa.setRGBs(f,m,q,t,F.data,v*g+w,g):xa.bitBlt(x,a,f,m,q,t,F.data,g,w,v)):svGlobal.logger.warn("Failed to get bitmap from cache, id:"+g+" idx="+h)};this.saveDesktop=function(g,h,f,m,q){xa.getRGBs(g,h,f,m,function(t){ma.save(g,h,f,m,q,t)})};this.restoreDesktop=
function(g,h,f,m,q){(q=ma.restore(g,h,f,m,q))?xa.setRGBs(g,h,f,m,q,0,f):svGlobal.logger.warn("XXX no matched desktop save.")};this.putFont=function(g,h,f){Ea.putFont(g,h,f)};this.putBitmap=function(g,h,f){Ha.putBitmap(g,h,f)};this.putCursor=function(g,h){Y.set(g,h)};this.setCursor=function(g){if(!Qa&&-1!=g){var h=Y.get(g);if(h)xa.onSetCursor(h);else svGlobal.logger.warn("invalid cursor"+g)}};var R=0;this.isSendingHistory=function(){return 2E3>Date.now()-R};this.getHistory=function(g,h){var f=null;
G&&G.begin("his_bitmap");Ha.forEach(function(v,x,F){if(v){var B=0,L=0;F=0;for(var fa=v.length;F<fa;F++)v[F]&&v[F].data&&(B++,L+=v[F].raw?v[F].raw.length:4*v[F].data.length);if(B&&L){f=new Uint8Array(L+20*B+8);f[0]=29;f[2]=1;f[3]=4;L=new hi5.DataBuffer(f,4,f.length);L.setLittleEndian32(B);for(F=0;F<fa;F++)(B=v[F])&&B.data&&(L.setLittleEndian16(x),L.setLittleEndian16(F),L.setLittleEndian16(B.left),L.setLittleEndian16(B.top),L.setLittleEndian16(B.width),L.setLittleEndian16(B.height),L.setLittleEndian16(B.bitsperpixel),
L.setLittleEndian16(B.codec),L.setLittleEndian32(B.raw?B.raw.length:4*B.data.length),L.setBytes(B.raw||new Uint8Array(B.data.buffer)));g(f.buffer)}}});G&&G.end("his_bitmap");G&&G.begin("his_font");(f=Ea.toPDU())&&g(f.buffer);G&&G.end("his_font");(f=Y.toPDU())&&g(f.buffer);for(var m=4,q=0,t=Ja.length;q<t;q++)Ja[q]&&(m+=Ja[q].length+6);if(4<m){f=new Uint8Array(m);f[0]=29;f[2]=1;f[3]=7;var w=4;q=0;for(t=Ja.length;q<t;q++)Ja[q]&&Ja[q].length&&(f[w++]=q,f[w++]=q>>8,m=Ja[q].length,f[w++]=m,f[w++]=m>>8,
f[w++]=m>>16,f[w++]=m>>24,f.set(Ja[q],w),w+=m);g(f.buffer)}(f=ma.toPDU())&&g(f.buffer);h();R=Date.now()};this.setHistory=function(g,h){switch(g){case 4:G&&G.begin("his_bitmap_dec");var f=h.getLittleEndian32();for(g=0;g<f;g++){var m=h.getLittleEndian16(),q=h.getLittleEndian16(),t=h.getLittleEndian16(),w=h.getLittleEndian16(),v=h.getLittleEndian16(),x=h.getLittleEndian16(),F=h.getLittleEndian16(),B=h.getLittleEndian16(),L=h.getLittleEndian32(),fa=new Uint8Array(h.getData().buffer,h.getPosition(),L),
W=new Uint8Array(L);W.set(fa);fa=rdpcodecs.bitmap;switch(B){case 0:var U=new Uint32Array(W.buffer);h.skipPosition(L);break;case 1:switch(F){case 16:U=fa.decompressInt16(v,x,L,W,0);break;case 24:U=fa.decompressInt24(v,x,L,W,0);break;case 32:U=fa.decompressInt32(v,x,L,W,0)}h.skipPosition(L);break;case 2:U=new rdpcodecs.NSCodec,U.process(h,F,v,x),L=U.getData(),U=U.getDataSize(),U=new Uint32Array(U),rdpcodecs.flipimage(L,0,U,v,x,1)}Ha.putBitmap(m,q,new rdpcodecs.Bitmap(U,v,x,t,w,F,0==B?null:W,B))}G&&
G.end("his_bitmap_dec");break;case 5:Ea.fromStream(h);break;case 6:Y.fromStream(h);break;case 7:for(;h.has(6);)if(g=h.getLittleEndian16(),L=h.getLittleEndian32())f=h.getData().subarray(h.getPosition(),h.getPosition()+L),Ja[g]=f,h.skipPosition(L);break;case 9:ma.fromStream(h)}};var Y=new function(){var g=[],h=!1;this.useRemoteCursor=function(f){h=f};this.set=function(f,m){h&&(m.system="");g[f]=m};this.get=function(f){return g[f]};this.total=function(){return g.length};this.toPDU=function(){for(var f=
2,m=2,q=0,t=0,w=g.length,v;t<w;t++)if(v=g[t])q++,m=m+7+(v.rawData?v.rawData.length:0);if(!q)return null;m=new Uint32Array(m);m[0]=100728861;m[1]=q;for(t=0;t<w;t++)if(v=g[t])if(q=v.rawData?v.rawData.length:0,m[f++]=v.cache_idx|v.bpp<<16,m[f++]=v.hotX|v.hotY<<16,m[f++]=v.width|v.height<<16,m[f++]=v.xorSize,m[f++]=v.andSize,m[f++]=v.distance,m[f++]=q)m.set(v.rawData,f),f+=q;return m};this.fromStream=function(f){var m=f.getPosition();f=new Uint32Array(f.getData().buffer,m);var q=f[0],t=0;for(m=1;t<q;t++){var w=
f[m]&65535;var v=f[m++]>>16;var x=f[m]&65535;var F=f[m++]>>16;var B=f[m]&65535;var L=f[m++]>>16;var fa=f[m++];var W=f[m++];var U=f[m++];var ea=f[m++];var za=null;ea&&(za=new Uint32Array(ea),za.set(f.subarray(m,m+ea)),m+=ea);v=new u(w,za,x,F,B,L,v,fa,W);U&&(v.distance=U);h&&(v.system="");g[w]=v}}};Y.useRemoteCursor(!!K.remoteCursor);var ma=new function(){function g(f,m,q,t,w,v){this.x=f;this.y=m;this.cx=q;this.cy=t;this.offset=w;this.data=v}var h=[];this.save=function(f,m,q,t,w,v){f=new g(f,m,q,t,
w,v);m=0;for(q=h.length;m<q;m++)if(!h[m]){h[m]=f;return}h.push(f)};this.restore=function(f,m,q,t,w){for(var v,x=0,F=h.length;x<F;x++)if((v=h[x])&&v.x==f&&v.y==m&&v.cx==q&&v.cy==t){if(v.offset==w)return f=v.data,h[x]=null,f;svGlobal.logger.warn("TODO: offset")}return null};this.toPDU=function(){for(var f=0,m=2,q=0,t=h.length;q<t;q++)h[q]&&(f++,m+=h[q].data.length+6);if(!f||!m)return null;m=new Uint32Array(m);var w=2;m[0]=151060509;m[1]=f;for(q=0;q<t;q++)if(f=h[q])m[w++]=f.x,m[w++]=f.y,m[w++]=f.cx,
m[w++]=f.cy,m[w++]=f.offset,m[w++]=f.data.length,m.set(f.data,w),w+=f.data.length;return m};this.fromStream=function(f){f=new Uint32Array(f.getData().buffer,f.getPosition());for(var m=1,q=f[0],t,w,v,x,F,B,L,fa=0;fa<q;fa++)t=f[m++],w=f[m++],v=f[m++],x=f[m++],F=f[m++],B=f[m++],L=new Uint32Array(B),B=m+B,L.set(f.subarray(m,B)),m=B,this.save(t,w,v,x,F,L)}},Ja=[],Ea=new function(){var g=[];this.putFont=function(h,f,m){g[h]||(g[h]=[]);g[h][f]=m};this.getFont=function(h,f){return g[h]?g[h][f]:null};this.toPDU=
function(){var h=0,f,m,q;var t=4;for(var w,v=g.length;h<v;h++)if((q=g[h])&&q.length)for(w=q.length,f=0;f<w;f++)(m=q[f])&&(t+=15+m.fontData.length);if(5>t)return null;var x=new Uint8Array(t);t=new hi5.DataBuffer(x,0,t);x[0]=29;x[2]=1;x[3]=5;t.skipPosition(4);h=0;for(v=g.length;h<v;h++)if((q=g[h])&&q.length)for(w=q.length,f=0;f<w;f++)if(m=q[f])t.setByte(h),t.setLittleEndian16(f),t.setLittleEndian16(m.offset),t.setLittleEndian16(m.baseLine),t.setLittleEndian16(m.width),t.setLittleEndian16(m.height),
t.setLittleEndian32(m.fontData.length),t.setBytes(m.fontData);return x};this.fromStream=function(h){for(;h.has(15);){var f=h.getByte(),m=h.getLittleEndian16(),q=h.getLittleEndian16(),t=h.getLittleEndian16(),w=h.getLittleEndian16(),v=h.getLittleEndian16(),x=h.getLittleEndian32();x=h.getBytes(x);this.putFont(f,m,new y(q,t,w,v,x))}}},Ha=new function(){var g=[],h=[];this.putBitmap=function(f,m,q){if(32767==m)h[f]&&(h[f].data=null,h[f]=null),h[f]=q;else{var t=g[f];t?t[m]&&(t[m].data=null,t[m]=null):g[f]=
t=[];t[m]=q}};this.getBitmap=function(f,m){return 32767==m?h[f]:g[f]?g[f][m]:null};this.forEach=function(f){for(var m=g.length,q=0;q<m;q++)f(g[q],q,g)}}}this.displayMsg=this.reconnectOnResize=!0;this.appTimeout=1600;this.reconnectTimes=0;this.windowState=3;this.setTitle=this.openLink=!0;this.audioBuffer=0;this.sessionInfo={domain:"",userName:"",sessionId:0,joinedSessions:[],suppressOutput:!1,appInfo:null,joiners:[]};this.mode=0;this.remoteAppLogin=!0;var qb=!1,Ua={},Va={},ib=null,l=this,Nb=!1,Ga=
!1,La=0,jb=null,kb=null,nc=0;hi5.appcfg||(hi5.appcfg={img:{},toolbar:{fadable:!0},displayMsg:!0});var K=hi5.appcfg,ob="";this.setConfig=function(a){K=a};var Ka="object"==typeof D?D:null,C=Ka?{}:hi5.tool.queryToObj(D.substring(D.indexOf("?")+1)),ka=0,la=0,Ta=(ja||C.color||C.server_bpp||16)|0,db=null,oc=null,sa=null,nb=null,pc="/DOWNLOAD?",qc="/CLIP?";24==Ta&&(Ta=16);this.setLinks=function(a){a.download&&(pc=a.download);a.clipboard&&(qc=a.clipboard)};this.protocol=Ka?"":D.substring(0,D.indexOf("://")).toLowerCase();
this.hasSmartCard=function(){return ba(C.smartCard)||ba(C.mapSmartCard)||ba(C.passwordIsPin)};this.hasScanner=function(){return ba(C.scanner)};this.hasUSB=function(){return ba(C.mapUSB)&&!!navigator.usb};this.getUSB=function(){return C.usb||hi5.appcfg.usb||{filters:[{classCode:0},{classCode:2},{classCode:5},{classCode:6},{classCode:10},{classCode:13},{classCode:239},{classCode:220},{classCode:239},{classCode:254},{classCode:255}]}};this.setProfiler=function(a){oc=a};this.getProfiler=function(){return oc};
this.gateway=function(){if(Ka)return"";var a=D.lastIndexOf("/RDP?");-1==a&&(a=D.lastIndexOf("/JOIN?"));-1==a&&(a=D.lastIndexOf("/PLAY?"));return D.substring(0,a).replace(/wss:\/\//ig,"https://").replace(/ws:\/\//ig,"http://")}();svGlobal.logger.warn("Ver:"+svGlobal.version+" build:"+svGlobal.build);this.getGatewayAddr=Za;var Pa="object"==typeof D||0<D.indexOf("/PLAY?"),rc=!Pa&&0<D.indexOf("invitation=");if(rc){var Rb=decodeURIComponent(D),vb=Rb.indexOf(' USERNAME="');if(0<vb){vb+=11;var sc=Rb.substring(vb,
Rb.indexOf('"',vb));D+="&novice="+sc+"&server="+sc}D+="&mapClipboard=on";C.mapClipboard="on";this.reconnectOnResize=!1}if(Pa)this.mode=1,Ka?D="":(ka=640,la=480),D+="&touchpad=on",C.touchpad="on",this.reconnectOnResize=!1;else if(0<D.indexOf("/JOIN?")||rc)this.mode=2,this.reconnectOnResize=!1;M?ka=parseInt(M):C.width&&(ka=parseInt(C.width));T?la=parseInt(T):C.height&&(la=parseInt(C.height));-1==ka&&(ka=hi5.browser.getScreenWidth());-1==la&&(la=hi5.browser.getScreenHeight());C.symlink&&C.parameters&&
hi5.tool.queryToObj(C.parameters,C);C.gateway||(D+="&gateway="+encodeURIComponent(l.gateway));!C.minWidth&&K.minWidth&&(C.minWidth=K.minWidth);!C.minHeight&&K.minHeight&&(C.minHeight=K.minHeight);C.minWidth&&(C.minWidth=parseInt(C.minWidth));C.minHeight&&(C.minHeight=parseInt(C.minHeight));C.waWidth=C.waWidth?parseInt(C.waWidth):hi5.browser.isAndroid||hi5.browser.isiOS?Math.max(screen.width,screen.height):screen.width;C.waWidth&=-4;C.waHeight=C.waHeight?parseInt(C.waHeight):hi5.browser.isAndroid||
hi5.browser.isiOS?Math.max(screen.width,screen.height):screen.height;C.waHeight&=-4;"useSSL"in C||(D+="&useSSL="+("wss"==l.protocol));hi5.storage.isAvailable&&(ba(C.shareClipboard)||C.shareClipboardId)&&(D+="&shareClipboardId="+(C.shareClipboardId||uc()));K&&(void 0!=K.displayMsg?this.displayMsg=K.displayMsg:K.displayMsg=this.displayMsg,K.appTimeout&&(this.appTimeout=K.appTimeout),void 0!=K.reconnectOnResize&&(this.reconnectOnResize=K.reconnectOnResize),K.reconnectTimes&&(this.reconnectTimes=K.reconnectTimes),
void 0!=K.windowState&&(this.windowState=K.windowState),void 0!=K.openLink&&(this.openLink=K.openLink),void 0!=K.setTitle&&(this.setTitle=K.setTitle),K.audioBuffer&&(this.audioBuffer=K.audioBuffer),"boolean"==typeof K.useWSS&&(D=(K.useWSS?"wss":"ws")+D.substring(D.indexOf("://"))),"boolean"==typeof K.remoteAppLogin&&(this.remoteAppLogin=K.remoteAppLogin,qb=!K.remoteAppLogin,svGlobal.logger.warn("remoteAppLogin deprecated, use hideLogin in appcfg.js instead")),"boolean"==typeof K.hideLogin&&(qb=K.hideLogin),
void 0!=K.localPrinter&&void 0==C.localPrinter&&(C.localPrinter=K.localPrinter));ba(C.nocurosr);var Fa="app"==C.startProgram,pb=ba(C.mapDisk),Xa=0,oa=null;void 0==K.useWorker&&(K.useWorker=!1);K.useWorker&&(!window.Worker||hi5.browser.isFirefox||Fa&&!hi5.browser.isIE||"file:"==location.protocol||0<navigator.userAgent.indexOf("MSIE 10."))&&(K.useWorker=!1);void 0==hi5.libMin&&(hi5.libMin=!0);var na=K.useWorker?new Worker(Sb("rdpworker",hi5.libMin?"rdpworker_min.js":"rdpworker.js")):null,cb=this.reconnectTimes,
Cb=na?{type:5,data:null}:null;this.getDisplayName=fb;this.server=fb();this.port=parseInt(C.port,10);this.loadbalanceToken="";K.loadbalanceTokenName&&(C[K.loadbalanceTokenName]?wb(C[K.loadbalanceTokenName]):!1!==K.randomAppId?wb(hi5.tool.uuid()):svGlobal.logger.info("Using app.id as loadbalanceToken"));this.modifyURL=function(a){l.loadbalanceToken&&(a+=-1==a.indexOf("?")?"?"+l.loadbalanceToken:"&"+l.loadbalanceToken,a+="&loadbalanceTokenName="+K.loadbalanceTokenName);return a};this.getURL=function(){return D};
this.getColor=function(){return Ta};this.changeTitle=xb;hi5.browser.isTouch&&Math.max(ka,la)>Math.max(window.innerWidth,window.innerHeight)&&(this.reconnectOnResize=!1);this.isRemoteApp=function(){return Fa};var aa=null,ia=!1,ab=!1,Qb=!1,pa=new function(a){var b=null;this.available=!1;this.delay=a;this.supportWebAudio=!1;(0==C.playSound||0<l.mode)&&(b=hi5.audio.getAudioContext())&&hi5.audio.playable&&(this.supportWebAudio=this.available=!0);this.getContext=function(){return b};this.getBuffer=function(n){return b.createBuffer(2,
n,Oa)};var c=0,k=null,d=null;this.setVolume=function(n){1==n?k=null:(k||(k=b.createGain()),k.gain.value=n)};this.playBuffer=function(n){d=b.createBufferSource();d.buffer=n;k?(d.connect(k),k.connect(b.destination)):d.connect(b.destination);var e=b.currentTime,z=0<c?c:e+a;z<e&&(z=e);c=z+n.duration;d.start?d.start(z):d.noteOn(z);return c-e};this.iOSFix=function(){if(b&&hi5.browser.isSafari){var n=this.getBuffer(1024),e=b.createBufferSource();e.buffer=n;e.connect(b.destination);e.start?e.start(0):e.noteOn(0)}};
this.close=function(){b&&(k&&k.disconnect(),d&&d.disconnect(),hi5.audio.releaseAudioContext())}}(l.audioBuffer),ac=pa.available,Q=new Tb(200,200);Q.onSetCursor=bc;this.setVolume=function(a){pa&&pa.setVolume(a)};this.setAudioBuffer=function(a){l.audioBuffer=a;pa.delay=a};var zb=0,yb=0,Ab=ka-1,Bb=la-1,Ob="";window.$rdp||(window.$rdp=this);gb(Ta);this.running=function(){return ia};this.setJoinMode=function(a){ia&&V("8E1"+a)};this.setJoinCloseMode=function(a){ia&&V("8EB3\t"+a)};this.refuseControl=function(a){ia&&
V("8E3"+a)};this.giveControl=function(a){ia&&V("8E4"+a)};this.pauseSession=function(a,b){ia&&V("8EB"+(b?1:0)+"\t"+a)};this.closeSession=function(a){ia&&V("8EB2\t"+a)};this.requestControl=function(){ia&&V("8E2")};this.saveSession=function(a){ia&&V("8E9"+(a.save?1:0)+"\t"+(a.timeout||0)+"\t"+(a.id||0))};this.allowJoin=function(a,b){ia&&V("8EA"+a+"\t"+(b?1:0))};var lb=new function(){function a(){if(c&&0<c.length){var n=c.shift();n.key?lb.sendSingleKey(n.down,n.key):n.char&&Ub(n.char);0<c.length?setTimeout(a,
k):(c=null,d&&d())}}var b={" ":57,space:57,pgup:201,pageup:201,pgdn:209,pagedown:209,end:207,home:199,left:203,up:200,right:205,down:208,printscreen:183,insert:210,del:211,"delete":211,altgr:184,windows:219,windowsright:220,context:221,esc:1,backspace:14,back:14,tab:15,enter:28,meta:29,command:29,ctrl:29,shift:42,alt:56,capslock:58,f1:59,f2:60,f3:61,f4:62,f5:63,f6:64,f7:65,f8:66,f9:67,f10:68,f11:87,f12:88,numlock:69,scrolllock:70,add:78};this.sendSingleKey=function(n,e){var z=b[e.toLowerCase()];z?
l.writeScancode(n,z):(z=e.length,0!=z&&(1==z?l.writeKeyCode(n,e.toUpperCase().charCodeAt(0)):n&&l.writeText(e)))};var c=null,k=0,d=null;this.sendKeyComb=function(n,e,z){if(Ga){n=n.split("+");var E=n.length,H;if(0!=E){var O=null,y=[];for(H=0;H<E;H++){var u=n[H];""==u&&""==O&&(u="Add");""!=u&&y.push({key:u,down:!0});O=u}E=y.length;for(H=E-1;0<=H;H--)y.push({key:y[H].key,down:!1});if(e)c=y,k=e,d=z,a();else for(H=0,E=y.length;H<E;H++)lb.sendSingleKey(y[H].down,y[H].key)}}};this.sendText=function(n,e,
z){for(var E=[],H=0,O=n.length;H<O;H++)E.push({"char":n.charAt(H)});c=E;k=e;d=z;a()}};this.writeKeyComb=function(a,b,c){Ga&&lb.sendKeyComb(a,b,c)};this.writeText=function(a,b,c){if(Ga)if(b)lb.sendText(a,b,c);else for(b=0,c=a.length;b<c;b++)Ub(a.charAt(b))};this.writeClipboard=function(a,b){a&&(b||(b="text/plain"),l.writeRawInput("880"+b+"\t"+a.hashCode()),kb={type:b,text:a})};var I=new function(a,b){function c(){function d(y){for(;0<y.ownerWinid;){var u=H.getWinById(y.ownerWinid);if(u&&u.isVisible())y=
u;else break}return y}function n(y){for(var u="";y;)y.titleInfo&&(u=y.titleInfo),y=H.getWinById(y.ownerWinid);return u}var e=[],z=[],E=0,H=this;this.mainWin=null;this.appId="";var O=0;this.getActiveWinId=function(){return O};this.setActiveWinId=function(y){svGlobal.logger.info("setActiveWinId: "+y+" old: "+O);if(O!=y){var u=0==O;O=y;(y=H.getMainByWinId(y))&&y.isMainWin()&&H.mainWin!=y&&(H.mainWin=y);u&&(u=I.getFocused())&&(u=u.getFreeSpace(),y=u.width,l.resetSize(y,u.height))}};this.onchange=function(y){y.isVisible()||
y!=H.mainWin?y.isVisible()&&!H.mainWin&&y.isMainWin()&&(H.mainWin=y,a.windowState&&y.exeCommand(61488)):H.mainWin=null};this.addWin=function(y){for(var u=e.length,p=!1,A=0;A<u;A++)if(y.id==e[A].id){e[A]=y;p=!0;break}p||e.push(y);1==e.length&&(E=Date.now());u=y.isMainWin();svGlobal.logger.info("is main win:"+u+" id:"+y.id);u&&!H.mainWin&&(H.mainWin=y)};this.popWins=function(y){y=H.getWinById(y);var u=[];if(y){y=0<y.ownerWinid?y.ownerWinid:y.id;for(var p=e.length-1;0<=p;p--)if(e[p].ownerWinid==y||e[p].id==
y)u.push(e[p]),e.splice(p,1)}return u};this.hasApp=function(y){return-1!=z.indexOf(y)};this.addApp=function(y){return-1==z.indexOf(y)?(z.push(y),!0):!1};this.isNew=function(){return 3E4>Date.now()-E};this.getAll=function(){return e};this.hasWin=function(y){return 0<=e.indexOf(y)};this.close=function(){for(var y=0,u=e.length;y<u;y++)e[y].close()};this.clear=function(){e.length=0};this.delWin=function(y){for(var u=0,p=e.length;u<p;u++)if(e[u].id==y)return e.splice(u,1),u;return-1};this.isRunning=function(){var y=
e.length;if(1>y)return!1;var u=0;for(y=e.length;u<y;u++){var p=e[u];if(p.showState)return!0}return!1};this.getWinById=function(y){var u=e.length;if(1>u)return null;for(var p=0;p<u;p++){var A=e[p];if(A.id==y)return A}return null};this.getMainWinByAppId=function(y){var u=null,p=0;for(len=e.length;p<len;){u=e[p];if(u.appId==y&&u.isVisible()&&1>u.ownerWinid)break;p++}return u};this.getTopWin=function(y){var u=null,p,A=y.length;for(p=0;p<A&&(!(u=H.getWinById(y[p]))||!u.isVisible());p++)u=null;if(!u)for(svGlobal.logger.warn("No win found"),
A=e.length,p=A-1;0<=p&&(u=e[p],!u.isVisible());p--)u=null;return u};this.getMain=function(y){return(y=H.getTopWin(y))?d(y):null};this.getMainByWinId=function(y){return(y=H.getWinById(y))?d(y):null};this.getOtherApps=function(y,u,p){var A=e.length;if(0!=A&&e[A-1])if(A=e[A-1].appId,p||!A)setTimeout(function(){H.getOtherApps(y,u)},p||3E3);else{p=[];if(A=H.getTopWin(y)){var r=0<A.ownerWinid?A.ownerWinid:A.id,J=[],G=0;for(A=e.length;G<A;G++)e[G].ownerWinid!=r&&e[G].id!=r&&e[G].isVisible()&&J.push(e[G]);
G=0;for(A=J.length;G<A;G++)J[G].ownerWinid!=r&&J[G].id!=r&&(p.push({title:n(J[G]),win:d(J[G])}),r=0<J[G].ownerWinid?J[G].ownerWinid:J[G].id)}u(p)}};this.getFullTitle=function(y){for(var u,p="";;){u=H.getWinById(y);if(!u)break;u.titleInfo&&u.isVisible()&&(p&&(p=" > "+p),p=u.titleInfo+p);if(1>y)break;y=u.ownerWinid}return p}}var k=[];this.tryCloseRemoteApps=function(){if(a&&a.isRemoteApp())for(var d=k.length,n=0;n<d;n++)k[n].railWin&&k[n].railWin.close()};this.verifyMonitors=function(){for(var d=k.length,
n=Array(d),e=0;e<d;e++)k[e].configMonitor(),n[e]=k[e].getMousePosition();n.sort(function(H,O){var y=H.left-O.left;return 0!=y?y:H.top-O.top});var z=n.findIndex(function(H){return 0==H.left&&0==H.top});svGlobal.logger.info("monitor layout",n,z);-1==z&&(l.showMessage("* Primary monitor not found. Please make your browser window full screen."),svGlobal.logger.warn("Primary monitor not found (left=top=0)",n));for(e=z-1;0<=e;){if(n[e].right<n[e+1].left){var E=n[e+1].left-n[e].right-1;0<E&&(n[e].right+=
E,n[e].left+=E)}n[e].bottom<n[e+1].top&&(E=n[e+1].top-n[e].bottom-1,0<E&&(n[e].top+=E,n[e].bottom+=E));e--}for(e=z+1;e<d;)n[e-1].right<n[e].left&&(E=n[e].left-n[e-1].right-1,0<E&&(n[e].right-=E,n[e].left-=E)),n[e-1].bottom<n[e].top&&(E=n[e].top-n[e-1].bottom-1,0<E&&(n[e].top-=E,n[e].bottom-=E)),e++};this.repaint=function(d,n,e,z){for(var E=0,H=k.length;E<H;E++)k[E].repaint(d,n,e,z)};this.size=function(){return k.length};this.getSurface=function(d){return k[d]};this.addSurface=function(d){k.push(d)};
this.hasSurface=function(d){for(var n=k.length,e=0;e<n;e++)if(k[e].equals(d))return!0;return!1};this.fromSyncedSurface=function(d){var n=k.length;Date.now();for(var e=0;e<n;e++)if(k[e].isClipSynced(d))return!0;return!1};this.setSize=function(d,n,e){for(var z=0,E=k.length;z<E;z++)k[z].setSize(d,n,e)};this.zOrders=[];this.drawLicense=function(d){for(var n=0,e=k.length;n<e;n++)k[n].drawLicense(d)};this.setReadOnly=function(d,n){for(var e=0,z=k.length;e<z;e++)k[e].setReadOnly(d,n)};this.setVisible=function(d,
n){svGlobal.logger.info("TODO: setVisible")};this.setCursor=function(d){for(var n=0,e=k.length;n<e;n++)k[n]&&k[n].setCursor(d)};this.hide=function(d){d=0;for(var n=k.length;d<n;d++)k[d]&&k[d].hide()};this.execute=function(d,n){for(var e=0,z=k.length;e<z;e++)k[e][d].apply(k[e],n)};this.addWin=function(d){var n=this.getFocused();n||(svGlobal.logger.warn("Focused surface not found!"),n=k[k.length-1]);n?(Fa=!0,n.railWin||(n.railWin=new c,n.onunload=function(){hi5.appcfg.closeRemoteApp&&n.railWin&&n.railWin.close();
n.remoteApp&&n.remoteApp.close();n.railWin&&(n.railWin.clear(),n.railWin=null);k.removeElm(n)}),n.context&&b.setContext(n.context),n.railWin.addWin(d),n.railWin.mainWin==d&&(setTimeout(function(){var e=n.getFreeSpace();a.writeRawInput("8C661441\t"+e.width+"\t"+e.height);svGlobal.logger.info("-- main win dp change:"+e.height);a.windowState&&d.resizable()&&setTimeout(function(){d.exeCommand(61488);svGlobal.logger.info("-- max")},50)},111),ta.sendKeyboardSyncFlags(ta.localLockFlags,500)),hi5.browser.isIE&&
n.focus()):svGlobal.logger.warn("No surface available!")};this.delWin=function(d){for(var n,e=k.length-1;0<=e;e--){var z=k[e];n=z.railWin;var E=n.getWinById(d),H=E&&E.appId&&-1!=E.appId.toLowerCase().indexOf("runonce");if(0<=n.delWin(d)){E==n.mainWin&&(n.mainWin=null);if(z.toolbar){d="win"+d;var O=z.toolbar.querySelector("#"+d);O&&z.toolbar.removeChild(O)}if(!n.isRunning()&&0==l.mode){if(E.isMainWin()&&z.onremoteappclose)z.onremoteappclose(E);E=a.appTimeout;if(H||n.isNew())E*=10;svGlobal.logger.debug("Prepare del:"+
Date.now());setTimeout(function(y){return function(){svGlobal.logger.info("Start del:"+Date.now());y.railWin&&y.railWin.isRunning()||(y.remoteApp&&y.remoteApp.close(),I&&I.delSurface(y))}}(z),E)}}}};this.popWins=function(d){return k[0]&&k[0].railWin?k[0].railWin.popWins(d):[]};this.getWinById=function(d){for(var n,e=0,z=k.length;e<z;e++)if(k[e].railWin&&(n=k[e].railWin.getWinById(d)))return n;return null};this.getMainWinByAppId=function(d){for(var n,e=0,z=k.length;e<z;e++)if(k[e].railWin&&(n=k[e].railWin.getMainWinByAppId(d)))return n;
return null};this.onWinChange=function(d){for(var n,e=0,z=k.length;e<z;e++)if(k[e].railWin&&(n=k[e].railWin.getWinById(d.id)))k[e].railWin.onchange(d)};this.setTitle=function(d){for(var n,e=0,z=k.length;e<z;e++)if(k[e].railWin){n=k[e].railWin.getWinById(d);var E=k[e].railWin.getFullTitle(d);if(E){a.changeTitle(E,k[e].getWindow(),n.appId);break}}};this.hasApp=function(d){for(var n=0,e=k.length;n<e;n++)if(k[n].railWin.hasApp(d))return!0;return!1};this.delSurface=function(d){!d||d.railWin&&d.railWin.isRunning()||
(svGlobal.logger.info("delete surface..."),k.removeElm(d),d.close(),0==k.length&&a._unload())};this.getOwnerSurface=function(d){for(var n=0,e=k.length;n<e;n++)if(k[n].railWin&&k[n].railWin.hasWin(d))return k[n];return null};this.getOwnerSurfaceById=function(d){for(var n,e=0,z=k.length;e<z;e++)if(k[e].railWin&&(n=k[e].railWin.getWinById(d)))return k[e];return null};this.getFocused=function(){for(var d=k.length,n=0;n<d;n++)if(k[n].focused)return k[n];return k[d-1]};this.close=function(){for(var d=0,
n=k.length;d<n;d++)k[d]&&(k[d].remoteApp&&k[d].remoteApp.close(),k[d].close(),k[d]=null)};this.LocalWin=function(d){function n(){a.writeRawInput("8C0"+d)}this.id=d;this.appId="";var e=this;this.resizable=function(){return e.isVisible?0!=(e.style&262144)||0!=(e.style&65536)||0!=(e.style&16777216)||3==e.showState:!1};this.setShowState=function(z){e.showState=z};this.parent=function(){return I.getWinById(e.ownerWinid)};this.resize=function(z,E,H,O){hi5.appcfg.disableJoinedAppResize&&2==a.mode||a.writeRawInput("8C1"+
e.id+"\t"+z+"\t"+E+"\t"+H+"\t"+O)};this.exeCommand=function(z){a.writeRawInput("8C4"+d+"\t"+z)};this.activate=function(z){2==e.showState?(e.exeCommand(61728),setTimeout(function(){a.writeRawInput("8C3"+d+"\t"+z)},50)):a.writeRawInput("8C3"+d+"\t"+z)};this.close=function(){e.exeCommand(61536)};this.getAppId=n;this.isVisible=function(){return e.winWidth&&e.winHeight&&e.showState&&45<e.winHeight&&45<e.winWidth};this.isMainWin=function(){if(!(e.isVisible()&&e.winWidth&&e.winHeight&&45<e.winHeight&&45<
e.winWidth))return!1;var z=1>e.ownerWinid;if(!z)return z;var E=e.style;if(0!=(E&4194304))return!0;if(0!=(E&2147483648)&&(0==(E&8388608)||0==(E&12582912)))return!1;var H=0!=(e.extStyle&128);(z=z&&!H)&&0!=(E&2147483648)&&0==(E&2156396544)&&(z=!1);return z};n()}}(l,Q);this.getSurfaces=function(){return I};this.hide=function(){I&&I.hide()};this.getFileUrl=function(a,b,c){var k=Za(),d=pc,n=d.indexOf("://");k=(0<n&&11>n?d:k+d)+"s="+Ob+"&f="+encodeURIComponent(a);b&&(k+="&src="+b);c&&(k+="&action="+c);return l.modifyURL(k)};
this.listFiles=function(a,b){oa&&Ga&&oa.list(a,b)};this.writeRawInput=function(a){if(Ga){V(a);if(l.onactivity)l.onactivity(a);return!0}return!1};this.authWithCode=function(a,b){var c=a.length,k=new Uint8Array(5+c);k[0]=146;k[1]=7;k[2]=b;k[3]=c&255;k[4]=c>>8&255;for(b=0;b<c;b++)k[5+b]=a.charCodeAt(b);V(k.buffer)};var tc=0;if(K.numLock||K.numlock||ba(C.numLock)||hi5.browser.isMacOS||hi5.browser.isiOS||hi5.browser.isCrOS)tc|=2;var ta=new function(a,b,c,k){this.setJoinMode=a.setJoinMode;this.requestControl=
a.requestControl;this.writeKeyComb=a.writeKeyComb;this.writeText=a.writeText;this.localLockFlags=k||0;this.remoteLockFlags=0;this.checkLockFlags=!0;this.reqCopyTime=0;this.draw=c.draw;var d=a.isRemoteApp(),n=void 0;this.saveResize=function(e){n=a.reconnectOnResize;a.reconnectOnResize=e};this.restoreResize=function(){void 0!=n&&(a.reconnectOnResize=n)};this.refresh=function(e,z,E,H){return c.repaint(e,z,E-e+1,H-z+1)};this.getAppMode=function(){return a.mode};this.getAgentStatus=function(){return a.getAgentStatus()};
this.send=a.writeRawInput;this.saveSession=function(e){a.saveSession(e)};this.sendInput=a.writeRawInput;this.getAppInfo=function(){return a.sessionInfo.appInfo};this.resumeAudio=function(){pa.supportWebAudio&&pa.iOSFix()};this.onresize=function(e){if(e=e.target.svSurface){var z=e.getFreeSpace(),E=z.width;z=z.height;ta.checkLockFlags=!0;K.scale?e.scaleTo(E,z,!1):a.resetSize(E,z)}};this.onorientationchange=function(e){a.resetSize(e.innerWidth,e.innerHeight)};this.getClipData=function(e,z){this.reqCopyTime=
Date.now();var E=a.getGatewayAddr(),H=qc,O=H.indexOf("://");E=(0<O&&11>O?H:E+H)+"s="+a.sessionInfo.appInfo.session+"&t="+Date.now()+"&type="+e;e=hi5.httpGet(a.modifyURL(E),z);this.reqCopyTime=Date.now();kc(e);return e};this.onfocus=function(e){var z=I.getFocused();d&&z&&z.railWin&&(e=z.railWin.mainWin)&&a.running()&&(z=z.context)&&z!=c.getContext()&&(c.setContext(null),e.activate(1),svGlobal.logger.info("Activate win:"+e.id))};this.getShareFiles=a.listFiles;this.getFile=function(e,z,E){a.reconnectOnResize=
!1;var H=a.getFileUrl(e,z,E);l.ondownload&&l.ondownload({fileName:e,url:H,source:z,action:E})||window.open(H)};this.getFileLink=a.getFileUrl;this.getGateway=function(){return D};this.reconnect=function(e,z,E){C.symlink?(e="user="+e+"&pwd="+z,E&&(e+="&domain="+E),D=hi5.tool.replaceQuery(D,"parameters",e)):(D=hi5.tool.replaceQuery(D,"user",e),D=hi5.tool.replaceQuery(D,"pwd",z),D=hi5.tool.replaceQuery(D,"domain",E));a.run()};this.sendKeyboardSyncFlags=function(e,z){return Ga?(svGlobal.logger.info("sync lock keys, current:"+
e+" was:"+this.localLockFlags+" remote:"+this.remoteLockFlags),this.remoteLockFlags=this.localLockFlags=e,setTimeout(function(){a.writeRawInput("8E5"+e)},z||333),!0):!1};this.sendKeyboardSynchronize=function(e,z,E){var H=0;E&&(H|=4);z&&(H|=2);e&&(H|=1);this.sendKeyboardSyncFlags(H)};this.fromSyncedSurface=function(e){return b.fromSyncedSurface(e)};this.setWorkDir=function(e){a.writeKeyComb("Windows+R",20,function(){setTimeout(function(){a.writeText(e,10,function(){a.writeScancode(!0,28);a.writeScancode(!1,
28)})},666)})};this.authWithCode=function(e,z){a.authWithCode(e,z)};this.getPrinters=function(e){a.getPrinters(e)};this.attachPrinter=function(e){a.attachPrinter(e)}}(l,I,Q,tc);this.sendKeyboardSynchronize=function(a,b,c){ta.sendKeyboardSynchronize(a,b,c)};this.VirtualChannel=function(){return new Db(143)};this.GatewayChannel=function(){return new Db(28)};this.DynamicChannel=function(){return new Db(64)};this.addChannel=function(a){Ua[a.name]=a};this.addGatewayChannel=function(a){Va[a.name]=a};this.addDynamicChannel=
function(a){ca.names.push(a.name);ca[a.name]=a;ca.count++};var ua=null,ca={count:0,names:[],usbChannel:null,close:function(){for(var a=ca.names,b=0,c=a.length;b<c;b++)ca[a[b]].onclose&&(ca[a[b]].onclose(),ca[a[b]]=null);a.length=0;ca.usbChannel=null},init:function(a,b,c,k,d,n){function e(){this.WAVE_FORMAT_PCM=1;this.WAVE_FORMAT_ADPCM=2;this.WAVE_FORMAT_ALAW=6;this.WAVE_FORMAT_MULAW=7;this.WAVE_FORMAT_GSM=49;this.WAVE_FORMAT_MPEGLAYER3=85;this.WAVE_FORMAT_AAC=41222;this.cbSize=this.bitsPerSample=
this.nBlockAlign=this.nAvgBytesPerSec=this.nSamplesPerSec=this.nChannels=this.formatTag=0;this.extenstion=null;var u=this;this.fromBuffer=function(p,A){u.formatTag=p.getLittleEndian16();u.nChannels=p.getLittleEndian16();u.nSamplesPerSec=p.getLittleEndian32();u.nAvgBytesPerSec=p.getLittleEndian32();u.nBlockAlign=p.getLittleEndian16();u.bitsPerSample=p.getLittleEndian16();var r=p.getLittleEndian16();u.cbSize=r;0<r&&!0!==A&&(u.extenstion=Array(r),p.copyToByteArray(u.extenstion,0,p.getPosition(),r),p.skipPosition(r))};
this.toBuffer=function(p){p.setLittleEndian16(u.formatTag);p.setLittleEndian16(u.nChannels);p.setLittleEndian32(u.nSamplesPerSec);p.setLittleEndian32(u.nAvgBytesPerSec);p.setLittleEndian16(u.nBlockAlign);p.setLittleEndian16(u.bitsPerSample);p.setLittleEndian16(u.cbSize);0<u.cbSize&&p.setBytes(u.extenstion)};this.getSize=function(){return 18+u.cbSize};this.toString=function(){return"Audio Format, tag="+u.formatTag+" nChannels="+u.nChannels+" nSamplesPerSec="+u.nSamplesPerSec+" nAvgBytesPerSec="+u.nAvgBytesPerSec+
" nBlockAlign="+u.nBlockAlign+" bitsPerSample="+u.bitsPerSample+" cbSize="+u.cbSize}}function z(){ua=new l.DynamicChannel;ua.name="Microsoft::Windows::RDS::DisplayControl";ua.enabled=!1;ua.process=function(u){var p=u.getLittleEndian32();u.getLittleEndian32();switch(p){case 5:p=u.getLittleEndian32(),ua.maxMonitorAreaFactorA=u.getLittleEndian32(),ua.maxMonitorAreaFactorB=u.getLittleEndian32(),ua.enabled=!0,svGlobal.logger.warn("Display control maxNumMonitors:"+p+" factorA:"+ua.maxMonitorAreaFactorA+
" factorB:"+ua.maxMonitorAreaFactorB),u=new Uint8Array(2),u[0]=146,u[1]=4,V(u.buffer),sa&&setTimeout(function(){sa&&sa.check(5E3)},1900)}};ua.applyResolution=function(u,p){if(ua.enabled){var A=new Uint8Array(56),r=new RdpBuffer(A,0,56);u=u>ua.maxMonitorAreaFactorA?ua.maxMonitorAreaFactorA:u&-4;p=p>ua.maxMonitorAreaFactorB?ua.maxMonitorAreaFactorB:p&-4;r.setLittleEndian32(2);r.setLittleEndian32(56);r.setLittleEndian32(40);r.setLittleEndian32(1);r.setLittleEndian32(1);r.setLittleEndian32(0);r.setLittleEndian32(0);
r.setLittleEndian32(u);r.setLittleEndian32(p);r.setLittleEndian32(.26458*u|0);r.setLittleEndian32(.26458*p|0);r.setLittleEndian32(u>p?0:90);r.setLittleEndian32(100);r.setLittleEndian32(100);ua.send(A);svGlobal.logger.warn("Display control: "+u+"x"+p)}else svGlobal.logger.warn("Display control disabled.")};return ua}if(!K.disableDVC){if(K.enableEcho){var E=new l.DynamicChannel;E.name="ECHO";E.process=function(u){var p=u.getPosition(),A=u.getEnd(),r=new Uint8Array(A-p);r.set(u.getData().subarray(p,
A));E.send(r)};l.addDynamicChannel(E)}if(a){var H=new l.DynamicChannel;H.name="Microsoft::Windows::RDS::Input";H.process=function(u){var p=u.getLittleEndian16();u.getLittleEndian32();switch(p){case 1:u.skipPosition(4),u=new RdpBuffer(new Uint8Array(16),0,16),u.setLittleEndian16(2),u.setLittleEndian32(16),u.setLittleEndian32(3),u.setLittleEndian32(65536),u.setLittleEndian16(256),u.markEnd(),H.send(u);case 5:I.execute("setTouchRemoting",[!0]);ca.isTouchReady=!0;svGlobal.logger.info("Touch remoting start");
break;case 4:I.execute("setTouchRemoting",[!1]),ca.isTouchReady=!1,svGlobal.logger.info("Touch remoting suspend")}};l.addDynamicChannel(H)}if(c){svGlobal.logger.warn("Audio input on");var O=new l.DynamicChannel;(function(){function u(S){var Z=new RdpBuffer(new Uint8Array(5),0,5);Z.setByte(7);Z.setLittleEndian32(S);Z.markEnd();O.send(Z)}function p(S){var Z=S.getLittleEndian32(),Ca=S.getLittleEndian32(),va=new e;va.fromBuffer(S,!0);var Ba=0,Qa=0;0<va.cbSize&&(22==va.cbSize?(Ba=S.getLittleEndian16(),
Qa=S.getLittleEndian32(),S.skipPosition(16)):(svGlobal.logger.warn("Wrong cbsize: "+va.cbSize),S.skipPosition(va.cbSize)));S=r[Ca];svGlobal.logger.info("Selceted rec fmt, framesPerPacket: "+Z+" initial: "+Ca+", "+S.toString());svGlobal.logger.info("Open fmt: "+va.toString()+" validBits:"+Ba+" mask:"+Qa);G=!0;N=l.reconnectOnResize;l.reconnectOnResize=!1;ha.onopen||(ha.onopen=function(xa){if(ia){A=xa;l.reconnectOnResize=N;u(Ca);var ya=new RdpBuffer(new Uint8Array(5),0,5);ya.setByte(4);ya.setLittleEndian32(xa?
0:1);ya.markEnd();O.send(ya)}});ha.ondata||(ha.ondata=function(xa,ya){A&&(P.length!=ya+1&&(P=new Uint8Array(ya+1),P[0]=6),O.send(J),P.set(xa,1),O.send(P))});ha.start(S,Z)}O.name="AUDIO_INPUT";O.process=function(S){var Z=S.getByte();switch(Z){case 1:S=S.getLittleEndian32();Z=new RdpBuffer(new Uint8Array(5),0,5);Z.setByte(1);Z.setLittleEndian32(S);Z.markEnd();O.send(Z);break;case 2:var Ca=S.getLittleEndian32();S.getLittleEndian32();var va=pa.getContext().sampleRate;for(Z=r.length=0;Z<Ca;Z++){var Ba=
new e;Ba.fromBuffer(S);svGlobal.logger.info("Server rec fmt "+Z+":"+Ba.toString());0==k&&49==Ba.formatTag&&22050==Ba.nSamplesPerSec?r.push(Ba):1==Ba.formatTag&&Ba.nSamplesPerSec<=va&&r.push(Ba)}O.send(J);Ca=0;S=r.length;for(Z=0;Z<S;Z++)Ca+=r[Z].getSize();va=new RdpBuffer(new Uint8Array(1024),0,1024);va.setByte(2);va.setLittleEndian32(S);va.setLittleEndian32(Ca+9);for(Z=0;Z<S;Z++)r[Z].toBuffer(va),svGlobal.logger.info("Client rec fmt: "+r[Z].toString());va.skipPosition(1024-Ca-9);va.markEnd();O.send(va);
break;case 3:p(S);break;case 7:Z=S.getLittleEndian32();svGlobal.logger.info("Rec fmt change, "+r[Z].toString()+" by client:"+G);G||(u(Z),G=!1);break;default:svGlobal.logger.warn("audioInput: invalid tag:"+Z)}};var A=!1,r=[];O.onclose=function(){A=!1;ha&&ha.close()};var J=new Uint8Array(1);J[0]=5;var G=!1,N=l.reconnectOnResize,P=new Uint8Array(0),da=Sb("audiorecorder",hi5.libMin?"audiorecorder_min.js?v=0":"audiorecorder.js?v=0"),ha=window.AudioWorkletNode?new hi5.audio.WorkletRecorder(pa.getContext(),
da):new hi5.audio.Recorder(pa.getContext())})();l.addDynamicChannel(O)}l.addDynamicChannel(function(){var u=new l.DynamicChannel;u.name="TSMF";var p={type:"image/jpeg"},A=Array(1);u.process=function(r){r.getPosition();var J=r.getLittleEndian32()&1073741823;var G=r.getLittleEndian32();var N=r.getLittleEndian32();switch(J){case 2:if(256==N){r.getLittleEndian32();N=new Uint8Array(16);var P=new RdpBuffer(N,0,16);P.setLittleEndian32(2);P.setLittleEndian32(G);P.setLittleEndian32(1);P.setLittleEndian32(0);
u.send(N)}break;case 0:switch(N){case 257:r.getBytes(16);r.getLittleEndian32();break;case 256:J=r.getPosition();P=r.getLittleEndian32();for(N=0;N<P;N++){r.getLittleEndian32();var da=r.getLittleEndian32();r.getLittleEndian32();r.skipPosition(da-4)}N=r.getPosition()-J;P=N+8+4;N=new Uint8Array(P);P=new RdpBuffer(N,0,P);P.setLittleEndian32(-2147483648);P.setLittleEndian32(G);N.set(r.getData().subarray(J,r.getPosition()),8);u.send(N);break;case 261:r.getBytes(16);r.getLittleEndian32();break;case 264:J=
r.getLittleEndian32();r.skipPosition(4);r.getLittleEndian32();da=r.getBytes(16);var ha=r.getBytes(16);r.getLittleEndian32();r.getLittleEndian32();r.getLittleEndian32();var S=r.getBytes(16);N=r.getLittleEndian32();r.skipPosition(N);N=new Uint8Array(20);P=new RdpBuffer(N,0,20);P.setLittleEndian32(-2147483648);P.setLittleEndian32(G);hi5.Arrays.equals([118,105,100,115,0,0,16,0,128,0,0,170,0,56,155,113],da)&&hi5.Arrays.equals([77,74,80,71,0,0,16,0,128,0,0,170,0,56,155,113],ha)&&hi5.Arrays.equals([128,
159,88,5,86,195,206,17,191,1,0,170,0,85,89,90],S)?P.setLittleEndian32(1):(P.setLittleEndian32(0),svGlobal.logger.warn("Format is not supported:"),svGlobal.logger.warn(da),svGlobal.logger.warn(ha),svGlobal.logger.warn(S));P.setLittleEndian32(J);u.send(N);break;case 258:r.getBytes(16);r.getLittleEndian32();J=r.getLittleEndian32();r.skipPosition(J);break;case 263:r.getBytes(16),N=new Uint8Array(16),P=new RdpBuffer(N,0,16),P.setLittleEndian32(-2147483648),P.setLittleEndian32(G),P.setLittleEndian32(1),
u.send(N);case 277:r.getBytes(16);r.getLittleEndian32();break;case 262:r.getBytes(16);Q.flushImgs();Q.setImgRect(0,0,0,0);N=new Uint8Array(12);P=new RdpBuffer(N,0,12);P.setLittleEndian32(-2147483648);P.setLittleEndian32(G);u.send(N);break;case 278:r.getBytes(16);G=r.getLittleEndian32();N=r.getLittleEndian32();J=r.getLittleEndian32();r=r.getLittleEndian32();Q.setImgRect(G,N,J-G,r-N);break;case 265:r.getBytes(16);r.getLittleEndian64();r.getLittleEndian32();break;case 266:r.getBytes(16);break;case 268:r.getBytes(16);
break;case 267:r.getBytes(16);break;case 269:r.getBytes(16);r.getLittleEndian32();break;case 274:break;case 275:break;case 259:r.getBytes(16);r.getLittleEndian32();r.getLittleEndian32();r.skipPosition(32);N=r.getLittleEndian32();G=new Image;J=r.getPosition();A[0]=r.getData().subarray(J,J+N);r=new Blob(A,p);G.src=URL.createObjectURL(r);Q.addImg(G);break;case 270:Q.flushImgs();break;case 273:break;case 260:break;case 276:r.getBytes(16);N=r.getLittleEndian32();J=r.getPosition()+N;r.skipPosition(8);G=
r.getLittleEndian32();svGlobal.logger.info("window state:"+G);P=r.getLittleEndian32();da=r.getLittleEndian32();G=r.getLittleEndian32();N=r.getLittleEndian32();r.skipPosition(8);ha=r.getLittleEndian32();S=r.getLittleEndian32();svGlobal.logger.info("Window rect, left:"+G+" top:"+N+" w:"+P+" h:"+da+" cl:"+ha+" ct:"+S);r.setPosition(J);J=r.getLittleEndian32();for(J=r.getPosition()+J;r.getPosition()<J;){ha=r.getLittleEndian32();S=r.getLittleEndian32();var Z=r.getLittleEndian32(),Ca=r.getLittleEndian32();
svGlobal.logger.info("visible region, l:"+S+" t:"+ha+" r:"+Ca+" b:"+Z)}Q.setImgRect(G,N,P,da);break;case 1:case 2:break;default:svGlobal.logger.warn("unknown function:"+N)}break;default:svGlobal.logger.warn("unkown interface:"+J)}};return u}());Pa||l.addDynamicChannel(z());K.enableDVCAudio&&l.addDynamicChannel(function(u){var p=!1,A=0,r=0,J=0,G=0,N=[],P=new Uint8Array(4),da=new l.DynamicChannel;da.name="AUDIO_PLAYBACK_DVC";da.onclose=function(){};da.process=function(ha){function S(R){R.skipPosition(14);
var Y=R.getLittleEndian16();R.getByte();var ma=R.getLittleEndian16();R.skipPosition(1);for(var Ja,Ea=N.length=0;Ea<Y;Ea++){var Ha=new e;Ha.fromBuffer(R);(Ja=22050<=Ha.nSamplesPerSec&&(1==Ha.formatTag||49==Ha.formatTag&&22050==Ha.nSamplesPerSec&&0==u))&&N.push(Ha)}Ha=20;R=N.length;for(Ea=0;Ea<R;Ea++)Ha+=N[Ea].getSize();Ea=Ha+4;Y=new RdpBuffer(new Uint8Array(Ea),0,Ea);Y.setByte(7);Y.setByte(2);Y.setLittleEndian16(Ha);Y.setLittleEndian32(3);Y.setLittleEndian32(4294967295);Y.setLittleEndian32(0);Y.setLittleEndian16(0);
Y.setLittleEndian16(R);Y.skipPosition(1);Y.setLittleEndian16(ma);Y.setByte(124);for(Ea=0;Ea<R;Ea++)Ha=N[Ea],Ha.toBuffer(Y);Y.markEnd();da.send(Y);5<ma&&(Y=new RdpBuffer(new Uint8Array(8),0,8),Y.setByte(12),Y.skipPosition(1),Y.setLittleEndian16(4),Y.setLittleEndian16(0),Y.setLittleEndian16(0),Y.markEnd(),da.send(Y))}function Z(R){var Y=R.getLittleEndian16();R=R.getLittleEndian16();var ma=new RdpBuffer(new Uint8Array(8),0,8);ma.setByte(6);ma.setByte(35);ma.setLittleEndian16(4);ma.setLittleEndian16(Y);
ma.setLittleEndian16(R);ma.markEnd();da.send(ma)}function Ca(){var R=N[J];if(R.formatTag!=X||R.nSamplesPerSec!=Oa||ra!=R.nChannels)X=R.formatTag,ra=R.nChannels,Oa=R.nSamplesPerSec,Wa=49==R.formatTag?8:R.bitsPerSample}function va(R){r=R.getLittleEndian16();J=R.getLittleEndian16();G=R.getByte();R.skipPosition(3);P[0]=R.getByte();P[1]=R.getByte();P[2]=R.getByte();P[3]=R.getByte();p=!0;Ca()}function Ba(R,Y){var ma=new RdpBuffer(new Uint8Array(8),0,8);ma.setByte(5);ma.skipPosition(1);ma.setLittleEndian16(4);
ma.setLittleEndian16(R);ma.setByte(Y);ma.skipPosition(1);ma.markEnd();da.send(ma)}function Qa(R){p=!1;var Y=A-8,ma=Date.now();R.copyFromByteArray(P,0,R.getPosition(),4);R=Pb(R,G,r,Y);R=1E3*(R-pa.delay);ma=r+(Date.now()-ma)+R;Ba(ma,G)}function xa(R){var Y=Date.now();r=R.getLittleEndian16();J=R.getLittleEndian16();G=R.getByte();R.skipPosition(7);Ca();R=Pb(R,G,r,0);R=1E3*(R-pa.delay);Y=r+(Date.now()-Y)+R;Ba(Y,G)}if(p)Qa(ha);else{var ya=ha.getByte();ha.skipPosition(1);A=ha.getLittleEndian16();switch(ya){case 7:S(ha);
break;case 6:Z(ha);break;case 2:va(ha);break;case 1:closed=!0;break;case 3:ha.getLittleEndian16();ha.getLittleEndian16();break;case 13:xa(ha)}}};return da}(k));svGlobal.DCVC_EXTENSION||(svGlobal.DCVC_EXTENSION={});var y=svGlobal.DCVC_EXTENSION;y.videoMedia={video:null,track:null,canvas:null,ctx:null,resolutions:null,minFrameRate:16,type:2,activate:function(u,p){svGlobal.logger.info("activate webcam");y.videoMedia.resolutions?u():hi5.video.resolutions(function(A){A.length?(y.videoMedia.resolutions=
A,u()):p()})},deactivate:function(){var u=y.videoMedia;u.track&&(u.track.stop(),u.track=null);u.ctx=null;u.canvas=null;u.video=null;svGlobal.logger.info("deactivate cam")},startStream:function(u,p,A,r,J){svGlobal.logger.info("startStream, width:"+u+" height:"+p+" frameRate:"+A);var G=y.videoMedia,N=G.track;if(N){var P=N.getSettings();if("live"==N.readyState)if(u!=P.width||p!=P.height||A!=P.frameRate&&2!=G.type)N.stop();else return}navigator.mediaDevices.getUserMedia({video:{frameRate:2==G.type?G.minFrameRate:
A,width:{exact:u},height:{exact:p}}}).then(function(da){var ha=document.createElement("video");ha.srcObject=da;ha.play();if(window.OffscreenCanvas)var S=new OffscreenCanvas(100,100);else S=document.createElement("canvas"),S.style.position="absolute",S.style.left=0,S.style.top=0;G.track=da.getVideoTracks()[0];G.canvas=S;G.ctx=S.getContext("2d");G.video=ha;da=G.track.getSettings();G.canvas.width=da.width;G.canvas.height=da.height;r()}).catch(function(da){svGlobal.logger.warn(da);J()})},stopStream:function(){svGlobal.logger.info("stopStream");
var u=y.videoMedia;u.track&&"live"==u.track.readyState&&u.track.stop()},grabFrame:function(u){function p(r){r.arrayBuffer().then(u)}var A=y.videoMedia;A.ctx.drawImage(A.video,0,0);A=A.canvas;A.convertToBlob?A.convertToBlob({type:"image/jpeg",quality:.6}).then(p):A.toBlob(p,"image/jpeg",.6)},propertyList:[[{propertyId:1,capabilities:3,min:4294967286,max:4294967294,step:1,default:4294967291},null,{propertyId:3,capabilities:101,min:4294967280,max:16,step:1,default:0},{propertyId:4,capabilities:1,min:0,
max:3,step:1,default:0},{propertyId:5,capabilities:1,min:4294967280,max:16,step:1,default:0},{propertyId:6,capabilities:1,min:100,max:400,step:10,default:100}],[{propertyId:1,capabilities:1,min:0,max:2,step:1,default:1},{propertyId:2,capabilities:199,min:4294967232,max:64,step:1,default:0},{propertyId:3,capabilities:1,min:0,max:95,step:1,default:0},{propertyId:4,capabilities:1,min:4294965296,max:2E3,step:1,default:0},{propertyId:5,capabilities:67,min:2800,max:6500,step:1,default:4600}]]};y.WEBCAM=
function(u){var p=new u;p.name="RDCamera_Device_0";p.version=2;p.newInstance=function(){return y.WEBCAM(u)};p.onopen=function(){svGlobal.logger.info("cam open")};p.onclose=function(){svGlobal.logger.info("cam close")};p.sendSucess=function(){var A=new hi5.DataBuffer(new Uint8Array(2));A.setByte(p.version);A.setByte(1);A.markEnd();p.send(A)};p.sendError=function(A){var r=new hi5.DataBuffer(new Uint8Array(6));r.setByte(p.version);r.setByte(2);r.setLittleEndian32(A||1);r.markEnd();p.send(r)};p.sendSteamListResp=
function(){var A=new hi5.DataBuffer(new Uint8Array(7));A.setByte(p.version);A.setByte(10);A.setLittleEndian16(1);A.setByte(1);A.setByte(1);A.setByte(0);A.markEnd();p.send(A)};p.sendMediaTypeListResp=function(A){var r=y.videoMedia.resolutions,J=r.length,G=new hi5.DataBuffer(new Uint8Array(2+26*J));G.setByte(p.version);G.setByte(12);for(var N=1==A,P=0;P<J;P++){G.setByte(A);var da=r[P];G.setLittleEndian32(da.width);G.setLittleEndian32(da.height);G.setLittleEndian32(N?da.frameRate:y.videoMedia.minFrameRate);
G.setLittleEndian32(1);G.setLittleEndian32(1);G.setLittleEndian32(1);G.setByte(1)}G.markEnd();p.send(G)};p.sendCurrentMediaType=function(A,r){var J=new hi5.DataBuffer(new Uint8Array(28));J.setByte(p.version);J.setByte(14);r=y.videoMedia.resolutions[r];J.setByte(A);J.setLittleEndian32(r.width);J.setLittleEndian32(r.height);J.setLittleEndian32(1==A?r.frameRate:y.videoMedia.minFrameRate);J.setLittleEndian32(1);J.setLittleEndian32(1);J.setLittleEndian32(1);J.setByte(1);J.markEnd();p.send(J)};p.sendSampleResp=
function(A){y.videoMedia.grabFrame(function(r){var J=new hi5.DataBuffer(new Uint8Array(r.byteLength+3));J.setByte(p.version);J.setByte(18);J.setByte(A);J.setBytes(new Uint8Array(r));J.markEnd();p.send(J)})};p.sendPropertyListResp=function(){for(var A=0,r,J,G=y.videoMedia.propertyList,N=0;2>N;N++){J=G[N];r=J.length;for(var P=0;P<r;P++)null!=J[P]&&A++}A=new hi5.DataBuffer(new Uint8Array(2+19*A));A.setByte(p.version);A.setByte(21);for(N=0;2>N;N++)for(J=G[N],r=J.length,P=0;P<r;P++)null!=J[P]&&(A.setByte(N),
A.setByte(J.propertyId),A.setByte(J.capabilities),A.setLittleEndian32(J.min),A.setLittleEndian32(J.max),A.setLittleEndian32(J.step),A.setLittleEndian32(J.default));A.markEnd();p.send(A)};p.sendPropertyValueResp=function(A,r){(A=y.videoMedia.propertyList[A][r-1])?(r=new hi5.DataBuffer(new Uint8Array(7)),r.setByte(p.version),r.setByte(23),r.setByte(1),r.setLittleEndian32(A.value||A.default),r.markEnd(),p.send(r)):p.sendError(8)};p.process=function(A){A.getByte();var r=A.getByte();switch(r){case 7:y.videoMedia.activate(p.sendSucess,
p.sendError);break;case 8:y.videoMedia.deactivate();p.sendSucess();break;case 9:p.sendSteamListResp();break;case 11:A=A.getByte();0!=A&&svGlobal.logger.warn("Invalid stream index: "+A);p.sendMediaTypeListResp(y.videoMedia.type);break;case 13:A=A.getByte();p.sendCurrentMediaType(y.videoMedia.type,A);break;case 15:A.getByte();r=A.getByte();if(r!=y.videoMedia.type){svGlobal.warn("Invalid video format req:"+r);p.sendError(6);break}r=A.getLittleEndian32();var J=A.getLittleEndian32();A=A.getLittleEndian32()/
A.getLittleEndian32();y.videoMedia.startStream(r,J,A,p.sendSucess,p.sendError);break;case 16:y.videoMedia.stopStream();p.sendSucess();break;case 17:A=A.getByte();0!=A&&svGlobal.log("Invalid stream index for SampleRequest: "+A);p.sendSampleResp(A);break;case 20:p.sendPropertyListResp();break;case 22:r=A.getByte();A=A.getByte();p.sendPropertyValueResp(r,A);break;case 24:p.sendError(10);break;default:p.sendError(10),svGlobal.logger.warn("Invalid cam msg: "+r)}};return p};y.WEBCAM_ENUM=function(u,p){var A=
new u;A.name="RDCamera_Device_Enumerator";A.onopen=function(){var r=new hi5.DataBuffer(new Uint8Array(2));r.setByte(p.version);r.setByte(3);r.markEnd();A.send(r);svGlobal.logger.info("camEnum open")};A.onclose=function(){svGlobal.logger.info("camEnum closed");y.videoMedia.deactivate()};A.addDevice=function(r){r+="\x00";var J=p.name+"\x00",G=new hi5.DataBuffer(new Uint8Array(2+2*r.length+J.length));G.setByte(p.version);G.setByte(5);G.setUnicodeString(r);G.setAscllString(J);G.markEnd();A.send(G)};A.process=
function(r){var J=r.getByte();r=r.getByte();switch(r){case 4:svGlobal.logger.info("camEnum ver resp: "+J);p.version=J;A.addDevice(hi5.video.webcam&&hi5.video.webcam.label||"Web Camera");break;default:svGlobal.logger.warn("invalid messageId on camEnum: "+r)}};return A};d&&(a=y.WEBCAM(l.DynamicChannel),b=y.WEBCAM_ENUM(l.DynamicChannel,a),l.addDynamicChannel(b),l.addDynamicChannel(a));n&&(svGlobal.logger.info("Mapping USB..."),l.addDynamicChannel(ca.usbChannel))}}},Ma=null;svGlobal.DCVC_EXTENSION&&!Pa&&
(l.hasUSB()&&svGlobal.DCVC_EXTENSION.WEBUSB&&(ca.usbChannel=svGlobal.DCVC_EXTENSION.WEBUSB(l.DynamicChannel)),svGlobal.DCVC_EXTENSION.DRIVE&&(Ma=svGlobal.DCVC_EXTENSION.DRIVE(l.GatewayChannel),l.addGatewayChannel(Ma)));this.getPrinters=function(a){if(!l.onagentmessage||!Ma)return null;var b=new hi5.DataBuffer(new Uint8Array(2));b.setByte(6);b.setByte(1);b.markEnd();l.onagentmessage(b.getData());Ma.listCallback=a};this.attachPrinter=function(a){Ma&&Ma.attachPrinter(a,l)};this.showError=mb;this.resetStatus=
Fb;this.exeAppCmd=function(a){var b=I.getFocused();b&&b.exeCommand(a)};this.activateApp=function(a){var b;(b=hi5.tool.isNumber(a)?I.getWinById(a):I.getMainWinByAppId(a))?b.activate(1):svGlobal.logger.warn("No window found in "+a)};this.reconnect=function(a,b,c){void 0==c&&(c=K.forceReconnect||!1);if(!ia&&!c)return!1;C.minWidth&&a<C.minWidth&&(a<C.minWidth&&svGlobal.logger.warn("Width "+a+" is samller than minWidth "+C.minWidth),a=C.minWidth);C.minHeight&&b<C.minHeight&&(b<C.minHeight&&svGlobal.logger.warn("Height "+
b+" is samller than minHeight "+C.minHeight),b=C.minHeight);a&=-4;b&=-4;if(!c&&4>Math.abs(a-ka)&&4>Math.abs(b-la))return!1;if(ua&&ua.enabled&&!1!==K.displayVC)ua.applyResolution(a,b);else if(Qb&&ab||c||Ga&&!Qb)ab=!1,svGlobal.logger.info("reconnecting..."),V("8E0"+a+"\t"+b),ta&&(ta.remoteLockFlags=0,ta.checkLockFlags=!0);return!0};this.notify=function(a,b){a="8E6"+a;b&&(a+="\t"+b.join(";"));V(a)};this.getUploadManager=function(){return oa};this.addSurface=function(a){if(!I.hasSurface(a)&&(qb||Q.setContext(a.context),
!I.hasSurface(a)||!a.railWin)){Pa&&a.setPlayerMode();C.mouseMoveEmu&&(a.mouseMoveEmu=ba(C.mouseMoveEmu));a.setSize(50,50,"hidden");var b=a.getFreeSpace();0==ka&&(ka=b.width);0==la&&(la=b.height);a.setConfig(K);I.addSurface(a);$a(ka,la,!0,C.monitorDef?!0:!1);a.setController(ta);a.setTouchpad(ba(C.touchpad));var c=b=ba(C.mapClipboard),k=b;void 0!=C.copyToLocal?c=ba(C.copyToLocal):void 0!=K.copyToLocal&&(c=K.copyToLocal);void 0!=C.copyToRemote?k=ba(C.copyToRemote):void 0!=K.copyToRemote&&(k=K.copyToRemote);
a.setClipboard(b,c,k);pb&&Gb(a);C.invitation&&!ba(C.control)&&(I.setReadOnly(!0),b=hi5.$("requestControl"))&&(b.disabled=!1);b=void 0!=C.ctrlToWin?ba(C.ctrlToWin):void 0!=K.ctrlToWin?K.ctrlToWin:!0;c=void 0!=C.cmdToCtrl?ba(C.cmdToCtrl):void 0!=K.cmdToCtrl?K.cmdToCtrl:!0;a.run(parseInt(C.keyboard||1033,10),b,!!K.noKeyStuck,c)}};this.getRunninApps=this.getRunningApps=function(){for(var a=[],b=0,c=I.size();b<c;b++)I.getSurface(b).railWin.getMain(I.zOrders)&&a.push(I.getSurface(b).railWin.getMain(I.zOrders).titleInfo);
return a};this.startApp=function(a,b,c){b=b||"";c=c||"";V("8C2"+a+"\t"+b+"\t"+c);var k=I.getSurface(I.size()-1);k&&(k.remoteApp=new Vb(a,b,c))};this.startExitingApp=function(a){a=I.popWins(a);for(var b=a.length-1;0<=b;b--)I.addWin(a[b])};var eb=new l.DynamicChannel;eb.name="PNPDR";eb.onopen=function(){console.log("==== PNPDR DVC onopen()")};eb.process=function(a){var b=a.getLittleEndian32(),c=a.getLittleEndian32();console.log("==== PNPDR DVC process() size="+b+", packetId="+c);switch(c){case 101:b=
a.getLittleEndian32();var k=a.getLittleEndian32();a=a.getLittleEndian32();console.log("==== PNPDR DVC server version: "+b+"/"+k+", capabilities: "+a);a=new RdpBuffer(new Uint8Array(20),0,20);a.setLittleEndian32(20);a.setLittleEndian32(c);a.setLittleEndian32(1);a.setLittleEndian32(5);a.setLittleEndian32(1);eb.send(a);break;case 103:console.log("==== PNPDR DVC Client Authenticated for PNP messages")}};eb.onclose=function(){console.log("==== PNPDR DVC onclose()")};l.addDynamicChannel(eb);var Sa=null;
ba(C.scanner)&&(Sa=new l.DynamicChannel,Sa.name="SCANNERDVC",Sa.onopen=function(){console.log("==== scanner DVC onopen().")},Sa.process=function(a){var b=a.getByte();console.log("==== scanner DVC process(), type="+b);switch(b){case 0:var c=a.getByte(),k=a.getByte();b=new Uint8Array(10);b[0]=4;b[1]=7;b[2]=c;b[3]=k;b.set(a.getBytes(2),4);b.set(a.getBytes(2),6);b.set(a.getBytes(2),8);if(l.onagentmessage)l.onagentmessage(b);break;case 1:break;case 2:c=a.getEnd()-a.getPosition();b=new Uint8Array(c+2);
b[0]=4;b[1]=3;b.set(a.getBytes(c),2);if(l.onagentmessage)l.onagentmessage(b);break;case 3:c=a.getEnd()-a.getPosition();b=new Uint8Array(c+3);b[0]=4;b[1]=9;b[2]=0;b.set(a.getBytes(c),3);if(l.onagentmessage)l.onagentmessage(b);break;default:console.log('Warning: Unknown type "'+b+'" received from DVC, ignored.')}},Sa.onclose=function(){var a=new Uint8Array(2);a[0]=4;a[1]=4;if(l.onagentmessage)l.onagentmessage(a)},l.addDynamicChannel(Sa));var Ya=null;l.hasSmartCard()&&(Ya=new l.GatewayChannel,Ya.name=
"SCARDSTB",Ya.onopen=function(){var a=new Uint8Array(2);a[0]=3;a[1]=1;if(l.onagentmessage)l.onagentmessage(a);ba(C.passwordIsPin)&&l.onagentmessage&&!hi5.browser.isMacOS&&hi5.notifications.notify({msg:__svi18n.info.scardAuth||"Smart card authentication in progress. Please wait...",type:0,timeout:1E4})},Ya.process=function(a){var b=a.getEnd()-a.getPosition(),c=new Uint8Array(b+2);c[0]=3;c[1]=3;c.set(a.getBytes(b),2);if(l.onagentmessage)l.onagentmessage(c)},Ya.onclose=function(){var a=new Uint8Array(2);
a[0]=3;a[1]=4;if(l.onagentmessage)l.onagentmessage(a)},l.addGatewayChannel(Ya));K.detectNetwork&&(D+="&connectType=7",xc());this.getNetworkResult=function(){return nb};this.getAgentLink=function(){var a=navigator.userAgentData?navigator.userAgentData.platform:navigator.platform||navigator.appVersion;return-1!=a.indexOf("Win")?"agent_setup.exe":-1!=a.indexOf("macOS")||-1!=a.indexOf("Mac")?"agent_setup.pkg":""};this.writeAgent=function(a){a.byteLength&&(a=new Uint8Array(a));switch(a[0]){case 3:if(Ya&&
3==a[1]){var b=a.slice?new hi5.DataBuffer(a.slice(2,a.length)):new hi5.DataBuffer(a.subarray(2,a.length));Ya.send(b)}break;case 4:if(Sa)switch(a[1]){case 2:b=a.slice?new hi5.DataBuffer(a.slice(2,a.length)):new hi5.DataBuffer(a.subarray(2,a.length));var c=document.getElementById("dsSelection");c||(c=document.createElement("div"),c.id="dsSelection",c.className="appdlg",document.body.appendChild(c));if(0!=b.getLittleEndian16())c&&(c.innerHTML="<p>Error on local: failed to get the list of connected scanners. Close to continue without scanning.</p>",
b=new hi5.ui.Lightbox(c),b.onclose=function(){l.run()},b.show());else{var k=(a.byteLength-4)/41;if(0==k)c&&(c.innerHTML="<p>Error: Could not find any connected scanner. Please:<ul><li>Power on or connect the scanner and then refresh the page; or</li><li>Close this dialog to connect to the machine without using scanner.</li></ul></p>",b=new hi5.ui.Lightbox(c),b.onclose=function(){l.run()},b.show());else if(1==k){if(b=new Uint8Array(3),b[0]=4,b[1]=5,b[2]=0,l.onagentmessage)l.onagentmessage(b)}else if(c){c.innerHTML=
'<p> Please choose a scanner &lt;DriverType: DeviceName&gt; and click "Continue".</a></p>';for(a=0;a<k;a++){var d=b.getAscllString(41,!0);d=yc(a,d);c.appendChild(d)}c.innerHTML+="<br>";b=new hi5.ui.LightboxWithBtn(c);b.onclose=function(){var e=0,z=document.querySelector('input[name="ds_name"]:checked');z&&(e=z.value);z=new Uint8Array(3);z[0]=4;z[1]=5;z[2]=e;if(l.onagentmessage)l.onagentmessage(z)};b.show()}}break;case 3:case 8:case 10:b=a.slice?new hi5.DataBuffer(a.slice(2,a.length)):new hi5.DataBuffer(a.subarray(2,
a.length));Sa.send(b);break;case 4:b=a.slice?new hi5.DataBuffer(a.slice(2,a.length)):new hi5.DataBuffer(a.subarray(2,a.length));Sa.send(b);hi5.notifications.notify({msg:__svi18n.info.TwainNotSupported,type:2});break;case 6:b=a.slice?new hi5.DataBuffer(a.slice(2,a.length)):new hi5.DataBuffer(a.subarray(2,a.length));b.getLittleEndian16();l.run();break;default:svGlobal.logger.warn("Warning: Unknown response header: [4 / "+a[1]+"], ignored.")}break;case 5:switch(a[1]){case 1:b=a[2]|a[3]<<8,a=a[4]|a[5]<<
8,svGlobal.logger.info("Agent version, major: "+b+" minor: "+a),(c=hi5.appcfg.agent&&hi5.appcfg.agent.version)&&(c.major>b||c.major==b&&c.minor>a)&&(b=__svi18n.info.newVersion||"New versoin available",a=__svi18n.info.updateAgent||"Please download and install the new gateway agent",c=l.getAgentLink(),hi5.notifications.notify({title:b,msg:a+(': <a href="'+c+'">'+c+"</a>")}))}break;case 6:switch(a[1]){case 1:b=new hi5.DataBuffer(a);b.skipPosition(2);c=b.getLittleEndian32();k=[];for(a=0;a<c;a++){var n=
b.getLittleEndian32();d=b.getUnicodeString(n);n=b.getLittleEndian32();n=b.getUnicodeString(n);k.push({name:d,driver:n})}Ma&&Ma.listCallback&&(Ma.listCallback(k),Ma.listCallback=null)}break;case 7:Ma.send(a.subarray(1));break;default:svGlobal.logger.warn("Invalid channel data received: unknown type ["+a[0]+"].")}};var Jb={type:6,data:null};this.setAgentStatus=function(a){nc=a};this.getAgentStatus=function(){return nc};this.run=function(){var a;if(a=null==l.onagentmessage)a=1==l.mode?!1:l.hasSmartCard()||
l.hasScanner()||ba(C.localPrinter);a&&window.startGatewayAgent?startGatewayAgent(l):(l.hasUSB()?I.getFocused().requestUsbDevices(l.getUSB(),function(b){ca.usbChannel.openDevices(b);Hb()}):Hb(),pa.supportWebAudio&&pa.iOSFix())};this.getDesktop=function(){return Q};this.mouseDown=function(a,b,c){Ga&&V("80"+a+"\t"+b+"\t"+c)};this.mouseMove=function(a,b){Ga&&V("82"+a+"\t"+b)};this.mouseUp=function(a,b,c){Ga&&V("81"+a+"\t"+b+"\t"+c)};this.writeKeyCode=function(a,b){Ga&&V("8B"+(a?0:49152)+"\t"+b)};this.writeScancode=
function(a,b){Ga&&("number"==typeof a?(V("840\t"+a),V("8449152\t"+a)):V("84"+(a?0:49152)+"\t"+b))};this.resetSize=function(a,b){l.reconnectOnResize&&(Fa?(Xa&&(clearTimeout(Xa),Xa=0),a&=-4,b&=-4,ua&&ua.enabled&&ua.applyResolution(a,b),Xa=setTimeout(function(){l.writeRawInput("8C661441\t"+a+"\t"+b);mc();svGlobal.logger.info("-- displayChange, h:"+b)},150)):l.running()&&(Xa&&(clearTimeout(Xa),Xa=0),Xa=setTimeout(function(){l.reconnect(a,b)},555)))};var Aa=new RdpBuffer([],0,0);this.suppressOutput=function(a){if(!l.sessionInfo.suppressOutput)return!1;
void 0==a&&(a=!0);var b=new Uint8Array(a?3:11);b[0]=146;b[1]=3;b[2]=a?1:0;a||(b[3]=zb,b[4]=zb>>8,b[5]=yb,b[6]=yb>>8,b[7]=Ab,b[8]=Ab>>8,b[9]=Bb,b[10]=Bb>>8);V(b.buffer);return!0};this.refreshOutput=function(a,b,c,k){var d=new Uint8Array(c?11:3);d[0]=146;d[1]=3;d[2]=2;c&&(d[3]=a,d[4]=a>>8,d[5]=b,d[6]=b>>8,d[7]=c,d[8]=c>>8,d[9]=k,d[10]=k>>8);V(d.buffer)};this.sendPing=function(a){var b=new Uint8Array(a?2+a.length:2);b[0]=146;b[1]=0;a&&b.set(a,2);V(b.buffer)};this.startPing=function(a,b){b=b||0;sa||(sa=
new hi5.tool.ResponseMonitor(function(){Ga&&l.sendPing()},function(){if(Ga&&l.onnoresponse)return l.onnoresponse()}));sa.setInterval(a,b);var c=new Uint8Array(4);c[0]=146;c[1]=2;c[2]=a;c[3]=b;V(c.buffer);setTimeout(function(){sa&&sa.check()},1E3*(a+b));na?na.postMessage({type:0,cmd:6,start:1}):(aa.onSlowPath=aa.onFastPath=cc,aa.onReqHistory=function(){cc(15555)})};this.stopPing=function(){sa&&sa.stop();na?na.postMessage({type:0,cmd:6,start:0}):aa.onSlowPath=aa.onFastPath=aa.onReqHistory=null};var Ia=
null,jc=0;this.play=function(){V("F3")};this.pause=function(){V("F2")};this.scan=function(a){V("F4"+(a?"1":"0"))};this.seek=function(a){var b=I.getFocused();b&&ia&&(V("F4"+(a?"1":"0")+"\t"+(a/b.getScale().x|0)),Q.pause(!0))};var Wa=ra=X=0;var Oa=22050;var ic=!1;this.showMessage=function(a,b,c){l&&l.displayMsg&&a&&((b=b||I.getFocused())?b.showMessage(a,c):("string"==typeof a&&(a={msg:a,timeout:c||0}),hi5.notifications.notify(a)))};this._unload=hb;this.close=function(){svGlobal.logger.info("closing...");
ia&&Fa&&I&&K.closeRemoteApp&&I.tryCloseRemoteApps();Q&&Q.isSendingHistory()?(svGlobal.logger.warn("In the middle of sending history, close delayed"),setTimeout(lc,2222)):lc()};hi5.browser.isChromeApp?chrome.runtime.onSuspend.addListener(l.close):window.addEventListener("unload",l.close,!1)}
Rdp.languageToKeyboard={af:0,sq:0,ar:1025,"ar-SA":1025,"ar-IQ":0,"ar-EG":0,"ar-LY":0,"ar-DZ":0,"ar-MA":0,"ar-TN":0,"ar-OM":0,"ar-YE":0,"ar-SY":0,"ar-JO":0,"ar-LB":0,"ar-KW":0,"ar-AE":0,"ar-BH":0,"ar-QA":0,eu:0,bg:0,be:0,ca:0,zh:2052,"zh-TW":1028,"zh-CN":2052,"zh-HK":1028,"zh-SG":2052,hr:0,cs:0,da:0,nl:1043,"nl-BE":2067,en:1033,"en-US":1033,"en-GB":2057,"en-AU":0,"en-CA":4105,"en-NA":0,"en-IE":0,"en-ZA":0,"en-JM":0,"en-BZ":0,et:0,fo:0,fa:0,fi:0,fr:1036,"fr-BE":2060,"fr-CA":3084,"fr-CH":4108,"fr-LU":0,
gd:0,"gd-IE":0,de:1031,"de-CH":2055,"de-AT":0,"de-LU":0,"de-LI":0,el:0,he:1037,hi:0,hu:0,is:1039,id:0,it:1040,"it-CH":66576,ja:3758162961,ko:3758162962,lv:0,lt:0,mk:0,mt:0,nb:1044,nn:1083,no:1044,pl:1045,pt:2070,"pt-BR":1046,rm:0,ro:0,"ro-MO":0,ru:1049,"ru-MO":0,sr:0,sk:0,sl:0,sb:0,es:1034,"es-AR":0,"es-GT":0,"es-CR":0,"es-PA":0,"es-DO":0,"es-MX":2058,"es-VE":0,"es-CO":0,"es-PE":0,"es-EC":0,"es-CL":0,"es-UY":0,"es-PY":0,"es-BO":0,"es-SV":0,"es-HN":0,"es-NI":0,"es-PR":0,sx:0,sv:1053,"sv-FI":0,th:0,
ts:0,tn:0,tr:1055,uk:0,ur:0,ve:0,vi:0,xh:0,ji:0,zu:0,detect:function(){var D=navigator&&(navigator.language||navigator.userLanguage||""),M=Rdp.languageToKeyboard[D];if(!M){var T=D.indexOf("-");T&&(M=Rdp.languageToKeyboard[D.substring(0,T)])}M||(console.log("No valid layout for "+D),M=1033);return M}};svGlobal.Rdp||(svGlobal.Rdp=Rdp);var RdpBuffer=hi5.DataBuffer;
