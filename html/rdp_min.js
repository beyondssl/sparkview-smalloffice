var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.arrayIteratorImpl=function(p){var G=0;return function(){return G<p.length?{done:!1,value:p[G++]}:{done:!0}}};$jscomp.arrayIterator=function(p){return{next:$jscomp.arrayIteratorImpl(p)}};$jscomp.makeIterator=function(p){var G="undefined"!=typeof Symbol&&Symbol.iterator&&p[Symbol.iterator];return G?G.call(p):$jscomp.arrayIterator(p)};$jscomp.arrayFromIterator=function(p){for(var G,R=[];!(G=p.next()).done;)R.push(G.value);return R};
$jscomp.arrayFromIterable=function(p){return p instanceof Array?p:$jscomp.arrayFromIterator($jscomp.makeIterator(p))};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.SIMPLE_FROUND_POLYFILL=!1;$jscomp.ISOLATE_POLYFILLS=!1;$jscomp.FORCE_POLYFILL_PROMISE=!1;$jscomp.FORCE_POLYFILL_PROMISE_WHEN_NO_UNHANDLED_REJECTION=!1;$jscomp.objectCreate=$jscomp.ASSUME_ES5||"function"==typeof Object.create?Object.create:function(p){var G=function(){};G.prototype=p;return new G};
$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(p,G,R){if(p==Array.prototype||p==Object.prototype)return p;p[G]=R.value;return p};$jscomp.getGlobal=function(p){p=["object"==typeof globalThis&&globalThis,p,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof global&&global];for(var G=0;G<p.length;++G){var R=p[G];if(R&&R.Math==Math)return R}throw Error("Cannot find global object");};$jscomp.global=$jscomp.getGlobal(this);
$jscomp.IS_SYMBOL_NATIVE="function"===typeof Symbol&&"symbol"===typeof Symbol("x");$jscomp.TRUST_ES6_POLYFILLS=!$jscomp.ISOLATE_POLYFILLS||$jscomp.IS_SYMBOL_NATIVE;$jscomp.polyfills={};$jscomp.propertyToPolyfillSymbol={};$jscomp.POLYFILL_PREFIX="$jscp$";var $jscomp$lookupPolyfilledValue=function(p,G){var R=$jscomp.propertyToPolyfillSymbol[G];if(null==R)return p[G];R=p[R];return void 0!==R?R:p[G]};
$jscomp.polyfill=function(p,G,R,ea){G&&($jscomp.ISOLATE_POLYFILLS?$jscomp.polyfillIsolated(p,G,R,ea):$jscomp.polyfillUnisolated(p,G,R,ea))};$jscomp.polyfillUnisolated=function(p,G,R,ea){R=$jscomp.global;p=p.split(".");for(ea=0;ea<p.length-1;ea++){var Q=p[ea];if(!(Q in R))return;R=R[Q]}p=p[p.length-1];ea=R[p];G=G(ea);G!=ea&&null!=G&&$jscomp.defineProperty(R,p,{configurable:!0,writable:!0,value:G})};
$jscomp.polyfillIsolated=function(p,G,R,ea){var Q=p.split(".");p=1===Q.length;ea=Q[0];ea=!p&&ea in $jscomp.polyfills?$jscomp.polyfills:$jscomp.global;for(var sa=0;sa<Q.length-1;sa++){var X=Q[sa];if(!(X in ea))return;ea=ea[X]}Q=Q[Q.length-1];R=$jscomp.IS_SYMBOL_NATIVE&&"es6"===R?ea[Q]:null;G=G(R);null!=G&&(p?$jscomp.defineProperty($jscomp.polyfills,Q,{configurable:!0,writable:!0,value:G}):G!==R&&($jscomp.propertyToPolyfillSymbol[Q]=$jscomp.IS_SYMBOL_NATIVE?$jscomp.global.Symbol(Q):$jscomp.POLYFILL_PREFIX+
Q,Q=$jscomp.propertyToPolyfillSymbol[Q],$jscomp.defineProperty(ea,Q,{configurable:!0,writable:!0,value:G})))};
$jscomp.getConstructImplementation=function(){function p(){function R(){}new R;Reflect.construct(R,[],function(){});return new R instanceof R}if($jscomp.TRUST_ES6_POLYFILLS&&"undefined"!=typeof Reflect&&Reflect.construct){if(p())return Reflect.construct;var G=Reflect.construct;return function(R,ea,Q){R=G(R,ea);Q&&Reflect.setPrototypeOf(R,Q.prototype);return R}}return function(R,ea,Q){void 0===Q&&(Q=R);Q=$jscomp.objectCreate(Q.prototype||Object.prototype);return Function.prototype.apply.call(R,Q,ea)||
Q}};$jscomp.construct={valueOf:$jscomp.getConstructImplementation}.valueOf();$jscomp.underscoreProtoCanBeSet=function(){var p={a:!0},G={};try{return G.__proto__=p,G.a}catch(R){}return!1};$jscomp.setPrototypeOf=$jscomp.TRUST_ES6_POLYFILLS&&"function"==typeof Object.setPrototypeOf?Object.setPrototypeOf:$jscomp.underscoreProtoCanBeSet()?function(p,G){p.__proto__=G;if(p.__proto__!==G)throw new TypeError(p+" is not extensible");return p}:null;
$jscomp.inherits=function(p,G){p.prototype=$jscomp.objectCreate(G.prototype);p.prototype.constructor=p;if($jscomp.setPrototypeOf){var R=$jscomp.setPrototypeOf;R(p,G)}else for(R in G)if("prototype"!=R)if(Object.defineProperties){var ea=Object.getOwnPropertyDescriptor(G,R);ea&&Object.defineProperty(p,R,ea)}else p[R]=G[R];p.superClass_=G.prototype};$jscomp.generator={};
$jscomp.generator.ensureIteratorResultIsObject_=function(p){if(!(p instanceof Object))throw new TypeError("Iterator result "+p+" is not an object");};$jscomp.generator.Context=function(){this.isRunning_=!1;this.yieldAllIterator_=null;this.yieldResult=void 0;this.nextAddress=1;this.finallyAddress_=this.catchAddress_=0;this.finallyContexts_=this.abruptCompletion_=null};
$jscomp.generator.Context.prototype.start_=function(){if(this.isRunning_)throw new TypeError("Generator is already running");this.isRunning_=!0};$jscomp.generator.Context.prototype.stop_=function(){this.isRunning_=!1};$jscomp.generator.Context.prototype.jumpToErrorHandler_=function(){this.nextAddress=this.catchAddress_||this.finallyAddress_};$jscomp.generator.Context.prototype.next_=function(p){this.yieldResult=p};
$jscomp.generator.Context.prototype.throw_=function(p){this.abruptCompletion_={exception:p,isException:!0};this.jumpToErrorHandler_()};$jscomp.generator.Context.prototype.return=function(p){this.abruptCompletion_={return:p};this.nextAddress=this.finallyAddress_};$jscomp.generator.Context.prototype.jumpThroughFinallyBlocks=function(p){this.abruptCompletion_={jumpTo:p};this.nextAddress=this.finallyAddress_};$jscomp.generator.Context.prototype.yield=function(p,G){this.nextAddress=G;return{value:p}};
$jscomp.generator.Context.prototype.yieldAll=function(p,G){p=$jscomp.makeIterator(p);var R=p.next();$jscomp.generator.ensureIteratorResultIsObject_(R);if(R.done)this.yieldResult=R.value,this.nextAddress=G;else return this.yieldAllIterator_=p,this.yield(R.value,G)};$jscomp.generator.Context.prototype.jumpTo=function(p){this.nextAddress=p};$jscomp.generator.Context.prototype.jumpToEnd=function(){this.nextAddress=0};
$jscomp.generator.Context.prototype.setCatchFinallyBlocks=function(p,G){this.catchAddress_=p;void 0!=G&&(this.finallyAddress_=G)};$jscomp.generator.Context.prototype.setFinallyBlock=function(p){this.catchAddress_=0;this.finallyAddress_=p||0};$jscomp.generator.Context.prototype.leaveTryBlock=function(p,G){this.nextAddress=p;this.catchAddress_=G||0};
$jscomp.generator.Context.prototype.enterCatchBlock=function(p){this.catchAddress_=p||0;p=this.abruptCompletion_.exception;this.abruptCompletion_=null;return p};$jscomp.generator.Context.prototype.enterFinallyBlock=function(p,G,R){R?this.finallyContexts_[R]=this.abruptCompletion_:this.finallyContexts_=[this.abruptCompletion_];this.catchAddress_=p||0;this.finallyAddress_=G||0};
$jscomp.generator.Context.prototype.leaveFinallyBlock=function(p,G){G=this.finallyContexts_.splice(G||0)[0];if(G=this.abruptCompletion_=this.abruptCompletion_||G){if(G.isException)return this.jumpToErrorHandler_();void 0!=G.jumpTo&&this.finallyAddress_<G.jumpTo?(this.nextAddress=G.jumpTo,this.abruptCompletion_=null):this.nextAddress=this.finallyAddress_}else this.nextAddress=p};$jscomp.generator.Context.prototype.forIn=function(p){return new $jscomp.generator.Context.PropertyIterator(p)};
$jscomp.generator.Context.PropertyIterator=function(p){this.object_=p;this.properties_=[];for(var G in p)this.properties_.push(G);this.properties_.reverse()};$jscomp.generator.Context.PropertyIterator.prototype.getNext=function(){for(;0<this.properties_.length;){var p=this.properties_.pop();if(p in this.object_)return p}return null};$jscomp.generator.Engine_=function(p){this.context_=new $jscomp.generator.Context;this.program_=p};
$jscomp.generator.Engine_.prototype.next_=function(p){this.context_.start_();if(this.context_.yieldAllIterator_)return this.yieldAllStep_(this.context_.yieldAllIterator_.next,p,this.context_.next_);this.context_.next_(p);return this.nextStep_()};
$jscomp.generator.Engine_.prototype.return_=function(p){this.context_.start_();var G=this.context_.yieldAllIterator_;if(G)return this.yieldAllStep_("return"in G?G["return"]:function(R){return{value:R,done:!0}},p,this.context_.return);this.context_.return(p);return this.nextStep_()};
$jscomp.generator.Engine_.prototype.throw_=function(p){this.context_.start_();if(this.context_.yieldAllIterator_)return this.yieldAllStep_(this.context_.yieldAllIterator_["throw"],p,this.context_.next_);this.context_.throw_(p);return this.nextStep_()};
$jscomp.generator.Engine_.prototype.yieldAllStep_=function(p,G,R){try{var ea=p.call(this.context_.yieldAllIterator_,G);$jscomp.generator.ensureIteratorResultIsObject_(ea);if(!ea.done)return this.context_.stop_(),ea;var Q=ea.value}catch(sa){return this.context_.yieldAllIterator_=null,this.context_.throw_(sa),this.nextStep_()}this.context_.yieldAllIterator_=null;R.call(this.context_,Q);return this.nextStep_()};
$jscomp.generator.Engine_.prototype.nextStep_=function(){for(;this.context_.nextAddress;)try{var p=this.program_(this.context_);if(p)return this.context_.stop_(),{value:p.value,done:!1}}catch(G){this.context_.yieldResult=void 0,this.context_.throw_(G)}this.context_.stop_();if(this.context_.abruptCompletion_){p=this.context_.abruptCompletion_;this.context_.abruptCompletion_=null;if(p.isException)throw p.exception;return{value:p.return,done:!0}}return{value:void 0,done:!0}};
$jscomp.generator.Generator_=function(p){this.next=function(G){return p.next_(G)};this.throw=function(G){return p.throw_(G)};this.return=function(G){return p.return_(G)};this[Symbol.iterator]=function(){return this}};$jscomp.generator.createGenerator=function(p,G){G=new $jscomp.generator.Generator_(new $jscomp.generator.Engine_(G));$jscomp.setPrototypeOf&&p.prototype&&$jscomp.setPrototypeOf(G,p.prototype);return G};
$jscomp.asyncExecutePromiseGenerator=function(p){function G(ea){return p.next(ea)}function R(ea){return p.throw(ea)}return new Promise(function(ea,Q){function sa(X){X.done?ea(X.value):Promise.resolve(X.value).then(G,R).then(sa,Q)}sa(p.next())})};$jscomp.asyncExecutePromiseGeneratorFunction=function(p){return $jscomp.asyncExecutePromiseGenerator(p())};$jscomp.asyncExecutePromiseGeneratorProgram=function(p){return $jscomp.asyncExecutePromiseGenerator(new $jscomp.generator.Generator_(new $jscomp.generator.Engine_(p)))};
$jscomp.polyfill("Reflect",function(p){return p?p:{}},"es6","es3");$jscomp.polyfill("Reflect.construct",function(p){return $jscomp.construct},"es6","es3");$jscomp.polyfill("Reflect.setPrototypeOf",function(p){if(p)return p;if($jscomp.setPrototypeOf){var G=$jscomp.setPrototypeOf;return function(R,ea){try{return G(R,ea),!0}catch(Q){return!1}}}return null},"es6","es5");$jscomp.initSymbol=function(){};
$jscomp.polyfill("Symbol",function(p){if(p)return p;var G=function(Q,sa){this.$jscomp$symbol$id_=Q;$jscomp.defineProperty(this,"description",{configurable:!0,writable:!0,value:sa})};G.prototype.toString=function(){return this.$jscomp$symbol$id_};var R=0,ea=function(Q){if(this instanceof ea)throw new TypeError("Symbol is not a constructor");return new G("jscomp_symbol_"+(Q||"")+"_"+R++,Q)};return ea},"es6","es3");
$jscomp.polyfill("Symbol.iterator",function(p){if(p)return p;p=Symbol("Symbol.iterator");for(var G="Array Int8Array Uint8Array Uint8ClampedArray Int16Array Uint16Array Int32Array Uint32Array Float32Array Float64Array".split(" "),R=0;R<G.length;R++){var ea=$jscomp.global[G[R]];"function"===typeof ea&&"function"!=typeof ea.prototype[p]&&$jscomp.defineProperty(ea.prototype,p,{configurable:!0,writable:!0,value:function(){return $jscomp.iteratorPrototype($jscomp.arrayIteratorImpl(this))}})}return p},"es6",
"es3");$jscomp.iteratorPrototype=function(p){p={next:p};p[Symbol.iterator]=function(){return this};return p};
$jscomp.polyfill("Promise",function(p){function G(){this.batch_=null}function R(X){return X instanceof Q?X:new Q(function(oa,Y){oa(X)})}if(p&&(!($jscomp.FORCE_POLYFILL_PROMISE||$jscomp.FORCE_POLYFILL_PROMISE_WHEN_NO_UNHANDLED_REJECTION&&"undefined"===typeof $jscomp.global.PromiseRejectionEvent)||!$jscomp.global.Promise||-1===$jscomp.global.Promise.toString().indexOf("[native code]")))return p;G.prototype.asyncExecute=function(X){if(null==this.batch_){this.batch_=[];var oa=this;this.asyncExecuteFunction(function(){oa.executeBatch_()})}this.batch_.push(X)};
var ea=$jscomp.global.setTimeout;G.prototype.asyncExecuteFunction=function(X){ea(X,0)};G.prototype.executeBatch_=function(){for(;this.batch_&&this.batch_.length;){var X=this.batch_;this.batch_=[];for(var oa=0;oa<X.length;++oa){var Y=X[oa];X[oa]=null;try{Y()}catch(ba){this.asyncThrow_(ba)}}}this.batch_=null};G.prototype.asyncThrow_=function(X){this.asyncExecuteFunction(function(){throw X;})};var Q=function(X){this.state_=0;this.result_=void 0;this.onSettledCallbacks_=[];this.isRejectionHandled_=!1;
var oa=this.createResolveAndReject_();try{X(oa.resolve,oa.reject)}catch(Y){oa.reject(Y)}};Q.prototype.createResolveAndReject_=function(){function X(ba){return function(ja){Y||(Y=!0,ba.call(oa,ja))}}var oa=this,Y=!1;return{resolve:X(this.resolveTo_),reject:X(this.reject_)}};Q.prototype.resolveTo_=function(X){if(X===this)this.reject_(new TypeError("A Promise cannot resolve to itself"));else if(X instanceof Q)this.settleSameAsPromise_(X);else{a:switch(typeof X){case "object":var oa=null!=X;break a;case "function":oa=
!0;break a;default:oa=!1}oa?this.resolveToNonPromiseObj_(X):this.fulfill_(X)}};Q.prototype.resolveToNonPromiseObj_=function(X){var oa=void 0;try{oa=X.then}catch(Y){this.reject_(Y);return}"function"==typeof oa?this.settleSameAsThenable_(oa,X):this.fulfill_(X)};Q.prototype.reject_=function(X){this.settle_(2,X)};Q.prototype.fulfill_=function(X){this.settle_(1,X)};Q.prototype.settle_=function(X,oa){if(0!=this.state_)throw Error("Cannot settle("+X+", "+oa+"): Promise already settled in state"+this.state_);
this.state_=X;this.result_=oa;2===this.state_&&this.scheduleUnhandledRejectionCheck_();this.executeOnSettledCallbacks_()};Q.prototype.scheduleUnhandledRejectionCheck_=function(){var X=this;ea(function(){if(X.notifyUnhandledRejection_()){var oa=$jscomp.global.console;"undefined"!==typeof oa&&oa.error(X.result_)}},1)};Q.prototype.notifyUnhandledRejection_=function(){if(this.isRejectionHandled_)return!1;var X=$jscomp.global.CustomEvent,oa=$jscomp.global.Event,Y=$jscomp.global.dispatchEvent;if("undefined"===
typeof Y)return!0;"function"===typeof X?X=new X("unhandledrejection",{cancelable:!0}):"function"===typeof oa?X=new oa("unhandledrejection",{cancelable:!0}):(X=$jscomp.global.document.createEvent("CustomEvent"),X.initCustomEvent("unhandledrejection",!1,!0,X));X.promise=this;X.reason=this.result_;return Y(X)};Q.prototype.executeOnSettledCallbacks_=function(){if(null!=this.onSettledCallbacks_){for(var X=0;X<this.onSettledCallbacks_.length;++X)sa.asyncExecute(this.onSettledCallbacks_[X]);this.onSettledCallbacks_=
null}};var sa=new G;Q.prototype.settleSameAsPromise_=function(X){var oa=this.createResolveAndReject_();X.callWhenSettled_(oa.resolve,oa.reject)};Q.prototype.settleSameAsThenable_=function(X,oa){var Y=this.createResolveAndReject_();try{X.call(oa,Y.resolve,Y.reject)}catch(ba){Y.reject(ba)}};Q.prototype.then=function(X,oa){function Y(Oa,ra){return"function"==typeof Oa?function(rb){try{ba(Oa(rb))}catch(ob){ja(ob)}}:ra}var ba,ja,wa=new Q(function(Oa,ra){ba=Oa;ja=ra});this.callWhenSettled_(Y(X,ba),Y(oa,
ja));return wa};Q.prototype.catch=function(X){return this.then(void 0,X)};Q.prototype.callWhenSettled_=function(X,oa){function Y(){switch(ba.state_){case 1:X(ba.result_);break;case 2:oa(ba.result_);break;default:throw Error("Unexpected state: "+ba.state_);}}var ba=this;null==this.onSettledCallbacks_?sa.asyncExecute(Y):this.onSettledCallbacks_.push(Y);this.isRejectionHandled_=!0};Q.resolve=R;Q.reject=function(X){return new Q(function(oa,Y){Y(X)})};Q.race=function(X){return new Q(function(oa,Y){for(var ba=
$jscomp.makeIterator(X),ja=ba.next();!ja.done;ja=ba.next())R(ja.value).callWhenSettled_(oa,Y)})};Q.all=function(X){var oa=$jscomp.makeIterator(X),Y=oa.next();return Y.done?R([]):new Q(function(ba,ja){function wa(rb){return function(ob){Oa[rb]=ob;ra--;0==ra&&ba(Oa)}}var Oa=[],ra=0;do Oa.push(void 0),ra++,R(Y.value).callWhenSettled_(wa(Oa.length-1),ja),Y=oa.next();while(!Y.done)})};return Q},"es6","es3");
$jscomp.checkStringArgs=function(p,G,R){if(null==p)throw new TypeError("The 'this' value for String.prototype."+R+" must not be null or undefined");if(G instanceof RegExp)throw new TypeError("First argument to String.prototype."+R+" must not be a regular expression");return p+""};
$jscomp.polyfill("String.prototype.startsWith",function(p){return p?p:function(G,R){var ea=$jscomp.checkStringArgs(this,G,"startsWith");G+="";var Q=ea.length,sa=G.length;R=Math.max(0,Math.min(R|0,ea.length));for(var X=0;X<sa&&R<Q;)if(ea[R++]!=G[X++])return!1;return X>=sa}},"es6","es3");
$jscomp.iteratorFromArray=function(p,G){p instanceof String&&(p+="");var R=0,ea=!1,Q={next:function(){if(!ea&&R<p.length){var sa=R++;return{value:G(sa,p[sa]),done:!1}}ea=!0;return{done:!0,value:void 0}}};Q[Symbol.iterator]=function(){return Q};return Q};$jscomp.polyfill("Array.prototype.keys",function(p){return p?p:function(){return $jscomp.iteratorFromArray(this,function(G){return G})}},"es6","es3");
$jscomp.polyfill("Array.from",function(p){return p?p:function(G,R,ea){R=null!=R?R:function(oa){return oa};var Q=[],sa="undefined"!=typeof Symbol&&Symbol.iterator&&G[Symbol.iterator];if("function"==typeof sa){G=sa.call(G);for(var X=0;!(sa=G.next()).done;)Q.push(R.call(ea,sa.value,X++))}else for(sa=G.length,X=0;X<sa;X++)Q.push(R.call(ea,G[X],X));return Q}},"es6","es3");
$jscomp.checkEs6ConformanceViaProxy=function(){try{var p={},G=Object.create(new $jscomp.global.Proxy(p,{get:function(R,ea,Q){return R==p&&"q"==ea&&Q==G}}));return!0===G.q}catch(R){return!1}};$jscomp.USE_PROXY_FOR_ES6_CONFORMANCE_CHECKS=!1;$jscomp.ES6_CONFORMANCE=$jscomp.USE_PROXY_FOR_ES6_CONFORMANCE_CHECKS&&$jscomp.checkEs6ConformanceViaProxy();$jscomp.owns=function(p,G){return Object.prototype.hasOwnProperty.call(p,G)};
$jscomp.polyfill("WeakMap",function(p){function G(){if(!p||!Object.seal)return!1;try{var ba=Object.seal({}),ja=Object.seal({}),wa=new p([[ba,2],[ja,3]]);if(2!=wa.get(ba)||3!=wa.get(ja))return!1;wa.delete(ba);wa.set(ja,4);return!wa.has(ba)&&4==wa.get(ja)}catch(Oa){return!1}}function R(){}function ea(ba){var ja=typeof ba;return"object"===ja&&null!==ba||"function"===ja}function Q(ba){if(!$jscomp.owns(ba,X)){var ja=new R;$jscomp.defineProperty(ba,X,{value:ja})}}function sa(ba){if(!$jscomp.ISOLATE_POLYFILLS){var ja=
Object[ba];ja&&(Object[ba]=function(wa){if(wa instanceof R)return wa;Object.isExtensible(wa)&&Q(wa);return ja(wa)})}}if($jscomp.USE_PROXY_FOR_ES6_CONFORMANCE_CHECKS){if(p&&$jscomp.ES6_CONFORMANCE)return p}else if(G())return p;var X="$jscomp_hidden_"+Math.random();sa("freeze");sa("preventExtensions");sa("seal");var oa=0,Y=function(ba){this.id_=(oa+=Math.random()+1).toString();if(ba){ba=$jscomp.makeIterator(ba);for(var ja;!(ja=ba.next()).done;)ja=ja.value,this.set(ja[0],ja[1])}};Y.prototype.set=function(ba,
ja){if(!ea(ba))throw Error("Invalid WeakMap key");Q(ba);if(!$jscomp.owns(ba,X))throw Error("WeakMap key fail: "+ba);ba[X][this.id_]=ja;return this};Y.prototype.get=function(ba){return ea(ba)&&$jscomp.owns(ba,X)?ba[X][this.id_]:void 0};Y.prototype.has=function(ba){return ea(ba)&&$jscomp.owns(ba,X)&&$jscomp.owns(ba[X],this.id_)};Y.prototype.delete=function(ba){return ea(ba)&&$jscomp.owns(ba,X)&&$jscomp.owns(ba[X],this.id_)?delete ba[X][this.id_]:!1};return Y},"es6","es3");$jscomp.MapEntry=function(){};
$jscomp.polyfill("Map",function(p){function G(){if($jscomp.ASSUME_NO_NATIVE_MAP||!p||"function"!=typeof p||!p.prototype.entries||"function"!=typeof Object.seal)return!1;try{var Y=Object.seal({x:4}),ba=new p($jscomp.makeIterator([[Y,"s"]]));if("s"!=ba.get(Y)||1!=ba.size||ba.get({x:4})||ba.set({x:4},"t")!=ba||2!=ba.size)return!1;var ja=ba.entries(),wa=ja.next();if(wa.done||wa.value[0]!=Y||"s"!=wa.value[1])return!1;wa=ja.next();return wa.done||4!=wa.value[0].x||"t"!=wa.value[1]||!ja.next().done?!1:!0}catch(Oa){return!1}}
if($jscomp.USE_PROXY_FOR_ES6_CONFORMANCE_CHECKS){if(p&&$jscomp.ES6_CONFORMANCE)return p}else if(G())return p;var R=new WeakMap,ea=function(Y){this.data_={};this.head_=X();this.size=0;if(Y){Y=$jscomp.makeIterator(Y);for(var ba;!(ba=Y.next()).done;)ba=ba.value,this.set(ba[0],ba[1])}};ea.prototype.set=function(Y,ba){Y=0===Y?0:Y;var ja=Q(this,Y);ja.list||(ja.list=this.data_[ja.id]=[]);ja.entry?ja.entry.value=ba:(ja.entry={next:this.head_,previous:this.head_.previous,head:this.head_,key:Y,value:ba},ja.list.push(ja.entry),
this.head_.previous.next=ja.entry,this.head_.previous=ja.entry,this.size++);return this};ea.prototype.delete=function(Y){Y=Q(this,Y);return Y.entry&&Y.list?(Y.list.splice(Y.index,1),Y.list.length||delete this.data_[Y.id],Y.entry.previous.next=Y.entry.next,Y.entry.next.previous=Y.entry.previous,Y.entry.head=null,this.size--,!0):!1};ea.prototype.clear=function(){this.data_={};this.head_=this.head_.previous=X();this.size=0};ea.prototype.has=function(Y){return!!Q(this,Y).entry};ea.prototype.get=function(Y){return(Y=
Q(this,Y).entry)&&Y.value};ea.prototype.entries=function(){return sa(this,function(Y){return[Y.key,Y.value]})};ea.prototype.keys=function(){return sa(this,function(Y){return Y.key})};ea.prototype.values=function(){return sa(this,function(Y){return Y.value})};ea.prototype.forEach=function(Y,ba){for(var ja=this.entries(),wa;!(wa=ja.next()).done;)wa=wa.value,Y.call(ba,wa[1],wa[0],this)};ea.prototype[Symbol.iterator]=ea.prototype.entries;var Q=function(Y,ba){var ja=ba&&typeof ba;"object"==ja||"function"==
ja?R.has(ba)?ja=R.get(ba):(ja=""+ ++oa,R.set(ba,ja)):ja="p_"+ba;var wa=Y.data_[ja];if(wa&&$jscomp.owns(Y.data_,ja))for(Y=0;Y<wa.length;Y++){var Oa=wa[Y];if(ba!==ba&&Oa.key!==Oa.key||ba===Oa.key)return{id:ja,list:wa,index:Y,entry:Oa}}return{id:ja,list:wa,index:-1,entry:void 0}},sa=function(Y,ba){var ja=Y.head_;return $jscomp.iteratorPrototype(function(){if(ja){for(;ja.head!=Y.head_;)ja=ja.previous;for(;ja.next!=ja.head;)return ja=ja.next,{done:!1,value:ba(ja)};ja=null}return{done:!0,value:void 0}})},
X=function(){var Y={};return Y.previous=Y.next=Y.head=Y},oa=0;return ea},"es6","es3");$jscomp.findInternal=function(p,G,R){p instanceof String&&(p=String(p));for(var ea=p.length,Q=0;Q<ea;Q++){var sa=p[Q];if(G.call(R,sa,Q,p))return{i:Q,v:sa}}return{i:-1,v:void 0}};$jscomp.polyfill("Array.prototype.findIndex",function(p){return p?p:function(G,R){return $jscomp.findInternal(this,G,R).i}},"es6","es3");var svManager={getInstance:function(){var p=window.$rdp;return p&&p.running&&p.running()?p:null}};
svGlobal.getInstance=svManager.getInstance;function connvertServer(p){var G={};G.id=p.id;G.server=p.id;G.displayName=p.displayName||p.id;if(p=p.rdp){for(var R in p)G[R]=p[R];G.user=p.username||"";G.pwd=p.password||"";G.useConsole=p.console||!1;G.legacyMode=p.leagacyMode||p.legacyMode||!1;G.server_bpp=p.color||16;G.exe=p.remoteProgram||"";G.args=p.remoteArgs||"";G.startProgram=0<G.exe.length?"app":G.command&&0<G.command.length?"shell":"noapp"}return G}
function Rdp2(p){p=svGlobal.util.getServerArgs(p);if(!p||!p.gateway)return hi5.notifications.notify({msg:__svi18n.noauth}),null;var G=p.gateway||"",R=0,ea=0,Q=16,sa=1==p.useSSL||"true"==p.useSSL||"on"==p.useSSL||null;p.width&&(R=parseInt(p.width,10));p.height&&(ea=parseInt(p.height,10));p.color&&(Q=parseInt(p.color,10));p.server_bpp&&(Q=parseInt(p.server_bpp,10));p=hi5.browser.obj2url(p);null===sa&&(sa="https:"==location.protocol);return new Rdp((sa?"wss://":"ws://")+G+"/RDP?"+p,R,ea,Q)}
svGlobal.Rdp2||(svGlobal.Rdp2=Rdp2);
function Rdp(p,G,R,ea){function Q(a){return"on"==a||"true"==a||1==a}function sa(){var a=r.gateway;r.ongetgatewayaddress&&(a=r.ongetgatewayaddress(a));return a}function X(){var a=hi5.storage.get("SV_CONN_SHARE_ID");a||(a=hi5.tool.uuid(),hi5.storage.set("SV_CONN_SHARE_ID",a));return a}function oa(a,b){a=ca[a]||b;a.startsWith("/")||a.toLowerCase().startsWith("http")||(a=hi5.libPath+a);return a}function Y(){return L.displayName||L.server||L.symlink||L.id||"undefined"}function ba(a){r.loadbalanceToken||
(r.loadbalanceToken=ca.loadbalanceTokenName?ca.loadbalanceTokenName+"="+a:"")}function ja(a,b,c){r.ontitlechange&&(a=r.ontitlechange(a,c));r.setTitle&&a&&(b=b||window,b.document.title=a)}function wa(a,b){switch(a){case 16:case 8:case 24:case 32:break;case 15:return L.invitation||r.showMessage("15 bit color is not supported anymore."),!1;default:return!1}fb=a;b&&(Ka?Ka.postMessage({type:0,cmd:1,data:a}):Aa&&Aa.setColor(a));return!0}function Oa(a,b,c,e){Ia=a;Ja=b;Tb=Ub=0;Vb=Ia-1;Wb=Ja-1;Wa&&(Ia=(L.waWidth||
hi5.browser.getScreenWidth())|0,Ja=(L.waHeight||hi5.browser.getScreenHeight())|0);L.minWidth&&Ia<L.minWidth&&(Ia=L.minWidth|0);L.minHeight&&Ja<L.minHeight&&(Ja=L.minHeight|0);Ia&=-4;Ja&=-4;svGlobal.logger.warn("resolution changed, w:"+Ia+" h:"+Ja);var d=Ia,k=Ja;na?na.resize(d,k):na=new vc(d,k);aa.setSize(Ia,Ja,Wa?"hidden":null);if(c||Ia!=a||Ja!=b)Ka?Ka.postMessage({type:0,cmd:2,data:{w:Ia,h:Ja}}):Aa&&Aa.setResolution(Ia,Ja);if(r.onresolutionchange&&!e)r.onresolutionchange(a,b)}function ra(a){!bb&&
Ha&&(Ka?(Xb.data=a,"string"!=typeof a?Ka.postMessage(Xb,[a]):Ka.postMessage(Xb)):Aa.writeRawInput(a))}function rb(a){switch(a){case "\r":break;case "\n":r.writeScancode(28);break;case "\t":r.writeScancode(15);break;default:ra("86"+a)}}function ob(a){var b=this;a||(a=143);this.send=function(c){var e=!!c.buffer,d=e?c:c.getData(),k=64==a;c=e?d.length:c.getEnd()||d.length;c<d.length&&(d=e?d.subarray(0,c):d.slice(0,c));e=k?5:9;c=new Uint8Array(e+c);c[0]=a;if(k)c[1]=b.id,c[2]=b.id>>8,c[3]=b.id>>16,c[4]=
b.id>>24;else{k=b.name;for(var g=Math.min(k.length,8),B=0;B<g;B++)c[1+B]=k.charCodeAt(B)}c.set(d,e);ra(c.buffer)};this.name="";this.count=this.id=this.flags=0}function Eb(a){if(r){var b=__svi18n.errorCode[a];a={name:a,message:b,msg:b};r.displayMsg&&r.showMessage(a);0<svGlobal.log&&console.error&&console.error(a);if(r.onerror)r.onerror(a)}}function wc(a){if(r){var b=__svi18n.info[a];b||(b="info "+a);r.displayMsg&&r.showMessage(b);svGlobal.logger.info(b)}}function Yb(){var a=Ha;pb=Ha=!1;Ka?Ka.postMessage({type:0,
cmd:3}):Aa&&Aa.resetStatus();a&&(Ha=a)}function Zb(a){Ma||(Ma=new hi5.file.UploadManager(new hi5.file.WsFileService(ra)),Ma.addEvent("beforeupload",function(b,c,e){if(r.beforeupload)return r.beforeupload(b,c,e)}),Ma.addEvent("fileuploaded",function(b,c,e){if(r.onfileuploaded)r.onfileuploaded(b,c,e)}),Ma.addEvent("uploaded",function(b,c){if(r.onuploaded)r.onuploaded(b,c)}),Ma.addEvent("uploadingCancelled",function(){if(r.onuploadingCancelled)r.onuploadingCancelled()}));a.setFileHandler(Ma)}function xc(a,
b,c){var e=!1;this.exe=a;this.args=b||"";this._dir=c||"";var d=this;this.close=function(){!e&&Ha&&(e=!0,ra("8C5"+d.exe+"\t"+d.args+"\t"+r.sessionInfo.appInfo.session))}}function rd(){var a=window.opener;if(a)try{if(a.__sparkUser&&a.__sparkUser.session)return a.__sparkUser;if(a.opener&&a.opener.__sparkUser.session)return a.opener.__sparkUser}catch(b){}return null}function yc(){var a;return void 0!==(null==(a=window)?void 0:a.PublicKeyCredential)&&"function"===typeof window.PublicKeyCredential}function Fb(a){a=
(new Uint8Array(a)).buffer;return CBOR.decode(a)}function sd(a,b,c){var e={};if(b&&b.attachment)switch(b.attachment){case 1:var d="platform";break;case 2:d="cross-platform"}d&&(e.authenticatorAttachment=d);d={};b&&(b.requireResident?b.requireResident&&(d.requireResidentKey=!0,d.residentKey="required"):b.preferResident&&b.preferResident&&(d.requireResidentKey=!0,d.residentKey="preferred"));c&&c.rk&&(c.rk?(d.requireResidentKey=!0,d.residentKey="required"):(d.requireResidentKey=!1,d.residentKey=void 0));
d&&(d.requireResidentKey&&(e.requireResidentKey=d.requireResidentKey),d.residentKey&&(e.residentKey=d.residentKey));if(a=zc(a,b,c))e.userVerification=a;if(Object.keys(e).length)return e}function Ac(a){var b=[];if(a){a=$jscomp.makeIterator(a);for(var c=a.next();!c.done;c=a.next()){var e=c.value;c={};e.id&&(c.id=e.id);e.type&&(c.type=e.type);if(e.transports){var d=c;e=e.transports;var k=[];e&1?k.push("usb"):e&2?k.push("nfc"):e&4?k.push("ble"):e&16?k.push("internal"):e&32&&k.push("hybrid");d.transports=
k}b.push(c)}}return b}function zc(a,b,c){var e;a&&(a&4194304?e="required":a&8388608?e="preferred":a&16777216&&(e="discouraged"));if(b&&b.userVerification)switch(b.userVerification){case 1:e="required";break;case 2:e="preferred";break;case 3:e="discouraged"}c&&c.uv&&("FALSE"==c.uv.toUpperCase()?e="discouraged":"TRUE"==c.uv.toUpperCase()&&(e="required"));return e}function td(a){var b={};if(a&&a.attestationPreference)switch(a.attestationPreference){case 0:b.attestation="direct";break;case 1:b.attestation=
"direct";break;case 2:b.attestation="indirect";break;case 3:b.attestation="direct"}if(a&&a.enterpriseAttestation)switch(a.enterpriseAttestation){case 1:b.attestation="enterprise";break;case 2:b.attestation="enterprise"}b.attestationFormats=["packed"];return b}function ud(a,b){var c,e,d,k,g,B,x,D,F,w,l,v,q,u,M,P,U,N,I,W;return $jscomp.asyncExecutePromiseGeneratorProgram(function(V){if(1==V.nextAddress){c=a.getPublicKeyAlgorithm();console.log("==== publicKeyAlgorithms = "+c);if((e=a.getTransports())&&
0<e.length)for(var S=$jscomp.makeIterator(e),ia=S.next();!ia.done;ia=S.next())ia=ia.value,"USB"==ia.toUpperCase()||"NFC"==ia.toUpperCase()||"BLE"==ia.toUpperCase()||"INTERNAL"==ia.toUpperCase()||ia.toUpperCase();if(d=a.attestationObject)console.log("==== attestationObj bytes: "+sb(new Uint8Array(d))),g=Fb(d),k=g.attStmt;if(B=a.clientDataJSON)console.log("==== clientDataJson bytes: "+sb(new Uint8Array(B))),x=window.origin,D=(new TextDecoder).decode(B),F=JSON.parse(D),F.origin&&(F.origin=x);w=a.getAuthenticatorData();
if(!w)return V.jumpTo(0);l=new Uint8Array(w);console.log("==== authenticatorData bytes: "+sb(l));return b?(v=b.id)?V.yield(vd(v),5):V.jumpTo(0):V.jumpTo(0)}q=V.yieldResult;u=new Uint8Array(q);console.log("==== hash of realRpID: "+sb(u));M=new hi5.DataBuffer(new Uint8Array(l.byteLength));M.setBytes(u);P=l.slice?l.slice(32,l.length):l.subarray(32,l.length);M.setBytes(P);M.markEnd();U=M.getData();console.log("==== newAuthDataBytes: "+sb(new Uint8Array(U)));N={1:"packed",2:U,3:k};I=CBOR.encode(N);W=new hi5.DataBuffer(new Uint8Array(I.byteLength+
1));W.setByte(0);W.setBytes(I);W.markEnd();return V.return(W.getData())})}function vd(a){var b;return $jscomp.asyncExecutePromiseGeneratorProgram(function(c){b=(new TextEncoder).encode(a);return c.return(wd(b))})}function wd(a){var b;return $jscomp.asyncExecutePromiseGeneratorProgram(function(c){if(1==c.nextAddress)return c.yield(crypto.subtle.digest("SHA-256",a),2);b=c.yieldResult;return c.return(b)})}function sb(a){return Array.from(a,function(b){return("0"+(b&255).toString(16)).slice(-2)}).join(", ")}
function xd(){var a=0,b=0,c=new r.GatewayChannel;c.name="MESSGSTB";c.onopen=function(){svGlobal.logger.info("Message Channel open")};c.process=function(e){if(0==e.getByte())e.getByte(),e.getByte(),e.getByte();else{var d=e.getByte(),k=e.getLittleEndian16(),g=e.getLittleEndian16();if(0!=d)svGlobal.logger.warn("Invalid AUTODETECT_REQUEST");else switch(g){case 1:case 4097:g=new RdpBuffer(new Uint8Array(6),0,6);g.setByte(6);g.setByte(1);g.setLittleEndian16(k);g.setLittleEndian16(0);g.markEnd();c.send(g);
break;case 20:case 276:case 4116:a=6;b=Date.now();break;case 2:k=e.getLittleEndian16();a+=k;break;case 43:case 1065:case 1577:43==g&&(d=e.getLittleEndian16(),a=a+d+8,e.skipPosition(d));e=e.has(4)?e.getLittleEndian32():0;a+=e;e=Date.now()-b;d=new RdpBuffer(new Uint8Array(14),0,14);d.setByte(14);d.setByte(1);d.setLittleEndian16(k);d.setLittleEndian16(43==g?3:11);d.setLittleEndian32(e);d.setLittleEndian32(a);d.markEnd();c.send(d);break;case 2112:case 2176:case 2240:k=e.getLittleEndian32();g=e.getLittleEndian32();
e=e.getLittleEndian32();Gb={baseRTT:k,bandwidth:g,averageRTT:e};if(r.onnetworkresult)r.onnetworkresult(Gb);svGlobal.logger.warn("Network Characteristics Result:");svGlobal.logger.warn(Gb);break;default:svGlobal.logger.warn("Invalid network detect PDU",e)}}};c.onclose=function(){svGlobal.logger.info("MSG channel close")};r.addGatewayChannel(c)}function yd(a,b,c,e,d){$b.set(a,b);ac.set(a,e);b="<b>User:&nbsp;</b>"+c+"&nbsp;("+e+")&nbsp;&nbsp;&nbsp;&nbsp;<b>Expire Date:</b> "+d;c=document.createElement("div");
e=document.createElement("input");e.type="radio";e.name="scard_name";e.value=a;0==a&&(e.defaultChecked=!0);c.appendChild(e);c.innerHTML+=b;c.innerHTML+="<br>";return c}function zd(a,b){var c=document.createElement("div"),e=document.createElement("input");e.type="radio";e.name="ds_name";e.value=a;0==a&&(e.defaultChecked=!0);c.appendChild(e);c.innerHTML+=b;c.innerHTML+="<br>";return c}function Bc(){var a="";L&&Q(L.connectif)&&L.symlink&&"sessionStorage"in window&&(a="SV_"+L.symlink,L.domain&&(a+=L.domain),
L.user&&(a+=L.user));return a}function Ad(){var a=hi5.appcfg.persistentId?window.localStorage:window.sessionStorage;if(!a)return"";var b=a.getItem("appInfo.session");if(!b)return"";b="&_session="+b;(a=a.getItem("appInfo.numericId"))&&(b+="&_numericId="+a);return b}function bc(){if(!Ha){pb=!1;var a="";bb?Ea.init(!1,!0,!1,0,!1,!1):a=r.getRuntimeURL();void 0==ca.wsPost&&(ca.wsPost=!1);r.oncreatewebsocket&&(Ka=null);Ka?(bb&&(bb.onopen=cc,bb.onclose=yb,bb.onmessage=function(c){dc.data=c.data;Ka.postMessage(dc,
[dc.data])}),Ka.postMessage({type:0,cmd:0,data:{addr:a,width:Ia,height:Ja,server_bpp:fb,libPath:hi5.libPath,libMin:hi5.libMin,wsPost:ca.wsPost}})):(Aa=new RdpGeneral(bb||a,Ia,Ja,fb,na,!1,ca.wsPost),Aa.oncreatewebsocket=r.oncreatewebsocket,Aa.run());Ka?Ka.addEventListener("message",Cc,!1):(Aa.onopen=cc,Aa.onmessage=Dc,Aa.onclose=yb,Aa.onerror=Eb,Aa.oninfo=wc,Aa.onloggedin=ec,Aa.onresolutionchange=function(c,e){Oa(c,e,!1,L.monitorDef&&0<=L.monitor?!0:!1)},Aa.onAltSecWindows=Ec,Aa.onMoveCursor=fc,Aa.onCloseSurface=
Fc,Aa.onColorChange=wa,Aa.onHistoryReceived=function(){gc()},Aa.onLockKeyState=function(c){if(r.onLockKeyState)r.onLockKeyState(c)});if(a=aa.getSurface(aa.size()-1))Wa?a&&(a.remoteApp=new xc(L.exe,L.args,"")):ja(Y(),a.getWindow());if(L.invitation&&!Q(L.shadow)){var b=null;a&&(b=a.initChat(L.expert));zb=new r.GatewayChannel;zb.name="C_H_A_T";zb.process=function(c){c=c.getUnicodeString(c.getEnd()-c.getPosition(),!0);b&&b.add(c,L.novice)};b&&(b.onchat=function(c){if(Ha){var e=Array(2*c.length);e=new hi5.DataBuffer(e,
0,e.length);e.setUnicodeString(c);e.markEnd();zb.send(e)}});r.addGatewayChannel(zb)}}}function Cc(a){a=a.data;switch(a.type){case 1:switch(a.event){case 0:cc();break;case 1:yb(a.expected);break;case 2:Eb(a.code);break;case 3:wc(a.code);break;case 4:ec();break;case 5:Oa(a.w,a.h,!1,L.monitorDef&&0<=L.monitor?!0:!1);break;case 6:fc(a.x,a.y,!0);break;case 7:Fc();break;case 8:0==a.id&&gc();Qa&&Qa.check(1<a.id?15555:0);break;case 9:wa(a.color);break;case 10:if(r.onLockKeyState)r.onLockKeyState(a.state);
break;default:svGlobal.logger.warn("Invalid worker event "+a.type)}break;case 2:na.setRGBs(a.x,a.y,a.w,a.h,a.pixel,a.offset,a.scansize);break;case 3:na.moveArea(a.srcx,a.srcy,a.cx,a.cy,a.dx,a.dy);break;case 5:na.fillRect(a.l,a.t,a.w,a.h,a.color);break;case 6:na.drawLine(a.x1,a.y1,a.x2,a.y2,a.color);break;case 7:na.bitBlt(a.opcode,a.dstwidth,a.x,a.y,a.cx,a.cy,a.src,a.srcwidth,a.srcx,a.srcy);break;case 8:na.drawLineExt(a.x1,a.y1,a.x2,a.y2,a.color,a.opcode);break;case 9:Gc(a);break;case 10:Dc(a);break;
case 11:Va.attach(a.data,0,a.data.length);Ec(Va,a.size);break;case 12:na.drawText(a.font,a.flags,a.mixmode,a.foregroundColor,a.backgroundColor,a.clipLeft,a.clipTop,a.clipcx,a.clipcy,a.boxLeft,a.boxTop,a.boxcx,a.boxcy,a.x,a.y,a.length,a.text,a._left,a._top,a._right,a._bottom);break;case 13:na.drawBitmap(a.cacheID,a.cacheIDX,a.x,a.y,a.cx,a.cy,a.srcx,a.srcy,a.opcode);break;case 14:na.saveDesktop(a.x,a.y,a.cx,a.cy,a.offset);break;case 15:na.restoreDesktop(a.x,a.y,a.cx,a.cy,a.offset);break;case 16:na.putFont(a.font,
a.character,a.glyph);break;case 17:na.putCursor(a.idx,a.cursor);break;case 18:na.setCursor(a.idx);break;case 19:na.getHistory(ra,function(){Ka.postMessage({type:0,cmd:7})});Qa&&Qa.check(15555);break;case 20:Va.attach(a.data,a.off,a.data.length-a.off);na.setHistory(a.order,Va);break;case 21:na.putBitmap(a.id,a.idx,a.bitmap);break;default:svGlobal.logger.warn("Invalid worker msg "+a.type)}}function Hc(a){Qa&&Qa.check(a)}function cc(){Ha=!0;var a="87"+navigator.userAgent+"\t";Hb=hi5.tool.uuid();document.cookie=
Hb+"=sv";ra(a+Hb);if(r.onopen)r.onopen();ca.joinCloseMode&&r.setJoinCloseMode(ca.joinCloseMode)}function Fc(){aa&&aa.close()}function Dc(a){var b=a.data;if("string"!=typeof b){a=new Uint8Array(b);Va.attach(a,0,b.byteLength);var c=Va.getLittleEndian16();switch(c){case 28:a=Va;b=a.getAscllString(8);c=ib[b];null!=c?c.process(a):svGlobal.logger.warn("Channel "+b+" not found");break;case 55:a=Va;switch(a.getByte()){case 0:Ba.tag=a.getLittleEndian16();Ba.channels=a.getLittleEndian16();Ba.samplePerSec=a.getLittleEndian32();
a.skipPosition(6);Ba.bitsPerSample=a.getLittleEndian16();svGlobal.logger.info("Audio Format, tag="+Ba.tag+" channels="+Ba.channels+" bitsPerSample="+Ba.bitsPerSample+" samplePerSec="+Ba.samplePerSec);Ka&&Ka.postMessage({type:0,cmd:5,data:{tag:Ba.tag,channels:Ba.channels,samplePerSec:Ba.samplePerSec,bitsPerSample:Ba.bitsPerSample}});41222==Ba.tag&&(Ba.sampleRate=Ba.samplePerSec,Ta.initMediaPlayer(Ta,Ba,!1));break;case 1:b=a.getByte();c=a.getLittleEndian16();var e=Date.now();a.skipPosition(8);hc(a,
b,c,0);jb||(c+=Date.now()-e,ra("8A"+b+","+c))}Qa&&Qa.check();break;case 56:Ic(Va.getUnicodeString(Va.getEnd()-Va.getPosition(),!1));break;case 60:Jc(Va);break;case 62:Kc(Va.getUnicodeString(Va.getEnd()-Va.getPosition(),!1));break;case 63:Lc(Va);Qa&&Qa.check();break;case 64:b=Va;c=b.getByte();a=b.getLittleEndian32();switch(c){case 1:b=b.getAscllString();if(Ea[b]){if(svGlobal.logger.info("DVC create, name:"+b+" id:"+a),Ea[b].newInstance?(Ea[a]=Ea[b].newInstance(),Ea[a].id=a):(Ea[b].id=a,Ea[a]=Ea[b]),
Ea[a].onopen)Ea[a].onopen()}else svGlobal.logger.info("DVC create, name not found:"+b+" id:"+a);break;case 3:Ea[a]&&Ea[a].process(b);break;case 4:if(Ea[a]&&Ea[a].onclose)Ea[a].onclose();svGlobal.logger.info("close DVC, id:"+a)}Qa&&Qa.check();break;case 146:a:switch(a=Va,b=a.getByte(),b){case 0:a=new Uint8Array(2);a[0]=146;a[1]=1;ra(a.buffer);break;case 1:break;case 5:b=a.getByte();a=a.getLittleEndian32();0!=b||a&4||(cb^=65536,aa.execute("setFeature",[cb]));break;case 6:Ra.remoteLockFlags=a.getLittleEndian32();
Ra.checkLockFlags=!0;if(r.onLockKeyState)r.onLockKeyState({capsLock:0!=(Ra.remoteLockFlags&4),numLock:0!=(Ra.remoteLockFlags&2),scrollLock:0!=(Ra.remoteLockFlags&1)},{capsLock:0!=(Ra.localLockFlags&4),numLock:0!=(Ra.localLockFlags&2),scrollLock:0!=(Ra.localLockFlags&1)});svGlobal.logger.info("remoteLockFlags: "+Ra.remoteLockFlags);break;case 7:b=a.getByte();r.sessionInfo.appInfo.twoFAEnabled=0<b;switch(b){case 0:b=a.getByte();c=a.getLittleEndian32();a=a.getBytes(c);r.sessionInfo.appInfo.twoFAQR=a;
r.ontwofaqr&&r.ontwofaqr(a)||2==b&&aa.execute("showTwoFAQR");break;case 1:na.pause(!0,!0);if(r.ontwofacode&&r.ontwofacode())break a;(a=aa.getFocused())&&a.showTwoFACode();break;case 2:if(b=a.getByte(),a=1==a.getByte(),(!r.ontwofaresult||!r.ontwofaresult(b,a))&&Ra.onauthcoderesult)Ra.onauthcoderesult(b,a)}break;default:svGlobal.logger.warn("Invalid Client Control: "+b)}break;default:if(r.onunknownmessage)r.onunknownmessage(c,Va);else svGlobal.logger.warn("@TODO:"+c+"\n")}}else switch(c=parseInt(b.substring(0,
2),16),a=b.substring(2),c){case 0:ra("87"+navigator.userAgent);break;case 15:if(r){ic=!1;tb=r.reconnectTimes;(r&&0==r.mode||Q(L.connectif))&&gc();b="";for(b in kb)if((c=kb[b])&&c.onopen)c.onopen();for(b in ib)if((c=ib[b])&&c.onopen)c.onopen();a&&(a=JSON.parse(a),a.capability&&r&&(r.sessionInfo.suppressOutput=!!a.capability.suppressOutput))}break;case 26:b=JSON.parse(a);if(b.name){isNaN(b.name)||(b.name="S"+b.name);b.message||(b.message=b.msg);if(r.onnotify)r.onnotify(b);svGlobal.logger.info("msg="+
a);if(2==b.type&&r.onerror)r.onerror(b);if(a=__svi18n.errorCode[b.name])b.msg=a+" "+b.msg;r.showMessage(b)}else 0<svGlobal.log&&console.erro("No error code for message:"+a);break;case 27:aa.drawLicense(a);break;case 50:if(Ha)switch(b=parseInt(a.substring(0,1),10),a=a.substring(1),b){case 1:Bd(a);break;case 2:Ab?(Ab.type==a?r.writeRawInput("881"+a+"\t"+Ab.text):r.writeRawInput("881ERROR\t"),Ab=null):!(b=aa.getFocused())||b.processClipReq(a)||!ca.clipWarnAlways&&Mc||!L||L.leagacyMode||(r.showMessage(__svi18n.info.menucopy,
null,5E3),Mc=!0);break;case 5:(b=aa.getFocused())&&"0"!=a&&b.setIgnorePaste(!0)}break;case 51:aa.setReadOnly("1"==a);break;case 54:b=a.split("\t");a=sa()+b[0];a=r.modifyURL(a);svGlobal.logger.info("Downloading file:"+a+" name:"+b[1]+" driver:"+b[2]);r.onprintingready&&r.onprintingready({link:a,printerName:b[1],pinterDriver:b[2]})||(b=aa.getFocused())&&b.showPDF(a);break;case 56:Ic(a);break;case 57:b=a.split("\t");svGlobal.logger.debug(a);if(a=aa.getWinById(parseInt(b[0]))){if(!aa.hasApp(b[1])){(c=
aa.getOwnerSurface(a))&&c.railWin&&(c.railWin.appId=b[1],c.railWin.addApp(b[1]));if(r.onremoteappstart)r.onremoteappstart({id:b[1]});if(a.isVisible()&&a.titleInfo&&r.ontitlechange)r.ontitlechange(c.railWin.getFullTitle(a.id),b[1])}a.appId=b[1]}break;case 58:Cd(a);break;case 59:a=hi5.Base64.dec(a,0);cb=(new RdpBuffer(a,0,a.length)).getLittleEndian32();jb||!(cb&16||cb&65536)?(Ib=!1,Ma=null):(cb&16&&(Ib=!0),Ma||(a=aa.getFocused())&&Zb(a));cb&64&&r.showMessage(__svi18n.info.recording);Ma&&(Ma.setUpload(!(cb&
128)),Ma.setDownload(!(cb&131072)),Ma.canCopyFile=0!=(cb&65536));aa.execute("setFeature",[cb]);break;case 60:Jc(b64ToBuffer(a));break;case 61:a=JSON.parse(a);switch(a.type){case 0:Oa(a.width,a.height,!0,!1);wa(a.color);(b=a.server)&&r&&(r.server=a.server);Nc=a.length;c=aa.getFocused();Wa=1==a.isRail;c&&(1!=r.mode&&c.setAutoScale(!Wa),b&&ja(Y(),c.getWindow()),b=a.keyboard,"undefined"!=typeof b&&0==b&&c.setUnicode(!0),b=a.mapDisk)&&(Ib=!0,Zb(c));if(r.onopened)r.onopened(a);break;case 1:a=a.duration;
if(r.onprogress)r.onprogress(a,Nc);break;case 2:2==a.status?(Yb(),Ha=!0):(b=0==a.status,b==na.isPaused()||r.onsessionpause&&r.onsessionpause(b,a)||(na.pause(b),b||aa.repaint(0,0,na.width-1,na.height-1),a.warn&&r.showMessage(b?__svi18n.info.sessionPaused:__svi18n.info.sessionResumed)))}break;case 62:Kc(a);break;case 63:Lc(b64ToBuffer(a));break;default:if(r.onunknownmessage)r.onunknownmessage(c,a);else svGlobal.logger.warn("@TODO:"+b+"\n")}}function gc(){if(!jb&&!Xa&&(Xa=!0,r&&(ca.pingInterval&&r.startPing(ca.pingInterval),
r.onready)))r.onready()}function Dd(a,b){var c=0,e=!1;this.width=a;this.interval=b;var d=0;this.start=function(){e||(e=!0,c=setInterval(function(){var k=aa.getFocused();k&&Ha&&(k=k.getThumbnail(a))&&k.length!=d&&(ra("8E7"+k),d=k.length)},b))};this.stop=function(){clearInterval(c)}}function Ed(a,b){!Ya||Ya.width==a&&Ya.interval==b||(Ya.stop(),Ya=null);Ya||(Ya=new Dd(a,b));Ya.start()}function Lc(a){var b=a.getAscllString(8);(b=kb[b])&&b.process&&b.process(a)}function Kc(a){var b=parseInt(a.substring(0,
1),16),c=a.substring(1);a=!1;var e=r.sessionInfo.appInfo;switch(b){case 0:var d=JSON.parse(c);Yb();Ha=!0;a=d.width;e=d.height;if(a==Ia&&e==Ja)break;Oa(a,e,!1,!1);break;case 1:d=JSON.parse(c);r.sessionInfo.joinedSessions.push(d.numericId);r.sessionInfo.joiners.push(d);e.sessions[d.numericId]=d.name||d.__ip;if(!e.joined||ca.alertJoin)r.onsessionjoin&&(a=r.onsessionjoin(d)),!a&&__svi18n.info.joinsession&&r.showMessage(__svi18n.info.joinsession.applyArgs([d.numericId,d.__ip,d.name]));break;case 2:d=JSON.parse(c);
r.sessionInfo.joinedSessions.removeElm(d.numericId);delete e.sessions[d.numericId];b=r.sessionInfo.joiners;c=0;for(var k=b.length;c<k;c++)if(b[c].numericId==d.numericId){b.splice(c,1);break}if(!e.joined||ca.alertJoin)r.onsessionexit&&(a=r.onsessionexit(d)),!a&&__svi18n.info.exitsession&&r.showMessage(__svi18n.info.exitsession.applyArgs([d.numericId,d.__ip,d.name]));break;case 3:d=JSON.parse(c);e.joinMode!=d.mode&&(e.joinMode=d.mode,b=hi5.$("joinSelect"))&&(b.value=d.mode);if(e.hasControl)break;e.hasControl=
!0;aa.setReadOnly(!1,2==d.mode);if(e=hi5.$("requestControl"))e.disabled=!0;r.ongivecontrol&&(a=r.ongivecontrol());if(a)break;r.showMessage(__svi18n.info.givecontrol,null,5E3);break;case 4:d=JSON.parse(c);aa.setReadOnly(!0,2==d.mode);e.hasControl=!1;if(e=hi5.$("requestControl"))e.disabled=!1;r.ontakebackcontrol&&(a=r.ontakebackcontrol());if(a)break;r.showMessage(__svi18n.info.nocontrol,null,5E3);break;case 5:d=JSON.parse(c);r.onrequirecontrol&&(a=r.onrequirecontrol(d));if(a)break;a=__svi18n.info.title.applyArgs([d.name,
d.numericId,d.__ip]);e=__svi18n.info.recontrol;na.isPaused&&(e+="<br><br>"+(__svi18n.info.autoresume||""));r.showMessage({title:a,msg:e,cbYes:function(){r.giveControl(d.numericId);this.destroy();na.isPaused()&&r.pauseSession(r.sessionInfo.appInfo.numericId,!1)},cbNo:function(){r.refuseControl(d.numericId);this.destroy()}});break;case 6:aa.execute("setTouchRemoting",[!0]);break;case 7:d=JSON.parse(c);d.width&&d.height&&Oa(d.width,d.height,!0,L.monitorDef&&0<=L.monitor?!0:!1);d.color&&(wa(d.color,!0),
svGlobal.logger.warn("Color depth changed to:"+d.color));d.version&&(r.sessionInfo.protocolVersion=d.version);break;case 8:d=JSON.parse(c);ic=!0;if(r.onrequestcredential&&r.onrequestcredential(d,Ra.reconnect))break;if(r.onautherror&&r.onautherror(d,Ra.reconnect))break;aa.getFocused().requestCredential(d,Ra.reconnect);break;case 9:d=JSON.parse(c);0<d.interval&&0<d.width?Ed(d.width,d.interval):Ya&&(Ya.stop(),Ya=null);break;case 11:d=JSON.parse(c);r.onrequirejoin&&(a=r.onrequirejoin(d));if(a)break;a=
__svi18n.info.title.applyArgs([d.name,d.numericId,d.__ip]);r.showMessage({title:a,msg:__svi18n.info.reqjoin,cbYes:function(){r.allowJoin(d.numericId,!0);this.destroy()},cbNo:function(){r.allowJoin(d.numericId,!1);this.destroy()}});break;case 13:d=JSON.parse(c);"login"==d.type&&ec();break;case 14:if(d=JSON.parse(c),r.oncontrolchange)r.oncontrolchange(d)}}function Jc(a){switch(a.getByte()){case 32:if(!na.isPaused()){var b=a.getLittleEndian16(),c=a.getLittleEndian16(),e=a.getLittleEndian16(),d=void 0,
k=void 0;ca.noCursorName||(d=a.getLittleEndian32(),r.sessionInfo.appInfo&&(k=r.sessionInfo.appInfo.sessions[d]));fc(c,e,!0,k,d,b)}}}function fc(a,b,c,e,d,k){na.isPaused()||aa.getFocused().moveCursor(a,b,c,e,d,k)}function Gc(a){aa.setCursor(a)}function Fd(a){var b=ca.page&&ca.page.join||"";if(b.startsWith("http://")||b.startsWith("https://"))return b;if(b.startsWith("/"))return location.origin+b;var c=location.href,e=c.lastIndexOf("/");if(b)return c.substring(0,e+1)+b;b=sa();c.toLowerCase().startsWith(b.toLowerCase())&&
(b=c.substring(0,e));return b+"/"+a}function Ic(a){a=JSON.parse(a);jc=a.session;var b=a.numericId,c=hi5.appcfg.persistentId?window.localStorage:window.sessionStorage;c&&(c.setItem("appInfo.session",jc),c.setItem("appInfo.numericId",b));ba(a.appId);a.server||(a.server=Y());if(b=hi5.$("joinSelect"))b.value=a.joinMode;if(b=hi5.$("requestControl"))b.disabled=a.hasControl;a.joined?1!=r.mode&&aa.execute("setAutoScale",[!0]):(r.mode=0,Q(L.connectif)&&aa.setSize(Ia,Ja),ca.disableJoinedAppResize&&(r.windowState=
0));var e=sa();b=Fd("join.html")+"?id="+(a.joined||a.numericId);(c=a.webAddress)&&0<c.length&&c.toLowerCase()!=e.toLowerCase()&&(e=c.indexOf("://"),r.protocol="http"==c.substring(0,e)?"ws":"wss",r.gateway=c,b+="&gateway="+encodeURIComponent(c));b=r.modifyURL(b);a.joinLink=b;r.sessionInfo.appInfo=a;"isApp"in a&&Wa!==a.isApp&&(Wa=a.isApp,Oa(Ia,Ja,!0,!0),pb||1==r.mode||aa.execute("setAutoScale",[!0]));a.ver&&a.ver!=svGlobal.version&&svGlobal.logger.warn("Client:"+svGlobal.version+" server:"+a.ver);ca.cursorNameOnly=
a.isAssistance;if(r.onsessionstart)r.onsessionstart(r.sessionInfo)}function Cd(a){if(Ma){var b=parseInt(a.charAt(0),10);a=a.substring(1);if(5==b)Ma.notifyFiles(JSON.parse(a));else{var c=a.split("\t");switch(b){case 1:Ma.confirmId(c[0],c[1],c[2]);break;case 2:Ma.read(c[0],parseInt(c[1],10),parseInt(c[2],10));break;case 4:Ma.close(c[0]);break;case 9:a='<a href="'+r.modifyURL(sa()+c[0])+'" download="'+c[1]+'" target="_blank">'+__svi18n.info.fileReady+": "+c[1]+"</a>",__svi18n.info.download&&aa.getFocused().showMessage({msg:a,
title:__svi18n.info.download,cbNo:function(){Ma.removeFile(c[0],!0);this.destroy()},onclick:function(e){"A"==e.target.tagName&&this.destroy()}})}}}}function hc(a,b,c,e){if(!Gd||na.isPaused())return 0;var d=a.getPosition();b=a.getData();e||(e=a.getEnd()-d);if(41222==Ba.tag)return Ta.onaudioframe(b.slice(d)),0;if(a=1!=Ba.tag)kc||(kc=new MSGSM),b=kc.decode(b,d,e),d=0,e=b.length;var k=Ba.bitsPerSample;var g=Math.floor(e/(k>>3));var B=c=e=0;a||(e=Math.pow(2,k-1)-1,c=-e-1,B=Math.pow(2,k));k=Ba.channels;
var x=Math.floor(g/k),D=Ta.getBuffer(x),F=D.getChannelData(0),w=D.getChannelData(1);g=0;if(a)for(;g<x;)1==k?w[g]=F[g]=b[d++]:(F[g]=b[d++],w[g]=b[d++]),g++;else for(;g<x;)a=b[d++]|b[d++]<<8,a>e?(a-=B,a/=-c):a/=e,1==k?F[g]=a:(F[g]=a,a=b[d++]|b[d++]<<8,a>e?(a-=B,a/=-c):a/=e),w[g]=a,g++;return Ta.playBuffer(D)}function Oc(a){if(!r.openLink||2E3<a.length)return!1;var b=a.indexOf(";");0<b&&(a=a.substring(b+1));b=a;a=a.toLowerCase();var c=0==a.indexOf("http://")||0==a.indexOf("https://")||0==a.indexOf("ftp://")||
0==a.indexOf("mailto:")||0==a.indexOf("tel:")||0==a.indexOf("callto:");c||(0==a.indexOf("www.")?(c=!0,a="http://"+a):0==a.indexOf("ftp.")&&(c=!0,a="ftp://"+a));return c?0<a.indexOf("\r")||0<a.indexOf("\n")?!1:r.onurlredirection&&r.onurlredirection(b)?!0:(a=aa.getFocused())?a.processLink(b):!1:!1}function Hd(a){if(a.startsWith("text/html;<img data-sv-img")){var b=a.indexOf('src="');if(0<b){b+=5;var c=a.indexOf('"',b),e=a.substring(b,c);e=r.modifyURL(e);a=a.substring(0,b)+e+a.substring(c)}}return a}
function Bd(a){if("text/plain;"!=a){if(1666<Date.now()-Ra.reqCopyTime&&!(r.onservercopy&&r.onservercopy(a)||Oc(a))){var b=aa.getFocused();b&&b.copyToClip(Hd(a))}setTimeout(function(){ra("883")},999)}}function ec(){if(!pb&&(setTimeout(function(){Ha&&ra("884")},333),r.onloggedin))r.onloggedin();lc=pb=!0;Wa&&1!=r.mode&&aa.execute("setAutoScale",[!1]);Ma&&(Ma.enabled=!0);Jb&&!Wa&&(na.setContext(aa.getFocused().context),aa.repaint(0,0,na.width-1,na.height-1))}function yb(a){if(r){hi5.browser.cookie.delete(Hb);
svGlobal.logger.warn("closed "+(r.sessionInfo.appInfo?r.sessionInfo.appInfo.numericId:0));r.onagentmessage&&(r.onagentmessage=null);if(r.onagentclose)r.onagentclose();var b=Bc();b&&r.sessionInfo.appInfo&&0==r.mode&&(sessionStorage[b]=r.sessionInfo.appInfo.session);if(r&&(b=1!=r.mode,!Ha&&b&&Eb("connection"),b=b&&(Ha||tb<r.reconnectTimes)&&0<tb&&!a,Xa=Ha=!1,b)){tb--;__svi18n.info.reconnecting&&r.showMessage(__svi18n.info.reconnecting+" "+(r.reconnectTimes-tb)+"/"+r.reconnectTimes,null,3E3);setTimeout(bc,
ca.reconnectInterval||5E3);svGlobal.logger.info("Reconnecting..."+tb);return}if(ic)svGlobal.logger.info("Req credential");else{Qa&&(r.stopPing(),Qa=null);Ka&&(Ka.removeEventListener("message",Cc,!1),Ka.postMessage({type:0,cmd:4}),Ka.terminate(),Ka=null);Ma&&(Ma.release(),Ma=null);Sa=p=null;Ea&&(Ea.close(),Ea=null);kb&&hi5.Arrays.release(kb);ib&&hi5.Arrays.release(ib);Ya&&(Ya.stop(),Ya=null);Ta&&(Ta.close(),Ta=null);Bb=null;try{if(r.onclose)r.onclose(a);else if(svGlobal.logger.info("onclose: null"),
hi5.appcfg&&hi5.appcfg.returnUrl){window.location.href=hi5.appcfg.returnUrl;return}aa&&(aa.close(),aa=null)}catch(c){svGlobal.logger.warn(c)}Va=null;Aa&&(Aa.onopen=null,Aa.onmessage=null,Aa.onclose=null,Aa.onerror=null,Aa.close(),Aa=null);aa=Ra=null;na&&(na.release(),na=null);hi5.browser.isChromeApp?chrome.runtime.onSuspend.removeListener(r.close):window.removeEventListener("unload",r.close,!1);window&&window.$rdp==r&&(window.$rdp=null);r=null}}}function Pc(){Aa&&Ha?Aa.close():yb(!0)}function Ec(a,
b){var c=a.getLittleEndian32();if(0!=(c&16777216))if(b=a.getLittleEndian32(),0!=(c&1073741824)){a.getLittleEndian16();a.getByte();c=a.getByte();var e=a.getLittleEndian16(),d=a.getLittleEndian16(),k=0;16>c&&(k=a.getLittleEndian16());var g=a.getLittleEndian16(),B=a.getLittleEndian16();a.getBytes(g);k&&a.getBytes(k);if(8<=c&&(k=aa.getFocused())&&k.onremoteappicon){g=new hi5.graphic.Bitmap(e,d,32);a.getPosition();e=new Uint8Array(e*d*4);d=a.getPosition();B=d+B;var x;a=a.getData();for(var D=0,F,w;d<B;)switch(c){case 16:(x=
a[d++]|a[d++]<<8)?(w=x>>7&248,F=x>>2&248,x=x<<3&248,w|=w>>5,F|=F>>5,x|=x>>5,e[D++]=x,e[D++]=F,e[D++]=w,e[D++]=255):D+=4;break;case 32:e[D++]=a[d++],e[D++]=a[d++],e[D++]=a[d++],e[D++]=a[d++]}g.putPixels(e,0,e.length);a=aa.getWinById(b);k.onremoteappicon(a,g)}}else 0!=(c&2147483648)?svGlobal.logger.info("XXX rail cache icon, winId="+b):0!=(c&536870912)?(svGlobal.logger.info("***** delete winId="+b),aa.delWin(b)):Id(a,c,b);else if(0!=(c&33554432))svGlobal.logger.info("XXX Alt Sec window Notify="+c);
else if(0!=(c&67108864))if(svGlobal.logger.info("*** -- Alt Sec window Desktop, flags:"+c),0!=(c&1))svGlobal.logger.info("Desktop non monitored flags="+c);else{if(0!=(c&32)&&(b=a.getLittleEndian32(),svGlobal.logger.info("Desktop monitored flags="+c+" winId="+b),0<b&&((k=aa.getOwnerSurfaceById(b))&&k.railWin&&k.railWin.setActiveWinId(b,3==ca.windowState),aa.setTitle(b),na.getContext()||(b=aa.getFocused())&&na.setContext(b.context))),0!=(c&16)&&(b=a.getByte(),0<b))for(c=aa.zOrders,c.length=b,k=0;k<
b;k++)c[k]=a.getLittleEndian32(),svGlobal.logger.info("---zorders:"+c[k])}else svGlobal.logger.info("XXX Alt Sec window order flgas="+c)}function Qc(a){var b=aa.getFocused();if(b&&b.railWin){var c=a||b.railWin.mainWin;if(c&&2<c.showState){var e=b.getFreeSpace();a=Math.max(Math.abs(c.winHeight-e.height),Math.abs(c.winWidth-e.width));svGlobal.logger.info("--- fitMainWin offset:"+a+" _hOffset:"+c._hOffset+" appId:"+c.appId+" spaceH:"+e.height);0<a?(b=a==c._hOffset,c._hOffset&&b||(c._hOffset=a,setTimeout(function(){c.resize(0,
0,e.width,e.height)},333))):c._hOffset=0}}}function Id(a,b,c){Wa||(Wa=!0);var e=0==(b&268435456),d=aa.getWinById(c);d?e=!0:d=new aa.LocalWin(c);svGlobal.logger.info("\n\n=========== winId="+c+" existed="+e);if(d){0!=(b&2)&&(d.ownerWinid=a.getLittleEndian32(),svGlobal.logger.info("***** ownerWinid="+d.ownerWinid));0!=(b&8)&&(d.style=a.getLittleEndian32(),d.extStyle=a.getLittleEndian32(),svGlobal.logger.info("***** winId="+c+" style="+d.style+" extStyle="+d.extStyle),svGlobal.logger.info("*****--- WS_POPUP="+
(0!=(d.style&2147483648))),svGlobal.logger.info("*****--- WS_DLGFRAME="+(0!=(d.style&4194304))),svGlobal.logger.info("*****--- DS_MODALFRAME="+(0!=(d.style&128))),svGlobal.logger.info("*****--- WS_EX_DLGMODALFRAME="+(0!=(d.extStyle&1))),svGlobal.logger.info("*****--- WS_EX_TOOLWINDOW="+(0!=(d.extStyle&128))),svGlobal.logger.info("*****--- WS_BORDER="+(0!=(d.style&8388608))),svGlobal.logger.info("*****--- WS_CAPTION="+(0!=(d.style&12582912))),svGlobal.logger.info("*****--- WS_OVERLAPPED="+(0!=(d.style&
0))),svGlobal.logger.info("*****--- WS_OVERLAPPEDWINDOW="+(0!=(d.style&13565952))),svGlobal.logger.info("*****--- WS_POPUPWINDOW="+(0!=(d.style&2156396544))),svGlobal.logger.info("*****--- WS_SIZEBOX="+(0!=(d.style&262144))),svGlobal.logger.info("*****--- WS_CHILD="+(0!=(d.style&1073741824))),svGlobal.logger.info("*****--- WS_SIZEBOX="+(0!=(d.style&262144))),svGlobal.logger.info("*****--- WS_EX_MDICHILD="+(0!=(d.extStyle&64))),svGlobal.logger.info("*****--- WS_EX_LAYERED="+(0!=(d.extStyle&524288))));
if(0!=(b&16)){d.setShowState(a.getByte());svGlobal.logger.info("***** winId="+c+" showState="+d.showState);var k=d.showState;(2==k&&0!=ca.noMinimize||!e&&3==k&&5==ca.windowState)&&setTimeout(function(){d.exeCommand(61728)},50)}if(k=0!=(b&4)){var g=a.getLittleEndian16();d.titleInfo=a.getUnicodeString(g,!1);svGlobal.logger.info("***** winId="+c+" title="+d.titleInfo)}0!=(b&16384)&&(d.clientOffsetX=a.getLittleEndian32(),d.clientOffsetY=a.getLittleEndian32(),svGlobal.logger.info("***** winId="+c+" coffX"+
d.clientOffsetX+" coffY="+d.clientOffsetY));0!=(b&65536)&&(d.clientAreaWidth=a.getLittleEndian32(),d.clientAreaHeight=a.getLittleEndian32(),svGlobal.logger.info("***** winId="+c+" cw"+d.clientAreaWidth+" ch="+d.clientAreaHeight));0!=(b&131072)&&(d.rpContent=a.getLittleEndian32());0!=(b&262144)&&(d.rootParentHandle=a.getLittleEndian32());if(0!=(b&2048)){g=a.getLittleEndian32();var B=a.getLittleEndian32();d.winOffsetX=g;d.winOffsetY=B;svGlobal.logger.info("***** winId="+c+" offX"+d.winOffsetX+" offY="+
d.winOffsetY)}0!=(b&32768)&&(d.winClientDeltaX=a.getLittleEndian32(),d.winClientDeltaY=a.getLittleEndian32(),svGlobal.logger.info("***** winId="+c+" dX"+d.winClientDeltaX+" dY="+d.winClientDeltaY));0!=(b&1024)&&(d.winWidth=a.getLittleEndian32(),d.winHeight=a.getLittleEndian32(),svGlobal.logger.info("***** winId="+c+" w"+d.winWidth+" h="+d.winHeight));if(!e)if(d.isMainWin())3==r.windowState?Qc(d):setTimeout(function(){d.activate(1)},666);else if(2<d.showState&&(g=aa.getFocused())){g=g.getFreeSpace();
var x=d.winWidth,D=d.winHeight;if(d.winOffsetX>g.width||d.winOffsetY>g.height||0>x+d.winOffsetX||0>D+d.winOffsetY){var F=(g.width-d.winWidth)/2|0,w=(g.height-d.winHeight)/2|0;0>F&&(F=0);0>w&&(w=0);setTimeout(function(){d.resize(F,w,x,D)},50)}}0!=(b&256)&&(g=a.getLittleEndian16(),0<g&&a.skipPosition(8*g));0!=(b&4096)&&(d.visibleOffsetX=a.getLittleEndian32(),d.visibleOffsetY=a.getLittleEndian32());0!=(b&512)&&(b=a.getLittleEndian16(),d.numVisibilityRects=b,0<b&&a.skipPosition(8*b));if(e)aa.onWinChange(d);
else aa.addWin(d);k&&aa.setTitle(c);c==aa.zOrders[0]?svGlobal.logger.info("zzz zorders win: "+c):svGlobal.logger.info("zzz win: "+c,aa.zOrders)}else svGlobal.logger.warn("XXX, No win with id:"+c)}function vc(a,b){function c(f,n,h,t,y){0<y.width?y.union(f,n,h,t):(y.x=f,y.y=n,y.width=h,y.height=t)}function e(f,n,h,t){for(fa=0;fa<la;fa++){var y=S[fa];if(f>=y[0]&&n>=y[1]&&h<=y[2]&&t<=y[3])return ia[fa]}return null}function d(f,n,h,t){if(la){var y=e(f,n,f+h-1,n+t-1);y&&c(f,n,h,t,y)}else c(f,n,h,t,u)}function k(f,
n,h,t,y,z,E){for(var C=y*h+t,A=f.setRGB,T=f.getRGB,J=0;J<E;J++){for(var m=0;m<z;m++){if(f){var H=T(t+m,y+J);A(t+m,y+J,~H&16777215)}else n[C]=~n[C]&16777215;C++}C+=h-z}}function g(f,n,h,t,y,z,E,C,A,T){n=T*C+A;null==E&&(E=f);for(f=0;f<z;f++){for(A=0;A<y;A++)v[t+f][h+A]=v[t+f][h+A]&E[n]&16777215|4278190080,n++;n+=C-y}}function B(f,n,h,t,y,z,E,C,A,T){n=T*C+A;A=f.setRGB;T=f.getRGB;null==E&&(E=f);for(f=0;f<z;f++){for(var J=0;J<y;J++){var m=T(h+J,t+f);A(h+J,t+f,m|E[n]&16777215);n++}n+=C-y}}function x(f,
n,h,t){var y=ma;if(y){var z=y.getRGB(n,h);switch(f){case 0:y.setRGB(n,h,0);break;case 1:y.setRGB(n,h,~(z|t)&16777215);break;case 2:y.setRGB(n,h,z&~t&16777215);break;case 3:y.setRGB(n,h,~t&16777215);break;case 4:y.setRGB(n,h,16777215*(~z&t));break;case 5:y.setRGB(n,h,~z&16777215);break;case 6:y.setRGB(n,h,z^t&16777215);break;case 7:y.setRGB(n,h,~z&t&16777215);break;case 8:y.setRGB(n,h,z&t&16777215);break;case 9:y.setRGB(n,h,z^~t&16777215);break;case 10:break;case 11:y.setRGB(n,h,z|~t&16777215);break;
case 12:y.setRGB(n,h,t);break;case 13:y.setRGB(n,h,(~z|t)&16777215);break;case 14:y.setRGB(n,h,z|t&16777215);break;case 15:y.setRGB(n,h,16777215);break;default:svGlobal.logger.warn("unsupported pixel opcode: "+f),y.setRGB(n,h,t)}}}function D(f,n,h,t,y,z,E,C,A){f>C||n>A||(h=f+h-1,h>C&&(h=C),f<z&&(f=z),h=h-f+1,t=n+t-1,t>A&&(t=A),n<E&&(n=E),t=t-n+1,1>h||1>t||ma.fillRect(f,n,h,t,y))}function F(f,n,h,t,y,z,E,C,A,T,J,m){if(!(n>J||h>m)){var H=n+t-1;H>J&&(H=J);A=n<A?A:n;H=H-n+1;J=h+y-1;J>m&&(J=m);T=h<T?T:
h;m=J-h+1;if(!(1>H||1>m)){J=128;var K=0;E|=4278190080;C|=4278190080;if(A==n&&T==h&&H==t&&m==y)if(0==f)for(var O=0;O<y;O++){f=h+O;for(var Z=0;Z<t;Z++)0==J&&(K++,J=128),0!=(z[K]&J)&&(v[f][n+Z]=C),J>>=1;K++;J=128;K==z.length&&(K=0)}else for(O=0;O<y;O++){f=h+O;for(Z=0;Z<t;Z++)0==J&&(K++,J=128),v[f][n+Z]=0!=(z[K]&J)?C:E,J>>=1;K++;J=128;K==z.length&&(K=0)}else if(0==f)for(O=0;O<m;O++){f=h+O;for(Z=0;Z<H;Z++)0==J&&(K++,J=128),n+Z>=A&&f>=T&&0!=(z[K]&J)&&(v[f][n+Z]=C),J>>=1;K++;J=128;K==z.length&&(K=0)}else for(O=
0;O<m;O++){f=h+O;for(Z=0;Z<H;Z++)0==J&&(K++,J=128),n+Z>=A&&h+O>=T&&(v[f][n+Z]=0!=(z[K]&J)?C:E),J>>=1;K++;J=128;K==z.length&&(K=0)}}}}function w(f,n,h,t,y){this.offset=f;this.baseLine=n;this.width=h;this.height=t;this.fontData=y}function l(f,n,h,t,y,z,E,C,A){this.cache_idx=f;this.rawData=n;this.none=!n;this.hotX=h;this.hotY=t;this.width=y;this.height=z;this.xorSize=C;this.andSize=A;this.result="";this.distance=0;this.bpp=E;this.system="";if(n){if(!this.distance){f=0;if(n){E=0;for(var T=n.length;E<
T;E++)0!=n[E]&&(f+=E%y+(E/y|0))}this.distance=f}if(!this.system){a:switch(this.distance){case 507:f="text";break a;case 2046:case 4359:f="default";break a;default:f=""}this.system=f}}f="";if(!this.system&&n){E=y*z*4;f=62+E+C+A;T=new Uint8Array(f);f=new hi5.DataBuffer(T,0,f);f.setLittleEndian16(0);f.setLittleEndian16(2);f.setLittleEndian16(1);f.setByte(y);f.setByte(z);f.setByte(0);f.setByte(0);f.setLittleEndian16(h);f.setLittleEndian16(t);f.setLittleEndian32(40+E+C+A);f.setLittleEndian32(22);f.setLittleEndian32(40);
f.setLittleEndian32(y);f.setLittleEndian32(2*z);f.setLittleEndian16(1);f.setLittleEndian16(32);f.setLittleEndian32(0);f.setLittleEndian32(C+A);f.setLittleEndian32(0);f.setLittleEndian32(0);f.setLittleEndian32(0);f.setLittleEndian32(0);for(h=z-1;0<=h;h--)for(t=0;t<y;t++)z=n[y*h+t],f.setByte(z&255),f.setByte(z>>8&255),f.setByte(z>>16&255),f.setByte(z>>24&255);f="data:image/x-icon;base64,"+hi5.Base64.enc(f.getData())}this.url=f}var v=[],q=null,u=new hi5.graphic.Rectangle(0,0,0,0),M="Uint8ClampedArray"in
window,P=null,U=0,N=0,I=0,W=0,V=null,S,ia,fa=0,la=0;this.width=a;this.height=b;var Ca=!1,ma=this,pa={imgData:null,left:0,top:0,width:0,height:0,drawable:null};this.setProfiler=function(f){P=f};this.getDirtyArea=function(){return u};this.setImgRect=function(f,n,h,t){U=f;N=n;I=h;W=t};this.setDrawable=function(f){pa.drawable=f};this.getDrawable=function(){return pa.drawable};this.parseMonitorDef=function(f){var n=f.split(","),h=n.length,t=[];if(1<h){for(var y=!1,z=0;z<h;z++){var E=n[z].split(":");if(4==
E.length)t[z]=Array(5),t[z][0]=parseInt(E[0]),t[z][1]=parseInt(E[1]),t[z][2]=parseInt(E[2]),t[z][3]=parseInt(E[3]),t[z][4]=0==t[z][0]&&0==t[z][1]?1:0;else{y=!0;break}}y&&(svGlobal.logger.warn("invaiid monitorDef:"+f),t.length=0)}return t};this.setMonitorLayout=function(f){var n=f.length,h=0;S=f;for(ia=Array(n);h<n;h++)ia[h]=new hi5.graphic.Rectangle(0,0,0,0);la=n};this.setMonitorCount=function(f){la=f};this.addImg=function(f){I&&(V&&URL.revokeObjectURL(V.src),V=f)};this.flushImgs=function(){V&&(URL.revokeObjectURL(V.src),
V=null,I=0)};this.getData=function(){return v};this.pause=function(f,n){Ca=f;n&&q&&q.fillRect(0,0,a,b)};this.release=function(){u=null;hi5.Arrays.release(ia);ma.flushImgs();v=q=ma=null;pa=pa.imgData=null};this.isPaused=function(){return Ca};this.setContext=function(f){f!=q&&(q||!f||f.createImageData(1,1).data.buffer||(M=!1),q=f,null!=q&&(pa.imgData=q.createImageData(a,b)))};this.getContext=function(){return q};this.resize=function(f,n){if(v.length!=n||v[0].length!=f){for(var h=0;h<n;h++)v[h]=new Uint32Array(f);
v.length=n;ma.width=a=f;ma.height=b=n;null!=q&&(pa.imgData=q.createImageData(a,b))}};ma.resize(a,b);this.getBuffer=function(){return v};this.setRGB=function(f,n,h){v[n][f]=h|4278190080};this.getRGB=function(f,n){return v[n][f]};this.setRGBs=function(f,n,h,t,y,z,E){var C=f+h,A=n+t;A>b&&(A=b);if(!(f>=a)){C>a&&(h-=C-a);for(C=n;C<A;C++,z+=E)v[C].set(y.subarray(z,z+h),f);d(f,n,h,t)}};this.moveArea=function(f,n,h,t,y,z){if(0<z){var E=f+y,C=n+z,A;for(A=t-1;0<=A;A--)v[C+A].set(v[n+A].subarray(f,f+h),E)}else if(0>
z)for(E=f+y,C=n+z,A=0;A<t;A++)v[C+A].set(v[n+A].subarray(f,f+h),E);else if(0<y){E=f+y;C=n+z;var T;for(A=h-1;0<=A;A--){var J=E+A;var m=f+A;for(T=0;T<t;T++)v[C+T][J]=v[n+T][m]}}else for(E=f+y,C=n+z,A=0;A<h;A++)for(J=E+A,m=f+A,T=0;T<t;T++)v[C+T][J]=v[n+T][m];d(f+y,n+z,h,t)};this.getRGBs=function(f,n,h,t,y){var z=new Uint32Array(h*t),E=f+h;t=n+t;for(var C=0;n<t;n++)z.set(v[n].subarray(f,E),C),C+=h;return y?(y(z),null):z};this.repaint=function(f,n,h,t){var y=pa.imgData.data,z=0,E,C;P&&P.begin("paint");
0>f&&(h+=f,f=0);0>n&&(t+=n,n=0);f+h>a&&(h=a-f);n+t>b&&(t=b-n);var A=f+h;var T=n+t;if(M)for(y=new Uint32Array(y.buffer),C=n;C<T;C++)y.set(v[C].subarray(f,A),z),z+=a;else{var J=4*(a-h)|0;for(C=n;C<T;C++){for(E=f;E<A;E++){var m=v[C][E];y[z++]=m&255;y[z++]=m>>8&255;y[z++]=m>>16&255;y[z++]=255}z+=J}}pa.left=f;pa.top=n;pa.width=h;pa.height=t;P&&P.end("paint");return pa};this.postPaint=d;this.draw=function(f,n,h,t){if(!Ca)if(pa.drawable){if(u.width)return pa.left=u.x,pa.top=u.y,pa.width=u.width,pa.height=
u.height,u.width=0,pa}else if(q)if(V&&V.complete&&(q.drawImage(V,U,N,I,W),URL.revokeObjectURL(V.src),V=null),la){if(f=e(f,n,h,t),f.width)return ma.repaint(f.x,f.y,f.width,f.height),f.width=0,pa}else if(u.width)return ma.repaint(u.x,u.y,u.width,u.height),u.width=0,pa;return null};this.fillRect=function(f,n,h,t,y){var z=f+h,E=n+t;if(v[0].fill)for(var C,A=n;A<E;A++)v[A].fill(y,f,z);else for(A=n;A<E;A++)for(C=f;C<z;C++)v[A][C]=y;d(f,n,h,t)};this.drawLine=function(f,n,h,t,y){if(n==t){if(f>h){var z=f;f=
h;h=z}var E=v[n];h++;if(E.fill)E.fill(y,f,h);else for(z=f;z<h;z++)E[z]=y}else if(f==h)for(n>t&&(z=n,n=t,t=z),t++,z=n;z<t;z++)v[z][f]=y;else{var C=Math.abs(h-f),A=Math.abs(t-n);z=f;E=n;h=h>=f?f=1:f=-1;n=t>=n?t=1:t=-1;if(C>=A){n=f=0;var T=C;var J=C/2|0;var m=A}else t=h=0,T=A,J=A/2|0,m=C,C=A;if(!(1>C))for(C++,A=0;A<C;A++)v[E][z]=y,J+=m,J>=T&&(J-=T,z+=f,E+=t),z+=h,E+=n}};this.bitBlt=function(f,n,h,t,y,z,E,C,A,T){var J=ma;switch(f){case 0:C=J.setRGB;for(J=h;J<h+y;J++)for(A=t;A<t+z;A++)C(J,A,0);break;case 1:f=
E;A=T*C+A;T=J.setRGB;n=J.getRGB;null==f&&(f=J);for(J=0;J<z;J++){for(E=0;E<y;E++)T(h+y,t+z,~(n(h+y,t+z)|f[A])&16777215);A+=C-y}break;case 2:f=E;A=T*C+A;T=J.setRGB;n=J.getRGB;null==f&&(f=J);for(J=0;J<z;J++){for(E=0;E<y;E++){var m=n(h+y,t+z);T(h+y,t+z,m&~f[A]&16777215);A++}A+=C-y}break;case 3:k(J,E,C,A,T,y,z);E?J.setRGBs(h,t,y,z,E,T*C+A,C):J.moveArea(A,T,y,z,h-A,t-T);break;case 4:k(J,null,n,h,t,y,z);g(J,n,h,t,y,z,E,C,A,T);break;case 5:k(J,null,n,h,t,y,z);break;case 6:f=E;A=T*C+A;null==f&&(f=J);for(J=
0;J<z;J++){for(T=0;T<y;T++)v[t+J][h+T]=v[t+J][h+T]^f[A]&16777215|4278190080,A++;A+=C-y}break;case 7:f=E;A=T*C+A;T=J.setRGB;n=J.getRGB;null==f&&(f=J);for(J=0;J<z;J++){for(E=0;E<y;E++)m=n(h+E,t+J),T(h+E,t+J,~(m&f[A])&16777215),A++;A+=C-y}break;case 8:g(J,n,h,t,y,z,E,C,A,T);break;case 9:f=E;A=T*C+A;T=J.setRGB;n=J.getRGB;null==f&&(f=J);for(J=0;J<z;J++){for(E=0;E<y;E++)m=n(h+E,t+J),T(h+E,t+J,m^~f[A]&16777215),A++;A+=C-y}break;case 10:break;case 11:f=E;A=T*C+A;T=J.setRGB;n=J.getRGB;null==f&&(f=J);for(J=
0;J<z;J++){for(E=0;E<y;E++)m=n(h+E,t+J),T(h+E,t+J,m|~f[A]&16777215),A++;A+=C-y}break;case 12:E?J.setRGBs(h,t,y,z,E,T*C+A,C):J.moveArea(A,T,y,z,h-A,t-T);break;case 13:k(J,null,n,h,t,y,z);B(J,n,h,t,y,z,E,C,A,T);break;case 14:B(J,n,h,t,y,z,E,C,A,T);break;case 15:C=J.setRGB;for(J=h;J<h+y;J++)for(A=t;A<t+z;A++)C(J,A,16777215);break;default:svGlobal.logger.warn("unsupported opcode: "+f)}d(h,t,y,z)};this.drawLineExt=function(f,n,h,t,y,z){if(f==h||n==t){var E;if(n==t)if(h>f){var C=h-f;if(!(1>C))for(E=0;E<
C;E++)x(z,f+E,n,y)}else{if(C=f-h,!(1>C))for(E=0;E<C;E++)x(z,h+E,n,y)}else if(t>n){if(C=t-n,!(1>C))for(E=0;E<C;E++)x(z,f,n+E,y)}else if(C=n-t,!(1>C))for(E=0;E<C;E++)x(z,f,t+E,y)}else{var A=Math.abs(h-f),T=Math.abs(t-n);E=f;C=n;var J,m;var H=h>=f?J=1:J=-1;var K=t>=n?m=1:m=-1;if(A>=T){K=J=0;var O=A;var Z=A/2>>0;var ha=T}else m=H=0,O=T,Z=T/2>>0,ha=A,A=T;if(1>A)return;for(T=0;T<=A;T++)x(z,E,C,y),Z+=ha,Z>=O&&(Z-=O,E+=J,C+=m),E+=H,C+=K}y=Math.min(f,h);f=Math.max(f,h);h=Math.min(n,t);n=Math.max(n,t);0>f-
y||0>n-h||d(y,h,f-y+1,n-h+1)};this.drawText=function(f,n,h,t,y,z,E,C,A,T,J,m,H,K,O,Z,ha,xa,Fa,La,Da){var ua=0;1<m?D(T,J,m,H,y,xa,Fa,La,Da):1==h&&D(z,E,C,A,y,xa,Fa,La,Da);for(var Pa=Z,ta=0;ta<Z;)switch(ha[ua+ta]){case 255:var va=ha[ua+ta+2];if(va>Pa-ua){ta=Z=0;break}va=ha.slice?ha.slice(ua,ua+va):ha.subarray(ua,ua+va);ya[ha[ua+ta+1]]=va;ta+=3;Z-=ta;ua=ta;ta=0;break;case 254:var Na=(va=ya[ha[ua+ta+1]])?va:null;Na&&0==Na[1]&&0==(n&32)&&(0!=(n&4)?O+=ha[ua+ta+2]:K+=ha[ua+ta+2]);ta=ta+2<Z?ta+3:ta+2;Z-=
ta;ua=ta;ta=0;if(!Na)break;for(var Ua=Na.length,Za=0;Za<Ua;Za++){va=Ga.getFont(f,Na[Za]);if(0==(n&32)){var $a=Na[++Za];0!=($a&128)?(0!=(n&4)?O+=Na[Za+1]|Na[Za+2]<<8:K+=Na[Za+1]|Na[Za+2]<<8,Za+=2):0!=(n&4)?O+=$a:K+=$a}va&&(F(h,K+va.offset&65535,O+va.baseLine&65535,va.width,va.height,va.fontData,y,t,xa,Fa,La,Da),0!=(n&32)&&(K+=va.width))}break;default:va=Ga.getFont(f,ha[ua+ta]),0==(n&32)&&($a=ha[ua+ ++ta],0!=($a&128)?(0!=(n&4)?O+=ha[ua+ta+1]|ha[ua+ta+2]<<8:K+=ha[ua+ta+1]|ha[ua+ta+2]<<8,ta+=2):0!=(n&
4)?O+=$a:K+=$a),va&&(F(h,K+va.offset&65535,O+va.baseLine&65535,va.width,va.height,va.fontData,y,t,xa,Fa,La,Da),0!=(n&32)&&(K+=va.width)),ta++}1<m?0<H&&d(T,J,m,H):0<C&&0<A&&d(z,E,C,A)};this.drawBitmap=function(f,n,h,t,y,z,E,C,A){var T=da.getBitmap(f,n);T?(f=T.width,n=T.height,y>f&&(y=f),z>n&&(z=n),12==A?ma.setRGBs(h,t,y,z,T.data,C*f+E,f):ma.bitBlt(A,a,h,t,y,z,T.data,f,E,C)):svGlobal.logger.warn("Failed to get bitmap from cache, id:"+f+" idx="+n)};this.saveDesktop=function(f,n,h,t,y){ma.getRGBs(f,n,
h,t,function(z){za.save(f,n,h,t,y,z)})};this.restoreDesktop=function(f,n,h,t,y){(y=za.restore(f,n,h,t,y))?ma.setRGBs(f,n,h,t,y,0,h):svGlobal.logger.warn("XXX no matched desktop save.")};this.putFont=function(f,n,h){Ga.putFont(f,n,h)};this.putBitmap=function(f,n,h){da.putBitmap(f,n,h)};this.putCursor=function(f,n){qa.set(f,n)};this.setCursor=function(f){if(!Ca&&-1!=f){var n=qa.get(f);if(n)ma.onSetCursor(n);else svGlobal.logger.warn("invalid cursor"+f)}};var ka=0;this.isSendingHistory=function(){return 2E3>
Date.now()-ka};this.getHistory=function(f,n){var h=null;(h=qa.toPDU())&&f(h.buffer);if(ma.onGetGfxHistory)ma.onGetGfxHistory(f,n);else{P&&P.begin("his_bitmap");da.forEach(function(C,A,T){if(C){var J=0,m=0;T=0;for(var H=C.length;T<H;T++)C[T]&&C[T].data&&(J++,m+=C[T].raw?C[T].raw.length:4*C[T].data.length);if(J&&m){h=new Uint8Array(m+20*J+8);h[0]=29;h[2]=1;h[3]=4;m=new hi5.DataBuffer(h,4,h.length);m.setLittleEndian32(J);for(T=0;T<H;T++)(J=C[T])&&J.data&&(m.setLittleEndian16(A),m.setLittleEndian16(T),
m.setLittleEndian16(J.left),m.setLittleEndian16(J.top),m.setLittleEndian16(J.width),m.setLittleEndian16(J.height),m.setLittleEndian16(J.bitsperpixel),m.setLittleEndian16(J.codec),m.setLittleEndian32(J.raw?J.raw.length:4*J.data.length),m.setBytes(J.raw||new Uint8Array(J.data.buffer)));f(h.buffer)}}});P&&P.end("his_bitmap");P&&P.begin("his_font");(h=Ga.toPDU())&&f(h.buffer);P&&P.end("his_font");for(var t=4,y=0,z=ya.length;y<z;y++)ya[y]&&(t+=ya[y].length+6);if(4<t){h=new Uint8Array(t);h[0]=29;h[2]=1;
h[3]=7;var E=4;y=0;for(z=ya.length;y<z;y++)ya[y]&&ya[y].length&&(h[E++]=y,h[E++]=y>>8,t=ya[y].length,h[E++]=t,h[E++]=t>>8,h[E++]=t>>16,h[E++]=t>>24,h.set(ya[y],E),E+=t);f(h.buffer)}(h=za.toPDU())&&f(h.buffer);n();ka=Date.now()}};this.onHistoryDone=function(){pa.drawable&&r.reconnect(a,b,!0)};this.setHistory=function(f,n){svGlobal.logger.info("setHistory type:"+f);switch(f){case 4:P&&P.begin("his_bitmap_dec");var h=n.getLittleEndian32();for(f=0;f<h;f++){var t=n.getLittleEndian16(),y=n.getLittleEndian16(),
z=n.getLittleEndian16(),E=n.getLittleEndian16(),C=n.getLittleEndian16(),A=n.getLittleEndian16(),T=n.getLittleEndian16(),J=n.getLittleEndian16(),m=n.getLittleEndian32(),H=new Uint8Array(n.getData().buffer,n.getPosition(),m),K=new Uint8Array(m);K.set(H);H=rdpcodecs.bitmap;switch(J){case 0:var O=new Uint32Array(K.buffer);n.skipPosition(m);break;case 1:switch(T){case 16:O=H.decompressInt16(C,A,m,K,0);break;case 24:O=H.decompressInt24(C,A,m,K,0);break;case 32:O=H.decompressInt32(C,A,m,K,0)}n.skipPosition(m);
break;case 2:O=new rdpcodecs.NSCodec,O.process(n,T,C,A),m=O.getData(),O=O.getDataSize(),O=new Uint32Array(O),rdpcodecs.flipimage(m,0,O,C,A,1)}da.putBitmap(t,y,new rdpcodecs.Bitmap(O,C,A,z,E,T,0==J?null:K,J))}P&&P.end("his_bitmap_dec");break;case 5:Ga.fromStream(n);break;case 6:qa.fromStream(n);break;case 7:for(;n.has(6);)if(f=n.getLittleEndian16(),m=n.getLittleEndian32())h=n.getData().subarray(n.getPosition(),n.getPosition()+m),ya[f]=h,n.skipPosition(m);break;case 9:za.fromStream(n);break;default:if(ma.onSetGfxHistory)ma.onSetGfxHistory(f,
n)}};var qa=new function(){var f=[],n=!1;this.useRemoteCursor=function(h){n=h};this.set=function(h,t){n&&(t.system="");f[h]=t};this.get=function(h){return f[h]};this.total=function(){return f.length};this.toPDU=function(){for(var h=2,t=2,y=0,z=0,E=f.length,C;z<E;z++)if(C=f[z])y++,t=t+7+(C.rawData?C.rawData.length:0);if(!y)return null;t=new Uint32Array(t);t[0]=100728861;t[1]=y;for(z=0;z<E;z++)if(C=f[z])if(y=C.rawData?C.rawData.length:0,t[h++]=C.cache_idx|C.bpp<<16,t[h++]=C.hotX|C.hotY<<16,t[h++]=C.width|
C.height<<16,t[h++]=C.xorSize,t[h++]=C.andSize,t[h++]=C.distance,t[h++]=y)t.set(C.rawData,h),h+=y;return t};this.fromStream=function(h){var t=h.getPosition();h=new Uint32Array(h.getData().buffer,t);var y=h[0],z=0;for(t=1;z<y;z++){var E=h[t]&65535;var C=h[t++]>>16;var A=h[t]&65535;var T=h[t++]>>16;var J=h[t]&65535;var m=h[t++]>>16;var H=h[t++];var K=h[t++];var O=h[t++];var Z=h[t++];var ha=null;Z&&(ha=new Uint32Array(Z),ha.set(h.subarray(t,t+Z)),t+=Z);C=new l(E,ha,A,T,J,m,C,H,K);O&&(C.distance=O);n&&
(C.system="");f[E]=C}}};qa.useRemoteCursor(!!ca.remoteCursor);var za=new function(){function f(h,t,y,z,E,C){this.x=h;this.y=t;this.cx=y;this.cy=z;this.offset=E;this.data=C}var n=[];this.save=function(h,t,y,z,E,C){h=new f(h,t,y,z,E,C);t=0;for(y=n.length;t<y;t++)if(!n[t]){n[t]=h;return}n.push(h)};this.restore=function(h,t,y,z,E){for(var C,A=0,T=n.length;A<T;A++)if((C=n[A])&&C.x==h&&C.y==t&&C.cx==y&&C.cy==z){if(C.offset==E)return h=C.data,n[A]=null,h;svGlobal.logger.warn("TODO: offset")}return null};
this.toPDU=function(){for(var h=0,t=2,y=0,z=n.length;y<z;y++)n[y]&&(h++,t+=n[y].data.length+6);if(!h||!t)return null;t=new Uint32Array(t);var E=2;t[0]=151060509;t[1]=h;for(y=0;y<z;y++)if(h=n[y])t[E++]=h.x,t[E++]=h.y,t[E++]=h.cx,t[E++]=h.cy,t[E++]=h.offset,t[E++]=h.data.length,t.set(h.data,E),E+=h.data.length;return t};this.fromStream=function(h){h=new Uint32Array(h.getData().buffer,h.getPosition());for(var t=1,y=h[0],z,E,C,A,T,J,m,H=0;H<y;H++)z=h[t++],E=h[t++],C=h[t++],A=h[t++],T=h[t++],J=h[t++],
m=new Uint32Array(J),J=t+J,m.set(h.subarray(t,J)),t=J,this.save(z,E,C,A,T,m)}},ya=[],Ga=new function(){var f=[];this.putFont=function(n,h,t){f[n]||(f[n]=[]);f[n][h]=t};this.getFont=function(n,h){return f[n]?f[n][h]:null};this.toPDU=function(){var n=0,h,t,y;var z=4;for(var E,C=f.length;n<C;n++)if((y=f[n])&&y.length)for(E=y.length,h=0;h<E;h++)(t=y[h])&&(z+=15+t.fontData.length);if(5>z)return null;var A=new Uint8Array(z);z=new hi5.DataBuffer(A,0,z);A[0]=29;A[2]=1;A[3]=5;z.skipPosition(4);n=0;for(C=f.length;n<
C;n++)if((y=f[n])&&y.length)for(E=y.length,h=0;h<E;h++)if(t=y[h])z.setByte(n),z.setLittleEndian16(h),z.setLittleEndian16(t.offset),z.setLittleEndian16(t.baseLine),z.setLittleEndian16(t.width),z.setLittleEndian16(t.height),z.setLittleEndian32(t.fontData.length),z.setBytes(t.fontData);return A};this.fromStream=function(n){for(;n.has(15);){var h=n.getByte(),t=n.getLittleEndian16(),y=n.getLittleEndian16(),z=n.getLittleEndian16(),E=n.getLittleEndian16(),C=n.getLittleEndian16(),A=n.getLittleEndian32();
A=n.getBytes(A);this.putFont(h,t,new w(y,z,E,C,A))}}},da=new function(){var f=[],n=[];this.putBitmap=function(h,t,y){if(32767==t)n[h]&&(n[h].data=null,n[h]=null),n[h]=y;else{var z=f[h];z?z[t]&&(z[t].data=null,z[t]=null):f[h]=z=[];z[t]=y}};this.getBitmap=function(h,t){return 32767==t?n[h]:f[h]?f[h][t]:null};this.forEach=function(h){for(var t=f.length,y=0;y<t;y++)h(f[y],y,f)}}}function mc(a){function b(m,H,K){H[K]=m>>24&255;H[K+1]=m>>16&255;H[K+2]=m>>8&255;H[K+3]=m&255}function c(m,H){var K=m.length;
H=new Uint8Array(H?K+1:K);for(var O=0;O<K;O++)H[O]=m.charCodeAt(O);return H}var e=new Uint8Array([0,0,0,0]),d=new Uint8Array([255,255,255,255]),k={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],mvex:[],mvhd:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[],mehd:[]},g=this,B=1,x=a?48E3:9E4,D=1,F=!1,w=null;this.initTypes=function(){for(var m in k)k[m]=
[m.charCodeAt(0),m.charCodeAt(1),m.charCodeAt(2),m.charCodeAt(3)];k.url=[117,114,108,32]};g.initTypes();this.reset=function(){F=!1;D=B=1};this.close=function(){g&&(g.reset(),g=null)};this.remux=function(m){m.id=B;m.isAudio=a;m.timeScale=a?m.audioHeader.sampleRate:x;if(!F){var H=new v(a),K=new q(m);w=new Uint8Array(H.data.length+K.data.length);w.set(H.data,0);w.set(K.data,H.data.length);F=!0}m.sequenceNumber=D++;H=new y(m);K=new J(m);m=new Uint8Array(H.data.length+K.data.length);m.set(H.data,0);m.set(K.data,
H.data.length);w&&(H=new Uint8Array(w.length+m.length),H.set(w,0),H.set(m,w.length),m=H,w=null);if(g.ondata)g.ondata(m)};var l=function(m){this.type=m;this.data=null};l.prototype.setData=function(){var m=Array.prototype.slice.call(arguments,0),H=m.length,K=8,O;for(O=0;O<H;O++)K+=m[O].byteLength;this.data=new Uint8Array(K);b(K,this.data,0);this.data.set(this.type,4);K=8;for(O=0;O<H;O++)this.data.set(m[O],K),K+=m[O].byteLength};var v=function(m){var H=l.call(this,k.ftyp)||this;var K=c("mp42"),O=c("mp41"),
Z=c("isom"),ha=c("avc1"),xa=c("iso5"),Fa=new Uint8Array([0,0,2,0]);m?H.setData(K,Fa,K,O,Z,xa):H.setData(Z,Fa,Z,O,xa,ha);return H};$jscomp.inherits(v,l);var q=function(m){var H=l.call(this,k.moov)||this;var K=new u(m),O=new M(m);m=new h(m);H.setData(K.data,O.data,m.data);return H};$jscomp.inherits(q,l);var u=function(m){m=l.call(this,k.mvhd)||this;var H=new Uint8Array([0]),K=new Uint8Array([0,0,0]),O=new Uint8Array([0,0,0,0]),Z=new Uint8Array([0,0,0,0]),ha=new Uint8Array(4);b(1E3,ha,0);var xa=new Uint8Array([0,
1,0,0]),Fa=new Uint8Array([1,0]),La=new Uint8Array(10),Da=new Uint8Array(36);Da[1]=1;Da[17]=1;Da[32]=64;var ua=new Uint8Array(24),Pa=new Uint8Array([255,255,255,255]);m.setData(H,K,O,Z,ha,e,xa,Fa,La,Da,ua,Pa);return m};$jscomp.inherits(u,l);var M=function(m){var H=l.call(this,k.trak)||this;var K=new P(m);m=new U(m);H.setData(K.data,m.data);return H};$jscomp.inherits(M,l);var P=function(m){var H=l.call(this,k.tkhd)||this;var K=new Uint8Array([0]),O=new Uint8Array([0,0,7]),Z=new Uint8Array([0,0,0,0]),
ha=new Uint8Array([0,0,0,0]),xa=new Uint8Array(4);b(m.id,xa,0);var Fa=new Uint8Array(4),La=new Uint8Array(8),Da=new Uint8Array([0,0]),ua=new Uint8Array([0,0]),Pa=m.isAudio?new Uint8Array([1,0]):new Uint8Array([0,0]),ta=new Uint8Array(2),va=new Uint8Array(36);va[1]=1;va[17]=1;va[32]=64;var Na=new Uint8Array(4);Na[0]=m.width>>8&255;Na[1]=m.width&255;Na[2]=0;Na[3]=0;var Ua=new Uint8Array(4);Ua[0]=m.height>>8&255;Ua[1]=m.height&255;Ua[2]=0;Ua[3]=0;H.setData(K,O,Z,ha,xa,Fa,e,La,Da,ua,Pa,ta,va,Na,Ua);return H};
$jscomp.inherits(P,l);var U=function(m){var H=l.call(this,k.mdia)||this;var K=new N(m),O=new I(m);m=new W(m);H.setData(K.data,O.data,m.data);return H};$jscomp.inherits(U,l);var N=function(m){var H=l.call(this,k.mdhd)||this;var K=new Uint8Array([0]),O=new Uint8Array([0,0,0]),Z=new Uint8Array([0,0,0,0]),ha=new Uint8Array([0,0,0,0]),xa=new Uint8Array(4);b(m.timeScale,xa,0);m=new Uint8Array([85,196]);var Fa=new Uint8Array(2);H.setData(K,O,Z,ha,xa,e,m,Fa);return H};$jscomp.inherits(N,l);var I=function(m){var H=
l.call(this,k.hdlr)||this;var K=new Uint8Array([0]),O=new Uint8Array([0,0,0]),Z=new Uint8Array(4);m=m.isAudio?c("soun"):c("vide");var ha=new Uint8Array(12),xa=c("Remote Spark Handler",!0);H.setData(K,O,Z,m,ha,xa);return H};$jscomp.inherits(I,l);var W=function(m){var H=l.call(this,k.minf)||this;var K=new ia,O=new Ca(m);m.isAudio?(m=new S,H.setData(m.data,K.data,O.data)):(m=new V,H.setData(m.data,K.data,O.data));return H};$jscomp.inherits(W,l);var V=function(){var m=l.call(this,k.vmhd)||this;var H=
new Uint8Array([0]),K=new Uint8Array([0,0,1]),O=new Uint8Array([0,0]),Z=new Uint8Array(6);m.setData(H,K,O,Z);return m};$jscomp.inherits(V,l);var S=function(){var m=l.call(this,k.smhd)||this;var H=new Uint8Array([0]),K=new Uint8Array([0,0,0]),O=new Uint8Array([0,0]),Z=new Uint8Array(2);m.setData(H,K,O,Z);return m};$jscomp.inherits(S,l);var ia=function(){var m=l.call(this,k.dinf)||this;var H=new fa;m.setData(H.data);return m};$jscomp.inherits(ia,l);var fa=function(){var m=l.call(this,k.dref)||this;
var H=new Uint8Array([0]),K=new Uint8Array([0,0,0]),O=new Uint8Array([0,0,0,1]),Z=new la;m.setData(H,K,O,Z.data);return m};$jscomp.inherits(fa,l);var la=function(){var m=l.call(this,k.url)||this;var H=new Uint8Array([0]),K=new Uint8Array([0,0,1]);m.setData(H,K);return m};$jscomp.inherits(la,l);var Ca=function(m){var H=l.call(this,k.stbl)||this;m=new ma(m);var K=new Ga,O=new da,Z=new f,ha=new n;H.setData(m.data,K.data,O.data,Z.data,ha.data);return H};$jscomp.inherits(Ca,l);var ma=function(m){var H=
l.call(this,k.stsd)||this;var K=new Uint8Array([0]),O=new Uint8Array([0,0,0]),Z=new Uint8Array([0,0,0,1]);m.isAudio?(m=new pa(m),H.setData(K,O,Z,m.data)):(m=new qa(m),H.setData(K,O,Z,m.data));return H};$jscomp.inherits(ma,l);var pa=function(m){var H=l.call(this,k.mp4a)||this;var K=new Uint8Array(6),O=new Uint8Array([0,1]),Z=new Uint8Array(8),ha=new Uint8Array([0,2]),xa=new Uint8Array([0,16]),Fa=new Uint8Array([0,0]),La=new Uint8Array(2),Da=m.audioHeader.sampleRate,ua=new Uint8Array(4);ua[0]=Da>>8&
255;ua[1]=Da&255;ua[2]=0;ua[3]=0;m=new ka(m);H.setData(K,O,Z,ha,xa,Fa,La,ua,m.data);return H};$jscomp.inherits(pa,l);var ka=function(m){var H=l.call(this,k.esds)||this;var K=new Uint8Array([0]),O=new Uint8Array([0,0,0]),Z=new Uint8Array([3]),ha=new Uint8Array([25]),xa=new Uint8Array([0,0]),Fa=new Uint8Array([0]),La=new Uint8Array([4]),Da=new Uint8Array([17]),ua=new Uint8Array([64]),Pa=new Uint8Array([21]),ta=new Uint8Array(3),va=m.bufferSizeDB;ta[0]=va>>16&255;ta[1]=va>>8&255;ta[2]=va&255;va=new Uint8Array(4);
b(m.bitRate,va,0);var Na=new Uint8Array(4);b(m.bitRate,Na,0);var Ua=new Uint8Array([5]),Za=new Uint8Array([2]),$a=m.audioHeader.audioType||2,gb=m.audioHeader.frequencyIdx,lb=m.audioHeader.channelConfig;m=new Uint8Array(2);m[0]=$a<<3|gb>>1&7;m[1]=(gb&1)<<7|lb<<3;$a=new Uint8Array([6]);gb=new Uint8Array([1]);lb=new Uint8Array([2]);H.setData(K,O,Z,ha,xa,Fa,La,Da,ua,Pa,ta,va,Na,Ua,Za,m,$a,gb,lb);return H};$jscomp.inherits(ka,l);var qa=function(m){var H=l.call(this,k.avc1)||this;var K=new Uint8Array(6),
O=new Uint8Array([0,1]),Z=new Uint8Array([0,0]),ha=new Uint8Array(2),xa=new Uint8Array(12),Fa=new Uint8Array(2);Fa[0]=m.width>>8&255;Fa[1]=m.width&255;var La=new Uint8Array(2);La[0]=m.height>>8&255;La[1]=m.height&255;var Da=new Uint8Array([0,72,0,0]),ua=new Uint8Array([0,72,0,0]),Pa=new Uint8Array(4),ta=new Uint8Array([0,1]),va=c("SparkStreamPlayer"),Na=new Uint8Array(32);Na[0]=va.length;Na.set(va,1);va=new Uint8Array([0,24]);var Ua=new Uint8Array([255,255]);m=new za(m);H.setData(K,O,Z,ha,xa,Fa,La,
Da,ua,Pa,ta,Na,va,Ua,m.data);return H};$jscomp.inherits(qa,l);var za=function(m){var H=l.call(this,k.avcC)||this;var K=new Uint8Array([1]),O=new Uint8Array([m.sps[1]]),Z=new Uint8Array([m.sps[2]]),ha=new Uint8Array([m.sps[3]]),xa=new Uint8Array([255]),Fa=new Uint8Array([225]),La=new Uint8Array(2),Da=m.sps.byteLength;La[0]=Da>>8&255;La[1]=Da&255;Da=new Uint8Array(m.sps);var ua=new Uint8Array([1]),Pa=new Uint8Array(2),ta=m.pps.byteLength;Pa[0]=ta>>8&255;Pa[1]=ta&255;m=new Uint8Array(m.pps);H.setData(K,
O,Z,ha,xa,Fa,La,Da,ua,Pa,m);return H};$jscomp.inherits(za,l);var ya=function(){var m=l.call(this,k.btrt)||this;var H=new Uint8Array([0,28,156,128]),K=new Uint8Array([0,45,198,192]),O=new Uint8Array([0,45,198,192]);m.setData(H,K,O);return m};$jscomp.inherits(ya,l);var Ga=function(){var m=l.call(this,k.stts)||this;var H=new Uint8Array([0]),K=new Uint8Array([0,0,0]),O=new Uint8Array([0,0,0,0]);m.setData(H,K,O);return m};$jscomp.inherits(Ga,l);var da=function(){var m=l.call(this,k.stsc)||this;var H=new Uint8Array([0]),
K=new Uint8Array([0,0,0]),O=new Uint8Array([0,0,0,0]);m.setData(H,K,O);return m};$jscomp.inherits(da,l);var f=function(){var m=l.call(this,k.stsz)||this;var H=new Uint8Array([0]),K=new Uint8Array([0,0,0]),O=new Uint8Array([0,0,0,0]),Z=new Uint8Array([0,0,0,0]);m.setData(H,K,O,Z);return m};$jscomp.inherits(f,l);var n=function(){var m=l.call(this,k.stco)||this;var H=new Uint8Array([0]),K=new Uint8Array([0,0,0]),O=new Uint8Array([0,0,0,0]);m.setData(H,K,O);return m};$jscomp.inherits(n,l);var h=function(m){var H=
l.call(this,k.mvex)||this;m=new t(m);H.setData(m.data);return H};$jscomp.inherits(h,l);ya=function(m){m=l.call(this,k.mehd)||this;var H=new Uint8Array([0]),K=new Uint8Array([0,0,0]);m.setData(H,K,d);return m};$jscomp.inherits(ya,l);var t=function(m){var H=l.call(this,k.trex)||this;var K=new Uint8Array([0]),O=new Uint8Array([0,0,0]),Z=new Uint8Array(4);b(m.id,Z,0);m=new Uint8Array([0,0,0,1]);var ha=new Uint8Array([0,0,0,0]),xa=new Uint8Array([0,0,0,0]),Fa=new Uint8Array([0,0,0,0]);H.setData(K,O,Z,
m,ha,xa,Fa);return H};$jscomp.inherits(t,l);var y=function(m){var H=l.call(this,k.moof)||this;z.setSequenceNumber(m.sequenceNumber);m=new E(m);H.setData(z.data,m.data);return H};$jscomp.inherits(y,l);ya=function(m){var H=l.call(this,k.mfhd)||this;var K=new Uint8Array([0]),O=new Uint8Array([0,0,0]),Z=new Uint8Array(4);b(m,Z,0);H.setData(K,O,Z);return H};$jscomp.inherits(ya,l);ya.prototype.setSequenceNumber=function(m){b(m,this.data,12)};var z=new ya(1),E=function(m){var H=l.call(this,k.traf)||this;
C.setTrackId(m.id);C.setSampleDuration(m.frameDuration);A.setBaseMediaDecodeTime(m.samples[0].timestamp);var K=32+C.data.length+A.data.length;if(m.isAudio)m=new T(m,null,K);else{for(var O=[],Z=0;Z<m.samples.length;Z++){var ha=m.samples[Z];O.push({size:ha.unitsLength+4*ha.units.length,duration:m.frameDuration||3E3,compositionTimeOffset:0,flags:{isLeading:0,dependsOn:ha.hasIDR?2:1,isDependedOn:0,hasRedundancy:0,isNonSync:ha.hasIDR?0:1,degradationPriority:0}})}m=new T(m,O,K)}H.setData(C.data,A.data,
m.data);return H};$jscomp.inherits(E,l);ya=function(m,H){var K=l.call(this,k.tfhd)||this;K.isAudio=H;var O=new Uint8Array([0]),Z=H?new Uint8Array([2,0,10]):new Uint8Array([2,0,40]),ha=new Uint8Array(4);b(m,ha,0);H?(m=new Uint8Array([0,0,0,1]),H=new Uint8Array(4),b(1024,H,0),K.setData(O,Z,ha,m,H)):(m=new Uint8Array([0,0,2,0,1,1,0,0]),K.setData(O,Z,ha,m));return K};$jscomp.inherits(ya,l);ya.prototype.setTrackId=function(m){b(m,this.data,12)};ya.prototype.setSampleDuration=function(m){this.isAudio||
b(m,this.data,16)};var C=new ya(0,a);ya=function(m){var H=l.call(this,k.tfdt)||this;var K=new Uint8Array([0]),O=new Uint8Array([0,0,0]),Z=new Uint8Array(4);b(m,Z,0);H.setData(K,O,Z);return H};$jscomp.inherits(ya,l);ya.prototype.setBaseMediaDecodeTime=function(m){b(m,this.data,12)};var A=new ya(0),T=function(m,H,K){var O=l.call(this,k.trun)||this;var Z=new Uint8Array([0]),ha=m.isAudio?new Uint8Array([0,2,1]):new Uint8Array([0,15,1]),xa=m.isAudio?4:16;K+=xa*(m.isAudio?m.samples.length:H.length)+28;
var Fa=new Uint8Array(4);m.isAudio?b(m.samples.length,Fa,0):b(H.length,Fa,0);var La=new Uint8Array(4);b(K,La,0);if(m.isAudio){K=new Uint8Array(xa*m.samples.length);for(var Da=0;Da<m.samples.length;Da++)b(m.samples[Da].aacData.byteLength,K,xa*Da)}else for(K=new Uint8Array(xa*H.length),Da=0;Da<H.length;Da++){m=H[Da];var ua=xa*Da;b(m.duration,K,ua);b(m.size,K,ua+4);var Pa=m.flags,ta=new Uint8Array(4);ta[0]=Pa.isLeading<<2|Pa.dependsOn;ta[1]=Pa.isDependedOn<<6|Pa.hasRedundancy<<4|0|Pa.isNonSync;ta[2]=
Pa.degradationPriority&61440;ta[3]=Pa.degradationPriority&15;K.set(ta,ua+8);b(m.compositionTimeOffset,K,ua+12)}O.setData(Z,ha,Fa,La,K);return O};$jscomp.inherits(T,l);ya=function(m){var H=l.call(this,k.sdtp)||this;for(var K=new Uint8Array([0]),O=new Uint8Array([0,0,0]),Z=new Uint8Array(m.length),ha=0;ha<m.length;ha++){var xa=m[ha].flags;Z[ha]=xa.isLeading<<6|xa.dependsOn<<4|O.isDependedOn<<2|O.hasRedundancy}H.setData(K,O,Z);return H};$jscomp.inherits(ya,l);var J=function(m){var H=l.call(this,k.mdat)||
this;if(m.isAudio){for(var K=new Uint8Array(m.totalByteLength),O=0,Z=0;Z<m.samples.length;Z++){var ha=m.samples[Z].aacData;K.set(ha,O);O+=ha.byteLength}H.setData(K)}else{K=new Uint8Array(4*m.unitNum+m.totalByteLength);for(Z=O=0;Z<m.samples.length;Z++){ha=m.samples[Z];for(var xa=0;xa<ha.units.length;xa++){var Fa=ha.units[xa],La=Fa.data.byteLength;b(La,K,O);O+=4;K.set(Fa.data,O);O+=La}}H.setData(K)}return H};$jscomp.inherits(J,l)}function nc(a){function b(D,F){this.aacData=D;this.timestamp=F}function c(D,
F,w,l){this.audioType=D;this.frequencyIdx=F;this.sampleRate=w;this.channelConfig=l}var e=nc.SAMPLING_FREQUENCY,d=null,k=!0,g=this,B=0;this.reset=function(){B=0;d=null;x.audioHeader=null;a&&a.reset()};var x=new function(){this.samples=[];this.duration=0;this.audioHeader=null;this.height=this.width=0;this.bufferSizeDB=1536;this.totalByteLength=this.bitRate=0;this.clear=function(){this.samples=[];this.totalByteLength=this.bitRate=this.duration=0}};this.setMediaFormat=function(D,F){var w=D.frequencyIdx;
w||(w=e.indexOf(D.sampleRate));-1==w&&console.error("Invalid AAC sampel rate: "+D.sampleRate);d=new c(D.audioType||2,w,D.sampleRate,D.channels||D.channelConfig);x.audioHeader=d;k=!F;if(g.oncodec)g.oncodec("mp4a.40.2",d)};this.parseAACData=this.parse=function(D){if(k){var F=g.readADTSHeader(D);D=D.subarray(F)}F=new b(D,B);B+=1024;x.samples.push(F);x.totalByteLength+=D.byteLength;D=1/(d.sampleRate/1024);x.duration=D;x.samples[0]&&(x.bitRate=8*x.samples[0].aacData.length/D|0);a&&a.remux(x);x.clear()};
this.readADTSHeader=function(D){var F=D[1]&0?9:7,w=(D[2]>>6&3)+1,l=D[2]>>2&15,v=e[l];v||console.error("Invalid Sampling Frequency Index: "+l);var q=((D[2]&1)<<2)+(D[3]>>6&3),u=D[1]>>1&3;0!=u&&console.error("Invalid data format: layer is not 0x00: "+u.toString(16));D.length!=((D[3]&3)<<11)+(D[4]<<3)+(D[5]>>5&7)&&console.error("No enough data in one ADTS frame, length= "+D.length);if(d){if(l!=d.frequencyIdx&&(d.frequencyIdx=l,d.sampleRate=v,g.oncodec))g.oncodec("mp4a.40.2",d)}else if(d=new c(w,l,v,
q),x.audioHeader=d,g.oncodec)g.oncodec("mp4a.40.2",d);return F}}function Jd(a){function b(){0==B&&console.error("no data available");var F=0,w=g-B;for(x=0;w<g;){var l=a[w];if(3!=l||0!=a[w-1]||0!=a[w-2])x=x<<8|l,F++;w++;if(4<=F)break}4>F&&(x<<=4-F);D=8*F;B=g-w}function c(F){if(!(D>F)){F-=D;var w=F>>3;F-=w>>3;B-=w;b()}x<<=F;D-=F}function e(F){var w=Math.min(D,F),l=x>>>32-w;32<F&&logger.error("Read more than 32 bits:"+F);D-=w;0<D?x<<=w:0<B&&b();w=F-w;return 0<w?l<<w|e(w):l}function d(){var F;for(F=0;F<
D;++F)if(0!==(x&2147483648>>>F))return x<<=F,D-=F,F;b();return F+d()}function k(){c(1+d())}var g=a.byteLength,B=g,x=0,D=0;this.readUEG=function(){var F=d();return e(F+1)-1};this.readEG=function(){var F=this.readUEG();return 1&F?1+F>>>1:-1*(F>>>1)};this.readBool=function(){return 1===e(1)};this.readU8=function(){return e(8)};this.readU16=function(){return e(16)};this.readU32=function(){return e(32)};this.skipScalingList=function(F){var w=8,l=8,v;for(v=0;v<F;v++)0!==l&&(l=this.readEG(),l=(w+l+256)%
256),w=0===l?w:l};this.readSPS=function(){var F=0,w=0,l=0,v=0,q=1,u,M=0,P=!0,U=this.readU8();var N=this.readU8();e(5);c(3);this.readU8();k();if(100===N||110===N||122===N||244===N||44===N||83===N||86===N||118===N||128===N||138===N||139===N||134===N||135===N){var I=this.readUEG();3===I&&c(1);k();k();c(1);if(this.readBool()){var W=3!==I?8:12;for(u=0;u<W;u++)this.readBool()&&(6>u?this.skipScalingList(16):this.skipScalingList(64))}}k();u=this.readUEG();if(0===u)this.readUEG();else if(1===u)for(c(1),c(1+
d()),c(1+d()),W=this.readUEG(),u=0;u<W;u++)c(1+d());k();c(1);u=this.readUEG();W=this.readUEG();var V=e(1);0===V&&c(1);c(1);this.readBool()&&(F=this.readUEG(),w=this.readUEG(),l=this.readUEG(),v=this.readUEG());if(this.readBool()){if(this.readBool()){switch(this.readU8()){case 1:var S=[1,1];break;case 2:S=[12,11];break;case 3:S=[10,11];break;case 4:S=[16,11];break;case 5:S=[40,33];break;case 6:S=[24,11];break;case 7:S=[20,11];break;case 8:S=[32,11];break;case 9:S=[80,33];break;case 10:S=[18,11];break;
case 11:S=[15,11];break;case 12:S=[64,33];break;case 13:S=[160,99];break;case 14:S=[4,3];break;case 15:S=[3,2];break;case 16:S=[2,1];break;case 255:S=[this.readU8()<<8|this.readU8(),this.readU8()<<8|this.readU8()]}S&&(q=S[0]/S[1])}this.readBool()&&c(1);this.readBool()&&(c(4),this.readBool()&&c(24));this.readBool()&&(k(),k());this.readBool()&&(M=this.readU32(),S=this.readU32(),P=this.readBool(),M=S/(2*M))}return{width:Math.ceil((16*(u+1)-2*F-2*w)*q),height:(2-V)*(W+1)*16-(V?2:4)*(l+v),configVer:U,
profileIdc:N,chromaFormatIdc:I,frameCropLeftOffset:F,frameCropRightOffset:w,frameCropTopOffset:l,frameCropBottomOffset:v,fps:M,fixedFrameRate:P}};this.readSliceType=function(){this.readU8();this.readUEG();return this.readUEG()}}function Kd(a){function b(){this.height=this.width=0;this.codec="";this.pps=this.sps=null;this.frameDuration=3E3;this.samples=[];this.sequence=this.unitNum=this.totalByteLength=0;this.clear=function(){this.unitNum=this.totalByteLength=this.samples.length=0}}function c(){this.units=
B;this.unitsLength=x;this.timestamp=d;this.hasIDR=k}function e(){var l=!1;if(g&&F.sps){var v=new c;d+=F.frameDuration||3E3;F.samples.push(v);F.totalByteLength+=x;F.unitNum+=B.length;F.sequence++;l=!0;if(v.hasIDR&&w.onkeyframe)w.onkeyframe(v)}g=k=!1;B=[];x=0;return l}var d=0,k=!1,g=!1,B=[],x=0,D=mc.searchStartCode,F=null,w=this;F=new b;this.reset=function(){d=0;k=!1;B=[];x=0;F=new b;a&&a.reset()};this.close=function(){w&&(w.reset(),w=null)};this.parseH264Data=this.parse=function(l){for(var v=[],q=
0,u,M,P,U=[0,0];q<l.byteLength;){U[0]=q;D(l,U);var N=U[0];if(-1==N)break;q=U[1];q=N+q;P=l[q];P&=31;u&&(u={type:M,data:l.subarray(u,N)},v.push(u));u=q;M=P}u&&(u={type:M,data:l.subarray(u,l.byteLength)},v.push(u));for(l=0;l<v.length;l++)switch(U=v[l],q=U.type,q){case 1:case 2:case 3:case 4:B.push(U);x+=U.data.byteLength;g=!0;break;case 5:g=k=!0;B.push(U);x+=U.data.byteLength;break;case 6:break;case 7:u=U.data;q="avc1."+(0==u[1]?"00":u[1].toString(16));q+=0==u[2]?"00":u[2].toString(16);q+=0==u[3]?"00":
u[3].toString(16);u=new Jd(U.data);u=u.readSPS();F.width=u.width;F.height=u.height;F.codec=q;F.sps=U.data;u.fps&&(F.frameDuration=9E4/u.fps|0);B.push(U);x+=U.data.byteLength;if(w.oncodec)w.oncodec(q,u);break;case 8:F.pps=U.data;B.push(U);x+=U.data.byteLength;break;case 9:e();break;default:console.log("Ignore NAL unit with type = "+q)}e()&&(a.remux(F),F.clear())}}function Kb(a,b,c){function e(){for(;x;){if(M.updating){x=!1;break}var N=B.shift();if(!N)break;try{M.appendBuffer(N),D=0}catch(I){B.unshift(N);
if("QuotaExceededError"==I.name)if(g(!0))continue;else{if(F.onerror)F.onerror(I);else console.log("QuotaExceededError: not recoverable, isAudio: "+c),F.close();break}D++;console.error("Failed to append buffer, retry "+D,I);if(2<D){if(F.onerror)F.onerror(I);break}}}}function d(){x=!0;e()}function k(){M=u.addSourceBuffer(w);M.mode="sequence";M.addEventListener("updateend",d);M.addEventListener("error",function(N){console.error(N)});x=!0;F.play(!1);e()}function g(N){var I=Math.min(a.played.end(0),M.buffered.end(0)),
W=0,V=q.length,S=!1,ia=0;if(c)ia=I-180,0>ia&&console.warn("Not possible, time played secs: "+I);else if(1<V){var fa=V-2;for(I=9E4*I|0;W<V;){if(q[W]>I){fa=W-2;break}W++}0<=fa&&(ia=(q[fa]+1E3)/9E4)}if(0<ia)try{M.remove(0,ia),q.splice(0,fa+1),S=!0,console.info("Buffer removed "+ia+" isAudio: "+c)}catch(la){console.warn("Buffer removal "+ia+" failed, retry, isAudio: "+c)}N||(v=setTimeout(g,18E4));return S}var B=[],x=!1,D=0,F=this,w="",l=null,v=0,q=[],u=null,M=null,P=null,U=null;a.autoplay=!0;this.getKeyFrames=
function(){return q};P=new mc(c);P.ondata=function(N){B.push(N);e()};U=c?new nc(P):new Kd(P);U.onkeyframe=function(N){q.push(N.timestamp)};U.oncodec=function(N,I){var W=c?"audio/mp4;codecs=":"video/mp4;codecs=";W+=N;if(W!=w||(c?l.sampleRate!=I.sampleRate:l.width!=I.width||l.height!=I.height))if(w=W,l=I,x=!1,M=null,u=new MediaSource,u.addEventListener("sourceopen",k),a.src=URL.createObjectURL(u),F.onsps)F.onsps(I)};b.onvideoframe=function(N){U.parse(N)};b.onaudioframe=function(N){U.parse(N)};b.onendofstream=
function(){F.reset()};this.play=function(N){a.play().catch(function(I){if(!N&&(console.error(I),F.onplayerror))F.onplayerror(I)})};this.reset=function(){console.log("Reset player");v&&(clearTimeout(v),v=0);q.length=0;x=!1;w="";l=null;b&&b.reset&&b.reset();U&&U.reset();B.length=0};this.close=function(){F&&(F.reset(),u&&(u.endOfStream(),a.src=null),U&&U.close(),P&&P.close(),F=null)};this.setMediaFormat=function(N,I){U.setMediaFormat&&U.setMediaFormat(N,I)};a.addEventListener("ended",function(N){console.warn(".... ended");
v&&(clearTimeout(v),v=0)});a.addEventListener("emptied",function(N){x=!!M});a.addEventListener("pause",function(N){console.warn(".... paused");x=!!M;a.play().catch(function(I){console.error(I)})});a.addEventListener("waiting",function(N){x=!!M})}this.displayMsg=this.reconnectOnResize=!0;this.appTimeout=1600;this.reconnectTimes=0;this.windowState=3;this.setTitle=this.openLink=!0;this.sessionInfo={domain:"",userName:"",sessionId:0,joinedSessions:[],suppressOutput:!1,appInfo:null,joiners:[]};this.mode=
0;this.remoteAppLogin=!0;var Jb=!1,kb={},ib={},zb=null,r=this,ic=!1,Xa=!1,cb=0,Ab=null,Rc=0;hi5.appcfg||(hi5.appcfg={img:{},toolbar:{fadable:!0},displayMsg:!0});var ca=hi5.appcfg,Hb="";this.setConfig=function(a){ca=a};var bb="object"==typeof p?p:null,L=bb?{}:hi5.tool.queryToObj(p.substring(p.indexOf("?")+1));void 0==L.mapClipboard&&ca.clipboard&&void 0!=ca.clipboard.enabled&&(L.mapClipboard=ca.clipboard.enabled);void 0==ca.enableDVCAudio&&(ca.enableDVCAudio=!0);var Ia=0,Ja=0,fb=(ea||L.color||L.server_bpp||
16)|0,kc=null,Sc=null,Qa=null,Gb=null,Tc="/DOWNLOAD?",Uc="/CLIP?";24==fb&&(fb=16);var Wa="app"==L.startProgram,Ib=Q(L.mapDisk),mb=0;this.setLinks=function(a){a.download&&(Tc=a.download);a.clipboard&&(Uc=a.clipboard)};this.protocol=bb?"":p.substring(0,p.indexOf("://")).toLowerCase();this.hasSmartCard=function(){return Q(L.smartCard)||Q(L.mapSmartCard)||Q(L.passwordIsPin)};this.enableWebAuthn=function(){return Q(L.enableWebAuthn)||Q(L.useWebAuthn)};this.hasScanner=function(){return Q(L.scanner)};this.hasUSB=
function(){return Q(L.mapUSB)&&!!navigator.usb};this.getUSB=function(){return L.usb||hi5.appcfg.usb||{filters:[{classCode:0},{classCode:2},{classCode:5},{classCode:6},{classCode:10},{classCode:13},{classCode:239},{classCode:220},{classCode:239},{classCode:254},{classCode:255}]}};this.setProfiler=function(a){Sc=a};this.getProfiler=function(){return Sc};this.gateway=function(){if(bb)return"";var a=p.lastIndexOf("/RDP?");-1==a&&(a=p.lastIndexOf("/JOIN?"));-1==a&&(a=p.lastIndexOf("/PLAY?"));return p.substring(0,
a).replace(/wss:\/\//ig,"https://").replace(/ws:\/\//ig,"http://")}();svGlobal.logger.warn("Ver:"+svGlobal.version+" build:"+svGlobal.build);this.getGatewayAddr=sa;var jb="object"==typeof p||0<p.indexOf("/PLAY?"),Vc=!jb&&0<p.indexOf("invitation=");if(Vc){var oc=decodeURIComponent(p),Lb=oc.indexOf(' USERNAME="');if(0<Lb){Lb+=11;var Ld=oc.substring(Lb,oc.indexOf('"',Lb));p+="&novice="+Ld}p+="&mapClipboard=on";L.mapClipboard="on";this.reconnectOnResize=!1}if(jb)this.mode=1,bb?p="":(Ia=640,Ja=480),p+=
"&touchpad=on",L.touchpad="on",this.reconnectOnResize=!1;else if(0<p.indexOf("/JOIN?")||Vc)this.mode=2,this.reconnectOnResize=!1;var pc=Q(L.gfx)||Q(L.remotefx)||0<r.mode;pc&&(Wa?pc=!1:fb=32);G?Ia=parseInt(G):L.width&&(Ia=parseInt(L.width));R?Ja=parseInt(R):L.height&&(Ja=parseInt(L.height));-1==Ia&&(Ia=hi5.browser.getScreenWidth());-1==Ja&&(Ja=hi5.browser.getScreenHeight());L.symlink&&L.parameters&&hi5.tool.queryToObj(L.parameters,L);L.gateway||(p+="&gateway="+encodeURIComponent(r.gateway));!L.minWidth&&
ca.minWidth&&(L.minWidth=ca.minWidth);!L.minHeight&&ca.minHeight&&(L.minHeight=ca.minHeight);L.minWidth&&(L.minWidth=parseInt(L.minWidth));L.minHeight&&(L.minHeight=parseInt(L.minHeight));L.waWidth=L.waWidth?parseInt(L.waWidth):hi5.browser.isAndroid||hi5.browser.isiOS?Math.max(screen.width,screen.height):screen.width;L.waWidth&=-4;L.waHeight=L.waHeight?parseInt(L.waHeight):hi5.browser.isAndroid||hi5.browser.isiOS?Math.max(screen.width,screen.height):screen.height;L.waHeight&=-4;"useSSL"in L||(p+=
"&useSSL="+("wss"==r.protocol));hi5.storage.isAvailable&&(Q(L.shareClipboard)||L.shareClipboardId)&&(p+="&shareClipboardId="+(L.shareClipboardId||X()));ca&&(void 0!=ca.displayMsg?this.displayMsg=ca.displayMsg:ca.displayMsg=this.displayMsg,ca.appTimeout&&(this.appTimeout=ca.appTimeout),void 0!=ca.reconnectOnResize&&(this.reconnectOnResize=ca.reconnectOnResize),ca.reconnectTimes&&(this.reconnectTimes=ca.reconnectTimes),void 0!=ca.windowState&&(this.windowState=ca.windowState),void 0!=ca.openLink&&(this.openLink=
ca.openLink),void 0!=ca.setTitle&&(this.setTitle=ca.setTitle),"boolean"==typeof ca.useWSS&&(p=(ca.useWSS?"wss":"ws")+p.substring(p.indexOf("://"))),"boolean"==typeof ca.remoteAppLogin&&(this.remoteAppLogin=ca.remoteAppLogin,Jb=!ca.remoteAppLogin,svGlobal.logger.warn("remoteAppLogin deprecated, use hideLogin in appcfg.js instead")),"boolean"==typeof ca.hideLogin&&(Jb=ca.hideLogin),void 0!=ca.localPrinter&&void 0==L.localPrinter&&(L.localPrinter=ca.localPrinter));var Ma=null;void 0==ca.useWorker&&(ca.useWorker=
!1);ca.useWorker&&(!window.Worker||hi5.browser.isFirefox||Wa&&!hi5.browser.isIE||"file:"==location.protocol||0<navigator.userAgent.indexOf("MSIE 10."))&&(ca.useWorker=!1);void 0==hi5.libMin&&(hi5.libMin=!0);var Ka=ca.useWorker?new Worker(oa("rdpworker",hi5.libMin?"rdpworker_min.js":"rdpworker.js")):null,tb=this.reconnectTimes,Xb=Ka?{type:5,data:null}:null;this.getDisplayName=Y;this.server=Y();this.port=parseInt(L.port,10);this.loadbalanceToken="";ca.loadbalanceTokenName&&(L[ca.loadbalanceTokenName]?
ba(L[ca.loadbalanceTokenName]):!1!==ca.randomAppId?ba(hi5.tool.uuid()):svGlobal.logger.info("Using app.id as loadbalanceToken"));this.modifyURL=function(a){r.loadbalanceToken&&(a+=-1==a.indexOf("?")?"?"+r.loadbalanceToken:"&"+r.loadbalanceToken,a+="&loadbalanceTokenName="+ca.loadbalanceTokenName);return a};this.getURL=function(){return p};this.getRuntimeURL=function(){var a=p+"&width="+Ia+"&height="+Ja+"&server_bpp="+fb+"&audio="+(Ta.available||hi5.browser.isIE),b=Bc(),c="";b&&(c=sessionStorage[b]||
"")&&(c="&preSymJoin="+c);a+=c;var e=L.monitorDef,d=L.monitor,k=0;b=aa.size();var g=Array(b);c=Array(b);var B=0,x=0,D=0,F=0,w=0,l=0,v="";if(e){c=na.parseMonitorDef(e);for(b=c.length;k<b;k++){var q=c[k];q[0]<D&&(D=q[0]);q[1]<F&&(F=q[1]);q[2]>w&&(w=q[2]);q[3]>l&&(l=q[3])}0>D&&(B=-D);0>F&&(x=-F);q=0>d?[D,F,w,l]:c[d];L.width=q[2]-q[0]+1;L.height=q[3]-q[1]+1;k=aa.getSurface(0);k.setMonitor(q[0],q[1],q[2],q[3]);if(B||x)for(q=k.getMousePosition(),q.left+=B,q.right+=B,q.top+=x,q.bottom+=x,k=0;k<b;k++)q=c[k],
q[0]+=B,q[1]+=x,q[2]+=B,q[3]+=x;na.setMonitorLayout(c);0>d&&na.setMonitorCount(0);r.reconnectOnResize=!1;b="&monitorDef="+e+"&width="+L.width+"&height="+L.height}else{if(1<b&&!Wa){for(aa.verifyMonitors();k<b;k++)e=aa.getSurface(k),q=e.getMousePosition(),q.left<D&&(D=q.left),q.top<F&&(F=q.top),q.right>w&&(w=q.right),q.bottom>l&&(l=q.bottom),g[k]=q,v&&(v+=","),v+=q.left+":"+q.top+":"+q.right+":"+q.bottom;0>D&&(B=-D);0>F&&(x=-F);for(k=0;k<b;k++){q=aa.getSurface(k).getMousePosition();if(B||x)q.left+=
B,q.right+=B,q.top+=x,q.bottom+=x;c[k]=[q.left,q.top,q.right,q.bottom,q.left==B&&q.top==x?1:0]}na.setMonitorLayout(c);r.reconnectOnResize=!1}v&&(svGlobal.logger.warn("MonitorDef:"+v),L.width=w-D+1,L.height=l-F+1,v="&monitorDef="+v+"&width="+L.width+"&height="+L.height);b=v}a+=b;0>p.indexOf("waWidth")&&(b=(b=aa.getFocused())?b.getWindow():window,a+="&waWidth="+L.waWidth+"&waHeight="+L.waHeight+"&dpWidth="+b.innerWidth+"&dpHeight="+b.innerHeight);b=new Date;L.tzOffset||(a+="&tzOffset="+b.getTimezoneOffset());
L.timezone||(c=hi5.timezone.getTimeZone())&&(a+="&timezone="+encodeURIComponent(c.standardName));a+="&time="+b.getTime();void 0==L.soundPref&&(L.soundPref=0,a+="&soundPref=0");B=c=b="";for(B in kb)x=kb[B],"flags"in x&&(b&&(b+=",",c+=","),b+=x.name,c+=x.flags);b&&(a=a+("&channelName="+b)+("&channelFlags="+c));b="";for(B in ib)x=ib[B],"flags"in x&&(b&&(b+=","),b+=x.name);b&&(a+="&gwChannelName="+b);if(c=rd())b=c.account,c=c.session,b&&(a+="&account="+b),c&&(a+="&session="+c);b=hi5.browser.isTouch&&
(1024<=window.innerWidth||768<=window.innerHeight);L.audioRecord=Q(L.audioRecord)&&hi5.audio.recordable;Ea.init(b,pc,L.audioRecord,L.soundPref,Q(L.mapCamera)&&!!navigator.mediaDevices,Q(L.mapUSB)&&!!navigator.usb);L.audioRecord&&(a+="&audioRecord=on");L.decompressingRDP61&&(a+="&decompressingRDP61=on");0<Ea.count&&(a+="&dvcChannels="+Ea.names.join(","));a+="&binary=on";ca.existingFile&&(a+="&existingFile="+ca.existingFile);a+="&isTouch="+b+"&gatewayAddr="+encodeURIComponent(sa());a=r.modifyURL(a);
ca.copyTextOnly&&Q(L.mapClipboard)&&(a+="&copyTextOnly=on");(b=hi5.browser.cookie.get("__SV_TOKEN_A"))&&(a+="&__SV_TOKEN_A="+encodeURIComponent(b));(b=svGlobal.Rdp.languageToKeyboard.detect())&&(a+="&_keyboard="+b);Q(L.textPrinter)&&(a+="&printerDriver="+encodeURIComponent("Generic / Text Only"));return a+=Ad()};this.getColor=function(){return fb};this.changeTitle=ja;hi5.browser.isTouch&&Math.max(Ia,Ja)>Math.max(window.innerWidth,window.innerHeight)&&(this.reconnectOnResize=!1);this.isRemoteApp=function(){return Wa};
var Aa=null,Ha=!1,pb=!1,lc=!1,Ta=new function(){function a(B){console.error("play error: ",B);r.showMessage({msg:"Please click Yes to continue.<br>"+B,cbYes:function(){g.play(!0);this.destroy()}})}var b=null;this.supportWebAudio=this.available=!1;(0==L.playSound||0<r.mode)&&(b=hi5.audio.getAudioContext())&&hi5.audio.playable&&(this.supportWebAudio=this.available=!0);this.getContext=function(){return b};this.getBuffer=function(B){return b.createBuffer(2,B,Ba.samplePerSec)};var c=0,e=null,d=null;this.setVolume=
function(B){1==B?e=null:(e||(e=b.createGain()),e.gain.value=B)};this.playBuffer=function(B){d=b.createBufferSource();d.buffer=B;e?(d.connect(e),e.connect(b.destination)):d.connect(b.destination);var x=b.currentTime,D=0<c?c:x;D<x&&(D=x);c=D+B.duration;d.start?d.start(D):d.noteOn(D);return c-x};this.iOSFix=function(){if(b&&hi5.browser.isSafari){var B=this.getBuffer(1024),x=b.createBufferSource();x.buffer=B;x.connect(b.destination);x.start?x.start(0):x.noteOn(0)}};this.close=function(){b&&(e&&e.disconnect(),
d&&d.disconnect(),hi5.audio.releaseAudioContext())};var k=null,g=null;this.onaudioframe=null;this.initMediaPlayer=function(B,x,D){k||(k=document.createElement("audio"));g||(g=new Kb(k,B,!0),g.onplayerror=a,g.onerror=function(F){console.error("Not possible audio error",F)},svGlobal.logger.info("MediaPlayer init, headerless: "+D+" sampleRate:"+x.sampleRate));g.setMediaFormat(x,D);g.play(!1)}},Gd=Ta.available,na=new vc(200,200);na.onSetCursor=Gc;this.setVolume=function(a){Ta&&Ta.setVolume(a)};this.setAudioBuffer=
function(a){};var Ub=0,Tb=0,Vb=Ia-1,Wb=Ja-1,jc="";window.$rdp||(window.$rdp=this);wa(fb);this.setResolution=Oa;this.running=function(){return Ha};this.setJoinMode=function(a){Ha&&ra("8E1"+a)};this.setJoinCloseMode=function(a){Ha&&ra("8EB3\t"+a)};this.refuseControl=function(a){Ha&&ra("8E3"+a)};this.giveControl=function(a){Ha&&ra("8E4"+a)};this.pauseSession=function(a,b){Ha&&ra("8EB"+(b?1:0)+"\t"+a)};this.closeSession=function(a){Ha&&ra("8EB2\t"+a)};this.requestControl=function(){Ha&&ra("8E2")};this.saveSession=
function(a){Ha&&ra("8E9"+(a.save?1:0)+"\t"+(a.timeout||0)+"\t"+(a.id||0))};this.allowJoin=function(a,b){Ha&&ra("8EA"+a+"\t"+(b?1:0))};var Bb=new function(){function a(){if(c&&0<c.length){var k=c.shift();k.key?Bb.sendSingleKey(k.down,k.key):k.char&&rb(k.char);0<c.length?setTimeout(a,e):(c=null,d&&d())}}var b={" ":57,space:57,pgup:201,pageup:201,pgdn:209,pagedown:209,end:207,home:199,left:203,up:200,right:205,down:208,printscreen:183,insert:210,del:211,"delete":211,altgr:184,windows:219,windowsright:220,
context:221,esc:1,backspace:14,back:14,tab:15,enter:28,meta:29,command:29,ctrl:29,shift:42,alt:56,capslock:58,f1:59,f2:60,f3:61,f4:62,f5:63,f6:64,f7:65,f8:66,f9:67,f10:68,f11:87,f12:88,numlock:69,scrolllock:70,add:78};this.sendSingleKey=function(k,g){var B=b[g.toLowerCase()];B?r.writeScancode(k,B):(B=g.length,0!=B&&(1==B?r.writeKeyCode(k,g.toUpperCase().charCodeAt(0)):k&&r.writeText(g)))};var c=null,e=0,d=null;this.sendKeyComb=function(k,g,B){if(Xa){k=k.split("+");var x=k.length,D;if(0!=x){var F=
null,w=[];for(D=0;D<x;D++){var l=k[D];""==l&&""==F&&(l="Add");""!=l&&w.push({key:l,down:!0});F=l}x=w.length;for(D=x-1;0<=D;D--)w.push({key:w[D].key,down:!1});if(g)c=w,e=g,d=B,a();else for(D=0,x=w.length;D<x;D++)Bb.sendSingleKey(w[D].down,w[D].key)}}};this.sendText=function(k,g,B){for(var x=[],D=0,F=k.length;D<F;D++)x.push({"char":k.charAt(D)});c=x;e=g;d=B;a()}};this.writeKeyComb=function(a,b,c){Xa&&Bb.sendKeyComb(a,b,c)};this.writeText=function(a,b,c){if(Xa)if(b)Bb.sendText(a,b,c);else for(b=0,c=
a.length;b<c;b++)rb(a.charAt(b))};this.writeClipboard=function(a,b){a&&(b||(b="text/plain"),r.writeRawInput("880"+b+"\t"+a.hashCode()),Ab={type:b,text:a})};var aa=new function(a,b){function c(){function d(w){for(;0<w.ownerWinid;){var l=D.getWinById(w.ownerWinid);if(l&&l.isVisible())w=l;else break}return w}function k(w){for(var l="";w;)w.titleInfo&&(l=w.titleInfo),w=D.getWinById(w.ownerWinid);return l}var g=[],B=[],x=0,D=this;this.mainWin=null;this.appId="";var F=0;this.getActiveWinId=function(){return F};
this.setActiveWinId=function(w,l){svGlobal.logger.info("setActiveWinId: "+w+" old: "+F+" max: "+l);if(F!=w){var v=0==F;F=w;(w=D.getMainByWinId(w))&&w.isMainWin()&&D.mainWin!=w&&(D.mainWin=w);v&&l&&(l=aa.getFocused())&&(l=l.getFreeSpace(),w=l.width,r.resetSize(w,l.height))}};this.onchange=function(w){w.isVisible()||w!=D.mainWin?w.isVisible()&&!D.mainWin&&w.isMainWin()&&(D.mainWin=w,3==a.windowState&&w.exeCommand(61488)):D.mainWin=null};this.addWin=function(w){for(var l=g.length,v=!1,q=0;q<l;q++)if(w.id==
g[q].id){g[q]=w;v=!0;break}v||g.push(w);1==g.length&&(x=Date.now());l=w.isMainWin();svGlobal.logger.info("is mainwin:"+l+" id:"+w.id);l&&!D.mainWin&&(D.mainWin=w)};this.popWins=function(w){w=D.getWinById(w);var l=[];if(w){w=0<w.ownerWinid?w.ownerWinid:w.id;for(var v=g.length-1;0<=v;v--)if(g[v].ownerWinid==w||g[v].id==w)l.push(g[v]),g.splice(v,1)}return l};this.hasApp=function(w){return-1!=B.indexOf(w)};this.addApp=function(w){return-1==B.indexOf(w)?(B.push(w),!0):!1};this.isNew=function(){return 3E4>
Date.now()-x};this.getAll=function(){return g};this.hasWin=function(w){return 0<=g.indexOf(w)};this.close=function(){for(var w=0,l=g.length;w<l;w++)g[w].close()};this.clear=function(){g.length=0};this.delWin=function(w){for(var l=0,v=g.length;l<v;l++)if(g[l].id==w)return g.splice(l,1),l;return-1};this.isRunning=function(){var w=g.length;if(1>w)return!1;var l=0;for(w=g.length;l<w;l++){var v=g[l];if(v.showState)return!0}return!1};this.getWinById=function(w){var l=g.length;if(1>l)return null;for(var v=
0;v<l;v++){var q=g[v];if(q.id==w)return q}return null};this.getMainWinByAppId=function(w){var l=null,v=0;for(len=g.length;v<len;){l=g[v];if(l.appId==w&&l.isVisible()&&1>l.ownerWinid)break;v++}return l};this.getTopWin=function(w){var l=null,v,q=w.length;for(v=0;v<q&&(!(l=D.getWinById(w[v]))||!l.isVisible());v++)l=null;if(!l)for(svGlobal.logger.warn("No win found"),q=g.length,v=q-1;0<=v&&(l=g[v],!l.isVisible());v--)l=null;return l};this.getMain=function(w){return(w=D.getTopWin(w))?d(w):null};this.getMainByWinId=
function(w){return(w=D.getWinById(w))?d(w):null};this.getOtherApps=function(w,l,v){var q=g.length;if(0!=q&&g[q-1])if(q=g[q-1].appId,v||!q)setTimeout(function(){D.getOtherApps(w,l)},v||3E3);else{v=[];if(q=D.getTopWin(w)){var u=0<q.ownerWinid?q.ownerWinid:q.id,M=[],P=0;for(q=g.length;P<q;P++)g[P].ownerWinid!=u&&g[P].id!=u&&g[P].isVisible()&&M.push(g[P]);P=0;for(q=M.length;P<q;P++)M[P].ownerWinid!=u&&M[P].id!=u&&(v.push({title:k(M[P]),win:d(M[P])}),u=0<M[P].ownerWinid?M[P].ownerWinid:M[P].id)}l(v)}};
this.getFullTitle=function(w){for(var l,v="";;){l=D.getWinById(w);if(!l)break;l.titleInfo&&l.isVisible()&&(v&&(v=" > "+v),v=l.titleInfo+v);if(1>w)break;w=l.ownerWinid}return v}}var e=[];this.tryCloseRemoteApps=function(){if(a&&a.isRemoteApp())for(var d=e.length,k=0;k<d;k++)e[k].railWin&&e[k].railWin.close()};this.verifyMonitors=function(){for(var d=e.length,k=Array(d),g=0;g<d;g++)e[g].configMonitor(),k[g]=e[g].getMousePosition();k.sort(function(D,F){var w=D.left-F.left;return 0!=w?w:D.top-F.top});
var B=k.findIndex(function(D){return 0==D.left&&0==D.top});svGlobal.logger.info("monitor layout",k,B);-1==B&&(r.showMessage("* Primary monitor not found. Please make your browser window full screen."),svGlobal.logger.warn("Primary monitor not found (left=top=0)",k));for(g=B-1;0<=g;){if(k[g].right<k[g+1].left){var x=k[g+1].left-k[g].right-1;0<x&&(k[g].right+=x,k[g].left+=x)}k[g].bottom<k[g+1].top&&(x=k[g+1].top-k[g].bottom-1,0<x&&(k[g].top+=x,k[g].bottom+=x));g--}for(g=B+1;g<d;)k[g-1].right<k[g].left&&
(x=k[g].left-k[g-1].right-1,0<x&&(k[g].right-=x,k[g].left-=x)),k[g-1].bottom<k[g].top&&(x=k[g].top-k[g-1].bottom-1,0<x&&(k[g].top-=x,k[g].bottom-=x)),g++};this.repaint=function(d,k,g,B){for(var x=0,D=e.length;x<D;x++)e[x].repaint(d,k,g,B)};this.size=function(){return e.length};this.getSurface=function(d){return e[d]};this.addSurface=function(d){e.push(d)};this.hasSurface=function(d){for(var k=e.length,g=0;g<k;g++)if(e[g].equals(d))return!0;return!1};this.fromSyncedSurface=function(d){var k=e.length;
Date.now();for(var g=0;g<k;g++)if(e[g].isClipSynced(d))return!0;return!1};this.setSize=function(d,k,g){for(var B=0,x=e.length;B<x;B++)e[B].setSize(d,k,g)};this.zOrders=[];this.drawLicense=function(d){for(var k=0,g=e.length;k<g;k++)e[k].drawLicense(d)};this.setReadOnly=function(d,k){for(var g=0,B=e.length;g<B;g++)e[g].setReadOnly(d,k)};this.setVisible=function(d,k){svGlobal.logger.info("TODO: setVisible")};this.setCursor=function(d){for(var k=0,g=e.length;k<g;k++)e[k]&&e[k].setCursor(d)};this.hide=
function(d){d=0;for(var k=e.length;d<k;d++)e[d]&&e[d].hide()};this.execute=function(d,k){for(var g=0,B=e.length;g<B;g++)e[g][d].apply(e[g],k)};this.addWin=function(d){var k=this.getFocused();k||(svGlobal.logger.warn("Focused surface not found!"),k=e[e.length-1]);k?(Wa=!0,k.railWin||(k.railWin=new c,k.onunload=function(){hi5.appcfg.closeRemoteApp&&k.railWin&&k.railWin.close();k.remoteApp&&k.remoteApp.close();k.railWin&&(k.railWin.clear(),k.railWin=null);e.removeElm(k)}),k.context&&b.setContext(k.context),
k.railWin.addWin(d),k.railWin.mainWin==d&&(setTimeout(function(){var g=k.getFreeSpace();a.writeRawInput("8C661441\t"+g.width+"\t"+g.height);svGlobal.logger.info("-- main win dp change:"+g.height);3==a.windowState?d.resizable()&&setTimeout(function(){d.exeCommand(61488);svGlobal.logger.info("-- max")},50):5==a.windowState&&3==d.showState&&setTimeout(function(){d.exeCommand(3856);svGlobal.logger.info("-- restor")},50)},111),Ra.sendKeyboardSyncFlags(Ra.localLockFlags,500)),hi5.browser.isIE&&k.focus()):
svGlobal.logger.warn("No surface available!")};this.delWin=function(d){for(var k,g=e.length-1;0<=g;g--){var B=e[g];k=B.railWin;var x=k.getWinById(d),D=x&&x.appId&&-1!=x.appId.toLowerCase().indexOf("runonce");if(0<=k.delWin(d)){x==k.mainWin&&(k.mainWin=null);if(B.toolbar){d="win"+d;var F=B.toolbar.querySelector("#"+d);F&&B.toolbar.removeChild(F)}if(!k.isRunning()&&0==r.mode){if(x.isMainWin()&&B.onremoteappclose)B.onremoteappclose(x);x=a.appTimeout;if(D||k.isNew())x*=10;svGlobal.logger.debug("Prepare del:"+
Date.now());setTimeout(function(w){return function(){svGlobal.logger.info("Start del:"+Date.now());w.railWin&&w.railWin.isRunning()||(w.remoteApp&&w.remoteApp.close(),aa&&aa.delSurface(w))}}(B),x)}}}};this.popWins=function(d){return e[0]&&e[0].railWin?e[0].railWin.popWins(d):[]};this.getWinById=function(d){for(var k,g=0,B=e.length;g<B;g++)if(e[g]&&e[g].railWin&&(k=e[g].railWin.getWinById(d)))return k;return null};this.getMainWinByAppId=function(d){for(var k,g=0,B=e.length;g<B;g++)if(e[g].railWin&&
(k=e[g].railWin.getMainWinByAppId(d)))return k;return null};this.onWinChange=function(d){for(var k,g=0,B=e.length;g<B;g++)if(e[g].railWin&&(k=e[g].railWin.getWinById(d.id)))e[g].railWin.onchange(d)};this.setTitle=function(d){for(var k,g=0,B=e.length;g<B;g++)if(e[g].railWin){k=e[g].railWin.getWinById(d);var x=e[g].railWin.getFullTitle(d);if(x){a.changeTitle(x,e[g].getWindow(),k.appId);break}}};this.hasApp=function(d){for(var k=0,g=e.length;k<g;k++)if(e[k].railWin.hasApp(d))return!0;return!1};this.delSurface=
function(d){!d||d.railWin&&d.railWin.isRunning()||(svGlobal.logger.info("delete surface..."),e.removeElm(d),d.close(),0==e.length&&a._unload())};this.getOwnerSurface=function(d){for(var k=0,g=e.length;k<g;k++)if(e[k].railWin&&e[k].railWin.hasWin(d))return e[k];return null};this.getOwnerSurfaceById=function(d){for(var k,g=0,B=e.length;g<B;g++)if(e[g].railWin&&(k=e[g].railWin.getWinById(d)))return e[g];return null};this.getFocused=function(){for(var d=e.length,k=0;k<d;k++)if(e[k].focused)return e[k];
return e[d-1]};this.close=function(){for(var d=0,k=e.length;d<k;d++)e[d]&&(e[d].remoteApp&&e[d].remoteApp.close(),e[d].close(),e[d]=null)};this.LocalWin=function(d){function k(){a.writeRawInput("8C0"+d)}this.id=d;this.appId="";var g=this;this.resizable=function(){return g.isVisible?0!=(g.style&262144)||0!=(g.style&65536)||0!=(g.style&16777216)||3==g.showState:!1};this.setShowState=function(B){g.showState=B};this.parent=function(){return aa.getWinById(g.ownerWinid)};this.resize=function(B,x,D,F){svGlobal.logger.info("www resize, l "+
B+" w "+D);hi5.appcfg.disableJoinedAppResize&&2==a.mode||a.writeRawInput("8C1"+g.id+"\t"+B+"\t"+x+"\t"+D+"\t"+F)};this.exeCommand=function(B){svGlobal.logger.info("www exeCommand, cmd "+B);a.writeRawInput("8C4"+d+"\t"+B)};this.activate=function(B){svGlobal.logger.info("www activate, enable "+B+" id:"+d);2==g.showState?(g.exeCommand(61728),setTimeout(function(){a.writeRawInput("8C3"+d+"\t"+B)},50)):a.writeRawInput("8C3"+d+"\t"+B)};this.close=function(){svGlobal.logger.info("www close");g.exeCommand(61536)};
this.getAppId=k;this.isVisible=function(){return g.winWidth&&g.winHeight&&g.showState&&45<g.winHeight&&45<g.winWidth};this.isMainWin=function(){if(!(g.isVisible()&&g.winWidth&&g.winHeight&&45<g.winHeight&&45<g.winWidth))return!1;var B=1>g.ownerWinid;if(!B)return B;var x=g.style;if(0!=(x&4194304))return!0;if(0!=(x&2147483648)&&(0==(x&8388608)||0==(x&12582912)))return!1;var D=0!=(g.extStyle&128);(B=B&&!D)&&0!=(x&2147483648)&&0==(x&2156396544)&&(B=!1);return B};k()}}(r,na);this.getSurfaces=function(){return aa};
this.hide=function(){aa&&aa.hide()};this.getFileUrl=function(a,b,c){var e=sa(),d=Tc,k=d.indexOf("://");e=(0<k&&11>k?d:e+d)+"s="+jc+"&f="+encodeURIComponent(a);b&&(e+="&src="+b);c&&(e+="&action="+c);return r.modifyURL(e)};this.listFiles=function(a,b){Ma&&Xa&&Ma.list(a,b)};this.writeRawInput=function(a){if(Xa){ra(a);if(r.onactivity)r.onactivity(a);return!0}return!1};this.authWithCode=function(a,b){var c=a.length,e=new Uint8Array(5+c);e[0]=146;e[1]=7;e[2]=b;e[3]=c&255;e[4]=c>>8&255;for(b=0;b<c;b++)e[5+
b]=a.charCodeAt(b);ra(e.buffer)};var Wc=0;if(ca.numLock||ca.numlock||Q(L.numLock)||hi5.browser.isMacOS||hi5.browser.isiOS||hi5.browser.isCrOS)Wc|=2;var Ra=new function(a,b,c,e){this.setJoinMode=a.setJoinMode;this.requestControl=a.requestControl;this.writeKeyComb=a.writeKeyComb;this.writeText=a.writeText;this.localLockFlags=e||0;this.remoteLockFlags=0;this.checkLockFlags=!0;this.reqCopyTime=0;this.draw=c.draw;var d=a.isRemoteApp(),k=void 0;this.saveResize=function(g){k=a.reconnectOnResize;a.reconnectOnResize=
g};this.restoreResize=function(){void 0!=k&&(a.reconnectOnResize=k)};this.refresh=function(g,B,x,D){return c.repaint(g,B,x-g+1,D-B+1)};this.getAppMode=function(){return a.mode};this.getAgentStatus=function(){return a.getAgentStatus()};this.send=a.writeRawInput;this.saveSession=function(g){a.saveSession(g)};this.sendInput=a.writeRawInput;this.getAppInfo=function(){return a.sessionInfo.appInfo};this.resumeAudio=function(){Ta.supportWebAudio&&Ta.iOSFix()};this.onresize=function(g){if(g=g.target.svSurface){var B=
g.getFreeSpace(),x=B.width;B=B.height;Ra.checkLockFlags=!0;ca.scale?g.scaleTo(x,B,!1):a.resetSize(x,B)}};this.onorientationchange=function(g){a.resetSize(g.innerWidth,g.innerHeight)};this.getClipData=function(g,B){this.reqCopyTime=Date.now();var x=a.getGatewayAddr(),D=Uc,F=D.indexOf("://");x=(0<F&&11>F?D:x+D)+"s="+a.sessionInfo.appInfo.session+"&t="+Date.now()+"&type="+g;g=hi5.httpGet(a.modifyURL(x),B);this.reqCopyTime=Date.now();Oc(g);return g};this.onfocus=function(g){var B=aa.getFocused();d&&B&&
B.railWin&&(g=B.railWin.mainWin)&&a.running()&&(B=B.context)&&B!=c.getContext()&&(c.setContext(null),g.activate(1),svGlobal.logger.info("Activate win:"+g.id))};this.getShareFiles=a.listFiles;this.getFile=function(g,B,x){a.reconnectOnResize=!1;var D=a.getFileUrl(g,B,x);r.ondownload&&r.ondownload({fileName:g,url:D,source:B,action:x})||window.open(D)};this.getFileLink=a.getFileUrl;this.getGateway=function(){return p};this.reconnect=function(g,B,x){L.symlink?(g="user="+g+"&pwd="+B,x&&(g+="&domain="+x),
p=hi5.tool.replaceQuery(p,"parameters",g)):(p=hi5.tool.replaceQuery(p,"user",g),p=hi5.tool.replaceQuery(p,"pwd",B),p=hi5.tool.replaceQuery(p,"domain",x));a.run()};this.sendKeyboardSyncFlags=function(g,B){return Xa?(this.remoteLockFlags=this.localLockFlags=g,setTimeout(function(){a.writeRawInput("8E5"+g)},B||333),!0):!1};this.sendKeyboardSynchronize=function(g,B,x){var D=0;x&&(D|=4);B&&(D|=2);g&&(D|=1);this.sendKeyboardSyncFlags(D)};this.fromSyncedSurface=function(g){return b.fromSyncedSurface(g)};
this.setWorkDir=function(g){a.writeKeyComb("Windows+R",20,function(){setTimeout(function(){a.writeText(g,10,function(){a.writeScancode(!0,28);a.writeScancode(!1,28)})},666)})};this.authWithCode=function(g,B){a.authWithCode(g,B)};this.getPrinters=function(g){a.getPrinters(g)};this.attachPrinter=function(g){a.attachPrinter(g)}}(r,aa,na,Wc);this.sendKeyboardSynchronize=function(a,b,c){Ra.sendKeyboardSynchronize(a,b,c)};this.VirtualChannel=function(){return new ob(143)};this.GatewayChannel=function(){return new ob(28)};
this.DynamicChannel=function(){return new ob(64)};this.addChannel=function(a){kb[a.name]=a};this.addGatewayChannel=function(a){ib[a.name]=a};this.addDynamicChannel=function(a){Ea.names.push(a.name);Ea[a.name]=a;Ea.count++};var Sa=null,Ea={count:0,names:[],usbChannel:null,close:function(){for(var a=Ea.names,b=0,c=a.length;b<c;b++)Ea[a[b]].onclose&&(Ea[a[b]].onclose(),Ea[a[b]]=null);a.length=0;Ea.usbChannel=null},init:function(a,b,c,e,d,k){function g(){this.WAVE_FORMAT_PCM=1;this.WAVE_FORMAT_ADPCM=
2;this.WAVE_FORMAT_ALAW=6;this.WAVE_FORMAT_MULAW=7;this.WAVE_FORMAT_GSM=49;this.WAVE_FORMAT_MPEGLAYER3=85;this.WAVE_FORMAT_AAC=41222;this.cbSize=this.bitsPerSample=this.nBlockAlign=this.nAvgBytesPerSec=this.nSamplesPerSec=this.nChannels=this.formatTag=0;this.extenstion=null;var l=this;this.fromBuffer=function(v,q){l.formatTag=v.getLittleEndian16();l.nChannels=v.getLittleEndian16();l.nSamplesPerSec=v.getLittleEndian32();l.nAvgBytesPerSec=v.getLittleEndian32();l.nBlockAlign=v.getLittleEndian16();l.bitsPerSample=
v.getLittleEndian16();var u=v.getLittleEndian16();l.cbSize=u;0<u&&!0!==q&&(l.extenstion=Array(u),v.copyToByteArray(l.extenstion,0,v.getPosition(),u),v.skipPosition(u))};this.toBuffer=function(v){v.setLittleEndian16(l.formatTag);v.setLittleEndian16(l.nChannels);v.setLittleEndian32(l.nSamplesPerSec);v.setLittleEndian32(l.nAvgBytesPerSec);v.setLittleEndian16(l.nBlockAlign);v.setLittleEndian16(l.bitsPerSample);v.setLittleEndian16(l.cbSize);0<l.cbSize&&v.setBytes(l.extenstion)};this.getSize=function(){return 18+
l.cbSize};this.toString=function(){return"Audio Format, tag="+l.formatTag+" nChannels="+l.nChannels+" nSamplesPerSec="+l.nSamplesPerSec+" nAvgBytesPerSec="+l.nAvgBytesPerSec+" nBlockAlign="+l.nBlockAlign+" bitsPerSample="+l.bitsPerSample+" cbSize="+l.cbSize}}function B(){Sa=new r.DynamicChannel;Sa.name="Microsoft::Windows::RDS::DisplayControl";Sa.enabled=!1;Sa.process=function(l){var v=l.getLittleEndian32();l.getLittleEndian32();switch(v){case 5:v=l.getLittleEndian32(),Sa.maxMonitorAreaFactorA=l.getLittleEndian32(),
Sa.maxMonitorAreaFactorB=l.getLittleEndian32(),Sa.enabled=!0,svGlobal.logger.warn("Display control maxNumMonitors:"+v+" factorA:"+Sa.maxMonitorAreaFactorA+" factorB:"+Sa.maxMonitorAreaFactorB),l=new Uint8Array(2),l[0]=146,l[1]=4,ra(l.buffer),Qa&&setTimeout(function(){Qa&&Qa.check(5E3)},1900)}};Sa.applyResolution=function(l,v){if(Sa.enabled){var q=new Uint8Array(56),u=new RdpBuffer(q,0,56);l=l>Sa.maxMonitorAreaFactorA?Sa.maxMonitorAreaFactorA:l&-4;v=v>Sa.maxMonitorAreaFactorB?Sa.maxMonitorAreaFactorB:
v&-4;u.setLittleEndian32(2);u.setLittleEndian32(56);u.setLittleEndian32(40);u.setLittleEndian32(1);u.setLittleEndian32(1);u.setLittleEndian32(0);u.setLittleEndian32(0);u.setLittleEndian32(l);u.setLittleEndian32(v);u.setLittleEndian32(.26458*l|0);u.setLittleEndian32(.26458*v|0);u.setLittleEndian32(l>v?0:90);u.setLittleEndian32(100);u.setLittleEndian32(100);Sa.send(q);svGlobal.logger.warn("Display control: "+l+"x"+v)}else svGlobal.logger.warn("Display control disabled.")};return Sa}if(!ca.disableDVC){if(ca.enableEcho){var x=
new r.DynamicChannel;x.name="ECHO";x.process=function(l){var v=l.getPosition(),q=l.getEnd(),u=new Uint8Array(q-v);u.set(l.getData().subarray(v,q));x.send(u)};r.addDynamicChannel(x)}if(a){var D=new r.DynamicChannel;D.name="Microsoft::Windows::RDS::Input";D.process=function(l){var v=l.getLittleEndian16();l.getLittleEndian32();switch(v){case 1:l.skipPosition(4),l=new RdpBuffer(new Uint8Array(16),0,16),l.setLittleEndian16(2),l.setLittleEndian32(16),l.setLittleEndian32(3),l.setLittleEndian32(65536),l.setLittleEndian16(256),
l.markEnd(),D.send(l);case 5:aa.execute("setTouchRemoting",[!0]);Ea.isTouchReady=!0;svGlobal.logger.info("Touch remoting start");break;case 4:aa.execute("setTouchRemoting",[!1]),Ea.isTouchReady=!1,svGlobal.logger.info("Touch remoting suspend")}};r.addDynamicChannel(D)}if(c){svGlobal.logger.warn("Audio input on");var F=new r.DynamicChannel;(function(){function l(V){var S=new RdpBuffer(new Uint8Array(5),0,5);S.setByte(7);S.setLittleEndian32(V);S.markEnd();F.send(S)}function v(V){var S=V.getLittleEndian32(),
ia=V.getLittleEndian32(),fa=new g;fa.fromBuffer(V,!0);var la=0,Ca=0;0<fa.cbSize&&(22==fa.cbSize?(la=V.getLittleEndian16(),Ca=V.getLittleEndian32(),V.skipPosition(16)):(svGlobal.logger.warn("Wrong cbsize: "+fa.cbSize),V.skipPosition(fa.cbSize)));V=u[ia];svGlobal.logger.info("Selceted rec fmt, framesPerPacket: "+S+" initial: "+ia+", "+V.toString());svGlobal.logger.info("Open fmt: "+fa.toString()+" validBits:"+la+" mask:"+Ca);P=!0;U=r.reconnectOnResize;r.reconnectOnResize=!1;W.onopen||(W.onopen=function(ma){if(Ha){q=
ma;r.reconnectOnResize=U;l(ia);var pa=new RdpBuffer(new Uint8Array(5),0,5);pa.setByte(4);pa.setLittleEndian32(ma?0:1);pa.markEnd();F.send(pa)}});W.ondata||(W.ondata=function(ma,pa){q&&(N.length!=pa+1&&(N=new Uint8Array(pa+1),N[0]=6),F.send(M),N.set(ma,1),F.send(N))});W.start(V,S)}F.name="AUDIO_INPUT";F.process=function(V){var S=V.getByte();switch(S){case 1:V=V.getLittleEndian32();S=new RdpBuffer(new Uint8Array(5),0,5);S.setByte(1);S.setLittleEndian32(V);S.markEnd();F.send(S);break;case 2:var ia=V.getLittleEndian32();
V.getLittleEndian32();var fa=Ta.getContext().sampleRate;for(S=u.length=0;S<ia;S++){var la=new g;la.fromBuffer(V);svGlobal.logger.info("Server rec fmt "+S+":"+la.toString());0==e&&49==la.formatTag&&22050==la.nSamplesPerSec?u.push(la):1==la.formatTag&&la.nSamplesPerSec<=fa&&u.push(la)}F.send(M);ia=0;V=u.length;for(S=0;S<V;S++)ia+=u[S].getSize();fa=new RdpBuffer(new Uint8Array(1024),0,1024);fa.setByte(2);fa.setLittleEndian32(V);fa.setLittleEndian32(ia+9);for(S=0;S<V;S++)u[S].toBuffer(fa),svGlobal.logger.info("Client rec fmt: "+
u[S].toString());fa.skipPosition(1024-ia-9);fa.markEnd();F.send(fa);break;case 3:v(V);break;case 7:S=V.getLittleEndian32();svGlobal.logger.info("Rec fmt change, "+u[S].toString()+" by client:"+P);P||(l(S),P=!1);break;default:svGlobal.logger.warn("audioInput: invalid tag:"+S)}};var q=!1,u=[];F.onclose=function(){q=!1;W&&W.close()};var M=new Uint8Array(1);M[0]=5;var P=!1,U=r.reconnectOnResize,N=new Uint8Array(0),I=oa("audiorecorder",hi5.libMin?"audiorecorder_min.js?v=0":"audiorecorder.js?v=0"),W=window.AudioWorkletNode?
new hi5.audio.WorkletRecorder(Ta.getContext(),I):new hi5.audio.Recorder(Ta.getContext())})();r.addDynamicChannel(F)}r.addDynamicChannel(function(){var l=new r.DynamicChannel;l.name="TSMF";var v={type:"image/jpeg"},q=Array(1);l.process=function(u){u.getPosition();var M=u.getLittleEndian32()&1073741823;var P=u.getLittleEndian32();var U=u.getLittleEndian32();switch(M){case 2:if(256==U){u.getLittleEndian32();U=new Uint8Array(16);var N=new RdpBuffer(U,0,16);N.setLittleEndian32(2);N.setLittleEndian32(P);
N.setLittleEndian32(1);N.setLittleEndian32(0);l.send(U)}break;case 0:switch(U){case 257:u.getBytes(16);u.getLittleEndian32();break;case 256:M=u.getPosition();N=u.getLittleEndian32();for(U=0;U<N;U++){u.getLittleEndian32();var I=u.getLittleEndian32();u.getLittleEndian32();u.skipPosition(I-4)}U=u.getPosition()-M;N=U+8+4;U=new Uint8Array(N);N=new RdpBuffer(U,0,N);N.setLittleEndian32(-2147483648);N.setLittleEndian32(P);U.set(u.getData().subarray(M,u.getPosition()),8);l.send(U);break;case 261:u.getBytes(16);
u.getLittleEndian32();break;case 264:M=u.getLittleEndian32();u.skipPosition(4);u.getLittleEndian32();I=u.getBytes(16);var W=u.getBytes(16);u.getLittleEndian32();u.getLittleEndian32();u.getLittleEndian32();var V=u.getBytes(16);U=u.getLittleEndian32();u.skipPosition(U);U=new Uint8Array(20);N=new RdpBuffer(U,0,20);N.setLittleEndian32(-2147483648);N.setLittleEndian32(P);hi5.Arrays.equals([118,105,100,115,0,0,16,0,128,0,0,170,0,56,155,113],I)&&hi5.Arrays.equals([77,74,80,71,0,0,16,0,128,0,0,170,0,56,155,
113],W)&&hi5.Arrays.equals([128,159,88,5,86,195,206,17,191,1,0,170,0,85,89,90],V)?N.setLittleEndian32(1):(N.setLittleEndian32(0),svGlobal.logger.warn("Format is not supported:"),svGlobal.logger.warn(I),svGlobal.logger.warn(W),svGlobal.logger.warn(V));N.setLittleEndian32(M);l.send(U);break;case 258:u.getBytes(16);u.getLittleEndian32();M=u.getLittleEndian32();u.skipPosition(M);break;case 263:u.getBytes(16),U=new Uint8Array(16),N=new RdpBuffer(U,0,16),N.setLittleEndian32(-2147483648),N.setLittleEndian32(P),
N.setLittleEndian32(1),l.send(U);case 277:u.getBytes(16);u.getLittleEndian32();break;case 262:u.getBytes(16);na.flushImgs();na.setImgRect(0,0,0,0);U=new Uint8Array(12);N=new RdpBuffer(U,0,12);N.setLittleEndian32(-2147483648);N.setLittleEndian32(P);l.send(U);break;case 278:u.getBytes(16);P=u.getLittleEndian32();U=u.getLittleEndian32();M=u.getLittleEndian32();u=u.getLittleEndian32();na.setImgRect(P,U,M-P,u-U);break;case 265:u.getBytes(16);u.getLittleEndian64();u.getLittleEndian32();break;case 266:u.getBytes(16);
break;case 268:u.getBytes(16);break;case 267:u.getBytes(16);break;case 269:u.getBytes(16);u.getLittleEndian32();break;case 274:break;case 275:break;case 259:u.getBytes(16);u.getLittleEndian32();u.getLittleEndian32();u.skipPosition(32);U=u.getLittleEndian32();P=new Image;M=u.getPosition();q[0]=u.getData().subarray(M,M+U);u=new Blob(q,v);P.src=URL.createObjectURL(u);na.addImg(P);break;case 270:na.flushImgs();break;case 273:break;case 260:break;case 276:u.getBytes(16);U=u.getLittleEndian32();M=u.getPosition()+
U;u.skipPosition(8);P=u.getLittleEndian32();svGlobal.logger.info("window state:"+P);N=u.getLittleEndian32();I=u.getLittleEndian32();P=u.getLittleEndian32();U=u.getLittleEndian32();u.skipPosition(8);W=u.getLittleEndian32();V=u.getLittleEndian32();svGlobal.logger.info("Window rect, left:"+P+" top:"+U+" w:"+N+" h:"+I+" cl:"+W+" ct:"+V);u.setPosition(M);M=u.getLittleEndian32();for(M=u.getPosition()+M;u.getPosition()<M;){W=u.getLittleEndian32();V=u.getLittleEndian32();var S=u.getLittleEndian32(),ia=u.getLittleEndian32();
svGlobal.logger.info("visible region, l:"+V+" t:"+W+" r:"+ia+" b:"+S)}na.setImgRect(P,U,N,I);break;case 1:case 2:break;default:svGlobal.logger.warn("unknown function:"+U)}break;default:svGlobal.logger.warn("unkown interface:"+M)}};return l}());jb||r.addDynamicChannel(B());ca.enableDVCAudio&&r.addDynamicChannel(function(l){var v=!1,q=0,u=0,M=0,P=0,U=[],N=new Uint8Array(4),I=new r.DynamicChannel;I.name="AUDIO_PLAYBACK_DVC";I.onclose=function(){};I.process=function(W){function V(ka){ka.skipPosition(14);
var qa=ka.getLittleEndian16();ka.getByte();var za=ka.getLittleEndian16();ka.skipPosition(1);for(var ya,Ga=U.length=0;Ga<qa;Ga++){var da=new g;da.fromBuffer(ka);(ya=22050<=da.nSamplesPerSec&&(1==da.formatTag||49==da.formatTag&&22050==da.nSamplesPerSec&&0==l||41222==da.formatTag))&&U.push(da)}da=20;ka=U.length;for(Ga=0;Ga<ka;Ga++)da+=U[Ga].getSize();Ga=da+4;qa=new RdpBuffer(new Uint8Array(Ga),0,Ga);qa.setByte(7);qa.setByte(2);qa.setLittleEndian16(da);qa.setLittleEndian32(3);qa.setLittleEndian32(4294967295);
qa.setLittleEndian32(0);qa.setLittleEndian16(0);qa.setLittleEndian16(ka);qa.skipPosition(1);qa.setLittleEndian16(za);qa.setByte(124);for(Ga=0;Ga<ka;Ga++)da=U[Ga],da.toBuffer(qa);qa.markEnd();I.send(qa);5<za&&(qa=new RdpBuffer(new Uint8Array(8),0,8),qa.setByte(12),qa.skipPosition(1),qa.setLittleEndian16(4),qa.setLittleEndian16(0),qa.setLittleEndian16(0),qa.markEnd(),I.send(qa))}function S(ka){var qa=ka.getLittleEndian16();ka=ka.getLittleEndian16();var za=new RdpBuffer(new Uint8Array(8),0,8);za.setByte(6);
za.setByte(35);za.setLittleEndian16(4);za.setLittleEndian16(qa);za.setLittleEndian16(ka);za.markEnd();I.send(za)}function ia(){var ka=U[M];if(ka.formatTag!=Ba.tag||ka.nSamplesPerSec!=Ba.samplePerSec||Ba.channels!=ka.nChannels)Ba.tag=ka.formatTag,Ba.channels=ka.nChannels,Ba.samplePerSec=ka.nSamplesPerSec,Ba.bitsPerSample=49==ka.formatTag?8:ka.bitsPerSample,svGlobal.logger.info("DVC Audio Format, tag="+Ba.tag+" channels="+Ba.channels+" bitsPerSample="+Ba.bitsPerSample+" samplePerSec="+Ba.samplePerSec),
41222==Ba.tag&&(Ba.sampleRate=Ba.samplePerSec,Ta.initMediaPlayer(Ta,Ba,!0))}function fa(ka){u=ka.getLittleEndian16();M=ka.getLittleEndian16();P=ka.getByte();ka.skipPosition(3);N.set(ka.getSubarray(4));v=!0;ia()}function la(ka,qa){var za=new RdpBuffer(new Uint8Array(8),0,8);za.setByte(5);za.skipPosition(1);za.setLittleEndian16(4);za.setLittleEndian16(ka);za.setByte(qa);za.skipPosition(1);za.markEnd();I.send(za)}function Ca(ka){v=!1;var qa=q-8,za=Date.now();ka.copyFromByteArray(N,0,ka.getPosition(),
4);hc(ka,P,u,qa);ka=u+(Date.now()-za);la(ka,P)}function ma(ka){var qa=Date.now();u=ka.getLittleEndian16();M=ka.getLittleEndian16();P=ka.getByte();ka.skipPosition(7);ia();ka=hc(ka,P,u,0);ka*=1E3;qa=u+(Date.now()-qa)+ka;la(qa,P)}if(v)Ca(W);else{var pa=W.getByte();W.skipPosition(1);q=W.getLittleEndian16();switch(pa){case 7:V(W);break;case 6:S(W);break;case 2:fa(W);break;case 3:W.getLittleEndian16();W.getLittleEndian16();break;case 13:ma(W)}}};return I}(e));svGlobal.DCVC_EXTENSION||(svGlobal.DCVC_EXTENSION=
{});var w=svGlobal.DCVC_EXTENSION;w.videoMedia={video:null,track:null,canvas:null,ctx:null,resolutions:null,minFrameRate:16,type:2,activate:function(l,v){svGlobal.logger.info("activate webcam");w.videoMedia.resolutions?l():hi5.video.resolutions(function(q){q.length?(w.videoMedia.resolutions=q,l()):v()})},deactivate:function(){var l=w.videoMedia;l.track&&(l.track.stop(),l.track=null);l.ctx=null;l.canvas=null;l.video=null;svGlobal.logger.info("deactivate cam")},startStream:function(l,v,q,u,M){svGlobal.logger.info("startStream, width:"+
l+" height:"+v+" frameRate:"+q);var P=w.videoMedia,U=P.track;if(U){var N=U.getSettings();if("live"==U.readyState)if(l!=N.width||v!=N.height||q!=N.frameRate&&2!=P.type)U.stop();else return}navigator.mediaDevices.getUserMedia({video:{frameRate:2==P.type?P.minFrameRate:q,width:{exact:l},height:{exact:v}}}).then(function(I){var W=document.createElement("video");W.srcObject=I;W.play();if(window.OffscreenCanvas)var V=new OffscreenCanvas(100,100);else V=document.createElement("canvas"),V.style.position=
"absolute",V.style.left=0,V.style.top=0;P.track=I.getVideoTracks()[0];P.canvas=V;P.ctx=V.getContext("2d");P.video=W;I=P.track.getSettings();P.canvas.width=I.width;P.canvas.height=I.height;u()}).catch(function(I){svGlobal.logger.warn(I);M()})},stopStream:function(){svGlobal.logger.info("stopStream");var l=w.videoMedia;l.track&&"live"==l.track.readyState&&l.track.stop()},grabFrame:function(l){function v(u){u.arrayBuffer().then(l)}var q=w.videoMedia;q.ctx.drawImage(q.video,0,0);q=q.canvas;q.convertToBlob?
q.convertToBlob({type:"image/jpeg",quality:.6}).then(v):q.toBlob(v,"image/jpeg",.6)},propertyList:[[{propertyId:1,capabilities:3,min:4294967286,max:4294967294,step:1,default:4294967291},null,{propertyId:3,capabilities:101,min:4294967280,max:16,step:1,default:0},{propertyId:4,capabilities:1,min:0,max:3,step:1,default:0},{propertyId:5,capabilities:1,min:4294967280,max:16,step:1,default:0},{propertyId:6,capabilities:1,min:100,max:400,step:10,default:100}],[{propertyId:1,capabilities:1,min:0,max:2,step:1,
default:1},{propertyId:2,capabilities:199,min:4294967232,max:64,step:1,default:0},{propertyId:3,capabilities:1,min:0,max:95,step:1,default:0},{propertyId:4,capabilities:1,min:4294965296,max:2E3,step:1,default:0},{propertyId:5,capabilities:67,min:2800,max:6500,step:1,default:4600}]]};w.WEBAUTHN=function(l){var v=new l;v.name="WebAuthN_Channel";v.newInstance=function(){return w.WEBAUTHN(l)};v.onopen=function(){svGlobal.logger.info("webAuthn open")};v.onclose=function(){svGlobal.logger.info("webAuthn close")};
v.process=function(q){var u=q.getEnd()-q.getPosition();q=q.getBytes(u);var M=Fb(q),P=M.command;u=M.flags;q=M.timeout;var U=M.webAuthNPara;if(P)switch(console.log("==== command: "+M.command),P){case 5:if(M.request)switch(P=M.request[0],console.log("==== webAuth cmdType = "+P),console.log("==== webAuth request bytes: "+sb(M.request.slice(1,M.request.length))),P){case 1:M=M.request.slice(1,M.request.length);var N=Fb(M);M=N[1];var I=N[2],W=N[3],V=N[4],S=N[5];P=N[6];var ia=N[7];N={};var fa=td(U);fa&&(fa.attestation&&
(N.attestation=fa.attestation),fa.attestationFormats&&(N.attestationFormats=fa.attestationFormats));if(u=sd(u,U,ia))N.authenticatorSelection=u;N.challenge=M;S&&(N.excludeCredentials=Ac(S));P&&(N.extensions=P);V&&(N.pubKeyCredParams=V);N.rp={id:window.location.hostname,name:"RS_Gateway"};q&&(N.timeout=q);N.user=W;q={};q.signal=createNewAbortWebAuthnSignal();q.publicKey=N;navigator.credentials.create(q).then(function(la){ud(la.response,I).then(function(Ca){var ma={},pa={maxMsgSize:1200,maxSerializedLargeBlobArray:0,
providerType:"Hid",providerName:"MicrosoftCtapHidProvider",devicePath:"\\\\?\\hid#vid_1050&pid_0407&mi_01#7&1dd131cc&0&0000#{4d1e55b2-f16f-11cf-88cb-001111000030}"},ka=new Uint8Array([159,87,192,47,19,129,234,71,177,22,187,90,141,185,32,42]);pa.aaGuid=ka.buffer;pa.residentKey=!0;ma.deviceInfo=pa;ma.status=0;ma.response=Ca;Ca=CBOR.encode(ma);ma=new hi5.DataBuffer(new Uint8Array(4+Ca.byteLength));ma.setLittleEndian32(0);ma.setBytes(Ca);ma.markEnd();v.send(ma)})}).catch(function(la){console.log("WebAuthN MakeCredential failed with error code ["+
la.code+"], msg: "+la.message);la=new hi5.DataBuffer(new Uint8Array(4));la.setLittleEndian32(1);la.markEnd();v.send(la)});break;case 2:M=M.request.slice(1,M.request.length);N=Fb(M);M=N[2];W=N[3];P=N[4];ia=N[5];N={};W&&(N.allowCredentials=Ac(W));N.challenge=M;P&&(N.extensions=P);N.rp=window.location.hostname;q&&(N.timeout=q);if(q=zc(u,U,ia))N.userVerification=q;q={};q.signal=createNewAbortWebAuthnSignal();q.publicKey=N;navigator.credentials.get(q).then(function(la){la=new hi5.DataBuffer(new Uint8Array(void 0));
la.markEnd();v.send(la)}).catch(function(la){console.log("WebAuthN GetAssertion failed with error code ["+la.code+"], msg: "+la.message);la=new hi5.DataBuffer(new Uint8Array(4));la.setLittleEndian32(1);la.markEnd();v.send(la)});break;default:svGlobal.logger.error("Unknown WebAuthn command type: "+P)}else svGlobal.logger.error("Incorrect request content in WEB AUTH COMMAND");break;case 6:q=new hi5.DataBuffer(new Uint8Array(8));q.setLittleEndian32(0);u=yc()?PublicKeyCredential.isUserVerifyingPlatformAuthenticatorAvailable():
!1;u?q.setLittleEndian32(1):q.setLittleEndian32(0);q.markEnd();v.send(q);break;case 7:cancelWebAuthnOperations();q=new hi5.DataBuffer(new Uint8Array(4));q.setLittleEndian32(0);q.markEnd();v.send(q);break;case 8:q=new hi5.DataBuffer(new Uint8Array(8));q.setLittleEndian32(0);q.setLittleEndian32(4);q.markEnd();v.send(q);break;default:svGlobal.logger.warn("Unknown command received in WebAuthN Channel: "+P)}else svGlobal.logger.warn("WebAuthN Channel, command missed")};return v};r.enableWebAuthn()&&yc()&&
(a=w.WEBAUTHN(r.DynamicChannel),r.addDynamicChannel(a));w.WEBCAM=function(l){var v=new l;v.name="RDCamera_Device_0";v.version=2;v.newInstance=function(){return w.WEBCAM(l)};v.onopen=function(){svGlobal.logger.info("cam open")};v.onclose=function(){svGlobal.logger.info("cam close")};v.sendSucess=function(){var q=new hi5.DataBuffer(new Uint8Array(2));q.setByte(v.version);q.setByte(1);q.markEnd();v.send(q)};v.sendError=function(q){var u=new hi5.DataBuffer(new Uint8Array(6));u.setByte(v.version);u.setByte(2);
u.setLittleEndian32(q||1);u.markEnd();v.send(u)};v.sendSteamListResp=function(){var q=new hi5.DataBuffer(new Uint8Array(7));q.setByte(v.version);q.setByte(10);q.setLittleEndian16(1);q.setByte(1);q.setByte(1);q.setByte(0);q.markEnd();v.send(q)};v.sendMediaTypeListResp=function(q){var u=w.videoMedia.resolutions,M=u.length,P=new hi5.DataBuffer(new Uint8Array(2+26*M));P.setByte(v.version);P.setByte(12);for(var U=1==q,N=0;N<M;N++){P.setByte(q);var I=u[N];P.setLittleEndian32(I.width);P.setLittleEndian32(I.height);
P.setLittleEndian32(U?I.frameRate:w.videoMedia.minFrameRate);P.setLittleEndian32(1);P.setLittleEndian32(1);P.setLittleEndian32(1);P.setByte(1)}P.markEnd();v.send(P)};v.sendCurrentMediaType=function(q,u){var M=new hi5.DataBuffer(new Uint8Array(28));M.setByte(v.version);M.setByte(14);u=w.videoMedia.resolutions[u];M.setByte(q);M.setLittleEndian32(u.width);M.setLittleEndian32(u.height);M.setLittleEndian32(1==q?u.frameRate:w.videoMedia.minFrameRate);M.setLittleEndian32(1);M.setLittleEndian32(1);M.setLittleEndian32(1);
M.setByte(1);M.markEnd();v.send(M)};v.sendSampleResp=function(q){w.videoMedia.grabFrame(function(u){var M=new hi5.DataBuffer(new Uint8Array(u.byteLength+3));M.setByte(v.version);M.setByte(18);M.setByte(q);M.setBytes(new Uint8Array(u));M.markEnd();v.send(M)})};v.sendPropertyListResp=function(){for(var q=0,u,M,P=w.videoMedia.propertyList,U=0;2>U;U++){M=P[U];u=M.length;for(var N=0;N<u;N++)null!=M[N]&&q++}q=new hi5.DataBuffer(new Uint8Array(2+19*q));q.setByte(v.version);q.setByte(21);for(U=0;2>U;U++)for(M=
P[U],u=M.length,N=0;N<u;N++)null!=M[N]&&(q.setByte(U),q.setByte(M.propertyId),q.setByte(M.capabilities),q.setLittleEndian32(M.min),q.setLittleEndian32(M.max),q.setLittleEndian32(M.step),q.setLittleEndian32(M.default));q.markEnd();v.send(q)};v.sendPropertyValueResp=function(q,u){(q=w.videoMedia.propertyList[q][u-1])?(u=new hi5.DataBuffer(new Uint8Array(7)),u.setByte(v.version),u.setByte(23),u.setByte(1),u.setLittleEndian32(q.value||q.default),u.markEnd(),v.send(u)):v.sendError(8)};v.process=function(q){q.getByte();
var u=q.getByte();switch(u){case 7:w.videoMedia.activate(v.sendSucess,v.sendError);break;case 8:w.videoMedia.deactivate();v.sendSucess();break;case 9:v.sendSteamListResp();break;case 11:q=q.getByte();0!=q&&svGlobal.logger.warn("Invalid stream index: "+q);v.sendMediaTypeListResp(w.videoMedia.type);break;case 13:q=q.getByte();v.sendCurrentMediaType(w.videoMedia.type,q);break;case 15:q.getByte();u=q.getByte();if(u!=w.videoMedia.type){svGlobal.warn("Invalid video format req:"+u);v.sendError(6);break}u=
q.getLittleEndian32();var M=q.getLittleEndian32();q=q.getLittleEndian32()/q.getLittleEndian32();w.videoMedia.startStream(u,M,q,v.sendSucess,v.sendError);break;case 16:w.videoMedia.stopStream();v.sendSucess();break;case 17:q=q.getByte();0!=q&&svGlobal.logger.info("Invalid stream index for SampleRequest: "+q);v.sendSampleResp(q);break;case 20:v.sendPropertyListResp();break;case 22:u=q.getByte();q=q.getByte();v.sendPropertyValueResp(u,q);break;case 24:v.sendError(10);break;default:v.sendError(10),svGlobal.logger.warn("Invalid cam msg: "+
u)}};return v};w.WEBCAM_ENUM=function(l,v){var q=new l;q.name="RDCamera_Device_Enumerator";q.onopen=function(){var u=new hi5.DataBuffer(new Uint8Array(2));u.setByte(v.version);u.setByte(3);u.markEnd();q.send(u);svGlobal.logger.info("camEnum open")};q.onclose=function(){svGlobal.logger.info("camEnum closed");w.videoMedia.deactivate()};q.addDevice=function(u){u+="\x00";var M=v.name+"\x00",P=new hi5.DataBuffer(new Uint8Array(2+2*u.length+M.length));P.setByte(v.version);P.setByte(5);P.setUnicodeString(u);
P.setAscllString(M);P.markEnd();q.send(P)};q.process=function(u){var M=u.getByte();u=u.getByte();switch(u){case 4:svGlobal.logger.info("camEnum ver resp: "+M);v.version=M;q.addDevice(hi5.video.webcam&&hi5.video.webcam.label||"Web Camera");break;default:svGlobal.logger.warn("invalid messageId on camEnum: "+u)}};return q};d&&(d=w.WEBCAM(r.DynamicChannel),a=w.WEBCAM_ENUM(r.DynamicChannel,d),r.addDynamicChannel(a),r.addDynamicChannel(d));k&&(svGlobal.logger.info("Mapping USB..."),r.addDynamicChannel(Ea.usbChannel));
b&&w.GFX&&r.addDynamicChannel(w.GFX(r,Q(L.remotefx)&&!Q(L.gfx)))}}},db=null;svGlobal.DCVC_EXTENSION&&!jb&&(r.hasUSB()&&svGlobal.DCVC_EXTENSION.WEBUSB&&(Ea.usbChannel=svGlobal.DCVC_EXTENSION.WEBUSB(r.DynamicChannel)),svGlobal.DCVC_EXTENSION.DRIVE&&(db=svGlobal.DCVC_EXTENSION.DRIVE(r.GatewayChannel),r.addGatewayChannel(db)));this.getPrinters=function(a){if(!r.onagentmessage||!db)return null;var b=new hi5.DataBuffer(new Uint8Array(2));b.setByte(6);b.setByte(1);b.markEnd();r.onagentmessage(b.getData());
db.listCallback=a};this.attachPrinter=function(a){db&&db.attachPrinter(a,r)};this.showError=Eb;this.resetStatus=Yb;this.exeAppCmd=function(a){var b=aa.getFocused();b&&b.exeCommand(a)};this.activateApp=function(a){var b;(b=hi5.tool.isNumber(a)?aa.getWinById(a):aa.getMainWinByAppId(a))?b.activate(1):svGlobal.logger.warn("No window found in "+a)};this.reconnect=function(a,b,c){void 0==c&&(c=ca.forceReconnect||!1);if(!Ha&&!c)return!1;L.minWidth&&a<L.minWidth&&(a<L.minWidth&&svGlobal.logger.warn("Width "+
a+" is samller than minWidth "+L.minWidth),a=L.minWidth);L.minHeight&&b<L.minHeight&&(b<L.minHeight&&svGlobal.logger.warn("Height "+b+" is samller than minHeight "+L.minHeight),b=L.minHeight);a&=-4;b&=-4;if(!c&&4>Math.abs(a-Ia)&&4>Math.abs(b-Ja))return!1;if(Sa&&Sa.enabled&&!1!==ca.displayVC)Sa.applyResolution(a,b);else if(lc&&pb||c||Xa&&!lc)pb=!1,svGlobal.logger.info("reconnecting..."),ra("8E0"+a+"\t"+b),Ra&&(Ra.remoteLockFlags=0,Ra.checkLockFlags=!0);return!0};this.notify=function(a,b){a="8E6"+a;
b&&(a+="\t"+b.join(";"));ra(a)};this.getUploadManager=function(){return Ma};this.setFPS=function(a){aa.execute("setFPS",[a])};this.addSurface=function(a){if(!aa.hasSurface(a)&&(Jb||na.setContext(a.context),!aa.hasSurface(a)||!a.railWin)){jb&&a.setPlayerMode();L.mouseMoveEmu&&(a.mouseMoveEmu=Q(L.mouseMoveEmu));a.setSize(50,50,"hidden");var b=a.getFreeSpace();0==Ia&&(Ia=b.width);0==Ja&&(Ja=b.height);a.setConfig(ca);aa.addSurface(a);Oa(Ia,Ja,!0,L.monitorDef?!0:!1);a.setController(Ra);a.setTouchpad(Q(L.touchpad));
var c=b=Q(L.mapClipboard),e=b;void 0!=L.copyToLocal?c=Q(L.copyToLocal):void 0!=ca.copyToLocal&&(c=ca.copyToLocal);void 0!=L.copyToRemote?e=Q(L.copyToRemote):void 0!=ca.copyToRemote&&(e=ca.copyToRemote);a.setClipboard(b,c,e);Ib&&Zb(a);L.invitation&&!Q(L.control)&&(aa.setReadOnly(!0),b=hi5.$("requestControl"))&&(b.disabled=!1);b=void 0!=L.ctrlToWin?Q(L.ctrlToWin):void 0!=ca.ctrlToWin?ca.ctrlToWin:!0;c=void 0!=L.cmdToCtrl?Q(L.cmdToCtrl):void 0!=ca.cmdToCtrl?ca.cmdToCtrl:!0;a.run(parseInt(L.keyboard||
1033,10),b,!!ca.noKeyStuck,c)}};this.getRunninApps=this.getRunningApps=function(){for(var a=[],b=0,c=aa.size();b<c;b++)aa.getSurface(b).railWin.getMain(aa.zOrders)&&a.push(aa.getSurface(b).railWin.getMain(aa.zOrders).titleInfo);return a};this.startApp=function(a,b,c){b=b||"";c=c||"";ra("8C2"+a+"\t"+b+"\t"+c);var e=aa.getSurface(aa.size()-1);e&&(e.remoteApp=new xc(a,b,c))};this.startExitingApp=function(a){a=aa.popWins(a);for(var b=a.length-1;0<=b;b--)aa.addWin(a[b])};var ub=new r.DynamicChannel;ub.name=
"PNPDR";ub.onopen=function(){svGlobal.logger.info("PNPDR DVC onopen()")};ub.process=function(a){a.getLittleEndian32();var b=a.getLittleEndian32();switch(b){case 101:a.getLittleEndian32(),a.getLittleEndian32(),a.getLittleEndian32(),a=new RdpBuffer(new Uint8Array(20),0,20),a.setLittleEndian32(20),a.setLittleEndian32(b),a.setLittleEndian32(1),a.setLittleEndian32(5),a.setLittleEndian32(1),ub.send(a)}};ub.onclose=function(){svGlobal.logger.info("PNPDR DVC onclose()")};r.addDynamicChannel(ub);var hb=null;
Q(L.scanner)&&(hb=new r.DynamicChannel,hb.name="SCANNERDVC",hb.onopen=function(){svGlobal.logger.info("scanner DVC onopen().")},hb.process=function(a){var b=a.getByte();switch(b){case 0:var c=a.getByte(),e=a.getByte();b=new Uint8Array(10);b[0]=4;b[1]=7;b[2]=c;b[3]=e;b.set(a.getBytes(2),4);b.set(a.getBytes(2),6);b.set(a.getBytes(2),8);if(r.onagentmessage)r.onagentmessage(b);break;case 1:break;case 2:c=a.getEnd()-a.getPosition();b=new Uint8Array(c+2);b[0]=4;b[1]=3;b.set(a.getBytes(c),2);if(r.onagentmessage)r.onagentmessage(b);
break;case 3:c=a.getEnd()-a.getPosition();b=new Uint8Array(c+3);b[0]=4;b[1]=9;b[2]=0;b.set(a.getBytes(c),3);if(r.onagentmessage)r.onagentmessage(b);break;default:svGlobal.logger.info('Warning: Unknown type "'+b+'" received from DVC, ignored.')}},hb.onclose=function(){var a=new Uint8Array(2);a[0]=4;a[1]=4;if(r.onagentmessage)r.onagentmessage(a)},r.addDynamicChannel(hb));var ab=null;r.hasSmartCard()&&(ab=new r.GatewayChannel,ab.name="SCARDSTB",ab.onopen=function(){var a=new Uint8Array(2);a[0]=3;a[1]=
1;if(r.onagentmessage)r.onagentmessage(a);Q(L.passwordIsPin)&&r.onagentmessage&&!hi5.browser.isMacOS&&hi5.notifications.notify({msg:__svi18n.info.scardAuth||"Smart card authentication in progress. Please wait...",type:0,timeout:1E4})},ab.process=function(a){var b=a.getEnd()-a.getPosition(),c=a.getByte(),e=a.getByte();switch(c){case 1:switch(e){case 1:c=new Uint8Array(2);c[0]=3;c[1]=7;if(r.onagentmessage)r.onagentmessage(c);break;case 3:a=a.getBytes(b-2);b=b+4+4+4;vb&&(b+=vb.length);eb&&(b+=eb.length);
b=new hi5.DataBuffer(new Uint8Array(b));b.setByte(3);b.setByte(9);vb?(b.setLittleEndian32(vb.length),b.setBytes(vb)):b.setLittleEndian32(0);eb?(b.setLittleEndian32(eb.length),b.setBytes(eb)):b.setLittleEndian32(0);b.setLittleEndian32(a.length);b.setBytes(a);b.markEnd();if(r.onagentmessage)r.onagentmessage(b.getData());break;case 5:a=a.getBytes(b);c=new Uint8Array(b);c[0]=3;c[1]=11;c.set(a,2);if(r.onagentmessage)r.onagentmessage(c);break;case 2:case 4:break;default:svGlobal.logger.warn("Invalid smart card channel auth data received: unknown sub-type ["+
a[1]+"].")}break;case 2:if(ab)if(1==e){if(c=new Uint8Array(b),c[0]=3,c[1]=3,c.set(a.getBytes(b),2),r.onagentmessage)r.onagentmessage(c)}else svGlobal.logger.warn("Invalid smart card channel pcsc data received: unknown sub-type ["+a[1]+"].");break;default:svGlobal.logger.warn("Invalid smart card channel data received: unknown type ["+a[0]+"].")}},ab.onclose=function(){var a=new Uint8Array(2);a[0]=3;a[1]=4;if(r.onagentmessage)r.onagentmessage(a)},r.addGatewayChannel(ab));ca.detectNetwork&&(p+="&connectType=7",
xd());this.getNetworkResult=function(){return Gb};this.getAgentLink=function(){var a=navigator.userAgentData?navigator.userAgentData.platform:navigator.platform||navigator.appVersion;return-1!=a.indexOf("Win")?"agent_setup.exe":-1!=a.indexOf("macOS")||-1!=a.indexOf("Mac")?"agent_setup.pkg":""};var $b=new Map,ac=new Map;this.writeAgent=function(a){a.byteLength&&(a=new Uint8Array(a));switch(a[0]){case 3:if(ab){var b=a.slice?new hi5.DataBuffer(a.slice(2,a.length)):new hi5.DataBuffer(a.subarray(2,a.length));
switch(a[1]){case 1:case 4:case 5:case 6:case 7:case 9:case 11:break;case 2:break;case 3:a[0]=2;a[1]=1;ab.send(a);break;case 8:$b.clear();ac.clear();a=b.getLittleEndian32();if(0!=a)a=b.getLittleEndian32(),b=b.getAscllString(a,!1),hi5.notifications.notify({msg:b});else{var c=b.getLittleEndian32(),e=document.getElementById("scardSelection");e||(e=document.createElement("div"),e.id="scardSelection",e.className="appdlg",document.body.appendChild(e));if(e)if(0==c)e&&(e.innerHTML="<p>Error: Could not find any connected smart card. Please make check the connectivity and then refresh the page",
b=new hi5.ui.Lightbox(e),b.onclose=function(){location.reload()},b.show());else{e.innerHTML=1<c?'<p><b>PLEASE SELECT A SMART CARD, ENTER YOUR CREDENTIAL AND CLICK "Continue".</b></p>':'<p><b>PLEASE ENTER YOUR CREDENTIAL AND CLICK "Continue".</b></p>';for(a=0;a<c;a++){var d=b.getLittleEndian32();d=b.getBytes(d);var k=b.getLittleEndian32();k=b.getAscllString(k,!1);var g=b.getLittleEndian32();g=b.getAscllString(g,!1);var B=b.getLittleEndian32();b.getAscllString(B,!1);B=b.getLittleEndian64();B=(new Date(1E3*
B)).toDateString();d=yd(a,d,g,k,B);e.appendChild(d)}e.innerHTML+="<br>";b=document.createElement("div");b.innerHTML+="Smart card credential: ";a=document.createElement("input");a.type="text";a.id="userPin";a.placeholder="PIN";a.value="";a.required=!0;b.appendChild(a);e.appendChild(b);e.innerHTML+="<br>";b=new hi5.ui.LightboxWithBtn(e);b.onclose=function(){var x,D=document.querySelector('input[name="scard_name"]:checked');D&&(x=parseInt(D.value));vb=$b.get(x);qb=ac.get(x);x=document.getElementById("userPin").value;
eb=(new TextEncoder("utf-8")).encode(x);x=2;x=eb?x+4+eb.length:x+4;x=qb?x+4+qb.length:x+4;x=new Uint8Array(x);x=new hi5.DataBuffer(x);x.setByte(1);x.setByte(2);eb?(x.setLittleEndian32(eb.length),x.setBytes(eb)):x.setLittleEndian32(0);qb?(x.setLittleEndian32(qb.length),x.setAsciiString(qb,qb.length)):x.setLittleEndian32(0);ab&&ab.send(x)};document.getElementById("userPin").addEventListener("keypress",function(x){"Enter"===x.key&&(x.preventDefault(),document.getElementById("continue_button").click())});
b.show()}}break;case 10:a=b.getLittleEndian32();0!=a?(a=b.getLittleEndian32(),b=b.getAscllString(a,!1),hi5.notifications.notify({msg:b})):(a=b.getLittleEndian32(),a=b.getBytes(a),b=new Uint8Array(6+a.length),b=new hi5.DataBuffer(b),b.setByte(1),b.setByte(4),b.setLittleEndian32(a.length),b.setBytes(a),ab.send(b));break;case 12:a[0]=1;a[1]=6;ab.send(a);break;default:svGlobal.logger.warn("Warning: Unknown smart card response header: [3 / "+a[1]+"], ignored.")}}break;case 4:if(hb)switch(a[1]){case 2:b=
a.slice?new hi5.DataBuffer(a.slice(2,a.length)):new hi5.DataBuffer(a.subarray(2,a.length));e=document.getElementById("dsSelection");e||(e=document.createElement("div"),e.id="dsSelection",e.className="appdlg",document.body.appendChild(e));if(0!=b.getLittleEndian16())e&&(e.innerHTML="<p>Error on local: failed to get the list of connected scanners. Close to continue without scanning.</p>",b=new hi5.ui.Lightbox(e),b.onclose=function(){r.run()},b.show());else if(c=(a.byteLength-4)/41,0==c)e&&(e.innerHTML=
"<p>Error: Could not find any connected scanner. Please:<ul><li>Power on or connect the scanner and then refresh the page; or</li><li>Close this dialog to connect to the machine without using scanner.</li></ul></p>",b=new hi5.ui.Lightbox(e),b.onclose=function(){r.run()},b.show());else if(1==c){if(b=new Uint8Array(3),b[0]=4,b[1]=5,b[2]=0,r.onagentmessage)r.onagentmessage(b)}else if(e){e.innerHTML='<p> Please choose a scanner &lt;DriverType: DeviceName&gt; and click "Continue".</a></p>';for(a=0;a<c;a++)d=
b.getAscllString(41,!0),d=zd(a,d),e.appendChild(d);e.innerHTML+="<br>";b=new hi5.ui.LightboxWithBtn(e);b.onclose=function(){var x=0,D=document.querySelector('input[name="ds_name"]:checked');D&&(x=D.value);D=new Uint8Array(3);D[0]=4;D[1]=5;D[2]=x;if(r.onagentmessage)r.onagentmessage(D)};b.show()}break;case 3:case 8:case 10:b=a.slice?new hi5.DataBuffer(a.slice(2,a.length)):new hi5.DataBuffer(a.subarray(2,a.length));hb.send(b);break;case 4:b=a.slice?new hi5.DataBuffer(a.slice(2,a.length)):new hi5.DataBuffer(a.subarray(2,
a.length));hb.send(b);hi5.notifications.notify({msg:__svi18n.info.TwainNotSupported,type:2});break;case 6:b=a.slice?new hi5.DataBuffer(a.slice(2,a.length)):new hi5.DataBuffer(a.subarray(2,a.length));b.getLittleEndian16();r.run();break;default:svGlobal.logger.warn("Warning: Unknown response header: [4 / "+a[1]+"], ignored.")}break;case 5:switch(a[1]){case 1:b=a[2]|a[3]<<8,a=a[4]|a[5]<<8,svGlobal.logger.info("Agent version, major: "+b+" minor: "+a),(e=hi5.appcfg.agent&&hi5.appcfg.agent.version)&&(e.major>
b||e.major==b&&e.minor>a)&&(b=__svi18n.info.newVersion||"New versoin available",a=__svi18n.info.updateAgent||"Please download and install the new gateway agent",e=r.getAgentLink(),hi5.notifications.notify({title:b,msg:a+(': <a href="'+e+'">'+e+"</a>")}))}break;case 6:switch(a[1]){case 1:b=new hi5.DataBuffer(a);b.skipPosition(2);e=b.getLittleEndian32();c=[];for(a=0;a<e;a++)k=b.getLittleEndian32(),d=b.getUnicodeString(k),k=b.getLittleEndian32(),k=b.getUnicodeString(k),c.push({name:d,driver:k});db&&
db.listCallback&&(db.listCallback(c),db.listCallback=null)}break;case 7:db.send(a.subarray(1));break;default:svGlobal.logger.warn("Invalid channel data received: unknown type ["+a[0]+"].")}};var vb,eb,qb,dc={type:6,data:null};this.setAgentStatus=function(a){Rc=a};this.getAgentStatus=function(){return Rc};this.run=function(){var a;if(a=null==r.onagentmessage)a=1==r.mode?!1:r.hasSmartCard()||r.hasScanner()||Q(L.localPrinter);a&&window.startGatewayAgent?startGatewayAgent(r):(r.hasUSB()?aa.getFocused().requestUsbDevices(r.getUSB(),
function(b){Ea.usbChannel.openDevices(b);bc()}):bc(),Ta.supportWebAudio&&Ta.iOSFix())};this.getDesktop=function(){return na};this.mouseDown=function(a,b,c){Xa&&ra("80"+a+"\t"+b+"\t"+c)};this.mouseMove=function(a,b){Xa&&ra("82"+a+"\t"+b)};this.mouseUp=function(a,b,c){Xa&&ra("81"+a+"\t"+b+"\t"+c)};this.writeKeyCode=function(a,b){Xa&&ra("8B"+(a?0:49152)+"\t"+b)};this.writeScancode=function(a,b){Xa&&("number"==typeof a?(ra("840\t"+a),ra("8449152\t"+a)):ra("84"+(a?0:49152)+"\t"+b))};this.resetSize=function(a,
b){r.reconnectOnResize&&(Wa?(mb&&(clearTimeout(mb),mb=0),a&=-4,b&=-4,mb=setTimeout(function(){Sa&&Sa.enabled&&Sa.applyResolution(a,b);setTimeout(function(){r.writeRawInput("8C661441\t"+a+"\t"+b);3==r.windowState&&Qc()},150);svGlobal.logger.info("-- displayChange, h:"+b)},777)):r.running()&&(mb&&(clearTimeout(mb),mb=0),mb=setTimeout(function(){r.reconnect(a,b)},555)))};var Va=new RdpBuffer([],0,0);this.suppressOutput=function(a){if(!r.sessionInfo.suppressOutput)return!1;void 0==a&&(a=!0);var b=new Uint8Array(a?
3:11);b[0]=146;b[1]=3;b[2]=a?1:0;a||(b[3]=Ub,b[4]=Ub>>8,b[5]=Tb,b[6]=Tb>>8,b[7]=Vb,b[8]=Vb>>8,b[9]=Wb,b[10]=Wb>>8);ra(b.buffer);return!0};this.refreshOutput=function(a,b,c,e){var d=new Uint8Array(c?11:3);d[0]=146;d[1]=3;d[2]=2;c&&(d[3]=a,d[4]=a>>8,d[5]=b,d[6]=b>>8,d[7]=c,d[8]=c>>8,d[9]=e,d[10]=e>>8);ra(d.buffer)};this.sendPing=function(a){var b=new Uint8Array(a?2+a.length:2);b[0]=146;b[1]=0;a&&b.set(a,2);ra(b.buffer)};this.startPing=function(a,b){b=b||0;Qa||(Qa=new hi5.tool.ResponseMonitor(function(){Xa&&
r.sendPing()},function(){if(Xa&&r.onnoresponse)return r.onnoresponse()}));Qa.setInterval(a,b);var c=new Uint8Array(4);c[0]=146;c[1]=2;c[2]=a;c[3]=b;ra(c.buffer);setTimeout(function(){Qa&&Qa.check()},1E3*(a+b));Ka?Ka.postMessage({type:0,cmd:6,start:1}):(Aa.onSlowPath=Aa.onFastPath=Hc,Aa.onReqHistory=function(){Hc(15555)})};this.stopPing=function(){Qa&&Qa.stop();Ka?Ka.postMessage({type:0,cmd:6,start:0}):Aa.onSlowPath=Aa.onFastPath=Aa.onReqHistory=null};var Ya=null,Nc=0;this.play=function(){ra("F3")};
this.pause=function(){ra("F2")};this.scan=function(a){ra("F4"+(a?"1":"0"))};this.seek=function(a){var b=aa.getFocused();b&&Ha&&(ra("F4"+(a?"1":"0")+"\t"+(a/b.getScale().x|0)),na.pause(!0))};var Ba={tag:0,channels:0,bitsPerSample:0,samplePerSec:22050,toStream:function(a){a.setLittleEndian16(this.tag);a.setLittleEndian16(this.channels);a.setLittleEndian16(this.bitsPerSample);a.setLittleEndian32(this.samplePerSec)},fromStream:function(a){this.tag=a.getLittleEndian16();this.channels=a.getLittleEndian16();
this.bitsPerSample=a.getLittleEndian16();this.samplePerSec=a.getLittleEndian32()}},Mc=!1;this.showMessage=function(a,b,c){r&&r.displayMsg&&a&&((b=b||aa.getFocused())?b.showMessage(a,c):("string"==typeof a&&(a={msg:a,timeout:c||0}),hi5.notifications.notify(a)))};this._unload=yb;this.close=function(){svGlobal.logger.info("closing...");Ha&&Wa&&aa&&ca.closeRemoteApp&&aa.tryCloseRemoteApps();na&&na.isSendingHistory()?(svGlobal.logger.warn("In the middle of sending history, close delayed"),setTimeout(Pc,
2222)):Pc()};hi5.browser.isChromeApp?chrome.runtime.onSuspend.addListener(r.close):window.addEventListener("unload",r.close,!1);mc.searchStartCode=function(a,b){for(var c=b[0]+2,e=a.length,d;c<e;)if(d=a[c],1==d){if(0==a[c-1]&&0==a[c-2]){b[1]=0==a[c-3]?4:3;b[0]=c-b[1]+1;return}c+=3}else 0==d?c++:c+=3;b[0]=-1};nc.SAMPLING_FREQUENCY=[96E3,88200,64E3,48E3,44100,32E3,24E3,22050,16E3,12E3,11025,8E3,7350];Kb.isVideoSupported="MediaSource"in window&&MediaSource.isTypeSupported('video/mp4; codecs="avc1.42E01E, mp4a.40.2"');
Kb.isAudioSupported="MediaSource"in window&&MediaSource.isTypeSupported('audio/mp4; codecs="mp4a.40.2"');svGlobal.DCVC_EXTENSION||(svGlobal.DCVC_EXTENSION={});svGlobal.DCVC_EXTENSION.GFX=function(a,b){function c(I,W,V,S){this.pixels=I;this.width=W;this.height=V;this.key=S}function e(){this.flags=this.bottom=this.right=this.top=this.left=0;this.read=function(I){this.left=I.getLittleEndian32();this.top=I.getLittleEndian32();this.right=I.getLittleEndian32();this.bottom=I.getLittleEndian32();this.flags=
I.getLittleEndian32()};this.toString=function(){return"left: "+this.left+" top: "+this.top+" right: "+this.right+" bottom: "+this.bottom+" flags: "+this.flags}}function d(I,W){x||(x=document.createElement("video"),F.setDrawable(x),l=new Kb(x,v,!1),l.onsps=function(ia){ia.fps&&a.setFPS(ia.fps)},l.onerror=function(ia){svGlobal.logger.info("Decoding error",ia);a.reconnect(F.width,F.height,!0)},l.onplayerror=function(ia){"AbortError"!=ia.name&&a.showMessage({msg:"Please click Yes to continue.<br>"+ia,
cbYes:function(){l.play(!0);this.destroy()}})},a.player=l);var V=I.getPosition(),S=I.getLittleEndian32();I.skipPosition(10*S);return I.getBytes(W-(I.getPosition()-V))}function k(I,W,V){V=I.getLittleEndian32();var S=V>>>30;V&=1073741823;switch(S){case 0:var ia=d(I,V);d(I,W-V-4);break;case 1:ia=d(I,V);break;case 2:W=I.getEnd()-I.getPosition();d(I,W);break;default:throw Error("Invalid LC: "+S);}if(ia)v.onvideoframe(ia)}var g=new function(){function I(da,f,n,h,t){this.len=da;this.code=f;this.valueBits=
n;this.type=h;this.vbase=t}function W(da){var f=25E5-fa,n=da.length;if(f>=n)ia.set(da,fa),fa=f>n?fa+n:0;else if(25E5>=n)ia.set(da.subarray(0,f),fa),ia.set(da.subarray(f),0),fa=n-f;else{f=(n-f)%25E5;var h=n-f,t=da.subarray(h);da=da.subarray(n-25E5,h);ia.set(da,25E5-da.length);ia.set(t,0);fa=f}}function V(da){for(;ka<da;)pa<<=8,qa<ya?pa+=za[qa++]:console.log("--- end"),ka+=8;ma-=da;ka-=da;da=pa>>ka;pa&=(1<<ka)-1;return da}var S=[new I(1,0,8,0,0),new I(5,17,5,1,0),new I(5,18,7,1,32),new I(5,19,9,1,160),
new I(5,20,10,1,672),new I(5,21,12,1,1696),new I(5,24,0,0,0),new I(5,25,0,0,1),new I(6,44,14,1,5792),new I(6,45,15,1,22176),new I(6,52,0,0,2),new I(6,53,0,0,3),new I(6,54,0,0,255),new I(7,92,18,1,54944),new I(7,93,20,1,317088),new I(7,110,0,0,4),new I(7,111,0,0,5),new I(7,112,0,0,6),new I(7,113,0,0,7),new I(7,114,0,0,8),new I(7,115,0,0,9),new I(7,116,0,0,10),new I(7,117,0,0,11),new I(7,118,0,0,58),new I(7,119,0,0,59),new I(7,120,0,0,60),new I(7,121,0,0,61),new I(7,122,0,0,62),new I(7,123,0,0,63),
new I(7,124,0,0,64),new I(7,125,0,0,128),new I(8,188,20,1,1365664),new I(8,189,21,1,2414240),new I(8,252,0,0,12),new I(8,253,0,0,56),new I(8,254,0,0,57),new I(8,255,0,0,102),new I(9,380,22,1,4511392),new I(9,381,23,1,8705696),new I(9,382,24,1,17094304)],ia=new Uint8Array(25E5),fa=0,la=new Uint8Array(65536),Ca=0,ma=0,pa=0,ka=0,qa=0,za=null,ya=0,Ga=!0;this.toPDU=function(){if(Ga)return null;var da=new Uint8Array(2500008);da[0]=29;da[2]=1;da[3]=10;da[4]=fa;da[5]=fa>>8;da[6]=fa>>16;da[7]=fa>>24;da.set(ia,
8);return da};this.fromStream=function(da){fa=da.getLittleEndian32();ia.set(da.getSubarray(25E5))};this.decompress=function(da,f){if(f){za=da;Ga&&(Ga=!1);ya=za.length-1;ma=8*ya-za[ya];for(Ca=qa=ka=pa=0;0<ma;)for(var n=f=0,h=0;h<S.length;h++){for(da=S[h];f<da.len;)n=(n<<1)+V(1),f++;0>n&&console.log("xxx inPrefix");if(n==da.code){if(0==da.type)da=da.vbase+V(da.valueBits),(0>da||255<da)&&console.log("xxx do c"),da&=255,ia[fa]=da,25E5==++fa&&(fa=0),la[Ca++]=da;else if(f=V(da.valueBits),f=da.vbase+f,0>
f&&console.log("xxx distance"),0!=f){if(0==V(1))da=3;else{da=4;for(n=2;1==V(1);)da*=2,n++;da+=V(n)}f=25E5-f+fa;f%=25E5;n=f+da;if(Math.abs(fa-f)>=da&&25E5>n&&25E5>fa+da)f=ia.subarray(f,n),ia.set(f,fa),fa+=da,la.set(f,Ca),Ca+=da;else for(;0<da;)n=ia[f],25E5==++f&&(f=0),ia[fa]=n,25E5==++fa&&(fa=0),la[Ca++]=n,da--}else da=V(15),ma-=ka,pa=ka=0,f=za.subarray(qa,qa+da),W(f),la.set(f,Ca),qa+=da,Ca+=da,ma-=8*da;break}}65536<Ca&&console.error("xx outputIndex:"+Ca);return la.subarray(0,Ca)}W(da);return da}},
B=new function(){this.process=function(I){var W=I.getByte();if(224==W){var V=0!=(I.getByte()&32);var S=I.getPosition(),ia=I.getEnd();W=g.decompress(I.getData().subarray(S,ia),V);I.setPosition(ia)}else{225!=W&&console.log("Invalid descriptor:"+W);ia=I.getLittleEndian16();var fa=I.getLittleEndian32();W=new Uint8Array(fa);for(var la=0,Ca,ma=0;ma<ia;ma++)Ca=I.getLittleEndian32(),V=0!=(I.getByte()&32),Ca--,S=I.getPosition(),V=g.decompress(I.getData().subarray(S,S+Ca),V),W.set(V,la),la+=V.length,I.skipPosition(Ca);
la!=fa&&console.error("wrong size, actual:"+la+" expected:"+fa)}return new RdpBuffer(W,0,W.length)}},x=null,D=null,F=a.getDesktop(),w=new rdpcodecs.RemoteFX(!1),l=null,v=new a.DynamicChannel;v.name="Microsoft::Windows::RDS::Graphics";v.process=function(I){for(var W=B.process(I);W.has(8);){var V=W.getLittleEndian16();W.getLittleEndian16();var S=W.getLittleEndian32(),ia=W.getPosition()+S-8;switch(V){case 1:var fa=W,la=fa.getLittleEndian16(),Ca=fa.getLittleEndian16();fa.getByte();var ma=fa.getLittleEndian16(),
pa=fa.getLittleEndian16(),ka=fa.getLittleEndian16(),qa=fa.getLittleEndian16(),za=ka-ma,ya=qa-pa,Ga=fa.getLittleEndian32(),da=fa.getPosition()+Ga,f=q[la]||F;switch(Ca){case 0:var n=rdpcodecs.bitmap.byte2int(fa.getData(),Ga,fa.getPosition());f.setRGBs(ma,pa,za,ya,n,0,za);break;case 3:for(var h=w.decode(fa,Ga),t=h.getRects(),y=h.getTiles(),z=h.getTileSize(),E=h.getRectSize(),C=0;C<z;C++){var A=y[C];if(E)for(var T=A.x+64,J=A.y+64,m=0;m<E;m++){var H=t[m],K=H.x+H.width,O=H.y+H.height;T<=K?J<=O?f.setRGBs(A.x+
ma,A.y+pa,64,64,A.data,0,64):f.setRGBs(A.x+ma,A.y+pa,64,O-A.y,A.data,0,64):J<=O?f.setRGBs(A.x+ma,A.y+pa,K-A.x,64,A.data,0,64):f.setRGBs(A.x+ma,A.y+pa,K-A.x,O-A.y,A.data,0,64)}else f.setRGBs(A.x,A.y,64,64,A.data,0,4)}break;case 8:D||(D=new ClearDecoder);D.decode(fa,za,ya,f.getData(),ma,pa,f.width);break;case 10:svGlobal.logger.info("...PLANAR");break;case 11:var Z=d(fa,Ga);v.onvideoframe(Z);break;case 12:svGlobal.logger.info("...ALPHA");break;case 14:k(fa,Ga,!1);break;case 15:k(fa,Ga,!0);break;default:svGlobal.logger.warn("Invalid codec:"+
Ca)}fa.setPosition(da);f.postPaint(ma,pa,za,ya);break;case 2:svGlobal.logger.info("RDPGFX_WIRE_TO_SURFACE_PDU_2");break;case 3:svGlobal.logger.info("RDPGFX_CMDID_DELETEENCODINGCONTEXT");break;case 4:for(var ha=W,xa=ha.getLittleEndian16(),Fa=-16777216|ha.getByte()<<16|ha.getByte()<<8|ha.getByte()|ha.getByte()<<24,La=ha.getLittleEndian16(),Da=q[xa]||F,ua=0;ua<La;ua++){var Pa=ha.getLittleEndian16(),ta=ha.getLittleEndian16(),va=ha.getLittleEndian16()-Pa,Na=ha.getLittleEndian16()-ta;Da.fillRect(Pa,ta,
va,Na,Fa);Da.postPaint(Pa,ta,va,Na)}break;case 5:for(var Ua=W,Za=Ua.getLittleEndian16(),$a=Ua.getLittleEndian16(),gb=Ua.getLittleEndian16(),lb=Ua.getLittleEndian16(),Mb=Ua.getLittleEndian16()-gb,qc=Ua.getLittleEndian16()-lb,Md=Ua.getLittleEndian16(),Xc=q[Za]||F,Nd=q[$a]||F,Yc=Za==$a?null:Xc.getRGBs(gb,lb,Mb,qc),Zc=0;Zc<Md;Zc++){var $c=Ua.getLittleEndian16(),ad=Ua.getLittleEndian16();Yc?Nd.setRGBs($c,ad,Mb,qc,Yc,0,Mb):Xc.moveArea(gb,lb,Mb,qc,$c-gb,ad-lb)}break;case 6:var nb=W,Od=nb.getLittleEndian16(),
rc=nb.getLittleEndian32().toString(16),bd=nb.getLittleEndian32();0<bd&&(rc=bd.toString(16)+rc);var Pd=nb.getLittleEndian16(),cd=nb.getLittleEndian16(),dd=nb.getLittleEndian16(),ed=nb.getLittleEndian16()-cd,fd=nb.getLittleEndian16()-dd,Qd=(q[Od]||F).getRGBs(cd,dd,ed,fd);N[Pd]=new c(Qd,ed,fd,rc);break;case 7:for(var Cb=W,Rd=Cb.getLittleEndian16(),Sd=Cb.getLittleEndian16(),Td=Cb.getLittleEndian16(),Nb=N[Rd],Ud=q[Sd]||F,gd=0;gd<Td;gd++){var Vd=Cb.getLittleEndian16(),Wd=Cb.getLittleEndian16();Ud.setRGBs(Vd,
Wd,Nb.width,Nb.height,Nb.pixels,0,Nb.width)}break;case 8:var Xd=W.getLittleEndian16();N[Xd]=null;break;case 9:var Ob=W,sc=Ob.getLittleEndian16(),hd=Ob.getLittleEndian16(),id=Ob.getLittleEndian16(),Pb=F;Pb.id=sc;Pb.pixelFormat=Ob.getByte();q[sc]=Pb;a.setResolution(hd,id);svGlobal.logger.info("create surface id:"+sc+" w:"+hd+" h:"+id+" pixelFmt:"+Pb.pixelFormat);break;case 10:var jd=W.getLittleEndian16();q[jd]=null;svGlobal.logger.info("delete surface id:"+jd);break;case 11:var kd=W;kd.getLittleEndian32();
kd.getLittleEndian32();break;case 12:var Yd=W.getLittleEndian32();if(0==u){var ld=new Uint8Array(20),wb=new RdpBuffer(ld);wb.setLittleEndian16(13);wb.setLittleEndian16(0);wb.setLittleEndian32(20);wb.setLittleEndian32(4294967295);wb.setLittleEndian32(Yd);u++;wb.setLittleEndian32(u);0==a.mode&&v.send(ld)}break;case 14:var Qb=W,md=Qb.getLittleEndian32(),nd=Qb.getLittleEndian32(),od=Qb.getLittleEndian32();svGlobal.logger.info("reset graphic, w:"+md+" h:"+nd+" monitors:"+od);F&&F.resize(md,nd);l&&l.reset();
for(var tc=0;tc<od;tc++){var pd=new e;pd.read(Qb);svGlobal.logger.info("MonitorDef "+tc+": "+pd.toString())}break;case 15:var Rb=W;M=Rb.getLittleEndian16();Rb.skipPosition(2);P=Rb.getLittleEndian32();U=Rb.getLittleEndian32();svGlobal.logger.info("surface output map: id:"+M+" x:"+P+" y:"+U);break;case 17:svGlobal.logger.info("TODO: DPGFX_CACHE_IMPORT_REPLY_PDU");break;case 19:var uc=W,qd=uc.getLittleEndian32(),Zd=uc.getLittleEndian32(),Db=uc.getLittleEndian32(),Sb=!1;switch(qd){case 524292:Sb=!1;0==
(Db&1)&&(D=new ClearDecoder);break;case 524549:(Sb=0!=(Db&16))||0!=(Db&1)||(D=new ClearDecoder);break;default:Sb=0==(Db&32)}svGlobal.logger.info("Gfx Cap, Ver:"+qd.toString(16)+" len:"+Zd+" flags:"+Db+" h264:"+Sb);break;case 21:svGlobal.logger.info("mapSurfaceToWin");break;case 22:break;case 23:var xb=W;M=xb.getLittleEndian16();xb.skipPosition(2);P=xb.getLittleEndian32();U=xb.getLittleEndian32();var $d=xb.getLittleEndian32(),ae=xb.getLittleEndian32();svGlobal.logger.info("mapSurfaceToScaledOutput, outputSurfaceId:"+
M+" outX:"+P+" outY:"+U+" targetW:"+$d+" targetH:"+ae);break;case 24:svGlobal.logger.info("mapSurfaceToScaledWin");break;default:svGlobal.logger.warn("xxx gfx:"+V);return}W.setPosition(ia)}};v.onopen=function(){svGlobal.logger.info("GFX Open, remotefx:"+b);var I=b?2:8,W=120*I,V=new Uint8Array(W),S=new RdpBuffer(V);S.setLittleEndian16(18);S.setLittleEndian16(0);S.setLittleEndian32(W);S.setLittleEndian16(I);S.setLittleEndian32(524292);S.setLittleEndian32(4);S.setLittleEndian32(1);S.setLittleEndian32(524549);
S.setLittleEndian32(4);S.setLittleEndian32(19);b||(S.setLittleEndian32(655362),S.setLittleEndian32(4),S.setLittleEndian32(0),S.setLittleEndian32(655872),S.setLittleEndian32(4),S.setLittleEndian32(0),S.setLittleEndian32(656129),S.setLittleEndian32(4),S.setLittleEndian32(0),S.setLittleEndian32(656384),S.setLittleEndian32(4),S.setLittleEndian32(0),S.setLittleEndian32(656642),S.setLittleEndian32(4),S.setLittleEndian32(0),S.setLittleEndian32(656896),S.setLittleEndian32(4),S.setLittleEndian32(0));S.markEnd();
0==a.mode&&v.send(V)};v.onclose=function(){F.setDrawable(null);l&&(l.close(),l=null);x=a.player=null};var q={},u=0,M=0,P=0,U=0,N=[];F.onGetGfxHistory=function(I,W){var V=g.toPDU();V&&I(V);W();svGlobal.logger.info("Get GFX Histroy")};F.onSetGfxHistory=function(I,W){svGlobal.logger.info("Set GFX Histroy");10==I?g.fromStream(W):svGlobal.logger.error("Invalid GFX histroy type: "+I)};return v}}
Rdp.languageToKeyboard={af:0,sq:0,ar:1025,"ar-SA":1025,"ar-IQ":0,"ar-EG":0,"ar-LY":0,"ar-DZ":0,"ar-MA":0,"ar-TN":0,"ar-OM":0,"ar-YE":0,"ar-SY":0,"ar-JO":0,"ar-LB":0,"ar-KW":0,"ar-AE":0,"ar-BH":0,"ar-QA":0,eu:0,bg:0,be:0,ca:0,zh:2052,"zh-TW":1028,"zh-CN":2052,"zh-HK":1028,"zh-SG":2052,hr:0,cs:0,da:0,nl:1043,"nl-BE":2067,en:1033,"en-US":1033,"en-GB":2057,"en-AU":0,"en-CA":4105,"en-NA":0,"en-IE":0,"en-ZA":0,"en-JM":0,"en-BZ":0,et:0,fo:0,fa:0,fi:0,fr:1036,"fr-BE":2060,"fr-CA":3084,"fr-CH":4108,"fr-LU":0,
gd:0,"gd-IE":0,de:1031,"de-CH":2055,"de-AT":0,"de-LU":0,"de-LI":0,el:0,he:1037,hi:0,hu:0,is:1039,id:0,it:1040,"it-CH":66576,ja:3758162961,ko:3758162962,lv:0,lt:0,mk:0,mt:0,nb:1044,nn:1083,no:1044,pl:1045,pt:2070,"pt-BR":1046,rm:0,ro:0,"ro-MO":0,ru:1049,"ru-MO":0,sr:0,sk:0,sl:0,sb:0,es:1034,"es-AR":0,"es-GT":0,"es-CR":0,"es-PA":0,"es-DO":0,"es-MX":2058,"es-VE":0,"es-CO":0,"es-PE":0,"es-EC":0,"es-CL":0,"es-UY":0,"es-PY":0,"es-BO":0,"es-SV":0,"es-HN":0,"es-NI":0,"es-PR":0,sx:0,sv:1053,"sv-FI":0,th:0,
ts:0,tn:0,tr:1055,uk:0,ur:0,ve:0,vi:0,xh:0,ji:0,zu:0,detect:function(){var p=navigator&&(navigator.language||navigator.userLanguage||""),G=Rdp.languageToKeyboard[p];if(!G){var R=p.indexOf("-");R&&(G=Rdp.languageToKeyboard[p.substring(0,R)])}G||(svGlobal.logger.info("No valid layout for "+p),G=1033);return G}};svGlobal.Rdp||(svGlobal.Rdp=Rdp);var RdpBuffer=hi5.DataBuffer;
