var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.arrayIteratorImpl=function(n){var J=0;return function(){return J<n.length?{done:!1,value:n[J++]}:{done:!0}}};$jscomp.arrayIterator=function(n){return{next:$jscomp.arrayIteratorImpl(n)}};$jscomp.makeIterator=function(n){var J="undefined"!=typeof Symbol&&Symbol.iterator&&n[Symbol.iterator];return J?J.call(n):$jscomp.arrayIterator(n)};$jscomp.arrayFromIterator=function(n){for(var J,V=[];!(J=n.next()).done;)V.push(J.value);return V};
$jscomp.arrayFromIterable=function(n){return n instanceof Array?n:$jscomp.arrayFromIterator($jscomp.makeIterator(n))};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.SIMPLE_FROUND_POLYFILL=!1;$jscomp.ISOLATE_POLYFILLS=!1;$jscomp.FORCE_POLYFILL_PROMISE=!1;$jscomp.FORCE_POLYFILL_PROMISE_WHEN_NO_UNHANDLED_REJECTION=!1;$jscomp.objectCreate=$jscomp.ASSUME_ES5||"function"==typeof Object.create?Object.create:function(n){var J=function(){};J.prototype=n;return new J};
$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(n,J,V){if(n==Array.prototype||n==Object.prototype)return n;n[J]=V.value;return n};$jscomp.getGlobal=function(n){n=["object"==typeof globalThis&&globalThis,n,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof global&&global];for(var J=0;J<n.length;++J){var V=n[J];if(V&&V.Math==Math)return V}throw Error("Cannot find global object");};$jscomp.global=$jscomp.getGlobal(this);
$jscomp.IS_SYMBOL_NATIVE="function"===typeof Symbol&&"symbol"===typeof Symbol("x");$jscomp.TRUST_ES6_POLYFILLS=!$jscomp.ISOLATE_POLYFILLS||$jscomp.IS_SYMBOL_NATIVE;$jscomp.polyfills={};$jscomp.propertyToPolyfillSymbol={};$jscomp.POLYFILL_PREFIX="$jscp$";var $jscomp$lookupPolyfilledValue=function(n,J){var V=$jscomp.propertyToPolyfillSymbol[J];if(null==V)return n[J];V=n[V];return void 0!==V?V:n[J]};
$jscomp.polyfill=function(n,J,V,ka){J&&($jscomp.ISOLATE_POLYFILLS?$jscomp.polyfillIsolated(n,J,V,ka):$jscomp.polyfillUnisolated(n,J,V,ka))};$jscomp.polyfillUnisolated=function(n,J,V,ka){V=$jscomp.global;n=n.split(".");for(ka=0;ka<n.length-1;ka++){var T=n[ka];if(!(T in V))return;V=V[T]}n=n[n.length-1];ka=V[n];J=J(ka);J!=ka&&null!=J&&$jscomp.defineProperty(V,n,{configurable:!0,writable:!0,value:J})};
$jscomp.polyfillIsolated=function(n,J,V,ka){var T=n.split(".");n=1===T.length;ka=T[0];ka=!n&&ka in $jscomp.polyfills?$jscomp.polyfills:$jscomp.global;for(var sa=0;sa<T.length-1;sa++){var Y=T[sa];if(!(Y in ka))return;ka=ka[Y]}T=T[T.length-1];V=$jscomp.IS_SYMBOL_NATIVE&&"es6"===V?ka[T]:null;J=J(V);null!=J&&(n?$jscomp.defineProperty($jscomp.polyfills,T,{configurable:!0,writable:!0,value:J}):J!==V&&($jscomp.propertyToPolyfillSymbol[T]=$jscomp.IS_SYMBOL_NATIVE?$jscomp.global.Symbol(T):$jscomp.POLYFILL_PREFIX+
T,T=$jscomp.propertyToPolyfillSymbol[T],$jscomp.defineProperty(ka,T,{configurable:!0,writable:!0,value:J})))};
$jscomp.getConstructImplementation=function(){function n(){function V(){}new V;Reflect.construct(V,[],function(){});return new V instanceof V}if($jscomp.TRUST_ES6_POLYFILLS&&"undefined"!=typeof Reflect&&Reflect.construct){if(n())return Reflect.construct;var J=Reflect.construct;return function(V,ka,T){V=J(V,ka);T&&Reflect.setPrototypeOf(V,T.prototype);return V}}return function(V,ka,T){void 0===T&&(T=V);T=$jscomp.objectCreate(T.prototype||Object.prototype);return Function.prototype.apply.call(V,T,ka)||
T}};$jscomp.construct={valueOf:$jscomp.getConstructImplementation}.valueOf();$jscomp.underscoreProtoCanBeSet=function(){var n={a:!0},J={};try{return J.__proto__=n,J.a}catch(V){}return!1};$jscomp.setPrototypeOf=$jscomp.TRUST_ES6_POLYFILLS&&"function"==typeof Object.setPrototypeOf?Object.setPrototypeOf:$jscomp.underscoreProtoCanBeSet()?function(n,J){n.__proto__=J;if(n.__proto__!==J)throw new TypeError(n+" is not extensible");return n}:null;
$jscomp.inherits=function(n,J){n.prototype=$jscomp.objectCreate(J.prototype);n.prototype.constructor=n;if($jscomp.setPrototypeOf){var V=$jscomp.setPrototypeOf;V(n,J)}else for(V in J)if("prototype"!=V)if(Object.defineProperties){var ka=Object.getOwnPropertyDescriptor(J,V);ka&&Object.defineProperty(n,V,ka)}else n[V]=J[V];n.superClass_=J.prototype};$jscomp.generator={};
$jscomp.generator.ensureIteratorResultIsObject_=function(n){if(!(n instanceof Object))throw new TypeError("Iterator result "+n+" is not an object");};$jscomp.generator.Context=function(){this.isRunning_=!1;this.yieldAllIterator_=null;this.yieldResult=void 0;this.nextAddress=1;this.finallyAddress_=this.catchAddress_=0;this.finallyContexts_=this.abruptCompletion_=null};
$jscomp.generator.Context.prototype.start_=function(){if(this.isRunning_)throw new TypeError("Generator is already running");this.isRunning_=!0};$jscomp.generator.Context.prototype.stop_=function(){this.isRunning_=!1};$jscomp.generator.Context.prototype.jumpToErrorHandler_=function(){this.nextAddress=this.catchAddress_||this.finallyAddress_};$jscomp.generator.Context.prototype.next_=function(n){this.yieldResult=n};
$jscomp.generator.Context.prototype.throw_=function(n){this.abruptCompletion_={exception:n,isException:!0};this.jumpToErrorHandler_()};$jscomp.generator.Context.prototype.return=function(n){this.abruptCompletion_={return:n};this.nextAddress=this.finallyAddress_};$jscomp.generator.Context.prototype.jumpThroughFinallyBlocks=function(n){this.abruptCompletion_={jumpTo:n};this.nextAddress=this.finallyAddress_};$jscomp.generator.Context.prototype.yield=function(n,J){this.nextAddress=J;return{value:n}};
$jscomp.generator.Context.prototype.yieldAll=function(n,J){n=$jscomp.makeIterator(n);var V=n.next();$jscomp.generator.ensureIteratorResultIsObject_(V);if(V.done)this.yieldResult=V.value,this.nextAddress=J;else return this.yieldAllIterator_=n,this.yield(V.value,J)};$jscomp.generator.Context.prototype.jumpTo=function(n){this.nextAddress=n};$jscomp.generator.Context.prototype.jumpToEnd=function(){this.nextAddress=0};
$jscomp.generator.Context.prototype.setCatchFinallyBlocks=function(n,J){this.catchAddress_=n;void 0!=J&&(this.finallyAddress_=J)};$jscomp.generator.Context.prototype.setFinallyBlock=function(n){this.catchAddress_=0;this.finallyAddress_=n||0};$jscomp.generator.Context.prototype.leaveTryBlock=function(n,J){this.nextAddress=n;this.catchAddress_=J||0};
$jscomp.generator.Context.prototype.enterCatchBlock=function(n){this.catchAddress_=n||0;n=this.abruptCompletion_.exception;this.abruptCompletion_=null;return n};$jscomp.generator.Context.prototype.enterFinallyBlock=function(n,J,V){V?this.finallyContexts_[V]=this.abruptCompletion_:this.finallyContexts_=[this.abruptCompletion_];this.catchAddress_=n||0;this.finallyAddress_=J||0};
$jscomp.generator.Context.prototype.leaveFinallyBlock=function(n,J){J=this.finallyContexts_.splice(J||0)[0];if(J=this.abruptCompletion_=this.abruptCompletion_||J){if(J.isException)return this.jumpToErrorHandler_();void 0!=J.jumpTo&&this.finallyAddress_<J.jumpTo?(this.nextAddress=J.jumpTo,this.abruptCompletion_=null):this.nextAddress=this.finallyAddress_}else this.nextAddress=n};$jscomp.generator.Context.prototype.forIn=function(n){return new $jscomp.generator.Context.PropertyIterator(n)};
$jscomp.generator.Context.PropertyIterator=function(n){this.object_=n;this.properties_=[];for(var J in n)this.properties_.push(J);this.properties_.reverse()};$jscomp.generator.Context.PropertyIterator.prototype.getNext=function(){for(;0<this.properties_.length;){var n=this.properties_.pop();if(n in this.object_)return n}return null};$jscomp.generator.Engine_=function(n){this.context_=new $jscomp.generator.Context;this.program_=n};
$jscomp.generator.Engine_.prototype.next_=function(n){this.context_.start_();if(this.context_.yieldAllIterator_)return this.yieldAllStep_(this.context_.yieldAllIterator_.next,n,this.context_.next_);this.context_.next_(n);return this.nextStep_()};
$jscomp.generator.Engine_.prototype.return_=function(n){this.context_.start_();var J=this.context_.yieldAllIterator_;if(J)return this.yieldAllStep_("return"in J?J["return"]:function(V){return{value:V,done:!0}},n,this.context_.return);this.context_.return(n);return this.nextStep_()};
$jscomp.generator.Engine_.prototype.throw_=function(n){this.context_.start_();if(this.context_.yieldAllIterator_)return this.yieldAllStep_(this.context_.yieldAllIterator_["throw"],n,this.context_.next_);this.context_.throw_(n);return this.nextStep_()};
$jscomp.generator.Engine_.prototype.yieldAllStep_=function(n,J,V){try{var ka=n.call(this.context_.yieldAllIterator_,J);$jscomp.generator.ensureIteratorResultIsObject_(ka);if(!ka.done)return this.context_.stop_(),ka;var T=ka.value}catch(sa){return this.context_.yieldAllIterator_=null,this.context_.throw_(sa),this.nextStep_()}this.context_.yieldAllIterator_=null;V.call(this.context_,T);return this.nextStep_()};
$jscomp.generator.Engine_.prototype.nextStep_=function(){for(;this.context_.nextAddress;)try{var n=this.program_(this.context_);if(n)return this.context_.stop_(),{value:n.value,done:!1}}catch(J){this.context_.yieldResult=void 0,this.context_.throw_(J)}this.context_.stop_();if(this.context_.abruptCompletion_){n=this.context_.abruptCompletion_;this.context_.abruptCompletion_=null;if(n.isException)throw n.exception;return{value:n.return,done:!0}}return{value:void 0,done:!0}};
$jscomp.generator.Generator_=function(n){this.next=function(J){return n.next_(J)};this.throw=function(J){return n.throw_(J)};this.return=function(J){return n.return_(J)};this[Symbol.iterator]=function(){return this}};$jscomp.generator.createGenerator=function(n,J){J=new $jscomp.generator.Generator_(new $jscomp.generator.Engine_(J));$jscomp.setPrototypeOf&&n.prototype&&$jscomp.setPrototypeOf(J,n.prototype);return J};
$jscomp.asyncExecutePromiseGenerator=function(n){function J(ka){return n.next(ka)}function V(ka){return n.throw(ka)}return new Promise(function(ka,T){function sa(Y){Y.done?ka(Y.value):Promise.resolve(Y.value).then(J,V).then(sa,T)}sa(n.next())})};$jscomp.asyncExecutePromiseGeneratorFunction=function(n){return $jscomp.asyncExecutePromiseGenerator(n())};$jscomp.asyncExecutePromiseGeneratorProgram=function(n){return $jscomp.asyncExecutePromiseGenerator(new $jscomp.generator.Generator_(new $jscomp.generator.Engine_(n)))};
$jscomp.polyfill("Reflect",function(n){return n?n:{}},"es6","es3");$jscomp.polyfill("Reflect.construct",function(n){return $jscomp.construct},"es6","es3");$jscomp.polyfill("Reflect.setPrototypeOf",function(n){if(n)return n;if($jscomp.setPrototypeOf){var J=$jscomp.setPrototypeOf;return function(V,ka){try{return J(V,ka),!0}catch(T){return!1}}}return null},"es6","es5");$jscomp.initSymbol=function(){};
$jscomp.polyfill("Symbol",function(n){if(n)return n;var J=function(T,sa){this.$jscomp$symbol$id_=T;$jscomp.defineProperty(this,"description",{configurable:!0,writable:!0,value:sa})};J.prototype.toString=function(){return this.$jscomp$symbol$id_};var V=0,ka=function(T){if(this instanceof ka)throw new TypeError("Symbol is not a constructor");return new J("jscomp_symbol_"+(T||"")+"_"+V++,T)};return ka},"es6","es3");
$jscomp.polyfill("Symbol.iterator",function(n){if(n)return n;n=Symbol("Symbol.iterator");for(var J="Array Int8Array Uint8Array Uint8ClampedArray Int16Array Uint16Array Int32Array Uint32Array Float32Array Float64Array".split(" "),V=0;V<J.length;V++){var ka=$jscomp.global[J[V]];"function"===typeof ka&&"function"!=typeof ka.prototype[n]&&$jscomp.defineProperty(ka.prototype,n,{configurable:!0,writable:!0,value:function(){return $jscomp.iteratorPrototype($jscomp.arrayIteratorImpl(this))}})}return n},"es6",
"es3");$jscomp.iteratorPrototype=function(n){n={next:n};n[Symbol.iterator]=function(){return this};return n};
$jscomp.polyfill("Promise",function(n){function J(){this.batch_=null}function V(Y){return Y instanceof T?Y:new T(function(oa,ba){oa(Y)})}if(n&&(!($jscomp.FORCE_POLYFILL_PROMISE||$jscomp.FORCE_POLYFILL_PROMISE_WHEN_NO_UNHANDLED_REJECTION&&"undefined"===typeof $jscomp.global.PromiseRejectionEvent)||!$jscomp.global.Promise||-1===$jscomp.global.Promise.toString().indexOf("[native code]")))return n;J.prototype.asyncExecute=function(Y){if(null==this.batch_){this.batch_=[];var oa=this;this.asyncExecuteFunction(function(){oa.executeBatch_()})}this.batch_.push(Y)};
var ka=$jscomp.global.setTimeout;J.prototype.asyncExecuteFunction=function(Y){ka(Y,0)};J.prototype.executeBatch_=function(){for(;this.batch_&&this.batch_.length;){var Y=this.batch_;this.batch_=[];for(var oa=0;oa<Y.length;++oa){var ba=Y[oa];Y[oa]=null;try{ba()}catch(ha){this.asyncThrow_(ha)}}}this.batch_=null};J.prototype.asyncThrow_=function(Y){this.asyncExecuteFunction(function(){throw Y;})};var T=function(Y){this.state_=0;this.result_=void 0;this.onSettledCallbacks_=[];this.isRejectionHandled_=
!1;var oa=this.createResolveAndReject_();try{Y(oa.resolve,oa.reject)}catch(ba){oa.reject(ba)}};T.prototype.createResolveAndReject_=function(){function Y(ha){return function(la){ba||(ba=!0,ha.call(oa,la))}}var oa=this,ba=!1;return{resolve:Y(this.resolveTo_),reject:Y(this.reject_)}};T.prototype.resolveTo_=function(Y){if(Y===this)this.reject_(new TypeError("A Promise cannot resolve to itself"));else if(Y instanceof T)this.settleSameAsPromise_(Y);else{a:switch(typeof Y){case "object":var oa=null!=Y;break a;
case "function":oa=!0;break a;default:oa=!1}oa?this.resolveToNonPromiseObj_(Y):this.fulfill_(Y)}};T.prototype.resolveToNonPromiseObj_=function(Y){var oa=void 0;try{oa=Y.then}catch(ba){this.reject_(ba);return}"function"==typeof oa?this.settleSameAsThenable_(oa,Y):this.fulfill_(Y)};T.prototype.reject_=function(Y){this.settle_(2,Y)};T.prototype.fulfill_=function(Y){this.settle_(1,Y)};T.prototype.settle_=function(Y,oa){if(0!=this.state_)throw Error("Cannot settle("+Y+", "+oa+"): Promise already settled in state"+
this.state_);this.state_=Y;this.result_=oa;2===this.state_&&this.scheduleUnhandledRejectionCheck_();this.executeOnSettledCallbacks_()};T.prototype.scheduleUnhandledRejectionCheck_=function(){var Y=this;ka(function(){if(Y.notifyUnhandledRejection_()){var oa=$jscomp.global.console;"undefined"!==typeof oa&&oa.error(Y.result_)}},1)};T.prototype.notifyUnhandledRejection_=function(){if(this.isRejectionHandled_)return!1;var Y=$jscomp.global.CustomEvent,oa=$jscomp.global.Event,ba=$jscomp.global.dispatchEvent;
if("undefined"===typeof ba)return!0;"function"===typeof Y?Y=new Y("unhandledrejection",{cancelable:!0}):"function"===typeof oa?Y=new oa("unhandledrejection",{cancelable:!0}):(Y=$jscomp.global.document.createEvent("CustomEvent"),Y.initCustomEvent("unhandledrejection",!1,!0,Y));Y.promise=this;Y.reason=this.result_;return ba(Y)};T.prototype.executeOnSettledCallbacks_=function(){if(null!=this.onSettledCallbacks_){for(var Y=0;Y<this.onSettledCallbacks_.length;++Y)sa.asyncExecute(this.onSettledCallbacks_[Y]);
this.onSettledCallbacks_=null}};var sa=new J;T.prototype.settleSameAsPromise_=function(Y){var oa=this.createResolveAndReject_();Y.callWhenSettled_(oa.resolve,oa.reject)};T.prototype.settleSameAsThenable_=function(Y,oa){var ba=this.createResolveAndReject_();try{Y.call(oa,ba.resolve,ba.reject)}catch(ha){ba.reject(ha)}};T.prototype.then=function(Y,oa){function ba(Oa,ra){return"function"==typeof Oa?function(rb){try{ha(Oa(rb))}catch(ob){la(ob)}}:ra}var ha,la,ya=new T(function(Oa,ra){ha=Oa;la=ra});this.callWhenSettled_(ba(Y,
ha),ba(oa,la));return ya};T.prototype.catch=function(Y){return this.then(void 0,Y)};T.prototype.callWhenSettled_=function(Y,oa){function ba(){switch(ha.state_){case 1:Y(ha.result_);break;case 2:oa(ha.result_);break;default:throw Error("Unexpected state: "+ha.state_);}}var ha=this;null==this.onSettledCallbacks_?sa.asyncExecute(ba):this.onSettledCallbacks_.push(ba);this.isRejectionHandled_=!0};T.resolve=V;T.reject=function(Y){return new T(function(oa,ba){ba(Y)})};T.race=function(Y){return new T(function(oa,
ba){for(var ha=$jscomp.makeIterator(Y),la=ha.next();!la.done;la=ha.next())V(la.value).callWhenSettled_(oa,ba)})};T.all=function(Y){var oa=$jscomp.makeIterator(Y),ba=oa.next();return ba.done?V([]):new T(function(ha,la){function ya(rb){return function(ob){Oa[rb]=ob;ra--;0==ra&&ha(Oa)}}var Oa=[],ra=0;do Oa.push(void 0),ra++,V(ba.value).callWhenSettled_(ya(Oa.length-1),la),ba=oa.next();while(!ba.done)})};return T},"es6","es3");
$jscomp.checkStringArgs=function(n,J,V){if(null==n)throw new TypeError("The 'this' value for String.prototype."+V+" must not be null or undefined");if(J instanceof RegExp)throw new TypeError("First argument to String.prototype."+V+" must not be a regular expression");return n+""};
$jscomp.polyfill("String.prototype.startsWith",function(n){return n?n:function(J,V){var ka=$jscomp.checkStringArgs(this,J,"startsWith");J+="";var T=ka.length,sa=J.length;V=Math.max(0,Math.min(V|0,ka.length));for(var Y=0;Y<sa&&V<T;)if(ka[V++]!=J[Y++])return!1;return Y>=sa}},"es6","es3");
$jscomp.iteratorFromArray=function(n,J){n instanceof String&&(n+="");var V=0,ka=!1,T={next:function(){if(!ka&&V<n.length){var sa=V++;return{value:J(sa,n[sa]),done:!1}}ka=!0;return{done:!0,value:void 0}}};T[Symbol.iterator]=function(){return T};return T};$jscomp.polyfill("Array.prototype.keys",function(n){return n?n:function(){return $jscomp.iteratorFromArray(this,function(J){return J})}},"es6","es3");
$jscomp.polyfill("Array.from",function(n){return n?n:function(J,V,ka){V=null!=V?V:function(oa){return oa};var T=[],sa="undefined"!=typeof Symbol&&Symbol.iterator&&J[Symbol.iterator];if("function"==typeof sa){J=sa.call(J);for(var Y=0;!(sa=J.next()).done;)T.push(V.call(ka,sa.value,Y++))}else for(sa=J.length,Y=0;Y<sa;Y++)T.push(V.call(ka,J[Y],Y));return T}},"es6","es3");
$jscomp.checkEs6ConformanceViaProxy=function(){try{var n={},J=Object.create(new $jscomp.global.Proxy(n,{get:function(V,ka,T){return V==n&&"q"==ka&&T==J}}));return!0===J.q}catch(V){return!1}};$jscomp.USE_PROXY_FOR_ES6_CONFORMANCE_CHECKS=!1;$jscomp.ES6_CONFORMANCE=$jscomp.USE_PROXY_FOR_ES6_CONFORMANCE_CHECKS&&$jscomp.checkEs6ConformanceViaProxy();$jscomp.owns=function(n,J){return Object.prototype.hasOwnProperty.call(n,J)};
$jscomp.polyfill("WeakMap",function(n){function J(){if(!n||!Object.seal)return!1;try{var ha=Object.seal({}),la=Object.seal({}),ya=new n([[ha,2],[la,3]]);if(2!=ya.get(ha)||3!=ya.get(la))return!1;ya.delete(ha);ya.set(la,4);return!ya.has(ha)&&4==ya.get(la)}catch(Oa){return!1}}function V(){}function ka(ha){var la=typeof ha;return"object"===la&&null!==ha||"function"===la}function T(ha){if(!$jscomp.owns(ha,Y)){var la=new V;$jscomp.defineProperty(ha,Y,{value:la})}}function sa(ha){if(!$jscomp.ISOLATE_POLYFILLS){var la=
Object[ha];la&&(Object[ha]=function(ya){if(ya instanceof V)return ya;Object.isExtensible(ya)&&T(ya);return la(ya)})}}if($jscomp.USE_PROXY_FOR_ES6_CONFORMANCE_CHECKS){if(n&&$jscomp.ES6_CONFORMANCE)return n}else if(J())return n;var Y="$jscomp_hidden_"+Math.random();sa("freeze");sa("preventExtensions");sa("seal");var oa=0,ba=function(ha){this.id_=(oa+=Math.random()+1).toString();if(ha){ha=$jscomp.makeIterator(ha);for(var la;!(la=ha.next()).done;)la=la.value,this.set(la[0],la[1])}};ba.prototype.set=function(ha,
la){if(!ka(ha))throw Error("Invalid WeakMap key");T(ha);if(!$jscomp.owns(ha,Y))throw Error("WeakMap key fail: "+ha);ha[Y][this.id_]=la;return this};ba.prototype.get=function(ha){return ka(ha)&&$jscomp.owns(ha,Y)?ha[Y][this.id_]:void 0};ba.prototype.has=function(ha){return ka(ha)&&$jscomp.owns(ha,Y)&&$jscomp.owns(ha[Y],this.id_)};ba.prototype.delete=function(ha){return ka(ha)&&$jscomp.owns(ha,Y)&&$jscomp.owns(ha[Y],this.id_)?delete ha[Y][this.id_]:!1};return ba},"es6","es3");$jscomp.MapEntry=function(){};
$jscomp.polyfill("Map",function(n){function J(){if($jscomp.ASSUME_NO_NATIVE_MAP||!n||"function"!=typeof n||!n.prototype.entries||"function"!=typeof Object.seal)return!1;try{var ba=Object.seal({x:4}),ha=new n($jscomp.makeIterator([[ba,"s"]]));if("s"!=ha.get(ba)||1!=ha.size||ha.get({x:4})||ha.set({x:4},"t")!=ha||2!=ha.size)return!1;var la=ha.entries(),ya=la.next();if(ya.done||ya.value[0]!=ba||"s"!=ya.value[1])return!1;ya=la.next();return ya.done||4!=ya.value[0].x||"t"!=ya.value[1]||!la.next().done?
!1:!0}catch(Oa){return!1}}if($jscomp.USE_PROXY_FOR_ES6_CONFORMANCE_CHECKS){if(n&&$jscomp.ES6_CONFORMANCE)return n}else if(J())return n;var V=new WeakMap,ka=function(ba){this.data_={};this.head_=Y();this.size=0;if(ba){ba=$jscomp.makeIterator(ba);for(var ha;!(ha=ba.next()).done;)ha=ha.value,this.set(ha[0],ha[1])}};ka.prototype.set=function(ba,ha){ba=0===ba?0:ba;var la=T(this,ba);la.list||(la.list=this.data_[la.id]=[]);la.entry?la.entry.value=ha:(la.entry={next:this.head_,previous:this.head_.previous,
head:this.head_,key:ba,value:ha},la.list.push(la.entry),this.head_.previous.next=la.entry,this.head_.previous=la.entry,this.size++);return this};ka.prototype.delete=function(ba){ba=T(this,ba);return ba.entry&&ba.list?(ba.list.splice(ba.index,1),ba.list.length||delete this.data_[ba.id],ba.entry.previous.next=ba.entry.next,ba.entry.next.previous=ba.entry.previous,ba.entry.head=null,this.size--,!0):!1};ka.prototype.clear=function(){this.data_={};this.head_=this.head_.previous=Y();this.size=0};ka.prototype.has=
function(ba){return!!T(this,ba).entry};ka.prototype.get=function(ba){return(ba=T(this,ba).entry)&&ba.value};ka.prototype.entries=function(){return sa(this,function(ba){return[ba.key,ba.value]})};ka.prototype.keys=function(){return sa(this,function(ba){return ba.key})};ka.prototype.values=function(){return sa(this,function(ba){return ba.value})};ka.prototype.forEach=function(ba,ha){for(var la=this.entries(),ya;!(ya=la.next()).done;)ya=ya.value,ba.call(ha,ya[1],ya[0],this)};ka.prototype[Symbol.iterator]=
ka.prototype.entries;var T=function(ba,ha){var la=ha&&typeof ha;"object"==la||"function"==la?V.has(ha)?la=V.get(ha):(la=""+ ++oa,V.set(ha,la)):la="p_"+ha;var ya=ba.data_[la];if(ya&&$jscomp.owns(ba.data_,la))for(ba=0;ba<ya.length;ba++){var Oa=ya[ba];if(ha!==ha&&Oa.key!==Oa.key||ha===Oa.key)return{id:la,list:ya,index:ba,entry:Oa}}return{id:la,list:ya,index:-1,entry:void 0}},sa=function(ba,ha){var la=ba.head_;return $jscomp.iteratorPrototype(function(){if(la){for(;la.head!=ba.head_;)la=la.previous;for(;la.next!=
la.head;)return la=la.next,{done:!1,value:ha(la)};la=null}return{done:!0,value:void 0}})},Y=function(){var ba={};return ba.previous=ba.next=ba.head=ba},oa=0;return ka},"es6","es3");$jscomp.findInternal=function(n,J,V){n instanceof String&&(n=String(n));for(var ka=n.length,T=0;T<ka;T++){var sa=n[T];if(J.call(V,sa,T,n))return{i:T,v:sa}}return{i:-1,v:void 0}};$jscomp.polyfill("Array.prototype.findIndex",function(n){return n?n:function(J,V){return $jscomp.findInternal(this,J,V).i}},"es6","es3");
var svManager={getInstance:function(){var n=window.$rdp;return n&&n.running&&n.running()?n:null}};svGlobal.getInstance=svManager.getInstance;
function connvertServer(n){var J={};J.id=n.id;J.server=n.id;J.displayName=n.displayName||n.id;if(n=n.rdp){for(var V in n)J[V]=n[V];J.user=n.username||"";J.pwd=n.password||"";J.useConsole=n.console||!1;J.legacyMode=n.leagacyMode||n.legacyMode||!1;J.server_bpp=n.color||16;J.exe=n.remoteProgram||"";J.args=n.remoteArgs||"";J.startProgram=0<J.exe.length?"app":J.command&&0<J.command.length?"shell":"noapp"}return J}
function Rdp2(n){n=svGlobal.util.getServerArgs(n);if(!n||!n.gateway)return hi5.notifications.notify({msg:__svi18n.noauth}),null;var J=n.gateway||"",V=0,ka=0,T=16,sa=1==n.useSSL||"true"==n.useSSL||"on"==n.useSSL||null;n.width&&(V=parseInt(n.width,10));n.height&&(ka=parseInt(n.height,10));n.color&&(T=parseInt(n.color,10));n.server_bpp&&(T=parseInt(n.server_bpp,10));n=hi5.browser.obj2url(n);null===sa&&(sa="https:"==location.protocol);return new Rdp((sa?"wss://":"ws://")+J+"/RDP?"+n,V,ka,T)}
svGlobal.Rdp2||(svGlobal.Rdp2=Rdp2);
function Rdp(n,J,V,ka){function T(a){return"on"==a||"true"==a||1==a}function sa(){var a=p.gateway;p.ongetgatewayaddress&&(a=p.ongetgatewayaddress(a));return a}function Y(){var a=hi5.storage.get("SV_CONN_SHARE_ID");a||(a=hi5.tool.uuid(),hi5.storage.set("SV_CONN_SHARE_ID",a));return a}function oa(a,b){a=ea[a]||b;a.startsWith("/")||a.toLowerCase().startsWith("http")||(a=hi5.libPath+a);return a}function ba(){return N.displayName||N.server||N.symlink||N.id||"undefined"}function ha(a){p.loadbalanceToken||
(p.loadbalanceToken=ea.loadbalanceTokenName?ea.loadbalanceTokenName+"="+a:"")}function la(a,b,c){p.ontitlechange&&(a=p.ontitlechange(a,c));p.setTitle&&a&&(b=b||window,b.document.title=a)}function ya(a,b){switch(a){case 16:case 8:case 24:case 32:break;case 15:return N.invitation||p.showMessage("15 bit color is not supported anymore."),!1;default:return!1}gb=a;b&&(La?La.postMessage({type:0,cmd:1,data:a}):Ba&&Ba.setColor(a));return!0}function Oa(a,b,c,e){Ia=a;Ja=b;Wb=Xb=0;Yb=Ia-1;Zb=Ja-1;Va&&(Ia=(N.waWidth||
hi5.browser.getScreenWidth())|0,Ja=(N.waHeight||hi5.browser.getScreenHeight())|0);N.minWidth&&Ia<N.minWidth&&(Ia=N.minWidth|0);N.minHeight&&Ja<N.minHeight&&(Ja=N.minHeight|0);Ia&=-4;Ja&=-4;svGlobal.logger.warn("resolution changed, w:"+Ia+" h:"+Ja);var d=Ia,g=Ja;na?na.resize(d,g):na=new xc(d,g);da.setSize(Ia,Ja,Va?"hidden":null);if(c||Ia!=a||Ja!=b)La?La.postMessage({type:0,cmd:2,data:{w:Ia,h:Ja}}):Ba&&Ba.setResolution(Ia,Ja);if(p.onresolutionchange&&!e)p.onresolutionchange(a,b)}function ra(a){!cb&&
Ha&&(La?($b.data=a,"string"!=typeof a?La.postMessage($b,[a]):La.postMessage($b)):Ba.writeRawInput(a))}function rb(a){switch(a){case "\r":break;case "\n":p.writeScancode(28);break;case "\t":p.writeScancode(15);break;default:ra("86"+a)}}function ob(a){var b=this;a||(a=143);this.send=function(c){var e=!!c.buffer,d=e?c:c.getData(),g=64==a;c=e?d.length:c.getEnd()||d.length;c<d.length&&(d=e?d.subarray(0,c):d.slice(0,c));e=g?5:9;c=new Uint8Array(e+c);c[0]=a;if(g)c[1]=b.id,c[2]=b.id>>8,c[3]=b.id>>16,c[4]=
b.id>>24;else{g=b.name;for(var m=Math.min(g.length,8),G=0;G<m;G++)c[1+G]=g.charCodeAt(G)}c.set(d,e);ra(c.buffer)};this.name="";this.count=this.id=this.flags=0}function Fb(a){if(p){var b=__svi18n.errorCode[a];a={name:a,message:b,msg:b};p.displayMsg&&p.showMessage(a);0<svGlobal.log&&console.error&&console.error(a);if(p.onerror)p.onerror(a)}}function yc(a){if(p){var b=__svi18n.info[a];b||(b="info "+a);p.displayMsg&&p.showMessage(b);svGlobal.logger.info(b)}}function ac(){var a=Ha;pb=Ha=!1;La?La.postMessage({type:0,
cmd:3}):Ba&&Ba.resetStatus();a&&(Ha=a)}function bc(a){Ma||(Ma=new hi5.file.UploadManager(new hi5.file.WsFileService(ra)),Ma.addEvent("beforeupload",function(b,c,e){if(p.beforeupload)return p.beforeupload(b,c,e)}),Ma.addEvent("fileuploaded",function(b,c,e){if(p.onfileuploaded)p.onfileuploaded(b,c,e)}),Ma.addEvent("uploaded",function(b,c){if(p.onuploaded)p.onuploaded(b,c)}),Ma.addEvent("uploadingCancelled",function(){if(p.onuploadingCancelled)p.onuploadingCancelled()}));a.setFileHandler(Ma)}function zc(a,
b,c){var e=!1;this.exe=a;this.args=b||"";this._dir=c||"";var d=this;this.close=function(){!e&&Ha&&(e=!0,ra("8C5"+d.exe+"\t"+d.args+"\t"+p.sessionInfo.appInfo.session))}}function td(){var a=window.opener;if(a)try{if(a.__sparkUser&&a.__sparkUser.session)return a.__sparkUser;if(a.opener&&a.opener.__sparkUser.session)return a.opener.__sparkUser}catch(b){}return null}function Ac(){var a;return void 0!==(null==(a=window)?void 0:a.PublicKeyCredential)&&"function"===typeof window.PublicKeyCredential}function Gb(a){a=
(new Uint8Array(a)).buffer;return CBOR.decode(a)}function ud(a,b,c){var e={};if(b&&b.attachment)switch(b.attachment){case 1:var d="platform";break;case 2:d="cross-platform"}d&&(e.authenticatorAttachment=d);d={};b&&(b.requireResident?b.requireResident&&(d.requireResidentKey=!0,d.residentKey="required"):b.preferResident&&b.preferResident&&(d.requireResidentKey=!0,d.residentKey="preferred"));c&&c.rk&&(c.rk?(d.requireResidentKey=!0,d.residentKey="required"):(d.requireResidentKey=!1,d.residentKey=void 0));
d&&(d.requireResidentKey&&(e.requireResidentKey=d.requireResidentKey),d.residentKey&&(e.residentKey=d.residentKey));if(a=Bc(a,b,c))e.userVerification=a;if(Object.keys(e).length)return e}function Cc(a){var b=[];if(a){a=$jscomp.makeIterator(a);for(var c=a.next();!c.done;c=a.next()){var e=c.value;c={};e.id&&(c.id=e.id);e.type&&(c.type=e.type);if(e.transports){var d=c;e=e.transports;var g=[];e&1?g.push("usb"):e&2?g.push("nfc"):e&4?g.push("ble"):e&16?g.push("internal"):e&32&&g.push("hybrid");d.transports=
g}b.push(c)}}return b}function Bc(a,b,c){var e;a&&(a&4194304?e="required":a&8388608?e="preferred":a&16777216&&(e="discouraged"));if(b&&b.userVerification)switch(b.userVerification){case 1:e="required";break;case 2:e="preferred";break;case 3:e="discouraged"}c&&c.uv&&("FALSE"==c.uv.toUpperCase()?e="discouraged":"TRUE"==c.uv.toUpperCase()&&(e="required"));return e}function vd(a){var b={};if(a&&a.attestationPreference)switch(a.attestationPreference){case 0:b.attestation="direct";break;case 1:b.attestation=
"direct";break;case 2:b.attestation="indirect";break;case 3:b.attestation="direct"}if(a&&a.enterpriseAttestation)switch(a.enterpriseAttestation){case 1:b.attestation="enterprise";break;case 2:b.attestation="enterprise"}b.attestationFormats=["packed"];return b}function wd(a,b){var c,e,d,g,m,G,z,D,H,u,x,O,q,y,B,t,L,R,U,w;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Q){if(1==Q.nextAddress){c=a.getPublicKeyAlgorithm();console.log("==== publicKeyAlgorithms = "+c);if((e=a.getTransports())&&
0<e.length)for(var Z=$jscomp.makeIterator(e),M=Z.next();!M.done;M=Z.next())M=M.value,"USB"==M.toUpperCase()||"NFC"==M.toUpperCase()||"BLE"==M.toUpperCase()||"INTERNAL"==M.toUpperCase()||M.toUpperCase();if(d=a.attestationObject)console.log("==== attestationObj bytes: "+sb(new Uint8Array(d))),m=Gb(d),g=m.attStmt;if(G=a.clientDataJSON)console.log("==== clientDataJson bytes: "+sb(new Uint8Array(G))),z=window.origin,D=(new TextDecoder).decode(G),H=JSON.parse(D),H.origin&&(H.origin=z);u=a.getAuthenticatorData();
if(!u)return Q.jumpTo(0);x=new Uint8Array(u);console.log("==== authenticatorData bytes: "+sb(x));return b?(O=b.id)?Q.yield(xd(O),5):Q.jumpTo(0):Q.jumpTo(0)}q=Q.yieldResult;y=new Uint8Array(q);console.log("==== hash of realRpID: "+sb(y));B=new hi5.DataBuffer(new Uint8Array(x.byteLength));B.setBytes(y);t=x.slice?x.slice(32,x.length):x.subarray(32,x.length);B.setBytes(t);B.markEnd();L=B.getData();console.log("==== newAuthDataBytes: "+sb(new Uint8Array(L)));R={1:"packed",2:L,3:g};U=CBOR.encode(R);w=new hi5.DataBuffer(new Uint8Array(U.byteLength+
1));w.setByte(0);w.setBytes(U);w.markEnd();return Q.return(w.getData())})}function xd(a){var b;return $jscomp.asyncExecutePromiseGeneratorProgram(function(c){b=(new TextEncoder).encode(a);return c.return(yd(b))})}function yd(a){var b;return $jscomp.asyncExecutePromiseGeneratorProgram(function(c){if(1==c.nextAddress)return c.yield(crypto.subtle.digest("SHA-256",a),2);b=c.yieldResult;return c.return(b)})}function sb(a){return Array.from(a,function(b){return("0"+(b&255).toString(16)).slice(-2)}).join(", ")}
function zd(){var a=0,b=0,c=new p.GatewayChannel;c.name="MESSGSTB";c.onopen=function(){svGlobal.logger.info("Message Channel open")};c.process=function(e){if(0==e.getByte())e.getByte(),e.getByte(),e.getByte();else{var d=e.getByte(),g=e.getLittleEndian16(),m=e.getLittleEndian16();if(0!=d)svGlobal.logger.warn("Invalid AUTODETECT_REQUEST");else switch(m){case 1:case 4097:m=new RdpBuffer(new Uint8Array(6),0,6);m.setByte(6);m.setByte(1);m.setLittleEndian16(g);m.setLittleEndian16(0);m.markEnd();c.send(m);
break;case 20:case 276:case 4116:a=6;b=Date.now();break;case 2:g=e.getLittleEndian16();a+=g;break;case 43:case 1065:case 1577:43==m&&(d=e.getLittleEndian16(),a=a+d+8,e.skipPosition(d));e=e.has(4)?e.getLittleEndian32():0;a+=e;e=Date.now()-b;d=new RdpBuffer(new Uint8Array(14),0,14);d.setByte(14);d.setByte(1);d.setLittleEndian16(g);d.setLittleEndian16(43==m?3:11);d.setLittleEndian32(e);d.setLittleEndian32(a);d.markEnd();c.send(d);break;case 2112:case 2176:case 2240:g=e.getLittleEndian32();m=e.getLittleEndian32();
e=e.getLittleEndian32();Hb={baseRTT:g,bandwidth:m,averageRTT:e};if(p.onnetworkresult)p.onnetworkresult(Hb);svGlobal.logger.warn("Network Characteristics Result:");svGlobal.logger.warn(Hb);break;default:svGlobal.logger.warn("Invalid network detect PDU",e)}}};c.onclose=function(){svGlobal.logger.info("MSG channel close")};p.addGatewayChannel(c)}function Ad(a,b,c,e,d){cc.set(a,b);dc.set(a,e);b="<b>User:&nbsp;</b>"+c+"&nbsp;("+e+")&nbsp;&nbsp;&nbsp;&nbsp;<b>Expire Date:</b> "+d;c=document.createElement("div");
e=document.createElement("input");e.type="radio";e.name="scard_name";e.value=a;0==a&&(e.defaultChecked=!0);c.appendChild(e);c.innerHTML+=b;c.innerHTML+="<br>";return c}function Bd(a,b){var c=document.createElement("div"),e=document.createElement("input");e.type="radio";e.name="ds_name";e.value=a;0==a&&(e.defaultChecked=!0);c.appendChild(e);c.innerHTML+=b;c.innerHTML+="<br>";return c}function Dc(){var a="";N&&T(N.connectif)&&N.symlink&&"sessionStorage"in window&&(a="SV_"+N.symlink,N.domain&&(a+=N.domain),
N.user&&(a+=N.user));return a}function Cd(){var a=hi5.appcfg.persistentId?window.localStorage:window.sessionStorage;if(!a)return"";var b=a.getItem("appInfo.session");if(!b)return"";b="&_session="+b;(a=a.getItem("appInfo.numericId"))&&(b+="&_numericId="+a);return b}function ec(){if(!Ha){pb=!1;var a="";cb?Ea.init(!1,!0,!1,0,!1,!1):a=p.getRuntimeURL();void 0==ea.wsPost&&(ea.wsPost=!1);p.oncreatewebsocket&&(La=null);La?(cb&&(cb.onopen=fc,cb.onclose=zb,cb.onmessage=function(c){gc.data=c.data;La.postMessage(gc,
[gc.data])}),La.postMessage({type:0,cmd:0,data:{addr:a,width:Ia,height:Ja,server_bpp:gb,libPath:hi5.libPath,libMin:hi5.libMin,wsPost:ea.wsPost}})):(Ba=new RdpGeneral(cb||a,Ia,Ja,gb,na,!1,ea.wsPost),Ba.oncreatewebsocket=p.oncreatewebsocket,Ba.run());La?La.addEventListener("message",Ec,!1):(Ba.onopen=fc,Ba.onmessage=Fc,Ba.onclose=zb,Ba.onerror=Fb,Ba.oninfo=yc,Ba.onloggedin=hc,Ba.onresolutionchange=function(c,e){Oa(c,e,!1,N.monitorDef&&0<=N.monitor?!0:!1)},Ba.onAltSecWindows=Gc,Ba.onMoveCursor=ic,Ba.onCloseSurface=
Hc,Ba.onColorChange=ya,Ba.onHistoryReceived=function(){jc()},Ba.onLockKeyState=function(c){if(p.onLockKeyState)p.onLockKeyState(c)});if(a=da.getSurface(da.size()-1))Va?a&&(a.remoteApp=new zc(N.exe,N.args,"")):la(ba(),a.getWindow());if(N.invitation&&!T(N.shadow)){var b=null;a&&(b=a.initChat(N.expert));Ab=new p.GatewayChannel;Ab.name="C_H_A_T";Ab.process=function(c){c=c.getUnicodeString(c.getEnd()-c.getPosition(),!0);b&&b.add(c,N.novice)};b&&(b.onchat=function(c){if(Ha){var e=Array(2*c.length);e=new hi5.DataBuffer(e,
0,e.length);e.setUnicodeString(c);e.markEnd();Ab.send(e)}});p.addGatewayChannel(Ab)}}}function Ec(a){a=a.data;switch(a.type){case 1:switch(a.event){case 0:fc();break;case 1:zb(a.expected);break;case 2:Fb(a.code);break;case 3:yc(a.code);break;case 4:hc();break;case 5:Oa(a.w,a.h,!1,N.monitorDef&&0<=N.monitor?!0:!1);break;case 6:ic(a.x,a.y,!0);break;case 7:Hc();break;case 8:0==a.id&&jc();Pa&&Pa.check(1<a.id?15555:0);break;case 9:ya(a.color);break;case 10:if(p.onLockKeyState)p.onLockKeyState(a.state);
break;default:svGlobal.logger.warn("Invalid worker event "+a.type)}break;case 2:na.setRGBs(a.x,a.y,a.w,a.h,a.pixel,a.offset,a.scansize);break;case 3:na.moveArea(a.srcx,a.srcy,a.cx,a.cy,a.dx,a.dy);break;case 5:na.fillRect(a.l,a.t,a.w,a.h,a.color);break;case 6:na.drawLine(a.x1,a.y1,a.x2,a.y2,a.color);break;case 7:na.bitBlt(a.opcode,a.dstwidth,a.x,a.y,a.cx,a.cy,a.src,a.srcwidth,a.srcx,a.srcy);break;case 8:na.drawLineExt(a.x1,a.y1,a.x2,a.y2,a.color,a.opcode);break;case 9:Ic(a);break;case 10:Fc(a);break;
case 11:Ua.attach(a.data,0,a.data.length);Gc(Ua,a.size);break;case 12:na.drawText(a.font,a.flags,a.mixmode,a.foregroundColor,a.backgroundColor,a.clipLeft,a.clipTop,a.clipcx,a.clipcy,a.boxLeft,a.boxTop,a.boxcx,a.boxcy,a.x,a.y,a.length,a.text,a._left,a._top,a._right,a._bottom);break;case 13:na.drawBitmap(a.cacheID,a.cacheIDX,a.x,a.y,a.cx,a.cy,a.srcx,a.srcy,a.opcode);break;case 14:na.saveDesktop(a.x,a.y,a.cx,a.cy,a.offset);break;case 15:na.restoreDesktop(a.x,a.y,a.cx,a.cy,a.offset);break;case 16:na.putFont(a.font,
a.character,a.glyph);break;case 17:na.putCursor(a.idx,a.cursor);break;case 18:na.setCursor(a.idx);break;case 19:na.getHistory(ra,function(){La.postMessage({type:0,cmd:7})});Pa&&Pa.check(15555);break;case 20:Ua.attach(a.data,a.off,a.data.length-a.off);na.setHistory(a.order,Ua);break;case 21:na.putBitmap(a.id,a.idx,a.bitmap);break;default:svGlobal.logger.warn("Invalid worker msg "+a.type)}}function Jc(a){Pa&&Pa.check(a)}function fc(){Ha=!0;var a="87"+navigator.userAgent+"\t";Ib=hi5.tool.uuid();document.cookie=
Ib+"=sv";ra(a+Ib);if(p.onopen)p.onopen();ea.joinCloseMode&&p.setJoinCloseMode(ea.joinCloseMode)}function Hc(){da&&da.close()}function Fc(a){var b=a.data;if("string"!=typeof b){a=new Uint8Array(b);Ua.attach(a,0,b.byteLength);var c=Ua.getLittleEndian16();switch(c){case 28:a=Ua;b=a.getAscllString(8);c=jb[b];null!=c?c.process(a):svGlobal.logger.warn("Channel "+b+" not found");break;case 55:a=Ua;switch(a.getByte()){case 0:Da.tag=a.getLittleEndian16();Da.channels=a.getLittleEndian16();Da.samplePerSec=a.getLittleEndian32();
a.skipPosition(6);Da.bitsPerSample=a.getLittleEndian16();svGlobal.logger.info("Audio Format, tag="+Da.tag+" channels="+Da.channels+" bitsPerSample="+Da.bitsPerSample+" samplePerSec="+Da.samplePerSec);La&&La.postMessage({type:0,cmd:5,data:{tag:Da.tag,channels:Da.channels,samplePerSec:Da.samplePerSec,bitsPerSample:Da.bitsPerSample}});41222==Da.tag&&(Da.sampleRate=Da.samplePerSec,Ta.initMediaPlayer(Ta,Da,!1));break;case 1:b=a.getByte();c=a.getLittleEndian16();var e=Date.now();a.skipPosition(8);kc(a,
b,c,0);kb||(c+=Date.now()-e,ra("8A"+b+","+c))}Pa&&Pa.check();break;case 56:Kc(Ua.getUnicodeString(Ua.getEnd()-Ua.getPosition(),!1));break;case 60:Lc(Ua);break;case 62:Mc(Ua.getUnicodeString(Ua.getEnd()-Ua.getPosition(),!1));break;case 63:Nc(Ua);Pa&&Pa.check();break;case 64:b=Ua;c=b.getByte();a=b.getLittleEndian32();switch(c){case 1:b=b.getAscllString();if(Ea[b]){if(svGlobal.logger.info("DVC create, name:"+b+" id:"+a),Ea[b].newInstance?(Ea[a]=Ea[b].newInstance(),Ea[a].id=a):(Ea[b].id=a,Ea[a]=Ea[b]),
Ea[a].onopen)Ea[a].onopen()}else svGlobal.logger.info("DVC create, name not found:"+b+" id:"+a);break;case 3:Ea[a]&&Ea[a].process(b);break;case 4:if(Ea[a]&&Ea[a].onclose)Ea[a].onclose();svGlobal.logger.info("close DVC, id:"+a)}Pa&&Pa.check();break;case 146:Dd(Ua);break;default:if(p.onunknownmessage)p.onunknownmessage(c,Ua);else svGlobal.logger.warn("@TODO:"+c+"\n")}}else switch(c=parseInt(b.substring(0,2),16),a=b.substring(2),c){case 0:ra("87"+navigator.userAgent);break;case 15:if(p){lc=!1;tb=p.reconnectTimes;
(p&&0==p.mode||T(N.connectif))&&jc();b="";for(b in lb)if((c=lb[b])&&c.onopen)c.onopen();for(b in jb)if((c=jb[b])&&c.onopen)c.onopen();a&&(a=JSON.parse(a),a.capability&&p&&(p.sessionInfo.suppressOutput=!!a.capability.suppressOutput))}break;case 26:b=JSON.parse(a);if(b.name){isNaN(b.name)||(b.name="S"+b.name);b.message||(b.message=b.msg);if(p.onnotify)p.onnotify(b);svGlobal.logger.info("msg="+a);if(2==b.type&&p.onerror)p.onerror(b);if(a=__svi18n.errorCode[b.name])b.msg=a+" "+b.msg;p.showMessage(b)}else 0<
svGlobal.log&&console.erro("No error code for message:"+a);break;case 27:da.drawLicense(a);break;case 50:if(Ha)switch(b=parseInt(a.substring(0,1),10),a=a.substring(1),b){case 1:Ed(a);break;case 2:Bb?(Bb.type==a?p.writeRawInput("881"+a+"\t"+Bb.text):p.writeRawInput("881ERROR\t"),Bb=null):!(b=da.getFocused())||b.processClipReq(a)||!ea.clipWarnAlways&&Oc||!N||N.leagacyMode||(p.showMessage(__svi18n.info.menucopy,null,5E3),Oc=!0);break;case 5:(b=da.getFocused())&&"0"!=a&&b.setIgnorePaste(!0)}break;case 51:da.setReadOnly("1"==
a);break;case 54:b=a.split("\t");a=sa()+b[0];a=p.modifyURL(a);svGlobal.logger.info("Downloading file:"+a+" name:"+b[1]+" driver:"+b[2]);p.onprintingready&&p.onprintingready({link:a,printerName:b[1],pinterDriver:b[2]})||(b=da.getFocused())&&b.showPDF(a);break;case 56:Kc(a);break;case 57:b=a.split("\t");svGlobal.logger.debug(a);if(a=da.getWinById(parseInt(b[0]))){if(!da.hasApp(b[1])){(c=da.getOwnerSurface(a))&&c.railWin&&(c.railWin.appId=b[1],c.railWin.addApp(b[1]));if(p.onremoteappstart)p.onremoteappstart({id:b[1]});
if(a.isVisible()&&a.titleInfo&&p.ontitlechange)p.ontitlechange(c.railWin.getFullTitle(a.id),b[1])}a.appId=b[1]}break;case 58:Fd(a);break;case 59:a=hi5.Base64.dec(a,0);db=(new RdpBuffer(a,0,a.length)).getLittleEndian32();kb||!(db&16||db&65536)?(Jb=!1,Ma=null):(db&16&&(Jb=!0),Ma||(a=da.getFocused())&&bc(a));db&64&&p.showMessage(__svi18n.info.recording);Ma&&(Ma.setUpload(!(db&128)),Ma.setDownload(!(db&131072)),Ma.canCopyFile=0!=(db&65536));da.execute("setFeature",[db]);break;case 60:Lc(b64ToBuffer(a));
break;case 61:a=JSON.parse(a);switch(a.type){case 0:Oa(a.width,a.height,!0,!1);ya(a.color);(b=a.server)&&p&&(p.server=a.server);Pc=a.length;c=da.getFocused();Va=1==a.isRail;c&&(1!=p.mode&&c.setAutoScale(!Va),b&&la(ba(),c.getWindow()),b=a.keyboard,"undefined"!=typeof b&&0==b&&c.setUnicode(!0),b=a.mapDisk)&&(Jb=!0,bc(c));if(p.onopened)p.onopened(a);break;case 1:a=a.duration;if(p.onprogress)p.onprogress(a,Pc);break;case 2:2==a.status?(ac(),Ha=!0):(b=0==a.status,b==na.isPaused()||p.onsessionpause&&p.onsessionpause(b,
a)||(na.pause(b),b||da.repaint(0,0,na.width-1,na.height-1),a.warn&&p.showMessage(b?__svi18n.info.sessionPaused:__svi18n.info.sessionResumed)))}break;case 62:Mc(a);break;case 63:Nc(b64ToBuffer(a));break;default:if(p.onunknownmessage)p.onunknownmessage(c,a);else svGlobal.logger.warn("@TODO:"+b+"\n")}}function jc(){if(!kb&&!Wa&&(Wa=!0,p&&(ea.pingInterval&&p.startPing(ea.pingInterval),p.onready)))p.onready()}function Dd(a){var b=a.getByte();switch(b){case 0:a=new Uint8Array(2);a[0]=146;a[1]=1;ra(a.buffer);
break;case 1:break;case 5:b=a.getByte();a=a.getLittleEndian32();0!=b||a&4||(db^=65536,da.execute("setFeature",[db]));break;case 6:Qa.remoteLockFlags=a.getLittleEndian32();Qa.checkLockFlags=!0;if(p.onLockKeyState)p.onLockKeyState({capsLock:0!=(Qa.remoteLockFlags&4),numLock:0!=(Qa.remoteLockFlags&2),scrollLock:0!=(Qa.remoteLockFlags&1)},{capsLock:0!=(Qa.localLockFlags&4),numLock:0!=(Qa.localLockFlags&2),scrollLock:0!=(Qa.localLockFlags&1)});svGlobal.logger.info("remoteLockFlags: "+Qa.remoteLockFlags);
break;case 7:b=a.getByte();p.sessionInfo.appInfo.twoFAEnabled=0<b;switch(b){case 0:b=a.getByte();var c=a.getLittleEndian32();a=a.getBytes(c);p.sessionInfo.appInfo.twoFAQR=a;p.ontwofaqr&&p.ontwofaqr(a)||2==b&&da.execute("showTwoFAQR");break;case 1:na.pause(!0,!0);if(p.ontwofacode&&p.ontwofacode())return;(a=da.getFocused())&&a.showTwoFACode();break;case 2:if(b=a.getByte(),a=1==a.getByte(),(!p.ontwofaresult||!p.ontwofaresult(b,a))&&Qa.onauthcoderesult)Qa.onauthcoderesult(b,a)}break;case 8:b=a.getByte();
if(a=da.getFocused()){c="image/png";switch(b){case 1:c="image/jpeg";break;case 2:c="image/webp"}a.getSnapshot(function(e){e.bytes().then(function(d){var g=new Uint8Array(2+d.length);g[0]=146;g[1]=8;g.set(d,2);ra(g.buffer)})},c)}break;default:svGlobal.logger.warn("Invalid Client Control: "+b)}}function Gd(a,b){var c=0,e=!1;this.width=a;this.interval=b;var d=0;this.start=function(){e||(e=!0,c=setInterval(function(){var g=da.getFocused();g&&Ha&&(g=g.getThumbnail(a))&&g.length!=d&&(ra("8E7"+g),d=g.length)},
b))};this.stop=function(){clearInterval(c)}}function Hd(a,b){!Ya||Ya.width==a&&Ya.interval==b||(Ya.stop(),Ya=null);Ya||(Ya=new Gd(a,b));Ya.start()}function Nc(a){var b=a.getAscllString(8);(b=lb[b])&&b.process&&b.process(a)}function Mc(a){var b=parseInt(a.substring(0,1),16),c=a.substring(1);a=!1;var e=p.sessionInfo.appInfo;switch(b){case 0:var d=JSON.parse(c);ac();Ha=!0;a=d.width;e=d.height;if(a==Ia&&e==Ja)break;Oa(a,e,!1,!1);break;case 1:d=JSON.parse(c);p.sessionInfo.joinedSessions.push(d.numericId);
p.sessionInfo.joiners.push(d);e.sessions[d.numericId]=d.name||d.__ip;if(!e.joined||ea.alertJoin)p.onsessionjoin&&(a=p.onsessionjoin(d)),!a&&__svi18n.info.joinsession&&p.showMessage(__svi18n.info.joinsession.applyArgs([d.numericId,d.__ip,d.name]));break;case 2:d=JSON.parse(c);p.sessionInfo.joinedSessions.removeElm(d.numericId);delete e.sessions[d.numericId];b=p.sessionInfo.joiners;c=0;for(var g=b.length;c<g;c++)if(b[c].numericId==d.numericId){b.splice(c,1);break}if(!e.joined||ea.alertJoin)p.onsessionexit&&
(a=p.onsessionexit(d)),!a&&__svi18n.info.exitsession&&p.showMessage(__svi18n.info.exitsession.applyArgs([d.numericId,d.__ip,d.name]));break;case 3:d=JSON.parse(c);e.joinMode!=d.mode&&(e.joinMode=d.mode,b=hi5.$("joinSelect"))&&(b.value=d.mode);if(e.hasControl)break;e.hasControl=!0;da.setReadOnly(!1,2==d.mode);if(e=hi5.$("requestControl"))e.disabled=!0;p.ongivecontrol&&(a=p.ongivecontrol());if(a)break;p.showMessage(__svi18n.info.givecontrol,null,5E3);break;case 4:d=JSON.parse(c);da.setReadOnly(!0,2==
d.mode);e.hasControl=!1;if(e=hi5.$("requestControl"))e.disabled=!1;p.ontakebackcontrol&&(a=p.ontakebackcontrol());if(a)break;p.showMessage(__svi18n.info.nocontrol,null,5E3);break;case 5:d=JSON.parse(c);p.onrequirecontrol&&(a=p.onrequirecontrol(d));if(a)break;a=__svi18n.info.title.applyArgs([d.name,d.numericId,d.__ip]);e=__svi18n.info.recontrol;na.isPaused&&(e+="<br><br>"+(__svi18n.info.autoresume||""));p.showMessage({title:a,msg:e,cbYes:function(){p.giveControl(d.numericId);this.destroy();na.isPaused()&&
p.pauseSession(p.sessionInfo.appInfo.numericId,!1)},cbNo:function(){p.refuseControl(d.numericId);this.destroy()},html:!0});break;case 6:da.execute("setTouchRemoting",[!0]);break;case 7:d=JSON.parse(c);d.width&&d.height&&Oa(d.width,d.height,!0,N.monitorDef&&0<=N.monitor?!0:!1);d.color&&(ya(d.color,!0),svGlobal.logger.warn("Color depth changed to:"+d.color));d.version&&(p.sessionInfo.protocolVersion=d.version);break;case 8:d=JSON.parse(c);lc=!0;if(p.onrequestcredential&&p.onrequestcredential(d,Qa.reconnect))break;
if(p.onautherror&&p.onautherror(d,Qa.reconnect))break;da.getFocused().requestCredential(d,Qa.reconnect);break;case 9:d=JSON.parse(c);0<d.interval&&0<d.width?Hd(d.width,d.interval):Ya&&(Ya.stop(),Ya=null);break;case 11:d=JSON.parse(c);p.onrequirejoin&&(a=p.onrequirejoin(d));if(a)break;a=__svi18n.info.title.applyArgs([d.name,d.numericId,d.__ip]);p.showMessage({title:a,msg:__svi18n.info.reqjoin,cbYes:function(){p.allowJoin(d.numericId,!0);this.destroy()},cbNo:function(){p.allowJoin(d.numericId,!1);this.destroy()}});
break;case 13:d=JSON.parse(c);"login"==d.type&&hc();break;case 14:if(d=JSON.parse(c),p.oncontrolchange)p.oncontrolchange(d)}}function Lc(a){switch(a.getByte()){case 32:if(!na.isPaused()){var b=a.getLittleEndian16(),c=a.getLittleEndian16(),e=a.getLittleEndian16(),d=void 0,g=void 0;ea.noCursorName||(d=a.getLittleEndian32(),p.sessionInfo.appInfo&&(g=p.sessionInfo.appInfo.sessions[d]));ic(c,e,!0,g,d,b)}}}function ic(a,b,c,e,d,g){na.isPaused()||da.getFocused().moveCursor(a,b,c,e,d,g)}function Ic(a){da.setCursor(a)}
function Id(a){var b=ea.page&&ea.page.join||"";if(b.startsWith("http://")||b.startsWith("https://"))return b;if(b.startsWith("/"))return location.origin+b;var c=location.href,e=c.lastIndexOf("/");if(b)return c.substring(0,e+1)+b;b=sa();c.toLowerCase().startsWith(b.toLowerCase())&&(b=c.substring(0,e));return b+"/"+a}function Kc(a){a=JSON.parse(a);mc=a.session;var b=a.numericId,c=hi5.appcfg.persistentId?window.localStorage:window.sessionStorage;c&&(c.setItem("appInfo.session",mc),c.setItem("appInfo.numericId",
b));ha(a.appId);a.server||(a.server=ba());if(b=hi5.$("joinSelect"))b.value=a.joinMode;if(b=hi5.$("requestControl"))b.disabled=a.hasControl;a.joined?1!=p.mode&&da.execute("setAutoScale",[!0]):(p.mode=0,T(N.connectif)&&da.setSize(Ia,Ja),ea.disableJoinedAppResize&&(p.windowState=0));var e=sa();b=Id("join.html")+"?id="+(a.joined||a.numericId);(c=a.webAddress)&&0<c.length&&c.toLowerCase()!=e.toLowerCase()&&(e=c.indexOf("://"),p.protocol="http"==c.substring(0,e)?"ws":"wss",p.gateway=c,b+="&gateway="+encodeURIComponent(c));
b=p.modifyURL(b);a.joinLink=b;p.sessionInfo.appInfo=a;"isApp"in a&&Va!==a.isApp&&(Va=a.isApp,Oa(Ia,Ja,!0,!0),pb||1==p.mode||da.execute("setAutoScale",[!0]));a.ver&&a.ver!=svGlobal.version&&svGlobal.logger.warn("Client:"+svGlobal.version+" server:"+a.ver);ea.cursorNameOnly=a.isAssistance;if(p.onsessionstart)p.onsessionstart(p.sessionInfo)}function Fd(a){if(Ma){var b=parseInt(a.charAt(0),10);a=a.substring(1);if(5==b)Ma.notifyFiles(JSON.parse(a));else{var c=a.split("\t");switch(b){case 1:Ma.confirmId(c[0],
c[1],c[2]);break;case 2:Ma.read(c[0],parseInt(c[1],10),parseInt(c[2],10));break;case 4:Ma.close(c[0]);break;case 9:a='<a href="'+p.modifyURL(sa()+c[0])+'" download="'+c[1]+'" target="_blank">'+__svi18n.info.fileReady+": "+c[1]+"</a>",__svi18n.info.download&&da.getFocused().showMessage({msg:a,html:!0,title:__svi18n.info.download,cbNo:function(){Ma.removeFile(c[0],!0);this.destroy()},onclick:function(e){"A"==e.target.tagName&&this.destroy()}})}}}}function kc(a,b,c,e){if(!Jd||na.isPaused())return 0;
var d=a.getPosition();b=a.getData();e||(e=a.getEnd()-d);if(41222==Da.tag)return Ta.onaudioframe(b.slice(d)),0;if(a=1!=Da.tag)nc||(nc=new MSGSM),b=nc.decode(b,d,e),d=0,e=b.length;var g=Da.bitsPerSample;var m=Math.floor(e/(g>>3));var G=c=e=0;a||(e=Math.pow(2,g-1)-1,c=-e-1,G=Math.pow(2,g));g=Da.channels;var z=Math.floor(m/g),D=Ta.getBuffer(z),H=D.getChannelData(0),u=D.getChannelData(1);m=0;if(a)for(;m<z;)1==g?u[m]=H[m]=b[d++]:(H[m]=b[d++],u[m]=b[d++]),m++;else for(;m<z;)a=b[d++]|b[d++]<<8,a>e?(a-=G,
a/=-c):a/=e,1==g?H[m]=a:(H[m]=a,a=b[d++]|b[d++]<<8,a>e?(a-=G,a/=-c):a/=e),u[m]=a,m++;return Ta.playBuffer(D)}function Qc(a){if(!p.openLink||2E3<a.length)return!1;var b=a.indexOf(";");0<b&&(a=a.substring(b+1));b=a;a=a.toLowerCase();var c=0==a.indexOf("http://")||0==a.indexOf("https://")||0==a.indexOf("ftp://")||0==a.indexOf("mailto:")||0==a.indexOf("tel:")||0==a.indexOf("callto:");c||(0==a.indexOf("www.")?(c=!0,a="http://"+a):0==a.indexOf("ftp.")&&(c=!0,a="ftp://"+a));return c?0<a.indexOf("\r")||0<
a.indexOf("\n")?!1:p.onurlredirection&&p.onurlredirection(b)?!0:(a=da.getFocused())?a.processLink(b):!1:!1}function Kd(a){if(a.startsWith("text/html;<img data-sv-img")){var b=a.indexOf('src="');if(0<b){b+=5;var c=a.indexOf('"',b),e=a.substring(b,c);e=p.modifyURL(e);a=a.substring(0,b)+e+a.substring(c)}}return a}function Ed(a){if("text/plain;"!=a){if(1666<Date.now()-Qa.reqCopyTime&&!(p.onservercopy&&p.onservercopy(a)||Qc(a))){var b=da.getFocused();b&&b.copyToClip(Kd(a))}setTimeout(function(){ra("883")},
999)}}function hc(a){if(!pb&&(setTimeout(function(){Ha&&ra("884")},333),p.onloggedin))p.onloggedin();oc=pb=!0;a&&a.sessionId&&(p.sessionInfo.sessionId=a.sessionId);Va&&1!=p.mode&&da.execute("setAutoScale",[!1]);Ma&&(Ma.enabled=!0);Kb&&!Va&&(na.setContext(da.getFocused().context),da.repaint(0,0,na.width-1,na.height-1))}function zb(a){if(p){hi5.browser.cookie.delete(Ib);svGlobal.logger.warn("closed "+(p.sessionInfo.appInfo?p.sessionInfo.appInfo.numericId:0));p.onagentmessage&&(p.onagentmessage=null);
if(p.onagentclose)p.onagentclose();var b=Dc();b&&p.sessionInfo.appInfo&&0==p.mode&&(sessionStorage[b]=p.sessionInfo.appInfo.session);if(p&&(b=1!=p.mode,!Ha&&b&&Fb("connection"),b=b&&(Ha||tb<p.reconnectTimes)&&0<tb&&!a,Wa=Ha=!1,b)){tb--;__svi18n.info.reconnecting&&p.showMessage(__svi18n.info.reconnecting+" "+(p.reconnectTimes-tb)+"/"+p.reconnectTimes,null,3E3);setTimeout(ec,ea.reconnectInterval||5E3);svGlobal.logger.info("Reconnecting..."+tb);return}if(lc)svGlobal.logger.info("Req credential");else{Pa&&
(p.stopPing(),Pa=null);La&&(La.removeEventListener("message",Ec,!1),La.postMessage({type:0,cmd:4}),La.terminate(),La=null);Ma&&(Ma.release(),Ma=null);Ra=n=null;Ea&&(Ea.close(),Ea=null);lb&&hi5.Arrays.release(lb);jb&&hi5.Arrays.release(jb);Ya&&(Ya.stop(),Ya=null);Ta&&(Ta.close(),Ta=null);p.player&&(p.player=null);Cb=null;try{if(p.onclose)p.onclose(a);else if(svGlobal.logger.info("onclose: null"),hi5.appcfg&&hi5.appcfg.returnUrl){window.location.href=hi5.appcfg.returnUrl;return}da&&(da.close(),da=null)}catch(c){svGlobal.logger.warn(c)}Ua=
null;Ba&&(Ba.onopen=null,Ba.onmessage=null,Ba.onclose=null,Ba.onerror=null,Ba.close(),Ba=null);da=Qa=null;na&&(na.release(),na=null);hi5.browser.isChromeApp?chrome.runtime.onSuspend.removeListener(p.close):window.removeEventListener("unload",p.close,!1);window&&window.$rdp==p&&(window.$rdp=null);p=null}}}function Rc(){Ba&&Ha?Ba.close():zb(!0)}function Gc(a,b){var c=a.getLittleEndian32();if(0!=(c&16777216))if(b=a.getLittleEndian32(),0!=(c&1073741824)){a.getLittleEndian16();a.getByte();c=a.getByte();
var e=a.getLittleEndian16(),d=a.getLittleEndian16(),g=0;16>c&&(g=a.getLittleEndian16());var m=a.getLittleEndian16(),G=a.getLittleEndian16();a.getBytes(m);g&&a.getBytes(g);if(8<=c&&(g=da.getFocused())&&g.onremoteappicon){m=new hi5.graphic.Bitmap(e,d,32);a.getPosition();e=new Uint8Array(e*d*4);d=a.getPosition();G=d+G;var z;a=a.getData();for(var D=0,H,u;d<G;)switch(c){case 16:(z=a[d++]|a[d++]<<8)?(u=z>>7&248,H=z>>2&248,z=z<<3&248,u|=u>>5,H|=H>>5,z|=z>>5,e[D++]=z,e[D++]=H,e[D++]=u,e[D++]=255):D+=4;break;
case 32:e[D++]=a[d++],e[D++]=a[d++],e[D++]=a[d++],e[D++]=a[d++]}m.putPixels(e,0,e.length);a=da.getWinById(b);g.onremoteappicon(a,m)}}else 0!=(c&2147483648)?svGlobal.logger.info("XXX rail cache icon, winId="+b):0!=(c&536870912)?(svGlobal.logger.info("***** delete winId="+b),da.delWin(b)):Ld(a,c,b);else if(0!=(c&33554432))svGlobal.logger.info("XXX Alt Sec window Notify="+c);else if(0!=(c&67108864))if(svGlobal.logger.info("*** -- Alt Sec window Desktop, flags:"+c),0!=(c&1))svGlobal.logger.info("Desktop non monitored flags="+
c);else{if(0!=(c&32)&&(b=a.getLittleEndian32(),svGlobal.logger.info("Desktop monitored flags="+c+" winId="+b),0<b&&((g=da.getOwnerSurfaceById(b))&&g.railWin&&g.railWin.setActiveWinId(b,3==ea.windowState),da.setTitle(b),na.getContext()||(b=da.getFocused())&&na.setContext(b.context))),0!=(c&16)&&(b=a.getByte(),0<b))for(c=da.zOrders,c.length=b,g=0;g<b;g++)c[g]=a.getLittleEndian32(),svGlobal.logger.info("---zorders:"+c[g])}else svGlobal.logger.info("XXX Alt Sec window order flgas="+c)}function Sc(a){var b=
da.getFocused();if(b&&b.railWin){var c=a||b.railWin.mainWin;if(c&&2<c.showState){var e=b.getFreeSpace();a=Math.max(Math.abs(c.winHeight-e.height),Math.abs(c.winWidth-e.width));svGlobal.logger.info("--- fitMainWin offset:"+a+" _hOffset:"+c._hOffset+" appId:"+c.appId+" spaceH:"+e.height);0<a?(b=a==c._hOffset,c._hOffset&&b||(c._hOffset=a,setTimeout(function(){c.resize(0,0,e.width,e.height)},333))):c._hOffset=0}}}function Ld(a,b,c){Va||(Va=!0);var e=0==(b&268435456),d=da.getWinById(c);d?e=!0:d=new da.LocalWin(c);
svGlobal.logger.info("\n\n=========== winId="+c+" existed="+e);if(d){0!=(b&2)&&(d.ownerWinid=a.getLittleEndian32(),svGlobal.logger.info("***** ownerWinid="+d.ownerWinid));0!=(b&8)&&(d.style=a.getLittleEndian32(),d.extStyle=a.getLittleEndian32(),svGlobal.logger.info("***** winId="+c+" style="+d.style+" extStyle="+d.extStyle),svGlobal.logger.info("*****--- WS_POPUP="+(0!=(d.style&2147483648))),svGlobal.logger.info("*****--- WS_DLGFRAME="+(0!=(d.style&4194304))),svGlobal.logger.info("*****--- DS_MODALFRAME="+
(0!=(d.style&128))),svGlobal.logger.info("*****--- WS_EX_DLGMODALFRAME="+(0!=(d.extStyle&1))),svGlobal.logger.info("*****--- WS_EX_TOOLWINDOW="+(0!=(d.extStyle&128))),svGlobal.logger.info("*****--- WS_BORDER="+(0!=(d.style&8388608))),svGlobal.logger.info("*****--- WS_CAPTION="+(0!=(d.style&12582912))),svGlobal.logger.info("*****--- WS_OVERLAPPED="+(0!=(d.style&0))),svGlobal.logger.info("*****--- WS_OVERLAPPEDWINDOW="+(0!=(d.style&13565952))),svGlobal.logger.info("*****--- WS_POPUPWINDOW="+(0!=(d.style&
2156396544))),svGlobal.logger.info("*****--- WS_SIZEBOX="+(0!=(d.style&262144))),svGlobal.logger.info("*****--- WS_CHILD="+(0!=(d.style&1073741824))),svGlobal.logger.info("*****--- WS_SIZEBOX="+(0!=(d.style&262144))),svGlobal.logger.info("*****--- WS_EX_MDICHILD="+(0!=(d.extStyle&64))),svGlobal.logger.info("*****--- WS_EX_LAYERED="+(0!=(d.extStyle&524288))));if(0!=(b&16)){d.setShowState(a.getByte());svGlobal.logger.info("***** winId="+c+" showState="+d.showState);var g=d.showState;(2==g&&0!=ea.noMinimize||
!e&&3==g&&5==ea.windowState)&&setTimeout(function(){d.exeCommand(61728)},50)}if(g=0!=(b&4)){var m=a.getLittleEndian16();d.titleInfo=a.getUnicodeString(m,!1);svGlobal.logger.info("***** winId="+c+" title="+d.titleInfo)}0!=(b&16384)&&(d.clientOffsetX=a.getLittleEndian32(),d.clientOffsetY=a.getLittleEndian32(),svGlobal.logger.info("***** winId="+c+" coffX"+d.clientOffsetX+" coffY="+d.clientOffsetY));0!=(b&65536)&&(d.clientAreaWidth=a.getLittleEndian32(),d.clientAreaHeight=a.getLittleEndian32(),svGlobal.logger.info("***** winId="+
c+" cw"+d.clientAreaWidth+" ch="+d.clientAreaHeight));0!=(b&131072)&&(d.rpContent=a.getLittleEndian32());0!=(b&262144)&&(d.rootParentHandle=a.getLittleEndian32());if(0!=(b&2048)){m=a.getLittleEndian32();var G=a.getLittleEndian32();d.winOffsetX=m;d.winOffsetY=G;svGlobal.logger.info("***** winId="+c+" offX"+d.winOffsetX+" offY="+d.winOffsetY)}0!=(b&32768)&&(d.winClientDeltaX=a.getLittleEndian32(),d.winClientDeltaY=a.getLittleEndian32(),svGlobal.logger.info("***** winId="+c+" dX"+d.winClientDeltaX+" dY="+
d.winClientDeltaY));0!=(b&1024)&&(d.winWidth=a.getLittleEndian32(),d.winHeight=a.getLittleEndian32(),svGlobal.logger.info("***** winId="+c+" w"+d.winWidth+" h="+d.winHeight));if(!e)if(d.isMainWin())3==p.windowState?Sc(d):setTimeout(function(){d.activate(1)},666);else if(2<d.showState&&(m=da.getFocused())){m=m.getFreeSpace();var z=d.winWidth,D=d.winHeight;if(d.winOffsetX>m.width||d.winOffsetY>m.height||0>z+d.winOffsetX||0>D+d.winOffsetY){var H=(m.width-d.winWidth)/2|0,u=(m.height-d.winHeight)/2|0;
0>H&&(H=0);0>u&&(u=0);setTimeout(function(){d.resize(H,u,z,D)},50)}}0!=(b&256)&&(m=a.getLittleEndian16(),0<m&&a.skipPosition(8*m));0!=(b&4096)&&(d.visibleOffsetX=a.getLittleEndian32(),d.visibleOffsetY=a.getLittleEndian32());0!=(b&512)&&(b=a.getLittleEndian16(),d.numVisibilityRects=b,0<b&&a.skipPosition(8*b));if(e)da.onWinChange(d);else da.addWin(d);g&&da.setTitle(c);c==da.zOrders[0]?svGlobal.logger.info("zzz zorders win: "+c):svGlobal.logger.info("zzz win: "+c,da.zOrders)}else svGlobal.logger.warn("XXX, No win with id:"+
c)}function xc(a,b){function c(f,k,h,r,v){0<v.width?v.union(f,k,h,r):(v.x=f,v.y=k,v.width=h,v.height=r)}function e(f,k,h,r){for(aa=0;aa<ja;aa++){var v=Z[aa];if(f>=v[0]&&k>=v[1]&&h<=v[2]&&r<=v[3])return M[aa]}return null}function d(f,k,h,r){if(ja){var v=e(f,k,f+h-1,k+r-1);v&&c(f,k,h,r,v)}else c(f,k,h,r,y)}function g(f,k,h,r,v,A,I){for(var C=v*h+r,F=f.setRGB,W=f.getRGB,E=0;E<I;E++){for(var l=0;l<A;l++){if(f){var K=W(r+l,v+E);F(r+l,v+E,~K&16777215)}else k[C]=~k[C]&16777215;C++}C+=h-A}}function m(f,k,
h,r,v,A,I,C,F,W){k=W*C+F;null==I&&(I=f);for(f=0;f<A;f++){for(F=0;F<v;F++)O[r+f][h+F]=O[r+f][h+F]&I[k]&16777215|4278190080,k++;k+=C-v}}function G(f,k,h,r,v,A,I,C,F,W){k=W*C+F;F=f.setRGB;W=f.getRGB;null==I&&(I=f);for(f=0;f<A;f++){for(var E=0;E<v;E++){var l=W(h+E,r+f);F(h+E,r+f,l|I[k]&16777215);k++}k+=C-v}}function z(f,k,h,r){var v=X;if(v){var A=v.getRGB(k,h);switch(f){case 0:v.setRGB(k,h,0);break;case 1:v.setRGB(k,h,~(A|r)&16777215);break;case 2:v.setRGB(k,h,A&~r&16777215);break;case 3:v.setRGB(k,h,
~r&16777215);break;case 4:v.setRGB(k,h,16777215*(~A&r));break;case 5:v.setRGB(k,h,~A&16777215);break;case 6:v.setRGB(k,h,A^r&16777215);break;case 7:v.setRGB(k,h,~A&r&16777215);break;case 8:v.setRGB(k,h,A&r&16777215);break;case 9:v.setRGB(k,h,A^~r&16777215);break;case 10:break;case 11:v.setRGB(k,h,A|~r&16777215);break;case 12:v.setRGB(k,h,r);break;case 13:v.setRGB(k,h,(~A|r)&16777215);break;case 14:v.setRGB(k,h,A|r&16777215);break;case 15:v.setRGB(k,h,16777215);break;default:svGlobal.logger.warn("unsupported pixel opcode: "+
f),v.setRGB(k,h,r)}}}function D(f,k,h,r,v,A,I,C,F){f>C||k>F||(h=f+h-1,h>C&&(h=C),f<A&&(f=A),h=h-f+1,r=k+r-1,r>F&&(r=F),k<I&&(k=I),r=r-k+1,1>h||1>r||X.fillRect(f,k,h,r,v))}function H(f,k,h,r,v,A,I,C,F,W,E,l){if(!(k>E||h>l)){var K=k+r-1;K>E&&(K=E);F=k<F?F:k;K=K-k+1;E=h+v-1;E>l&&(E=l);W=h<W?W:h;l=E-h+1;if(!(1>K||1>l)){E=128;var P=0;I|=4278190080;C|=4278190080;if(F==k&&W==h&&K==r&&l==v)if(0==f)for(var S=0;S<v;S++){f=h+S;for(var ca=0;ca<r;ca++)0==E&&(P++,E=128),0!=(A[P]&E)&&(O[f][k+ca]=C),E>>=1;P++;E=
128;P==A.length&&(P=0)}else for(S=0;S<v;S++){f=h+S;for(ca=0;ca<r;ca++)0==E&&(P++,E=128),O[f][k+ca]=0!=(A[P]&E)?C:I,E>>=1;P++;E=128;P==A.length&&(P=0)}else if(0==f)for(S=0;S<l;S++){f=h+S;for(ca=0;ca<K;ca++)0==E&&(P++,E=128),k+ca>=F&&f>=W&&0!=(A[P]&E)&&(O[f][k+ca]=C),E>>=1;P++;E=128;P==A.length&&(P=0)}else for(S=0;S<l;S++){f=h+S;for(ca=0;ca<K;ca++)0==E&&(P++,E=128),k+ca>=F&&h+S>=W&&(O[f][k+ca]=0!=(A[P]&E)?C:I),E>>=1;P++;E=128;P==A.length&&(P=0)}}}}function u(f,k,h,r,v){this.offset=f;this.baseLine=k;
this.width=h;this.height=r;this.fontData=v}function x(f,k,h,r,v,A,I,C,F){this.cache_idx=f;this.rawData=k;this.none=!k;this.hotX=h;this.hotY=r;this.width=v;this.height=A;this.xorSize=C;this.andSize=F;this.result="";this.distance=0;this.bpp=I;this.system="";if(k){if(!this.distance){f=0;if(k){I=0;for(var W=k.length;I<W;I++)0!=k[I]&&(f+=I%v+(I/v|0))}this.distance=f}if(!this.system){a:switch(this.distance){case 507:f="text";break a;case 2046:case 4359:f="default";break a;default:f=""}this.system=f}}f=
"";if(!this.system&&k){I=v*A*4;f=62+I+C+F;W=new Uint8Array(f);f=new hi5.DataBuffer(W,0,f);f.setLittleEndian16(0);f.setLittleEndian16(2);f.setLittleEndian16(1);f.setByte(v);f.setByte(A);f.setByte(0);f.setByte(0);f.setLittleEndian16(h);f.setLittleEndian16(r);f.setLittleEndian32(40+I+C+F);f.setLittleEndian32(22);f.setLittleEndian32(40);f.setLittleEndian32(v);f.setLittleEndian32(2*A);f.setLittleEndian16(1);f.setLittleEndian16(32);f.setLittleEndian32(0);f.setLittleEndian32(C+F);f.setLittleEndian32(0);
f.setLittleEndian32(0);f.setLittleEndian32(0);f.setLittleEndian32(0);for(h=A-1;0<=h;h--)for(r=0;r<v;r++)A=k[v*h+r],f.setByte(A&255),f.setByte(A>>8&255),f.setByte(A>>16&255),f.setByte(A>>24&255);f="data:image/x-icon;base64,"+hi5.Base64.enc(f.getData())}this.url=f}var O=[],q=null,y=new hi5.graphic.Rectangle(0,0,0,0),B="Uint8ClampedArray"in window,t=null,L=0,R=0,U=0,w=0,Q=null,Z,M,aa=0,ja=0;this.width=a;this.height=b;var pa=!1,X=this,va={imgData:null,left:0,top:0,width:0,height:0};this.setProfiler=function(f){t=
f};this.getDirtyArea=function(){return y};this.setImgRect=function(f,k,h,r){L=f;R=k;U=h;w=r};this.parseMonitorDef=function(f){var k=f.split(","),h=k.length,r=[];if(1<h){for(var v=!1,A=0;A<h;A++){var I=k[A].split(":");if(4==I.length)r[A]=Array(5),r[A][0]=parseInt(I[0]),r[A][1]=parseInt(I[1]),r[A][2]=parseInt(I[2]),r[A][3]=parseInt(I[3]),r[A][4]=0==r[A][0]&&0==r[A][1]?1:0;else{v=!0;break}}v&&(svGlobal.logger.warn("invaiid monitorDef:"+f),r.length=0)}return r};this.setMonitorLayout=function(f){var k=
f.length,h=0;Z=f;for(M=Array(k);h<k;h++)M[h]=new hi5.graphic.Rectangle(0,0,0,0);ja=k};this.setMonitorCount=function(f){ja=f};this.addImg=function(f){U&&(Q&&URL.revokeObjectURL(Q.src),Q=f)};this.flushImgs=function(){Q&&(URL.revokeObjectURL(Q.src),Q=null,U=0)};this.getData=function(){return O};this.pause=function(f,k){pa=f;k&&q&&q.fillRect(0,0,a,b)};this.release=function(){y=null;hi5.Arrays.release(M);X.flushImgs();O=q=X=null;va=va.imgData=null};this.isPaused=function(){return pa};this.setContext=function(f){f!=
q&&(q||!f||f.createImageData(1,1).data.buffer||(B=!1),q=f,null!=q&&(va.imgData=q.createImageData(a,b)))};this.getContext=function(){return q};this.resize=function(f,k){if(O.length!=k||O[0].length!=f){for(var h=0;h<k;h++)O[h]=new Uint32Array(f);O.length=k;X.width=a=f;X.height=b=k;null!=q&&(va.imgData=q.createImageData(a,b))}};X.resize(a,b);this.getBuffer=function(){return O};this.setRGB=function(f,k,h){O[k][f]=h|4278190080};this.getRGB=function(f,k){return O[k][f]};this.setRGBs=function(f,k,h,r,v,
A,I){var C=f+h,F=k+r;F>b&&(F=b);if(!(f>=a)){C>a&&(h-=C-a);for(C=k;C<F;C++,A+=I)O[C].set(v.subarray(A,A+h),f);d(f,k,h,r)}};this.moveArea=function(f,k,h,r,v,A){if(0<A){var I=f+v,C=k+A,F;for(F=r-1;0<=F;F--)O[C+F].set(O[k+F].subarray(f,f+h),I)}else if(0>A)for(I=f+v,C=k+A,F=0;F<r;F++)O[C+F].set(O[k+F].subarray(f,f+h),I);else if(0<v){I=f+v;C=k+A;var W;for(F=h-1;0<=F;F--){var E=I+F;var l=f+F;for(W=0;W<r;W++)O[C+W][E]=O[k+W][l]}}else for(I=f+v,C=k+A,F=0;F<h;F++)for(E=I+F,l=f+F,W=0;W<r;W++)O[C+W][E]=O[k+W][l];
d(f+v,k+A,h,r)};this.getRGBs=function(f,k,h,r,v){var A=new Uint32Array(h*r),I=f+h;r=k+r;for(var C=0;k<r;k++)A.set(O[k].subarray(f,I),C),C+=h;return v?(v(A),null):A};this.repaint=function(f,k,h,r){var v=va.imgData.data,A=0,I,C;t&&t.begin("paint");0>f&&(h+=f,f=0);0>k&&(r+=k,k=0);f+h>a&&(h=a-f);k+r>b&&(r=b-k);var F=f+h;var W=k+r;if(B)for(v=new Uint32Array(v.buffer),C=k;C<W;C++)v.set(O[C].subarray(f,F),A),A+=a;else{var E=4*(a-h)|0;for(C=k;C<W;C++){for(I=f;I<F;I++){var l=O[C][I];v[A++]=l&255;v[A++]=l>>
8&255;v[A++]=l>>16&255;v[A++]=255}A+=E}}va.left=f;va.top=k;va.width=h;va.height=r;t&&t.end("paint");return va};this.postPaint=d;this.draw=function(f,k,h,r){if(!pa&&q)if(Q&&Q.complete&&(q.drawImage(Q,L,R,U,w),URL.revokeObjectURL(Q.src),Q=null),ja){if(f=e(f,k,h,r),f.width)return X.repaint(f.x,f.y,f.width,f.height),f.width=0,va}else if(y.width)return X.repaint(y.x,y.y,y.width,y.height),y.width=0,va;return null};this.fillRect=function(f,k,h,r,v){var A=f+h,I=k+r;if(O[0].fill)for(var C,F=k;F<I;F++)O[F].fill(v,
f,A);else for(F=k;F<I;F++)for(C=f;C<A;C++)O[F][C]=v;d(f,k,h,r)};this.drawLine=function(f,k,h,r,v){if(k==r){if(f>h){var A=f;f=h;h=A}var I=O[k];h++;if(I.fill)I.fill(v,f,h);else for(A=f;A<h;A++)I[A]=v}else if(f==h)for(k>r&&(A=k,k=r,r=A),r++,A=k;A<r;A++)O[A][f]=v;else{var C=Math.abs(h-f),F=Math.abs(r-k);A=f;I=k;h=h>=f?f=1:f=-1;k=r>=k?r=1:r=-1;if(C>=F){k=f=0;var W=C;var E=C/2|0;var l=F}else r=h=0,W=F,E=F/2|0,l=C,C=F;if(!(1>C))for(C++,F=0;F<C;F++)O[I][A]=v,E+=l,E>=W&&(E-=W,A+=f,I+=r),A+=h,I+=k}};this.bitBlt=
function(f,k,h,r,v,A,I,C,F,W){var E=X;switch(f){case 0:C=E.setRGB;for(E=h;E<h+v;E++)for(F=r;F<r+A;F++)C(E,F,0);break;case 1:f=I;F=W*C+F;W=E.setRGB;k=E.getRGB;null==f&&(f=E);for(E=0;E<A;E++){for(I=0;I<v;I++)W(h+v,r+A,~(k(h+v,r+A)|f[F])&16777215);F+=C-v}break;case 2:f=I;F=W*C+F;W=E.setRGB;k=E.getRGB;null==f&&(f=E);for(E=0;E<A;E++){for(I=0;I<v;I++){var l=k(h+v,r+A);W(h+v,r+A,l&~f[F]&16777215);F++}F+=C-v}break;case 3:g(E,I,C,F,W,v,A);I?E.setRGBs(h,r,v,A,I,W*C+F,C):E.moveArea(F,W,v,A,h-F,r-W);break;case 4:g(E,
null,k,h,r,v,A);m(E,k,h,r,v,A,I,C,F,W);break;case 5:g(E,null,k,h,r,v,A);break;case 6:f=I;F=W*C+F;null==f&&(f=E);for(E=0;E<A;E++){for(W=0;W<v;W++)O[r+E][h+W]=O[r+E][h+W]^f[F]&16777215|4278190080,F++;F+=C-v}break;case 7:f=I;F=W*C+F;W=E.setRGB;k=E.getRGB;null==f&&(f=E);for(E=0;E<A;E++){for(I=0;I<v;I++)l=k(h+I,r+E),W(h+I,r+E,~(l&f[F])&16777215),F++;F+=C-v}break;case 8:m(E,k,h,r,v,A,I,C,F,W);break;case 9:f=I;F=W*C+F;W=E.setRGB;k=E.getRGB;null==f&&(f=E);for(E=0;E<A;E++){for(I=0;I<v;I++)l=k(h+I,r+E),W(h+
I,r+E,l^~f[F]&16777215),F++;F+=C-v}break;case 10:break;case 11:f=I;F=W*C+F;W=E.setRGB;k=E.getRGB;null==f&&(f=E);for(E=0;E<A;E++){for(I=0;I<v;I++)l=k(h+I,r+E),W(h+I,r+E,l|~f[F]&16777215),F++;F+=C-v}break;case 12:I?E.setRGBs(h,r,v,A,I,W*C+F,C):E.moveArea(F,W,v,A,h-F,r-W);break;case 13:g(E,null,k,h,r,v,A);G(E,k,h,r,v,A,I,C,F,W);break;case 14:G(E,k,h,r,v,A,I,C,F,W);break;case 15:C=E.setRGB;for(E=h;E<h+v;E++)for(F=r;F<r+A;F++)C(E,F,16777215);break;default:svGlobal.logger.warn("unsupported opcode: "+f)}d(h,
r,v,A)};this.drawLineExt=function(f,k,h,r,v,A){if(f==h||k==r){var I;if(k==r)if(h>f){var C=h-f;if(!(1>C))for(I=0;I<C;I++)z(A,f+I,k,v)}else{if(C=f-h,!(1>C))for(I=0;I<C;I++)z(A,h+I,k,v)}else if(r>k){if(C=r-k,!(1>C))for(I=0;I<C;I++)z(A,f,k+I,v)}else if(C=k-r,!(1>C))for(I=0;I<C;I++)z(A,f,r+I,v)}else{var F=Math.abs(h-f),W=Math.abs(r-k);I=f;C=k;var E,l;var K=h>=f?E=1:E=-1;var P=r>=k?l=1:l=-1;if(F>=W){P=E=0;var S=F;var ca=F/2>>0;var ma=W}else l=K=0,S=W,ca=W/2>>0,ma=F,F=W;if(1>F)return;for(W=0;W<=F;W++)z(A,
I,C,v),ca+=ma,ca>=S&&(ca-=S,I+=E,C+=l),I+=K,C+=P}v=Math.min(f,h);f=Math.max(f,h);h=Math.min(k,r);k=Math.max(k,r);0>f-v||0>k-h||d(v,h,f-v+1,k-h+1)};this.drawText=function(f,k,h,r,v,A,I,C,F,W,E,l,K,P,S,ca,ma,za,Ga,Ca,Fa){var Aa=0;1<l?D(W,E,l,K,v,za,Ga,Ca,Fa):1==h&&D(A,I,C,F,v,za,Ga,Ca,Fa);for(var Sa=ca,ta=0;ta<ca;)switch(ma[Aa+ta]){case 255:var wa=ma[Aa+ta+2];if(wa>Sa-Aa){ta=ca=0;break}wa=ma.slice?ma.slice(Aa,Aa+wa):ma.subarray(Aa,Aa+wa);ia[ma[Aa+ta+1]]=wa;ta+=3;ca-=ta;Aa=ta;ta=0;break;case 254:var Na=
(wa=ia[ma[Aa+ta+1]])?wa:null;Na&&0==Na[1]&&0==(k&32)&&(0!=(k&4)?S+=ma[Aa+ta+2]:P+=ma[Aa+ta+2]);ta=ta+2<ca?ta+3:ta+2;ca-=ta;Aa=ta;ta=0;if(!Na)break;for(var Xa=Na.length,Za=0;Za<Xa;Za++){wa=qa.getFont(f,Na[Za]);if(0==(k&32)){var $a=Na[++Za];0!=($a&128)?(0!=(k&4)?S+=Na[Za+1]|Na[Za+2]<<8:P+=Na[Za+1]|Na[Za+2]<<8,Za+=2):0!=(k&4)?S+=$a:P+=$a}wa&&(H(h,P+wa.offset&65535,S+wa.baseLine&65535,wa.width,wa.height,wa.fontData,v,r,za,Ga,Ca,Fa),0!=(k&32)&&(P+=wa.width))}break;default:wa=qa.getFont(f,ma[Aa+ta]),0==
(k&32)&&($a=ma[Aa+ ++ta],0!=($a&128)?(0!=(k&4)?S+=ma[Aa+ta+1]|ma[Aa+ta+2]<<8:P+=ma[Aa+ta+1]|ma[Aa+ta+2]<<8,ta+=2):0!=(k&4)?S+=$a:P+=$a),wa&&(H(h,P+wa.offset&65535,S+wa.baseLine&65535,wa.width,wa.height,wa.fontData,v,r,za,Ga,Ca,Fa),0!=(k&32)&&(P+=wa.width)),ta++}1<l?0<K&&d(W,E,l,K):0<C&&0<F&&d(A,I,C,F)};this.drawBitmap=function(f,k,h,r,v,A,I,C,F){var W=Ka.getBitmap(f,k);W?(f=W.width,k=W.height,v>f&&(v=f),A>k&&(A=k),12==F?X.setRGBs(h,r,v,A,W.data,C*f+I,f):X.bitBlt(F,a,h,r,v,A,W.data,f,I,C)):svGlobal.logger.warn("Failed to get bitmap from cache, id:"+
f+" idx="+k)};this.saveDesktop=function(f,k,h,r,v){X.getRGBs(f,k,h,r,function(A){fa.save(f,k,h,r,v,A)})};this.restoreDesktop=function(f,k,h,r,v){(v=fa.restore(f,k,h,r,v))?X.setRGBs(f,k,h,r,v,0,h):svGlobal.logger.warn("XXX no matched desktop save.")};this.putFont=function(f,k,h){qa.putFont(f,k,h)};this.putBitmap=function(f,k,h){Ka.putBitmap(f,k,h)};this.putCursor=function(f,k){ua.set(f,k)};this.setCursor=function(f){if(!pa&&-1!=f){var k=ua.get(f);if(k)X.onSetCursor(k);else svGlobal.logger.warn("invalid cursor"+
f)}};var xa=0;this.isSendingHistory=function(){return 2E3>Date.now()-xa};this.getHistory=function(f,k){var h=null;(h=ua.toPDU())&&f(h.buffer);if(X.onGetGfxHistory)X.onGetGfxHistory(f,k);else{t&&t.begin("his_bitmap");Ka.forEach(function(C,F,W){if(C){var E=0,l=0;W=0;for(var K=C.length;W<K;W++)C[W]&&C[W].data&&(E++,l+=C[W].raw?C[W].raw.length:4*C[W].data.length);if(E&&l){h=new Uint8Array(l+20*E+8);h[0]=29;h[2]=1;h[3]=4;l=new hi5.DataBuffer(h,4,h.length);l.setLittleEndian32(E);for(W=0;W<K;W++)(E=C[W])&&
E.data&&(l.setLittleEndian16(F),l.setLittleEndian16(W),l.setLittleEndian16(E.left),l.setLittleEndian16(E.top),l.setLittleEndian16(E.width),l.setLittleEndian16(E.height),l.setLittleEndian16(E.bitsperpixel),l.setLittleEndian16(E.codec),l.setLittleEndian32(E.raw?E.raw.length:4*E.data.length),l.setBytes(E.raw||new Uint8Array(E.data.buffer)));f(h.buffer)}}});t&&t.end("his_bitmap");t&&t.begin("his_font");(h=qa.toPDU())&&f(h.buffer);t&&t.end("his_font");for(var r=4,v=0,A=ia.length;v<A;v++)ia[v]&&(r+=ia[v].length+
6);if(4<r){h=new Uint8Array(r);h[0]=29;h[2]=1;h[3]=7;var I=4;v=0;for(A=ia.length;v<A;v++)ia[v]&&ia[v].length&&(h[I++]=v,h[I++]=v>>8,r=ia[v].length,h[I++]=r,h[I++]=r>>8,h[I++]=r>>16,h[I++]=r>>24,h.set(ia[v],I),I+=r);f(h.buffer)}(h=fa.toPDU())&&f(h.buffer);k();xa=Date.now()}};this.onHistoryDone=function(){X.onGetGfxHistory&&p.reconnect(a,b,!0)};this.setHistory=function(f,k){svGlobal.logger.info("setHistory type:"+f);switch(f){case 4:t&&t.begin("his_bitmap_dec");var h=k.getLittleEndian32();for(f=0;f<
h;f++){var r=k.getLittleEndian16(),v=k.getLittleEndian16(),A=k.getLittleEndian16(),I=k.getLittleEndian16(),C=k.getLittleEndian16(),F=k.getLittleEndian16(),W=k.getLittleEndian16(),E=k.getLittleEndian16(),l=k.getLittleEndian32(),K=new Uint8Array(k.getData().buffer,k.getPosition(),l),P=new Uint8Array(l);P.set(K);K=rdpcodecs.bitmap;switch(E){case 0:var S=new Uint32Array(P.buffer);k.skipPosition(l);break;case 1:switch(W){case 16:S=K.decompressInt16(C,F,l,P,0);break;case 24:S=K.decompressInt24(C,F,l,P,
0);break;case 32:S=K.decompressInt32(C,F,l,P,0)}k.skipPosition(l);break;case 2:S=new rdpcodecs.NSCodec,S.process(k,W,C,F),l=S.getData(),S=S.getDataSize(),S=new Uint32Array(S),rdpcodecs.flipimage(l,0,S,C,F,1)}Ka.putBitmap(r,v,new rdpcodecs.Bitmap(S,C,F,A,I,W,0==E?null:P,E))}t&&t.end("his_bitmap_dec");break;case 5:qa.fromStream(k);break;case 6:ua.fromStream(k);break;case 7:for(;k.has(6);)if(f=k.getLittleEndian16(),l=k.getLittleEndian32())h=k.getData().subarray(k.getPosition(),k.getPosition()+l),ia[f]=
h,k.skipPosition(l);break;case 9:fa.fromStream(k);break;default:if(X.onSetGfxHistory)X.onSetGfxHistory(f,k)}};var ua=new function(){var f=[],k=!1;this.useRemoteCursor=function(h){k=h};this.set=function(h,r){k&&(r.system="");f[h]=r};this.get=function(h){return f[h]};this.total=function(){return f.length};this.toPDU=function(){for(var h=2,r=2,v=0,A=0,I=f.length,C;A<I;A++)if(C=f[A])v++,r=r+7+(C.rawData?C.rawData.length:0);if(!v)return null;r=new Uint32Array(r);r[0]=100728861;r[1]=v;for(A=0;A<I;A++)if(C=
f[A])if(v=C.rawData?C.rawData.length:0,r[h++]=C.cache_idx|C.bpp<<16,r[h++]=C.hotX|C.hotY<<16,r[h++]=C.width|C.height<<16,r[h++]=C.xorSize,r[h++]=C.andSize,r[h++]=C.distance,r[h++]=v)r.set(C.rawData,h),h+=v;return r};this.fromStream=function(h){var r=h.getPosition();h=new Uint32Array(h.getData().buffer,r);var v=h[0],A=0;for(r=1;A<v;A++){var I=h[r]&65535;var C=h[r++]>>16;var F=h[r]&65535;var W=h[r++]>>16;var E=h[r]&65535;var l=h[r++]>>16;var K=h[r++];var P=h[r++];var S=h[r++];var ca=h[r++];var ma=null;
ca&&(ma=new Uint32Array(ca),ma.set(h.subarray(r,r+ca)),r+=ca);C=new x(I,ma,F,W,E,l,C,K,P);S&&(C.distance=S);k&&(C.system="");f[I]=C}}};ua.useRemoteCursor(!!ea.remoteCursor);var fa=new function(){function f(h,r,v,A,I,C){this.x=h;this.y=r;this.cx=v;this.cy=A;this.offset=I;this.data=C}var k=[];this.save=function(h,r,v,A,I,C){h=new f(h,r,v,A,I,C);r=0;for(v=k.length;r<v;r++)if(!k[r]){k[r]=h;return}k.push(h)};this.restore=function(h,r,v,A,I){for(var C,F=0,W=k.length;F<W;F++)if((C=k[F])&&C.x==h&&C.y==r&&
C.cx==v&&C.cy==A){if(C.offset==I)return h=C.data,k[F]=null,h;svGlobal.logger.warn("TODO: offset")}return null};this.toPDU=function(){for(var h=0,r=2,v=0,A=k.length;v<A;v++)k[v]&&(h++,r+=k[v].data.length+6);if(!h||!r)return null;r=new Uint32Array(r);var I=2;r[0]=151060509;r[1]=h;for(v=0;v<A;v++)if(h=k[v])r[I++]=h.x,r[I++]=h.y,r[I++]=h.cx,r[I++]=h.cy,r[I++]=h.offset,r[I++]=h.data.length,r.set(h.data,I),I+=h.data.length;return r};this.fromStream=function(h){h=new Uint32Array(h.getData().buffer,h.getPosition());
for(var r=1,v=h[0],A,I,C,F,W,E,l,K=0;K<v;K++)A=h[r++],I=h[r++],C=h[r++],F=h[r++],W=h[r++],E=h[r++],l=new Uint32Array(E),E=r+E,l.set(h.subarray(r,E)),r=E,this.save(A,I,C,F,W,l)}},ia=[],qa=new function(){var f=[];this.putFont=function(k,h,r){f[k]||(f[k]=[]);f[k][h]=r};this.getFont=function(k,h){return f[k]?f[k][h]:null};this.toPDU=function(){var k=0,h,r,v;var A=4;for(var I,C=f.length;k<C;k++)if((v=f[k])&&v.length)for(I=v.length,h=0;h<I;h++)(r=v[h])&&(A+=15+r.fontData.length);if(5>A)return null;var F=
new Uint8Array(A);A=new hi5.DataBuffer(F,0,A);F[0]=29;F[2]=1;F[3]=5;A.skipPosition(4);k=0;for(C=f.length;k<C;k++)if((v=f[k])&&v.length)for(I=v.length,h=0;h<I;h++)if(r=v[h])A.setByte(k),A.setLittleEndian16(h),A.setLittleEndian16(r.offset),A.setLittleEndian16(r.baseLine),A.setLittleEndian16(r.width),A.setLittleEndian16(r.height),A.setLittleEndian32(r.fontData.length),A.setBytes(r.fontData);return F};this.fromStream=function(k){for(;k.has(15);){var h=k.getByte(),r=k.getLittleEndian16(),v=k.getLittleEndian16(),
A=k.getLittleEndian16(),I=k.getLittleEndian16(),C=k.getLittleEndian16(),F=k.getLittleEndian32();F=k.getBytes(F);this.putFont(h,r,new u(v,A,I,C,F))}}},Ka=new function(){var f=[],k=[];this.putBitmap=function(h,r,v){if(32767==r)k[h]&&(k[h].data=null,k[h]=null),k[h]=v;else{var A=f[h];A?A[r]&&(A[r].data=null,A[r]=null):f[h]=A=[];A[r]=v}};this.getBitmap=function(h,r){return 32767==r?k[h]:f[h]?f[h][r]:null};this.forEach=function(h){for(var r=f.length,v=0;v<r;v++)h(f[v],v,f)}}}function Lb(a){function b(l,
K,P){K[P]=l>>24&255;K[P+1]=l>>16&255;K[P+2]=l>>8&255;K[P+3]=l&255}function c(l,K){var P=l.length;K=new Uint8Array(K?P+1:P);for(var S=0;S<P;S++)K[S]=l.charCodeAt(S);return K}var e=new Uint8Array([0,0,0,0]),d=new Uint8Array([255,255,255,255]),g={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],mvex:[],mvhd:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],
smhd:[],mehd:[]},m=this,G=1,z=a?48E3:9E4,D=1,H=!1,u=null;this.initTypes=function(){for(var l in g)g[l]=[l.charCodeAt(0),l.charCodeAt(1),l.charCodeAt(2),l.charCodeAt(3)];g.url=[117,114,108,32]};m.initTypes();this.reset=function(){H=!1;D=G=1};this.close=function(){m&&(m.reset(),m=null)};this.remux=function(l){l.id=G;l.isAudio=a;l.timeScale=a?l.audioHeader.sampleRate:z;if(!H){var K=new O(a),P=new q(l);u=new Uint8Array(K.data.length+P.data.length);u.set(K.data,0);u.set(P.data,K.data.length);H=!0}l.sequenceNumber=
D++;K=new v(l);P=new E(l);l=new Uint8Array(K.data.length+P.data.length);l.set(K.data,0);l.set(P.data,K.data.length);u&&(K=new Uint8Array(u.length+l.length),K.set(u,0),K.set(l,u.length),l=K,u=null);if(m.ondata)m.ondata(l)};var x=function(l){this.type=l;this.data=null};x.prototype.setData=function(){var l=Array.prototype.slice.call(arguments,0),K=l.length,P=8,S;for(S=0;S<K;S++)P+=l[S].byteLength;this.data=new Uint8Array(P);b(P,this.data,0);this.data.set(this.type,4);P=8;for(S=0;S<K;S++)this.data.set(l[S],
P),P+=l[S].byteLength};var O=function(l){var K=x.call(this,g.ftyp)||this;var P=c("mp42"),S=c("mp41"),ca=c("isom"),ma=c("avc1"),za=c("iso5"),Ga=new Uint8Array([0,0,2,0]);l?K.setData(P,Ga,P,S,ca,za):K.setData(ca,Ga,ca,S,za,ma);return K};$jscomp.inherits(O,x);var q=function(l){var K=x.call(this,g.moov)||this;var P=new y(l),S=new B(l);l=new h(l);K.setData(P.data,S.data,l.data);return K};$jscomp.inherits(q,x);var y=function(l){l=x.call(this,g.mvhd)||this;var K=new Uint8Array([0]),P=new Uint8Array([0,0,
0]),S=new Uint8Array([0,0,0,0]),ca=new Uint8Array([0,0,0,0]),ma=new Uint8Array(4);b(1E3,ma,0);var za=new Uint8Array([0,1,0,0]),Ga=new Uint8Array([1,0]),Ca=new Uint8Array(10),Fa=new Uint8Array(36);Fa[1]=1;Fa[17]=1;Fa[32]=64;var Aa=new Uint8Array(24),Sa=new Uint8Array([255,255,255,255]);l.setData(K,P,S,ca,ma,e,za,Ga,Ca,Fa,Aa,Sa);return l};$jscomp.inherits(y,x);var B=function(l){var K=x.call(this,g.trak)||this;var P=new t(l);l=new L(l);K.setData(P.data,l.data);return K};$jscomp.inherits(B,x);var t=function(l){var K=
x.call(this,g.tkhd)||this;var P=new Uint8Array([0]),S=new Uint8Array([0,0,7]),ca=new Uint8Array([0,0,0,0]),ma=new Uint8Array([0,0,0,0]),za=new Uint8Array(4);b(l.id,za,0);var Ga=new Uint8Array(4),Ca=new Uint8Array(8),Fa=new Uint8Array([0,0]),Aa=new Uint8Array([0,0]),Sa=l.isAudio?new Uint8Array([1,0]):new Uint8Array([0,0]),ta=new Uint8Array(2),wa=new Uint8Array(36);wa[1]=1;wa[17]=1;wa[32]=64;var Na=new Uint8Array(4);Na[0]=l.width>>8&255;Na[1]=l.width&255;Na[2]=0;Na[3]=0;var Xa=new Uint8Array(4);Xa[0]=
l.height>>8&255;Xa[1]=l.height&255;Xa[2]=0;Xa[3]=0;K.setData(P,S,ca,ma,za,Ga,e,Ca,Fa,Aa,Sa,ta,wa,Na,Xa);return K};$jscomp.inherits(t,x);var L=function(l){var K=x.call(this,g.mdia)||this;var P=new R(l),S=new U(l);l=new w(l);K.setData(P.data,S.data,l.data);return K};$jscomp.inherits(L,x);var R=function(l){var K=x.call(this,g.mdhd)||this;var P=new Uint8Array([0]),S=new Uint8Array([0,0,0]),ca=new Uint8Array([0,0,0,0]),ma=new Uint8Array([0,0,0,0]),za=new Uint8Array(4);b(l.timeScale,za,0);l=new Uint8Array([85,
196]);var Ga=new Uint8Array(2);K.setData(P,S,ca,ma,za,e,l,Ga);return K};$jscomp.inherits(R,x);var U=function(l){var K=x.call(this,g.hdlr)||this;var P=new Uint8Array([0]),S=new Uint8Array([0,0,0]),ca=new Uint8Array(4);l=l.isAudio?c("soun"):c("vide");var ma=new Uint8Array(12),za=c("Remote Spark Handler",!0);K.setData(P,S,ca,l,ma,za);return K};$jscomp.inherits(U,x);var w=function(l){var K=x.call(this,g.minf)||this;var P=new M,S=new pa(l);l.isAudio?(l=new Z,K.setData(l.data,P.data,S.data)):(l=new Q,K.setData(l.data,
P.data,S.data));return K};$jscomp.inherits(w,x);var Q=function(){var l=x.call(this,g.vmhd)||this;var K=new Uint8Array([0]),P=new Uint8Array([0,0,1]),S=new Uint8Array([0,0]),ca=new Uint8Array(6);l.setData(K,P,S,ca);return l};$jscomp.inherits(Q,x);var Z=function(){var l=x.call(this,g.smhd)||this;var K=new Uint8Array([0]),P=new Uint8Array([0,0,0]),S=new Uint8Array([0,0]),ca=new Uint8Array(2);l.setData(K,P,S,ca);return l};$jscomp.inherits(Z,x);var M=function(){var l=x.call(this,g.dinf)||this;var K=new aa;
l.setData(K.data);return l};$jscomp.inherits(M,x);var aa=function(){var l=x.call(this,g.dref)||this;var K=new Uint8Array([0]),P=new Uint8Array([0,0,0]),S=new Uint8Array([0,0,0,1]),ca=new ja;l.setData(K,P,S,ca.data);return l};$jscomp.inherits(aa,x);var ja=function(){var l=x.call(this,g.url)||this;var K=new Uint8Array([0]),P=new Uint8Array([0,0,1]);l.setData(K,P);return l};$jscomp.inherits(ja,x);var pa=function(l){var K=x.call(this,g.stbl)||this;l=new X(l);var P=new qa,S=new Ka,ca=new f,ma=new k;K.setData(l.data,
P.data,S.data,ca.data,ma.data);return K};$jscomp.inherits(pa,x);var X=function(l){var K=x.call(this,g.stsd)||this;var P=new Uint8Array([0]),S=new Uint8Array([0,0,0]),ca=new Uint8Array([0,0,0,1]);l.isAudio?(l=new va(l),K.setData(P,S,ca,l.data)):(l=new ua(l),K.setData(P,S,ca,l.data));return K};$jscomp.inherits(X,x);var va=function(l){var K=x.call(this,g.mp4a)||this;var P=new Uint8Array(6),S=new Uint8Array([0,1]),ca=new Uint8Array(8),ma=new Uint8Array([0,2]),za=new Uint8Array([0,16]),Ga=new Uint8Array([0,
0]),Ca=new Uint8Array(2),Fa=l.audioHeader.sampleRate,Aa=new Uint8Array(4);Aa[0]=Fa>>8&255;Aa[1]=Fa&255;Aa[2]=0;Aa[3]=0;l=new xa(l);K.setData(P,S,ca,ma,za,Ga,Ca,Aa,l.data);return K};$jscomp.inherits(va,x);var xa=function(l){var K=x.call(this,g.esds)||this;var P=new Uint8Array([0]),S=new Uint8Array([0,0,0]),ca=new Uint8Array([3]),ma=new Uint8Array([25]),za=new Uint8Array([0,0]),Ga=new Uint8Array([0]),Ca=new Uint8Array([4]),Fa=new Uint8Array([17]),Aa=new Uint8Array([64]),Sa=new Uint8Array([21]),ta=new Uint8Array(3),
wa=l.bufferSizeDB;ta[0]=wa>>16&255;ta[1]=wa>>8&255;ta[2]=wa&255;wa=new Uint8Array(4);b(l.bitRate,wa,0);var Na=new Uint8Array(4);b(l.bitRate,Na,0);var Xa=new Uint8Array([5]),Za=new Uint8Array([2]),$a=l.audioHeader.audioType||2,ab=l.audioHeader.frequencyIdx,ub=l.audioHeader.channelConfig;l=new Uint8Array(2);l[0]=$a<<3|ab>>1&7;l[1]=(ab&1)<<7|ub<<3;$a=new Uint8Array([6]);ab=new Uint8Array([1]);ub=new Uint8Array([2]);K.setData(P,S,ca,ma,za,Ga,Ca,Fa,Aa,Sa,ta,wa,Na,Xa,Za,l,$a,ab,ub);return K};$jscomp.inherits(xa,
x);var ua=function(l){var K=x.call(this,g.avc1)||this;var P=new Uint8Array(6),S=new Uint8Array([0,1]),ca=new Uint8Array([0,0]),ma=new Uint8Array(2),za=new Uint8Array(12),Ga=new Uint8Array(2);Ga[0]=l.width>>8&255;Ga[1]=l.width&255;var Ca=new Uint8Array(2);Ca[0]=l.height>>8&255;Ca[1]=l.height&255;var Fa=new Uint8Array([0,72,0,0]),Aa=new Uint8Array([0,72,0,0]),Sa=new Uint8Array(4),ta=new Uint8Array([0,1]),wa=c("SparkStreamPlayer"),Na=new Uint8Array(32);Na[0]=wa.length;Na.set(wa,1);wa=new Uint8Array([0,
24]);var Xa=new Uint8Array([255,255]);l=new fa(l);K.setData(P,S,ca,ma,za,Ga,Ca,Fa,Aa,Sa,ta,Na,wa,Xa,l.data);return K};$jscomp.inherits(ua,x);var fa=function(l){var K=x.call(this,g.avcC)||this;var P=new Uint8Array([1]),S=new Uint8Array([l.sps[1]]),ca=new Uint8Array([l.sps[2]]),ma=new Uint8Array([l.sps[3]]),za=new Uint8Array([255]),Ga=new Uint8Array([225]),Ca=new Uint8Array(2),Fa=l.sps.byteLength;Ca[0]=Fa>>8&255;Ca[1]=Fa&255;Fa=new Uint8Array(l.sps);var Aa=new Uint8Array([1]),Sa=new Uint8Array(2),ta=
l.pps.byteLength;Sa[0]=ta>>8&255;Sa[1]=ta&255;l=new Uint8Array(l.pps);K.setData(P,S,ca,ma,za,Ga,Ca,Fa,Aa,Sa,l);return K};$jscomp.inherits(fa,x);var ia=function(){var l=x.call(this,g.btrt)||this;var K=new Uint8Array([0,28,156,128]),P=new Uint8Array([0,45,198,192]),S=new Uint8Array([0,45,198,192]);l.setData(K,P,S);return l};$jscomp.inherits(ia,x);var qa=function(){var l=x.call(this,g.stts)||this;var K=new Uint8Array([0]),P=new Uint8Array([0,0,0]),S=new Uint8Array([0,0,0,0]);l.setData(K,P,S);return l};
$jscomp.inherits(qa,x);var Ka=function(){var l=x.call(this,g.stsc)||this;var K=new Uint8Array([0]),P=new Uint8Array([0,0,0]),S=new Uint8Array([0,0,0,0]);l.setData(K,P,S);return l};$jscomp.inherits(Ka,x);var f=function(){var l=x.call(this,g.stsz)||this;var K=new Uint8Array([0]),P=new Uint8Array([0,0,0]),S=new Uint8Array([0,0,0,0]),ca=new Uint8Array([0,0,0,0]);l.setData(K,P,S,ca);return l};$jscomp.inherits(f,x);var k=function(){var l=x.call(this,g.stco)||this;var K=new Uint8Array([0]),P=new Uint8Array([0,
0,0]),S=new Uint8Array([0,0,0,0]);l.setData(K,P,S);return l};$jscomp.inherits(k,x);var h=function(l){var K=x.call(this,g.mvex)||this;l=new r(l);K.setData(l.data);return K};$jscomp.inherits(h,x);ia=function(l){l=x.call(this,g.mehd)||this;var K=new Uint8Array([0]),P=new Uint8Array([0,0,0]);l.setData(K,P,d);return l};$jscomp.inherits(ia,x);var r=function(l){var K=x.call(this,g.trex)||this;var P=new Uint8Array([0]),S=new Uint8Array([0,0,0]),ca=new Uint8Array(4);b(l.id,ca,0);l=new Uint8Array([0,0,0,1]);
var ma=new Uint8Array([0,0,0,0]),za=new Uint8Array([0,0,0,0]),Ga=new Uint8Array([0,0,0,0]);K.setData(P,S,ca,l,ma,za,Ga);return K};$jscomp.inherits(r,x);var v=function(l){var K=x.call(this,g.moof)||this;A.setSequenceNumber(l.sequenceNumber);l=new I(l);K.setData(A.data,l.data);return K};$jscomp.inherits(v,x);ia=function(l){var K=x.call(this,g.mfhd)||this;var P=new Uint8Array([0]),S=new Uint8Array([0,0,0]),ca=new Uint8Array(4);b(l,ca,0);K.setData(P,S,ca);return K};$jscomp.inherits(ia,x);ia.prototype.setSequenceNumber=
function(l){b(l,this.data,12)};var A=new ia(1),I=function(l){var K=x.call(this,g.traf)||this;C.setTrackId(l.id);C.setSampleDuration(l.frameDuration);F.setBaseMediaDecodeTime(l.samples[0].timestamp);var P=32+C.data.length+F.data.length;if(l.isAudio)l=new W(l,null,P);else{for(var S=[],ca=0;ca<l.samples.length;ca++){var ma=l.samples[ca];S.push({size:ma.unitsLength+4*ma.units.length,duration:l.frameDuration||3E3,compositionTimeOffset:0,flags:{isLeading:0,dependsOn:ma.hasIDR?2:1,isDependedOn:0,hasRedundancy:0,
isNonSync:ma.hasIDR?0:1,degradationPriority:0}})}l=new W(l,S,P)}K.setData(C.data,F.data,l.data);return K};$jscomp.inherits(I,x);ia=function(l,K){var P=x.call(this,g.tfhd)||this;P.isAudio=K;var S=new Uint8Array([0]),ca=K?new Uint8Array([2,0,10]):new Uint8Array([2,0,40]),ma=new Uint8Array(4);b(l,ma,0);K?(l=new Uint8Array([0,0,0,1]),K=new Uint8Array(4),b(1024,K,0),P.setData(S,ca,ma,l,K)):(l=new Uint8Array([0,0,2,0,1,1,0,0]),P.setData(S,ca,ma,l));return P};$jscomp.inherits(ia,x);ia.prototype.setTrackId=
function(l){b(l,this.data,12)};ia.prototype.setSampleDuration=function(l){this.isAudio||b(l,this.data,16)};var C=new ia(0,a);ia=function(l){var K=x.call(this,g.tfdt)||this;var P=new Uint8Array([0]),S=new Uint8Array([0,0,0]),ca=new Uint8Array(4);b(l,ca,0);K.setData(P,S,ca);return K};$jscomp.inherits(ia,x);ia.prototype.setBaseMediaDecodeTime=function(l){b(l,this.data,12)};var F=new ia(0),W=function(l,K,P){var S=x.call(this,g.trun)||this;var ca=new Uint8Array([0]),ma=l.isAudio?new Uint8Array([0,2,1]):
new Uint8Array([0,15,1]),za=l.isAudio?4:16;P+=za*(l.isAudio?l.samples.length:K.length)+28;var Ga=new Uint8Array(4);l.isAudio?b(l.samples.length,Ga,0):b(K.length,Ga,0);var Ca=new Uint8Array(4);b(P,Ca,0);if(l.isAudio){P=new Uint8Array(za*l.samples.length);for(var Fa=0;Fa<l.samples.length;Fa++)b(l.samples[Fa].aacData.byteLength,P,za*Fa)}else for(P=new Uint8Array(za*K.length),Fa=0;Fa<K.length;Fa++){l=K[Fa];var Aa=za*Fa;b(l.duration,P,Aa);b(l.size,P,Aa+4);var Sa=l.flags,ta=new Uint8Array(4);ta[0]=Sa.isLeading<<
2|Sa.dependsOn;ta[1]=Sa.isDependedOn<<6|Sa.hasRedundancy<<4|0|Sa.isNonSync;ta[2]=Sa.degradationPriority&61440;ta[3]=Sa.degradationPriority&15;P.set(ta,Aa+8);b(l.compositionTimeOffset,P,Aa+12)}S.setData(ca,ma,Ga,Ca,P);return S};$jscomp.inherits(W,x);ia=function(l){var K=x.call(this,g.sdtp)||this;for(var P=new Uint8Array([0]),S=new Uint8Array([0,0,0]),ca=new Uint8Array(l.length),ma=0;ma<l.length;ma++){var za=l[ma].flags;ca[ma]=za.isLeading<<6|za.dependsOn<<4|S.isDependedOn<<2|S.hasRedundancy}K.setData(P,
S,ca);return K};$jscomp.inherits(ia,x);var E=function(l){var K=x.call(this,g.mdat)||this;if(l.isAudio){for(var P=new Uint8Array(l.totalByteLength),S=0,ca=0;ca<l.samples.length;ca++){var ma=l.samples[ca].aacData;P.set(ma,S);S+=ma.byteLength}K.setData(P)}else{P=new Uint8Array(4*l.unitNum+l.totalByteLength);for(ca=S=0;ca<l.samples.length;ca++){ma=l.samples[ca];for(var za=0;za<ma.units.length;za++){var Ga=ma.units[za],Ca=Ga.data.byteLength;b(Ca,P,S);S+=4;P.set(Ga.data,S);S+=Ca}}K.setData(P)}return K};
$jscomp.inherits(E,x)}function pc(a){function b(D,H){this.aacData=D;this.timestamp=H}function c(D,H,u,x){this.audioType=D;this.frequencyIdx=H;this.sampleRate=u;this.channelConfig=x}var e=pc.SAMPLING_FREQUENCY,d=null,g=!0,m=this,G=0;this.reset=function(){G=0;d=null;z.audioHeader=null;a&&a.reset()};var z=new function(){this.samples=[];this.duration=0;this.audioHeader=null;this.height=this.width=0;this.bufferSizeDB=1536;this.totalByteLength=this.bitRate=0;this.clear=function(){this.samples=[];this.totalByteLength=
this.bitRate=this.duration=0}};this.setMediaFormat=function(D,H){var u=D.frequencyIdx;u||(u=e.indexOf(D.sampleRate));-1==u&&console.error("Invalid AAC sampel rate: "+D.sampleRate);d=new c(D.audioType||2,u,D.sampleRate,D.channels||D.channelConfig);z.audioHeader=d;g=!H;if(m.oncodec)m.oncodec("mp4a.40.2",d)};this.parseAACData=this.parse=function(D){if(g){var H=m.readADTSHeader(D);D=D.subarray(H)}H=new b(D,G);G+=1024;z.samples.push(H);z.totalByteLength+=D.byteLength;D=1/(d.sampleRate/1024);z.duration=
D;z.samples[0]&&(z.bitRate=8*z.samples[0].aacData.length/D|0);a&&a.remux(z);z.clear()};this.readADTSHeader=function(D){var H=D[1]&0?9:7,u=(D[2]>>6&3)+1,x=D[2]>>2&15,O=e[x];O||console.error("Invalid Sampling Frequency Index: "+x);var q=((D[2]&1)<<2)+(D[3]>>6&3),y=D[1]>>1&3;0!=y&&console.error("Invalid data format: layer is not 0x00: "+y.toString(16));D.length!=((D[3]&3)<<11)+(D[4]<<3)+(D[5]>>5&7)&&console.error("No enough data in one ADTS frame, length= "+D.length);if(d){if(x!=d.frequencyIdx&&(d.frequencyIdx=
x,d.sampleRate=O,m.oncodec))m.oncodec("mp4a.40.2",d)}else if(d=new c(u,x,O,q),z.audioHeader=d,m.oncodec)m.oncodec("mp4a.40.2",d);return H}}function Tc(a){function b(){0==G&&console.error("no data available");var H=0,u=m-G;for(z=0;u<m;){var x=a[u];if(3!=x||0!=a[u-1]||0!=a[u-2])z=z<<8|x,H++;u++;if(4<=H)break}4>H&&(z<<=4-H);D=8*H;G=m-u}function c(H){if(!(D>H)){H-=D;var u=H>>3;H-=u>>3;G-=u;b()}z<<=H;D-=H}function e(H){var u=Math.min(D,H),x=z>>>32-u;32<H&&logger.error("Read more than 32 bits:"+H);D-=u;
0<D?z<<=u:0<G&&b();u=H-u;return 0<u?x<<u|e(u):x}function d(){var H;for(H=0;H<D;++H)if(0!==(z&2147483648>>>H))return z<<=H,D-=H,H;b();return H+d()}function g(){c(1+d())}var m=a.byteLength,G=m,z=0,D=0;this.readUEG=function(){var H=d();return e(H+1)-1};this.readEG=function(){var H=this.readUEG();return 1&H?1+H>>>1:-1*(H>>>1)};this.readBool=function(){return 1===e(1)};this.readU8=function(){return e(8)};this.readU16=function(){return e(16)};this.readU32=function(){return e(32)};this.skipScalingList=function(H){var u=
8,x=8,O;for(O=0;O<H;O++)0!==x&&(x=this.readEG(),x=(u+x+256)%256),u=0===x?u:x};this.readSPS=function(){var H=0,u=0,x=0,O=0,q=1,y,B=0,t=!0;var L=this.readU8();7!=(L&31)&&console.error("Invalid SPS type: "+L,a);L=this.readU8();e(5);c(3);this.readU8();g();if(100===L||110===L||122===L||244===L||44===L||83===L||86===L||118===L||128===L||138===L||139===L||134===L||135===L){var R=this.readUEG();3===R&&c(1);g();g();c(1);if(this.readBool()){var U=3!==R?8:12;for(y=0;y<U;y++)this.readBool()&&(6>y?this.skipScalingList(16):
this.skipScalingList(64))}}g();y=this.readUEG();if(0===y)this.readUEG();else if(1===y)for(c(1),c(1+d()),c(1+d()),U=this.readUEG(),y=0;y<U;y++)c(1+d());g();c(1);var w=this.readUEG();y=this.readUEG();U=e(1);0===U&&c(1);c(1);this.readBool()&&(H=this.readUEG(),u=this.readUEG(),x=this.readUEG(),O=this.readUEG());if(this.readBool()){if(this.readBool()){switch(this.readU8()){case 1:var Q=[1,1];break;case 2:Q=[12,11];break;case 3:Q=[10,11];break;case 4:Q=[16,11];break;case 5:Q=[40,33];break;case 6:Q=[24,
11];break;case 7:Q=[20,11];break;case 8:Q=[32,11];break;case 9:Q=[80,33];break;case 10:Q=[18,11];break;case 11:Q=[15,11];break;case 12:Q=[64,33];break;case 13:Q=[160,99];break;case 14:Q=[4,3];break;case 15:Q=[3,2];break;case 16:Q=[2,1];break;case 255:Q=[this.readU8()<<8|this.readU8(),this.readU8()<<8|this.readU8()]}Q&&(q=Q[0]/Q[1])}this.readBool()&&c(1);this.readBool()&&(c(4),this.readBool()&&c(24));this.readBool()&&(g(),g());this.readBool()&&(B=this.readU32(),Q=this.readU32(),t=this.readBool(),B=
Q/(2*B))}q=Math.ceil((16*(w+1)-2*H-2*u)*q);Q=(2-U)*(y+1)*16-(U?2:4)*(x+O);y="avc1."+(0==a[1]?"00":a[1].toString(16));y+=0==a[2]?"00":a[2].toString(16);y+=0==a[3]?"00":a[3].toString(16);return{width:q,height:Q,profileIdc:L,chromaFormatIdc:R,frameCropLeftOffset:H,frameCropRightOffset:u,frameCropTopOffset:x,frameCropBottomOffset:O,fps:B,fixedFrameRate:t,codec:y}};this.readSliceType=function(){this.readU8();this.readUEG();return this.readUEG()}}function Md(a){function b(){this.height=this.width=0;this.codec=
"";this.pps=this.sps=null;this.frameDuration=3E3;this.samples=[];this.sequence=this.unitNum=this.totalByteLength=0;this.clear=function(){this.unitNum=this.totalByteLength=this.samples.length=0}}function c(){this.units=G;this.unitsLength=z;this.timestamp=d;this.hasIDR=g}function e(){var x=!1;if(m&&H.sps){var O=new c;d+=H.frameDuration||3E3;H.samples.push(O);H.totalByteLength+=z;H.unitNum+=G.length;H.sequence++;x=!0;if(O.hasIDR&&u.onkeyframe)u.onkeyframe(O)}m=g=!1;G=[];z=0;return x}var d=0,g=!1,m=!1,
G=[],z=0,D=Lb.searchStartCode,H=null,u=this;H=new b;this.reset=function(){d=0;g=!1;G=[];z=0;H=new b;a&&a.reset()};this.close=function(){u&&(u.reset(),u=null)};this.parseH264Data=this.parse=function(x){for(var O=[],q=0,y,B,t,L=[0,0];q<x.byteLength;){L[0]=q;D(x,L);var R=L[0];if(-1==R)break;q=L[1];q=R+q;t=x[q];t&=31;y&&(y={type:B,data:x.subarray(y,R)},O.push(y));y=q;B=t}y&&(y={type:B,data:x.subarray(y,x.byteLength)},O.push(y));for(x=0;x<O.length;x++)switch(L=O[x],q=L.type,q){case 1:case 2:case 3:case 4:G.push(L);
z+=L.data.byteLength;m=!0;break;case 5:m=g=!0;G.push(L);z+=L.data.byteLength;break;case 6:break;case 7:y=L.data;q="avc1."+(0==y[1]?"00":y[1].toString(16));q+=0==y[2]?"00":y[2].toString(16);q+=0==y[3]?"00":y[3].toString(16);y=new Tc(L.data);y=y.readSPS();H.width=y.width;H.height=y.height;H.codec=q;H.sps=L.data;y.fps&&(H.frameDuration=9E4/y.fps|0);G.push(L);z+=L.data.byteLength;if(u.oncodec)u.oncodec(q,y);break;case 8:H.pps=L.data;G.push(L);z+=L.data.byteLength;break;case 9:e();break;default:console.log("Ignore NAL unit with type = "+
q)}e()&&H.sps&&(a.remux(H),H.clear())}}function Mb(a,b,c){function e(){for(;z;){if(B.updating){z=!1;break}var R=G.shift();if(!R)break;try{B.appendBuffer(R),D=0}catch(U){G.unshift(R);if("QuotaExceededError"==U.name)if(m(!0))continue;else{if(H.onerror)H.onerror(U);else console.log("QuotaExceededError: not recoverable, isAudio: "+c),H.close();break}D++;console.error("Failed to append buffer, retry "+D,U);if(2<D){if(H.onerror)H.onerror(U);break}}}}function d(){z=!0;e()}function g(){B=y.addSourceBuffer(u);
B.mode="sequence";B.addEventListener("updateend",d);B.addEventListener("error",function(R){console.error(R)});z=!0;H.play(!1);e()}function m(R){var U=Math.min(a.played.end(0),B.buffered.end(0)),w=0,Q=q.length,Z=!1,M=0;if(c)M=U-180,0>M&&console.warn("Not possible, time played secs: "+U);else if(1<Q){var aa=Q-2;for(U=9E4*U|0;w<Q;){if(q[w]>U){aa=w-2;break}w++}0<=aa&&(M=(q[aa]+1E3)/9E4)}if(0<M)try{B.remove(0,M),q.splice(0,aa+1),Z=!0,console.info("Buffer removed "+M+" isAudio: "+c)}catch(ja){console.warn("Buffer removal "+
M+" failed, retry, isAudio: "+c)}R||(O=setTimeout(m,18E4));return Z}var G=[],z=!1,D=0,H=this,u="",x=null,O=0,q=[],y=null,B=null,t=null,L=null;a.autoplay=!0;this.getKeyFrames=function(){return q};t=new Lb(c);t.ondata=function(R){G.push(R);e()};L=c?new pc(t):new Md(t);L.onkeyframe=function(R){q.push(R.timestamp)};L.oncodec=function(R,U){var w=c?"audio/mp4;codecs=":"video/mp4;codecs=";w+=R;if(w!=u||(c?x.sampleRate!=U.sampleRate:x.width!=U.width||x.height!=U.height))if(u=w,x=U,z=!1,B=null,y=new MediaSource,
y.addEventListener("sourceopen",g),a.src=URL.createObjectURL(y),H.onsps)H.onsps(U)};b.onvideoframe=function(R){L.parse(R)};b.onaudioframe=function(R){L.parse(R)};b.onendofstream=function(){H.reset()};this.play=function(R){a.play().catch(function(U){if(!R&&(console.error(U),H.onplayerror))H.onplayerror(U)})};this.reset=function(){console.log("Reset player");O&&(clearTimeout(O),O=0);q.length=0;z=!1;u="";x=null;L&&L.reset();G.length=0};this.close=function(){H&&(H.reset(),y&&"open"==y.readyState&&(y.endOfStream(),
a.src=null),L&&L.close&&L.close(),t&&t.close&&t.close(),H=null)};this.setMediaFormat=function(R,U){L.setMediaFormat&&L.setMediaFormat(R,U)};this.getMediaSource=function(){return y};this.getMediaSourceBuffer=function(){return B};a.addEventListener("ended",function(R){console.warn(".... ended");O&&(clearTimeout(O),O=0)});a.addEventListener("emptied",function(R){z=!!B});a.addEventListener("pause",function(R){console.warn(".... paused");z=!!B;var U=a.currentTime;a.play().then(function(){console.warn("... played: "+
a.currentTime+" t: "+U)}).catch(function(w){console.error(w)})});a.addEventListener("waiting",function(R){z=!!B})}function Nd(a,b,c){function e(u){var x=u.codec;if(x!=d||(b?G.sampleRate!=u.sampleRate:G.width!=u.width||G.height!=u.height))if(console.log("Codec: "+x+" audio: "+b),d=x,G=u,m||(m=new VideoDecoder({output:function(O){var q=z.length;if(q){for(var y=O.timestamp;q&&z[0]<y;)z.shift(),q--;if(q&&z[0]==y){z.shift();O.close();return}}g.onframedecoded&&g.onframedecoded(O);O.close()},error:function(O){console.error("Decoder error:",
O)}})),m.configure({codec:d,codedWidth:u.width,codedHeight:u.height,hardwareAcceleration:c||"prefer-software"}),g.onsps)g.onsps(u)}var d=null,g=this,m,G=null,z=[],D={type:"delta",data:null,timestamp:0},H=0;a.onvideoframe=function(u,x){var O;var q=0;var y=[0,0],B=u.length,t=!1;for(O=null;q<B;){y[0]=q;Lb.searchStartCode(u,y);var L=y[0];if(-1==L)break;L+=y[1];q=L+1;var R=u[L]&31;switch(R){case 1:case 2:case 3:case 4:break;case 5:t=!0;break;case 6:break;case 7:O=(new Tc(u.subarray(L))).readSPS();break;
case 8:break;case 9:break;default:console.log("nal type:"+R)}}q=t;O&&e(O);G&&(D.type=q?"key":"delta",D.data=u,D.timestamp=H,x&&z.push(H),H+=10,u=new EncodedVideoChunk(D),m.decode(u))};this.play=function(u){};this.reset=function(){console.log("Reset MediaDecoder");G=d=null;H=0;z.length=0;m&&m.reset()&&m.close();m=null};this.close=function(){g.reset();m&&(m.close(),m=null)}}this.displayMsg=this.reconnectOnResize=!0;this.appTimeout=1600;this.reconnectTimes=0;this.windowState=3;this.setTitle=this.openLink=
!0;this.sessionInfo={domain:"",userName:"",sessionId:0,joinedSessions:[],suppressOutput:!1,appInfo:null,joiners:[]};this.mode=0;this.remoteAppLogin=!0;var Kb=!1,lb={},jb={},Ab=null,p=this,lc=!1,Wa=!1,db=0,Bb=null,Uc=0;hi5.appcfg||(hi5.appcfg={img:{},toolbar:{fadable:!0},displayMsg:!0});var ea=hi5.appcfg,Ib="";this.setConfig=function(a){ea=a};var cb="object"==typeof n?n:null,N=cb?{}:hi5.tool.queryToObj(n.substring(n.indexOf("?")+1));void 0==N.mapClipboard&&ea.clipboard&&void 0!=ea.clipboard.enabled&&
(N.mapClipboard=ea.clipboard.enabled);N.hardwareAcceleration||(N.hardwareAcceleration=ea.hardwareAcceleration);void 0==ea.enableDVCAudio&&(ea.enableDVCAudio=!0);var Ia=0,Ja=0,gb=(ka||N.color||N.server_bpp||16)|0,nc=null,Vc=null,Pa=null,Hb=null,Wc="/DOWNLOAD?",Xc="/CLIP?";24==gb&&(gb=16);var Va="app"==N.startProgram,Jb=T(N.mapDisk),mb=0;this.setLinks=function(a){a.download&&(Wc=a.download);a.clipboard&&(Xc=a.clipboard)};this.protocol=cb?"":n.substring(0,n.indexOf("://")).toLowerCase();this.hasSmartCard=
function(){return T(N.smartCard)||T(N.mapSmartCard)||T(N.passwordIsPin)};this.enableWebAuthn=function(){return T(N.enableWebAuthn)||T(N.useWebAuthn)};this.hasScanner=function(){return T(N.scanner)};this.hasUSB=function(){return T(N.mapUSB)&&!!navigator.usb};this.getUSB=function(){return N.usb||hi5.appcfg.usb||{filters:[{classCode:0},{classCode:2},{classCode:5},{classCode:6},{classCode:10},{classCode:13},{classCode:239},{classCode:220},{classCode:239},{classCode:254},{classCode:255}]}};this.setProfiler=
function(a){Vc=a};this.getProfiler=function(){return Vc};this.gateway=function(){if(cb)return"";var a=n.lastIndexOf("/RDP?");-1==a&&(a=n.lastIndexOf("/JOIN?"));-1==a&&(a=n.lastIndexOf("/PLAY?"));return n.substring(0,a).replace(/wss:\/\//ig,"https://").replace(/ws:\/\//ig,"http://")}();svGlobal.logger.warn("Ver:"+svGlobal.version+" build:"+svGlobal.build);this.getGatewayAddr=sa;var kb="object"==typeof n||0<n.indexOf("/PLAY?"),qc=!kb&&0<n.indexOf("invitation=");if(qc){var rc=decodeURIComponent(n),Nb=
rc.indexOf(' USERNAME="');if(0<Nb){Nb+=11;var Od=rc.substring(Nb,rc.indexOf('"',Nb));n+="&novice="+Od}n+="&mapClipboard=on";N.mapClipboard="on";this.reconnectOnResize=!1}if(kb)this.mode=1,cb?n="":(Ia=640,Ja=480),n+="&touchpad=on",N.touchpad="on",this.reconnectOnResize=!1;else if(0<n.indexOf("/JOIN?")||qc)this.mode=2,this.reconnectOnResize=!1;var sc=T(N.gfx)||T(N.remotefx)||0<p.mode;sc&&(Va||qc?(sc=!1,N.remotefx=!1):gb=32);J?Ia=parseInt(J):N.width&&(Ia=parseInt(N.width));V?Ja=parseInt(V):N.height&&
(Ja=parseInt(N.height));-1==Ia&&(Ia=hi5.browser.getScreenWidth());-1==Ja&&(Ja=hi5.browser.getScreenHeight());N.symlink&&N.parameters&&hi5.tool.queryToObj(N.parameters,N);N.gateway||(n+="&gateway="+encodeURIComponent(p.gateway));!N.minWidth&&ea.minWidth&&(N.minWidth=ea.minWidth);!N.minHeight&&ea.minHeight&&(N.minHeight=ea.minHeight);N.minWidth&&(N.minWidth=parseInt(N.minWidth));N.minHeight&&(N.minHeight=parseInt(N.minHeight));N.waWidth=N.waWidth?parseInt(N.waWidth):hi5.browser.isAndroid||hi5.browser.isiOS?
Math.max(screen.width,screen.height):screen.width;N.waWidth&=-4;N.waHeight=N.waHeight?parseInt(N.waHeight):hi5.browser.isAndroid||hi5.browser.isiOS?Math.max(screen.width,screen.height):screen.height;N.waHeight&=-4;"useSSL"in N||(n+="&useSSL="+("wss"==p.protocol));hi5.storage.isAvailable&&(T(N.shareClipboard)||N.shareClipboardId)&&(n+="&shareClipboardId="+(N.shareClipboardId||Y()));ea&&(void 0!=ea.displayMsg?this.displayMsg=ea.displayMsg:ea.displayMsg=this.displayMsg,ea.appTimeout&&(this.appTimeout=
ea.appTimeout),void 0!=ea.reconnectOnResize&&(this.reconnectOnResize=ea.reconnectOnResize),ea.reconnectTimes&&(this.reconnectTimes=ea.reconnectTimes),void 0!=ea.windowState&&(this.windowState=ea.windowState),void 0!=ea.openLink&&(this.openLink=ea.openLink),void 0!=ea.setTitle&&(this.setTitle=ea.setTitle),"boolean"==typeof ea.useWSS&&(n=(ea.useWSS?"wss":"ws")+n.substring(n.indexOf("://"))),"boolean"==typeof ea.remoteAppLogin&&(this.remoteAppLogin=ea.remoteAppLogin,Kb=!ea.remoteAppLogin,svGlobal.logger.warn("remoteAppLogin deprecated, use hideLogin in appcfg.js instead")),
"boolean"==typeof ea.hideLogin&&(Kb=ea.hideLogin),void 0!=ea.localPrinter&&void 0==N.localPrinter&&(N.localPrinter=ea.localPrinter));var Ma=null;void 0==ea.useWorker&&(ea.useWorker=!1);ea.useWorker&&(!window.Worker||hi5.browser.isFirefox||Va&&!hi5.browser.isIE||"file:"==location.protocol||0<navigator.userAgent.indexOf("MSIE 10."))&&(ea.useWorker=!1);void 0==hi5.libMin&&(hi5.libMin=!0);var La=ea.useWorker?new Worker(oa("rdpworker",hi5.libMin?"rdpworker_min.js":"rdpworker.js")):null,tb=this.reconnectTimes,
$b=La?{type:5,data:null}:null;this.getDisplayName=ba;this.server=ba();this.port=parseInt(N.port,10);this.loadbalanceToken="";ea.loadbalanceTokenName&&(N[ea.loadbalanceTokenName]?ha(N[ea.loadbalanceTokenName]):!1!==ea.randomAppId?ha(hi5.tool.uuid()):svGlobal.logger.info("Using app.id as loadbalanceToken"));this.modifyURL=function(a){p.loadbalanceToken&&(a+=-1==a.indexOf("?")?"?"+p.loadbalanceToken:"&"+p.loadbalanceToken,a+="&loadbalanceTokenName="+ea.loadbalanceTokenName);return a};this.getURL=function(){return n};
this.getRuntimeURL=function(){var a=n+"&width="+Ia+"&height="+Ja+"&server_bpp="+gb+"&audio="+(Ta.available||hi5.browser.isIE),b=Dc(),c="";b&&(c=sessionStorage[b]||"")&&(c="&preSymJoin="+c);a+=c;var e=N.monitorDef,d=N.monitor,g=0;b=da.size();var m=Array(b);c=Array(b);var G=0,z=0,D=0,H=0,u=0,x=0,O="";if(e){c=na.parseMonitorDef(e);for(b=c.length;g<b;g++){var q=c[g];q[0]<D&&(D=q[0]);q[1]<H&&(H=q[1]);q[2]>u&&(u=q[2]);q[3]>x&&(x=q[3])}0>D&&(G=-D);0>H&&(z=-H);q=0>d?[D,H,u,x]:c[d];N.width=q[2]-q[0]+1;N.height=
q[3]-q[1]+1;g=da.getSurface(0);g.setMonitor(q[0],q[1],q[2],q[3]);if(G||z)for(q=g.getMousePosition(),q.left+=G,q.right+=G,q.top+=z,q.bottom+=z,g=0;g<b;g++)q=c[g],q[0]+=G,q[1]+=z,q[2]+=G,q[3]+=z;na.setMonitorLayout(c);0>d&&na.setMonitorCount(0);p.reconnectOnResize=!1;b="&monitorDef="+e+"&width="+N.width+"&height="+N.height}else{if(1<b&&!Va){for(da.verifyMonitors();g<b;g++)e=da.getSurface(g),q=e.getMousePosition(),q.left<D&&(D=q.left),q.top<H&&(H=q.top),q.right>u&&(u=q.right),q.bottom>x&&(x=q.bottom),
m[g]=q,O&&(O+=","),O+=q.left+":"+q.top+":"+q.right+":"+q.bottom;0>D&&(G=-D);0>H&&(z=-H);for(g=0;g<b;g++){q=da.getSurface(g).getMousePosition();if(G||z)q.left+=G,q.right+=G,q.top+=z,q.bottom+=z;c[g]=[q.left,q.top,q.right,q.bottom,q.left==G&&q.top==z?1:0]}na.setMonitorLayout(c);p.reconnectOnResize=!1}O&&(svGlobal.logger.warn("MonitorDef:"+O),N.width=u-D+1,N.height=x-H+1,O="&monitorDef="+O+"&width="+N.width+"&height="+N.height);b=O}a+=b;0>n.indexOf("waWidth")&&(b=(b=da.getFocused())?b.getWindow():window,
a+="&waWidth="+N.waWidth+"&waHeight="+N.waHeight+"&dpWidth="+b.innerWidth+"&dpHeight="+b.innerHeight);b=new Date;N.tzOffset||(a+="&tzOffset="+b.getTimezoneOffset());N.timezone||(c=hi5.timezone.getTimeZone())&&(a+="&timezone="+encodeURIComponent(c.standardName));a+="&time="+b.getTime();void 0==N.soundPref&&(N.soundPref=0,a+="&soundPref=0");G=c=b="";for(G in lb)z=lb[G],"flags"in z&&(b&&(b+=",",c+=","),b+=z.name,c+=z.flags);b&&(a=a+("&channelName="+b)+("&channelFlags="+c));b="";for(G in jb)z=jb[G],"flags"in
z&&(b&&(b+=","),b+=z.name);b&&(a+="&gwChannelName="+b);if(c=td())b=c.account,c=c.session,b&&(a+="&account="+b),c&&(a+="&session="+c);b=hi5.browser.isTouch&&(1024<=window.innerWidth||768<=window.innerHeight);N.audioRecord=T(N.audioRecord)&&hi5.audio.recordable;Ea.init(b,sc,N.audioRecord,N.soundPref,T(N.mapCamera)&&!!navigator.mediaDevices,T(N.mapUSB)&&!!navigator.usb);N.audioRecord&&(a+="&audioRecord=on");N.decompressingRDP61&&(a+="&decompressingRDP61=on");0<Ea.count&&(a+="&dvcChannels="+Ea.names.join(","));
a+="&binary=on";ea.existingFile&&(a+="&existingFile="+ea.existingFile);a+="&isTouch="+b+"&gatewayAddr="+encodeURIComponent(sa());a=p.modifyURL(a);ea.copyTextOnly&&T(N.mapClipboard)&&(a+="&copyTextOnly=on");(b=hi5.browser.cookie.get("__SV_TOKEN_A"))&&(a+="&__SV_TOKEN_A="+encodeURIComponent(b));(b=svGlobal.Rdp.languageToKeyboard.detect())&&(a+="&_keyboard="+b);T(N.textPrinter)&&(a+="&printerDriver="+encodeURIComponent("Generic / Text Only"));return a+=Cd()};this.getColor=function(){return gb};this.changeTitle=
la;hi5.browser.isTouch&&Math.max(Ia,Ja)>Math.max(window.innerWidth,window.innerHeight)&&(this.reconnectOnResize=!1);this.isRemoteApp=function(){return Va};var Ba=null,Ha=!1,pb=!1,oc=!1,Ta=new function(){function a(z){c&&(d&&d.disconnect(),g&&g.disconnect());hi5.audio.releaseAudioContext();z||(G&&(G.close(),G=null),m&&(m.pause(),m=null))}function b(z){console.error("play error: ",z)}var c=null;this.supportWebAudio=this.available=!1;(0==N.playSound||0<p.mode)&&(c=hi5.audio.getAudioContext())&&hi5.audio.playable&&
(this.supportWebAudio=this.available=!0);this.getContext=function(){return c};this.getBuffer=function(z){return c.createBuffer(2,z,Da.samplePerSec)};var e=0,d=null,g=null;this.setVolume=function(z){1==z?d=null:(d||(d=c.createGain()),d.gain.value=z)};this.playBuffer=function(z){g=c.createBufferSource();g.buffer=z;d?(g.connect(d),d.connect(c.destination)):g.connect(c.destination);var D=c.currentTime,H=0<e?e:D;H<D&&(H=D);e=H+z.duration;g.start?g.start(H):g.noteOn(H);return e-D};this.iOSFix=function(){if(c){var z=
this.getBuffer(1024),D=c.createBufferSource();D.buffer=z;D.connect(c.destination);D.start?D.start(0):D.noteOn(0)}};this.close=a;var m=null,G=null;this.onaudioframe=null;this.initMediaPlayer=function(z,D,H){a(!0);m||(m=document.createElement("audio"));G||(G=new Mb(m,z,!0),G.onplayerror=b,G.onerror=function(u){console.error("Not possible audio error",u)},svGlobal.logger.info("MediaPlayer init, headerless: "+H+" sampleRate:"+D.sampleRate));G.setMediaFormat(D,H);G.play(!1)}},Jd=Ta.available,na=new xc(200,
200);na.onSetCursor=Ic;this.setVolume=function(a){Ta&&Ta.setVolume(a)};this.setAudioBuffer=function(a){};var Xb=0,Wb=0,Yb=Ia-1,Zb=Ja-1,mc="";window.$rdp||(window.$rdp=this);ya(gb);this.setResolution=Oa;this.running=function(){return Ha};this.setJoinMode=function(a){Ha&&ra("8E1"+a)};this.setJoinCloseMode=function(a){Ha&&ra("8EB3\t"+a)};this.refuseControl=function(a){Ha&&ra("8E3"+a)};this.giveControl=function(a){Ha&&ra("8E4"+a)};this.pauseSession=function(a,b){Ha&&ra("8EB"+(b?1:0)+"\t"+a)};this.closeSession=
function(a){Ha&&ra("8EB2\t"+a)};this.requestControl=function(){Ha&&ra("8E2")};this.saveSession=function(a){Ha&&ra("8E9"+(a.save?1:0)+"\t"+(a.timeout||0)+"\t"+(a.id||0))};this.allowJoin=function(a,b){Ha&&ra("8EA"+a+"\t"+(b?1:0))};var Cb=new function(){function a(){if(c&&0<c.length){var g=c.shift();g.key?Cb.sendSingleKey(g.down,g.key):g.char&&rb(g.char);0<c.length?setTimeout(a,e):(c=null,d&&d())}}var b={" ":57,space:57,pgup:201,pageup:201,pgdn:209,pagedown:209,end:207,home:199,left:203,up:200,right:205,
down:208,printscreen:183,insert:210,del:211,"delete":211,altgr:184,windows:219,windowsright:220,context:221,esc:1,backspace:14,back:14,tab:15,enter:28,meta:29,command:29,ctrl:29,shift:42,alt:56,capslock:58,f1:59,f2:60,f3:61,f4:62,f5:63,f6:64,f7:65,f8:66,f9:67,f10:68,f11:87,f12:88,numlock:69,scrolllock:70,add:78};this.sendSingleKey=function(g,m){var G=b[m.toLowerCase()];G?p.writeScancode(g,G):(G=m.length,0!=G&&(1==G?p.writeKeyCode(g,m.toUpperCase().charCodeAt(0)):g&&p.writeText(m)))};var c=null,e=
0,d=null;this.sendKeyComb=function(g,m,G){if(Wa){g=g.split("+");var z=g.length,D;if(0!=z){var H=null,u=[];for(D=0;D<z;D++){var x=g[D];""==x&&""==H&&(x="Add");""!=x&&u.push({key:x,down:!0});H=x}z=u.length;for(D=z-1;0<=D;D--)u.push({key:u[D].key,down:!1});if(m)c=u,e=m,d=G,a();else for(D=0,z=u.length;D<z;D++)Cb.sendSingleKey(u[D].down,u[D].key)}}};this.sendText=function(g,m,G){for(var z=[],D=0,H=g.length;D<H;D++)z.push({"char":g.charAt(D)});c=z;e=m;d=G;a()}};this.writeKeyComb=function(a,b,c){Wa&&Cb.sendKeyComb(a,
b,c)};this.writeText=function(a,b,c){if(Wa)if(b)Cb.sendText(a,b,c);else for(b=0,c=a.length;b<c;b++)rb(a.charAt(b))};this.writeClipboard=function(a,b){a&&(b||(b="text/plain"),p.writeRawInput("880"+b+"\t"+a.hashCode()),Bb={type:b,text:a})};var da=new function(a,b){function c(){function d(u){for(;0<u.ownerWinid;){var x=D.getWinById(u.ownerWinid);if(x&&x.isVisible())u=x;else break}return u}function g(u){for(var x="";u;)u.titleInfo&&(x=u.titleInfo),u=D.getWinById(u.ownerWinid);return x}var m=[],G=[],z=
0,D=this;this.mainWin=null;this.appId="";var H=0;this.getActiveWinId=function(){return H};this.setActiveWinId=function(u,x){svGlobal.logger.info("setActiveWinId: "+u+" old: "+H+" max: "+x);if(H!=u){var O=0==H;H=u;(u=D.getMainByWinId(u))&&u.isMainWin()&&D.mainWin!=u&&(D.mainWin=u);O&&x&&(x=da.getFocused())&&(x=x.getFreeSpace(),u=x.width,p.resetSize(u,x.height))}};this.onchange=function(u){u.isVisible()||u!=D.mainWin?u.isVisible()&&!D.mainWin&&u.isMainWin()&&(D.mainWin=u,3==a.windowState&&u.exeCommand(61488)):
D.mainWin=null};this.addWin=function(u){for(var x=m.length,O=!1,q=0;q<x;q++)if(u.id==m[q].id){m[q]=u;O=!0;break}O||m.push(u);1==m.length&&(z=Date.now());x=u.isMainWin();svGlobal.logger.info("is mainwin:"+x+" id:"+u.id);x&&!D.mainWin&&(D.mainWin=u)};this.popWins=function(u){u=D.getWinById(u);var x=[];if(u){u=0<u.ownerWinid?u.ownerWinid:u.id;for(var O=m.length-1;0<=O;O--)if(m[O].ownerWinid==u||m[O].id==u)x.push(m[O]),m.splice(O,1)}return x};this.hasApp=function(u){return-1!=G.indexOf(u)};this.addApp=
function(u){return-1==G.indexOf(u)?(G.push(u),!0):!1};this.isNew=function(){return 3E4>Date.now()-z};this.getAll=function(){return m};this.hasWin=function(u){return 0<=m.indexOf(u)};this.close=function(){for(var u=0,x=m.length;u<x;u++)m[u].close()};this.clear=function(){m.length=0};this.delWin=function(u){for(var x=0,O=m.length;x<O;x++)if(m[x].id==u)return m.splice(x,1),x;return-1};this.isRunning=function(){var u=m.length;if(1>u)return!1;var x=0;for(u=m.length;x<u;x++){var O=m[x];if(O.showState)return!0}return!1};
this.getWinById=function(u){var x=m.length;if(1>x)return null;for(var O=0;O<x;O++){var q=m[O];if(q.id==u)return q}return null};this.getMainWinByAppId=function(u){var x=null,O=0;for(len=m.length;O<len;){x=m[O];if(x.appId==u&&x.isVisible()&&1>x.ownerWinid)break;O++}return x};this.getTopWin=function(u){var x=null,O,q=u.length;for(O=0;O<q&&(!(x=D.getWinById(u[O]))||!x.isVisible());O++)x=null;if(!x)for(svGlobal.logger.warn("No win found"),q=m.length,O=q-1;0<=O&&(x=m[O],!x.isVisible());O--)x=null;return x};
this.getMain=function(u){return(u=D.getTopWin(u))?d(u):null};this.getMainByWinId=function(u){return(u=D.getWinById(u))?d(u):null};this.getOtherApps=function(u,x,O){var q=m.length;if(0!=q&&m[q-1])if(q=m[q-1].appId,O||!q)setTimeout(function(){D.getOtherApps(u,x)},O||3E3);else{O=[];if(q=D.getTopWin(u)){var y=0<q.ownerWinid?q.ownerWinid:q.id,B=[],t=0;for(q=m.length;t<q;t++)m[t].ownerWinid!=y&&m[t].id!=y&&m[t].isVisible()&&B.push(m[t]);t=0;for(q=B.length;t<q;t++)B[t].ownerWinid!=y&&B[t].id!=y&&(O.push({title:g(B[t]),
win:d(B[t])}),y=0<B[t].ownerWinid?B[t].ownerWinid:B[t].id)}x(O)}};this.getFullTitle=function(u){for(var x,O="";;){x=D.getWinById(u);if(!x)break;x.titleInfo&&x.isVisible()&&(O&&(O=" > "+O),O=x.titleInfo+O);if(1>u)break;u=x.ownerWinid}return O}}var e=[];this.tryCloseRemoteApps=function(){if(a&&a.isRemoteApp())for(var d=e.length,g=0;g<d;g++)e[g].railWin&&e[g].railWin.close()};this.verifyMonitors=function(){for(var d=e.length,g=Array(d),m=0;m<d;m++)e[m].configMonitor(),g[m]=e[m].getMousePosition();g.sort(function(D,
H){var u=D.left-H.left;return 0!=u?u:D.top-H.top});var G=g.findIndex(function(D){return 0==D.left&&0==D.top});svGlobal.logger.info("monitor layout",g,G);-1==G&&(p.showMessage("* Primary monitor not found. Please make your browser window full screen."),svGlobal.logger.warn("Primary monitor not found (left=top=0)",g));for(m=G-1;0<=m;){if(g[m].right<g[m+1].left){var z=g[m+1].left-g[m].right-1;0<z&&(g[m].right+=z,g[m].left+=z)}g[m].bottom<g[m+1].top&&(z=g[m+1].top-g[m].bottom-1,0<z&&(g[m].top+=z,g[m].bottom+=
z));m--}for(m=G+1;m<d;)g[m-1].right<g[m].left&&(z=g[m].left-g[m-1].right-1,0<z&&(g[m].right-=z,g[m].left-=z)),g[m-1].bottom<g[m].top&&(z=g[m].top-g[m-1].bottom-1,0<z&&(g[m].top-=z,g[m].bottom-=z)),m++};this.repaint=function(d,g,m,G){for(var z=0,D=e.length;z<D;z++)e[z].repaint(d,g,m,G)};this.size=function(){return e.length};this.getSurface=function(d){return e[d]};this.addSurface=function(d){e.push(d)};this.hasSurface=function(d){for(var g=e.length,m=0;m<g;m++)if(e[m].equals(d))return!0;return!1};
this.getMonitorSurface=function(d,g,m,G){var z=e.length;if(1==z)return e[0];for(var D=0;D<z;D++)if(e[D].isMonitor(d,g,m,G))return e[D];return null};this.fromSyncedSurface=function(d){var g=e.length;Date.now();for(var m=0;m<g;m++)if(e[m].isClipSynced(d))return!0;return!1};this.setSize=function(d,g,m){for(var G=0,z=e.length;G<z;G++)e[G].setSize(d,g,m)};this.zOrders=[];this.drawLicense=function(d){for(var g=0,m=e.length;g<m;g++)e[g].drawLicense(d)};this.setReadOnly=function(d,g){for(var m=0,G=e.length;m<
G;m++)e[m].setReadOnly(d,g)};this.setVisible=function(d,g){svGlobal.logger.info("TODO: setVisible")};this.setCursor=function(d){for(var g=0,m=e.length;g<m;g++)e[g]&&e[g].setCursor(d)};this.hide=function(d){d=0;for(var g=e.length;d<g;d++)e[d]&&e[d].hide()};this.execute=function(d,g){for(var m=0,G=e.length;m<G;m++)e[m][d].apply(e[m],g)};this.addWin=function(d){var g=this.getFocused();g||(svGlobal.logger.warn("Focused surface not found!"),g=e[e.length-1]);g?(Va=!0,g.railWin||(g.railWin=new c,g.onunload=
function(){hi5.appcfg.closeRemoteApp&&g.railWin&&g.railWin.close();g.remoteApp&&g.remoteApp.close();g.railWin&&(g.railWin.clear(),g.railWin=null);e.removeElm(g)}),g.context&&b.setContext(g.context),g.railWin.addWin(d),g.railWin.mainWin==d&&(setTimeout(function(){var m=g.getFreeSpace();a.writeRawInput("8C661441\t"+m.width+"\t"+m.height);svGlobal.logger.info("-- main win dp change:"+m.height);3==a.windowState?d.resizable()&&setTimeout(function(){d.exeCommand(61488);svGlobal.logger.info("-- max")},50):
5==a.windowState&&3==d.showState&&setTimeout(function(){d.exeCommand(3856);svGlobal.logger.info("-- restor")},50)},111),Qa.sendKeyboardSyncFlags(Qa.localLockFlags,500)),hi5.browser.isIE&&g.focus()):svGlobal.logger.warn("No surface available!")};this.delWin=function(d){for(var g,m=e.length-1;0<=m;m--){var G=e[m];g=G.railWin;var z=g.getWinById(d),D=z&&z.appId&&-1!=z.appId.toLowerCase().indexOf("runonce");if(0<=g.delWin(d)){z==g.mainWin&&(g.mainWin=null);if(G.toolbar){d="win"+d;var H=G.toolbar.querySelector("#"+
d);H&&G.toolbar.removeChild(H)}if(!g.isRunning()&&0==p.mode){if(z.isMainWin()&&G.onremoteappclose)G.onremoteappclose(z);z=a.appTimeout;if(D||g.isNew())z*=10;svGlobal.logger.debug("Prepare del:"+Date.now());setTimeout(function(u){return function(){svGlobal.logger.info("Start del:"+Date.now());u.railWin&&u.railWin.isRunning()||(u.remoteApp&&u.remoteApp.close(),da&&da.delSurface(u))}}(G),z)}}}};this.popWins=function(d){return e[0]&&e[0].railWin?e[0].railWin.popWins(d):[]};this.getWinById=function(d){for(var g,
m=0,G=e.length;m<G;m++)if(e[m]&&e[m].railWin&&(g=e[m].railWin.getWinById(d)))return g;return null};this.getMainWinByAppId=function(d){for(var g,m=0,G=e.length;m<G;m++)if(e[m].railWin&&(g=e[m].railWin.getMainWinByAppId(d)))return g;return null};this.onWinChange=function(d){for(var g,m=0,G=e.length;m<G;m++)if(e[m].railWin&&(g=e[m].railWin.getWinById(d.id)))e[m].railWin.onchange(d)};this.setTitle=function(d){for(var g,m=0,G=e.length;m<G;m++)if(e[m].railWin){g=e[m].railWin.getWinById(d);var z=e[m].railWin.getFullTitle(d);
if(z){a.changeTitle(z,e[m].getWindow(),g.appId);break}}};this.hasApp=function(d){for(var g=0,m=e.length;g<m;g++)if(e[g].railWin.hasApp(d))return!0;return!1};this.delSurface=function(d){!d||d.railWin&&d.railWin.isRunning()||(svGlobal.logger.info("delete surface..."),e.removeElm(d),d.close(),0==e.length&&a._unload())};this.getOwnerSurface=function(d){for(var g=0,m=e.length;g<m;g++)if(e[g].railWin&&e[g].railWin.hasWin(d))return e[g];return null};this.getOwnerSurfaceById=function(d){for(var g,m=0,G=e.length;m<
G;m++)if(e[m].railWin&&(g=e[m].railWin.getWinById(d)))return e[m];return null};this.getFocused=function(){for(var d=e.length,g=0;g<d;g++)if(e[g].focused)return e[g];return e[d-1]};this.close=function(){for(var d=0,g=e.length;d<g;d++)e[d]&&(e[d].remoteApp&&e[d].remoteApp.close(),e[d].close(),e[d]=null)};this.LocalWin=function(d){function g(){a.writeRawInput("8C0"+d)}this.id=d;this.appId="";var m=this;this.resizable=function(){return m.isVisible?0!=(m.style&262144)||0!=(m.style&65536)||0!=(m.style&
16777216)||3==m.showState:!1};this.setShowState=function(G){m.showState=G};this.parent=function(){return da.getWinById(m.ownerWinid)};this.resize=function(G,z,D,H){svGlobal.logger.info("www resize, l "+G+" w "+D);hi5.appcfg.disableJoinedAppResize&&2==a.mode||a.writeRawInput("8C1"+m.id+"\t"+G+"\t"+z+"\t"+D+"\t"+H)};this.exeCommand=function(G){svGlobal.logger.info("www exeCommand, cmd "+G);a.writeRawInput("8C4"+d+"\t"+G)};this.activate=function(G){svGlobal.logger.info("www activate, enable "+G+" id:"+
d);2==m.showState?(m.exeCommand(61728),setTimeout(function(){a.writeRawInput("8C3"+d+"\t"+G)},50)):a.writeRawInput("8C3"+d+"\t"+G)};this.close=function(){svGlobal.logger.info("www close");m.exeCommand(61536)};this.getAppId=g;this.isVisible=function(){return m.winWidth&&m.winHeight&&m.showState&&45<m.winHeight&&45<m.winWidth};this.isMainWin=function(){if(!(m.isVisible()&&m.winWidth&&m.winHeight&&45<m.winHeight&&45<m.winWidth))return!1;var G=1>m.ownerWinid;if(!G)return G;var z=m.style;if(0!=(z&4194304))return!0;
if(0!=(z&2147483648)&&(0==(z&8388608)||0==(z&12582912)))return!1;var D=0!=(m.extStyle&128);(G=G&&!D)&&0!=(z&2147483648)&&0==(z&2156396544)&&(G=!1);return G};g()}}(p,na);this.getSurfaces=function(){return da};this.hide=function(){da&&da.hide()};this.getFileUrl=function(a,b,c){var e=sa(),d=Wc,g=d.indexOf("://");e=(0<g&&11>g?d:e+d)+"s="+mc+"&f="+encodeURIComponent(a);b&&(e+="&src="+b);c&&(e+="&action="+c);return p.modifyURL(e)};this.listFiles=function(a,b){Ma&&Wa&&Ma.list(a,b)};this.writeRawInput=function(a){if(Wa){ra(a);
if(p.onactivity)p.onactivity(a);return!0}return!1};this.authWithCode=function(a,b){var c=a.length,e=new Uint8Array(5+c);e[0]=146;e[1]=7;e[2]=b;e[3]=c&255;e[4]=c>>8&255;for(b=0;b<c;b++)e[5+b]=a.charCodeAt(b);ra(e.buffer)};var Yc=0;if(ea.numLock||ea.numlock||T(N.numLock)||hi5.browser.isMacOS||hi5.browser.isiOS||hi5.browser.isCrOS)Yc|=2;var Qa=new function(a,b){this.setJoinMode=a.setJoinMode;this.requestControl=a.requestControl;this.writeKeyComb=a.writeKeyComb;this.writeText=a.writeText;this.localLockFlags=
b||0;this.remoteLockFlags=0;this.checkLockFlags=!0;this.reqCopyTime=0;a.isRemoteApp();var c=void 0,e=a.getSurfaces();this.saveResize=function(d){c=a.reconnectOnResize;a.reconnectOnResize=d};this.restoreResize=function(){void 0!=c&&(a.reconnectOnResize=c)};this.getAppMode=function(){return a.mode};this.getAgentStatus=function(){return a.getAgentStatus()};this.send=a.writeRawInput;this.saveSession=function(d){a.saveSession(d)};this.sendInput=a.writeRawInput;this.getAppInfo=function(){return a.sessionInfo.appInfo};
this.resumePlay=function(){Ta.supportWebAudio&&Ta.iOSFix()};this.onresize=function(d){if((d=d.target.svSurface)&&!document.hidden){var g=d.getFreeSpace(),m=g.width;g=g.height;Qa.checkLockFlags=!0;ea.scale?d.scaleTo(m,g,!1):a.resetSize(m,g)}};this.onorientationchange=function(d){a.resetSize(d.innerWidth,d.innerHeight)};this.getClipData=function(d,g){this.reqCopyTime=Date.now();var m=a.getGatewayAddr(),G=Xc,z=G.indexOf("://");m=(0<z&&11>z?G:m+G)+"s="+a.sessionInfo.appInfo.session+"&t="+Date.now()+"&type="+
d;d=hi5.httpGet(a.modifyURL(m),g);this.reqCopyTime=Date.now();Qc(d);return d};this.getShareFiles=a.listFiles;this.getFile=function(d,g,m){a.reconnectOnResize=!1;var G=a.getFileUrl(d,g,m);p.ondownload&&p.ondownload({fileName:d,url:G,source:g,action:m})||window.open(G)};this.getFileLink=a.getFileUrl;this.getGateway=function(){return n};this.reconnect=function(d,g,m){N.symlink?(d="user="+d+"&pwd="+g,m&&(d+="&domain="+m),n=hi5.tool.replaceQuery(n,"parameters",d)):(n=hi5.tool.replaceQuery(n,"user",d),
n=hi5.tool.replaceQuery(n,"pwd",g),n=hi5.tool.replaceQuery(n,"domain",m));a.run()};this.sendKeyboardSyncFlags=function(d,g){return Wa?(this.remoteLockFlags=this.localLockFlags=d,setTimeout(function(){a.writeRawInput("8E5"+d)},g||333),!0):!1};this.sendKeyboardSynchronize=function(d,g,m){var G=0;m&&(G|=4);g&&(G|=2);d&&(G|=1);this.sendKeyboardSyncFlags(G)};this.fromSyncedSurface=function(d){return e.fromSyncedSurface(d)};this.setWorkDir=function(d){a.writeKeyComb("Windows+R",20,function(){setTimeout(function(){a.writeText(d,
10,function(){a.writeScancode(!0,28);a.writeScancode(!1,28)})},666)})};this.authWithCode=function(d,g){a.authWithCode(d,g)};this.getPrinters=function(d){a.getPrinters(d)};this.attachPrinter=function(d){a.attachPrinter(d)}}(p,Yc),Pd=new function(a,b){this.draw=a.draw;this.refresh=function(c,e,d,g){return a.repaint(c,e,d-c+1,g-e+1)};this.onfocus=function(c){var e=b.getFocused();Va&&e&&e.railWin&&(c=e.railWin.mainWin)&&_core.running()&&(e=e.context)&&e!=a.getContext()&&(a.setContext(null),c.activate(1),
svGlobal.logger.info("Activate win:"+c.id))}}(na,da);this.sendKeyboardSynchronize=function(a,b,c){Qa.sendKeyboardSynchronize(a,b,c)};this.VirtualChannel=function(){return new ob(143)};this.GatewayChannel=function(){return new ob(28)};this.DynamicChannel=function(){return new ob(64)};this.addChannel=function(a){lb[a.name]=a};this.addGatewayChannel=function(a){jb[a.name]=a};this.addDynamicChannel=function(a){Ea.names.push(a.name);Ea[a.name]=a;Ea.count++};var Ra=null,Ea={count:0,names:[],usbChannel:null,
close:function(){for(var a=Ea.names,b=0,c=a.length;b<c;b++)Ea[a[b]].onclose&&(Ea[a[b]].onclose(),Ea[a[b]]=null);a.length=0;Ea.usbChannel=null},init:function(a,b,c,e,d,g){function m(){this.WAVE_FORMAT_PCM=1;this.WAVE_FORMAT_ADPCM=2;this.WAVE_FORMAT_ALAW=6;this.WAVE_FORMAT_MULAW=7;this.WAVE_FORMAT_GSM=49;this.WAVE_FORMAT_MPEGLAYER3=85;this.WAVE_FORMAT_AAC=41222;this.cbSize=this.bitsPerSample=this.nBlockAlign=this.nAvgBytesPerSec=this.nSamplesPerSec=this.nChannels=this.formatTag=0;this.extenstion=null;
var q=this;this.fromBuffer=function(y,B){q.formatTag=y.getLittleEndian16();q.nChannels=y.getLittleEndian16();q.nSamplesPerSec=y.getLittleEndian32();q.nAvgBytesPerSec=y.getLittleEndian32();q.nBlockAlign=y.getLittleEndian16();q.bitsPerSample=y.getLittleEndian16();var t=y.getLittleEndian16();q.cbSize=t;0<t&&!0!==B&&(q.extenstion=Array(t),y.copyToByteArray(q.extenstion,0,y.getPosition(),t),y.skipPosition(t))};this.toBuffer=function(y){y.setLittleEndian16(q.formatTag);y.setLittleEndian16(q.nChannels);
y.setLittleEndian32(q.nSamplesPerSec);y.setLittleEndian32(q.nAvgBytesPerSec);y.setLittleEndian16(q.nBlockAlign);y.setLittleEndian16(q.bitsPerSample);y.setLittleEndian16(q.cbSize);0<q.cbSize&&y.setBytes(q.extenstion)};this.getSize=function(){return 18+q.cbSize};this.toString=function(){return"Audio Format, tag="+q.formatTag+" nChannels="+q.nChannels+" nSamplesPerSec="+q.nSamplesPerSec+" nAvgBytesPerSec="+q.nAvgBytesPerSec+" nBlockAlign="+q.nBlockAlign+" bitsPerSample="+q.bitsPerSample+" cbSize="+q.cbSize}}
function G(){Ra=new p.DynamicChannel;Ra.name="Microsoft::Windows::RDS::DisplayControl";Ra.enabled=!1;Ra.process=function(q){var y=q.getLittleEndian32();q.getLittleEndian32();switch(y){case 5:y=q.getLittleEndian32(),Ra.maxMonitorAreaFactorA=q.getLittleEndian32(),Ra.maxMonitorAreaFactorB=q.getLittleEndian32(),Ra.enabled=!0,svGlobal.logger.warn("Display control maxNumMonitors:"+y+" factorA:"+Ra.maxMonitorAreaFactorA+" factorB:"+Ra.maxMonitorAreaFactorB),q=new Uint8Array(2),q[0]=146,q[1]=4,ra(q.buffer),
Pa&&setTimeout(function(){Pa&&Pa.check(5E3)},1900)}};Ra.applyResolution=function(q,y){if(Ra.enabled){var B=new Uint8Array(56),t=new RdpBuffer(B,0,56);q=q>Ra.maxMonitorAreaFactorA?Ra.maxMonitorAreaFactorA:q&-4;y=y>Ra.maxMonitorAreaFactorB?Ra.maxMonitorAreaFactorB:y&-4;t.setLittleEndian32(2);t.setLittleEndian32(56);t.setLittleEndian32(40);t.setLittleEndian32(1);t.setLittleEndian32(1);t.setLittleEndian32(0);t.setLittleEndian32(0);t.setLittleEndian32(q);t.setLittleEndian32(y);t.setLittleEndian32(.26458*
q|0);t.setLittleEndian32(.26458*y|0);t.setLittleEndian32(q>y?0:90);t.setLittleEndian32(100);t.setLittleEndian32(100);Ra.send(B);svGlobal.logger.warn("Display control: "+q+"x"+y)}else svGlobal.logger.warn("Display control disabled.")};return Ra}if(!ea.disableDVC){if(ea.enableEcho){var z=new p.DynamicChannel;z.name="ECHO";z.process=function(q){var y=q.getPosition(),B=q.getEnd(),t=new Uint8Array(B-y);t.set(q.getData().subarray(y,B));z.send(t)};p.addDynamicChannel(z)}if(a){var D=new p.DynamicChannel;
D.name="Microsoft::Windows::RDS::Input";D.process=function(q){var y=q.getLittleEndian16();q.getLittleEndian32();switch(y){case 1:q.skipPosition(4),q=new RdpBuffer(new Uint8Array(16),0,16),q.setLittleEndian16(2),q.setLittleEndian32(16),q.setLittleEndian32(3),q.setLittleEndian32(65536),q.setLittleEndian16(256),q.markEnd(),D.send(q);case 5:da.execute("setTouchRemoting",[!0]);Ea.isTouchReady=!0;svGlobal.logger.info("Touch remoting start");break;case 4:da.execute("setTouchRemoting",[!1]),Ea.isTouchReady=
!1,svGlobal.logger.info("Touch remoting suspend")}};p.addDynamicChannel(D)}if(c){svGlobal.logger.warn("Audio input on");var H=new p.DynamicChannel;(function(){function q(M){var aa=new RdpBuffer(new Uint8Array(5),0,5);aa.setByte(7);aa.setLittleEndian32(M);aa.markEnd();H.send(aa)}function y(M){var aa=M.getLittleEndian32(),ja=M.getLittleEndian32(),pa=new m;pa.fromBuffer(M,!0);var X=0,va=0;0<pa.cbSize&&(22==pa.cbSize?(X=M.getLittleEndian16(),va=M.getLittleEndian32(),M.skipPosition(16)):(svGlobal.logger.warn("Wrong cbsize: "+
pa.cbSize),M.skipPosition(pa.cbSize)));M=t[ja];svGlobal.logger.info("Selceted rec fmt, framesPerPacket: "+aa+" initial: "+ja+", "+M.toString());svGlobal.logger.info("Open fmt: "+pa.toString()+" validBits:"+X+" mask:"+va);R=!0;U=p.reconnectOnResize;p.reconnectOnResize=!1;Z.onopen||(Z.onopen=function(xa){if(Ha){B=xa;p.reconnectOnResize=U;q(ja);var ua=new RdpBuffer(new Uint8Array(5),0,5);ua.setByte(4);ua.setLittleEndian32(xa?0:1);ua.markEnd();H.send(ua)}});Z.ondata||(Z.ondata=function(xa,ua){B&&(w.length!=
ua+1&&(w=new Uint8Array(ua+1),w[0]=6),H.send(L),w.set(xa,1),H.send(w))});Z.start(M,aa)}H.name="AUDIO_INPUT";H.process=function(M){var aa=M.getByte();switch(aa){case 1:M=M.getLittleEndian32();aa=new RdpBuffer(new Uint8Array(5),0,5);aa.setByte(1);aa.setLittleEndian32(M);aa.markEnd();H.send(aa);break;case 2:var ja=M.getLittleEndian32();M.getLittleEndian32();var pa=hi5.audio.getAudioContext().sampleRate;for(aa=t.length=0;aa<ja;aa++){var X=new m;X.fromBuffer(M);svGlobal.logger.info("Server rec fmt "+aa+
":"+X.toString());0==e&&49==X.formatTag&&22050==X.nSamplesPerSec?t.push(X):1==X.formatTag&&X.nSamplesPerSec<=pa&&t.push(X)}H.send(L);ja=0;M=t.length;for(aa=0;aa<M;aa++)ja+=t[aa].getSize();pa=new RdpBuffer(new Uint8Array(1024),0,1024);pa.setByte(2);pa.setLittleEndian32(M);pa.setLittleEndian32(ja+9);for(aa=0;aa<M;aa++)t[aa].toBuffer(pa),svGlobal.logger.info("Client rec fmt: "+t[aa].toString());pa.skipPosition(1024-ja-9);pa.markEnd();H.send(pa);break;case 3:y(M);break;case 7:aa=M.getLittleEndian32();
svGlobal.logger.info("Rec fmt change, "+t[aa].toString()+" by client:"+R);R||(q(aa),R=!1);break;default:svGlobal.logger.warn("audioInput: invalid tag:"+aa)}};var B=!1,t=[];H.onclose=function(){B=!1;Z&&Z.close()};var L=new Uint8Array(1);L[0]=5;var R=!1,U=p.reconnectOnResize,w=new Uint8Array(0),Q=oa("audiorecorder",hi5.libMin?"audiorecorder_min.js?v=0":"audiorecorder.js?v=0"),Z=window.AudioWorkletNode?new hi5.audio.WorkletRecorder(hi5.audio.getAudioContext(),Q):new hi5.audio.Recorder(hi5.audio.getAudioContext())})();
p.addDynamicChannel(H)}p.addDynamicChannel(function(){var q=new p.DynamicChannel;q.name="TSMF";var y={type:"image/jpeg"},B=Array(1);q.process=function(t){t.getPosition();var L=t.getLittleEndian32()&1073741823;var R=t.getLittleEndian32();var U=t.getLittleEndian32();switch(L){case 2:if(256==U){t.getLittleEndian32();U=new Uint8Array(16);var w=new RdpBuffer(U,0,16);w.setLittleEndian32(2);w.setLittleEndian32(R);w.setLittleEndian32(1);w.setLittleEndian32(0);q.send(U)}break;case 0:switch(U){case 257:t.getBytes(16);
t.getLittleEndian32();break;case 256:L=t.getPosition();w=t.getLittleEndian32();for(U=0;U<w;U++){t.getLittleEndian32();var Q=t.getLittleEndian32();t.getLittleEndian32();t.skipPosition(Q-4)}U=t.getPosition()-L;w=U+8+4;U=new Uint8Array(w);w=new RdpBuffer(U,0,w);w.setLittleEndian32(-2147483648);w.setLittleEndian32(R);U.set(t.getData().subarray(L,t.getPosition()),8);q.send(U);break;case 261:t.getBytes(16);t.getLittleEndian32();break;case 264:L=t.getLittleEndian32();t.skipPosition(4);t.getLittleEndian32();
Q=t.getBytes(16);var Z=t.getBytes(16);t.getLittleEndian32();t.getLittleEndian32();t.getLittleEndian32();var M=t.getBytes(16);U=t.getLittleEndian32();t.skipPosition(U);U=new Uint8Array(20);w=new RdpBuffer(U,0,20);w.setLittleEndian32(-2147483648);w.setLittleEndian32(R);hi5.Arrays.equals([118,105,100,115,0,0,16,0,128,0,0,170,0,56,155,113],Q)&&hi5.Arrays.equals([77,74,80,71,0,0,16,0,128,0,0,170,0,56,155,113],Z)&&hi5.Arrays.equals([128,159,88,5,86,195,206,17,191,1,0,170,0,85,89,90],M)?w.setLittleEndian32(1):
(w.setLittleEndian32(0),svGlobal.logger.warn("Format is not supported:"),svGlobal.logger.warn(Q),svGlobal.logger.warn(Z),svGlobal.logger.warn(M));w.setLittleEndian32(L);q.send(U);break;case 258:t.getBytes(16);t.getLittleEndian32();L=t.getLittleEndian32();t.skipPosition(L);break;case 263:t.getBytes(16),U=new Uint8Array(16),w=new RdpBuffer(U,0,16),w.setLittleEndian32(-2147483648),w.setLittleEndian32(R),w.setLittleEndian32(1),q.send(U);case 277:t.getBytes(16);t.getLittleEndian32();break;case 262:t.getBytes(16);
na.flushImgs();na.setImgRect(0,0,0,0);U=new Uint8Array(12);w=new RdpBuffer(U,0,12);w.setLittleEndian32(-2147483648);w.setLittleEndian32(R);q.send(U);break;case 278:t.getBytes(16);R=t.getLittleEndian32();U=t.getLittleEndian32();L=t.getLittleEndian32();t=t.getLittleEndian32();na.setImgRect(R,U,L-R,t-U);break;case 265:t.getBytes(16);t.getLittleEndian64();t.getLittleEndian32();break;case 266:t.getBytes(16);break;case 268:t.getBytes(16);break;case 267:t.getBytes(16);break;case 269:t.getBytes(16);t.getLittleEndian32();
break;case 274:break;case 275:break;case 259:t.getBytes(16);t.getLittleEndian32();t.getLittleEndian32();t.skipPosition(32);U=t.getLittleEndian32();R=new Image;L=t.getPosition();B[0]=t.getData().subarray(L,L+U);t=new Blob(B,y);R.src=URL.createObjectURL(t);na.addImg(R);break;case 270:na.flushImgs();break;case 273:break;case 260:break;case 276:t.getBytes(16);U=t.getLittleEndian32();L=t.getPosition()+U;t.skipPosition(8);R=t.getLittleEndian32();svGlobal.logger.info("window state:"+R);w=t.getLittleEndian32();
Q=t.getLittleEndian32();R=t.getLittleEndian32();U=t.getLittleEndian32();t.skipPosition(8);Z=t.getLittleEndian32();M=t.getLittleEndian32();svGlobal.logger.info("Window rect, left:"+R+" top:"+U+" w:"+w+" h:"+Q+" cl:"+Z+" ct:"+M);t.setPosition(L);L=t.getLittleEndian32();for(L=t.getPosition()+L;t.getPosition()<L;){Z=t.getLittleEndian32();M=t.getLittleEndian32();var aa=t.getLittleEndian32(),ja=t.getLittleEndian32();svGlobal.logger.info("visible region, l:"+M+" t:"+Z+" r:"+ja+" b:"+aa)}na.setImgRect(R,
U,w,Q);break;case 1:case 2:break;default:svGlobal.logger.warn("unknown function:"+U)}break;default:svGlobal.logger.warn("unkown interface:"+L)}};return q}());kb||p.addDynamicChannel(G());ea.enableDVCAudio&&p.addDynamicChannel(function(q){var y=!1,B=0,t=0,L=0,R=0,U=[],w=new Uint8Array(4),Q=new p.DynamicChannel;Q.name="AUDIO_PLAYBACK_DVC";Q.onclose=function(){};Q.process=function(Z){function M(fa){fa.skipPosition(14);var ia=fa.getLittleEndian16();fa.getByte();var qa=fa.getLittleEndian16();fa.skipPosition(1);
for(var Ka,f=U.length=0;f<ia;f++){var k=new m;k.fromBuffer(fa);(Ka=22050<=k.nSamplesPerSec&&(1==k.formatTag||49==k.formatTag&&22050==k.nSamplesPerSec&&0==q||41222==k.formatTag))&&U.push(k)}k=20;fa=U.length;for(f=0;f<fa;f++)k+=U[f].getSize();f=k+4;ia=new RdpBuffer(new Uint8Array(f),0,f);ia.setByte(7);ia.setByte(2);ia.setLittleEndian16(k);ia.setLittleEndian32(3);ia.setLittleEndian32(4294967295);ia.setLittleEndian32(0);ia.setLittleEndian16(0);ia.setLittleEndian16(fa);ia.skipPosition(1);ia.setLittleEndian16(qa);
ia.setByte(124);for(f=0;f<fa;f++)k=U[f],k.toBuffer(ia);ia.markEnd();Q.send(ia);5<qa&&(ia=new RdpBuffer(new Uint8Array(8),0,8),ia.setByte(12),ia.skipPosition(1),ia.setLittleEndian16(4),ia.setLittleEndian16(0),ia.setLittleEndian16(0),ia.markEnd(),Q.send(ia))}function aa(fa){var ia=fa.getLittleEndian16();fa=fa.getLittleEndian16();var qa=new RdpBuffer(new Uint8Array(8),0,8);qa.setByte(6);qa.setByte(35);qa.setLittleEndian16(4);qa.setLittleEndian16(ia);qa.setLittleEndian16(fa);qa.markEnd();Q.send(qa)}function ja(){var fa=
U[L];if(fa.formatTag!=Da.tag||fa.nSamplesPerSec!=Da.samplePerSec||Da.channels!=fa.nChannels)Da.tag=fa.formatTag,Da.channels=fa.nChannels,Da.samplePerSec=fa.nSamplesPerSec,Da.bitsPerSample=49==fa.formatTag?8:fa.bitsPerSample,svGlobal.logger.info("DVC Audio Format, tag="+Da.tag+" channels="+Da.channels+" bitsPerSample="+Da.bitsPerSample+" samplePerSec="+Da.samplePerSec),41222==Da.tag&&(Da.sampleRate=Da.samplePerSec,Ta.initMediaPlayer(Ta,Da,!0))}function pa(fa){t=fa.getLittleEndian16();L=fa.getLittleEndian16();
R=fa.getByte();fa.skipPosition(3);w.set(fa.getSubarray(4));y=!0;ja()}function X(fa,ia){var qa=new RdpBuffer(new Uint8Array(8),0,8);qa.setByte(5);qa.skipPosition(1);qa.setLittleEndian16(4);qa.setLittleEndian16(fa);qa.setByte(ia);qa.skipPosition(1);qa.markEnd();Q.send(qa)}function va(fa){y=!1;var ia=B-8,qa=Date.now();fa.copyFromByteArray(w,0,fa.getPosition(),4);kc(fa,R,t,ia);fa=t+(Date.now()-qa);X(fa,R)}function xa(fa){var ia=Date.now();t=fa.getLittleEndian16();L=fa.getLittleEndian16();R=fa.getByte();
fa.skipPosition(7);ja();fa=kc(fa,R,t,0);fa*=1E3;ia=t+(Date.now()-ia)+fa;X(ia,R)}if(y)va(Z);else{var ua=Z.getByte();Z.skipPosition(1);B=Z.getLittleEndian16();switch(ua){case 7:M(Z);break;case 6:aa(Z);break;case 2:pa(Z);break;case 3:Z.getLittleEndian16();Z.getLittleEndian16();break;case 13:xa(Z)}}};return Q}(e));svGlobal.DCVC_EXTENSION||(svGlobal.DCVC_EXTENSION={});var u=svGlobal.DCVC_EXTENSION;u.videoMedia={video:null,track:null,canvas:null,ctx:null,resolutions:null,minFrameRate:16,type:2,activate:function(q,
y){svGlobal.logger.info("activate webcam");u.videoMedia.resolutions?q():hi5.video.resolutions(function(B){B.length?(u.videoMedia.resolutions=B,q()):y()})},deactivate:function(){var q=u.videoMedia;q.track&&(q.track.stop(),q.track=null);q.ctx=null;q.canvas=null;q.video=null;svGlobal.logger.info("deactivate cam")},startStream:function(q,y,B,t,L){svGlobal.logger.info("startStream, width:"+q+" height:"+y+" frameRate:"+B);var R=u.videoMedia,U=R.track;if(U){var w=U.getSettings();if("live"==U.readyState)if(q!=
w.width||y!=w.height||B!=w.frameRate&&2!=R.type)U.stop();else return}navigator.mediaDevices.getUserMedia({video:{frameRate:2==R.type?R.minFrameRate:B,width:{exact:q},height:{exact:y}}}).then(function(Q){var Z=document.createElement("video");Z.srcObject=Q;Z.play();if(window.OffscreenCanvas)var M=new OffscreenCanvas(100,100);else M=document.createElement("canvas"),M.style.position="absolute",M.style.left=0,M.style.top=0;R.track=Q.getVideoTracks()[0];R.canvas=M;R.ctx=M.getContext("2d");R.video=Z;Q=R.track.getSettings();
R.canvas.width=Q.width;R.canvas.height=Q.height;t()}).catch(function(Q){svGlobal.logger.warn(Q);L()})},stopStream:function(){svGlobal.logger.info("stopStream");var q=u.videoMedia;q.track&&"live"==q.track.readyState&&q.track.stop()},grabFrame:function(q){function y(t){t.arrayBuffer().then(q)}var B=u.videoMedia;B.ctx.drawImage(B.video,0,0);B=B.canvas;B.convertToBlob?B.convertToBlob({type:"image/jpeg",quality:.6}).then(y):B.toBlob(y,"image/jpeg",.6)},propertyList:[[{propertyId:1,capabilities:3,min:4294967286,
max:4294967294,step:1,default:4294967291},null,{propertyId:3,capabilities:1,min:4294967280,max:16,step:1,default:0},{propertyId:4,capabilities:1,min:0,max:3,step:1,default:0},{propertyId:5,capabilities:1,min:4294967280,max:16,step:1,default:0},{propertyId:6,capabilities:1,min:100,max:400,step:10,default:100}],[{propertyId:1,capabilities:1,min:0,max:2,step:1,default:1},{propertyId:2,capabilities:1,min:4294967232,max:64,step:1,default:0},{propertyId:3,capabilities:1,min:0,max:95,step:1,default:0},{propertyId:4,
capabilities:1,min:4294965296,max:2E3,step:1,default:0},{propertyId:5,capabilities:3,min:2800,max:6500,step:1,default:4600}]]};u.WEBAUTHN=function(q){var y=new q;y.name="WebAuthN_Channel";y.newInstance=function(){return u.WEBAUTHN(q)};y.onopen=function(){svGlobal.logger.info("webAuthn open")};y.onclose=function(){svGlobal.logger.info("webAuthn close")};y.process=function(B){var t=B.getEnd()-B.getPosition();B=B.getBytes(t);var L=Gb(B),R=L.command;t=L.flags;B=L.timeout;var U=L.webAuthNPara;if(R)switch(console.log("==== command: "+
L.command),R){case 5:if(L.request)switch(R=L.request[0],console.log("==== webAuth cmdType = "+R),console.log("==== webAuth request bytes: "+sb(L.request.slice(1,L.request.length))),R){case 1:L=L.request.slice(1,L.request.length);var w=Gb(L);L=w[1];var Q=w[2],Z=w[3],M=w[4],aa=w[5];R=w[6];var ja=w[7];w={};var pa=vd(U);pa&&(pa.attestation&&(w.attestation=pa.attestation),pa.attestationFormats&&(w.attestationFormats=pa.attestationFormats));if(t=ud(t,U,ja))w.authenticatorSelection=t;w.challenge=L;aa&&(w.excludeCredentials=
Cc(aa));R&&(w.extensions=R);M&&(w.pubKeyCredParams=M);w.rp={id:window.location.hostname,name:"RS_Gateway"};B&&(w.timeout=B);w.user=Z;B={};B.signal=createNewAbortWebAuthnSignal();B.publicKey=w;navigator.credentials.create(B).then(function(X){wd(X.response,Q).then(function(va){var xa={},ua={maxMsgSize:1200,maxSerializedLargeBlobArray:0,providerType:"Hid",providerName:"MicrosoftCtapHidProvider",devicePath:"\\\\?\\hid#vid_1050&pid_0407&mi_01#7&1dd131cc&0&0000#{4d1e55b2-f16f-11cf-88cb-001111000030}"},
fa=new Uint8Array([159,87,192,47,19,129,234,71,177,22,187,90,141,185,32,42]);ua.aaGuid=fa.buffer;ua.residentKey=!0;xa.deviceInfo=ua;xa.status=0;xa.response=va;va=CBOR.encode(xa);xa=new hi5.DataBuffer(new Uint8Array(4+va.byteLength));xa.setLittleEndian32(0);xa.setBytes(va);xa.markEnd();y.send(xa)})}).catch(function(X){console.log("WebAuthN MakeCredential failed with error code ["+X.code+"], msg: "+X.message);X=new hi5.DataBuffer(new Uint8Array(4));X.setLittleEndian32(1);X.markEnd();y.send(X)});break;
case 2:L=L.request.slice(1,L.request.length);w=Gb(L);L=w[2];Z=w[3];R=w[4];ja=w[5];w={};Z&&(w.allowCredentials=Cc(Z));w.challenge=L;R&&(w.extensions=R);w.rp=window.location.hostname;B&&(w.timeout=B);if(B=Bc(t,U,ja))w.userVerification=B;B={};B.signal=createNewAbortWebAuthnSignal();B.publicKey=w;navigator.credentials.get(B).then(function(X){X=new hi5.DataBuffer(new Uint8Array(void 0));X.markEnd();y.send(X)}).catch(function(X){console.log("WebAuthN GetAssertion failed with error code ["+X.code+"], msg: "+
X.message);X=new hi5.DataBuffer(new Uint8Array(4));X.setLittleEndian32(1);X.markEnd();y.send(X)});break;default:svGlobal.logger.error("Unknown WebAuthn command type: "+R)}else svGlobal.logger.error("Incorrect request content in WEB AUTH COMMAND");break;case 6:B=new hi5.DataBuffer(new Uint8Array(8));B.setLittleEndian32(0);t=Ac()?PublicKeyCredential.isUserVerifyingPlatformAuthenticatorAvailable():!1;t?B.setLittleEndian32(1):B.setLittleEndian32(0);B.markEnd();y.send(B);break;case 7:cancelWebAuthnOperations();
B=new hi5.DataBuffer(new Uint8Array(4));B.setLittleEndian32(0);B.markEnd();y.send(B);break;case 8:B=new hi5.DataBuffer(new Uint8Array(8));B.setLittleEndian32(0);B.setLittleEndian32(4);B.markEnd();y.send(B);break;default:svGlobal.logger.warn("Unknown command received in WebAuthN Channel: "+R)}else svGlobal.logger.warn("WebAuthN Channel, command missed")};return y};p.enableWebAuthn()&&Ac()&&(a=u.WEBAUTHN(p.DynamicChannel),p.addDynamicChannel(a));u.WEBCAM=function(q){var y=new q;y.name="RDCamera_Device_0";
y.version=2;y.newInstance=function(){return u.WEBCAM(q)};y.onopen=function(){svGlobal.logger.info("cam open")};y.onclose=function(){svGlobal.logger.info("cam close")};y.sendSucess=function(){var B=new hi5.DataBuffer(new Uint8Array(2));B.setByte(y.version);B.setByte(1);B.markEnd();y.send(B)};y.sendError=function(B){var t=new hi5.DataBuffer(new Uint8Array(6));t.setByte(y.version);t.setByte(2);t.setLittleEndian32(B||1);t.markEnd();y.send(t)};y.sendSteamListResp=function(){var B=new hi5.DataBuffer(new Uint8Array(7));
B.setByte(y.version);B.setByte(10);B.setLittleEndian16(1);B.setByte(1);B.setByte(1);B.setByte(0);B.markEnd();y.send(B)};y.sendMediaTypeListResp=function(B){var t=u.videoMedia.resolutions,L=t.length,R=new hi5.DataBuffer(new Uint8Array(2+26*L));R.setByte(y.version);R.setByte(12);for(var U=1==B,w=0;w<L;w++){R.setByte(B);var Q=t[w];R.setLittleEndian32(Q.width);R.setLittleEndian32(Q.height);R.setLittleEndian32(U?Q.frameRate:u.videoMedia.minFrameRate);R.setLittleEndian32(1);R.setLittleEndian32(1);R.setLittleEndian32(1);
R.setByte(1)}R.markEnd();y.send(R)};y.sendCurrentMediaType=function(B,t){var L=new hi5.DataBuffer(new Uint8Array(28));L.setByte(y.version);L.setByte(14);t=u.videoMedia.resolutions[t];L.setByte(B);L.setLittleEndian32(t.width);L.setLittleEndian32(t.height);L.setLittleEndian32(1==B?t.frameRate:u.videoMedia.minFrameRate);L.setLittleEndian32(1);L.setLittleEndian32(1);L.setLittleEndian32(1);L.setByte(1);L.markEnd();y.send(L)};y.sendSampleResp=function(B){u.videoMedia.grabFrame(function(t){var L=new hi5.DataBuffer(new Uint8Array(t.byteLength+
3));L.setByte(y.version);L.setByte(18);L.setByte(B);L.setBytes(new Uint8Array(t));L.markEnd();y.send(L)})};y.sendPropertyListResp=function(){for(var B=0,t,L,R=u.videoMedia.propertyList,U=0;2>U;U++){L=R[U];t=L.length;for(var w=0;w<t;w++)null!=L[w]&&B++}var Q=new hi5.DataBuffer(new Uint8Array(2+19*B));Q.setByte(y.version);Q.setByte(21);for(U=0;2>U;U++)for(L=R[U],t=L.length,w=0;w<t;w++)B=L[w],null!=B&&(Q.setByte(U+0),Q.setByte(B.propertyId),Q.setByte(B.capabilities),Q.setLittleEndian32(B.min),Q.setLittleEndian32(B.max),
Q.setLittleEndian32(B.step),Q.setLittleEndian32(B.default));Q.markEnd();y.send(Q)};y.sendPropertyValueResp=function(B,t){(B=u.videoMedia.propertyList[B][t-1])?(t=new hi5.DataBuffer(new Uint8Array(7)),t.setByte(y.version),t.setByte(23),t.setByte(1),t.setLittleEndian32(B.value||B.default),t.markEnd(),y.send(t)):y.sendError(8)};y.process=function(B){B.getByte();var t=B.getByte();switch(t){case 7:u.videoMedia.activate(y.sendSucess,y.sendError);break;case 8:u.videoMedia.deactivate();y.sendSucess();break;
case 9:y.sendSteamListResp();break;case 11:B=B.getByte();0!=B&&svGlobal.logger.warn("Invalid stream index: "+B);y.sendMediaTypeListResp(u.videoMedia.type);break;case 13:B=B.getByte();y.sendCurrentMediaType(u.videoMedia.type,B);break;case 15:B.getByte();t=B.getByte();if(t!=u.videoMedia.type){svGlobal.warn("Invalid video format req:"+t);y.sendError(6);break}t=B.getLittleEndian32();var L=B.getLittleEndian32();B=B.getLittleEndian32()/B.getLittleEndian32();u.videoMedia.startStream(t,L,B,y.sendSucess,y.sendError);
break;case 16:u.videoMedia.stopStream();y.sendSucess();break;case 17:B=B.getByte();0!=B&&svGlobal.logger.info("Invalid stream index for SampleRequest: "+B);y.sendSampleResp(B);break;case 20:y.sendPropertyListResp();break;case 22:t=B.getByte();B=B.getByte();y.sendPropertyValueResp(t,B);break;case 24:y.sendError(10);break;default:y.sendError(10),svGlobal.logger.warn("Invalid cam msg: "+t)}};return y};u.WEBCAM_ENUM=function(q,y){var B=new q;B.name="RDCamera_Device_Enumerator";B.onopen=function(){var t=
new hi5.DataBuffer(new Uint8Array(2));t.setByte(y.version);t.setByte(3);t.markEnd();B.send(t);svGlobal.logger.info("camEnum open")};B.onclose=function(){svGlobal.logger.info("camEnum closed");u.videoMedia.deactivate()};B.addDevice=function(t){t+="\x00";var L=y.name+"\x00",R=new hi5.DataBuffer(new Uint8Array(2+2*t.length+L.length));R.setByte(y.version);R.setByte(5);R.setUnicodeString(t);R.setAscllString(L);R.markEnd();B.send(R)};B.process=function(t){var L=t.getByte();t=t.getByte();switch(t){case 4:svGlobal.logger.info("camEnum ver resp: "+
L);y.version=L;B.addDevice(hi5.video.webcam&&hi5.video.webcam.label||"Web Camera");break;default:svGlobal.logger.warn("invalid messageId on camEnum: "+t)}};return B};d&&(d=u.WEBCAM(p.DynamicChannel),a=u.WEBCAM_ENUM(p.DynamicChannel,d),p.addDynamicChannel(a),p.addDynamicChannel(d));g&&(svGlobal.logger.info("Mapping USB..."),p.addDynamicChannel(Ea.usbChannel));if(b&&u.GFX){var x=function(){O.drawable.resumePlay||(O.drawable.resumePlay=function(){Ta&&Ta.supportWebAudio&&Ta.iOSFix();O.resumeVideo()})},
O=u.GFX(p.DynamicChannel,T(N.remotefx)&&!T(N.gfx),0==p.mode,na,N.hardwareAcceleration);O.onmessage=function(q){p.showMessage(q)};x();O.onuserinteract=function(q){da.execute("showPlay");x();svGlobal.logger.info("resumePlay");return!0};O.onfatalerror=function(q,y){p.reconnect(q.width,q.height,!0)};O.onsps=function(q){q.fps&&p.setFPS(q.fps)};O.onresetgraphic=function(q){p.setResolution(q.width,q.height)};O.onmapsurface=function(q){O.onconfirm();var y=da.getMonitorSurface(q.outputOriginX,q.outputOriginY,
q.targetWidth+q.outputOriginX-1,q.targetHeight+q.outputOriginY-1);y?(y.setId(q.id),y.setSize(q.targetWidth,q.targetHeight)):svGlobal.logger.error("Failed to map surface, x:"+q.outputOriginX+" y:"+q.outputOriginY)};O.onconfirm=function(){svGlobal.logger.info("GFXDrawableController in use");da.execute("setDrawable",[O.drawable])};p.addDynamicChannel(O)}}}},eb=null;svGlobal.DCVC_EXTENSION&&!kb&&(p.hasUSB()&&svGlobal.DCVC_EXTENSION.WEBUSB&&(Ea.usbChannel=svGlobal.DCVC_EXTENSION.WEBUSB(p.DynamicChannel)),
svGlobal.DCVC_EXTENSION.DRIVE&&(eb=svGlobal.DCVC_EXTENSION.DRIVE(p.GatewayChannel),p.addGatewayChannel(eb)));this.getPrinters=function(a){if(!p.onagentmessage||!eb)return null;var b=new hi5.DataBuffer(new Uint8Array(2));b.setByte(6);b.setByte(1);b.markEnd();p.onagentmessage(b.getData());eb.listCallback=a};this.attachPrinter=function(a){eb&&eb.attachPrinter(a,p)};this.showError=Fb;this.resetStatus=ac;this.exeAppCmd=function(a){var b=da.getFocused();b&&b.exeCommand(a)};this.activateApp=function(a){var b;
(b=hi5.tool.isNumber(a)?da.getWinById(a):da.getMainWinByAppId(a))?b.activate(1):svGlobal.logger.warn("No window found in "+a)};this.reconnect=function(a,b,c){void 0==c&&(c=ea.forceReconnect||!1);if(!Ha&&!c)return!1;N.minWidth&&a<N.minWidth&&(a<N.minWidth&&svGlobal.logger.warn("Width "+a+" is samller than minWidth "+N.minWidth),a=N.minWidth);N.minHeight&&b<N.minHeight&&(b<N.minHeight&&svGlobal.logger.warn("Height "+b+" is samller than minHeight "+N.minHeight),b=N.minHeight);a&=-4;b&=-4;if(!c&&4>Math.abs(a-
Ia)&&4>Math.abs(b-Ja))return!1;if(Ra&&Ra.enabled&&!1!==ea.displayVC)Ra.applyResolution(a,b);else if(oc&&pb||c||Wa&&!oc)pb=!1,svGlobal.logger.info("reconnecting..."),ra("8E0"+a+"\t"+b),Qa&&(Qa.remoteLockFlags=0,Qa.checkLockFlags=!0);return!0};this.notify=function(a,b){a="8E6"+a;b&&(a+="\t"+b.join(";"));ra(a)};this.getUploadManager=function(){return Ma};this.setFPS=function(a){da.execute("setFPS",[a])};this.addSurface=function(a){if(!da.hasSurface(a)&&(Kb||na.setContext(a.context),!da.hasSurface(a)||
!a.railWin)){kb&&a.setPlayerMode();N.mouseMoveEmu&&(a.mouseMoveEmu=T(N.mouseMoveEmu));a.setSize(50,50,"hidden");var b=a.getFreeSpace();0==Ia&&(Ia=b.width);0==Ja&&(Ja=b.height);a.setConfig(ea);da.addSurface(a);Oa(Ia,Ja,!0,N.monitorDef?!0:!1);a.setController(Qa);a.setDrawable(Pd);a.setTouchpad(T(N.touchpad));var c=b=T(N.mapClipboard),e=b;void 0!=N.copyToLocal?c=T(N.copyToLocal):void 0!=ea.copyToLocal&&(c=ea.copyToLocal);void 0!=N.copyToRemote?e=T(N.copyToRemote):void 0!=ea.copyToRemote&&(e=ea.copyToRemote);
a.setClipboard(b,c,e);Jb&&bc(a);N.invitation&&!T(N.control)&&(da.setReadOnly(!0),b=hi5.$("requestControl"))&&(b.disabled=!1);b=void 0!=N.ctrlToWin?T(N.ctrlToWin):void 0!=ea.ctrlToWin?ea.ctrlToWin:!0;c=void 0!=N.cmdToCtrl?T(N.cmdToCtrl):void 0!=ea.cmdToCtrl?ea.cmdToCtrl:!0;a.run(parseInt(N.keyboard||1033,10),b,!!ea.noKeyStuck,c)}};this.getRunninApps=this.getRunningApps=function(){for(var a=[],b=0,c=da.size();b<c;b++)da.getSurface(b).railWin.getMain(da.zOrders)&&a.push(da.getSurface(b).railWin.getMain(da.zOrders).titleInfo);
return a};this.startApp=function(a,b,c){b=b||"";c=c||"";ra("8C2"+a+"\t"+b+"\t"+c);var e=da.getSurface(da.size()-1);e&&(e.remoteApp=new zc(a,b,c))};this.startExitingApp=function(a){a=da.popWins(a);for(var b=a.length-1;0<=b;b--)da.addWin(a[b])};var vb=new p.DynamicChannel;vb.name="PNPDR";vb.onopen=function(){svGlobal.logger.info("PNPDR DVC onopen()")};vb.process=function(a){a.getLittleEndian32();var b=a.getLittleEndian32();switch(b){case 101:a.getLittleEndian32(),a.getLittleEndian32(),a.getLittleEndian32(),
a=new RdpBuffer(new Uint8Array(20),0,20),a.setLittleEndian32(20),a.setLittleEndian32(b),a.setLittleEndian32(1),a.setLittleEndian32(5),a.setLittleEndian32(1),vb.send(a)}};vb.onclose=function(){svGlobal.logger.info("PNPDR DVC onclose()")};p.addDynamicChannel(vb);var hb=null;T(N.scanner)&&(hb=new p.DynamicChannel,hb.name="SCANNERDVC",hb.onopen=function(){svGlobal.logger.info("scanner DVC onopen().")},hb.process=function(a){var b=a.getByte();switch(b){case 0:var c=a.getByte(),e=a.getByte();b=new Uint8Array(10);
b[0]=4;b[1]=7;b[2]=c;b[3]=e;b.set(a.getBytes(2),4);b.set(a.getBytes(2),6);b.set(a.getBytes(2),8);if(p.onagentmessage)p.onagentmessage(b);break;case 1:break;case 2:c=a.getEnd()-a.getPosition();b=new Uint8Array(c+2);b[0]=4;b[1]=3;b.set(a.getBytes(c),2);if(p.onagentmessage)p.onagentmessage(b);break;case 3:c=a.getEnd()-a.getPosition();b=new Uint8Array(c+3);b[0]=4;b[1]=9;b[2]=0;b.set(a.getBytes(c),3);if(p.onagentmessage)p.onagentmessage(b);break;default:svGlobal.logger.info('Warning: Unknown type "'+b+
'" received from DVC, ignored.')}},hb.onclose=function(){var a=new Uint8Array(2);a[0]=4;a[1]=4;if(p.onagentmessage)p.onagentmessage(a)},p.addDynamicChannel(hb));var bb=null;p.hasSmartCard()&&(bb=new p.GatewayChannel,bb.name="SCARDSTB",bb.onopen=function(){var a=new Uint8Array(2);a[0]=3;a[1]=1;if(p.onagentmessage)p.onagentmessage(a);T(N.passwordIsPin)&&p.onagentmessage&&!hi5.browser.isMacOS&&hi5.notifications.notify({msg:__svi18n.info.scardAuth||"Smart card authentication in progress. Please wait...",
type:0,timeout:1E4})},bb.process=function(a){var b=a.getEnd()-a.getPosition(),c=a.getByte(),e=a.getByte();switch(c){case 1:switch(e){case 1:c=new Uint8Array(2);c[0]=3;c[1]=7;if(p.onagentmessage)p.onagentmessage(c);break;case 3:a=a.getBytes(b-2);b=b+4+4+4;wb&&(b+=wb.length);fb&&(b+=fb.length);b=new hi5.DataBuffer(new Uint8Array(b));b.setByte(3);b.setByte(9);wb?(b.setLittleEndian32(wb.length),b.setBytes(wb)):b.setLittleEndian32(0);fb?(b.setLittleEndian32(fb.length),b.setBytes(fb)):b.setLittleEndian32(0);
b.setLittleEndian32(a.length);b.setBytes(a);b.markEnd();if(p.onagentmessage)p.onagentmessage(b.getData());break;case 5:a=a.getBytes(b);c=new Uint8Array(b);c[0]=3;c[1]=11;c.set(a,2);if(p.onagentmessage)p.onagentmessage(c);break;case 2:case 4:break;default:svGlobal.logger.warn("Invalid smart card channel auth data received: unknown sub-type ["+a[1]+"].")}break;case 2:if(bb)if(1==e){if(c=new Uint8Array(b),c[0]=3,c[1]=3,c.set(a.getBytes(b),2),p.onagentmessage)p.onagentmessage(c)}else svGlobal.logger.warn("Invalid smart card channel pcsc data received: unknown sub-type ["+
a[1]+"].");break;default:svGlobal.logger.warn("Invalid smart card channel data received: unknown type ["+a[0]+"].")}},bb.onclose=function(){var a=new Uint8Array(2);a[0]=3;a[1]=4;if(p.onagentmessage)p.onagentmessage(a)},p.addGatewayChannel(bb));ea.detectNetwork&&(n+="&connectType=7",zd());this.getNetworkResult=function(){return Hb};this.getAgentLink=function(){var a=navigator.userAgentData?navigator.userAgentData.platform:navigator.platform||navigator.appVersion;return-1!=a.indexOf("Win")?"agent_setup.exe":
-1!=a.indexOf("macOS")||-1!=a.indexOf("Mac")?"agent_setup.pkg":""};var cc=new Map,dc=new Map;this.writeAgent=function(a){a.byteLength&&(a=new Uint8Array(a));switch(a[0]){case 3:if(bb){var b=a.slice?new hi5.DataBuffer(a.slice(2,a.length)):new hi5.DataBuffer(a.subarray(2,a.length));switch(a[1]){case 1:case 4:case 5:case 6:case 7:case 9:case 11:break;case 2:break;case 3:a[0]=2;a[1]=1;bb.send(a);break;case 8:cc.clear();dc.clear();a=b.getLittleEndian32();if(0!=a)a=b.getLittleEndian32(),b=b.getAscllString(a,
!1),hi5.notifications.notify({msg:b});else{var c=b.getLittleEndian32(),e=document.getElementById("scardSelection");e||(e=document.createElement("div"),e.id="scardSelection",e.className="appdlg",document.body.appendChild(e));if(e)if(0==c)e&&(e.innerHTML="<p>Error: Could not find any connected smart card. Please make check the connectivity and then refresh the page",b=new hi5.ui.Lightbox(e),b.onclose=function(){location.reload()},b.show());else{e.innerHTML=1<c?'<p><b>PLEASE SELECT A SMART CARD, ENTER YOUR CREDENTIAL AND CLICK "Continue".</b></p>':
'<p><b>PLEASE ENTER YOUR CREDENTIAL AND CLICK "Continue".</b></p>';for(a=0;a<c;a++){var d=b.getLittleEndian32();d=b.getBytes(d);var g=b.getLittleEndian32();g=b.getAscllString(g,!1);var m=b.getLittleEndian32();m=b.getAscllString(m,!1);var G=b.getLittleEndian32();b.getAscllString(G,!1);G=b.getLittleEndian64();G=(new Date(1E3*G)).toDateString();d=Ad(a,d,m,g,G);e.appendChild(d)}e.innerHTML+="<br>";b=document.createElement("div");b.innerHTML+="Smart card credential: ";a=document.createElement("input");
a.type="text";a.id="userPin";a.placeholder="PIN";a.value="";a.required=!0;b.appendChild(a);e.appendChild(b);e.innerHTML+="<br>";b=new hi5.ui.LightboxWithBtn(e);b.onclose=function(){var z,D=document.querySelector('input[name="scard_name"]:checked');D&&(z=parseInt(D.value));wb=cc.get(z);qb=dc.get(z);z=document.getElementById("userPin").value;fb=(new TextEncoder("utf-8")).encode(z);z=2;z=fb?z+4+fb.length:z+4;z=qb?z+4+qb.length:z+4;z=new Uint8Array(z);z=new hi5.DataBuffer(z);z.setByte(1);z.setByte(2);
fb?(z.setLittleEndian32(fb.length),z.setBytes(fb)):z.setLittleEndian32(0);qb?(z.setLittleEndian32(qb.length),z.setAsciiString(qb,qb.length)):z.setLittleEndian32(0);bb&&bb.send(z)};document.getElementById("userPin").addEventListener("keypress",function(z){"Enter"===z.key&&(z.preventDefault(),document.getElementById("continue_button").click())});b.show()}}break;case 10:a=b.getLittleEndian32();0!=a?(a=b.getLittleEndian32(),b=b.getAscllString(a,!1),hi5.notifications.notify({msg:b})):(a=b.getLittleEndian32(),
a=b.getBytes(a),b=new Uint8Array(6+a.length),b=new hi5.DataBuffer(b),b.setByte(1),b.setByte(4),b.setLittleEndian32(a.length),b.setBytes(a),bb.send(b));break;case 12:a[0]=1;a[1]=6;bb.send(a);break;default:svGlobal.logger.warn("Warning: Unknown smart card response header: [3 / "+a[1]+"], ignored.")}}break;case 4:if(hb)switch(a[1]){case 2:b=a.slice?new hi5.DataBuffer(a.slice(2,a.length)):new hi5.DataBuffer(a.subarray(2,a.length));e=document.getElementById("dsSelection");e||(e=document.createElement("div"),
e.id="dsSelection",e.className="appdlg",document.body.appendChild(e));if(0!=b.getLittleEndian16())e&&(e.innerHTML="<p>Error on local: failed to get the list of connected scanners. Close to continue without scanning.</p>",b=new hi5.ui.Lightbox(e),b.onclose=function(){p.run()},b.show());else if(c=(a.byteLength-4)/41,0==c)e&&(e.innerHTML="<p>Error: Could not find any connected scanner. Please:<ul><li>Power on or connect the scanner and then refresh the page; or</li><li>Close this dialog to connect to the machine without using scanner.</li></ul></p>",
b=new hi5.ui.Lightbox(e),b.onclose=function(){p.run()},b.show());else if(1==c){if(b=new Uint8Array(3),b[0]=4,b[1]=5,b[2]=0,p.onagentmessage)p.onagentmessage(b)}else if(e){e.innerHTML='<p> Please choose a scanner &lt;DriverType: DeviceName&gt; and click "Continue".</a></p>';for(a=0;a<c;a++)d=b.getAscllString(41,!0),d=Bd(a,d),e.appendChild(d);e.innerHTML+="<br>";b=new hi5.ui.LightboxWithBtn(e);b.onclose=function(){var z=0,D=document.querySelector('input[name="ds_name"]:checked');D&&(z=D.value);D=new Uint8Array(3);
D[0]=4;D[1]=5;D[2]=z;if(p.onagentmessage)p.onagentmessage(D)};b.show()}break;case 3:case 8:case 10:b=a.slice?new hi5.DataBuffer(a.slice(2,a.length)):new hi5.DataBuffer(a.subarray(2,a.length));hb.send(b);break;case 4:b=a.slice?new hi5.DataBuffer(a.slice(2,a.length)):new hi5.DataBuffer(a.subarray(2,a.length));hb.send(b);hi5.notifications.notify({msg:__svi18n.info.TwainNotSupported,type:2});break;case 6:b=a.slice?new hi5.DataBuffer(a.slice(2,a.length)):new hi5.DataBuffer(a.subarray(2,a.length));b.getLittleEndian16();
p.run();break;default:svGlobal.logger.warn("Warning: Unknown response header: [4 / "+a[1]+"], ignored.")}break;case 5:switch(a[1]){case 1:b=a[2]|a[3]<<8,a=a[4]|a[5]<<8,svGlobal.logger.info("Agent version, major: "+b+" minor: "+a),(e=hi5.appcfg.agent&&hi5.appcfg.agent.version)&&(e.major>b||e.major==b&&e.minor>a)&&(b=__svi18n.info.newVersion||"New versoin available",a=__svi18n.info.updateAgent||"Please download and install the new gateway agent",e=p.getAgentLink(),hi5.notifications.notify({title:b,
html:!0,msg:a+(': <a href="'+e+'">'+e+"</a>")}))}break;case 6:switch(a[1]){case 1:b=new hi5.DataBuffer(a);b.skipPosition(2);e=b.getLittleEndian32();c=[];for(a=0;a<e;a++)g=b.getLittleEndian32(),d=b.getUnicodeString(g),g=b.getLittleEndian32(),g=b.getUnicodeString(g),c.push({name:d,driver:g});eb&&eb.listCallback&&(eb.listCallback(c),eb.listCallback=null)}break;case 7:eb.send(a.subarray(1));break;default:svGlobal.logger.warn("Invalid channel data received: unknown type ["+a[0]+"].")}};var wb,fb,qb,gc=
{type:6,data:null};this.setAgentStatus=function(a){Uc=a};this.getAgentStatus=function(){return Uc};this.run=function(){var a;if(a=null==p.onagentmessage)a=1==p.mode?!1:p.hasSmartCard()||p.hasScanner()||T(N.localPrinter);a&&window.startGatewayAgent?startGatewayAgent(p):(p.hasUSB()?da.getFocused().requestUsbDevices(p.getUSB(),function(b){Ea.usbChannel.openDevices(b);ec()}):ec(),Ta.supportWebAudio&&Ta.iOSFix())};this.getDesktop=function(){return na};this.mouseDown=function(a,b,c){Wa&&ra("80"+a+"\t"+
b+"\t"+c)};this.mouseMove=function(a,b){Wa&&ra("82"+a+"\t"+b)};this.mouseUp=function(a,b,c){Wa&&ra("81"+a+"\t"+b+"\t"+c)};this.writeKeyCode=function(a,b){Wa&&ra("8B"+(a?0:49152)+"\t"+b)};this.writeScancode=function(a,b){Wa&&("number"==typeof a?(ra("840\t"+a),ra("8449152\t"+a)):ra("84"+(a?0:49152)+"\t"+b))};this.resetSize=function(a,b){p.reconnectOnResize&&(Va?(mb&&(clearTimeout(mb),mb=0),a&=-4,b&=-4,mb=setTimeout(function(){document.hidden||(Ra&&Ra.enabled&&Ra.applyResolution(a,b),setTimeout(function(){p.writeRawInput("8C661441\t"+
a+"\t"+b);3==p.windowState&&Sc()},150),svGlobal.logger.info("-- displayChange, h:"+b))},777)):p.running()&&(mb&&(clearTimeout(mb),mb=0),mb=setTimeout(function(){document.hidden||p.reconnect(a,b)},555)))};var Ua=new RdpBuffer([],0,0);this.suppressOutput=function(a){if(!p.sessionInfo.suppressOutput)return!1;void 0==a&&(a=!0);var b=new Uint8Array(a?3:11);b[0]=146;b[1]=3;b[2]=a?1:0;a||(b[3]=Xb,b[4]=Xb>>8,b[5]=Wb,b[6]=Wb>>8,b[7]=Yb,b[8]=Yb>>8,b[9]=Zb,b[10]=Zb>>8);ra(b.buffer);return!0};this.refreshOutput=
function(a,b,c,e){var d=new Uint8Array(c?11:3);d[0]=146;d[1]=3;d[2]=2;c&&(d[3]=a,d[4]=a>>8,d[5]=b,d[6]=b>>8,d[7]=c,d[8]=c>>8,d[9]=e,d[10]=e>>8);ra(d.buffer)};this.sendPing=function(a){var b=new Uint8Array(a?2+a.length:2);b[0]=146;b[1]=0;a&&b.set(a,2);ra(b.buffer)};this.startPing=function(a,b){b=b||0;Pa||(Pa=new hi5.tool.ResponseMonitor(function(){Wa&&p.sendPing()},function(){if(Wa&&p.onnoresponse)return p.onnoresponse()}));Pa.setInterval(a,b);var c=new Uint8Array(4);c[0]=146;c[1]=2;c[2]=a;c[3]=b;
ra(c.buffer);setTimeout(function(){Pa&&Pa.check()},1E3*(a+b));La?La.postMessage({type:0,cmd:6,start:1}):(Ba.onSlowPath=Ba.onFastPath=Jc,Ba.onReqHistory=function(){Jc(15555)})};this.stopPing=function(){Pa&&Pa.stop();La?La.postMessage({type:0,cmd:6,start:0}):Ba.onSlowPath=Ba.onFastPath=Ba.onReqHistory=null};var Ya=null,Pc=0;this.play=function(){ra("F3")};this.pause=function(){ra("F2")};this.scan=function(a){ra("F4"+(a?"1":"0"))};this.seek=function(a){var b=da.getFocused();b&&Ha&&(ra("F4"+(a?"1":"0")+
"\t"+(a/b.getScale().x|0)),na.pause(!0))};var Da={tag:0,channels:0,bitsPerSample:0,samplePerSec:22050,toStream:function(a){a.setLittleEndian16(this.tag);a.setLittleEndian16(this.channels);a.setLittleEndian16(this.bitsPerSample);a.setLittleEndian32(this.samplePerSec)},fromStream:function(a){this.tag=a.getLittleEndian16();this.channels=a.getLittleEndian16();this.bitsPerSample=a.getLittleEndian16();this.samplePerSec=a.getLittleEndian32()}},Oc=!1;this.showMessage=function(a,b,c){p&&p.displayMsg&&a&&((b=
b||da.getFocused())?b.showMessage(a,c):("string"==typeof a&&(a={msg:a,timeout:c||0}),hi5.notifications.notify(a)))};this._unload=zb;this.close=function(){svGlobal.logger.info("closing...");Ha&&Va&&da&&ea.closeRemoteApp&&da.tryCloseRemoteApps();na&&na.isSendingHistory()?(svGlobal.logger.warn("In the middle of sending history, close delayed"),setTimeout(Rc,2222)):Rc()};hi5.browser.isChromeApp?chrome.runtime.onSuspend.addListener(p.close):window.addEventListener("unload",p.close,!1);Lb.searchStartCode=
function(a,b){for(var c=b[0]+2,e=a.length,d;c<e;)if(d=a[c],1==d){if(0==a[c-1]&&0==a[c-2]){b[1]=0==a[c-3]?4:3;b[0]=c-b[1]+1;return}c+=3}else 0==d?c++:c+=3;b[0]=-1};pc.SAMPLING_FREQUENCY=[96E3,88200,64E3,48E3,44100,32E3,24E3,22050,16E3,12E3,11025,8E3,7350];Mb.isVideoSupported="MediaSource"in window&&MediaSource.isTypeSupported('video/mp4; codecs="avc1.42E01E, mp4a.40.2"');Mb.isAudioSupported="MediaSource"in window&&MediaSource.isTypeSupported('audio/mp4; codecs="mp4a.40.2"');svGlobal.DCVC_EXTENSION||
(svGlobal.DCVC_EXTENSION={});svGlobal.DCVC_EXTENSION.GFX=function(a,b,c,e,d){function g(w,Q,Z,M){this.pixels=w;this.width=Q;this.height=Z;this.key=M}function m(w,Q,Z){this.width=w;this.height=Q;this.monitors=Z}function G(){this.flags=this.bottom=this.right=this.top=this.left=0;this.read=function(w){this.left=w.getLittleEndian32();this.top=w.getLittleEndian32();this.right=w.getLittleEndian32();this.bottom=w.getLittleEndian32();this.flags=w.getLittleEndian32()};this.toString=function(){return"left: "+
this.left+" top: "+this.top+" right: "+this.right+" bottom: "+this.bottom+" flags: "+this.flags}}function z(w,Q,Z,M){function aa(){xa=!1;ua.drawable=X._video;X._player=ja?new Nd(X,!1,M):new Mb(ua.drawable,X,!1);X._player.onsps=function(fa){ja&&(X._video.width=fa.width,X._video.height=fa.height);X.onsps&&X.onsps(fa)};X._player.onerror=function(fa){X.onfatalerror&&X.onfatalerror(X,fa)};X._player.onplayerror=function(fa){function ia(){ua={drawable:X._video};X.player.play(!0)}ua=null;if((!X.onuserinteract||
!X.onuserinteract(ia,"video"))&&X.onmessage)X.onmessage({msg:"Please click Yes to continue.<br>"+fa,cbYes:function(){X.player.play(!0);this.destroy()}})};X._player.onframedecoded=function(fa){pa.drawImage(fa,0,0)}}this.id=w;this.width=Q;this.height=Z;this.pixelFomrat=33;this.outputOriginY=this.outputOriginX=0;this.targetWidth=Q;this.targetHeight=Z;this._player=null;var ja="no-decoder"==M?!1:!!window.VideoDecoder;this._video=ja?new OffscreenCanvas(Q,Z):document.createElement("video");var pa=ja?this._video.getContext("2d"):
null,X=this,va=null,xa=!0,ua={drawable:null};ja&&svGlobal.logger.info("...MediaDecoder in use");this.resumeVideo=function(){X._player&&X._player.play(!0)};this.setDisplayBuffer=function(fa){va=fa};this.draw=function(fa,ia,qa,Ka){return xa?va.draw(fa,ia,qa,Ka):ua};this.processAvc=function(fa,ia){xa&&aa();if(!ia||ja)X.onvideoframe(fa,ia)};this.reset=function(fa,ia){X&&X._player&&X._player.reset()};this.close=function(){X&&X._player&&(X._player.close(),X._player=null);X=null};this.setRGBs=function(fa,
ia,qa,Ka,f,k,h){va.setRGBs(fa,ia,qa,Ka,f,k,h)};this.getRGBs=function(fa,ia,qa,Ka){return va.getRGBs(fa,ia,qa,Ka)};this.moveArea=function(fa,ia,qa,Ka,f,k){va.moveArea(fa,ia,qa,Ka,f,k)};this.fillRect=function(fa,ia,qa,Ka,f){va.fillRect(fa,ia,qa,Ka,f)};this.postPaint=function(fa,ia,qa,Ka){xa&&va.postPaint(fa,ia,qa,Ka)}}function D(w,Q,Z,M){var aa=new z(w,Q,Z,d);aa.pixelFormat=M||33;aa.setDisplayBuffer(e);U.push(aa);R.oncreatesurface&&R.oncreatesurface(aa);svGlobal.logger.info("create surface id:"+w+" w:"+
Q+" h:"+Z+" pixelFmt:"+aa.pixelFormat);return aa}function H(w,Q){var Z=w.getPosition(),M=w.getLittleEndian32();w.skipPosition(10*M);return w.getBytes(Q-(w.getPosition()-Z))}function u(w,Q,Z,M){Z=w.getLittleEndian32();var aa=Z>>>30;Z&=1073741823;switch(aa){case 0:var ja=H(w,Z);var pa=H(w,Q-Z-4);break;case 1:ja=H(w,Z);break;case 2:Q=w.getEnd()-w.getPosition();pa=H(w,Q);break;default:throw Error("Invalid LC: "+aa);}ja&&M.processAvc(ja,!1);pa&&M.processAvc(pa,!0)}function x(w){var Q=w.getLittleEndian32(),
Z=w.getLittleEndian32();w=w.getLittleEndian32();var M=!1;switch(Q){case 524292:M=!1;0==(w&1)&&(y=new ClearDecoder);break;case 524549:(M=0!=(w&16))||0!=(w&1)||(y=new ClearDecoder);break;default:M=0==(w&32)}e.onGetGfxHistory=function(aa,ja){var pa=O.toPDU();pa&&aa(pa);ja();svGlobal.logger.info("Get GFX Histroy")};e.onSetGfxHistory=function(aa,ja){svGlobal.logger.info("Set GFX Histroy");10==aa?O.fromStream(ja):svGlobal.logger.error("Invalid GFX histroy type: "+aa)};svGlobal.logger.info("Gfx Cap, Ver:"+
Q.toString(16)+" len:"+Z+" flags:"+w+" h264:"+M);R.onconfirm&&R.onconfirm();return M}var O=new function(){function w(f,k,h,r,v){this.len=f;this.code=k;this.valueBits=h;this.type=r;this.vbase=v}function Q(f){var k=25E5-ja,h=f.length;if(k>=h)aa.set(f,ja),ja=k>h?ja+h:0;else if(25E5>=h)aa.set(f.subarray(0,k),ja),aa.set(f.subarray(k),0),ja=h-k;else{k=(h-k)%25E5;var r=h-k,v=f.subarray(r);f=f.subarray(h-25E5,r);aa.set(f,25E5-f.length);aa.set(v,0);ja=k}}function Z(f){for(;ua<f;)xa<<=8,fa<qa?xa+=ia[fa++]:
console.log("--- end"),ua+=8;va-=f;ua-=f;f=xa>>ua;xa&=(1<<ua)-1;return f}var M=[new w(1,0,8,0,0),new w(5,17,5,1,0),new w(5,18,7,1,32),new w(5,19,9,1,160),new w(5,20,10,1,672),new w(5,21,12,1,1696),new w(5,24,0,0,0),new w(5,25,0,0,1),new w(6,44,14,1,5792),new w(6,45,15,1,22176),new w(6,52,0,0,2),new w(6,53,0,0,3),new w(6,54,0,0,255),new w(7,92,18,1,54944),new w(7,93,20,1,317088),new w(7,110,0,0,4),new w(7,111,0,0,5),new w(7,112,0,0,6),new w(7,113,0,0,7),new w(7,114,0,0,8),new w(7,115,0,0,9),new w(7,
116,0,0,10),new w(7,117,0,0,11),new w(7,118,0,0,58),new w(7,119,0,0,59),new w(7,120,0,0,60),new w(7,121,0,0,61),new w(7,122,0,0,62),new w(7,123,0,0,63),new w(7,124,0,0,64),new w(7,125,0,0,128),new w(8,188,20,1,1365664),new w(8,189,21,1,2414240),new w(8,252,0,0,12),new w(8,253,0,0,56),new w(8,254,0,0,57),new w(8,255,0,0,102),new w(9,380,22,1,4511392),new w(9,381,23,1,8705696),new w(9,382,24,1,17094304)],aa=new Uint8Array(25E5),ja=0,pa=new Uint8Array(65536),X=0,va=0,xa=0,ua=0,fa=0,ia=null,qa=0,Ka=!0;
this.toPDU=function(){if(Ka)return null;var f=new Uint8Array(2500008);f[0]=29;f[2]=1;f[3]=10;f[4]=ja;f[5]=ja>>8;f[6]=ja>>16;f[7]=ja>>24;f.set(aa,8);return f};this.fromStream=function(f){ja=f.getLittleEndian32();aa.set(f.getSubarray(25E5))};this.decompress=function(f,k){if(k){ia=f;Ka&&(Ka=!1);qa=ia.length-1;va=8*qa-ia[qa];for(X=fa=ua=xa=0;0<va;)for(var h=k=0,r=0;r<M.length;r++){for(f=M[r];k<f.len;)h=(h<<1)+Z(1),k++;0>h&&console.log("xxx inPrefix");if(h==f.code){if(0==f.type)f=f.vbase+Z(f.valueBits),
(0>f||255<f)&&console.log("xxx do c"),f&=255,aa[ja]=f,25E5==++ja&&(ja=0),pa[X++]=f;else if(k=Z(f.valueBits),k=f.vbase+k,0>k&&console.log("xxx distance"),0!=k){if(0==Z(1))f=3;else{f=4;for(h=2;1==Z(1);)f*=2,h++;f+=Z(h)}k=25E5-k+ja;k%=25E5;h=k+f;if(Math.abs(ja-k)>=f&&25E5>h&&25E5>ja+f)k=aa.subarray(k,h),aa.set(k,ja),ja+=f,pa.set(k,X),X+=f;else for(;0<f;)h=aa[k],25E5==++k&&(k=0),aa[ja]=h,25E5==++ja&&(ja=0),pa[X++]=h,f--}else f=Z(15),va-=ua,xa=ua=0,k=ia.subarray(fa,fa+f),Q(k),pa.set(k,X),fa+=f,X+=f,va-=
8*f;break}}65536<X&&console.error("xx outputIndex:"+X);return pa.subarray(0,X)}Q(f);return f}},q=new function(){this.process=function(w){var Q=w.getByte();if(224==Q){var Z=0!=(w.getByte()&32);var M=w.getPosition(),aa=w.getEnd();Q=O.decompress(w.getData().subarray(M,aa),Z);w.setPosition(aa)}else{225!=Q&&console.log("Invalid descriptor:"+Q);aa=w.getLittleEndian16();var ja=w.getLittleEndian32();Q=new Uint8Array(ja);for(var pa=0,X,va=0;va<aa;va++)X=w.getLittleEndian32(),Z=0!=(w.getByte()&32),X--,M=w.getPosition(),
Z=O.decompress(w.getData().subarray(M,M+X),Z),Q.set(Z,pa),pa+=Z.length,w.skipPosition(X);pa!=ja&&console.error("wrong size, actual:"+pa+" expected:"+ja)}return new RdpBuffer(Q,0,Q.length)}},y=null,B=new rdpcodecs.RemoteFX(!1),t=0,L=[],R=new a;R.name="Microsoft::Windows::RDS::Graphics";var U=new function(w,Q){var Z=[];this.push=function(M){M.osps=w.onsps;M.onfatalerror=w.onfatalerror;M.onplayerror=w.onplayerror;M.onuserinteract=w.onuserinteract;M.onmessage=w.onmessage;Z[M.id]=M};this.get=function(M){return Z[M]};
this.getAll=function(){return Z};this.delete=function(M){var aa=Z[M];aa&&(aa.onsps=null,aa.onfatalerror=null,aa.onplayerror=null,Z[M]=null)};this.reset=function(M){M=0;for(var aa=Z.length;M<aa;M++)Z[M]&&Z[M].reset()};this.close=function(){for(var M=0,aa=Z.length;M<aa;M++)Z[M]&&Z[M].close()};this.resumeVideo=function(){for(var M=0,aa=Z.length;M<aa;M++)Z[M]&&Z[M].resumeVideo()}}(R,e);R.drawable=new function(){this.draw=function(w,Q,Z,M,aa){return(aa=U.get(aa))?aa.draw(w,Q,Z,M):null};this.getSurfaces=
function(){return U};this.onfocus=function(w){};this.resumePlay=null};R.resumeVideo=function(){U.resumeVideo()};R.process=function(w){for(var Q=q.process(w);Q.has(8);){var Z=Q.getLittleEndian16();Q.getLittleEndian16();var M=Q.getLittleEndian32(),aa=Q.getPosition()+M-8;switch(Z){case 1:var ja=Q,pa=ja.getLittleEndian16(),X=ja.getLittleEndian16(),va=ja.getByte(),xa=ja.getLittleEndian16(),ua=ja.getLittleEndian16(),fa=ja.getLittleEndian16(),ia=ja.getLittleEndian16(),qa=fa-xa,Ka=ia-ua,f=ja.getLittleEndian32(),
k=ja.getPosition()+f,h=U.get(pa);h||(R.onconfirm&&R.onconfirm(),h=D(pa,e.width,e.height,va));switch(X){case 0:var r=rdpcodecs.bitmap.byte2int(ja.getData(),f,ja.getPosition());h.setRGBs(xa,ua,qa,Ka,r,0,qa);break;case 3:for(var v=B.decode(ja,f),A=v.getRects(),I=v.getTiles(),C=v.getTileSize(),F=v.getRectSize(),W=0;W<C;W++){var E=I[W];if(F)for(var l=E.x+64,K=E.y+64,P=0;P<F;P++){var S=A[P],ca=S.x+S.width,ma=S.y+S.height;l<=ca?K<=ma?h.setRGBs(E.x+xa,E.y+ua,64,64,E.data,0,64):h.setRGBs(E.x+xa,E.y+ua,64,
ma-E.y,E.data,0,64):K<=ma?h.setRGBs(E.x+xa,E.y+ua,ca-E.x,64,E.data,0,64):h.setRGBs(E.x+xa,E.y+ua,ca-E.x,ma-E.y,E.data,0,64)}else h.setRGBs(E.x,E.y,64,64,E.data,0,4)}break;case 8:y||(y=new ClearDecoder);y.decode(ja,qa,Ka,h.getData(),xa,ua,h.width);break;case 10:svGlobal.logger.info("...PLANAR");break;case 11:var za=h,Ga=H(ja,f);za.processAvc(Ga,!1);break;case 12:svGlobal.logger.info("...ALPHA");break;case 14:u(ja,f,!1,h);break;case 15:u(ja,f,!0,h);break;default:svGlobal.logger.warn("Invalid codec:"+
X)}ja.setPosition(k);h.postPaint(xa,ua,qa,Ka);break;case 2:svGlobal.logger.info("RDPGFX_WIRE_TO_SURFACE_PDU_2");break;case 3:svGlobal.logger.info("RDPGFX_CMDID_DELETEENCODINGCONTEXT");break;case 4:var Ca=Q;svGlobal.logger.info("...soliFill");for(var Fa=Ca.getLittleEndian16(),Aa=-16777216|Ca.getByte()<<16|Ca.getByte()<<8|Ca.getByte()|Ca.getByte()<<24,Sa=Ca.getLittleEndian16(),ta=U.get(Fa),wa=0;wa<Sa;wa++){var Na=Ca.getLittleEndian16(),Xa=Ca.getLittleEndian16(),Za=Ca.getLittleEndian16()-Na,$a=Ca.getLittleEndian16()-
Xa;ta.fillRect(Na,Xa,Za,$a,Aa);ta.postPaint(Na,Xa,Za,$a)}break;case 5:var ab=Q;svGlobal.logger.info("...surfaceToSurface");for(var ub=ab.getLittleEndian16(),Zc=ab.getLittleEndian16(),Ob=ab.getLittleEndian16(),Pb=ab.getLittleEndian16(),Qb=ab.getLittleEndian16()-Ob,tc=ab.getLittleEndian16()-Pb,Qd=ab.getLittleEndian16(),$c=U.get(ub),Rd=U.get(Zc),ad=ub==Zc?null:$c.getRGBs(Ob,Pb,Qb,tc),bd=0;bd<Qd;bd++){var cd=ab.getLittleEndian16(),dd=ab.getLittleEndian16();ad?Rd.setRGBs(cd,dd,Qb,tc,ad,0,Qb):$c.moveArea(Ob,
Pb,Qb,tc,cd-Ob,dd-Pb)}break;case 6:var nb=Q;svGlobal.logger.info("...surfaceToCache");var Sd=nb.getLittleEndian16(),uc=nb.getLittleEndian32().toString(16),ed=nb.getLittleEndian32();0<ed&&(uc=ed.toString(16)+uc);var Td=nb.getLittleEndian16(),fd=nb.getLittleEndian16(),gd=nb.getLittleEndian16(),hd=nb.getLittleEndian16()-fd,id=nb.getLittleEndian16()-gd,Ud=U.get(Sd).getRGBs(fd,gd,hd,id);L[Td]=new g(Ud,hd,id,uc);break;case 7:var Db=Q;svGlobal.logger.info("...cacheToSurface");for(var Vd=Db.getLittleEndian16(),
Wd=Db.getLittleEndian16(),Xd=Db.getLittleEndian16(),Rb=L[Vd],Yd=U.get(Wd),jd=0;jd<Xd;jd++){var Zd=Db.getLittleEndian16(),$d=Db.getLittleEndian16();Yd.setRGBs(Zd,$d,Rb.width,Rb.height,Rb.pixels,0,Rb.width)}break;case 8:var ae=Q.getLittleEndian16();L[ae]=null;break;case 9:var Sb=Q,be=Sb.getLittleEndian16(),ce=Sb.getLittleEndian16(),de=Sb.getLittleEndian16(),ee=Sb.getByte();D(be,ce,de,ee);break;case 10:var kd=Q.getLittleEndian16();U.delete(kd);svGlobal.logger.info("delete surface id:"+kd);break;case 11:var ld=
Q;ld.getLittleEndian32();ld.getLittleEndian32();break;case 12:var fe=Q.getLittleEndian32();if(0==t){var md=new Uint8Array(20),xb=new RdpBuffer(md);xb.setLittleEndian16(13);xb.setLittleEndian16(0);xb.setLittleEndian32(20);xb.setLittleEndian32(4294967295);xb.setLittleEndian32(fe);t++;xb.setLittleEndian32(t);c&&R.send(md)}break;case 14:var Tb=Q,nd=Tb.getLittleEndian32(),od=Tb.getLittleEndian32(),vc=Tb.getLittleEndian32();svGlobal.logger.info("reset graphic, w:"+nd+" h:"+od+" monitors:"+vc);for(var pd=
Array(vc),Ub=0;Ub<vc;Ub++){var wc=new G;wc.read(Tb);pd[Ub]=wc;svGlobal.logger.info("MonitorDef "+Ub+": "+wc.toString())}var qd=new m(nd,od,pd);U.reset(qd);R.onresetgraphic&&R.onresetgraphic(qd);break;case 15:var Vb=Q,rd=Vb.getLittleEndian16();Vb.skipPosition(2);var Eb=U.get(rd);Eb.outputOriginX=Vb.getLittleEndian32();Eb.outputOriginY=Vb.getLittleEndian32();R.onmapsurface&&R.onmapsurface(Eb);svGlobal.logger.info("mapSurfaceToScaledOutput, outputSurfaceId:"+rd+" outX:"+Eb.outputOriginX+" outY:"+Eb.outputOriginY);
break;case 17:svGlobal.logger.info("TODO: DPGFX_CACHE_IMPORT_REPLY_PDU");break;case 19:x(Q);break;case 21:svGlobal.logger.info("mapSurfaceToWin");break;case 22:break;case 23:var yb=Q,sd=yb.getLittleEndian16();yb.skipPosition(2);var ib=U.get(sd);ib.outputOriginX=yb.getLittleEndian32();ib.outputOriginY=yb.getLittleEndian32();ib.targetWidth=yb.getLittleEndian32();ib.targetHeight=yb.getLittleEndian32();svGlobal.logger.info("mapSurfaceToScaledOutput, outputSurfaceId:"+sd+" outX:"+ib.outputOriginX+" outY:"+
ib.outputOriginY+" targetW:"+ib.targetWidth+" targetH:"+ib.targetHeight);R.onmapsurface&&R.onmapsurface(ib);break;case 24:svGlobal.logger.info("TODO: mapSurfaceToScaledWin");break;default:svGlobal.logger.warn("xxx gfx:"+Z);return}Q.setPosition(aa)}};R.onopen=function(){svGlobal.logger.info("GFX Open, remotefx:"+b);var w=b?2:8,Q=120*w,Z=new Uint8Array(Q),M=new RdpBuffer(Z);M.setLittleEndian16(18);M.setLittleEndian16(0);M.setLittleEndian32(Q);M.setLittleEndian16(w);M.setLittleEndian32(524292);M.setLittleEndian32(4);
M.setLittleEndian32(1);M.setLittleEndian32(524549);M.setLittleEndian32(4);M.setLittleEndian32(19);b||(M.setLittleEndian32(655362),M.setLittleEndian32(4),M.setLittleEndian32(0),M.setLittleEndian32(655872),M.setLittleEndian32(4),M.setLittleEndian32(0),M.setLittleEndian32(656129),M.setLittleEndian32(4),M.setLittleEndian32(0),M.setLittleEndian32(656384),M.setLittleEndian32(4),M.setLittleEndian32(0),M.setLittleEndian32(656642),M.setLittleEndian32(4),M.setLittleEndian32(0),M.setLittleEndian32(656896),M.setLittleEndian32(4),
M.setLittleEndian32(0));M.markEnd();c&&R.send(Z)};R.onclose=function(){U.close()};return R}}
Rdp.languageToKeyboard={af:0,sq:0,ar:1025,"ar-SA":1025,"ar-IQ":0,"ar-EG":0,"ar-LY":0,"ar-DZ":0,"ar-MA":0,"ar-TN":0,"ar-OM":0,"ar-YE":0,"ar-SY":0,"ar-JO":0,"ar-LB":0,"ar-KW":0,"ar-AE":0,"ar-BH":0,"ar-QA":0,eu:0,bg:0,be:0,ca:0,zh:2052,"zh-TW":1028,"zh-CN":2052,"zh-HK":1028,"zh-SG":2052,hr:0,cs:0,da:0,nl:1043,"nl-BE":2067,en:1033,"en-US":1033,"en-GB":2057,"en-AU":0,"en-CA":4105,"en-NA":0,"en-IE":0,"en-ZA":0,"en-JM":0,"en-BZ":0,et:0,fo:0,fa:0,fi:0,fr:1036,"fr-BE":2060,"fr-CA":3084,"fr-CH":4108,"fr-LU":0,
gd:0,"gd-IE":0,de:1031,"de-CH":2055,"de-AT":0,"de-LU":0,"de-LI":0,el:0,he:1037,hi:0,hu:0,is:1039,id:0,it:1040,"it-CH":66576,ja:3758162961,ko:3758162962,lv:0,lt:0,mk:0,mt:0,nb:1044,nn:1083,no:1044,pl:1045,pt:2070,"pt-BR":1046,rm:0,ro:0,"ro-MO":0,ru:1049,"ru-MO":0,sr:0,sk:0,sl:0,sb:0,es:1034,"es-AR":0,"es-GT":0,"es-CR":0,"es-PA":0,"es-DO":0,"es-MX":2058,"es-VE":0,"es-CO":0,"es-PE":0,"es-EC":0,"es-CL":0,"es-UY":0,"es-PY":0,"es-BO":0,"es-SV":0,"es-HN":0,"es-NI":0,"es-PR":0,sx:0,sv:1053,"sv-FI":0,th:0,
ts:0,tn:0,tr:1055,uk:0,ur:0,ve:0,vi:0,xh:0,ji:0,zu:0,detect:function(){var n=navigator&&(navigator.language||navigator.userLanguage||""),J=Rdp.languageToKeyboard[n];if(!J){var V=n.indexOf("-");V&&(J=Rdp.languageToKeyboard[n.substring(0,V)])}J||(svGlobal.logger.info("No valid layout for "+n),J=1033);return J}};svGlobal.Rdp||(svGlobal.Rdp=Rdp);var RdpBuffer=hi5.DataBuffer;
