var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.arrayIteratorImpl=function(m){var H=0;return function(){return H<m.length?{done:!1,value:m[H++]}:{done:!0}}};$jscomp.arrayIterator=function(m){return{next:$jscomp.arrayIteratorImpl(m)}};$jscomp.makeIterator=function(m){var H="undefined"!=typeof Symbol&&Symbol.iterator&&m[Symbol.iterator];return H?H.call(m):$jscomp.arrayIterator(m)};$jscomp.arrayFromIterator=function(m){for(var H,W=[];!(H=m.next()).done;)W.push(H.value);return W};
$jscomp.arrayFromIterable=function(m){return m instanceof Array?m:$jscomp.arrayFromIterator($jscomp.makeIterator(m))};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.SIMPLE_FROUND_POLYFILL=!1;$jscomp.ISOLATE_POLYFILLS=!1;$jscomp.FORCE_POLYFILL_PROMISE=!1;$jscomp.FORCE_POLYFILL_PROMISE_WHEN_NO_UNHANDLED_REJECTION=!1;$jscomp.objectCreate=$jscomp.ASSUME_ES5||"function"==typeof Object.create?Object.create:function(m){var H=function(){};H.prototype=m;return new H};
$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(m,H,W){if(m==Array.prototype||m==Object.prototype)return m;m[H]=W.value;return m};$jscomp.getGlobal=function(m){m=["object"==typeof globalThis&&globalThis,m,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof global&&global];for(var H=0;H<m.length;++H){var W=m[H];if(W&&W.Math==Math)return W}throw Error("Cannot find global object");};$jscomp.global=$jscomp.getGlobal(this);
$jscomp.IS_SYMBOL_NATIVE="function"===typeof Symbol&&"symbol"===typeof Symbol("x");$jscomp.TRUST_ES6_POLYFILLS=!$jscomp.ISOLATE_POLYFILLS||$jscomp.IS_SYMBOL_NATIVE;$jscomp.polyfills={};$jscomp.propertyToPolyfillSymbol={};$jscomp.POLYFILL_PREFIX="$jscp$";var $jscomp$lookupPolyfilledValue=function(m,H){var W=$jscomp.propertyToPolyfillSymbol[H];if(null==W)return m[H];W=m[W];return void 0!==W?W:m[H]};
$jscomp.polyfill=function(m,H,W,ha){H&&($jscomp.ISOLATE_POLYFILLS?$jscomp.polyfillIsolated(m,H,W,ha):$jscomp.polyfillUnisolated(m,H,W,ha))};$jscomp.polyfillUnisolated=function(m,H,W,ha){W=$jscomp.global;m=m.split(".");for(ha=0;ha<m.length-1;ha++){var U=m[ha];if(!(U in W))return;W=W[U]}m=m[m.length-1];ha=W[m];H=H(ha);H!=ha&&null!=H&&$jscomp.defineProperty(W,m,{configurable:!0,writable:!0,value:H})};
$jscomp.polyfillIsolated=function(m,H,W,ha){var U=m.split(".");m=1===U.length;ha=U[0];ha=!m&&ha in $jscomp.polyfills?$jscomp.polyfills:$jscomp.global;for(var ta=0;ta<U.length-1;ta++){var Y=U[ta];if(!(Y in ha))return;ha=ha[Y]}U=U[U.length-1];W=$jscomp.IS_SYMBOL_NATIVE&&"es6"===W?ha[U]:null;H=H(W);null!=H&&(m?$jscomp.defineProperty($jscomp.polyfills,U,{configurable:!0,writable:!0,value:H}):H!==W&&($jscomp.propertyToPolyfillSymbol[U]=$jscomp.IS_SYMBOL_NATIVE?$jscomp.global.Symbol(U):$jscomp.POLYFILL_PREFIX+
U,U=$jscomp.propertyToPolyfillSymbol[U],$jscomp.defineProperty(ha,U,{configurable:!0,writable:!0,value:H})))};
$jscomp.getConstructImplementation=function(){function m(){function W(){}new W;Reflect.construct(W,[],function(){});return new W instanceof W}if($jscomp.TRUST_ES6_POLYFILLS&&"undefined"!=typeof Reflect&&Reflect.construct){if(m())return Reflect.construct;var H=Reflect.construct;return function(W,ha,U){W=H(W,ha);U&&Reflect.setPrototypeOf(W,U.prototype);return W}}return function(W,ha,U){void 0===U&&(U=W);U=$jscomp.objectCreate(U.prototype||Object.prototype);return Function.prototype.apply.call(W,U,ha)||
U}};$jscomp.construct={valueOf:$jscomp.getConstructImplementation}.valueOf();$jscomp.underscoreProtoCanBeSet=function(){var m={a:!0},H={};try{return H.__proto__=m,H.a}catch(W){}return!1};$jscomp.setPrototypeOf=$jscomp.TRUST_ES6_POLYFILLS&&"function"==typeof Object.setPrototypeOf?Object.setPrototypeOf:$jscomp.underscoreProtoCanBeSet()?function(m,H){m.__proto__=H;if(m.__proto__!==H)throw new TypeError(m+" is not extensible");return m}:null;
$jscomp.inherits=function(m,H){m.prototype=$jscomp.objectCreate(H.prototype);m.prototype.constructor=m;if($jscomp.setPrototypeOf){var W=$jscomp.setPrototypeOf;W(m,H)}else for(W in H)if("prototype"!=W)if(Object.defineProperties){var ha=Object.getOwnPropertyDescriptor(H,W);ha&&Object.defineProperty(m,W,ha)}else m[W]=H[W];m.superClass_=H.prototype};$jscomp.generator={};
$jscomp.generator.ensureIteratorResultIsObject_=function(m){if(!(m instanceof Object))throw new TypeError("Iterator result "+m+" is not an object");};$jscomp.generator.Context=function(){this.isRunning_=!1;this.yieldAllIterator_=null;this.yieldResult=void 0;this.nextAddress=1;this.finallyAddress_=this.catchAddress_=0;this.finallyContexts_=this.abruptCompletion_=null};
$jscomp.generator.Context.prototype.start_=function(){if(this.isRunning_)throw new TypeError("Generator is already running");this.isRunning_=!0};$jscomp.generator.Context.prototype.stop_=function(){this.isRunning_=!1};$jscomp.generator.Context.prototype.jumpToErrorHandler_=function(){this.nextAddress=this.catchAddress_||this.finallyAddress_};$jscomp.generator.Context.prototype.next_=function(m){this.yieldResult=m};
$jscomp.generator.Context.prototype.throw_=function(m){this.abruptCompletion_={exception:m,isException:!0};this.jumpToErrorHandler_()};$jscomp.generator.Context.prototype.return=function(m){this.abruptCompletion_={return:m};this.nextAddress=this.finallyAddress_};$jscomp.generator.Context.prototype.jumpThroughFinallyBlocks=function(m){this.abruptCompletion_={jumpTo:m};this.nextAddress=this.finallyAddress_};$jscomp.generator.Context.prototype.yield=function(m,H){this.nextAddress=H;return{value:m}};
$jscomp.generator.Context.prototype.yieldAll=function(m,H){m=$jscomp.makeIterator(m);var W=m.next();$jscomp.generator.ensureIteratorResultIsObject_(W);if(W.done)this.yieldResult=W.value,this.nextAddress=H;else return this.yieldAllIterator_=m,this.yield(W.value,H)};$jscomp.generator.Context.prototype.jumpTo=function(m){this.nextAddress=m};$jscomp.generator.Context.prototype.jumpToEnd=function(){this.nextAddress=0};
$jscomp.generator.Context.prototype.setCatchFinallyBlocks=function(m,H){this.catchAddress_=m;void 0!=H&&(this.finallyAddress_=H)};$jscomp.generator.Context.prototype.setFinallyBlock=function(m){this.catchAddress_=0;this.finallyAddress_=m||0};$jscomp.generator.Context.prototype.leaveTryBlock=function(m,H){this.nextAddress=m;this.catchAddress_=H||0};
$jscomp.generator.Context.prototype.enterCatchBlock=function(m){this.catchAddress_=m||0;m=this.abruptCompletion_.exception;this.abruptCompletion_=null;return m};$jscomp.generator.Context.prototype.enterFinallyBlock=function(m,H,W){W?this.finallyContexts_[W]=this.abruptCompletion_:this.finallyContexts_=[this.abruptCompletion_];this.catchAddress_=m||0;this.finallyAddress_=H||0};
$jscomp.generator.Context.prototype.leaveFinallyBlock=function(m,H){H=this.finallyContexts_.splice(H||0)[0];if(H=this.abruptCompletion_=this.abruptCompletion_||H){if(H.isException)return this.jumpToErrorHandler_();void 0!=H.jumpTo&&this.finallyAddress_<H.jumpTo?(this.nextAddress=H.jumpTo,this.abruptCompletion_=null):this.nextAddress=this.finallyAddress_}else this.nextAddress=m};$jscomp.generator.Context.prototype.forIn=function(m){return new $jscomp.generator.Context.PropertyIterator(m)};
$jscomp.generator.Context.PropertyIterator=function(m){this.object_=m;this.properties_=[];for(var H in m)this.properties_.push(H);this.properties_.reverse()};$jscomp.generator.Context.PropertyIterator.prototype.getNext=function(){for(;0<this.properties_.length;){var m=this.properties_.pop();if(m in this.object_)return m}return null};$jscomp.generator.Engine_=function(m){this.context_=new $jscomp.generator.Context;this.program_=m};
$jscomp.generator.Engine_.prototype.next_=function(m){this.context_.start_();if(this.context_.yieldAllIterator_)return this.yieldAllStep_(this.context_.yieldAllIterator_.next,m,this.context_.next_);this.context_.next_(m);return this.nextStep_()};
$jscomp.generator.Engine_.prototype.return_=function(m){this.context_.start_();var H=this.context_.yieldAllIterator_;if(H)return this.yieldAllStep_("return"in H?H["return"]:function(W){return{value:W,done:!0}},m,this.context_.return);this.context_.return(m);return this.nextStep_()};
$jscomp.generator.Engine_.prototype.throw_=function(m){this.context_.start_();if(this.context_.yieldAllIterator_)return this.yieldAllStep_(this.context_.yieldAllIterator_["throw"],m,this.context_.next_);this.context_.throw_(m);return this.nextStep_()};
$jscomp.generator.Engine_.prototype.yieldAllStep_=function(m,H,W){try{var ha=m.call(this.context_.yieldAllIterator_,H);$jscomp.generator.ensureIteratorResultIsObject_(ha);if(!ha.done)return this.context_.stop_(),ha;var U=ha.value}catch(ta){return this.context_.yieldAllIterator_=null,this.context_.throw_(ta),this.nextStep_()}this.context_.yieldAllIterator_=null;W.call(this.context_,U);return this.nextStep_()};
$jscomp.generator.Engine_.prototype.nextStep_=function(){for(;this.context_.nextAddress;)try{var m=this.program_(this.context_);if(m)return this.context_.stop_(),{value:m.value,done:!1}}catch(H){this.context_.yieldResult=void 0,this.context_.throw_(H)}this.context_.stop_();if(this.context_.abruptCompletion_){m=this.context_.abruptCompletion_;this.context_.abruptCompletion_=null;if(m.isException)throw m.exception;return{value:m.return,done:!0}}return{value:void 0,done:!0}};
$jscomp.generator.Generator_=function(m){this.next=function(H){return m.next_(H)};this.throw=function(H){return m.throw_(H)};this.return=function(H){return m.return_(H)};this[Symbol.iterator]=function(){return this}};$jscomp.generator.createGenerator=function(m,H){H=new $jscomp.generator.Generator_(new $jscomp.generator.Engine_(H));$jscomp.setPrototypeOf&&m.prototype&&$jscomp.setPrototypeOf(H,m.prototype);return H};
$jscomp.asyncExecutePromiseGenerator=function(m){function H(ha){return m.next(ha)}function W(ha){return m.throw(ha)}return new Promise(function(ha,U){function ta(Y){Y.done?ha(Y.value):Promise.resolve(Y.value).then(H,W).then(ta,U)}ta(m.next())})};$jscomp.asyncExecutePromiseGeneratorFunction=function(m){return $jscomp.asyncExecutePromiseGenerator(m())};$jscomp.asyncExecutePromiseGeneratorProgram=function(m){return $jscomp.asyncExecutePromiseGenerator(new $jscomp.generator.Generator_(new $jscomp.generator.Engine_(m)))};
$jscomp.polyfill("Reflect",function(m){return m?m:{}},"es6","es3");$jscomp.polyfill("Reflect.construct",function(m){return $jscomp.construct},"es6","es3");$jscomp.polyfill("Reflect.setPrototypeOf",function(m){if(m)return m;if($jscomp.setPrototypeOf){var H=$jscomp.setPrototypeOf;return function(W,ha){try{return H(W,ha),!0}catch(U){return!1}}}return null},"es6","es5");$jscomp.initSymbol=function(){};
$jscomp.polyfill("Symbol",function(m){if(m)return m;var H=function(U,ta){this.$jscomp$symbol$id_=U;$jscomp.defineProperty(this,"description",{configurable:!0,writable:!0,value:ta})};H.prototype.toString=function(){return this.$jscomp$symbol$id_};var W=0,ha=function(U){if(this instanceof ha)throw new TypeError("Symbol is not a constructor");return new H("jscomp_symbol_"+(U||"")+"_"+W++,U)};return ha},"es6","es3");
$jscomp.polyfill("Symbol.iterator",function(m){if(m)return m;m=Symbol("Symbol.iterator");for(var H="Array Int8Array Uint8Array Uint8ClampedArray Int16Array Uint16Array Int32Array Uint32Array Float32Array Float64Array".split(" "),W=0;W<H.length;W++){var ha=$jscomp.global[H[W]];"function"===typeof ha&&"function"!=typeof ha.prototype[m]&&$jscomp.defineProperty(ha.prototype,m,{configurable:!0,writable:!0,value:function(){return $jscomp.iteratorPrototype($jscomp.arrayIteratorImpl(this))}})}return m},"es6",
"es3");$jscomp.iteratorPrototype=function(m){m={next:m};m[Symbol.iterator]=function(){return this};return m};
$jscomp.polyfill("Promise",function(m){function H(){this.batch_=null}function W(Y){return Y instanceof U?Y:new U(function(pa,aa){pa(Y)})}if(m&&(!($jscomp.FORCE_POLYFILL_PROMISE||$jscomp.FORCE_POLYFILL_PROMISE_WHEN_NO_UNHANDLED_REJECTION&&"undefined"===typeof $jscomp.global.PromiseRejectionEvent)||!$jscomp.global.Promise||-1===$jscomp.global.Promise.toString().indexOf("[native code]")))return m;H.prototype.asyncExecute=function(Y){if(null==this.batch_){this.batch_=[];var pa=this;this.asyncExecuteFunction(function(){pa.executeBatch_()})}this.batch_.push(Y)};
var ha=$jscomp.global.setTimeout;H.prototype.asyncExecuteFunction=function(Y){ha(Y,0)};H.prototype.executeBatch_=function(){for(;this.batch_&&this.batch_.length;){var Y=this.batch_;this.batch_=[];for(var pa=0;pa<Y.length;++pa){var aa=Y[pa];Y[pa]=null;try{aa()}catch(ea){this.asyncThrow_(ea)}}}this.batch_=null};H.prototype.asyncThrow_=function(Y){this.asyncExecuteFunction(function(){throw Y;})};var U=function(Y){this.state_=0;this.result_=void 0;this.onSettledCallbacks_=[];this.isRejectionHandled_=
!1;var pa=this.createResolveAndReject_();try{Y(pa.resolve,pa.reject)}catch(aa){pa.reject(aa)}};U.prototype.createResolveAndReject_=function(){function Y(ea){return function(ja){aa||(aa=!0,ea.call(pa,ja))}}var pa=this,aa=!1;return{resolve:Y(this.resolveTo_),reject:Y(this.reject_)}};U.prototype.resolveTo_=function(Y){if(Y===this)this.reject_(new TypeError("A Promise cannot resolve to itself"));else if(Y instanceof U)this.settleSameAsPromise_(Y);else{a:switch(typeof Y){case "object":var pa=null!=Y;break a;
case "function":pa=!0;break a;default:pa=!1}pa?this.resolveToNonPromiseObj_(Y):this.fulfill_(Y)}};U.prototype.resolveToNonPromiseObj_=function(Y){var pa=void 0;try{pa=Y.then}catch(aa){this.reject_(aa);return}"function"==typeof pa?this.settleSameAsThenable_(pa,Y):this.fulfill_(Y)};U.prototype.reject_=function(Y){this.settle_(2,Y)};U.prototype.fulfill_=function(Y){this.settle_(1,Y)};U.prototype.settle_=function(Y,pa){if(0!=this.state_)throw Error("Cannot settle("+Y+", "+pa+"): Promise already settled in state"+
this.state_);this.state_=Y;this.result_=pa;2===this.state_&&this.scheduleUnhandledRejectionCheck_();this.executeOnSettledCallbacks_()};U.prototype.scheduleUnhandledRejectionCheck_=function(){var Y=this;ha(function(){if(Y.notifyUnhandledRejection_()){var pa=$jscomp.global.console;"undefined"!==typeof pa&&pa.error(Y.result_)}},1)};U.prototype.notifyUnhandledRejection_=function(){if(this.isRejectionHandled_)return!1;var Y=$jscomp.global.CustomEvent,pa=$jscomp.global.Event,aa=$jscomp.global.dispatchEvent;
if("undefined"===typeof aa)return!0;"function"===typeof Y?Y=new Y("unhandledrejection",{cancelable:!0}):"function"===typeof pa?Y=new pa("unhandledrejection",{cancelable:!0}):(Y=$jscomp.global.document.createEvent("CustomEvent"),Y.initCustomEvent("unhandledrejection",!1,!0,Y));Y.promise=this;Y.reason=this.result_;return aa(Y)};U.prototype.executeOnSettledCallbacks_=function(){if(null!=this.onSettledCallbacks_){for(var Y=0;Y<this.onSettledCallbacks_.length;++Y)ta.asyncExecute(this.onSettledCallbacks_[Y]);
this.onSettledCallbacks_=null}};var ta=new H;U.prototype.settleSameAsPromise_=function(Y){var pa=this.createResolveAndReject_();Y.callWhenSettled_(pa.resolve,pa.reject)};U.prototype.settleSameAsThenable_=function(Y,pa){var aa=this.createResolveAndReject_();try{Y.call(pa,aa.resolve,aa.reject)}catch(ea){aa.reject(ea)}};U.prototype.then=function(Y,pa){function aa(Oa,qa){return"function"==typeof Oa?function(sb){try{ea(Oa(sb))}catch(ob){ja(ob)}}:qa}var ea,ja,Aa=new U(function(Oa,qa){ea=Oa;ja=qa});this.callWhenSettled_(aa(Y,
ea),aa(pa,ja));return Aa};U.prototype.catch=function(Y){return this.then(void 0,Y)};U.prototype.callWhenSettled_=function(Y,pa){function aa(){switch(ea.state_){case 1:Y(ea.result_);break;case 2:pa(ea.result_);break;default:throw Error("Unexpected state: "+ea.state_);}}var ea=this;null==this.onSettledCallbacks_?ta.asyncExecute(aa):this.onSettledCallbacks_.push(aa);this.isRejectionHandled_=!0};U.resolve=W;U.reject=function(Y){return new U(function(pa,aa){aa(Y)})};U.race=function(Y){return new U(function(pa,
aa){for(var ea=$jscomp.makeIterator(Y),ja=ea.next();!ja.done;ja=ea.next())W(ja.value).callWhenSettled_(pa,aa)})};U.all=function(Y){var pa=$jscomp.makeIterator(Y),aa=pa.next();return aa.done?W([]):new U(function(ea,ja){function Aa(sb){return function(ob){Oa[sb]=ob;qa--;0==qa&&ea(Oa)}}var Oa=[],qa=0;do Oa.push(void 0),qa++,W(aa.value).callWhenSettled_(Aa(Oa.length-1),ja),aa=pa.next();while(!aa.done)})};return U},"es6","es3");
$jscomp.checkStringArgs=function(m,H,W){if(null==m)throw new TypeError("The 'this' value for String.prototype."+W+" must not be null or undefined");if(H instanceof RegExp)throw new TypeError("First argument to String.prototype."+W+" must not be a regular expression");return m+""};
$jscomp.polyfill("String.prototype.startsWith",function(m){return m?m:function(H,W){var ha=$jscomp.checkStringArgs(this,H,"startsWith");H+="";var U=ha.length,ta=H.length;W=Math.max(0,Math.min(W|0,ha.length));for(var Y=0;Y<ta&&W<U;)if(ha[W++]!=H[Y++])return!1;return Y>=ta}},"es6","es3");
$jscomp.iteratorFromArray=function(m,H){m instanceof String&&(m+="");var W=0,ha=!1,U={next:function(){if(!ha&&W<m.length){var ta=W++;return{value:H(ta,m[ta]),done:!1}}ha=!0;return{done:!0,value:void 0}}};U[Symbol.iterator]=function(){return U};return U};$jscomp.polyfill("Array.prototype.keys",function(m){return m?m:function(){return $jscomp.iteratorFromArray(this,function(H){return H})}},"es6","es3");
$jscomp.polyfill("Array.from",function(m){return m?m:function(H,W,ha){W=null!=W?W:function(pa){return pa};var U=[],ta="undefined"!=typeof Symbol&&Symbol.iterator&&H[Symbol.iterator];if("function"==typeof ta){H=ta.call(H);for(var Y=0;!(ta=H.next()).done;)U.push(W.call(ha,ta.value,Y++))}else for(ta=H.length,Y=0;Y<ta;Y++)U.push(W.call(ha,H[Y],Y));return U}},"es6","es3");
$jscomp.checkEs6ConformanceViaProxy=function(){try{var m={},H=Object.create(new $jscomp.global.Proxy(m,{get:function(W,ha,U){return W==m&&"q"==ha&&U==H}}));return!0===H.q}catch(W){return!1}};$jscomp.USE_PROXY_FOR_ES6_CONFORMANCE_CHECKS=!1;$jscomp.ES6_CONFORMANCE=$jscomp.USE_PROXY_FOR_ES6_CONFORMANCE_CHECKS&&$jscomp.checkEs6ConformanceViaProxy();$jscomp.owns=function(m,H){return Object.prototype.hasOwnProperty.call(m,H)};
$jscomp.polyfill("WeakMap",function(m){function H(){if(!m||!Object.seal)return!1;try{var ea=Object.seal({}),ja=Object.seal({}),Aa=new m([[ea,2],[ja,3]]);if(2!=Aa.get(ea)||3!=Aa.get(ja))return!1;Aa.delete(ea);Aa.set(ja,4);return!Aa.has(ea)&&4==Aa.get(ja)}catch(Oa){return!1}}function W(){}function ha(ea){var ja=typeof ea;return"object"===ja&&null!==ea||"function"===ja}function U(ea){if(!$jscomp.owns(ea,Y)){var ja=new W;$jscomp.defineProperty(ea,Y,{value:ja})}}function ta(ea){if(!$jscomp.ISOLATE_POLYFILLS){var ja=
Object[ea];ja&&(Object[ea]=function(Aa){if(Aa instanceof W)return Aa;Object.isExtensible(Aa)&&U(Aa);return ja(Aa)})}}if($jscomp.USE_PROXY_FOR_ES6_CONFORMANCE_CHECKS){if(m&&$jscomp.ES6_CONFORMANCE)return m}else if(H())return m;var Y="$jscomp_hidden_"+Math.random();ta("freeze");ta("preventExtensions");ta("seal");var pa=0,aa=function(ea){this.id_=(pa+=Math.random()+1).toString();if(ea){ea=$jscomp.makeIterator(ea);for(var ja;!(ja=ea.next()).done;)ja=ja.value,this.set(ja[0],ja[1])}};aa.prototype.set=function(ea,
ja){if(!ha(ea))throw Error("Invalid WeakMap key");U(ea);if(!$jscomp.owns(ea,Y))throw Error("WeakMap key fail: "+ea);ea[Y][this.id_]=ja;return this};aa.prototype.get=function(ea){return ha(ea)&&$jscomp.owns(ea,Y)?ea[Y][this.id_]:void 0};aa.prototype.has=function(ea){return ha(ea)&&$jscomp.owns(ea,Y)&&$jscomp.owns(ea[Y],this.id_)};aa.prototype.delete=function(ea){return ha(ea)&&$jscomp.owns(ea,Y)&&$jscomp.owns(ea[Y],this.id_)?delete ea[Y][this.id_]:!1};return aa},"es6","es3");$jscomp.MapEntry=function(){};
$jscomp.polyfill("Map",function(m){function H(){if($jscomp.ASSUME_NO_NATIVE_MAP||!m||"function"!=typeof m||!m.prototype.entries||"function"!=typeof Object.seal)return!1;try{var aa=Object.seal({x:4}),ea=new m($jscomp.makeIterator([[aa,"s"]]));if("s"!=ea.get(aa)||1!=ea.size||ea.get({x:4})||ea.set({x:4},"t")!=ea||2!=ea.size)return!1;var ja=ea.entries(),Aa=ja.next();if(Aa.done||Aa.value[0]!=aa||"s"!=Aa.value[1])return!1;Aa=ja.next();return Aa.done||4!=Aa.value[0].x||"t"!=Aa.value[1]||!ja.next().done?
!1:!0}catch(Oa){return!1}}if($jscomp.USE_PROXY_FOR_ES6_CONFORMANCE_CHECKS){if(m&&$jscomp.ES6_CONFORMANCE)return m}else if(H())return m;var W=new WeakMap,ha=function(aa){this.data_={};this.head_=Y();this.size=0;if(aa){aa=$jscomp.makeIterator(aa);for(var ea;!(ea=aa.next()).done;)ea=ea.value,this.set(ea[0],ea[1])}};ha.prototype.set=function(aa,ea){aa=0===aa?0:aa;var ja=U(this,aa);ja.list||(ja.list=this.data_[ja.id]=[]);ja.entry?ja.entry.value=ea:(ja.entry={next:this.head_,previous:this.head_.previous,
head:this.head_,key:aa,value:ea},ja.list.push(ja.entry),this.head_.previous.next=ja.entry,this.head_.previous=ja.entry,this.size++);return this};ha.prototype.delete=function(aa){aa=U(this,aa);return aa.entry&&aa.list?(aa.list.splice(aa.index,1),aa.list.length||delete this.data_[aa.id],aa.entry.previous.next=aa.entry.next,aa.entry.next.previous=aa.entry.previous,aa.entry.head=null,this.size--,!0):!1};ha.prototype.clear=function(){this.data_={};this.head_=this.head_.previous=Y();this.size=0};ha.prototype.has=
function(aa){return!!U(this,aa).entry};ha.prototype.get=function(aa){return(aa=U(this,aa).entry)&&aa.value};ha.prototype.entries=function(){return ta(this,function(aa){return[aa.key,aa.value]})};ha.prototype.keys=function(){return ta(this,function(aa){return aa.key})};ha.prototype.values=function(){return ta(this,function(aa){return aa.value})};ha.prototype.forEach=function(aa,ea){for(var ja=this.entries(),Aa;!(Aa=ja.next()).done;)Aa=Aa.value,aa.call(ea,Aa[1],Aa[0],this)};ha.prototype[Symbol.iterator]=
ha.prototype.entries;var U=function(aa,ea){var ja=ea&&typeof ea;"object"==ja||"function"==ja?W.has(ea)?ja=W.get(ea):(ja=""+ ++pa,W.set(ea,ja)):ja="p_"+ea;var Aa=aa.data_[ja];if(Aa&&$jscomp.owns(aa.data_,ja))for(aa=0;aa<Aa.length;aa++){var Oa=Aa[aa];if(ea!==ea&&Oa.key!==Oa.key||ea===Oa.key)return{id:ja,list:Aa,index:aa,entry:Oa}}return{id:ja,list:Aa,index:-1,entry:void 0}},ta=function(aa,ea){var ja=aa.head_;return $jscomp.iteratorPrototype(function(){if(ja){for(;ja.head!=aa.head_;)ja=ja.previous;for(;ja.next!=
ja.head;)return ja=ja.next,{done:!1,value:ea(ja)};ja=null}return{done:!0,value:void 0}})},Y=function(){var aa={};return aa.previous=aa.next=aa.head=aa},pa=0;return ha},"es6","es3");$jscomp.findInternal=function(m,H,W){m instanceof String&&(m=String(m));for(var ha=m.length,U=0;U<ha;U++){var ta=m[U];if(H.call(W,ta,U,m))return{i:U,v:ta}}return{i:-1,v:void 0}};$jscomp.polyfill("Array.prototype.findIndex",function(m){return m?m:function(H,W){return $jscomp.findInternal(this,H,W).i}},"es6","es3");
var svManager={getInstance:function(){var m=window.$rdp;return m&&m.running&&m.running()?m:null}};svGlobal.getInstance=svManager.getInstance;
function connvertServer(m){var H={};H.id=m.id;H.server=m.id;H.displayName=m.displayName||m.id;if(m=m.rdp){for(var W in m)H[W]=m[W];H.user=m.username||"";H.pwd=m.password||"";H.useConsole=m.console||!1;H.legacyMode=m.leagacyMode||m.legacyMode||!1;H.server_bpp=m.color||16;H.exe=m.remoteProgram||"";H.args=m.remoteArgs||"";H.startProgram=0<H.exe.length?"app":H.command&&0<H.command.length?"shell":"noapp"}return H}
function Rdp2(m){m=svGlobal.util.getServerArgs(m);if(!m||!m.gateway)return hi5.notifications.notify({msg:__svi18n.noauth}),null;var H=m.gateway||"",W=0,ha=0,U=16,ta=1==m.useSSL||"true"==m.useSSL||"on"==m.useSSL||null;m.width&&(W=parseInt(m.width,10));m.height&&(ha=parseInt(m.height,10));m.color&&(U=parseInt(m.color,10));m.server_bpp&&(U=parseInt(m.server_bpp,10));m=hi5.browser.obj2url(m);null===ta&&(ta="https:"==location.protocol);return new Rdp((ta?"wss://":"ws://")+H+"/RDP?"+m,W,ha,U)}
svGlobal.Rdp2||(svGlobal.Rdp2=Rdp2);
function Rdp(m,H,W,ha){function U(a){return"on"==a||"true"==a||1==a}function ta(){var a=n.gateway;n.ongetgatewayaddress&&(a=n.ongetgatewayaddress(a));return a}function Y(){var a=hi5.storage.get("SV_CONN_SHARE_ID");a||(a=hi5.tool.uuid(),hi5.storage.set("SV_CONN_SHARE_ID",a));return a}function pa(a,b){a=fa[a]||b;a.startsWith("/")||a.toLowerCase().startsWith("http")||(a=hi5.libPath+a);return a}function aa(){return P.displayName||P.server||P.symlink||P.id||"undefined"}function ea(a){n.loadbalanceToken||
(n.loadbalanceToken=fa.loadbalanceTokenName?fa.loadbalanceTokenName+"="+a:"")}function ja(a,b,d){n.ontitlechange&&(a=n.ontitlechange(a,d));n.setTitle&&a&&(b=b||window,b.document.title=a)}function Aa(a,b){switch(a){case 16:case 8:case 24:case 32:break;case 15:return P.invitation||n.showMessage("15 bit color is not supported anymore."),!1;default:return!1}fb=a;b&&(Ka?Ka.postMessage({type:0,cmd:1,data:a}):Ca&&Ca.setColor(a));return!0}function Oa(a,b,d,e){Ia=a;Ja=b;Wb=Xb=0;Yb=Ia-1;Zb=Ja-1;Wa&&(Ia=(P.waWidth||
hi5.browser.getScreenWidth())|0,Ja=(P.waHeight||hi5.browser.getScreenHeight())|0);P.minWidth&&Ia<P.minWidth&&(Ia=P.minWidth|0);P.minHeight&&Ja<P.minHeight&&(Ja=P.minHeight|0);Ia&=-4;Ja&=-4;svGlobal.logger.warn("resolution changed, w:"+Ia+" h:"+Ja);var c=Ia,g=Ja;oa?oa.resize(c,g):oa=new yc(c,g);ba.setSize(Ia,Ja,Wa?"hidden":null);if(d||Ia!=a||Ja!=b)Ka?Ka.postMessage({type:0,cmd:2,data:{w:Ia,h:Ja}}):Ca&&Ca.setResolution(Ia,Ja);if(n.onresolutionchange&&!e)n.onresolutionchange(a,b)}function qa(a){!bb&&
Ha&&(Ka?($b.data=a,"string"!=typeof a?Ka.postMessage($b,[a]):Ka.postMessage($b)):Ca.writeRawInput(a))}function sb(a){switch(a){case "\r":break;case "\n":n.writeScancode(28);break;case "\t":n.writeScancode(15);break;default:qa("86"+a)}}function ob(a){var b=this;a||(a=143);this.send=function(d){var e=!!d.buffer,c=e?d:d.getData(),g=64==a;d=e?c.length:d.getEnd()||c.length;d<c.length&&(c=e?c.subarray(0,d):c.slice(0,d));e=g?5:9;d=new Uint8Array(e+d);d[0]=a;if(g)d[1]=b.id,d[2]=b.id>>8,d[3]=b.id>>16,d[4]=
b.id>>24;else{g=b.name;for(var p=Math.min(g.length,8),I=0;I<p;I++)d[1+I]=g.charCodeAt(I)}d.set(c,e);qa(d.buffer)};this.name="";this.count=this.id=this.flags=0}function Gb(a){if(n){var b=__svi18n.errorCode[a];a={name:a,message:b,msg:b};n.displayMsg&&n.showMessage(a);0<svGlobal.log&&console.error&&console.error(a);if(n.onerror)n.onerror(a)}}function zc(a){if(n){var b=__svi18n.info[a];b||(b="info "+a);n.displayMsg&&n.showMessage(b);svGlobal.logger.info(b)}}function ac(){var a=Ha;pb=Ha=!1;Ka?Ka.postMessage({type:0,
cmd:3}):Ca&&Ca.resetStatus();a&&(Ha=a)}function bc(a){Ma||(Ma=new hi5.file.UploadManager(new hi5.file.WsFileService(qa)),Ma.addEvent("beforeupload",function(b,d,e){if(n.beforeupload)return n.beforeupload(b,d,e)}),Ma.addEvent("fileuploaded",function(b,d,e){if(n.onfileuploaded)n.onfileuploaded(b,d,e)}),Ma.addEvent("uploaded",function(b,d){if(n.onuploaded)n.onuploaded(b,d)}),Ma.addEvent("uploadingCancelled",function(){if(n.onuploadingCancelled)n.onuploadingCancelled()}));a.setFileHandler(Ma)}function Ac(a,
b,d){var e=!1;this.exe=a;this.args=b||"";this._dir=d||"";var c=this;this.close=function(){!e&&Ha&&(e=!0,qa("8C5"+c.exe+"\t"+c.args+"\t"+n.sessionInfo.appInfo.session))}}function ud(){var a=window.opener;if(a)try{if(a.__sparkUser&&a.__sparkUser.session)return a.__sparkUser;if(a.opener&&a.opener.__sparkUser.session)return a.opener.__sparkUser}catch(b){}return null}function Bc(){var a;return void 0!==(null==(a=window)?void 0:a.PublicKeyCredential)&&"function"===typeof window.PublicKeyCredential}function Hb(a){a=
(new Uint8Array(a)).buffer;return CBOR.decode(a)}function vd(a,b,d){var e={};if(b&&b.attachment)switch(b.attachment){case 1:var c="platform";break;case 2:c="cross-platform"}c&&(e.authenticatorAttachment=c);c={};b&&(b.requireResident?b.requireResident&&(c.requireResidentKey=!0,c.residentKey="required"):b.preferResident&&b.preferResident&&(c.requireResidentKey=!0,c.residentKey="preferred"));d&&d.rk&&(d.rk?(c.requireResidentKey=!0,c.residentKey="required"):(c.requireResidentKey=!1,c.residentKey=void 0));
c&&(c.requireResidentKey&&(e.requireResidentKey=c.requireResidentKey),c.residentKey&&(e.residentKey=c.residentKey));if(a=Cc(a,b,d))e.userVerification=a;if(Object.keys(e).length)return e}function Dc(a){var b=[];if(a){a=$jscomp.makeIterator(a);for(var d=a.next();!d.done;d=a.next()){var e=d.value;d={};e.id&&(d.id=e.id);e.type&&(d.type=e.type);if(e.transports){var c=d;e=e.transports;var g=[];e&1?g.push("usb"):e&2?g.push("nfc"):e&4?g.push("ble"):e&16?g.push("internal"):e&32&&g.push("hybrid");c.transports=
g}b.push(d)}}return b}function Cc(a,b,d){var e;a&&(a&4194304?e="required":a&8388608?e="preferred":a&16777216&&(e="discouraged"));if(b&&b.userVerification)switch(b.userVerification){case 1:e="required";break;case 2:e="preferred";break;case 3:e="discouraged"}d&&d.uv&&("FALSE"==d.uv.toUpperCase()?e="discouraged":"TRUE"==d.uv.toUpperCase()&&(e="required"));return e}function wd(a){var b={};if(a&&a.attestationPreference)switch(a.attestationPreference){case 0:b.attestation="direct";break;case 1:b.attestation=
"direct";break;case 2:b.attestation="indirect";break;case 3:b.attestation="direct"}if(a&&a.enterpriseAttestation)switch(a.enterpriseAttestation){case 1:b.attestation="enterprise";break;case 2:b.attestation="enterprise"}b.attestationFormats=["packed"];return b}function xd(a,b){var d,e,c,g,p,I,y,E,M,v,x,R,t,z,B,r,Q,u,K,F;return $jscomp.asyncExecutePromiseGeneratorProgram(function(O){if(1==O.nextAddress){d=a.getPublicKeyAlgorithm();console.log("==== publicKeyAlgorithms = "+d);if((e=a.getTransports())&&
0<e.length)for(var S=$jscomp.makeIterator(e),V=S.next();!V.done;V=S.next())V=V.value,"USB"==V.toUpperCase()||"NFC"==V.toUpperCase()||"BLE"==V.toUpperCase()||"INTERNAL"==V.toUpperCase()||V.toUpperCase();if(c=a.attestationObject)console.log("==== attestationObj bytes: "+tb(new Uint8Array(c))),p=Hb(c),g=p.attStmt;if(I=a.clientDataJSON)console.log("==== clientDataJson bytes: "+tb(new Uint8Array(I))),y=window.origin,E=(new TextDecoder).decode(I),M=JSON.parse(E),M.origin&&(M.origin=y);v=a.getAuthenticatorData();
if(!v)return O.jumpTo(0);x=new Uint8Array(v);console.log("==== authenticatorData bytes: "+tb(x));return b?(R=b.id)?O.yield(yd(R),5):O.jumpTo(0):O.jumpTo(0)}t=O.yieldResult;z=new Uint8Array(t);console.log("==== hash of realRpID: "+tb(z));B=new hi5.DataBuffer(new Uint8Array(x.byteLength));B.setBytes(z);r=x.slice?x.slice(32,x.length):x.subarray(32,x.length);B.setBytes(r);B.markEnd();Q=B.getData();console.log("==== newAuthDataBytes: "+tb(new Uint8Array(Q)));u={1:"packed",2:Q,3:g};K=CBOR.encode(u);F=new hi5.DataBuffer(new Uint8Array(K.byteLength+
1));F.setByte(0);F.setBytes(K);F.markEnd();return O.return(F.getData())})}function yd(a){var b;return $jscomp.asyncExecutePromiseGeneratorProgram(function(d){b=(new TextEncoder).encode(a);return d.return(zd(b))})}function zd(a){var b;return $jscomp.asyncExecutePromiseGeneratorProgram(function(d){if(1==d.nextAddress)return d.yield(crypto.subtle.digest("SHA-256",a),2);b=d.yieldResult;return d.return(b)})}function tb(a){return Array.from(a,function(b){return("0"+(b&255).toString(16)).slice(-2)}).join(", ")}
function Ad(){var a=0,b=0,d=new n.GatewayChannel;d.name="MESSGSTB";d.onopen=function(){svGlobal.logger.info("Message Channel open")};d.process=function(e){if(0==e.getByte())e.getByte(),e.getByte(),e.getByte();else{var c=e.getByte(),g=e.getLittleEndian16(),p=e.getLittleEndian16();if(0!=c)svGlobal.logger.warn("Invalid AUTODETECT_REQUEST");else switch(p){case 1:case 4097:p=new RdpBuffer(new Uint8Array(6),0,6);p.setByte(6);p.setByte(1);p.setLittleEndian16(g);p.setLittleEndian16(0);p.markEnd();d.send(p);
break;case 20:case 276:case 4116:a=6;b=Date.now();break;case 2:g=e.getLittleEndian16();a+=g;break;case 43:case 1065:case 1577:43==p&&(c=e.getLittleEndian16(),a=a+c+8,e.skipPosition(c));e=e.has(4)?e.getLittleEndian32():0;a+=e;e=Date.now()-b;c=new RdpBuffer(new Uint8Array(14),0,14);c.setByte(14);c.setByte(1);c.setLittleEndian16(g);c.setLittleEndian16(43==p?3:11);c.setLittleEndian32(e);c.setLittleEndian32(a);c.markEnd();d.send(c);break;case 2112:case 2176:case 2240:g=e.getLittleEndian32();p=e.getLittleEndian32();
e=e.getLittleEndian32();Ib={baseRTT:g,bandwidth:p,averageRTT:e};if(n.onnetworkresult)n.onnetworkresult(Ib);svGlobal.logger.warn("Network Characteristics Result:");svGlobal.logger.warn(Ib);break;default:svGlobal.logger.warn("Invalid network detect PDU",e)}}};d.onclose=function(){svGlobal.logger.info("MSG channel close")};n.addGatewayChannel(d)}function Bd(a,b,d,e,c){cc.set(a,b);dc.set(a,e);b="<b>User:&nbsp;</b>"+d+"&nbsp;("+e+")&nbsp;&nbsp;&nbsp;&nbsp;<b>Expire Date:</b> "+c;d=document.createElement("div");
e=document.createElement("input");e.type="radio";e.name="scard_name";e.value=a;0==a&&(e.defaultChecked=!0);d.appendChild(e);d.innerHTML+=b;d.innerHTML+="<br>";return d}function Cd(a,b){var d=document.createElement("div"),e=document.createElement("input");e.type="radio";e.name="ds_name";e.value=a;0==a&&(e.defaultChecked=!0);d.appendChild(e);d.innerHTML+=b;d.innerHTML+="<br>";return d}function Ec(){var a="";P&&U(P.connectif)&&P.symlink&&"sessionStorage"in window&&(a="SV_"+P.symlink,P.domain&&(a+=P.domain),
P.user&&(a+=P.user));return a}function Dd(){var a=hi5.appcfg.persistentId?window.localStorage:window.sessionStorage;if(!a)return"";var b=a.getItem("appInfo.session");if(!b)return"";b="&_session="+b;(a=a.getItem("appInfo.numericId"))&&(b+="&_numericId="+a);return b}function ec(){if(!Ha){pb=!1;var a="";bb?Ea.init(!1,!0,!1,0,!1,!1):a=n.getRuntimeURL();void 0==fa.wsPost&&(fa.wsPost=!1);n.oncreatewebsocket&&(Ka=null);Ka?(bb&&(bb.onopen=fc,bb.onclose=zb,bb.onmessage=function(d){gc.data=d.data;Ka.postMessage(gc,
[gc.data])}),Ka.postMessage({type:0,cmd:0,data:{addr:a,width:Ia,height:Ja,server_bpp:fb,libPath:hi5.libPath,libMin:hi5.libMin,wsPost:fa.wsPost}})):(Ca=new RdpGeneral(bb||a,Ia,Ja,fb,oa,!1,fa.wsPost),Ca.oncreatewebsocket=n.oncreatewebsocket,Ca.run());Ka?Ka.addEventListener("message",Fc,!1):(Ca.onopen=fc,Ca.onmessage=Gc,Ca.onclose=zb,Ca.onerror=Gb,Ca.oninfo=zc,Ca.onloggedin=hc,Ca.onresolutionchange=function(d,e){Oa(d,e,!1,P.monitorDef&&0<=P.monitor?!0:!1)},Ca.onAltSecWindows=Hc,Ca.onMoveCursor=ic,Ca.onCloseSurface=
Ic,Ca.onColorChange=Aa,Ca.onHistoryReceived=function(){jc()},Ca.onLockKeyState=function(d){if(n.onLockKeyState)n.onLockKeyState(d)});if(a=ba.getSurface(ba.size()-1))Wa?a&&(a.remoteApp=new Ac(P.exe,P.args,"")):ja(aa(),a.getWindow());if(P.invitation&&!U(P.shadow)){var b=null;a&&(b=a.initChat(P.expert));Ab=new n.GatewayChannel;Ab.name="C_H_A_T";Ab.process=function(d){d=d.getUnicodeString(d.getEnd()-d.getPosition(),!0);b&&b.add(d,P.novice)};b&&(b.onchat=function(d){if(Ha){var e=Array(2*d.length);e=new hi5.DataBuffer(e,
0,e.length);e.setUnicodeString(d);e.markEnd();Ab.send(e)}});n.addGatewayChannel(Ab)}}}function Fc(a){a=a.data;switch(a.type){case 1:switch(a.event){case 0:fc();break;case 1:zb(a.expected);break;case 2:Gb(a.code);break;case 3:zc(a.code);break;case 4:hc();break;case 5:Oa(a.w,a.h,!1,P.monitorDef&&0<=P.monitor?!0:!1);break;case 6:ic(a.x,a.y,!0);break;case 7:Ic();break;case 8:0==a.id&&jc();Pa&&Pa.check(1<a.id?15555:0);break;case 9:Aa(a.color);break;case 10:if(n.onLockKeyState)n.onLockKeyState(a.state);
break;default:svGlobal.logger.warn("Invalid worker event "+a.type)}break;case 2:oa.setRGBs(a.x,a.y,a.w,a.h,a.pixel,a.offset,a.scansize);break;case 3:oa.moveArea(a.srcx,a.srcy,a.cx,a.cy,a.dx,a.dy);break;case 5:oa.fillRect(a.l,a.t,a.w,a.h,a.color);break;case 6:oa.drawLine(a.x1,a.y1,a.x2,a.y2,a.color);break;case 7:oa.bitBlt(a.opcode,a.dstwidth,a.x,a.y,a.cx,a.cy,a.src,a.srcwidth,a.srcx,a.srcy);break;case 8:oa.drawLineExt(a.x1,a.y1,a.x2,a.y2,a.color,a.opcode);break;case 9:Jc(a);break;case 10:Gc(a);break;
case 11:Va.attach(a.data,0,a.data.length);Hc(Va,a.size);break;case 12:oa.drawText(a.font,a.flags,a.mixmode,a.foregroundColor,a.backgroundColor,a.clipLeft,a.clipTop,a.clipcx,a.clipcy,a.boxLeft,a.boxTop,a.boxcx,a.boxcy,a.x,a.y,a.length,a.text,a._left,a._top,a._right,a._bottom);break;case 13:oa.drawBitmap(a.cacheID,a.cacheIDX,a.x,a.y,a.cx,a.cy,a.srcx,a.srcy,a.opcode);break;case 14:oa.saveDesktop(a.x,a.y,a.cx,a.cy,a.offset);break;case 15:oa.restoreDesktop(a.x,a.y,a.cx,a.cy,a.offset);break;case 16:oa.putFont(a.font,
a.character,a.glyph);break;case 17:oa.putCursor(a.idx,a.cursor);break;case 18:oa.setCursor(a.idx);break;case 19:oa.getHistory(qa,function(){Ka.postMessage({type:0,cmd:7})});Pa&&Pa.check(15555);break;case 20:Va.attach(a.data,a.off,a.data.length-a.off);oa.setHistory(a.order,Va);break;case 21:oa.putBitmap(a.id,a.idx,a.bitmap);break;default:svGlobal.logger.warn("Invalid worker msg "+a.type)}}function Kc(a){Pa&&Pa.check(a)}function fc(){Ha=!0;var a="87"+navigator.userAgent+"\t";Jb=hi5.tool.uuid();document.cookie=
Jb+"=sv";qa(a+Jb);if(n.onopen)n.onopen();fa.joinCloseMode&&n.setJoinCloseMode(fa.joinCloseMode)}function Ic(){ba&&ba.close()}function Gc(a){var b=a.data;if("string"!=typeof b){a=new Uint8Array(b);Va.attach(a,0,b.byteLength);var d=Va.getLittleEndian16();switch(d){case 28:a=Va;b=a.getAscllString(8);d=ib[b];null!=d?d.process(a):svGlobal.logger.warn("Channel "+b+" not found");break;case 55:a=Va;switch(a.getByte()){case 0:Da.tag=a.getLittleEndian16();Da.channels=a.getLittleEndian16();Da.samplePerSec=a.getLittleEndian32();
a.skipPosition(6);Da.bitsPerSample=a.getLittleEndian16();svGlobal.logger.info("Audio Format, tag="+Da.tag+" channels="+Da.channels+" bitsPerSample="+Da.bitsPerSample+" samplePerSec="+Da.samplePerSec);Ka&&Ka.postMessage({type:0,cmd:5,data:{tag:Da.tag,channels:Da.channels,samplePerSec:Da.samplePerSec,bitsPerSample:Da.bitsPerSample}});41222==Da.tag&&(Da.sampleRate=Da.samplePerSec,Qa.initMediaPlayer(Qa,Da,!1));break;case 1:b=a.getByte();d=a.getLittleEndian16();var e=Date.now();a.skipPosition(8);kc(a,
b,d,0);jb||(d+=Date.now()-e,qa("8A"+b+","+d))}Pa&&Pa.check();break;case 56:Lc(Va.getUnicodeString(Va.getEnd()-Va.getPosition(),!1));break;case 60:Mc(Va);break;case 62:Nc(Va.getUnicodeString(Va.getEnd()-Va.getPosition(),!1));break;case 63:Oc(Va);Pa&&Pa.check();break;case 64:b=Va;d=b.getByte();a=b.getLittleEndian32();switch(d){case 1:b=b.getAscllString();if(Ea[b]){if(svGlobal.logger.info("DVC create, name:"+b+" id:"+a),Ea[b].newInstance?(Ea[a]=Ea[b].newInstance(),Ea[a].id=a):(Ea[b].id=a,Ea[a]=Ea[b]),
Ea[a].onopen)Ea[a].onopen()}else svGlobal.logger.info("DVC create, name not found:"+b+" id:"+a);break;case 3:Ea[a]&&Ea[a].process(b);break;case 4:if(Ea[a]&&Ea[a].onclose)Ea[a].onclose();svGlobal.logger.info("close DVC, id:"+a)}Pa&&Pa.check();break;case 146:Ed(Va);break;default:if(n.onunknownmessage)n.onunknownmessage(d,Va);else svGlobal.logger.warn("@TODO:"+d+"\n")}}else switch(d=parseInt(b.substring(0,2),16),a=b.substring(2),d){case 0:qa("87"+navigator.userAgent);break;case 15:if(n){lc=!1;ub=n.reconnectTimes;
(n&&0==n.mode||U(P.connectif))&&jc();b="";for(b in kb)if((d=kb[b])&&d.onopen)d.onopen();for(b in ib)if((d=ib[b])&&d.onopen)d.onopen();a&&(a=JSON.parse(a),a.capability&&n&&(n.sessionInfo.suppressOutput=!!a.capability.suppressOutput))}break;case 26:b=JSON.parse(a);if(b.name){isNaN(b.name)||(b.name="S"+b.name);b.message||(b.message=b.msg);if(n.onnotify)n.onnotify(b);svGlobal.logger.info("msg="+a);if(2==b.type&&n.onerror)n.onerror(b);if(a=__svi18n.errorCode[b.name])b.msg=a+" "+b.msg;n.showMessage(b)}else 0<
svGlobal.log&&console.erro("No error code for message:"+a);break;case 27:ba.drawLicense(a);break;case 50:if(Ha)switch(b=parseInt(a.substring(0,1),10),a=a.substring(1),b){case 1:Fd(a);break;case 2:Bb?(Bb.type==a?n.writeRawInput("881"+a+"\t"+Bb.text):n.writeRawInput("881ERROR\t"),Bb=null):!(b=ba.getFocused())||b.processClipReq(a)||!fa.clipWarnAlways&&Pc||!P||P.leagacyMode||(n.showMessage(__svi18n.info.menucopy,null,5E3),Pc=!0);break;case 5:(b=ba.getFocused())&&"0"!=a&&b.setIgnorePaste(!0)}break;case 51:ba.setReadOnly("1"==
a);break;case 54:b=a.split("\t");a=ta()+b[0];a=n.modifyURL(a);svGlobal.logger.info("Downloading file:"+a+" name:"+b[1]+" driver:"+b[2]);n.onprintingready&&n.onprintingready({link:a,printerName:b[1],pinterDriver:b[2]})||(b=ba.getFocused())&&b.showPDF(a);break;case 56:Lc(a);break;case 57:b=a.split("\t");svGlobal.logger.debug(a);if(a=ba.getWinById(parseInt(b[0]))){if(!ba.hasApp(b[1])){(d=ba.getOwnerSurface(a))&&d.railWin&&(d.railWin.appId=b[1],d.railWin.addApp(b[1]));if(n.onremoteappstart)n.onremoteappstart({id:b[1]});
if(a.isVisible()&&a.titleInfo&&n.ontitlechange)n.ontitlechange(d.railWin.getFullTitle(a.id),b[1])}a.appId=b[1]}break;case 58:Gd(a);break;case 59:a=hi5.Base64.dec(a,0);cb=(new RdpBuffer(a,0,a.length)).getLittleEndian32();jb||!(cb&16||cb&65536)?(Kb=!1,Ma=null):(cb&16&&(Kb=!0),Ma||(a=ba.getFocused())&&bc(a));cb&64&&n.showMessage(__svi18n.info.recording);Ma&&(Ma.setUpload(!(cb&128)),Ma.setDownload(!(cb&131072)),Ma.canCopyFile=0!=(cb&65536));ba.execute("setFeature",[cb]);break;case 60:Mc(b64ToBuffer(a));
break;case 61:a=JSON.parse(a);switch(a.type){case 0:Oa(a.width,a.height,!0,!1);Aa(a.color);(b=a.server)&&n&&(n.server=a.server);Qc=a.length;d=ba.getFocused();Wa=1==a.isRail;d&&(1!=n.mode&&d.setAutoScale(!Wa),b&&ja(aa(),d.getWindow()),b=a.keyboard,"undefined"!=typeof b&&0==b&&d.setUnicode(!0),b=a.mapDisk)&&(Kb=!0,bc(d));if(n.onopened)n.onopened(a);break;case 1:a=a.duration;if(n.onprogress)n.onprogress(a,Qc);break;case 2:2==a.status?(ac(),Ha=!0):(b=0==a.status,b==oa.isPaused()||n.onsessionpause&&n.onsessionpause(b,
a)||(oa.pause(b),b||ba.repaint(0,0,oa.width-1,oa.height-1),a.warn&&n.showMessage(b?__svi18n.info.sessionPaused:__svi18n.info.sessionResumed)))}break;case 62:Nc(a);break;case 63:Oc(b64ToBuffer(a));break;default:if(n.onunknownmessage)n.onunknownmessage(d,a);else svGlobal.logger.warn("@TODO:"+b+"\n")}}function jc(){if(!jb&&!Xa&&(Xa=!0,n&&(fa.pingInterval&&n.startPing(fa.pingInterval),n.onready)))n.onready()}function Ed(a){var b=a.getByte();switch(b){case 0:a=new Uint8Array(2);a[0]=146;a[1]=1;qa(a.buffer);
break;case 1:break;case 5:b=a.getByte();a=a.getLittleEndian32();0!=b||a&4||(cb^=65536,ba.execute("setFeature",[cb]));break;case 6:Ra.remoteLockFlags=a.getLittleEndian32();Ra.checkLockFlags=!0;if(n.onLockKeyState)n.onLockKeyState({capsLock:0!=(Ra.remoteLockFlags&4),numLock:0!=(Ra.remoteLockFlags&2),scrollLock:0!=(Ra.remoteLockFlags&1)},{capsLock:0!=(Ra.localLockFlags&4),numLock:0!=(Ra.localLockFlags&2),scrollLock:0!=(Ra.localLockFlags&1)});svGlobal.logger.info("remoteLockFlags: "+Ra.remoteLockFlags);
break;case 7:b=a.getByte();n.sessionInfo.appInfo.twoFAEnabled=0<b;switch(b){case 0:b=a.getByte();var d=a.getLittleEndian32();a=a.getBytes(d);n.sessionInfo.appInfo.twoFAQR=a;n.ontwofaqr&&n.ontwofaqr(a)||2==b&&ba.execute("showTwoFAQR");break;case 1:oa.pause(!0,!0);if(n.ontwofacode&&n.ontwofacode())return;(a=ba.getFocused())&&a.showTwoFACode();break;case 2:if(b=a.getByte(),a=1==a.getByte(),(!n.ontwofaresult||!n.ontwofaresult(b,a))&&Ra.onauthcoderesult)Ra.onauthcoderesult(b,a)}break;case 8:b=a.getByte();
if(a=ba.getFocused()){d="image/png";switch(b){case 1:d="image/jpeg";break;case 2:d="image/webp"}a.getSnapshot(function(e){e.bytes().then(function(c){var g=new Uint8Array(2+c.length);g[0]=146;g[1]=8;g.set(c,2);qa(g.buffer)})},d)}break;default:svGlobal.logger.warn("Invalid Client Control: "+b)}}function Hd(a,b){var d=0,e=!1;this.width=a;this.interval=b;var c=0;this.start=function(){e||(e=!0,d=setInterval(function(){var g=ba.getFocused();g&&Ha&&(g=g.getThumbnail(a))&&g.length!=c&&(qa("8E7"+g),c=g.length)},
b))};this.stop=function(){clearInterval(d)}}function Id(a,b){!Ya||Ya.width==a&&Ya.interval==b||(Ya.stop(),Ya=null);Ya||(Ya=new Hd(a,b));Ya.start()}function Oc(a){var b=a.getAscllString(8);(b=kb[b])&&b.process&&b.process(a)}function Nc(a){var b=parseInt(a.substring(0,1),16),d=a.substring(1);a=!1;var e=n.sessionInfo.appInfo;switch(b){case 0:var c=JSON.parse(d);ac();Ha=!0;a=c.width;e=c.height;if(a==Ia&&e==Ja)break;Oa(a,e,!1,!1);break;case 1:c=JSON.parse(d);n.sessionInfo.joinedSessions.push(c.numericId);
n.sessionInfo.joiners.push(c);e.sessions[c.numericId]=c.name||c.__ip;if(!e.joined||fa.alertJoin)n.onsessionjoin&&(a=n.onsessionjoin(c)),!a&&__svi18n.info.joinsession&&n.showMessage(__svi18n.info.joinsession.applyArgs([c.numericId,c.__ip,c.name]));break;case 2:c=JSON.parse(d);n.sessionInfo.joinedSessions.removeElm(c.numericId);delete e.sessions[c.numericId];b=n.sessionInfo.joiners;d=0;for(var g=b.length;d<g;d++)if(b[d].numericId==c.numericId){b.splice(d,1);break}if(!e.joined||fa.alertJoin)n.onsessionexit&&
(a=n.onsessionexit(c)),!a&&__svi18n.info.exitsession&&n.showMessage(__svi18n.info.exitsession.applyArgs([c.numericId,c.__ip,c.name]));break;case 3:c=JSON.parse(d);e.joinMode!=c.mode&&(e.joinMode=c.mode,b=hi5.$("joinSelect"))&&(b.value=c.mode);if(e.hasControl)break;e.hasControl=!0;ba.setReadOnly(!1,2==c.mode);if(e=hi5.$("requestControl"))e.disabled=!0;n.ongivecontrol&&(a=n.ongivecontrol());if(a)break;n.showMessage(__svi18n.info.givecontrol,null,5E3);break;case 4:c=JSON.parse(d);ba.setReadOnly(!0,2==
c.mode);e.hasControl=!1;if(e=hi5.$("requestControl"))e.disabled=!1;n.ontakebackcontrol&&(a=n.ontakebackcontrol());if(a)break;n.showMessage(__svi18n.info.nocontrol,null,5E3);break;case 5:c=JSON.parse(d);n.onrequirecontrol&&(a=n.onrequirecontrol(c));if(a)break;a=__svi18n.info.title.applyArgs([c.name,c.numericId,c.__ip]);e=__svi18n.info.recontrol;oa.isPaused&&(e+="<br><br>"+(__svi18n.info.autoresume||""));n.showMessage({title:a,msg:e,cbYes:function(){n.giveControl(c.numericId);this.destroy();oa.isPaused()&&
n.pauseSession(n.sessionInfo.appInfo.numericId,!1)},cbNo:function(){n.refuseControl(c.numericId);this.destroy()}});break;case 6:ba.execute("setTouchRemoting",[!0]);break;case 7:c=JSON.parse(d);c.width&&c.height&&Oa(c.width,c.height,!0,P.monitorDef&&0<=P.monitor?!0:!1);c.color&&(Aa(c.color,!0),svGlobal.logger.warn("Color depth changed to:"+c.color));c.version&&(n.sessionInfo.protocolVersion=c.version);break;case 8:c=JSON.parse(d);lc=!0;if(n.onrequestcredential&&n.onrequestcredential(c,Ra.reconnect))break;
if(n.onautherror&&n.onautherror(c,Ra.reconnect))break;ba.getFocused().requestCredential(c,Ra.reconnect);break;case 9:c=JSON.parse(d);0<c.interval&&0<c.width?Id(c.width,c.interval):Ya&&(Ya.stop(),Ya=null);break;case 11:c=JSON.parse(d);n.onrequirejoin&&(a=n.onrequirejoin(c));if(a)break;a=__svi18n.info.title.applyArgs([c.name,c.numericId,c.__ip]);n.showMessage({title:a,msg:__svi18n.info.reqjoin,cbYes:function(){n.allowJoin(c.numericId,!0);this.destroy()},cbNo:function(){n.allowJoin(c.numericId,!1);this.destroy()}});
break;case 13:c=JSON.parse(d);"login"==c.type&&hc();break;case 14:if(c=JSON.parse(d),n.oncontrolchange)n.oncontrolchange(c)}}function Mc(a){switch(a.getByte()){case 32:if(!oa.isPaused()){var b=a.getLittleEndian16(),d=a.getLittleEndian16(),e=a.getLittleEndian16(),c=void 0,g=void 0;fa.noCursorName||(c=a.getLittleEndian32(),n.sessionInfo.appInfo&&(g=n.sessionInfo.appInfo.sessions[c]));ic(d,e,!0,g,c,b)}}}function ic(a,b,d,e,c,g){oa.isPaused()||ba.getFocused().moveCursor(a,b,d,e,c,g)}function Jc(a){ba.setCursor(a)}
function Jd(a){var b=fa.page&&fa.page.join||"";if(b.startsWith("http://")||b.startsWith("https://"))return b;if(b.startsWith("/"))return location.origin+b;var d=location.href,e=d.lastIndexOf("/");if(b)return d.substring(0,e+1)+b;b=ta();d.toLowerCase().startsWith(b.toLowerCase())&&(b=d.substring(0,e));return b+"/"+a}function Lc(a){a=JSON.parse(a);mc=a.session;var b=a.numericId,d=hi5.appcfg.persistentId?window.localStorage:window.sessionStorage;d&&(d.setItem("appInfo.session",mc),d.setItem("appInfo.numericId",
b));ea(a.appId);a.server||(a.server=aa());if(b=hi5.$("joinSelect"))b.value=a.joinMode;if(b=hi5.$("requestControl"))b.disabled=a.hasControl;a.joined?1!=n.mode&&ba.execute("setAutoScale",[!0]):(n.mode=0,U(P.connectif)&&ba.setSize(Ia,Ja),fa.disableJoinedAppResize&&(n.windowState=0));var e=ta();b=Jd("join.html")+"?id="+(a.joined||a.numericId);(d=a.webAddress)&&0<d.length&&d.toLowerCase()!=e.toLowerCase()&&(e=d.indexOf("://"),n.protocol="http"==d.substring(0,e)?"ws":"wss",n.gateway=d,b+="&gateway="+encodeURIComponent(d));
b=n.modifyURL(b);a.joinLink=b;n.sessionInfo.appInfo=a;"isApp"in a&&Wa!==a.isApp&&(Wa=a.isApp,Oa(Ia,Ja,!0,!0),pb||1==n.mode||ba.execute("setAutoScale",[!0]));a.ver&&a.ver!=svGlobal.version&&svGlobal.logger.warn("Client:"+svGlobal.version+" server:"+a.ver);fa.cursorNameOnly=a.isAssistance;if(n.onsessionstart)n.onsessionstart(n.sessionInfo)}function Gd(a){if(Ma){var b=parseInt(a.charAt(0),10);a=a.substring(1);if(5==b)Ma.notifyFiles(JSON.parse(a));else{var d=a.split("\t");switch(b){case 1:Ma.confirmId(d[0],
d[1],d[2]);break;case 2:Ma.read(d[0],parseInt(d[1],10),parseInt(d[2],10));break;case 4:Ma.close(d[0]);break;case 9:a='<a href="'+n.modifyURL(ta()+d[0])+'" download="'+d[1]+'" target="_blank">'+__svi18n.info.fileReady+": "+d[1]+"</a>",__svi18n.info.download&&ba.getFocused().showMessage({msg:a,title:__svi18n.info.download,cbNo:function(){Ma.removeFile(d[0],!0);this.destroy()},onclick:function(e){"A"==e.target.tagName&&this.destroy()}})}}}}function kc(a,b,d,e){if(!Kd||oa.isPaused())return 0;var c=a.getPosition();
b=a.getData();e||(e=a.getEnd()-c);if(41222==Da.tag)return Qa.onaudioframe(b.slice(c)),0;if(a=1!=Da.tag)nc||(nc=new MSGSM),b=nc.decode(b,c,e),c=0,e=b.length;var g=Da.bitsPerSample;var p=Math.floor(e/(g>>3));var I=d=e=0;a||(e=Math.pow(2,g-1)-1,d=-e-1,I=Math.pow(2,g));g=Da.channels;var y=Math.floor(p/g),E=Qa.getBuffer(y),M=E.getChannelData(0),v=E.getChannelData(1);p=0;if(a)for(;p<y;)1==g?v[p]=M[p]=b[c++]:(M[p]=b[c++],v[p]=b[c++]),p++;else for(;p<y;)a=b[c++]|b[c++]<<8,a>e?(a-=I,a/=-d):a/=e,1==g?M[p]=
a:(M[p]=a,a=b[c++]|b[c++]<<8,a>e?(a-=I,a/=-d):a/=e),v[p]=a,p++;return Qa.playBuffer(E)}function Rc(a){if(!n.openLink||2E3<a.length)return!1;var b=a.indexOf(";");0<b&&(a=a.substring(b+1));b=a;a=a.toLowerCase();var d=0==a.indexOf("http://")||0==a.indexOf("https://")||0==a.indexOf("ftp://")||0==a.indexOf("mailto:")||0==a.indexOf("tel:")||0==a.indexOf("callto:");d||(0==a.indexOf("www.")?(d=!0,a="http://"+a):0==a.indexOf("ftp.")&&(d=!0,a="ftp://"+a));return d?0<a.indexOf("\r")||0<a.indexOf("\n")?!1:n.onurlredirection&&
n.onurlredirection(b)?!0:(a=ba.getFocused())?a.processLink(b):!1:!1}function Ld(a){if(a.startsWith("text/html;<img data-sv-img")){var b=a.indexOf('src="');if(0<b){b+=5;var d=a.indexOf('"',b),e=a.substring(b,d);e=n.modifyURL(e);a=a.substring(0,b)+e+a.substring(d)}}return a}function Fd(a){if("text/plain;"!=a){if(1666<Date.now()-Ra.reqCopyTime&&!(n.onservercopy&&n.onservercopy(a)||Rc(a))){var b=ba.getFocused();b&&b.copyToClip(Ld(a))}setTimeout(function(){qa("883")},999)}}function hc(){if(!pb&&(setTimeout(function(){Ha&&
qa("884")},333),n.onloggedin))n.onloggedin();oc=pb=!0;Wa&&1!=n.mode&&ba.execute("setAutoScale",[!1]);Ma&&(Ma.enabled=!0);Lb&&!Wa&&(oa.setContext(ba.getFocused().context),ba.repaint(0,0,oa.width-1,oa.height-1))}function zb(a){if(n){hi5.browser.cookie.delete(Jb);svGlobal.logger.warn("closed "+(n.sessionInfo.appInfo?n.sessionInfo.appInfo.numericId:0));n.onagentmessage&&(n.onagentmessage=null);if(n.onagentclose)n.onagentclose();var b=Ec();b&&n.sessionInfo.appInfo&&0==n.mode&&(sessionStorage[b]=n.sessionInfo.appInfo.session);
if(n&&(b=1!=n.mode,!Ha&&b&&Gb("connection"),b=b&&(Ha||ub<n.reconnectTimes)&&0<ub&&!a,Xa=Ha=!1,b)){ub--;__svi18n.info.reconnecting&&n.showMessage(__svi18n.info.reconnecting+" "+(n.reconnectTimes-ub)+"/"+n.reconnectTimes,null,3E3);setTimeout(ec,fa.reconnectInterval||5E3);svGlobal.logger.info("Reconnecting..."+ub);return}if(lc)svGlobal.logger.info("Req credential");else{Pa&&(n.stopPing(),Pa=null);Ka&&(Ka.removeEventListener("message",Fc,!1),Ka.postMessage({type:0,cmd:4}),Ka.terminate(),Ka=null);Ma&&
(Ma.release(),Ma=null);Sa=m=null;Ea&&(Ea.close(),Ea=null);kb&&hi5.Arrays.release(kb);ib&&hi5.Arrays.release(ib);Ya&&(Ya.stop(),Ya=null);Qa&&(Qa.close(),Qa=null);n.player&&(n.player=null);Cb=null;try{if(n.onclose)n.onclose(a);else if(svGlobal.logger.info("onclose: null"),hi5.appcfg&&hi5.appcfg.returnUrl){window.location.href=hi5.appcfg.returnUrl;return}ba&&(ba.close(),ba=null)}catch(d){svGlobal.logger.warn(d)}Va=null;Ca&&(Ca.onopen=null,Ca.onmessage=null,Ca.onclose=null,Ca.onerror=null,Ca.close(),
Ca=null);ba=Ra=null;oa&&(oa.release(),oa=null);hi5.browser.isChromeApp?chrome.runtime.onSuspend.removeListener(n.close):window.removeEventListener("unload",n.close,!1);window&&window.$rdp==n&&(window.$rdp=null);n=null}}}function Sc(){Ca&&Ha?Ca.close():zb(!0)}function Hc(a,b){var d=a.getLittleEndian32();if(0!=(d&16777216))if(b=a.getLittleEndian32(),0!=(d&1073741824)){a.getLittleEndian16();a.getByte();d=a.getByte();var e=a.getLittleEndian16(),c=a.getLittleEndian16(),g=0;16>d&&(g=a.getLittleEndian16());
var p=a.getLittleEndian16(),I=a.getLittleEndian16();a.getBytes(p);g&&a.getBytes(g);if(8<=d&&(g=ba.getFocused())&&g.onremoteappicon){p=new hi5.graphic.Bitmap(e,c,32);a.getPosition();e=new Uint8Array(e*c*4);c=a.getPosition();I=c+I;var y;a=a.getData();for(var E=0,M,v;c<I;)switch(d){case 16:(y=a[c++]|a[c++]<<8)?(v=y>>7&248,M=y>>2&248,y=y<<3&248,v|=v>>5,M|=M>>5,y|=y>>5,e[E++]=y,e[E++]=M,e[E++]=v,e[E++]=255):E+=4;break;case 32:e[E++]=a[c++],e[E++]=a[c++],e[E++]=a[c++],e[E++]=a[c++]}p.putPixels(e,0,e.length);
a=ba.getWinById(b);g.onremoteappicon(a,p)}}else 0!=(d&2147483648)?svGlobal.logger.info("XXX rail cache icon, winId="+b):0!=(d&536870912)?(svGlobal.logger.info("***** delete winId="+b),ba.delWin(b)):Md(a,d,b);else if(0!=(d&33554432))svGlobal.logger.info("XXX Alt Sec window Notify="+d);else if(0!=(d&67108864))if(svGlobal.logger.info("*** -- Alt Sec window Desktop, flags:"+d),0!=(d&1))svGlobal.logger.info("Desktop non monitored flags="+d);else{if(0!=(d&32)&&(b=a.getLittleEndian32(),svGlobal.logger.info("Desktop monitored flags="+
d+" winId="+b),0<b&&((g=ba.getOwnerSurfaceById(b))&&g.railWin&&g.railWin.setActiveWinId(b,3==fa.windowState),ba.setTitle(b),oa.getContext()||(b=ba.getFocused())&&oa.setContext(b.context))),0!=(d&16)&&(b=a.getByte(),0<b))for(d=ba.zOrders,d.length=b,g=0;g<b;g++)d[g]=a.getLittleEndian32(),svGlobal.logger.info("---zorders:"+d[g])}else svGlobal.logger.info("XXX Alt Sec window order flgas="+d)}function Tc(a){var b=ba.getFocused();if(b&&b.railWin){var d=a||b.railWin.mainWin;if(d&&2<d.showState){var e=b.getFreeSpace();
a=Math.max(Math.abs(d.winHeight-e.height),Math.abs(d.winWidth-e.width));svGlobal.logger.info("--- fitMainWin offset:"+a+" _hOffset:"+d._hOffset+" appId:"+d.appId+" spaceH:"+e.height);0<a?(b=a==d._hOffset,d._hOffset&&b||(d._hOffset=a,setTimeout(function(){d.resize(0,0,e.width,e.height)},333))):d._hOffset=0}}}function Md(a,b,d){Wa||(Wa=!0);var e=0==(b&268435456),c=ba.getWinById(d);c?e=!0:c=new ba.LocalWin(d);svGlobal.logger.info("\n\n=========== winId="+d+" existed="+e);if(c){0!=(b&2)&&(c.ownerWinid=
a.getLittleEndian32(),svGlobal.logger.info("***** ownerWinid="+c.ownerWinid));0!=(b&8)&&(c.style=a.getLittleEndian32(),c.extStyle=a.getLittleEndian32(),svGlobal.logger.info("***** winId="+d+" style="+c.style+" extStyle="+c.extStyle),svGlobal.logger.info("*****--- WS_POPUP="+(0!=(c.style&2147483648))),svGlobal.logger.info("*****--- WS_DLGFRAME="+(0!=(c.style&4194304))),svGlobal.logger.info("*****--- DS_MODALFRAME="+(0!=(c.style&128))),svGlobal.logger.info("*****--- WS_EX_DLGMODALFRAME="+(0!=(c.extStyle&
1))),svGlobal.logger.info("*****--- WS_EX_TOOLWINDOW="+(0!=(c.extStyle&128))),svGlobal.logger.info("*****--- WS_BORDER="+(0!=(c.style&8388608))),svGlobal.logger.info("*****--- WS_CAPTION="+(0!=(c.style&12582912))),svGlobal.logger.info("*****--- WS_OVERLAPPED="+(0!=(c.style&0))),svGlobal.logger.info("*****--- WS_OVERLAPPEDWINDOW="+(0!=(c.style&13565952))),svGlobal.logger.info("*****--- WS_POPUPWINDOW="+(0!=(c.style&2156396544))),svGlobal.logger.info("*****--- WS_SIZEBOX="+(0!=(c.style&262144))),svGlobal.logger.info("*****--- WS_CHILD="+
(0!=(c.style&1073741824))),svGlobal.logger.info("*****--- WS_SIZEBOX="+(0!=(c.style&262144))),svGlobal.logger.info("*****--- WS_EX_MDICHILD="+(0!=(c.extStyle&64))),svGlobal.logger.info("*****--- WS_EX_LAYERED="+(0!=(c.extStyle&524288))));if(0!=(b&16)){c.setShowState(a.getByte());svGlobal.logger.info("***** winId="+d+" showState="+c.showState);var g=c.showState;(2==g&&0!=fa.noMinimize||!e&&3==g&&5==fa.windowState)&&setTimeout(function(){c.exeCommand(61728)},50)}if(g=0!=(b&4)){var p=a.getLittleEndian16();
c.titleInfo=a.getUnicodeString(p,!1);svGlobal.logger.info("***** winId="+d+" title="+c.titleInfo)}0!=(b&16384)&&(c.clientOffsetX=a.getLittleEndian32(),c.clientOffsetY=a.getLittleEndian32(),svGlobal.logger.info("***** winId="+d+" coffX"+c.clientOffsetX+" coffY="+c.clientOffsetY));0!=(b&65536)&&(c.clientAreaWidth=a.getLittleEndian32(),c.clientAreaHeight=a.getLittleEndian32(),svGlobal.logger.info("***** winId="+d+" cw"+c.clientAreaWidth+" ch="+c.clientAreaHeight));0!=(b&131072)&&(c.rpContent=a.getLittleEndian32());
0!=(b&262144)&&(c.rootParentHandle=a.getLittleEndian32());if(0!=(b&2048)){p=a.getLittleEndian32();var I=a.getLittleEndian32();c.winOffsetX=p;c.winOffsetY=I;svGlobal.logger.info("***** winId="+d+" offX"+c.winOffsetX+" offY="+c.winOffsetY)}0!=(b&32768)&&(c.winClientDeltaX=a.getLittleEndian32(),c.winClientDeltaY=a.getLittleEndian32(),svGlobal.logger.info("***** winId="+d+" dX"+c.winClientDeltaX+" dY="+c.winClientDeltaY));0!=(b&1024)&&(c.winWidth=a.getLittleEndian32(),c.winHeight=a.getLittleEndian32(),
svGlobal.logger.info("***** winId="+d+" w"+c.winWidth+" h="+c.winHeight));if(!e)if(c.isMainWin())3==n.windowState?Tc(c):setTimeout(function(){c.activate(1)},666);else if(2<c.showState&&(p=ba.getFocused())){p=p.getFreeSpace();var y=c.winWidth,E=c.winHeight;if(c.winOffsetX>p.width||c.winOffsetY>p.height||0>y+c.winOffsetX||0>E+c.winOffsetY){var M=(p.width-c.winWidth)/2|0,v=(p.height-c.winHeight)/2|0;0>M&&(M=0);0>v&&(v=0);setTimeout(function(){c.resize(M,v,y,E)},50)}}0!=(b&256)&&(p=a.getLittleEndian16(),
0<p&&a.skipPosition(8*p));0!=(b&4096)&&(c.visibleOffsetX=a.getLittleEndian32(),c.visibleOffsetY=a.getLittleEndian32());0!=(b&512)&&(b=a.getLittleEndian16(),c.numVisibilityRects=b,0<b&&a.skipPosition(8*b));if(e)ba.onWinChange(c);else ba.addWin(c);g&&ba.setTitle(d);d==ba.zOrders[0]?svGlobal.logger.info("zzz zorders win: "+d):svGlobal.logger.info("zzz win: "+d,ba.zOrders)}else svGlobal.logger.warn("XXX, No win with id:"+d)}function yc(a,b){function d(f,l,h,q,w){0<w.width?w.union(f,l,h,q):(w.x=f,w.y=
l,w.width=h,w.height=q)}function e(f,l,h,q){for(la=0;la<sa;la++){var w=S[la];if(f>=w[0]&&l>=w[1]&&h<=w[2]&&q<=w[3])return V[la]}return null}function c(f,l,h,q){if(sa){var w=e(f,l,f+h-1,l+q-1);w&&d(f,l,h,q,w)}else d(f,l,h,q,z)}function g(f,l,h,q,w,A,G){for(var D=w*h+q,C=f.setRGB,X=f.getRGB,L=0;L<G;L++){for(var k=0;k<A;k++){if(f){var J=X(q+k,w+L);C(q+k,w+L,~J&16777215)}else l[D]=~l[D]&16777215;D++}D+=h-A}}function p(f,l,h,q,w,A,G,D,C,X){l=X*D+C;null==G&&(G=f);for(f=0;f<A;f++){for(C=0;C<w;C++)R[q+f][h+
C]=R[q+f][h+C]&G[l]&16777215|4278190080,l++;l+=D-w}}function I(f,l,h,q,w,A,G,D,C,X){l=X*D+C;C=f.setRGB;X=f.getRGB;null==G&&(G=f);for(f=0;f<A;f++){for(var L=0;L<w;L++){var k=X(h+L,q+f);C(h+L,q+f,k|G[l]&16777215);l++}l+=D-w}}function y(f,l,h,q){var w=da;if(w){var A=w.getRGB(l,h);switch(f){case 0:w.setRGB(l,h,0);break;case 1:w.setRGB(l,h,~(A|q)&16777215);break;case 2:w.setRGB(l,h,A&~q&16777215);break;case 3:w.setRGB(l,h,~q&16777215);break;case 4:w.setRGB(l,h,16777215*(~A&q));break;case 5:w.setRGB(l,
h,~A&16777215);break;case 6:w.setRGB(l,h,A^q&16777215);break;case 7:w.setRGB(l,h,~A&q&16777215);break;case 8:w.setRGB(l,h,A&q&16777215);break;case 9:w.setRGB(l,h,A^~q&16777215);break;case 10:break;case 11:w.setRGB(l,h,A|~q&16777215);break;case 12:w.setRGB(l,h,q);break;case 13:w.setRGB(l,h,(~A|q)&16777215);break;case 14:w.setRGB(l,h,A|q&16777215);break;case 15:w.setRGB(l,h,16777215);break;default:svGlobal.logger.warn("unsupported pixel opcode: "+f),w.setRGB(l,h,q)}}}function E(f,l,h,q,w,A,G,D,C){f>
D||l>C||(h=f+h-1,h>D&&(h=D),f<A&&(f=A),h=h-f+1,q=l+q-1,q>C&&(q=C),l<G&&(l=G),q=q-l+1,1>h||1>q||da.fillRect(f,l,h,q,w))}function M(f,l,h,q,w,A,G,D,C,X,L,k){if(!(l>L||h>k)){var J=l+q-1;J>L&&(J=L);C=l<C?C:l;J=J-l+1;L=h+w-1;L>k&&(L=k);X=h<X?X:h;k=L-h+1;if(!(1>J||1>k)){L=128;var N=0;G|=4278190080;D|=4278190080;if(C==l&&X==h&&J==q&&k==w)if(0==f)for(var T=0;T<w;T++){f=h+T;for(var ca=0;ca<q;ca++)0==L&&(N++,L=128),0!=(A[N]&L)&&(R[f][l+ca]=D),L>>=1;N++;L=128;N==A.length&&(N=0)}else for(T=0;T<w;T++){f=h+T;for(ca=
0;ca<q;ca++)0==L&&(N++,L=128),R[f][l+ca]=0!=(A[N]&L)?D:G,L>>=1;N++;L=128;N==A.length&&(N=0)}else if(0==f)for(T=0;T<k;T++){f=h+T;for(ca=0;ca<J;ca++)0==L&&(N++,L=128),l+ca>=C&&f>=X&&0!=(A[N]&L)&&(R[f][l+ca]=D),L>>=1;N++;L=128;N==A.length&&(N=0)}else for(T=0;T<k;T++){f=h+T;for(ca=0;ca<J;ca++)0==L&&(N++,L=128),l+ca>=C&&h+T>=X&&(R[f][l+ca]=0!=(A[N]&L)?D:G),L>>=1;N++;L=128;N==A.length&&(N=0)}}}}function v(f,l,h,q,w){this.offset=f;this.baseLine=l;this.width=h;this.height=q;this.fontData=w}function x(f,l,
h,q,w,A,G,D,C){this.cache_idx=f;this.rawData=l;this.none=!l;this.hotX=h;this.hotY=q;this.width=w;this.height=A;this.xorSize=D;this.andSize=C;this.result="";this.distance=0;this.bpp=G;this.system="";if(l){if(!this.distance){f=0;if(l){G=0;for(var X=l.length;G<X;G++)0!=l[G]&&(f+=G%w+(G/w|0))}this.distance=f}if(!this.system){a:switch(this.distance){case 507:f="text";break a;case 2046:case 4359:f="default";break a;default:f=""}this.system=f}}f="";if(!this.system&&l){G=w*A*4;f=62+G+D+C;X=new Uint8Array(f);
f=new hi5.DataBuffer(X,0,f);f.setLittleEndian16(0);f.setLittleEndian16(2);f.setLittleEndian16(1);f.setByte(w);f.setByte(A);f.setByte(0);f.setByte(0);f.setLittleEndian16(h);f.setLittleEndian16(q);f.setLittleEndian32(40+G+D+C);f.setLittleEndian32(22);f.setLittleEndian32(40);f.setLittleEndian32(w);f.setLittleEndian32(2*A);f.setLittleEndian16(1);f.setLittleEndian16(32);f.setLittleEndian32(0);f.setLittleEndian32(D+C);f.setLittleEndian32(0);f.setLittleEndian32(0);f.setLittleEndian32(0);f.setLittleEndian32(0);
for(h=A-1;0<=h;h--)for(q=0;q<w;q++)A=l[w*h+q],f.setByte(A&255),f.setByte(A>>8&255),f.setByte(A>>16&255),f.setByte(A>>24&255);f="data:image/x-icon;base64,"+hi5.Base64.enc(f.getData())}this.url=f}var R=[],t=null,z=new hi5.graphic.Rectangle(0,0,0,0),B="Uint8ClampedArray"in window,r=null,Q=0,u=0,K=0,F=0,O=null,S,V,la=0,sa=0;this.width=a;this.height=b;var wa=!1,da=this,na={imgData:null,left:0,top:0,width:0,height:0};this.setProfiler=function(f){r=f};this.getDirtyArea=function(){return z};this.setImgRect=
function(f,l,h,q){Q=f;u=l;K=h;F=q};this.parseMonitorDef=function(f){var l=f.split(","),h=l.length,q=[];if(1<h){for(var w=!1,A=0;A<h;A++){var G=l[A].split(":");if(4==G.length)q[A]=Array(5),q[A][0]=parseInt(G[0]),q[A][1]=parseInt(G[1]),q[A][2]=parseInt(G[2]),q[A][3]=parseInt(G[3]),q[A][4]=0==q[A][0]&&0==q[A][1]?1:0;else{w=!0;break}}w&&(svGlobal.logger.warn("invaiid monitorDef:"+f),q.length=0)}return q};this.setMonitorLayout=function(f){var l=f.length,h=0;S=f;for(V=Array(l);h<l;h++)V[h]=new hi5.graphic.Rectangle(0,
0,0,0);sa=l};this.setMonitorCount=function(f){sa=f};this.addImg=function(f){K&&(O&&URL.revokeObjectURL(O.src),O=f)};this.flushImgs=function(){O&&(URL.revokeObjectURL(O.src),O=null,K=0)};this.getData=function(){return R};this.pause=function(f,l){wa=f;l&&t&&t.fillRect(0,0,a,b)};this.release=function(){z=null;hi5.Arrays.release(V);da.flushImgs();R=t=da=null;na=na.imgData=null};this.isPaused=function(){return wa};this.setContext=function(f){f!=t&&(t||!f||f.createImageData(1,1).data.buffer||(B=!1),t=f,
null!=t&&(na.imgData=t.createImageData(a,b)))};this.getContext=function(){return t};this.resize=function(f,l){if(R.length!=l||R[0].length!=f){for(var h=0;h<l;h++)R[h]=new Uint32Array(f);R.length=l;da.width=a=f;da.height=b=l;null!=t&&(na.imgData=t.createImageData(a,b))}};da.resize(a,b);this.getBuffer=function(){return R};this.setRGB=function(f,l,h){R[l][f]=h|4278190080};this.getRGB=function(f,l){return R[l][f]};this.setRGBs=function(f,l,h,q,w,A,G){var D=f+h,C=l+q;C>b&&(C=b);if(!(f>=a)){D>a&&(h-=D-
a);for(D=l;D<C;D++,A+=G)R[D].set(w.subarray(A,A+h),f);c(f,l,h,q)}};this.moveArea=function(f,l,h,q,w,A){if(0<A){var G=f+w,D=l+A,C;for(C=q-1;0<=C;C--)R[D+C].set(R[l+C].subarray(f,f+h),G)}else if(0>A)for(G=f+w,D=l+A,C=0;C<q;C++)R[D+C].set(R[l+C].subarray(f,f+h),G);else if(0<w){G=f+w;D=l+A;var X;for(C=h-1;0<=C;C--){var L=G+C;var k=f+C;for(X=0;X<q;X++)R[D+X][L]=R[l+X][k]}}else for(G=f+w,D=l+A,C=0;C<h;C++)for(L=G+C,k=f+C,X=0;X<q;X++)R[D+X][L]=R[l+X][k];c(f+w,l+A,h,q)};this.getRGBs=function(f,l,h,q,w){var A=
new Uint32Array(h*q),G=f+h;q=l+q;for(var D=0;l<q;l++)A.set(R[l].subarray(f,G),D),D+=h;return w?(w(A),null):A};this.repaint=function(f,l,h,q){var w=na.imgData.data,A=0,G,D;r&&r.begin("paint");0>f&&(h+=f,f=0);0>l&&(q+=l,l=0);f+h>a&&(h=a-f);l+q>b&&(q=b-l);var C=f+h;var X=l+q;if(B)for(w=new Uint32Array(w.buffer),D=l;D<X;D++)w.set(R[D].subarray(f,C),A),A+=a;else{var L=4*(a-h)|0;for(D=l;D<X;D++){for(G=f;G<C;G++){var k=R[D][G];w[A++]=k&255;w[A++]=k>>8&255;w[A++]=k>>16&255;w[A++]=255}A+=L}}na.left=f;na.top=
l;na.width=h;na.height=q;r&&r.end("paint");return na};this.postPaint=c;this.draw=function(f,l,h,q){if(!wa&&t)if(O&&O.complete&&(t.drawImage(O,Q,u,K,F),URL.revokeObjectURL(O.src),O=null),sa){if(f=e(f,l,h,q),f.width)return da.repaint(f.x,f.y,f.width,f.height),f.width=0,na}else if(z.width)return da.repaint(z.x,z.y,z.width,z.height),z.width=0,na;return null};this.fillRect=function(f,l,h,q,w){var A=f+h,G=l+q;if(R[0].fill)for(var D,C=l;C<G;C++)R[C].fill(w,f,A);else for(C=l;C<G;C++)for(D=f;D<A;D++)R[C][D]=
w;c(f,l,h,q)};this.drawLine=function(f,l,h,q,w){if(l==q){if(f>h){var A=f;f=h;h=A}var G=R[l];h++;if(G.fill)G.fill(w,f,h);else for(A=f;A<h;A++)G[A]=w}else if(f==h)for(l>q&&(A=l,l=q,q=A),q++,A=l;A<q;A++)R[A][f]=w;else{var D=Math.abs(h-f),C=Math.abs(q-l);A=f;G=l;h=h>=f?f=1:f=-1;l=q>=l?q=1:q=-1;if(D>=C){l=f=0;var X=D;var L=D/2|0;var k=C}else q=h=0,X=C,L=C/2|0,k=D,D=C;if(!(1>D))for(D++,C=0;C<D;C++)R[G][A]=w,L+=k,L>=X&&(L-=X,A+=f,G+=q),A+=h,G+=l}};this.bitBlt=function(f,l,h,q,w,A,G,D,C,X){var L=da;switch(f){case 0:D=
L.setRGB;for(L=h;L<h+w;L++)for(C=q;C<q+A;C++)D(L,C,0);break;case 1:f=G;C=X*D+C;X=L.setRGB;l=L.getRGB;null==f&&(f=L);for(L=0;L<A;L++){for(G=0;G<w;G++)X(h+w,q+A,~(l(h+w,q+A)|f[C])&16777215);C+=D-w}break;case 2:f=G;C=X*D+C;X=L.setRGB;l=L.getRGB;null==f&&(f=L);for(L=0;L<A;L++){for(G=0;G<w;G++){var k=l(h+w,q+A);X(h+w,q+A,k&~f[C]&16777215);C++}C+=D-w}break;case 3:g(L,G,D,C,X,w,A);G?L.setRGBs(h,q,w,A,G,X*D+C,D):L.moveArea(C,X,w,A,h-C,q-X);break;case 4:g(L,null,l,h,q,w,A);p(L,l,h,q,w,A,G,D,C,X);break;case 5:g(L,
null,l,h,q,w,A);break;case 6:f=G;C=X*D+C;null==f&&(f=L);for(L=0;L<A;L++){for(X=0;X<w;X++)R[q+L][h+X]=R[q+L][h+X]^f[C]&16777215|4278190080,C++;C+=D-w}break;case 7:f=G;C=X*D+C;X=L.setRGB;l=L.getRGB;null==f&&(f=L);for(L=0;L<A;L++){for(G=0;G<w;G++)k=l(h+G,q+L),X(h+G,q+L,~(k&f[C])&16777215),C++;C+=D-w}break;case 8:p(L,l,h,q,w,A,G,D,C,X);break;case 9:f=G;C=X*D+C;X=L.setRGB;l=L.getRGB;null==f&&(f=L);for(L=0;L<A;L++){for(G=0;G<w;G++)k=l(h+G,q+L),X(h+G,q+L,k^~f[C]&16777215),C++;C+=D-w}break;case 10:break;
case 11:f=G;C=X*D+C;X=L.setRGB;l=L.getRGB;null==f&&(f=L);for(L=0;L<A;L++){for(G=0;G<w;G++)k=l(h+G,q+L),X(h+G,q+L,k|~f[C]&16777215),C++;C+=D-w}break;case 12:G?L.setRGBs(h,q,w,A,G,X*D+C,D):L.moveArea(C,X,w,A,h-C,q-X);break;case 13:g(L,null,l,h,q,w,A);I(L,l,h,q,w,A,G,D,C,X);break;case 14:I(L,l,h,q,w,A,G,D,C,X);break;case 15:D=L.setRGB;for(L=h;L<h+w;L++)for(C=q;C<q+A;C++)D(L,C,16777215);break;default:svGlobal.logger.warn("unsupported opcode: "+f)}c(h,q,w,A)};this.drawLineExt=function(f,l,h,q,w,A){if(f==
h||l==q){var G;if(l==q)if(h>f){var D=h-f;if(!(1>D))for(G=0;G<D;G++)y(A,f+G,l,w)}else{if(D=f-h,!(1>D))for(G=0;G<D;G++)y(A,h+G,l,w)}else if(q>l){if(D=q-l,!(1>D))for(G=0;G<D;G++)y(A,f,l+G,w)}else if(D=l-q,!(1>D))for(G=0;G<D;G++)y(A,f,q+G,w)}else{var C=Math.abs(h-f),X=Math.abs(q-l);G=f;D=l;var L,k;var J=h>=f?L=1:L=-1;var N=q>=l?k=1:k=-1;if(C>=X){N=L=0;var T=C;var ca=C/2>>0;var ma=X}else k=J=0,T=X,ca=X/2>>0,ma=C,C=X;if(1>C)return;for(X=0;X<=C;X++)y(A,G,D,w),ca+=ma,ca>=T&&(ca-=T,G+=L,D+=k),G+=J,D+=N}w=
Math.min(f,h);f=Math.max(f,h);h=Math.min(l,q);l=Math.max(l,q);0>f-w||0>l-h||c(w,h,f-w+1,l-h+1)};this.drawText=function(f,l,h,q,w,A,G,D,C,X,L,k,J,N,T,ca,ma,ra,Ga,La,Fa){var ya=0;1<k?E(X,L,k,J,w,ra,Ga,La,Fa):1==h&&E(A,G,D,C,w,ra,Ga,La,Fa);for(var Ta=ca,ua=0;ua<ca;)switch(ma[ya+ua]){case 255:var xa=ma[ya+ua+2];if(xa>Ta-ya){ua=ca=0;break}xa=ma.slice?ma.slice(ya,ya+xa):ma.subarray(ya,ya+xa);ia[ma[ya+ua+1]]=xa;ua+=3;ca-=ua;ya=ua;ua=0;break;case 254:var Na=(xa=ia[ma[ya+ua+1]])?xa:null;Na&&0==Na[1]&&0==(l&
32)&&(0!=(l&4)?T+=ma[ya+ua+2]:N+=ma[ya+ua+2]);ua=ua+2<ca?ua+3:ua+2;ca-=ua;ya=ua;ua=0;if(!Na)break;for(var Za=Na.length,Ua=0;Ua<Za;Ua++){xa=Z.getFont(f,Na[Ua]);if(0==(l&32)){var $a=Na[++Ua];0!=($a&128)?(0!=(l&4)?T+=Na[Ua+1]|Na[Ua+2]<<8:N+=Na[Ua+1]|Na[Ua+2]<<8,Ua+=2):0!=(l&4)?T+=$a:N+=$a}xa&&(M(h,N+xa.offset&65535,T+xa.baseLine&65535,xa.width,xa.height,xa.fontData,w,q,ra,Ga,La,Fa),0!=(l&32)&&(N+=xa.width))}break;default:xa=Z.getFont(f,ma[ya+ua]),0==(l&32)&&($a=ma[ya+ ++ua],0!=($a&128)?(0!=(l&4)?T+=
ma[ya+ua+1]|ma[ya+ua+2]<<8:N+=ma[ya+ua+1]|ma[ya+ua+2]<<8,ua+=2):0!=(l&4)?T+=$a:N+=$a),xa&&(M(h,N+xa.offset&65535,T+xa.baseLine&65535,xa.width,xa.height,xa.fontData,w,q,ra,Ga,La,Fa),0!=(l&32)&&(N+=xa.width)),ua++}1<k?0<J&&c(X,L,k,J):0<D&&0<C&&c(A,G,D,C)};this.drawBitmap=function(f,l,h,q,w,A,G,D,C){var X=va.getBitmap(f,l);X?(f=X.width,l=X.height,w>f&&(w=f),A>l&&(A=l),12==C?da.setRGBs(h,q,w,A,X.data,D*f+G,f):da.bitBlt(C,a,h,q,w,A,X.data,f,G,D)):svGlobal.logger.warn("Failed to get bitmap from cache, id:"+
f+" idx="+l)};this.saveDesktop=function(f,l,h,q,w){da.getRGBs(f,l,h,q,function(A){ka.save(f,l,h,q,w,A)})};this.restoreDesktop=function(f,l,h,q,w){(w=ka.restore(f,l,h,q,w))?da.setRGBs(f,l,h,q,w,0,h):svGlobal.logger.warn("XXX no matched desktop save.")};this.putFont=function(f,l,h){Z.putFont(f,l,h)};this.putBitmap=function(f,l,h){va.putBitmap(f,l,h)};this.putCursor=function(f,l){Ba.set(f,l)};this.setCursor=function(f){if(!wa&&-1!=f){var l=Ba.get(f);if(l)da.onSetCursor(l);else svGlobal.logger.warn("invalid cursor"+
f)}};var za=0;this.isSendingHistory=function(){return 2E3>Date.now()-za};this.getHistory=function(f,l){var h=null;(h=Ba.toPDU())&&f(h.buffer);if(da.onGetGfxHistory)da.onGetGfxHistory(f,l);else{r&&r.begin("his_bitmap");va.forEach(function(D,C,X){if(D){var L=0,k=0;X=0;for(var J=D.length;X<J;X++)D[X]&&D[X].data&&(L++,k+=D[X].raw?D[X].raw.length:4*D[X].data.length);if(L&&k){h=new Uint8Array(k+20*L+8);h[0]=29;h[2]=1;h[3]=4;k=new hi5.DataBuffer(h,4,h.length);k.setLittleEndian32(L);for(X=0;X<J;X++)(L=D[X])&&
L.data&&(k.setLittleEndian16(C),k.setLittleEndian16(X),k.setLittleEndian16(L.left),k.setLittleEndian16(L.top),k.setLittleEndian16(L.width),k.setLittleEndian16(L.height),k.setLittleEndian16(L.bitsperpixel),k.setLittleEndian16(L.codec),k.setLittleEndian32(L.raw?L.raw.length:4*L.data.length),k.setBytes(L.raw||new Uint8Array(L.data.buffer)));f(h.buffer)}}});r&&r.end("his_bitmap");r&&r.begin("his_font");(h=Z.toPDU())&&f(h.buffer);r&&r.end("his_font");for(var q=4,w=0,A=ia.length;w<A;w++)ia[w]&&(q+=ia[w].length+
6);if(4<q){h=new Uint8Array(q);h[0]=29;h[2]=1;h[3]=7;var G=4;w=0;for(A=ia.length;w<A;w++)ia[w]&&ia[w].length&&(h[G++]=w,h[G++]=w>>8,q=ia[w].length,h[G++]=q,h[G++]=q>>8,h[G++]=q>>16,h[G++]=q>>24,h.set(ia[w],G),G+=q);f(h.buffer)}(h=ka.toPDU())&&f(h.buffer);l();za=Date.now()}};this.onHistoryDone=function(){da.onGetGfxHistory&&n.reconnect(a,b,!0)};this.setHistory=function(f,l){svGlobal.logger.info("setHistory type:"+f);switch(f){case 4:r&&r.begin("his_bitmap_dec");var h=l.getLittleEndian32();for(f=0;f<
h;f++){var q=l.getLittleEndian16(),w=l.getLittleEndian16(),A=l.getLittleEndian16(),G=l.getLittleEndian16(),D=l.getLittleEndian16(),C=l.getLittleEndian16(),X=l.getLittleEndian16(),L=l.getLittleEndian16(),k=l.getLittleEndian32(),J=new Uint8Array(l.getData().buffer,l.getPosition(),k),N=new Uint8Array(k);N.set(J);J=rdpcodecs.bitmap;switch(L){case 0:var T=new Uint32Array(N.buffer);l.skipPosition(k);break;case 1:switch(X){case 16:T=J.decompressInt16(D,C,k,N,0);break;case 24:T=J.decompressInt24(D,C,k,N,
0);break;case 32:T=J.decompressInt32(D,C,k,N,0)}l.skipPosition(k);break;case 2:T=new rdpcodecs.NSCodec,T.process(l,X,D,C),k=T.getData(),T=T.getDataSize(),T=new Uint32Array(T),rdpcodecs.flipimage(k,0,T,D,C,1)}va.putBitmap(q,w,new rdpcodecs.Bitmap(T,D,C,A,G,X,0==L?null:N,L))}r&&r.end("his_bitmap_dec");break;case 5:Z.fromStream(l);break;case 6:Ba.fromStream(l);break;case 7:for(;l.has(6);)if(f=l.getLittleEndian16(),k=l.getLittleEndian32())h=l.getData().subarray(l.getPosition(),l.getPosition()+k),ia[f]=
h,l.skipPosition(k);break;case 9:ka.fromStream(l);break;default:if(da.onSetGfxHistory)da.onSetGfxHistory(f,l)}};var Ba=new function(){var f=[],l=!1;this.useRemoteCursor=function(h){l=h};this.set=function(h,q){l&&(q.system="");f[h]=q};this.get=function(h){return f[h]};this.total=function(){return f.length};this.toPDU=function(){for(var h=2,q=2,w=0,A=0,G=f.length,D;A<G;A++)if(D=f[A])w++,q=q+7+(D.rawData?D.rawData.length:0);if(!w)return null;q=new Uint32Array(q);q[0]=100728861;q[1]=w;for(A=0;A<G;A++)if(D=
f[A])if(w=D.rawData?D.rawData.length:0,q[h++]=D.cache_idx|D.bpp<<16,q[h++]=D.hotX|D.hotY<<16,q[h++]=D.width|D.height<<16,q[h++]=D.xorSize,q[h++]=D.andSize,q[h++]=D.distance,q[h++]=w)q.set(D.rawData,h),h+=w;return q};this.fromStream=function(h){var q=h.getPosition();h=new Uint32Array(h.getData().buffer,q);var w=h[0],A=0;for(q=1;A<w;A++){var G=h[q]&65535;var D=h[q++]>>16;var C=h[q]&65535;var X=h[q++]>>16;var L=h[q]&65535;var k=h[q++]>>16;var J=h[q++];var N=h[q++];var T=h[q++];var ca=h[q++];var ma=null;
ca&&(ma=new Uint32Array(ca),ma.set(h.subarray(q,q+ca)),q+=ca);D=new x(G,ma,C,X,L,k,D,J,N);T&&(D.distance=T);l&&(D.system="");f[G]=D}}};Ba.useRemoteCursor(!!fa.remoteCursor);var ka=new function(){function f(h,q,w,A,G,D){this.x=h;this.y=q;this.cx=w;this.cy=A;this.offset=G;this.data=D}var l=[];this.save=function(h,q,w,A,G,D){h=new f(h,q,w,A,G,D);q=0;for(w=l.length;q<w;q++)if(!l[q]){l[q]=h;return}l.push(h)};this.restore=function(h,q,w,A,G){for(var D,C=0,X=l.length;C<X;C++)if((D=l[C])&&D.x==h&&D.y==q&&
D.cx==w&&D.cy==A){if(D.offset==G)return h=D.data,l[C]=null,h;svGlobal.logger.warn("TODO: offset")}return null};this.toPDU=function(){for(var h=0,q=2,w=0,A=l.length;w<A;w++)l[w]&&(h++,q+=l[w].data.length+6);if(!h||!q)return null;q=new Uint32Array(q);var G=2;q[0]=151060509;q[1]=h;for(w=0;w<A;w++)if(h=l[w])q[G++]=h.x,q[G++]=h.y,q[G++]=h.cx,q[G++]=h.cy,q[G++]=h.offset,q[G++]=h.data.length,q.set(h.data,G),G+=h.data.length;return q};this.fromStream=function(h){h=new Uint32Array(h.getData().buffer,h.getPosition());
for(var q=1,w=h[0],A,G,D,C,X,L,k,J=0;J<w;J++)A=h[q++],G=h[q++],D=h[q++],C=h[q++],X=h[q++],L=h[q++],k=new Uint32Array(L),L=q+L,k.set(h.subarray(q,L)),q=L,this.save(A,G,D,C,X,k)}},ia=[],Z=new function(){var f=[];this.putFont=function(l,h,q){f[l]||(f[l]=[]);f[l][h]=q};this.getFont=function(l,h){return f[l]?f[l][h]:null};this.toPDU=function(){var l=0,h,q,w;var A=4;for(var G,D=f.length;l<D;l++)if((w=f[l])&&w.length)for(G=w.length,h=0;h<G;h++)(q=w[h])&&(A+=15+q.fontData.length);if(5>A)return null;var C=
new Uint8Array(A);A=new hi5.DataBuffer(C,0,A);C[0]=29;C[2]=1;C[3]=5;A.skipPosition(4);l=0;for(D=f.length;l<D;l++)if((w=f[l])&&w.length)for(G=w.length,h=0;h<G;h++)if(q=w[h])A.setByte(l),A.setLittleEndian16(h),A.setLittleEndian16(q.offset),A.setLittleEndian16(q.baseLine),A.setLittleEndian16(q.width),A.setLittleEndian16(q.height),A.setLittleEndian32(q.fontData.length),A.setBytes(q.fontData);return C};this.fromStream=function(l){for(;l.has(15);){var h=l.getByte(),q=l.getLittleEndian16(),w=l.getLittleEndian16(),
A=l.getLittleEndian16(),G=l.getLittleEndian16(),D=l.getLittleEndian16(),C=l.getLittleEndian32();C=l.getBytes(C);this.putFont(h,q,new v(w,A,G,D,C))}}},va=new function(){var f=[],l=[];this.putBitmap=function(h,q,w){if(32767==q)l[h]&&(l[h].data=null,l[h]=null),l[h]=w;else{var A=f[h];A?A[q]&&(A[q].data=null,A[q]=null):f[h]=A=[];A[q]=w}};this.getBitmap=function(h,q){return 32767==q?l[h]:f[h]?f[h][q]:null};this.forEach=function(h){for(var q=f.length,w=0;w<q;w++)h(f[w],w,f)}}}function pc(a){function b(k,
J,N){J[N]=k>>24&255;J[N+1]=k>>16&255;J[N+2]=k>>8&255;J[N+3]=k&255}function d(k,J){var N=k.length;J=new Uint8Array(J?N+1:N);for(var T=0;T<N;T++)J[T]=k.charCodeAt(T);return J}var e=new Uint8Array([0,0,0,0]),c=new Uint8Array([255,255,255,255]),g={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],mvex:[],mvhd:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],
smhd:[],mehd:[]},p=this,I=1,y=a?48E3:9E4,E=1,M=!1,v=null;this.initTypes=function(){for(var k in g)g[k]=[k.charCodeAt(0),k.charCodeAt(1),k.charCodeAt(2),k.charCodeAt(3)];g.url=[117,114,108,32]};p.initTypes();this.reset=function(){M=!1;E=I=1};this.close=function(){p&&(p.reset(),p=null)};this.remux=function(k){k.id=I;k.isAudio=a;k.timeScale=a?k.audioHeader.sampleRate:y;if(!M){var J=new R(a),N=new t(k);v=new Uint8Array(J.data.length+N.data.length);v.set(J.data,0);v.set(N.data,J.data.length);M=!0}k.sequenceNumber=
E++;J=new w(k);N=new L(k);k=new Uint8Array(J.data.length+N.data.length);k.set(J.data,0);k.set(N.data,J.data.length);v&&(J=new Uint8Array(v.length+k.length),J.set(v,0),J.set(k,v.length),k=J,v=null);if(p.ondata)p.ondata(k)};var x=function(k){this.type=k;this.data=null};x.prototype.setData=function(){var k=Array.prototype.slice.call(arguments,0),J=k.length,N=8,T;for(T=0;T<J;T++)N+=k[T].byteLength;this.data=new Uint8Array(N);b(N,this.data,0);this.data.set(this.type,4);N=8;for(T=0;T<J;T++)this.data.set(k[T],
N),N+=k[T].byteLength};var R=function(k){var J=x.call(this,g.ftyp)||this;var N=d("mp42"),T=d("mp41"),ca=d("isom"),ma=d("avc1"),ra=d("iso5"),Ga=new Uint8Array([0,0,2,0]);k?J.setData(N,Ga,N,T,ca,ra):J.setData(ca,Ga,ca,T,ra,ma);return J};$jscomp.inherits(R,x);var t=function(k){var J=x.call(this,g.moov)||this;var N=new z(k),T=new B(k);k=new h(k);J.setData(N.data,T.data,k.data);return J};$jscomp.inherits(t,x);var z=function(k){k=x.call(this,g.mvhd)||this;var J=new Uint8Array([0]),N=new Uint8Array([0,0,
0]),T=new Uint8Array([0,0,0,0]),ca=new Uint8Array([0,0,0,0]),ma=new Uint8Array(4);b(1E3,ma,0);var ra=new Uint8Array([0,1,0,0]),Ga=new Uint8Array([1,0]),La=new Uint8Array(10),Fa=new Uint8Array(36);Fa[1]=1;Fa[17]=1;Fa[32]=64;var ya=new Uint8Array(24),Ta=new Uint8Array([255,255,255,255]);k.setData(J,N,T,ca,ma,e,ra,Ga,La,Fa,ya,Ta);return k};$jscomp.inherits(z,x);var B=function(k){var J=x.call(this,g.trak)||this;var N=new r(k);k=new Q(k);J.setData(N.data,k.data);return J};$jscomp.inherits(B,x);var r=function(k){var J=
x.call(this,g.tkhd)||this;var N=new Uint8Array([0]),T=new Uint8Array([0,0,7]),ca=new Uint8Array([0,0,0,0]),ma=new Uint8Array([0,0,0,0]),ra=new Uint8Array(4);b(k.id,ra,0);var Ga=new Uint8Array(4),La=new Uint8Array(8),Fa=new Uint8Array([0,0]),ya=new Uint8Array([0,0]),Ta=k.isAudio?new Uint8Array([1,0]):new Uint8Array([0,0]),ua=new Uint8Array(2),xa=new Uint8Array(36);xa[1]=1;xa[17]=1;xa[32]=64;var Na=new Uint8Array(4);Na[0]=k.width>>8&255;Na[1]=k.width&255;Na[2]=0;Na[3]=0;var Za=new Uint8Array(4);Za[0]=
k.height>>8&255;Za[1]=k.height&255;Za[2]=0;Za[3]=0;J.setData(N,T,ca,ma,ra,Ga,e,La,Fa,ya,Ta,ua,xa,Na,Za);return J};$jscomp.inherits(r,x);var Q=function(k){var J=x.call(this,g.mdia)||this;var N=new u(k),T=new K(k);k=new F(k);J.setData(N.data,T.data,k.data);return J};$jscomp.inherits(Q,x);var u=function(k){var J=x.call(this,g.mdhd)||this;var N=new Uint8Array([0]),T=new Uint8Array([0,0,0]),ca=new Uint8Array([0,0,0,0]),ma=new Uint8Array([0,0,0,0]),ra=new Uint8Array(4);b(k.timeScale,ra,0);k=new Uint8Array([85,
196]);var Ga=new Uint8Array(2);J.setData(N,T,ca,ma,ra,e,k,Ga);return J};$jscomp.inherits(u,x);var K=function(k){var J=x.call(this,g.hdlr)||this;var N=new Uint8Array([0]),T=new Uint8Array([0,0,0]),ca=new Uint8Array(4);k=k.isAudio?d("soun"):d("vide");var ma=new Uint8Array(12),ra=d("Remote Spark Handler",!0);J.setData(N,T,ca,k,ma,ra);return J};$jscomp.inherits(K,x);var F=function(k){var J=x.call(this,g.minf)||this;var N=new V,T=new wa(k);k.isAudio?(k=new S,J.setData(k.data,N.data,T.data)):(k=new O,J.setData(k.data,
N.data,T.data));return J};$jscomp.inherits(F,x);var O=function(){var k=x.call(this,g.vmhd)||this;var J=new Uint8Array([0]),N=new Uint8Array([0,0,1]),T=new Uint8Array([0,0]),ca=new Uint8Array(6);k.setData(J,N,T,ca);return k};$jscomp.inherits(O,x);var S=function(){var k=x.call(this,g.smhd)||this;var J=new Uint8Array([0]),N=new Uint8Array([0,0,0]),T=new Uint8Array([0,0]),ca=new Uint8Array(2);k.setData(J,N,T,ca);return k};$jscomp.inherits(S,x);var V=function(){var k=x.call(this,g.dinf)||this;var J=new la;
k.setData(J.data);return k};$jscomp.inherits(V,x);var la=function(){var k=x.call(this,g.dref)||this;var J=new Uint8Array([0]),N=new Uint8Array([0,0,0]),T=new Uint8Array([0,0,0,1]),ca=new sa;k.setData(J,N,T,ca.data);return k};$jscomp.inherits(la,x);var sa=function(){var k=x.call(this,g.url)||this;var J=new Uint8Array([0]),N=new Uint8Array([0,0,1]);k.setData(J,N);return k};$jscomp.inherits(sa,x);var wa=function(k){var J=x.call(this,g.stbl)||this;k=new da(k);var N=new Z,T=new va,ca=new f,ma=new l;J.setData(k.data,
N.data,T.data,ca.data,ma.data);return J};$jscomp.inherits(wa,x);var da=function(k){var J=x.call(this,g.stsd)||this;var N=new Uint8Array([0]),T=new Uint8Array([0,0,0]),ca=new Uint8Array([0,0,0,1]);k.isAudio?(k=new na(k),J.setData(N,T,ca,k.data)):(k=new Ba(k),J.setData(N,T,ca,k.data));return J};$jscomp.inherits(da,x);var na=function(k){var J=x.call(this,g.mp4a)||this;var N=new Uint8Array(6),T=new Uint8Array([0,1]),ca=new Uint8Array(8),ma=new Uint8Array([0,2]),ra=new Uint8Array([0,16]),Ga=new Uint8Array([0,
0]),La=new Uint8Array(2),Fa=k.audioHeader.sampleRate,ya=new Uint8Array(4);ya[0]=Fa>>8&255;ya[1]=Fa&255;ya[2]=0;ya[3]=0;k=new za(k);J.setData(N,T,ca,ma,ra,Ga,La,ya,k.data);return J};$jscomp.inherits(na,x);var za=function(k){var J=x.call(this,g.esds)||this;var N=new Uint8Array([0]),T=new Uint8Array([0,0,0]),ca=new Uint8Array([3]),ma=new Uint8Array([25]),ra=new Uint8Array([0,0]),Ga=new Uint8Array([0]),La=new Uint8Array([4]),Fa=new Uint8Array([17]),ya=new Uint8Array([64]),Ta=new Uint8Array([21]),ua=new Uint8Array(3),
xa=k.bufferSizeDB;ua[0]=xa>>16&255;ua[1]=xa>>8&255;ua[2]=xa&255;xa=new Uint8Array(4);b(k.bitRate,xa,0);var Na=new Uint8Array(4);b(k.bitRate,Na,0);var Za=new Uint8Array([5]),Ua=new Uint8Array([2]),$a=k.audioHeader.audioType||2,qb=k.audioHeader.frequencyIdx,lb=k.audioHeader.channelConfig;k=new Uint8Array(2);k[0]=$a<<3|qb>>1&7;k[1]=(qb&1)<<7|lb<<3;$a=new Uint8Array([6]);qb=new Uint8Array([1]);lb=new Uint8Array([2]);J.setData(N,T,ca,ma,ra,Ga,La,Fa,ya,Ta,ua,xa,Na,Za,Ua,k,$a,qb,lb);return J};$jscomp.inherits(za,
x);var Ba=function(k){var J=x.call(this,g.avc1)||this;var N=new Uint8Array(6),T=new Uint8Array([0,1]),ca=new Uint8Array([0,0]),ma=new Uint8Array(2),ra=new Uint8Array(12),Ga=new Uint8Array(2);Ga[0]=k.width>>8&255;Ga[1]=k.width&255;var La=new Uint8Array(2);La[0]=k.height>>8&255;La[1]=k.height&255;var Fa=new Uint8Array([0,72,0,0]),ya=new Uint8Array([0,72,0,0]),Ta=new Uint8Array(4),ua=new Uint8Array([0,1]),xa=d("SparkStreamPlayer"),Na=new Uint8Array(32);Na[0]=xa.length;Na.set(xa,1);xa=new Uint8Array([0,
24]);var Za=new Uint8Array([255,255]);k=new ka(k);J.setData(N,T,ca,ma,ra,Ga,La,Fa,ya,Ta,ua,Na,xa,Za,k.data);return J};$jscomp.inherits(Ba,x);var ka=function(k){var J=x.call(this,g.avcC)||this;var N=new Uint8Array([1]),T=new Uint8Array([k.sps[1]]),ca=new Uint8Array([k.sps[2]]),ma=new Uint8Array([k.sps[3]]),ra=new Uint8Array([255]),Ga=new Uint8Array([225]),La=new Uint8Array(2),Fa=k.sps.byteLength;La[0]=Fa>>8&255;La[1]=Fa&255;Fa=new Uint8Array(k.sps);var ya=new Uint8Array([1]),Ta=new Uint8Array(2),ua=
k.pps.byteLength;Ta[0]=ua>>8&255;Ta[1]=ua&255;k=new Uint8Array(k.pps);J.setData(N,T,ca,ma,ra,Ga,La,Fa,ya,Ta,k);return J};$jscomp.inherits(ka,x);var ia=function(){var k=x.call(this,g.btrt)||this;var J=new Uint8Array([0,28,156,128]),N=new Uint8Array([0,45,198,192]),T=new Uint8Array([0,45,198,192]);k.setData(J,N,T);return k};$jscomp.inherits(ia,x);var Z=function(){var k=x.call(this,g.stts)||this;var J=new Uint8Array([0]),N=new Uint8Array([0,0,0]),T=new Uint8Array([0,0,0,0]);k.setData(J,N,T);return k};
$jscomp.inherits(Z,x);var va=function(){var k=x.call(this,g.stsc)||this;var J=new Uint8Array([0]),N=new Uint8Array([0,0,0]),T=new Uint8Array([0,0,0,0]);k.setData(J,N,T);return k};$jscomp.inherits(va,x);var f=function(){var k=x.call(this,g.stsz)||this;var J=new Uint8Array([0]),N=new Uint8Array([0,0,0]),T=new Uint8Array([0,0,0,0]),ca=new Uint8Array([0,0,0,0]);k.setData(J,N,T,ca);return k};$jscomp.inherits(f,x);var l=function(){var k=x.call(this,g.stco)||this;var J=new Uint8Array([0]),N=new Uint8Array([0,
0,0]),T=new Uint8Array([0,0,0,0]);k.setData(J,N,T);return k};$jscomp.inherits(l,x);var h=function(k){var J=x.call(this,g.mvex)||this;k=new q(k);J.setData(k.data);return J};$jscomp.inherits(h,x);ia=function(k){k=x.call(this,g.mehd)||this;var J=new Uint8Array([0]),N=new Uint8Array([0,0,0]);k.setData(J,N,c);return k};$jscomp.inherits(ia,x);var q=function(k){var J=x.call(this,g.trex)||this;var N=new Uint8Array([0]),T=new Uint8Array([0,0,0]),ca=new Uint8Array(4);b(k.id,ca,0);k=new Uint8Array([0,0,0,1]);
var ma=new Uint8Array([0,0,0,0]),ra=new Uint8Array([0,0,0,0]),Ga=new Uint8Array([0,0,0,0]);J.setData(N,T,ca,k,ma,ra,Ga);return J};$jscomp.inherits(q,x);var w=function(k){var J=x.call(this,g.moof)||this;A.setSequenceNumber(k.sequenceNumber);k=new G(k);J.setData(A.data,k.data);return J};$jscomp.inherits(w,x);ia=function(k){var J=x.call(this,g.mfhd)||this;var N=new Uint8Array([0]),T=new Uint8Array([0,0,0]),ca=new Uint8Array(4);b(k,ca,0);J.setData(N,T,ca);return J};$jscomp.inherits(ia,x);ia.prototype.setSequenceNumber=
function(k){b(k,this.data,12)};var A=new ia(1),G=function(k){var J=x.call(this,g.traf)||this;D.setTrackId(k.id);D.setSampleDuration(k.frameDuration);C.setBaseMediaDecodeTime(k.samples[0].timestamp);var N=32+D.data.length+C.data.length;if(k.isAudio)k=new X(k,null,N);else{for(var T=[],ca=0;ca<k.samples.length;ca++){var ma=k.samples[ca];T.push({size:ma.unitsLength+4*ma.units.length,duration:k.frameDuration||3E3,compositionTimeOffset:0,flags:{isLeading:0,dependsOn:ma.hasIDR?2:1,isDependedOn:0,hasRedundancy:0,
isNonSync:ma.hasIDR?0:1,degradationPriority:0}})}k=new X(k,T,N)}J.setData(D.data,C.data,k.data);return J};$jscomp.inherits(G,x);ia=function(k,J){var N=x.call(this,g.tfhd)||this;N.isAudio=J;var T=new Uint8Array([0]),ca=J?new Uint8Array([2,0,10]):new Uint8Array([2,0,40]),ma=new Uint8Array(4);b(k,ma,0);J?(k=new Uint8Array([0,0,0,1]),J=new Uint8Array(4),b(1024,J,0),N.setData(T,ca,ma,k,J)):(k=new Uint8Array([0,0,2,0,1,1,0,0]),N.setData(T,ca,ma,k));return N};$jscomp.inherits(ia,x);ia.prototype.setTrackId=
function(k){b(k,this.data,12)};ia.prototype.setSampleDuration=function(k){this.isAudio||b(k,this.data,16)};var D=new ia(0,a);ia=function(k){var J=x.call(this,g.tfdt)||this;var N=new Uint8Array([0]),T=new Uint8Array([0,0,0]),ca=new Uint8Array(4);b(k,ca,0);J.setData(N,T,ca);return J};$jscomp.inherits(ia,x);ia.prototype.setBaseMediaDecodeTime=function(k){b(k,this.data,12)};var C=new ia(0),X=function(k,J,N){var T=x.call(this,g.trun)||this;var ca=new Uint8Array([0]),ma=k.isAudio?new Uint8Array([0,2,1]):
new Uint8Array([0,15,1]),ra=k.isAudio?4:16;N+=ra*(k.isAudio?k.samples.length:J.length)+28;var Ga=new Uint8Array(4);k.isAudio?b(k.samples.length,Ga,0):b(J.length,Ga,0);var La=new Uint8Array(4);b(N,La,0);if(k.isAudio){N=new Uint8Array(ra*k.samples.length);for(var Fa=0;Fa<k.samples.length;Fa++)b(k.samples[Fa].aacData.byteLength,N,ra*Fa)}else for(N=new Uint8Array(ra*J.length),Fa=0;Fa<J.length;Fa++){k=J[Fa];var ya=ra*Fa;b(k.duration,N,ya);b(k.size,N,ya+4);var Ta=k.flags,ua=new Uint8Array(4);ua[0]=Ta.isLeading<<
2|Ta.dependsOn;ua[1]=Ta.isDependedOn<<6|Ta.hasRedundancy<<4|0|Ta.isNonSync;ua[2]=Ta.degradationPriority&61440;ua[3]=Ta.degradationPriority&15;N.set(ua,ya+8);b(k.compositionTimeOffset,N,ya+12)}T.setData(ca,ma,Ga,La,N);return T};$jscomp.inherits(X,x);ia=function(k){var J=x.call(this,g.sdtp)||this;for(var N=new Uint8Array([0]),T=new Uint8Array([0,0,0]),ca=new Uint8Array(k.length),ma=0;ma<k.length;ma++){var ra=k[ma].flags;ca[ma]=ra.isLeading<<6|ra.dependsOn<<4|T.isDependedOn<<2|T.hasRedundancy}J.setData(N,
T,ca);return J};$jscomp.inherits(ia,x);var L=function(k){var J=x.call(this,g.mdat)||this;if(k.isAudio){for(var N=new Uint8Array(k.totalByteLength),T=0,ca=0;ca<k.samples.length;ca++){var ma=k.samples[ca].aacData;N.set(ma,T);T+=ma.byteLength}J.setData(N)}else{N=new Uint8Array(4*k.unitNum+k.totalByteLength);for(ca=T=0;ca<k.samples.length;ca++){ma=k.samples[ca];for(var ra=0;ra<ma.units.length;ra++){var Ga=ma.units[ra],La=Ga.data.byteLength;b(La,N,T);T+=4;N.set(Ga.data,T);T+=La}}J.setData(N)}return J};
$jscomp.inherits(L,x)}function qc(a){function b(E,M){this.aacData=E;this.timestamp=M}function d(E,M,v,x){this.audioType=E;this.frequencyIdx=M;this.sampleRate=v;this.channelConfig=x}var e=qc.SAMPLING_FREQUENCY,c=null,g=!0,p=this,I=0;this.reset=function(){I=0;c=null;y.audioHeader=null;a&&a.reset()};var y=new function(){this.samples=[];this.duration=0;this.audioHeader=null;this.height=this.width=0;this.bufferSizeDB=1536;this.totalByteLength=this.bitRate=0;this.clear=function(){this.samples=[];this.totalByteLength=
this.bitRate=this.duration=0}};this.setMediaFormat=function(E,M){var v=E.frequencyIdx;v||(v=e.indexOf(E.sampleRate));-1==v&&console.error("Invalid AAC sampel rate: "+E.sampleRate);c=new d(E.audioType||2,v,E.sampleRate,E.channels||E.channelConfig);y.audioHeader=c;g=!M;if(p.oncodec)p.oncodec("mp4a.40.2",c)};this.parseAACData=this.parse=function(E){if(g){var M=p.readADTSHeader(E);E=E.subarray(M)}M=new b(E,I);I+=1024;y.samples.push(M);y.totalByteLength+=E.byteLength;E=1/(c.sampleRate/1024);y.duration=
E;y.samples[0]&&(y.bitRate=8*y.samples[0].aacData.length/E|0);a&&a.remux(y);y.clear()};this.readADTSHeader=function(E){var M=E[1]&0?9:7,v=(E[2]>>6&3)+1,x=E[2]>>2&15,R=e[x];R||console.error("Invalid Sampling Frequency Index: "+x);var t=((E[2]&1)<<2)+(E[3]>>6&3),z=E[1]>>1&3;0!=z&&console.error("Invalid data format: layer is not 0x00: "+z.toString(16));E.length!=((E[3]&3)<<11)+(E[4]<<3)+(E[5]>>5&7)&&console.error("No enough data in one ADTS frame, length= "+E.length);if(c){if(x!=c.frequencyIdx&&(c.frequencyIdx=
x,c.sampleRate=R,p.oncodec))p.oncodec("mp4a.40.2",c)}else if(c=new d(v,x,R,t),y.audioHeader=c,p.oncodec)p.oncodec("mp4a.40.2",c);return M}}function Nd(a){function b(){0==I&&console.error("no data available");var M=0,v=p-I;for(y=0;v<p;){var x=a[v];if(3!=x||0!=a[v-1]||0!=a[v-2])y=y<<8|x,M++;v++;if(4<=M)break}4>M&&(y<<=4-M);E=8*M;I=p-v}function d(M){if(!(E>M)){M-=E;var v=M>>3;M-=v>>3;I-=v;b()}y<<=M;E-=M}function e(M){var v=Math.min(E,M),x=y>>>32-v;32<M&&logger.error("Read more than 32 bits:"+M);E-=v;
0<E?y<<=v:0<I&&b();v=M-v;return 0<v?x<<v|e(v):x}function c(){var M;for(M=0;M<E;++M)if(0!==(y&2147483648>>>M))return y<<=M,E-=M,M;b();return M+c()}function g(){d(1+c())}var p=a.byteLength,I=p,y=0,E=0;this.readUEG=function(){var M=c();return e(M+1)-1};this.readEG=function(){var M=this.readUEG();return 1&M?1+M>>>1:-1*(M>>>1)};this.readBool=function(){return 1===e(1)};this.readU8=function(){return e(8)};this.readU16=function(){return e(16)};this.readU32=function(){return e(32)};this.skipScalingList=function(M){var v=
8,x=8,R;for(R=0;R<M;R++)0!==x&&(x=this.readEG(),x=(v+x+256)%256),v=0===x?v:x};this.readSPS=function(){var M=0,v=0,x=0,R=0,t=1,z,B=0,r=!0,Q=this.readU8();var u=this.readU8();e(5);d(3);this.readU8();g();if(100===u||110===u||122===u||244===u||44===u||83===u||86===u||118===u||128===u||138===u||139===u||134===u||135===u){var K=this.readUEG();3===K&&d(1);g();g();d(1);if(this.readBool()){var F=3!==K?8:12;for(z=0;z<F;z++)this.readBool()&&(6>z?this.skipScalingList(16):this.skipScalingList(64))}}g();z=this.readUEG();
if(0===z)this.readUEG();else if(1===z)for(d(1),d(1+c()),d(1+c()),F=this.readUEG(),z=0;z<F;z++)d(1+c());g();d(1);z=this.readUEG();F=this.readUEG();var O=e(1);0===O&&d(1);d(1);this.readBool()&&(M=this.readUEG(),v=this.readUEG(),x=this.readUEG(),R=this.readUEG());if(this.readBool()){if(this.readBool()){switch(this.readU8()){case 1:var S=[1,1];break;case 2:S=[12,11];break;case 3:S=[10,11];break;case 4:S=[16,11];break;case 5:S=[40,33];break;case 6:S=[24,11];break;case 7:S=[20,11];break;case 8:S=[32,11];
break;case 9:S=[80,33];break;case 10:S=[18,11];break;case 11:S=[15,11];break;case 12:S=[64,33];break;case 13:S=[160,99];break;case 14:S=[4,3];break;case 15:S=[3,2];break;case 16:S=[2,1];break;case 255:S=[this.readU8()<<8|this.readU8(),this.readU8()<<8|this.readU8()]}S&&(t=S[0]/S[1])}this.readBool()&&d(1);this.readBool()&&(d(4),this.readBool()&&d(24));this.readBool()&&(g(),g());this.readBool()&&(B=this.readU32(),S=this.readU32(),r=this.readBool(),B=S/(2*B))}return{width:Math.ceil((16*(z+1)-2*M-2*v)*
t),height:(2-O)*(F+1)*16-(O?2:4)*(x+R),configVer:Q,profileIdc:u,chromaFormatIdc:K,frameCropLeftOffset:M,frameCropRightOffset:v,frameCropTopOffset:x,frameCropBottomOffset:R,fps:B,fixedFrameRate:r}};this.readSliceType=function(){this.readU8();this.readUEG();return this.readUEG()}}function Od(a){function b(){this.height=this.width=0;this.codec="";this.pps=this.sps=null;this.frameDuration=3E3;this.samples=[];this.sequence=this.unitNum=this.totalByteLength=0;this.clear=function(){this.unitNum=this.totalByteLength=
this.samples.length=0}}function d(){this.units=I;this.unitsLength=y;this.timestamp=c;this.hasIDR=g}function e(){var x=!1;if(p&&M.sps){var R=new d;c+=M.frameDuration||3E3;M.samples.push(R);M.totalByteLength+=y;M.unitNum+=I.length;M.sequence++;x=!0;if(R.hasIDR&&v.onkeyframe)v.onkeyframe(R)}p=g=!1;I=[];y=0;return x}var c=0,g=!1,p=!1,I=[],y=0,E=pc.searchStartCode,M=null,v=this;M=new b;this.reset=function(){c=0;g=!1;I=[];y=0;M=new b;a&&a.reset()};this.close=function(){v&&(v.reset(),v=null)};this.parseH264Data=
this.parse=function(x){for(var R=[],t=0,z,B,r,Q=[0,0];t<x.byteLength;){Q[0]=t;E(x,Q);var u=Q[0];if(-1==u)break;t=Q[1];t=u+t;r=x[t];r&=31;z&&(z={type:B,data:x.subarray(z,u)},R.push(z));z=t;B=r}z&&(z={type:B,data:x.subarray(z,x.byteLength)},R.push(z));for(x=0;x<R.length;x++)switch(Q=R[x],t=Q.type,t){case 1:case 2:case 3:case 4:I.push(Q);y+=Q.data.byteLength;p=!0;break;case 5:p=g=!0;I.push(Q);y+=Q.data.byteLength;break;case 6:break;case 7:z=Q.data;t="avc1."+(0==z[1]?"00":z[1].toString(16));t+=0==z[2]?
"00":z[2].toString(16);t+=0==z[3]?"00":z[3].toString(16);z=new Nd(Q.data);z=z.readSPS();M.width=z.width;M.height=z.height;M.codec=t;M.sps=Q.data;z.fps&&(M.frameDuration=9E4/z.fps|0);I.push(Q);y+=Q.data.byteLength;if(v.oncodec)v.oncodec(t,z);break;case 8:M.pps=Q.data;I.push(Q);y+=Q.data.byteLength;break;case 9:e();break;default:console.log("Ignore NAL unit with type = "+t)}e()&&(a.remux(M),M.clear())}}function Mb(a,b,d){function e(){for(;y;){if(B.updating){y=!1;break}var u=I.shift();if(!u)break;try{B.appendBuffer(u),
E=0}catch(K){I.unshift(u);if("QuotaExceededError"==K.name)if(p(!0))continue;else{if(M.onerror)M.onerror(K);else console.log("QuotaExceededError: not recoverable, isAudio: "+d),M.close();break}E++;console.error("Failed to append buffer, retry "+E,K);if(2<E){if(M.onerror)M.onerror(K);break}}}}function c(){y=!0;e()}function g(){B=z.addSourceBuffer(v);B.mode="sequence";B.addEventListener("updateend",c);B.addEventListener("error",function(u){console.error(u)});y=!0;M.play(!1);e()}function p(u){var K=Math.min(a.played.end(0),
B.buffered.end(0)),F=0,O=t.length,S=!1,V=0;if(d)V=K-180,0>V&&console.warn("Not possible, time played secs: "+K);else if(1<O){var la=O-2;for(K=9E4*K|0;F<O;){if(t[F]>K){la=F-2;break}F++}0<=la&&(V=(t[la]+1E3)/9E4)}if(0<V)try{B.remove(0,V),t.splice(0,la+1),S=!0,console.info("Buffer removed "+V+" isAudio: "+d)}catch(sa){console.warn("Buffer removal "+V+" failed, retry, isAudio: "+d)}u||(R=setTimeout(p,18E4));return S}var I=[],y=!1,E=0,M=this,v="",x=null,R=0,t=[],z=null,B=null,r=null,Q=null;a.autoplay=
!0;this.getKeyFrames=function(){return t};r=new pc(d);r.ondata=function(u){I.push(u);e()};Q=d?new qc(r):new Od(r);Q.onkeyframe=function(u){t.push(u.timestamp)};Q.oncodec=function(u,K){var F=d?"audio/mp4;codecs=":"video/mp4;codecs=";F+=u;if(F!=v||(d?x.sampleRate!=K.sampleRate:x.width!=K.width||x.height!=K.height))if(v=F,x=K,y=!1,B=null,z=new MediaSource,z.addEventListener("sourceopen",g),a.src=URL.createObjectURL(z),M.onsps)M.onsps(K)};b.onvideoframe=function(u){Q.parse(u)};b.onaudioframe=function(u){Q.parse(u)};
b.onendofstream=function(){M.reset()};this.play=function(u){a.play().catch(function(K){if(!u&&(console.error(K),M.onplayerror))M.onplayerror(K)})};this.reset=function(){console.log("Reset player");R&&(clearTimeout(R),R=0);t.length=0;y=!1;v="";x=null;Q&&Q.reset();I.length=0};this.close=function(){M&&(M.reset(),z&&(z.endOfStream(),a.src=null),Q&&Q.close(),r&&r.close(),M=null)};this.setMediaFormat=function(u,K){Q.setMediaFormat&&Q.setMediaFormat(u,K)};this.getMediaSource=function(){return z};this.getMediaSourceBuffer=
function(){return B};a.addEventListener("ended",function(u){console.warn(".... ended");R&&(clearTimeout(R),R=0)});a.addEventListener("emptied",function(u){y=!!B});a.addEventListener("pause",function(u){console.warn(".... paused");y=!!B;a.play().catch(function(K){console.error(K)})});a.addEventListener("waiting",function(u){y=!!B})}this.displayMsg=this.reconnectOnResize=!0;this.appTimeout=1600;this.reconnectTimes=0;this.windowState=3;this.setTitle=this.openLink=!0;this.sessionInfo={domain:"",userName:"",
sessionId:0,joinedSessions:[],suppressOutput:!1,appInfo:null,joiners:[]};this.mode=0;this.remoteAppLogin=!0;var Lb=!1,kb={},ib={},Ab=null,n=this,lc=!1,Xa=!1,cb=0,Bb=null,Uc=0;hi5.appcfg||(hi5.appcfg={img:{},toolbar:{fadable:!0},displayMsg:!0});var fa=hi5.appcfg,Jb="";this.setConfig=function(a){fa=a};var bb="object"==typeof m?m:null,P=bb?{}:hi5.tool.queryToObj(m.substring(m.indexOf("?")+1));void 0==P.mapClipboard&&fa.clipboard&&void 0!=fa.clipboard.enabled&&(P.mapClipboard=fa.clipboard.enabled);void 0==
fa.enableDVCAudio&&(fa.enableDVCAudio=!0);var Ia=0,Ja=0,fb=(ha||P.color||P.server_bpp||16)|0,nc=null,Vc=null,Pa=null,Ib=null,Wc="/DOWNLOAD?",Xc="/CLIP?";24==fb&&(fb=16);var Wa="app"==P.startProgram,Kb=U(P.mapDisk),mb=0;this.setLinks=function(a){a.download&&(Wc=a.download);a.clipboard&&(Xc=a.clipboard)};this.protocol=bb?"":m.substring(0,m.indexOf("://")).toLowerCase();this.hasSmartCard=function(){return U(P.smartCard)||U(P.mapSmartCard)||U(P.passwordIsPin)};this.enableWebAuthn=function(){return U(P.enableWebAuthn)||
U(P.useWebAuthn)};this.hasScanner=function(){return U(P.scanner)};this.hasUSB=function(){return U(P.mapUSB)&&!!navigator.usb};this.getUSB=function(){return P.usb||hi5.appcfg.usb||{filters:[{classCode:0},{classCode:2},{classCode:5},{classCode:6},{classCode:10},{classCode:13},{classCode:239},{classCode:220},{classCode:239},{classCode:254},{classCode:255}]}};this.setProfiler=function(a){Vc=a};this.getProfiler=function(){return Vc};this.gateway=function(){if(bb)return"";var a=m.lastIndexOf("/RDP?");-1==
a&&(a=m.lastIndexOf("/JOIN?"));-1==a&&(a=m.lastIndexOf("/PLAY?"));return m.substring(0,a).replace(/wss:\/\//ig,"https://").replace(/ws:\/\//ig,"http://")}();svGlobal.logger.warn("Ver:"+svGlobal.version+" build:"+svGlobal.build);this.getGatewayAddr=ta;var jb="object"==typeof m||0<m.indexOf("/PLAY?"),Yc=!jb&&0<m.indexOf("invitation=");if(Yc){var rc=decodeURIComponent(m),Nb=rc.indexOf(' USERNAME="');if(0<Nb){Nb+=11;var Pd=rc.substring(Nb,rc.indexOf('"',Nb));m+="&novice="+Pd}m+="&mapClipboard=on";P.mapClipboard=
"on";this.reconnectOnResize=!1}if(jb)this.mode=1,bb?m="":(Ia=640,Ja=480),m+="&touchpad=on",P.touchpad="on",this.reconnectOnResize=!1;else if(0<m.indexOf("/JOIN?")||Yc)this.mode=2,this.reconnectOnResize=!1;var sc=U(P.gfx)||U(P.remotefx)||0<n.mode;sc&&(Wa?sc=!1:fb=32);H?Ia=parseInt(H):P.width&&(Ia=parseInt(P.width));W?Ja=parseInt(W):P.height&&(Ja=parseInt(P.height));-1==Ia&&(Ia=hi5.browser.getScreenWidth());-1==Ja&&(Ja=hi5.browser.getScreenHeight());P.symlink&&P.parameters&&hi5.tool.queryToObj(P.parameters,
P);P.gateway||(m+="&gateway="+encodeURIComponent(n.gateway));!P.minWidth&&fa.minWidth&&(P.minWidth=fa.minWidth);!P.minHeight&&fa.minHeight&&(P.minHeight=fa.minHeight);P.minWidth&&(P.minWidth=parseInt(P.minWidth));P.minHeight&&(P.minHeight=parseInt(P.minHeight));P.waWidth=P.waWidth?parseInt(P.waWidth):hi5.browser.isAndroid||hi5.browser.isiOS?Math.max(screen.width,screen.height):screen.width;P.waWidth&=-4;P.waHeight=P.waHeight?parseInt(P.waHeight):hi5.browser.isAndroid||hi5.browser.isiOS?Math.max(screen.width,
screen.height):screen.height;P.waHeight&=-4;"useSSL"in P||(m+="&useSSL="+("wss"==n.protocol));hi5.storage.isAvailable&&(U(P.shareClipboard)||P.shareClipboardId)&&(m+="&shareClipboardId="+(P.shareClipboardId||Y()));fa&&(void 0!=fa.displayMsg?this.displayMsg=fa.displayMsg:fa.displayMsg=this.displayMsg,fa.appTimeout&&(this.appTimeout=fa.appTimeout),void 0!=fa.reconnectOnResize&&(this.reconnectOnResize=fa.reconnectOnResize),fa.reconnectTimes&&(this.reconnectTimes=fa.reconnectTimes),void 0!=fa.windowState&&
(this.windowState=fa.windowState),void 0!=fa.openLink&&(this.openLink=fa.openLink),void 0!=fa.setTitle&&(this.setTitle=fa.setTitle),"boolean"==typeof fa.useWSS&&(m=(fa.useWSS?"wss":"ws")+m.substring(m.indexOf("://"))),"boolean"==typeof fa.remoteAppLogin&&(this.remoteAppLogin=fa.remoteAppLogin,Lb=!fa.remoteAppLogin,svGlobal.logger.warn("remoteAppLogin deprecated, use hideLogin in appcfg.js instead")),"boolean"==typeof fa.hideLogin&&(Lb=fa.hideLogin),void 0!=fa.localPrinter&&void 0==P.localPrinter&&
(P.localPrinter=fa.localPrinter));var Ma=null;void 0==fa.useWorker&&(fa.useWorker=!1);fa.useWorker&&(!window.Worker||hi5.browser.isFirefox||Wa&&!hi5.browser.isIE||"file:"==location.protocol||0<navigator.userAgent.indexOf("MSIE 10."))&&(fa.useWorker=!1);void 0==hi5.libMin&&(hi5.libMin=!0);var Ka=fa.useWorker?new Worker(pa("rdpworker",hi5.libMin?"rdpworker_min.js":"rdpworker.js")):null,ub=this.reconnectTimes,$b=Ka?{type:5,data:null}:null;this.getDisplayName=aa;this.server=aa();this.port=parseInt(P.port,
10);this.loadbalanceToken="";fa.loadbalanceTokenName&&(P[fa.loadbalanceTokenName]?ea(P[fa.loadbalanceTokenName]):!1!==fa.randomAppId?ea(hi5.tool.uuid()):svGlobal.logger.info("Using app.id as loadbalanceToken"));this.modifyURL=function(a){n.loadbalanceToken&&(a+=-1==a.indexOf("?")?"?"+n.loadbalanceToken:"&"+n.loadbalanceToken,a+="&loadbalanceTokenName="+fa.loadbalanceTokenName);return a};this.getURL=function(){return m};this.getRuntimeURL=function(){var a=m+"&width="+Ia+"&height="+Ja+"&server_bpp="+
fb+"&audio="+(Qa.available||hi5.browser.isIE),b=Ec(),d="";b&&(d=sessionStorage[b]||"")&&(d="&preSymJoin="+d);a+=d;var e=P.monitorDef,c=P.monitor,g=0;b=ba.size();var p=Array(b);d=Array(b);var I=0,y=0,E=0,M=0,v=0,x=0,R="";if(e){d=oa.parseMonitorDef(e);for(b=d.length;g<b;g++){var t=d[g];t[0]<E&&(E=t[0]);t[1]<M&&(M=t[1]);t[2]>v&&(v=t[2]);t[3]>x&&(x=t[3])}0>E&&(I=-E);0>M&&(y=-M);t=0>c?[E,M,v,x]:d[c];P.width=t[2]-t[0]+1;P.height=t[3]-t[1]+1;g=ba.getSurface(0);g.setMonitor(t[0],t[1],t[2],t[3]);if(I||y)for(t=
g.getMousePosition(),t.left+=I,t.right+=I,t.top+=y,t.bottom+=y,g=0;g<b;g++)t=d[g],t[0]+=I,t[1]+=y,t[2]+=I,t[3]+=y;oa.setMonitorLayout(d);0>c&&oa.setMonitorCount(0);n.reconnectOnResize=!1;b="&monitorDef="+e+"&width="+P.width+"&height="+P.height}else{if(1<b&&!Wa){for(ba.verifyMonitors();g<b;g++)e=ba.getSurface(g),t=e.getMousePosition(),t.left<E&&(E=t.left),t.top<M&&(M=t.top),t.right>v&&(v=t.right),t.bottom>x&&(x=t.bottom),p[g]=t,R&&(R+=","),R+=t.left+":"+t.top+":"+t.right+":"+t.bottom;0>E&&(I=-E);0>
M&&(y=-M);for(g=0;g<b;g++){t=ba.getSurface(g).getMousePosition();if(I||y)t.left+=I,t.right+=I,t.top+=y,t.bottom+=y;d[g]=[t.left,t.top,t.right,t.bottom,t.left==I&&t.top==y?1:0]}oa.setMonitorLayout(d);n.reconnectOnResize=!1}R&&(svGlobal.logger.warn("MonitorDef:"+R),P.width=v-E+1,P.height=x-M+1,R="&monitorDef="+R+"&width="+P.width+"&height="+P.height);b=R}a+=b;0>m.indexOf("waWidth")&&(b=(b=ba.getFocused())?b.getWindow():window,a+="&waWidth="+P.waWidth+"&waHeight="+P.waHeight+"&dpWidth="+b.innerWidth+
"&dpHeight="+b.innerHeight);b=new Date;P.tzOffset||(a+="&tzOffset="+b.getTimezoneOffset());P.timezone||(d=hi5.timezone.getTimeZone())&&(a+="&timezone="+encodeURIComponent(d.standardName));a+="&time="+b.getTime();void 0==P.soundPref&&(P.soundPref=0,a+="&soundPref=0");I=d=b="";for(I in kb)y=kb[I],"flags"in y&&(b&&(b+=",",d+=","),b+=y.name,d+=y.flags);b&&(a=a+("&channelName="+b)+("&channelFlags="+d));b="";for(I in ib)y=ib[I],"flags"in y&&(b&&(b+=","),b+=y.name);b&&(a+="&gwChannelName="+b);if(d=ud())b=
d.account,d=d.session,b&&(a+="&account="+b),d&&(a+="&session="+d);b=hi5.browser.isTouch&&(1024<=window.innerWidth||768<=window.innerHeight);P.audioRecord=U(P.audioRecord)&&hi5.audio.recordable;Ea.init(b,sc,P.audioRecord,P.soundPref,U(P.mapCamera)&&!!navigator.mediaDevices,U(P.mapUSB)&&!!navigator.usb);P.audioRecord&&(a+="&audioRecord=on");P.decompressingRDP61&&(a+="&decompressingRDP61=on");0<Ea.count&&(a+="&dvcChannels="+Ea.names.join(","));a+="&binary=on";fa.existingFile&&(a+="&existingFile="+fa.existingFile);
a+="&isTouch="+b+"&gatewayAddr="+encodeURIComponent(ta());a=n.modifyURL(a);fa.copyTextOnly&&U(P.mapClipboard)&&(a+="&copyTextOnly=on");(b=hi5.browser.cookie.get("__SV_TOKEN_A"))&&(a+="&__SV_TOKEN_A="+encodeURIComponent(b));(b=svGlobal.Rdp.languageToKeyboard.detect())&&(a+="&_keyboard="+b);U(P.textPrinter)&&(a+="&printerDriver="+encodeURIComponent("Generic / Text Only"));return a+=Dd()};this.getColor=function(){return fb};this.changeTitle=ja;hi5.browser.isTouch&&Math.max(Ia,Ja)>Math.max(window.innerWidth,
window.innerHeight)&&(this.reconnectOnResize=!1);this.isRemoteApp=function(){return Wa};var Ca=null,Ha=!1,pb=!1,oc=!1,Qa=new function(){function a(I){console.error("play error: ",I)}var b=null;this.supportWebAudio=this.available=!1;(0==P.playSound||0<n.mode)&&(b=hi5.audio.getAudioContext())&&hi5.audio.playable&&(this.supportWebAudio=this.available=!0);this.getContext=function(){return b};this.getBuffer=function(I){return b.createBuffer(2,I,Da.samplePerSec)};var d=0,e=null,c=null;this.setVolume=function(I){1==
I?e=null:(e||(e=b.createGain()),e.gain.value=I)};this.playBuffer=function(I){c=b.createBufferSource();c.buffer=I;e?(c.connect(e),e.connect(b.destination)):c.connect(b.destination);var y=b.currentTime,E=0<d?d:y;E<y&&(E=y);d=E+I.duration;c.start?c.start(E):c.noteOn(E);return d-y};this.iOSFix=function(){if(b){var I=this.getBuffer(1024),y=b.createBufferSource();y.buffer=I;y.connect(b.destination);y.start?y.start(0):y.noteOn(0)}};this.close=function(){b&&(e&&e.disconnect(),c&&c.disconnect(),hi5.audio.releaseAudioContext())};
var g=null,p=null;this.onaudioframe=null;this.initMediaPlayer=function(I,y,E){g||(g=document.createElement("audio"));p||(p=new Mb(g,I,!0),p.onplayerror=a,p.onerror=function(M){console.error("Not possible audio error",M)},svGlobal.logger.info("MediaPlayer init, headerless: "+E+" sampleRate:"+y.sampleRate));p.setMediaFormat(y,E);p.play(!1)}},Kd=Qa.available,oa=new yc(200,200);oa.onSetCursor=Jc;this.setVolume=function(a){Qa&&Qa.setVolume(a)};this.setAudioBuffer=function(a){};var Xb=0,Wb=0,Yb=Ia-1,Zb=
Ja-1,mc="";window.$rdp||(window.$rdp=this);Aa(fb);this.setResolution=Oa;this.running=function(){return Ha};this.setJoinMode=function(a){Ha&&qa("8E1"+a)};this.setJoinCloseMode=function(a){Ha&&qa("8EB3\t"+a)};this.refuseControl=function(a){Ha&&qa("8E3"+a)};this.giveControl=function(a){Ha&&qa("8E4"+a)};this.pauseSession=function(a,b){Ha&&qa("8EB"+(b?1:0)+"\t"+a)};this.closeSession=function(a){Ha&&qa("8EB2\t"+a)};this.requestControl=function(){Ha&&qa("8E2")};this.saveSession=function(a){Ha&&qa("8E9"+
(a.save?1:0)+"\t"+(a.timeout||0)+"\t"+(a.id||0))};this.allowJoin=function(a,b){Ha&&qa("8EA"+a+"\t"+(b?1:0))};var Cb=new function(){function a(){if(d&&0<d.length){var g=d.shift();g.key?Cb.sendSingleKey(g.down,g.key):g.char&&sb(g.char);0<d.length?setTimeout(a,e):(d=null,c&&c())}}var b={" ":57,space:57,pgup:201,pageup:201,pgdn:209,pagedown:209,end:207,home:199,left:203,up:200,right:205,down:208,printscreen:183,insert:210,del:211,"delete":211,altgr:184,windows:219,windowsright:220,context:221,esc:1,backspace:14,
back:14,tab:15,enter:28,meta:29,command:29,ctrl:29,shift:42,alt:56,capslock:58,f1:59,f2:60,f3:61,f4:62,f5:63,f6:64,f7:65,f8:66,f9:67,f10:68,f11:87,f12:88,numlock:69,scrolllock:70,add:78};this.sendSingleKey=function(g,p){var I=b[p.toLowerCase()];I?n.writeScancode(g,I):(I=p.length,0!=I&&(1==I?n.writeKeyCode(g,p.toUpperCase().charCodeAt(0)):g&&n.writeText(p)))};var d=null,e=0,c=null;this.sendKeyComb=function(g,p,I){if(Xa){g=g.split("+");var y=g.length,E;if(0!=y){var M=null,v=[];for(E=0;E<y;E++){var x=
g[E];""==x&&""==M&&(x="Add");""!=x&&v.push({key:x,down:!0});M=x}y=v.length;for(E=y-1;0<=E;E--)v.push({key:v[E].key,down:!1});if(p)d=v,e=p,c=I,a();else for(E=0,y=v.length;E<y;E++)Cb.sendSingleKey(v[E].down,v[E].key)}}};this.sendText=function(g,p,I){for(var y=[],E=0,M=g.length;E<M;E++)y.push({"char":g.charAt(E)});d=y;e=p;c=I;a()}};this.writeKeyComb=function(a,b,d){Xa&&Cb.sendKeyComb(a,b,d)};this.writeText=function(a,b,d){if(Xa)if(b)Cb.sendText(a,b,d);else for(b=0,d=a.length;b<d;b++)sb(a.charAt(b))};
this.writeClipboard=function(a,b){a&&(b||(b="text/plain"),n.writeRawInput("880"+b+"\t"+a.hashCode()),Bb={type:b,text:a})};var ba=new function(a,b){function d(){function c(v){for(;0<v.ownerWinid;){var x=E.getWinById(v.ownerWinid);if(x&&x.isVisible())v=x;else break}return v}function g(v){for(var x="";v;)v.titleInfo&&(x=v.titleInfo),v=E.getWinById(v.ownerWinid);return x}var p=[],I=[],y=0,E=this;this.mainWin=null;this.appId="";var M=0;this.getActiveWinId=function(){return M};this.setActiveWinId=function(v,
x){svGlobal.logger.info("setActiveWinId: "+v+" old: "+M+" max: "+x);if(M!=v){var R=0==M;M=v;(v=E.getMainByWinId(v))&&v.isMainWin()&&E.mainWin!=v&&(E.mainWin=v);R&&x&&(x=ba.getFocused())&&(x=x.getFreeSpace(),v=x.width,n.resetSize(v,x.height))}};this.onchange=function(v){v.isVisible()||v!=E.mainWin?v.isVisible()&&!E.mainWin&&v.isMainWin()&&(E.mainWin=v,3==a.windowState&&v.exeCommand(61488)):E.mainWin=null};this.addWin=function(v){for(var x=p.length,R=!1,t=0;t<x;t++)if(v.id==p[t].id){p[t]=v;R=!0;break}R||
p.push(v);1==p.length&&(y=Date.now());x=v.isMainWin();svGlobal.logger.info("is mainwin:"+x+" id:"+v.id);x&&!E.mainWin&&(E.mainWin=v)};this.popWins=function(v){v=E.getWinById(v);var x=[];if(v){v=0<v.ownerWinid?v.ownerWinid:v.id;for(var R=p.length-1;0<=R;R--)if(p[R].ownerWinid==v||p[R].id==v)x.push(p[R]),p.splice(R,1)}return x};this.hasApp=function(v){return-1!=I.indexOf(v)};this.addApp=function(v){return-1==I.indexOf(v)?(I.push(v),!0):!1};this.isNew=function(){return 3E4>Date.now()-y};this.getAll=
function(){return p};this.hasWin=function(v){return 0<=p.indexOf(v)};this.close=function(){for(var v=0,x=p.length;v<x;v++)p[v].close()};this.clear=function(){p.length=0};this.delWin=function(v){for(var x=0,R=p.length;x<R;x++)if(p[x].id==v)return p.splice(x,1),x;return-1};this.isRunning=function(){var v=p.length;if(1>v)return!1;var x=0;for(v=p.length;x<v;x++){var R=p[x];if(R.showState)return!0}return!1};this.getWinById=function(v){var x=p.length;if(1>x)return null;for(var R=0;R<x;R++){var t=p[R];if(t.id==
v)return t}return null};this.getMainWinByAppId=function(v){var x=null,R=0;for(len=p.length;R<len;){x=p[R];if(x.appId==v&&x.isVisible()&&1>x.ownerWinid)break;R++}return x};this.getTopWin=function(v){var x=null,R,t=v.length;for(R=0;R<t&&(!(x=E.getWinById(v[R]))||!x.isVisible());R++)x=null;if(!x)for(svGlobal.logger.warn("No win found"),t=p.length,R=t-1;0<=R&&(x=p[R],!x.isVisible());R--)x=null;return x};this.getMain=function(v){return(v=E.getTopWin(v))?c(v):null};this.getMainByWinId=function(v){return(v=
E.getWinById(v))?c(v):null};this.getOtherApps=function(v,x,R){var t=p.length;if(0!=t&&p[t-1])if(t=p[t-1].appId,R||!t)setTimeout(function(){E.getOtherApps(v,x)},R||3E3);else{R=[];if(t=E.getTopWin(v)){var z=0<t.ownerWinid?t.ownerWinid:t.id,B=[],r=0;for(t=p.length;r<t;r++)p[r].ownerWinid!=z&&p[r].id!=z&&p[r].isVisible()&&B.push(p[r]);r=0;for(t=B.length;r<t;r++)B[r].ownerWinid!=z&&B[r].id!=z&&(R.push({title:g(B[r]),win:c(B[r])}),z=0<B[r].ownerWinid?B[r].ownerWinid:B[r].id)}x(R)}};this.getFullTitle=function(v){for(var x,
R="";;){x=E.getWinById(v);if(!x)break;x.titleInfo&&x.isVisible()&&(R&&(R=" > "+R),R=x.titleInfo+R);if(1>v)break;v=x.ownerWinid}return R}}var e=[];this.tryCloseRemoteApps=function(){if(a&&a.isRemoteApp())for(var c=e.length,g=0;g<c;g++)e[g].railWin&&e[g].railWin.close()};this.verifyMonitors=function(){for(var c=e.length,g=Array(c),p=0;p<c;p++)e[p].configMonitor(),g[p]=e[p].getMousePosition();g.sort(function(E,M){var v=E.left-M.left;return 0!=v?v:E.top-M.top});var I=g.findIndex(function(E){return 0==
E.left&&0==E.top});svGlobal.logger.info("monitor layout",g,I);-1==I&&(n.showMessage("* Primary monitor not found. Please make your browser window full screen."),svGlobal.logger.warn("Primary monitor not found (left=top=0)",g));for(p=I-1;0<=p;){if(g[p].right<g[p+1].left){var y=g[p+1].left-g[p].right-1;0<y&&(g[p].right+=y,g[p].left+=y)}g[p].bottom<g[p+1].top&&(y=g[p+1].top-g[p].bottom-1,0<y&&(g[p].top+=y,g[p].bottom+=y));p--}for(p=I+1;p<c;)g[p-1].right<g[p].left&&(y=g[p].left-g[p-1].right-1,0<y&&(g[p].right-=
y,g[p].left-=y)),g[p-1].bottom<g[p].top&&(y=g[p].top-g[p-1].bottom-1,0<y&&(g[p].top-=y,g[p].bottom-=y)),p++};this.repaint=function(c,g,p,I){for(var y=0,E=e.length;y<E;y++)e[y].repaint(c,g,p,I)};this.size=function(){return e.length};this.getSurface=function(c){return e[c]};this.addSurface=function(c){e.push(c)};this.hasSurface=function(c){for(var g=e.length,p=0;p<g;p++)if(e[p].equals(c))return!0;return!1};this.getMonitorSurface=function(c,g,p,I){var y=e.length;if(1==y)return e[0];for(var E=0;E<y;E++)if(e[E].isMonitor(c,
g,p,I))return e[E];return null};this.fromSyncedSurface=function(c){var g=e.length;Date.now();for(var p=0;p<g;p++)if(e[p].isClipSynced(c))return!0;return!1};this.setSize=function(c,g,p){for(var I=0,y=e.length;I<y;I++)e[I].setSize(c,g,p)};this.zOrders=[];this.drawLicense=function(c){for(var g=0,p=e.length;g<p;g++)e[g].drawLicense(c)};this.setReadOnly=function(c,g){for(var p=0,I=e.length;p<I;p++)e[p].setReadOnly(c,g)};this.setVisible=function(c,g){svGlobal.logger.info("TODO: setVisible")};this.setCursor=
function(c){for(var g=0,p=e.length;g<p;g++)e[g]&&e[g].setCursor(c)};this.hide=function(c){c=0;for(var g=e.length;c<g;c++)e[c]&&e[c].hide()};this.execute=function(c,g){for(var p=0,I=e.length;p<I;p++)e[p][c].apply(e[p],g)};this.addWin=function(c){var g=this.getFocused();g||(svGlobal.logger.warn("Focused surface not found!"),g=e[e.length-1]);g?(Wa=!0,g.railWin||(g.railWin=new d,g.onunload=function(){hi5.appcfg.closeRemoteApp&&g.railWin&&g.railWin.close();g.remoteApp&&g.remoteApp.close();g.railWin&&(g.railWin.clear(),
g.railWin=null);e.removeElm(g)}),g.context&&b.setContext(g.context),g.railWin.addWin(c),g.railWin.mainWin==c&&(setTimeout(function(){var p=g.getFreeSpace();a.writeRawInput("8C661441\t"+p.width+"\t"+p.height);svGlobal.logger.info("-- main win dp change:"+p.height);3==a.windowState?c.resizable()&&setTimeout(function(){c.exeCommand(61488);svGlobal.logger.info("-- max")},50):5==a.windowState&&3==c.showState&&setTimeout(function(){c.exeCommand(3856);svGlobal.logger.info("-- restor")},50)},111),Ra.sendKeyboardSyncFlags(Ra.localLockFlags,
500)),hi5.browser.isIE&&g.focus()):svGlobal.logger.warn("No surface available!")};this.delWin=function(c){for(var g,p=e.length-1;0<=p;p--){var I=e[p];g=I.railWin;var y=g.getWinById(c),E=y&&y.appId&&-1!=y.appId.toLowerCase().indexOf("runonce");if(0<=g.delWin(c)){y==g.mainWin&&(g.mainWin=null);if(I.toolbar){c="win"+c;var M=I.toolbar.querySelector("#"+c);M&&I.toolbar.removeChild(M)}if(!g.isRunning()&&0==n.mode){if(y.isMainWin()&&I.onremoteappclose)I.onremoteappclose(y);y=a.appTimeout;if(E||g.isNew())y*=
10;svGlobal.logger.debug("Prepare del:"+Date.now());setTimeout(function(v){return function(){svGlobal.logger.info("Start del:"+Date.now());v.railWin&&v.railWin.isRunning()||(v.remoteApp&&v.remoteApp.close(),ba&&ba.delSurface(v))}}(I),y)}}}};this.popWins=function(c){return e[0]&&e[0].railWin?e[0].railWin.popWins(c):[]};this.getWinById=function(c){for(var g,p=0,I=e.length;p<I;p++)if(e[p]&&e[p].railWin&&(g=e[p].railWin.getWinById(c)))return g;return null};this.getMainWinByAppId=function(c){for(var g,
p=0,I=e.length;p<I;p++)if(e[p].railWin&&(g=e[p].railWin.getMainWinByAppId(c)))return g;return null};this.onWinChange=function(c){for(var g,p=0,I=e.length;p<I;p++)if(e[p].railWin&&(g=e[p].railWin.getWinById(c.id)))e[p].railWin.onchange(c)};this.setTitle=function(c){for(var g,p=0,I=e.length;p<I;p++)if(e[p].railWin){g=e[p].railWin.getWinById(c);var y=e[p].railWin.getFullTitle(c);if(y){a.changeTitle(y,e[p].getWindow(),g.appId);break}}};this.hasApp=function(c){for(var g=0,p=e.length;g<p;g++)if(e[g].railWin.hasApp(c))return!0;
return!1};this.delSurface=function(c){!c||c.railWin&&c.railWin.isRunning()||(svGlobal.logger.info("delete surface..."),e.removeElm(c),c.close(),0==e.length&&a._unload())};this.getOwnerSurface=function(c){for(var g=0,p=e.length;g<p;g++)if(e[g].railWin&&e[g].railWin.hasWin(c))return e[g];return null};this.getOwnerSurfaceById=function(c){for(var g,p=0,I=e.length;p<I;p++)if(e[p].railWin&&(g=e[p].railWin.getWinById(c)))return e[p];return null};this.getFocused=function(){for(var c=e.length,g=0;g<c;g++)if(e[g].focused)return e[g];
return e[c-1]};this.close=function(){for(var c=0,g=e.length;c<g;c++)e[c]&&(e[c].remoteApp&&e[c].remoteApp.close(),e[c].close(),e[c]=null)};this.LocalWin=function(c){function g(){a.writeRawInput("8C0"+c)}this.id=c;this.appId="";var p=this;this.resizable=function(){return p.isVisible?0!=(p.style&262144)||0!=(p.style&65536)||0!=(p.style&16777216)||3==p.showState:!1};this.setShowState=function(I){p.showState=I};this.parent=function(){return ba.getWinById(p.ownerWinid)};this.resize=function(I,y,E,M){svGlobal.logger.info("www resize, l "+
I+" w "+E);hi5.appcfg.disableJoinedAppResize&&2==a.mode||a.writeRawInput("8C1"+p.id+"\t"+I+"\t"+y+"\t"+E+"\t"+M)};this.exeCommand=function(I){svGlobal.logger.info("www exeCommand, cmd "+I);a.writeRawInput("8C4"+c+"\t"+I)};this.activate=function(I){svGlobal.logger.info("www activate, enable "+I+" id:"+c);2==p.showState?(p.exeCommand(61728),setTimeout(function(){a.writeRawInput("8C3"+c+"\t"+I)},50)):a.writeRawInput("8C3"+c+"\t"+I)};this.close=function(){svGlobal.logger.info("www close");p.exeCommand(61536)};
this.getAppId=g;this.isVisible=function(){return p.winWidth&&p.winHeight&&p.showState&&45<p.winHeight&&45<p.winWidth};this.isMainWin=function(){if(!(p.isVisible()&&p.winWidth&&p.winHeight&&45<p.winHeight&&45<p.winWidth))return!1;var I=1>p.ownerWinid;if(!I)return I;var y=p.style;if(0!=(y&4194304))return!0;if(0!=(y&2147483648)&&(0==(y&8388608)||0==(y&12582912)))return!1;var E=0!=(p.extStyle&128);(I=I&&!E)&&0!=(y&2147483648)&&0==(y&2156396544)&&(I=!1);return I};g()}}(n,oa);this.getSurfaces=function(){return ba};
this.hide=function(){ba&&ba.hide()};this.getFileUrl=function(a,b,d){var e=ta(),c=Wc,g=c.indexOf("://");e=(0<g&&11>g?c:e+c)+"s="+mc+"&f="+encodeURIComponent(a);b&&(e+="&src="+b);d&&(e+="&action="+d);return n.modifyURL(e)};this.listFiles=function(a,b){Ma&&Xa&&Ma.list(a,b)};this.writeRawInput=function(a){if(Xa){qa(a);if(n.onactivity)n.onactivity(a);return!0}return!1};this.authWithCode=function(a,b){var d=a.length,e=new Uint8Array(5+d);e[0]=146;e[1]=7;e[2]=b;e[3]=d&255;e[4]=d>>8&255;for(b=0;b<d;b++)e[5+
b]=a.charCodeAt(b);qa(e.buffer)};var Zc=0;if(fa.numLock||fa.numlock||U(P.numLock)||hi5.browser.isMacOS||hi5.browser.isiOS||hi5.browser.isCrOS)Zc|=2;var Ra=new function(a,b){this.setJoinMode=a.setJoinMode;this.requestControl=a.requestControl;this.writeKeyComb=a.writeKeyComb;this.writeText=a.writeText;this.localLockFlags=b||0;this.remoteLockFlags=0;this.checkLockFlags=!0;this.reqCopyTime=0;a.isRemoteApp();var d=void 0,e=a.getSurfaces();this.saveResize=function(c){d=a.reconnectOnResize;a.reconnectOnResize=
c};this.restoreResize=function(){void 0!=d&&(a.reconnectOnResize=d)};this.getAppMode=function(){return a.mode};this.getAgentStatus=function(){return a.getAgentStatus()};this.send=a.writeRawInput;this.saveSession=function(c){a.saveSession(c)};this.sendInput=a.writeRawInput;this.getAppInfo=function(){return a.sessionInfo.appInfo};this.resumePlay=function(){Qa.supportWebAudio&&Qa.iOSFix()};this.onresize=function(c){if((c=c.target.svSurface)&&!document.hidden){var g=c.getFreeSpace(),p=g.width;g=g.height;
Ra.checkLockFlags=!0;fa.scale?c.scaleTo(p,g,!1):a.resetSize(p,g)}};this.onorientationchange=function(c){a.resetSize(c.innerWidth,c.innerHeight)};this.getClipData=function(c,g){this.reqCopyTime=Date.now();var p=a.getGatewayAddr(),I=Xc,y=I.indexOf("://");p=(0<y&&11>y?I:p+I)+"s="+a.sessionInfo.appInfo.session+"&t="+Date.now()+"&type="+c;c=hi5.httpGet(a.modifyURL(p),g);this.reqCopyTime=Date.now();Rc(c);return c};this.getShareFiles=a.listFiles;this.getFile=function(c,g,p){a.reconnectOnResize=!1;var I=
a.getFileUrl(c,g,p);n.ondownload&&n.ondownload({fileName:c,url:I,source:g,action:p})||window.open(I)};this.getFileLink=a.getFileUrl;this.getGateway=function(){return m};this.reconnect=function(c,g,p){P.symlink?(c="user="+c+"&pwd="+g,p&&(c+="&domain="+p),m=hi5.tool.replaceQuery(m,"parameters",c)):(m=hi5.tool.replaceQuery(m,"user",c),m=hi5.tool.replaceQuery(m,"pwd",g),m=hi5.tool.replaceQuery(m,"domain",p));a.run()};this.sendKeyboardSyncFlags=function(c,g){return Xa?(this.remoteLockFlags=this.localLockFlags=
c,setTimeout(function(){a.writeRawInput("8E5"+c)},g||333),!0):!1};this.sendKeyboardSynchronize=function(c,g,p){var I=0;p&&(I|=4);g&&(I|=2);c&&(I|=1);this.sendKeyboardSyncFlags(I)};this.fromSyncedSurface=function(c){return e.fromSyncedSurface(c)};this.setWorkDir=function(c){a.writeKeyComb("Windows+R",20,function(){setTimeout(function(){a.writeText(c,10,function(){a.writeScancode(!0,28);a.writeScancode(!1,28)})},666)})};this.authWithCode=function(c,g){a.authWithCode(c,g)};this.getPrinters=function(c){a.getPrinters(c)};
this.attachPrinter=function(c){a.attachPrinter(c)}}(n,Zc),Qd=new function(a,b){this.draw=a.draw;this.refresh=function(d,e,c,g){return a.repaint(d,e,c-d+1,g-e+1)};this.onfocus=function(d){var e=b.getFocused();Wa&&e&&e.railWin&&(d=e.railWin.mainWin)&&_core.running()&&(e=e.context)&&e!=a.getContext()&&(a.setContext(null),d.activate(1),svGlobal.logger.info("Activate win:"+d.id))}}(oa,ba);this.sendKeyboardSynchronize=function(a,b,d){Ra.sendKeyboardSynchronize(a,b,d)};this.VirtualChannel=function(){return new ob(143)};
this.GatewayChannel=function(){return new ob(28)};this.DynamicChannel=function(){return new ob(64)};this.addChannel=function(a){kb[a.name]=a};this.addGatewayChannel=function(a){ib[a.name]=a};this.addDynamicChannel=function(a){Ea.names.push(a.name);Ea[a.name]=a;Ea.count++};var Sa=null,Ea={count:0,names:[],usbChannel:null,close:function(){for(var a=Ea.names,b=0,d=a.length;b<d;b++)Ea[a[b]].onclose&&(Ea[a[b]].onclose(),Ea[a[b]]=null);a.length=0;Ea.usbChannel=null},init:function(a,b,d,e,c,g){function p(){this.WAVE_FORMAT_PCM=
1;this.WAVE_FORMAT_ADPCM=2;this.WAVE_FORMAT_ALAW=6;this.WAVE_FORMAT_MULAW=7;this.WAVE_FORMAT_GSM=49;this.WAVE_FORMAT_MPEGLAYER3=85;this.WAVE_FORMAT_AAC=41222;this.cbSize=this.bitsPerSample=this.nBlockAlign=this.nAvgBytesPerSec=this.nSamplesPerSec=this.nChannels=this.formatTag=0;this.extenstion=null;var t=this;this.fromBuffer=function(z,B){t.formatTag=z.getLittleEndian16();t.nChannels=z.getLittleEndian16();t.nSamplesPerSec=z.getLittleEndian32();t.nAvgBytesPerSec=z.getLittleEndian32();t.nBlockAlign=
z.getLittleEndian16();t.bitsPerSample=z.getLittleEndian16();var r=z.getLittleEndian16();t.cbSize=r;0<r&&!0!==B&&(t.extenstion=Array(r),z.copyToByteArray(t.extenstion,0,z.getPosition(),r),z.skipPosition(r))};this.toBuffer=function(z){z.setLittleEndian16(t.formatTag);z.setLittleEndian16(t.nChannels);z.setLittleEndian32(t.nSamplesPerSec);z.setLittleEndian32(t.nAvgBytesPerSec);z.setLittleEndian16(t.nBlockAlign);z.setLittleEndian16(t.bitsPerSample);z.setLittleEndian16(t.cbSize);0<t.cbSize&&z.setBytes(t.extenstion)};
this.getSize=function(){return 18+t.cbSize};this.toString=function(){return"Audio Format, tag="+t.formatTag+" nChannels="+t.nChannels+" nSamplesPerSec="+t.nSamplesPerSec+" nAvgBytesPerSec="+t.nAvgBytesPerSec+" nBlockAlign="+t.nBlockAlign+" bitsPerSample="+t.bitsPerSample+" cbSize="+t.cbSize}}function I(){Sa=new n.DynamicChannel;Sa.name="Microsoft::Windows::RDS::DisplayControl";Sa.enabled=!1;Sa.process=function(t){var z=t.getLittleEndian32();t.getLittleEndian32();switch(z){case 5:z=t.getLittleEndian32(),
Sa.maxMonitorAreaFactorA=t.getLittleEndian32(),Sa.maxMonitorAreaFactorB=t.getLittleEndian32(),Sa.enabled=!0,svGlobal.logger.warn("Display control maxNumMonitors:"+z+" factorA:"+Sa.maxMonitorAreaFactorA+" factorB:"+Sa.maxMonitorAreaFactorB),t=new Uint8Array(2),t[0]=146,t[1]=4,qa(t.buffer),Pa&&setTimeout(function(){Pa&&Pa.check(5E3)},1900)}};Sa.applyResolution=function(t,z){if(Sa.enabled){var B=new Uint8Array(56),r=new RdpBuffer(B,0,56);t=t>Sa.maxMonitorAreaFactorA?Sa.maxMonitorAreaFactorA:t&-4;z=z>
Sa.maxMonitorAreaFactorB?Sa.maxMonitorAreaFactorB:z&-4;r.setLittleEndian32(2);r.setLittleEndian32(56);r.setLittleEndian32(40);r.setLittleEndian32(1);r.setLittleEndian32(1);r.setLittleEndian32(0);r.setLittleEndian32(0);r.setLittleEndian32(t);r.setLittleEndian32(z);r.setLittleEndian32(.26458*t|0);r.setLittleEndian32(.26458*z|0);r.setLittleEndian32(t>z?0:90);r.setLittleEndian32(100);r.setLittleEndian32(100);Sa.send(B);svGlobal.logger.warn("Display control: "+t+"x"+z)}else svGlobal.logger.warn("Display control disabled.")};
return Sa}if(!fa.disableDVC){if(fa.enableEcho){var y=new n.DynamicChannel;y.name="ECHO";y.process=function(t){var z=t.getPosition(),B=t.getEnd(),r=new Uint8Array(B-z);r.set(t.getData().subarray(z,B));y.send(r)};n.addDynamicChannel(y)}if(a){var E=new n.DynamicChannel;E.name="Microsoft::Windows::RDS::Input";E.process=function(t){var z=t.getLittleEndian16();t.getLittleEndian32();switch(z){case 1:t.skipPosition(4),t=new RdpBuffer(new Uint8Array(16),0,16),t.setLittleEndian16(2),t.setLittleEndian32(16),
t.setLittleEndian32(3),t.setLittleEndian32(65536),t.setLittleEndian16(256),t.markEnd(),E.send(t);case 5:ba.execute("setTouchRemoting",[!0]);Ea.isTouchReady=!0;svGlobal.logger.info("Touch remoting start");break;case 4:ba.execute("setTouchRemoting",[!1]),Ea.isTouchReady=!1,svGlobal.logger.info("Touch remoting suspend")}};n.addDynamicChannel(E)}if(d){svGlobal.logger.warn("Audio input on");var M=new n.DynamicChannel;(function(){function t(V){var la=new RdpBuffer(new Uint8Array(5),0,5);la.setByte(7);la.setLittleEndian32(V);
la.markEnd();M.send(la)}function z(V){var la=V.getLittleEndian32(),sa=V.getLittleEndian32(),wa=new p;wa.fromBuffer(V,!0);var da=0,na=0;0<wa.cbSize&&(22==wa.cbSize?(da=V.getLittleEndian16(),na=V.getLittleEndian32(),V.skipPosition(16)):(svGlobal.logger.warn("Wrong cbsize: "+wa.cbSize),V.skipPosition(wa.cbSize)));V=r[sa];svGlobal.logger.info("Selceted rec fmt, framesPerPacket: "+la+" initial: "+sa+", "+V.toString());svGlobal.logger.info("Open fmt: "+wa.toString()+" validBits:"+da+" mask:"+na);u=!0;K=
n.reconnectOnResize;n.reconnectOnResize=!1;S.onopen||(S.onopen=function(za){if(Ha){B=za;n.reconnectOnResize=K;t(sa);var Ba=new RdpBuffer(new Uint8Array(5),0,5);Ba.setByte(4);Ba.setLittleEndian32(za?0:1);Ba.markEnd();M.send(Ba)}});S.ondata||(S.ondata=function(za,Ba){B&&(F.length!=Ba+1&&(F=new Uint8Array(Ba+1),F[0]=6),M.send(Q),F.set(za,1),M.send(F))});S.start(V,la)}M.name="AUDIO_INPUT";M.process=function(V){var la=V.getByte();switch(la){case 1:V=V.getLittleEndian32();la=new RdpBuffer(new Uint8Array(5),
0,5);la.setByte(1);la.setLittleEndian32(V);la.markEnd();M.send(la);break;case 2:var sa=V.getLittleEndian32();V.getLittleEndian32();var wa=Qa.getContext().sampleRate;for(la=r.length=0;la<sa;la++){var da=new p;da.fromBuffer(V);svGlobal.logger.info("Server rec fmt "+la+":"+da.toString());0==e&&49==da.formatTag&&22050==da.nSamplesPerSec?r.push(da):1==da.formatTag&&da.nSamplesPerSec<=wa&&r.push(da)}M.send(Q);sa=0;V=r.length;for(la=0;la<V;la++)sa+=r[la].getSize();wa=new RdpBuffer(new Uint8Array(1024),0,
1024);wa.setByte(2);wa.setLittleEndian32(V);wa.setLittleEndian32(sa+9);for(la=0;la<V;la++)r[la].toBuffer(wa),svGlobal.logger.info("Client rec fmt: "+r[la].toString());wa.skipPosition(1024-sa-9);wa.markEnd();M.send(wa);break;case 3:z(V);break;case 7:la=V.getLittleEndian32();svGlobal.logger.info("Rec fmt change, "+r[la].toString()+" by client:"+u);u||(t(la),u=!1);break;default:svGlobal.logger.warn("audioInput: invalid tag:"+la)}};var B=!1,r=[];M.onclose=function(){B=!1;S&&S.close()};var Q=new Uint8Array(1);
Q[0]=5;var u=!1,K=n.reconnectOnResize,F=new Uint8Array(0),O=pa("audiorecorder",hi5.libMin?"audiorecorder_min.js?v=0":"audiorecorder.js?v=0"),S=window.AudioWorkletNode?new hi5.audio.WorkletRecorder(Qa.getContext(),O):new hi5.audio.Recorder(Qa.getContext())})();n.addDynamicChannel(M)}n.addDynamicChannel(function(){var t=new n.DynamicChannel;t.name="TSMF";var z={type:"image/jpeg"},B=Array(1);t.process=function(r){r.getPosition();var Q=r.getLittleEndian32()&1073741823;var u=r.getLittleEndian32();var K=
r.getLittleEndian32();switch(Q){case 2:if(256==K){r.getLittleEndian32();K=new Uint8Array(16);var F=new RdpBuffer(K,0,16);F.setLittleEndian32(2);F.setLittleEndian32(u);F.setLittleEndian32(1);F.setLittleEndian32(0);t.send(K)}break;case 0:switch(K){case 257:r.getBytes(16);r.getLittleEndian32();break;case 256:Q=r.getPosition();F=r.getLittleEndian32();for(K=0;K<F;K++){r.getLittleEndian32();var O=r.getLittleEndian32();r.getLittleEndian32();r.skipPosition(O-4)}K=r.getPosition()-Q;F=K+8+4;K=new Uint8Array(F);
F=new RdpBuffer(K,0,F);F.setLittleEndian32(-2147483648);F.setLittleEndian32(u);K.set(r.getData().subarray(Q,r.getPosition()),8);t.send(K);break;case 261:r.getBytes(16);r.getLittleEndian32();break;case 264:Q=r.getLittleEndian32();r.skipPosition(4);r.getLittleEndian32();O=r.getBytes(16);var S=r.getBytes(16);r.getLittleEndian32();r.getLittleEndian32();r.getLittleEndian32();var V=r.getBytes(16);K=r.getLittleEndian32();r.skipPosition(K);K=new Uint8Array(20);F=new RdpBuffer(K,0,20);F.setLittleEndian32(-2147483648);
F.setLittleEndian32(u);hi5.Arrays.equals([118,105,100,115,0,0,16,0,128,0,0,170,0,56,155,113],O)&&hi5.Arrays.equals([77,74,80,71,0,0,16,0,128,0,0,170,0,56,155,113],S)&&hi5.Arrays.equals([128,159,88,5,86,195,206,17,191,1,0,170,0,85,89,90],V)?F.setLittleEndian32(1):(F.setLittleEndian32(0),svGlobal.logger.warn("Format is not supported:"),svGlobal.logger.warn(O),svGlobal.logger.warn(S),svGlobal.logger.warn(V));F.setLittleEndian32(Q);t.send(K);break;case 258:r.getBytes(16);r.getLittleEndian32();Q=r.getLittleEndian32();
r.skipPosition(Q);break;case 263:r.getBytes(16),K=new Uint8Array(16),F=new RdpBuffer(K,0,16),F.setLittleEndian32(-2147483648),F.setLittleEndian32(u),F.setLittleEndian32(1),t.send(K);case 277:r.getBytes(16);r.getLittleEndian32();break;case 262:r.getBytes(16);oa.flushImgs();oa.setImgRect(0,0,0,0);K=new Uint8Array(12);F=new RdpBuffer(K,0,12);F.setLittleEndian32(-2147483648);F.setLittleEndian32(u);t.send(K);break;case 278:r.getBytes(16);u=r.getLittleEndian32();K=r.getLittleEndian32();Q=r.getLittleEndian32();
r=r.getLittleEndian32();oa.setImgRect(u,K,Q-u,r-K);break;case 265:r.getBytes(16);r.getLittleEndian64();r.getLittleEndian32();break;case 266:r.getBytes(16);break;case 268:r.getBytes(16);break;case 267:r.getBytes(16);break;case 269:r.getBytes(16);r.getLittleEndian32();break;case 274:break;case 275:break;case 259:r.getBytes(16);r.getLittleEndian32();r.getLittleEndian32();r.skipPosition(32);K=r.getLittleEndian32();u=new Image;Q=r.getPosition();B[0]=r.getData().subarray(Q,Q+K);r=new Blob(B,z);u.src=URL.createObjectURL(r);
oa.addImg(u);break;case 270:oa.flushImgs();break;case 273:break;case 260:break;case 276:r.getBytes(16);K=r.getLittleEndian32();Q=r.getPosition()+K;r.skipPosition(8);u=r.getLittleEndian32();svGlobal.logger.info("window state:"+u);F=r.getLittleEndian32();O=r.getLittleEndian32();u=r.getLittleEndian32();K=r.getLittleEndian32();r.skipPosition(8);S=r.getLittleEndian32();V=r.getLittleEndian32();svGlobal.logger.info("Window rect, left:"+u+" top:"+K+" w:"+F+" h:"+O+" cl:"+S+" ct:"+V);r.setPosition(Q);Q=r.getLittleEndian32();
for(Q=r.getPosition()+Q;r.getPosition()<Q;){S=r.getLittleEndian32();V=r.getLittleEndian32();var la=r.getLittleEndian32(),sa=r.getLittleEndian32();svGlobal.logger.info("visible region, l:"+V+" t:"+S+" r:"+sa+" b:"+la)}oa.setImgRect(u,K,F,O);break;case 1:case 2:break;default:svGlobal.logger.warn("unknown function:"+K)}break;default:svGlobal.logger.warn("unkown interface:"+Q)}};return t}());jb||n.addDynamicChannel(I());fa.enableDVCAudio&&n.addDynamicChannel(function(t){var z=!1,B=0,r=0,Q=0,u=0,K=[],
F=new Uint8Array(4),O=new n.DynamicChannel;O.name="AUDIO_PLAYBACK_DVC";O.onclose=function(){};O.process=function(S){function V(ka){ka.skipPosition(14);var ia=ka.getLittleEndian16();ka.getByte();var Z=ka.getLittleEndian16();ka.skipPosition(1);for(var va,f=K.length=0;f<ia;f++){var l=new p;l.fromBuffer(ka);(va=22050<=l.nSamplesPerSec&&(1==l.formatTag||49==l.formatTag&&22050==l.nSamplesPerSec&&0==t||41222==l.formatTag))&&K.push(l)}l=20;ka=K.length;for(f=0;f<ka;f++)l+=K[f].getSize();f=l+4;ia=new RdpBuffer(new Uint8Array(f),
0,f);ia.setByte(7);ia.setByte(2);ia.setLittleEndian16(l);ia.setLittleEndian32(3);ia.setLittleEndian32(4294967295);ia.setLittleEndian32(0);ia.setLittleEndian16(0);ia.setLittleEndian16(ka);ia.skipPosition(1);ia.setLittleEndian16(Z);ia.setByte(124);for(f=0;f<ka;f++)l=K[f],l.toBuffer(ia);ia.markEnd();O.send(ia);5<Z&&(ia=new RdpBuffer(new Uint8Array(8),0,8),ia.setByte(12),ia.skipPosition(1),ia.setLittleEndian16(4),ia.setLittleEndian16(0),ia.setLittleEndian16(0),ia.markEnd(),O.send(ia))}function la(ka){var ia=
ka.getLittleEndian16();ka=ka.getLittleEndian16();var Z=new RdpBuffer(new Uint8Array(8),0,8);Z.setByte(6);Z.setByte(35);Z.setLittleEndian16(4);Z.setLittleEndian16(ia);Z.setLittleEndian16(ka);Z.markEnd();O.send(Z)}function sa(){var ka=K[Q];if(ka.formatTag!=Da.tag||ka.nSamplesPerSec!=Da.samplePerSec||Da.channels!=ka.nChannels)Da.tag=ka.formatTag,Da.channels=ka.nChannels,Da.samplePerSec=ka.nSamplesPerSec,Da.bitsPerSample=49==ka.formatTag?8:ka.bitsPerSample,svGlobal.logger.info("DVC Audio Format, tag="+
Da.tag+" channels="+Da.channels+" bitsPerSample="+Da.bitsPerSample+" samplePerSec="+Da.samplePerSec),41222==Da.tag&&(Da.sampleRate=Da.samplePerSec,Qa.initMediaPlayer(Qa,Da,!0))}function wa(ka){r=ka.getLittleEndian16();Q=ka.getLittleEndian16();u=ka.getByte();ka.skipPosition(3);F.set(ka.getSubarray(4));z=!0;sa()}function da(ka,ia){var Z=new RdpBuffer(new Uint8Array(8),0,8);Z.setByte(5);Z.skipPosition(1);Z.setLittleEndian16(4);Z.setLittleEndian16(ka);Z.setByte(ia);Z.skipPosition(1);Z.markEnd();O.send(Z)}
function na(ka){z=!1;var ia=B-8,Z=Date.now();ka.copyFromByteArray(F,0,ka.getPosition(),4);kc(ka,u,r,ia);ka=r+(Date.now()-Z);da(ka,u)}function za(ka){var ia=Date.now();r=ka.getLittleEndian16();Q=ka.getLittleEndian16();u=ka.getByte();ka.skipPosition(7);sa();ka=kc(ka,u,r,0);ka*=1E3;ia=r+(Date.now()-ia)+ka;da(ia,u)}if(z)na(S);else{var Ba=S.getByte();S.skipPosition(1);B=S.getLittleEndian16();switch(Ba){case 7:V(S);break;case 6:la(S);break;case 2:wa(S);break;case 3:S.getLittleEndian16();S.getLittleEndian16();
break;case 13:za(S)}}};return O}(e));svGlobal.DCVC_EXTENSION||(svGlobal.DCVC_EXTENSION={});var v=svGlobal.DCVC_EXTENSION;v.videoMedia={video:null,track:null,canvas:null,ctx:null,resolutions:null,minFrameRate:16,type:2,activate:function(t,z){svGlobal.logger.info("activate webcam");v.videoMedia.resolutions?t():hi5.video.resolutions(function(B){B.length?(v.videoMedia.resolutions=B,t()):z()})},deactivate:function(){var t=v.videoMedia;t.track&&(t.track.stop(),t.track=null);t.ctx=null;t.canvas=null;t.video=
null;svGlobal.logger.info("deactivate cam")},startStream:function(t,z,B,r,Q){svGlobal.logger.info("startStream, width:"+t+" height:"+z+" frameRate:"+B);var u=v.videoMedia,K=u.track;if(K){var F=K.getSettings();if("live"==K.readyState)if(t!=F.width||z!=F.height||B!=F.frameRate&&2!=u.type)K.stop();else return}navigator.mediaDevices.getUserMedia({video:{frameRate:2==u.type?u.minFrameRate:B,width:{exact:t},height:{exact:z}}}).then(function(O){var S=document.createElement("video");S.srcObject=O;S.play();
if(window.OffscreenCanvas)var V=new OffscreenCanvas(100,100);else V=document.createElement("canvas"),V.style.position="absolute",V.style.left=0,V.style.top=0;u.track=O.getVideoTracks()[0];u.canvas=V;u.ctx=V.getContext("2d");u.video=S;O=u.track.getSettings();u.canvas.width=O.width;u.canvas.height=O.height;r()}).catch(function(O){svGlobal.logger.warn(O);Q()})},stopStream:function(){svGlobal.logger.info("stopStream");var t=v.videoMedia;t.track&&"live"==t.track.readyState&&t.track.stop()},grabFrame:function(t){function z(r){r.arrayBuffer().then(t)}
var B=v.videoMedia;B.ctx.drawImage(B.video,0,0);B=B.canvas;B.convertToBlob?B.convertToBlob({type:"image/jpeg",quality:.6}).then(z):B.toBlob(z,"image/jpeg",.6)},propertyList:[[{propertyId:1,capabilities:3,min:4294967286,max:4294967294,step:1,default:4294967291},null,{propertyId:3,capabilities:1,min:4294967280,max:16,step:1,default:0},{propertyId:4,capabilities:1,min:0,max:3,step:1,default:0},{propertyId:5,capabilities:1,min:4294967280,max:16,step:1,default:0},{propertyId:6,capabilities:1,min:100,max:400,
step:10,default:100}],[{propertyId:1,capabilities:1,min:0,max:2,step:1,default:1},{propertyId:2,capabilities:1,min:4294967232,max:64,step:1,default:0},{propertyId:3,capabilities:1,min:0,max:95,step:1,default:0},{propertyId:4,capabilities:1,min:4294965296,max:2E3,step:1,default:0},{propertyId:5,capabilities:3,min:2800,max:6500,step:1,default:4600}]]};v.WEBAUTHN=function(t){var z=new t;z.name="WebAuthN_Channel";z.newInstance=function(){return v.WEBAUTHN(t)};z.onopen=function(){svGlobal.logger.info("webAuthn open")};
z.onclose=function(){svGlobal.logger.info("webAuthn close")};z.process=function(B){var r=B.getEnd()-B.getPosition();B=B.getBytes(r);var Q=Hb(B),u=Q.command;r=Q.flags;B=Q.timeout;var K=Q.webAuthNPara;if(u)switch(console.log("==== command: "+Q.command),u){case 5:if(Q.request)switch(u=Q.request[0],console.log("==== webAuth cmdType = "+u),console.log("==== webAuth request bytes: "+tb(Q.request.slice(1,Q.request.length))),u){case 1:Q=Q.request.slice(1,Q.request.length);var F=Hb(Q);Q=F[1];var O=F[2],S=
F[3],V=F[4],la=F[5];u=F[6];var sa=F[7];F={};var wa=wd(K);wa&&(wa.attestation&&(F.attestation=wa.attestation),wa.attestationFormats&&(F.attestationFormats=wa.attestationFormats));if(r=vd(r,K,sa))F.authenticatorSelection=r;F.challenge=Q;la&&(F.excludeCredentials=Dc(la));u&&(F.extensions=u);V&&(F.pubKeyCredParams=V);F.rp={id:window.location.hostname,name:"RS_Gateway"};B&&(F.timeout=B);F.user=S;B={};B.signal=createNewAbortWebAuthnSignal();B.publicKey=F;navigator.credentials.create(B).then(function(da){xd(da.response,
O).then(function(na){var za={},Ba={maxMsgSize:1200,maxSerializedLargeBlobArray:0,providerType:"Hid",providerName:"MicrosoftCtapHidProvider",devicePath:"\\\\?\\hid#vid_1050&pid_0407&mi_01#7&1dd131cc&0&0000#{4d1e55b2-f16f-11cf-88cb-001111000030}"},ka=new Uint8Array([159,87,192,47,19,129,234,71,177,22,187,90,141,185,32,42]);Ba.aaGuid=ka.buffer;Ba.residentKey=!0;za.deviceInfo=Ba;za.status=0;za.response=na;na=CBOR.encode(za);za=new hi5.DataBuffer(new Uint8Array(4+na.byteLength));za.setLittleEndian32(0);
za.setBytes(na);za.markEnd();z.send(za)})}).catch(function(da){console.log("WebAuthN MakeCredential failed with error code ["+da.code+"], msg: "+da.message);da=new hi5.DataBuffer(new Uint8Array(4));da.setLittleEndian32(1);da.markEnd();z.send(da)});break;case 2:Q=Q.request.slice(1,Q.request.length);F=Hb(Q);Q=F[2];S=F[3];u=F[4];sa=F[5];F={};S&&(F.allowCredentials=Dc(S));F.challenge=Q;u&&(F.extensions=u);F.rp=window.location.hostname;B&&(F.timeout=B);if(B=Cc(r,K,sa))F.userVerification=B;B={};B.signal=
createNewAbortWebAuthnSignal();B.publicKey=F;navigator.credentials.get(B).then(function(da){da=new hi5.DataBuffer(new Uint8Array(void 0));da.markEnd();z.send(da)}).catch(function(da){console.log("WebAuthN GetAssertion failed with error code ["+da.code+"], msg: "+da.message);da=new hi5.DataBuffer(new Uint8Array(4));da.setLittleEndian32(1);da.markEnd();z.send(da)});break;default:svGlobal.logger.error("Unknown WebAuthn command type: "+u)}else svGlobal.logger.error("Incorrect request content in WEB AUTH COMMAND");
break;case 6:B=new hi5.DataBuffer(new Uint8Array(8));B.setLittleEndian32(0);r=Bc()?PublicKeyCredential.isUserVerifyingPlatformAuthenticatorAvailable():!1;r?B.setLittleEndian32(1):B.setLittleEndian32(0);B.markEnd();z.send(B);break;case 7:cancelWebAuthnOperations();B=new hi5.DataBuffer(new Uint8Array(4));B.setLittleEndian32(0);B.markEnd();z.send(B);break;case 8:B=new hi5.DataBuffer(new Uint8Array(8));B.setLittleEndian32(0);B.setLittleEndian32(4);B.markEnd();z.send(B);break;default:svGlobal.logger.warn("Unknown command received in WebAuthN Channel: "+
u)}else svGlobal.logger.warn("WebAuthN Channel, command missed")};return z};n.enableWebAuthn()&&Bc()&&(a=v.WEBAUTHN(n.DynamicChannel),n.addDynamicChannel(a));v.WEBCAM=function(t){var z=new t;z.name="RDCamera_Device_0";z.version=2;z.newInstance=function(){return v.WEBCAM(t)};z.onopen=function(){svGlobal.logger.info("cam open")};z.onclose=function(){svGlobal.logger.info("cam close")};z.sendSucess=function(){var B=new hi5.DataBuffer(new Uint8Array(2));B.setByte(z.version);B.setByte(1);B.markEnd();z.send(B)};
z.sendError=function(B){var r=new hi5.DataBuffer(new Uint8Array(6));r.setByte(z.version);r.setByte(2);r.setLittleEndian32(B||1);r.markEnd();z.send(r)};z.sendSteamListResp=function(){var B=new hi5.DataBuffer(new Uint8Array(7));B.setByte(z.version);B.setByte(10);B.setLittleEndian16(1);B.setByte(1);B.setByte(1);B.setByte(0);B.markEnd();z.send(B)};z.sendMediaTypeListResp=function(B){var r=v.videoMedia.resolutions,Q=r.length,u=new hi5.DataBuffer(new Uint8Array(2+26*Q));u.setByte(z.version);u.setByte(12);
for(var K=1==B,F=0;F<Q;F++){u.setByte(B);var O=r[F];u.setLittleEndian32(O.width);u.setLittleEndian32(O.height);u.setLittleEndian32(K?O.frameRate:v.videoMedia.minFrameRate);u.setLittleEndian32(1);u.setLittleEndian32(1);u.setLittleEndian32(1);u.setByte(1)}u.markEnd();z.send(u)};z.sendCurrentMediaType=function(B,r){var Q=new hi5.DataBuffer(new Uint8Array(28));Q.setByte(z.version);Q.setByte(14);r=v.videoMedia.resolutions[r];Q.setByte(B);Q.setLittleEndian32(r.width);Q.setLittleEndian32(r.height);Q.setLittleEndian32(1==
B?r.frameRate:v.videoMedia.minFrameRate);Q.setLittleEndian32(1);Q.setLittleEndian32(1);Q.setLittleEndian32(1);Q.setByte(1);Q.markEnd();z.send(Q)};z.sendSampleResp=function(B){v.videoMedia.grabFrame(function(r){var Q=new hi5.DataBuffer(new Uint8Array(r.byteLength+3));Q.setByte(z.version);Q.setByte(18);Q.setByte(B);Q.setBytes(new Uint8Array(r));Q.markEnd();z.send(Q)})};z.sendPropertyListResp=function(){for(var B=0,r,Q,u=v.videoMedia.propertyList,K=0;2>K;K++){Q=u[K];r=Q.length;for(var F=0;F<r;F++)null!=
Q[F]&&B++}var O=new hi5.DataBuffer(new Uint8Array(2+19*B));O.setByte(z.version);O.setByte(21);for(K=0;2>K;K++)for(Q=u[K],r=Q.length,F=0;F<r;F++)B=Q[F],null!=B&&(O.setByte(K+0),O.setByte(B.propertyId),O.setByte(B.capabilities),O.setLittleEndian32(B.min),O.setLittleEndian32(B.max),O.setLittleEndian32(B.step),O.setLittleEndian32(B.default));O.markEnd();z.send(O)};z.sendPropertyValueResp=function(B,r){(B=v.videoMedia.propertyList[B][r-1])?(r=new hi5.DataBuffer(new Uint8Array(7)),r.setByte(z.version),
r.setByte(23),r.setByte(1),r.setLittleEndian32(B.value||B.default),r.markEnd(),z.send(r)):z.sendError(8)};z.process=function(B){B.getByte();var r=B.getByte();switch(r){case 7:v.videoMedia.activate(z.sendSucess,z.sendError);break;case 8:v.videoMedia.deactivate();z.sendSucess();break;case 9:z.sendSteamListResp();break;case 11:B=B.getByte();0!=B&&svGlobal.logger.warn("Invalid stream index: "+B);z.sendMediaTypeListResp(v.videoMedia.type);break;case 13:B=B.getByte();z.sendCurrentMediaType(v.videoMedia.type,
B);break;case 15:B.getByte();r=B.getByte();if(r!=v.videoMedia.type){svGlobal.warn("Invalid video format req:"+r);z.sendError(6);break}r=B.getLittleEndian32();var Q=B.getLittleEndian32();B=B.getLittleEndian32()/B.getLittleEndian32();v.videoMedia.startStream(r,Q,B,z.sendSucess,z.sendError);break;case 16:v.videoMedia.stopStream();z.sendSucess();break;case 17:B=B.getByte();0!=B&&svGlobal.logger.info("Invalid stream index for SampleRequest: "+B);z.sendSampleResp(B);break;case 20:z.sendPropertyListResp();
break;case 22:r=B.getByte();B=B.getByte();z.sendPropertyValueResp(r,B);break;case 24:z.sendError(10);break;default:z.sendError(10),svGlobal.logger.warn("Invalid cam msg: "+r)}};return z};v.WEBCAM_ENUM=function(t,z){var B=new t;B.name="RDCamera_Device_Enumerator";B.onopen=function(){var r=new hi5.DataBuffer(new Uint8Array(2));r.setByte(z.version);r.setByte(3);r.markEnd();B.send(r);svGlobal.logger.info("camEnum open")};B.onclose=function(){svGlobal.logger.info("camEnum closed");v.videoMedia.deactivate()};
B.addDevice=function(r){r+="\x00";var Q=z.name+"\x00",u=new hi5.DataBuffer(new Uint8Array(2+2*r.length+Q.length));u.setByte(z.version);u.setByte(5);u.setUnicodeString(r);u.setAscllString(Q);u.markEnd();B.send(u)};B.process=function(r){var Q=r.getByte();r=r.getByte();switch(r){case 4:svGlobal.logger.info("camEnum ver resp: "+Q);z.version=Q;B.addDevice(hi5.video.webcam&&hi5.video.webcam.label||"Web Camera");break;default:svGlobal.logger.warn("invalid messageId on camEnum: "+r)}};return B};c&&(c=v.WEBCAM(n.DynamicChannel),
a=v.WEBCAM_ENUM(n.DynamicChannel,c),n.addDynamicChannel(a),n.addDynamicChannel(c));g&&(svGlobal.logger.info("Mapping USB..."),n.addDynamicChannel(Ea.usbChannel));if(b&&v.GFX){var x=function(){R.controller.resumePlay||(R.controller.resumePlay=function(){Qa&&Qa.supportWebAudio&&Qa.iOSFix();R.resumeVideo()})},R=v.GFX(n.DynamicChannel,U(P.remotefx)&&!U(P.gfx),0==n.mode,oa);R.onmessage=function(t){n.showMessage(t)};x();R.onuserinteract=function(t){ba.execute("showPlay");x();svGlobal.logger.info("resumePlay");
return!0};R.onfatalerror=function(t,z){n.reconnect(t.width,t.height,!0)};R.onsps=function(t){t.fps&&n.setFPS(t.fps)};R.onresetgraphic=function(t){n.setResolution(t.width,t.height)};R.onmapsurface=function(t){R.onconfirm();var z=ba.getMonitorSurface(t.outputOriginX,t.outputOriginY,t.targetWidth+t.outputOriginX-1,t.targetHeight+t.outputOriginY-1);z?(z.setId(t.id),z.setSize(t.targetWidth,t.targetHeight)):svGlobal.logger.error("Failed to map surface, x:"+t.outputOriginX+" y:"+t.outputOriginY)};R.onconfirm=
function(){svGlobal.logger.info("GFXDrawableController in use");ba.execute("setDrawable",[R.controller])};n.addDynamicChannel(R)}}}},db=null;svGlobal.DCVC_EXTENSION&&!jb&&(n.hasUSB()&&svGlobal.DCVC_EXTENSION.WEBUSB&&(Ea.usbChannel=svGlobal.DCVC_EXTENSION.WEBUSB(n.DynamicChannel)),svGlobal.DCVC_EXTENSION.DRIVE&&(db=svGlobal.DCVC_EXTENSION.DRIVE(n.GatewayChannel),n.addGatewayChannel(db)));this.getPrinters=function(a){if(!n.onagentmessage||!db)return null;var b=new hi5.DataBuffer(new Uint8Array(2));
b.setByte(6);b.setByte(1);b.markEnd();n.onagentmessage(b.getData());db.listCallback=a};this.attachPrinter=function(a){db&&db.attachPrinter(a,n)};this.showError=Gb;this.resetStatus=ac;this.exeAppCmd=function(a){var b=ba.getFocused();b&&b.exeCommand(a)};this.activateApp=function(a){var b;(b=hi5.tool.isNumber(a)?ba.getWinById(a):ba.getMainWinByAppId(a))?b.activate(1):svGlobal.logger.warn("No window found in "+a)};this.reconnect=function(a,b,d){void 0==d&&(d=fa.forceReconnect||!1);if(!Ha&&!d)return!1;
P.minWidth&&a<P.minWidth&&(a<P.minWidth&&svGlobal.logger.warn("Width "+a+" is samller than minWidth "+P.minWidth),a=P.minWidth);P.minHeight&&b<P.minHeight&&(b<P.minHeight&&svGlobal.logger.warn("Height "+b+" is samller than minHeight "+P.minHeight),b=P.minHeight);a&=-4;b&=-4;if(!d&&4>Math.abs(a-Ia)&&4>Math.abs(b-Ja))return!1;if(Sa&&Sa.enabled&&!1!==fa.displayVC)Sa.applyResolution(a,b);else if(oc&&pb||d||Xa&&!oc)pb=!1,svGlobal.logger.info("reconnecting..."),qa("8E0"+a+"\t"+b),Ra&&(Ra.remoteLockFlags=
0,Ra.checkLockFlags=!0);return!0};this.notify=function(a,b){a="8E6"+a;b&&(a+="\t"+b.join(";"));qa(a)};this.getUploadManager=function(){return Ma};this.setFPS=function(a){ba.execute("setFPS",[a])};this.addSurface=function(a){if(!ba.hasSurface(a)&&(Lb||oa.setContext(a.context),!ba.hasSurface(a)||!a.railWin)){jb&&a.setPlayerMode();P.mouseMoveEmu&&(a.mouseMoveEmu=U(P.mouseMoveEmu));a.setSize(50,50,"hidden");var b=a.getFreeSpace();0==Ia&&(Ia=b.width);0==Ja&&(Ja=b.height);a.setConfig(fa);ba.addSurface(a);
Oa(Ia,Ja,!0,P.monitorDef?!0:!1);a.setController(Ra);a.setDrawable(Qd);a.setTouchpad(U(P.touchpad));var d=b=U(P.mapClipboard),e=b;void 0!=P.copyToLocal?d=U(P.copyToLocal):void 0!=fa.copyToLocal&&(d=fa.copyToLocal);void 0!=P.copyToRemote?e=U(P.copyToRemote):void 0!=fa.copyToRemote&&(e=fa.copyToRemote);a.setClipboard(b,d,e);Kb&&bc(a);P.invitation&&!U(P.control)&&(ba.setReadOnly(!0),b=hi5.$("requestControl"))&&(b.disabled=!1);b=void 0!=P.ctrlToWin?U(P.ctrlToWin):void 0!=fa.ctrlToWin?fa.ctrlToWin:!0;d=
void 0!=P.cmdToCtrl?U(P.cmdToCtrl):void 0!=fa.cmdToCtrl?fa.cmdToCtrl:!0;a.run(parseInt(P.keyboard||1033,10),b,!!fa.noKeyStuck,d)}};this.getRunninApps=this.getRunningApps=function(){for(var a=[],b=0,d=ba.size();b<d;b++)ba.getSurface(b).railWin.getMain(ba.zOrders)&&a.push(ba.getSurface(b).railWin.getMain(ba.zOrders).titleInfo);return a};this.startApp=function(a,b,d){b=b||"";d=d||"";qa("8C2"+a+"\t"+b+"\t"+d);var e=ba.getSurface(ba.size()-1);e&&(e.remoteApp=new Ac(a,b,d))};this.startExitingApp=function(a){a=
ba.popWins(a);for(var b=a.length-1;0<=b;b--)ba.addWin(a[b])};var vb=new n.DynamicChannel;vb.name="PNPDR";vb.onopen=function(){svGlobal.logger.info("PNPDR DVC onopen()")};vb.process=function(a){a.getLittleEndian32();var b=a.getLittleEndian32();switch(b){case 101:a.getLittleEndian32(),a.getLittleEndian32(),a.getLittleEndian32(),a=new RdpBuffer(new Uint8Array(20),0,20),a.setLittleEndian32(20),a.setLittleEndian32(b),a.setLittleEndian32(1),a.setLittleEndian32(5),a.setLittleEndian32(1),vb.send(a)}};vb.onclose=
function(){svGlobal.logger.info("PNPDR DVC onclose()")};n.addDynamicChannel(vb);var gb=null;U(P.scanner)&&(gb=new n.DynamicChannel,gb.name="SCANNERDVC",gb.onopen=function(){svGlobal.logger.info("scanner DVC onopen().")},gb.process=function(a){var b=a.getByte();switch(b){case 0:var d=a.getByte(),e=a.getByte();b=new Uint8Array(10);b[0]=4;b[1]=7;b[2]=d;b[3]=e;b.set(a.getBytes(2),4);b.set(a.getBytes(2),6);b.set(a.getBytes(2),8);if(n.onagentmessage)n.onagentmessage(b);break;case 1:break;case 2:d=a.getEnd()-
a.getPosition();b=new Uint8Array(d+2);b[0]=4;b[1]=3;b.set(a.getBytes(d),2);if(n.onagentmessage)n.onagentmessage(b);break;case 3:d=a.getEnd()-a.getPosition();b=new Uint8Array(d+3);b[0]=4;b[1]=9;b[2]=0;b.set(a.getBytes(d),3);if(n.onagentmessage)n.onagentmessage(b);break;default:svGlobal.logger.info('Warning: Unknown type "'+b+'" received from DVC, ignored.')}},gb.onclose=function(){var a=new Uint8Array(2);a[0]=4;a[1]=4;if(n.onagentmessage)n.onagentmessage(a)},n.addDynamicChannel(gb));var ab=null;n.hasSmartCard()&&
(ab=new n.GatewayChannel,ab.name="SCARDSTB",ab.onopen=function(){var a=new Uint8Array(2);a[0]=3;a[1]=1;if(n.onagentmessage)n.onagentmessage(a);U(P.passwordIsPin)&&n.onagentmessage&&!hi5.browser.isMacOS&&hi5.notifications.notify({msg:__svi18n.info.scardAuth||"Smart card authentication in progress. Please wait...",type:0,timeout:1E4})},ab.process=function(a){var b=a.getEnd()-a.getPosition(),d=a.getByte(),e=a.getByte();switch(d){case 1:switch(e){case 1:d=new Uint8Array(2);d[0]=3;d[1]=7;if(n.onagentmessage)n.onagentmessage(d);
break;case 3:a=a.getBytes(b-2);b=b+4+4+4;wb&&(b+=wb.length);eb&&(b+=eb.length);b=new hi5.DataBuffer(new Uint8Array(b));b.setByte(3);b.setByte(9);wb?(b.setLittleEndian32(wb.length),b.setBytes(wb)):b.setLittleEndian32(0);eb?(b.setLittleEndian32(eb.length),b.setBytes(eb)):b.setLittleEndian32(0);b.setLittleEndian32(a.length);b.setBytes(a);b.markEnd();if(n.onagentmessage)n.onagentmessage(b.getData());break;case 5:a=a.getBytes(b);d=new Uint8Array(b);d[0]=3;d[1]=11;d.set(a,2);if(n.onagentmessage)n.onagentmessage(d);
break;case 2:case 4:break;default:svGlobal.logger.warn("Invalid smart card channel auth data received: unknown sub-type ["+a[1]+"].")}break;case 2:if(ab)if(1==e){if(d=new Uint8Array(b),d[0]=3,d[1]=3,d.set(a.getBytes(b),2),n.onagentmessage)n.onagentmessage(d)}else svGlobal.logger.warn("Invalid smart card channel pcsc data received: unknown sub-type ["+a[1]+"].");break;default:svGlobal.logger.warn("Invalid smart card channel data received: unknown type ["+a[0]+"].")}},ab.onclose=function(){var a=new Uint8Array(2);
a[0]=3;a[1]=4;if(n.onagentmessage)n.onagentmessage(a)},n.addGatewayChannel(ab));fa.detectNetwork&&(m+="&connectType=7",Ad());this.getNetworkResult=function(){return Ib};this.getAgentLink=function(){var a=navigator.userAgentData?navigator.userAgentData.platform:navigator.platform||navigator.appVersion;return-1!=a.indexOf("Win")?"agent_setup.exe":-1!=a.indexOf("macOS")||-1!=a.indexOf("Mac")?"agent_setup.pkg":""};var cc=new Map,dc=new Map;this.writeAgent=function(a){a.byteLength&&(a=new Uint8Array(a));
switch(a[0]){case 3:if(ab){var b=a.slice?new hi5.DataBuffer(a.slice(2,a.length)):new hi5.DataBuffer(a.subarray(2,a.length));switch(a[1]){case 1:case 4:case 5:case 6:case 7:case 9:case 11:break;case 2:break;case 3:a[0]=2;a[1]=1;ab.send(a);break;case 8:cc.clear();dc.clear();a=b.getLittleEndian32();if(0!=a)a=b.getLittleEndian32(),b=b.getAscllString(a,!1),hi5.notifications.notify({msg:b});else{var d=b.getLittleEndian32(),e=document.getElementById("scardSelection");e||(e=document.createElement("div"),
e.id="scardSelection",e.className="appdlg",document.body.appendChild(e));if(e)if(0==d)e&&(e.innerHTML="<p>Error: Could not find any connected smart card. Please make check the connectivity and then refresh the page",b=new hi5.ui.Lightbox(e),b.onclose=function(){location.reload()},b.show());else{e.innerHTML=1<d?'<p><b>PLEASE SELECT A SMART CARD, ENTER YOUR CREDENTIAL AND CLICK "Continue".</b></p>':'<p><b>PLEASE ENTER YOUR CREDENTIAL AND CLICK "Continue".</b></p>';for(a=0;a<d;a++){var c=b.getLittleEndian32();
c=b.getBytes(c);var g=b.getLittleEndian32();g=b.getAscllString(g,!1);var p=b.getLittleEndian32();p=b.getAscllString(p,!1);var I=b.getLittleEndian32();b.getAscllString(I,!1);I=b.getLittleEndian64();I=(new Date(1E3*I)).toDateString();c=Bd(a,c,p,g,I);e.appendChild(c)}e.innerHTML+="<br>";b=document.createElement("div");b.innerHTML+="Smart card credential: ";a=document.createElement("input");a.type="text";a.id="userPin";a.placeholder="PIN";a.value="";a.required=!0;b.appendChild(a);e.appendChild(b);e.innerHTML+=
"<br>";b=new hi5.ui.LightboxWithBtn(e);b.onclose=function(){var y,E=document.querySelector('input[name="scard_name"]:checked');E&&(y=parseInt(E.value));wb=cc.get(y);rb=dc.get(y);y=document.getElementById("userPin").value;eb=(new TextEncoder("utf-8")).encode(y);y=2;y=eb?y+4+eb.length:y+4;y=rb?y+4+rb.length:y+4;y=new Uint8Array(y);y=new hi5.DataBuffer(y);y.setByte(1);y.setByte(2);eb?(y.setLittleEndian32(eb.length),y.setBytes(eb)):y.setLittleEndian32(0);rb?(y.setLittleEndian32(rb.length),y.setAsciiString(rb,
rb.length)):y.setLittleEndian32(0);ab&&ab.send(y)};document.getElementById("userPin").addEventListener("keypress",function(y){"Enter"===y.key&&(y.preventDefault(),document.getElementById("continue_button").click())});b.show()}}break;case 10:a=b.getLittleEndian32();0!=a?(a=b.getLittleEndian32(),b=b.getAscllString(a,!1),hi5.notifications.notify({msg:b})):(a=b.getLittleEndian32(),a=b.getBytes(a),b=new Uint8Array(6+a.length),b=new hi5.DataBuffer(b),b.setByte(1),b.setByte(4),b.setLittleEndian32(a.length),
b.setBytes(a),ab.send(b));break;case 12:a[0]=1;a[1]=6;ab.send(a);break;default:svGlobal.logger.warn("Warning: Unknown smart card response header: [3 / "+a[1]+"], ignored.")}}break;case 4:if(gb)switch(a[1]){case 2:b=a.slice?new hi5.DataBuffer(a.slice(2,a.length)):new hi5.DataBuffer(a.subarray(2,a.length));e=document.getElementById("dsSelection");e||(e=document.createElement("div"),e.id="dsSelection",e.className="appdlg",document.body.appendChild(e));if(0!=b.getLittleEndian16())e&&(e.innerHTML="<p>Error on local: failed to get the list of connected scanners. Close to continue without scanning.</p>",
b=new hi5.ui.Lightbox(e),b.onclose=function(){n.run()},b.show());else if(d=(a.byteLength-4)/41,0==d)e&&(e.innerHTML="<p>Error: Could not find any connected scanner. Please:<ul><li>Power on or connect the scanner and then refresh the page; or</li><li>Close this dialog to connect to the machine without using scanner.</li></ul></p>",b=new hi5.ui.Lightbox(e),b.onclose=function(){n.run()},b.show());else if(1==d){if(b=new Uint8Array(3),b[0]=4,b[1]=5,b[2]=0,n.onagentmessage)n.onagentmessage(b)}else if(e){e.innerHTML=
'<p> Please choose a scanner &lt;DriverType: DeviceName&gt; and click "Continue".</a></p>';for(a=0;a<d;a++)c=b.getAscllString(41,!0),c=Cd(a,c),e.appendChild(c);e.innerHTML+="<br>";b=new hi5.ui.LightboxWithBtn(e);b.onclose=function(){var y=0,E=document.querySelector('input[name="ds_name"]:checked');E&&(y=E.value);E=new Uint8Array(3);E[0]=4;E[1]=5;E[2]=y;if(n.onagentmessage)n.onagentmessage(E)};b.show()}break;case 3:case 8:case 10:b=a.slice?new hi5.DataBuffer(a.slice(2,a.length)):new hi5.DataBuffer(a.subarray(2,
a.length));gb.send(b);break;case 4:b=a.slice?new hi5.DataBuffer(a.slice(2,a.length)):new hi5.DataBuffer(a.subarray(2,a.length));gb.send(b);hi5.notifications.notify({msg:__svi18n.info.TwainNotSupported,type:2});break;case 6:b=a.slice?new hi5.DataBuffer(a.slice(2,a.length)):new hi5.DataBuffer(a.subarray(2,a.length));b.getLittleEndian16();n.run();break;default:svGlobal.logger.warn("Warning: Unknown response header: [4 / "+a[1]+"], ignored.")}break;case 5:switch(a[1]){case 1:b=a[2]|a[3]<<8,a=a[4]|a[5]<<
8,svGlobal.logger.info("Agent version, major: "+b+" minor: "+a),(e=hi5.appcfg.agent&&hi5.appcfg.agent.version)&&(e.major>b||e.major==b&&e.minor>a)&&(b=__svi18n.info.newVersion||"New versoin available",a=__svi18n.info.updateAgent||"Please download and install the new gateway agent",e=n.getAgentLink(),hi5.notifications.notify({title:b,msg:a+(': <a href="'+e+'">'+e+"</a>")}))}break;case 6:switch(a[1]){case 1:b=new hi5.DataBuffer(a);b.skipPosition(2);e=b.getLittleEndian32();d=[];for(a=0;a<e;a++)g=b.getLittleEndian32(),
c=b.getUnicodeString(g),g=b.getLittleEndian32(),g=b.getUnicodeString(g),d.push({name:c,driver:g});db&&db.listCallback&&(db.listCallback(d),db.listCallback=null)}break;case 7:db.send(a.subarray(1));break;default:svGlobal.logger.warn("Invalid channel data received: unknown type ["+a[0]+"].")}};var wb,eb,rb,gc={type:6,data:null};this.setAgentStatus=function(a){Uc=a};this.getAgentStatus=function(){return Uc};this.run=function(){var a;if(a=null==n.onagentmessage)a=1==n.mode?!1:n.hasSmartCard()||n.hasScanner()||
U(P.localPrinter);a&&window.startGatewayAgent?startGatewayAgent(n):(n.hasUSB()?ba.getFocused().requestUsbDevices(n.getUSB(),function(b){Ea.usbChannel.openDevices(b);ec()}):ec(),Qa.supportWebAudio&&Qa.iOSFix())};this.getDesktop=function(){return oa};this.mouseDown=function(a,b,d){Xa&&qa("80"+a+"\t"+b+"\t"+d)};this.mouseMove=function(a,b){Xa&&qa("82"+a+"\t"+b)};this.mouseUp=function(a,b,d){Xa&&qa("81"+a+"\t"+b+"\t"+d)};this.writeKeyCode=function(a,b){Xa&&qa("8B"+(a?0:49152)+"\t"+b)};this.writeScancode=
function(a,b){Xa&&("number"==typeof a?(qa("840\t"+a),qa("8449152\t"+a)):qa("84"+(a?0:49152)+"\t"+b))};this.resetSize=function(a,b){n.reconnectOnResize&&(Wa?(mb&&(clearTimeout(mb),mb=0),a&=-4,b&=-4,mb=setTimeout(function(){document.hidden||(Sa&&Sa.enabled&&Sa.applyResolution(a,b),setTimeout(function(){n.writeRawInput("8C661441\t"+a+"\t"+b);3==n.windowState&&Tc()},150),svGlobal.logger.info("-- displayChange, h:"+b))},777)):n.running()&&(mb&&(clearTimeout(mb),mb=0),mb=setTimeout(function(){document.hidden||
n.reconnect(a,b)},555)))};var Va=new RdpBuffer([],0,0);this.suppressOutput=function(a){if(!n.sessionInfo.suppressOutput)return!1;void 0==a&&(a=!0);var b=new Uint8Array(a?3:11);b[0]=146;b[1]=3;b[2]=a?1:0;a||(b[3]=Xb,b[4]=Xb>>8,b[5]=Wb,b[6]=Wb>>8,b[7]=Yb,b[8]=Yb>>8,b[9]=Zb,b[10]=Zb>>8);qa(b.buffer);return!0};this.refreshOutput=function(a,b,d,e){var c=new Uint8Array(d?11:3);c[0]=146;c[1]=3;c[2]=2;d&&(c[3]=a,c[4]=a>>8,c[5]=b,c[6]=b>>8,c[7]=d,c[8]=d>>8,c[9]=e,c[10]=e>>8);qa(c.buffer)};this.sendPing=function(a){var b=
new Uint8Array(a?2+a.length:2);b[0]=146;b[1]=0;a&&b.set(a,2);qa(b.buffer)};this.startPing=function(a,b){b=b||0;Pa||(Pa=new hi5.tool.ResponseMonitor(function(){Xa&&n.sendPing()},function(){if(Xa&&n.onnoresponse)return n.onnoresponse()}));Pa.setInterval(a,b);var d=new Uint8Array(4);d[0]=146;d[1]=2;d[2]=a;d[3]=b;qa(d.buffer);setTimeout(function(){Pa&&Pa.check()},1E3*(a+b));Ka?Ka.postMessage({type:0,cmd:6,start:1}):(Ca.onSlowPath=Ca.onFastPath=Kc,Ca.onReqHistory=function(){Kc(15555)})};this.stopPing=
function(){Pa&&Pa.stop();Ka?Ka.postMessage({type:0,cmd:6,start:0}):Ca.onSlowPath=Ca.onFastPath=Ca.onReqHistory=null};var Ya=null,Qc=0;this.play=function(){qa("F3")};this.pause=function(){qa("F2")};this.scan=function(a){qa("F4"+(a?"1":"0"))};this.seek=function(a){var b=ba.getFocused();b&&Ha&&(qa("F4"+(a?"1":"0")+"\t"+(a/b.getScale().x|0)),oa.pause(!0))};var Da={tag:0,channels:0,bitsPerSample:0,samplePerSec:22050,toStream:function(a){a.setLittleEndian16(this.tag);a.setLittleEndian16(this.channels);
a.setLittleEndian16(this.bitsPerSample);a.setLittleEndian32(this.samplePerSec)},fromStream:function(a){this.tag=a.getLittleEndian16();this.channels=a.getLittleEndian16();this.bitsPerSample=a.getLittleEndian16();this.samplePerSec=a.getLittleEndian32()}},Pc=!1;this.showMessage=function(a,b,d){n&&n.displayMsg&&a&&((b=b||ba.getFocused())?b.showMessage(a,d):("string"==typeof a&&(a={msg:a,timeout:d||0}),hi5.notifications.notify(a)))};this._unload=zb;this.close=function(){svGlobal.logger.info("closing...");
Ha&&Wa&&ba&&fa.closeRemoteApp&&ba.tryCloseRemoteApps();oa&&oa.isSendingHistory()?(svGlobal.logger.warn("In the middle of sending history, close delayed"),setTimeout(Sc,2222)):Sc()};hi5.browser.isChromeApp?chrome.runtime.onSuspend.addListener(n.close):window.addEventListener("unload",n.close,!1);pc.searchStartCode=function(a,b){for(var d=b[0]+2,e=a.length,c;d<e;)if(c=a[d],1==c){if(0==a[d-1]&&0==a[d-2]){b[1]=0==a[d-3]?4:3;b[0]=d-b[1]+1;return}d+=3}else 0==c?d++:d+=3;b[0]=-1};qc.SAMPLING_FREQUENCY=[96E3,
88200,64E3,48E3,44100,32E3,24E3,22050,16E3,12E3,11025,8E3,7350];Mb.isVideoSupported="MediaSource"in window&&MediaSource.isTypeSupported('video/mp4; codecs="avc1.42E01E, mp4a.40.2"');Mb.isAudioSupported="MediaSource"in window&&MediaSource.isTypeSupported('audio/mp4; codecs="mp4a.40.2"');svGlobal.DCVC_EXTENSION||(svGlobal.DCVC_EXTENSION={});svGlobal.DCVC_EXTENSION.GFX=function(a,b,d,e){function c(u,K,F,O){this.pixels=u;this.width=K;this.height=F;this.key=O}function g(u,K,F){this.width=u;this.height=
K;this.monitors=F}function p(){this.flags=this.bottom=this.right=this.top=this.left=0;this.read=function(u){this.left=u.getLittleEndian32();this.top=u.getLittleEndian32();this.right=u.getLittleEndian32();this.bottom=u.getLittleEndian32();this.flags=u.getLittleEndian32()};this.toString=function(){return"left: "+this.left+" top: "+this.top+" right: "+this.right+" bottom: "+this.bottom+" flags: "+this.flags}}function I(u,K,F){function O(){la=!1;wa.drawable=document.createElement("video");S._player=new Mb(wa.drawable,
S,!1);S._player.onsps=function(da){S.onsps&&S.onsps(da)};S._player.onerror=function(da){S.onfatalerror&&S.onfatalerror(S,da)};S._player.onplayerror=function(da){function na(){S.player.play(!0)}sa=!0;if((!S.onuserinteract||!S.onuserinteract(na,"video"))&&S.onmessage)S.onmessage({msg:"Please click Yes to continue.<br>"+da,cbYes:function(){S.player.play(!0);this.destroy()}})}}this.id=u;this.width=K;this.height=F;this.pixelFomrat=33;this.outputOriginY=this.outputOriginX=0;this.targetWidth=K;this.targetHeight=
F;this._player=null;var S=this,V=null,la=!0,sa=!1,wa={drawable:null};this.resumeVideo=function(){S.player&&sa&&S.player.play(!0)};this.setDisplayBuffer=function(da){V=da};this.draw=function(da,na,za,Ba){return la?V.draw(da,na,za,Ba):wa};this.processAvc=function(da){la&&O();S.onvideoframe(da)};this.reset=function(da,na){S&&S._player&&S._player.reset()};this.close=function(){S&&S._player&&(S._player.close(),S._player=null);S=null};this.setRGBs=function(da,na,za,Ba,ka,ia,Z){V.setRGBs(da,na,za,Ba,ka,
ia,Z)};this.getRGBs=function(da,na,za,Ba){return V.getRGBs(da,na,za,Ba)};this.moveArea=function(da,na,za,Ba,ka,ia){V.moveArea(da,na,za,Ba,ka,ia)};this.fillRect=function(da,na,za,Ba,ka){V.fillRect(da,na,za,Ba,ka)};this.postPaint=function(da,na,za,Ba){la&&V.postPaint(da,na,za,Ba)}}function y(u,K,F,O){var S=new I(u,K,F);S.pixelFormat=O||33;S.setDisplayBuffer(e);Q.push(S);r.oncreatesurface&&r.oncreatesurface(S);svGlobal.logger.info("create surface id:"+u+" w:"+K+" h:"+F+" pixelFmt:"+S.pixelFormat);return S}
function E(u,K){var F=u.getPosition(),O=u.getLittleEndian32();u.skipPosition(10*O);return u.getBytes(K-(u.getPosition()-F))}function M(u,K,F,O){F=u.getLittleEndian32();var S=F>>>30;F&=1073741823;switch(S){case 0:var V=E(u,F);E(u,K-F-4);break;case 1:V=E(u,F);break;case 2:K=u.getEnd()-u.getPosition();E(u,K);break;default:throw Error("Invalid LC: "+S);}V&&O.processAvc(V)}var v=new function(){function u(Z,va,f,l,h){this.len=Z;this.code=va;this.valueBits=f;this.type=l;this.vbase=h}function K(Z){var va=
25E5-V,f=Z.length;if(va>=f)S.set(Z,V),V=va>f?V+f:0;else if(25E5>=f)S.set(Z.subarray(0,va),V),S.set(Z.subarray(va),0),V=f-va;else{va=(f-va)%25E5;var l=f-va,h=Z.subarray(l);Z=Z.subarray(f-25E5,l);S.set(Z,25E5-Z.length);S.set(h,0);V=va}}function F(Z){for(;na<Z;)da<<=8,za<ka?da+=Ba[za++]:console.log("--- end"),na+=8;wa-=Z;na-=Z;Z=da>>na;da&=(1<<na)-1;return Z}var O=[new u(1,0,8,0,0),new u(5,17,5,1,0),new u(5,18,7,1,32),new u(5,19,9,1,160),new u(5,20,10,1,672),new u(5,21,12,1,1696),new u(5,24,0,0,0),new u(5,
25,0,0,1),new u(6,44,14,1,5792),new u(6,45,15,1,22176),new u(6,52,0,0,2),new u(6,53,0,0,3),new u(6,54,0,0,255),new u(7,92,18,1,54944),new u(7,93,20,1,317088),new u(7,110,0,0,4),new u(7,111,0,0,5),new u(7,112,0,0,6),new u(7,113,0,0,7),new u(7,114,0,0,8),new u(7,115,0,0,9),new u(7,116,0,0,10),new u(7,117,0,0,11),new u(7,118,0,0,58),new u(7,119,0,0,59),new u(7,120,0,0,60),new u(7,121,0,0,61),new u(7,122,0,0,62),new u(7,123,0,0,63),new u(7,124,0,0,64),new u(7,125,0,0,128),new u(8,188,20,1,1365664),new u(8,
189,21,1,2414240),new u(8,252,0,0,12),new u(8,253,0,0,56),new u(8,254,0,0,57),new u(8,255,0,0,102),new u(9,380,22,1,4511392),new u(9,381,23,1,8705696),new u(9,382,24,1,17094304)],S=new Uint8Array(25E5),V=0,la=new Uint8Array(65536),sa=0,wa=0,da=0,na=0,za=0,Ba=null,ka=0,ia=!0;this.toPDU=function(){if(ia)return null;var Z=new Uint8Array(2500008);Z[0]=29;Z[2]=1;Z[3]=10;Z[4]=V;Z[5]=V>>8;Z[6]=V>>16;Z[7]=V>>24;Z.set(S,8);return Z};this.fromStream=function(Z){V=Z.getLittleEndian32();S.set(Z.getSubarray(25E5))};
this.decompress=function(Z,va){if(va){Ba=Z;ia&&(ia=!1);ka=Ba.length-1;wa=8*ka-Ba[ka];for(sa=za=na=da=0;0<wa;)for(var f=va=0,l=0;l<O.length;l++){for(Z=O[l];va<Z.len;)f=(f<<1)+F(1),va++;0>f&&console.log("xxx inPrefix");if(f==Z.code){if(0==Z.type)Z=Z.vbase+F(Z.valueBits),(0>Z||255<Z)&&console.log("xxx do c"),Z&=255,S[V]=Z,25E5==++V&&(V=0),la[sa++]=Z;else if(va=F(Z.valueBits),va=Z.vbase+va,0>va&&console.log("xxx distance"),0!=va){if(0==F(1))Z=3;else{Z=4;for(f=2;1==F(1);)Z*=2,f++;Z+=F(f)}va=25E5-va+V;
va%=25E5;f=va+Z;if(Math.abs(V-va)>=Z&&25E5>f&&25E5>V+Z)va=S.subarray(va,f),S.set(va,V),V+=Z,la.set(va,sa),sa+=Z;else for(;0<Z;)f=S[va],25E5==++va&&(va=0),S[V]=f,25E5==++V&&(V=0),la[sa++]=f,Z--}else Z=F(15),wa-=na,da=na=0,va=Ba.subarray(za,za+Z),K(va),la.set(va,sa),za+=Z,sa+=Z,wa-=8*Z;break}}65536<sa&&console.error("xx outputIndex:"+sa);return la.subarray(0,sa)}K(Z);return Z}},x=new function(){this.process=function(u){var K=u.getByte();if(224==K){var F=0!=(u.getByte()&32);var O=u.getPosition(),S=u.getEnd();
K=v.decompress(u.getData().subarray(O,S),F);u.setPosition(S)}else{225!=K&&console.log("Invalid descriptor:"+K);S=u.getLittleEndian16();var V=u.getLittleEndian32();K=new Uint8Array(V);for(var la=0,sa,wa=0;wa<S;wa++)sa=u.getLittleEndian32(),F=0!=(u.getByte()&32),sa--,O=u.getPosition(),F=v.decompress(u.getData().subarray(O,O+sa),F),K.set(F,la),la+=F.length,u.skipPosition(sa);la!=V&&console.error("wrong size, actual:"+la+" expected:"+V)}return new RdpBuffer(K,0,K.length)}},R=null,t=new rdpcodecs.RemoteFX(!1),
z=0,B=[],r=new a;r.name="Microsoft::Windows::RDS::Graphics";var Q=new function(u,K){var F=[];this.push=function(O){O.osps=u.onsps;O.onfatalerror=u.onfatalerror;O.onplayerror=u.onplayerror;F[O.id]=O};this.get=function(O){return F[O]};this.getAll=function(){return F};this.delete=function(O){var S=F[O];S&&(S.onsps=null,S.onfatalerror=null,S.onplayerror=null,F[O]=null)};this.reset=function(O){O=0;for(var S=F.length;O<S;O++)F[O]&&F[O].reset()};this.close=function(){for(var O=0,S=F.length;O<S;O++)F[O]&&
F[O].close()};this.resumeVideo=function(){for(var O=0,S=F.length;O<S;O++)F[O]&&F[O].resumeVideo()}}(r,e);r.controller=new function(){this.draw=function(u,K,F,O,S){return(S=Q.get(S))?S.draw(u,K,F,O):null};this.getSurfaces=function(){return Q};this.onfocus=function(u){};this.resumePlay=null};r.resumeVideo=function(){Q.resumeVideo()};r.process=function(u){for(var K=x.process(u);K.has(8);){var F=K.getLittleEndian16();K.getLittleEndian16();var O=K.getLittleEndian32(),S=K.getPosition()+O-8;switch(F){case 1:var V=
K,la=V.getLittleEndian16(),sa=V.getLittleEndian16(),wa=V.getByte(),da=V.getLittleEndian16(),na=V.getLittleEndian16(),za=V.getLittleEndian16(),Ba=V.getLittleEndian16(),ka=za-da,ia=Ba-na,Z=V.getLittleEndian32(),va=V.getPosition()+Z,f=Q.get(la);f||(r.onconfirm&&r.onconfirm(),f=y(la,e.width,e.height,wa));switch(sa){case 0:var l=rdpcodecs.bitmap.byte2int(V.getData(),Z,V.getPosition());f.setRGBs(da,na,ka,ia,l,0,ka);break;case 3:for(var h=t.decode(V,Z),q=h.getRects(),w=h.getTiles(),A=h.getTileSize(),G=h.getRectSize(),
D=0;D<A;D++){var C=w[D];if(G)for(var X=C.x+64,L=C.y+64,k=0;k<G;k++){var J=q[k],N=J.x+J.width,T=J.y+J.height;X<=N?L<=T?f.setRGBs(C.x+da,C.y+na,64,64,C.data,0,64):f.setRGBs(C.x+da,C.y+na,64,T-C.y,C.data,0,64):L<=T?f.setRGBs(C.x+da,C.y+na,N-C.x,64,C.data,0,64):f.setRGBs(C.x+da,C.y+na,N-C.x,T-C.y,C.data,0,64)}else f.setRGBs(C.x,C.y,64,64,C.data,0,4)}break;case 8:R||(R=new ClearDecoder);R.decode(V,ka,ia,f.getData(),da,na,f.width);break;case 10:svGlobal.logger.info("...PLANAR");break;case 11:var ca=f,ma=
E(V,Z);ca.processAvc(ma);break;case 12:svGlobal.logger.info("...ALPHA");break;case 14:M(V,Z,!1,f);break;case 15:M(V,Z,!0,f);break;default:svGlobal.logger.warn("Invalid codec:"+sa)}V.setPosition(va);f.postPaint(da,na,ka,ia);break;case 2:svGlobal.logger.info("RDPGFX_WIRE_TO_SURFACE_PDU_2");break;case 3:svGlobal.logger.info("RDPGFX_CMDID_DELETEENCODINGCONTEXT");break;case 4:var ra=K;svGlobal.logger.info("...soliFill");for(var Ga=ra.getLittleEndian16(),La=-16777216|ra.getByte()<<16|ra.getByte()<<8|ra.getByte()|
ra.getByte()<<24,Fa=ra.getLittleEndian16(),ya=Q.get(Ga),Ta=0;Ta<Fa;Ta++){var ua=ra.getLittleEndian16(),xa=ra.getLittleEndian16(),Na=ra.getLittleEndian16()-ua,Za=ra.getLittleEndian16()-xa;ya.fillRect(ua,xa,Na,Za,La);ya.postPaint(ua,xa,Na,Za)}break;case 5:var Ua=K;svGlobal.logger.info("...surfaceToSurface");for(var $a=Ua.getLittleEndian16(),qb=Ua.getLittleEndian16(),lb=Ua.getLittleEndian16(),Ob=Ua.getLittleEndian16(),Pb=Ua.getLittleEndian16()-lb,tc=Ua.getLittleEndian16()-Ob,Rd=Ua.getLittleEndian16(),
$c=Q.get($a),Sd=Q.get(qb),ad=$a==qb?null:$c.getRGBs(lb,Ob,Pb,tc),bd=0;bd<Rd;bd++){var cd=Ua.getLittleEndian16(),dd=Ua.getLittleEndian16();ad?Sd.setRGBs(cd,dd,Pb,tc,ad,0,Pb):$c.moveArea(lb,Ob,Pb,tc,cd-lb,dd-Ob)}break;case 6:var nb=K;svGlobal.logger.info("...surfaceToCache");var Td=nb.getLittleEndian16(),uc=nb.getLittleEndian32().toString(16),ed=nb.getLittleEndian32();0<ed&&(uc=ed.toString(16)+uc);var Ud=nb.getLittleEndian16(),fd=nb.getLittleEndian16(),gd=nb.getLittleEndian16(),hd=nb.getLittleEndian16()-
fd,id=nb.getLittleEndian16()-gd,Vd=Q.get(Td).getRGBs(fd,gd,hd,id);B[Ud]=new c(Vd,hd,id,uc);break;case 7:var Db=K;svGlobal.logger.info("...cacheToSurface");for(var Wd=Db.getLittleEndian16(),Xd=Db.getLittleEndian16(),Yd=Db.getLittleEndian16(),Qb=B[Wd],Zd=Q.get(Xd),jd=0;jd<Yd;jd++){var $d=Db.getLittleEndian16(),ae=Db.getLittleEndian16();Zd.setRGBs($d,ae,Qb.width,Qb.height,Qb.pixels,0,Qb.width)}break;case 8:var be=K.getLittleEndian16();B[be]=null;break;case 9:var Rb=K,ce=Rb.getLittleEndian16(),de=Rb.getLittleEndian16(),
ee=Rb.getLittleEndian16(),fe=Rb.getByte();y(ce,de,ee,fe);break;case 10:var kd=K.getLittleEndian16();Q.delete(kd);svGlobal.logger.info("delete surface id:"+kd);break;case 11:var ld=K;ld.getLittleEndian32();ld.getLittleEndian32();break;case 12:var ge=K.getLittleEndian32();if(0==z){var md=new Uint8Array(20),xb=new RdpBuffer(md);xb.setLittleEndian16(13);xb.setLittleEndian16(0);xb.setLittleEndian32(20);xb.setLittleEndian32(4294967295);xb.setLittleEndian32(ge);z++;xb.setLittleEndian32(z);d&&r.send(md)}break;
case 14:var Sb=K,nd=Sb.getLittleEndian32(),od=Sb.getLittleEndian32(),vc=Sb.getLittleEndian32();svGlobal.logger.info("reset graphic, w:"+nd+" h:"+od+" monitors:"+vc);for(var pd=Array(vc),Tb=0;Tb<vc;Tb++){var wc=new p;wc.read(Sb);pd[Tb]=wc;svGlobal.logger.info("MonitorDef "+Tb+": "+wc.toString())}var qd=new g(nd,od,pd);Q.reset(qd);r.onresetgraphic&&r.onresetgraphic(qd);break;case 15:var Ub=K,rd=Ub.getLittleEndian16();Ub.skipPosition(2);var Eb=Q.get(rd);Eb.outputOriginX=Ub.getLittleEndian32();Eb.outputOriginY=
Ub.getLittleEndian32();r.onmapsurface&&r.onmapsurface(Eb);svGlobal.logger.info("mapSurfaceToScaledOutput, outputSurfaceId:"+rd+" outX:"+Eb.outputOriginX+" outY:"+Eb.outputOriginY);break;case 17:svGlobal.logger.info("TODO: DPGFX_CACHE_IMPORT_REPLY_PDU");break;case 19:var xc=K,sd=xc.getLittleEndian32(),he=xc.getLittleEndian32(),Fb=xc.getLittleEndian32(),Vb=!1;switch(sd){case 524292:Vb=!1;0==(Fb&1)&&(R=new ClearDecoder);break;case 524549:(Vb=0!=(Fb&16))||0!=(Fb&1)||(R=new ClearDecoder);break;default:Vb=
0==(Fb&32)}svGlobal.logger.info("Gfx Cap, Ver:"+sd.toString(16)+" len:"+he+" flags:"+Fb+" h264:"+Vb);r.onconfirm&&r.onconfirm();break;case 21:svGlobal.logger.info("mapSurfaceToWin");break;case 22:break;case 23:var yb=K,td=yb.getLittleEndian16();yb.skipPosition(2);var hb=Q.get(td);hb.outputOriginX=yb.getLittleEndian32();hb.outputOriginY=yb.getLittleEndian32();hb.targetWidth=yb.getLittleEndian32();hb.targetHeight=yb.getLittleEndian32();svGlobal.logger.info("mapSurfaceToScaledOutput, outputSurfaceId:"+
td+" outX:"+hb.outputOriginX+" outY:"+hb.outputOriginY+" targetW:"+hb.targetWidth+" targetH:"+hb.targetHeight);r.onmapsurface&&r.onmapsurface(hb);break;case 24:svGlobal.logger.info("TODO: mapSurfaceToScaledWin");break;default:svGlobal.logger.warn("xxx gfx:"+F);return}K.setPosition(S)}};r.onopen=function(){svGlobal.logger.info("GFX Open, remotefx:"+b);var u=b?2:8,K=120*u,F=new Uint8Array(K),O=new RdpBuffer(F);O.setLittleEndian16(18);O.setLittleEndian16(0);O.setLittleEndian32(K);O.setLittleEndian16(u);
O.setLittleEndian32(524292);O.setLittleEndian32(4);O.setLittleEndian32(1);O.setLittleEndian32(524549);O.setLittleEndian32(4);O.setLittleEndian32(19);b||(O.setLittleEndian32(655362),O.setLittleEndian32(4),O.setLittleEndian32(0),O.setLittleEndian32(655872),O.setLittleEndian32(4),O.setLittleEndian32(0),O.setLittleEndian32(656129),O.setLittleEndian32(4),O.setLittleEndian32(0),O.setLittleEndian32(656384),O.setLittleEndian32(4),O.setLittleEndian32(0),O.setLittleEndian32(656642),O.setLittleEndian32(4),O.setLittleEndian32(0),
O.setLittleEndian32(656896),O.setLittleEndian32(4),O.setLittleEndian32(0));O.markEnd();d&&r.send(F)};r.onclose=function(){Q.close()};e.onGetGfxHistory=function(u,K){var F=v.toPDU();F&&u(F);K();svGlobal.logger.info("Get GFX Histroy")};e.onSetGfxHistory=function(u,K){svGlobal.logger.info("Set GFX Histroy");10==u?v.fromStream(K):svGlobal.logger.error("Invalid GFX histroy type: "+u)};return r}}
Rdp.languageToKeyboard={af:0,sq:0,ar:1025,"ar-SA":1025,"ar-IQ":0,"ar-EG":0,"ar-LY":0,"ar-DZ":0,"ar-MA":0,"ar-TN":0,"ar-OM":0,"ar-YE":0,"ar-SY":0,"ar-JO":0,"ar-LB":0,"ar-KW":0,"ar-AE":0,"ar-BH":0,"ar-QA":0,eu:0,bg:0,be:0,ca:0,zh:2052,"zh-TW":1028,"zh-CN":2052,"zh-HK":1028,"zh-SG":2052,hr:0,cs:0,da:0,nl:1043,"nl-BE":2067,en:1033,"en-US":1033,"en-GB":2057,"en-AU":0,"en-CA":4105,"en-NA":0,"en-IE":0,"en-ZA":0,"en-JM":0,"en-BZ":0,et:0,fo:0,fa:0,fi:0,fr:1036,"fr-BE":2060,"fr-CA":3084,"fr-CH":4108,"fr-LU":0,
gd:0,"gd-IE":0,de:1031,"de-CH":2055,"de-AT":0,"de-LU":0,"de-LI":0,el:0,he:1037,hi:0,hu:0,is:1039,id:0,it:1040,"it-CH":66576,ja:3758162961,ko:3758162962,lv:0,lt:0,mk:0,mt:0,nb:1044,nn:1083,no:1044,pl:1045,pt:2070,"pt-BR":1046,rm:0,ro:0,"ro-MO":0,ru:1049,"ru-MO":0,sr:0,sk:0,sl:0,sb:0,es:1034,"es-AR":0,"es-GT":0,"es-CR":0,"es-PA":0,"es-DO":0,"es-MX":2058,"es-VE":0,"es-CO":0,"es-PE":0,"es-EC":0,"es-CL":0,"es-UY":0,"es-PY":0,"es-BO":0,"es-SV":0,"es-HN":0,"es-NI":0,"es-PR":0,sx:0,sv:1053,"sv-FI":0,th:0,
ts:0,tn:0,tr:1055,uk:0,ur:0,ve:0,vi:0,xh:0,ji:0,zu:0,detect:function(){var m=navigator&&(navigator.language||navigator.userLanguage||""),H=Rdp.languageToKeyboard[m];if(!H){var W=m.indexOf("-");W&&(H=Rdp.languageToKeyboard[m.substring(0,W)])}H||(svGlobal.logger.info("No valid layout for "+m),H=1033);return H}};svGlobal.Rdp||(svGlobal.Rdp=Rdp);var RdpBuffer=hi5.DataBuffer;
