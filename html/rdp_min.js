var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.arrayIteratorImpl=function(l){var I=0;return function(){return I<l.length?{done:!1,value:l[I++]}:{done:!0}}};$jscomp.arrayIterator=function(l){return{next:$jscomp.arrayIteratorImpl(l)}};$jscomp.makeIterator=function(l){var I="undefined"!=typeof Symbol&&Symbol.iterator&&l[Symbol.iterator];return I?I.call(l):$jscomp.arrayIterator(l)};$jscomp.arrayFromIterator=function(l){for(var I,U=[];!(I=l.next()).done;)U.push(I.value);return U};
$jscomp.arrayFromIterable=function(l){return l instanceof Array?l:$jscomp.arrayFromIterator($jscomp.makeIterator(l))};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.SIMPLE_FROUND_POLYFILL=!1;$jscomp.ISOLATE_POLYFILLS=!1;$jscomp.FORCE_POLYFILL_PROMISE=!1;$jscomp.FORCE_POLYFILL_PROMISE_WHEN_NO_UNHANDLED_REJECTION=!1;$jscomp.objectCreate=$jscomp.ASSUME_ES5||"function"==typeof Object.create?Object.create:function(l){var I=function(){};I.prototype=l;return new I};
$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(l,I,U){if(l==Array.prototype||l==Object.prototype)return l;l[I]=U.value;return l};$jscomp.getGlobal=function(l){l=["object"==typeof globalThis&&globalThis,l,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof global&&global];for(var I=0;I<l.length;++I){var U=l[I];if(U&&U.Math==Math)return U}throw Error("Cannot find global object");};$jscomp.global=$jscomp.getGlobal(this);
$jscomp.IS_SYMBOL_NATIVE="function"===typeof Symbol&&"symbol"===typeof Symbol("x");$jscomp.TRUST_ES6_POLYFILLS=!$jscomp.ISOLATE_POLYFILLS||$jscomp.IS_SYMBOL_NATIVE;$jscomp.polyfills={};$jscomp.propertyToPolyfillSymbol={};$jscomp.POLYFILL_PREFIX="$jscp$";var $jscomp$lookupPolyfilledValue=function(l,I){var U=$jscomp.propertyToPolyfillSymbol[I];if(null==U)return l[I];U=l[U];return void 0!==U?U:l[I]};
$jscomp.polyfill=function(l,I,U,ea){I&&($jscomp.ISOLATE_POLYFILLS?$jscomp.polyfillIsolated(l,I,U,ea):$jscomp.polyfillUnisolated(l,I,U,ea))};$jscomp.polyfillUnisolated=function(l,I,U,ea){U=$jscomp.global;l=l.split(".");for(ea=0;ea<l.length-1;ea++){var T=l[ea];if(!(T in U))return;U=U[T]}l=l[l.length-1];ea=U[l];I=I(ea);I!=ea&&null!=I&&$jscomp.defineProperty(U,l,{configurable:!0,writable:!0,value:I})};
$jscomp.polyfillIsolated=function(l,I,U,ea){var T=l.split(".");l=1===T.length;ea=T[0];ea=!l&&ea in $jscomp.polyfills?$jscomp.polyfills:$jscomp.global;for(var ua=0;ua<T.length-1;ua++){var Z=T[ua];if(!(Z in ea))return;ea=ea[Z]}T=T[T.length-1];U=$jscomp.IS_SYMBOL_NATIVE&&"es6"===U?ea[T]:null;I=I(U);null!=I&&(l?$jscomp.defineProperty($jscomp.polyfills,T,{configurable:!0,writable:!0,value:I}):I!==U&&($jscomp.propertyToPolyfillSymbol[T]=$jscomp.IS_SYMBOL_NATIVE?$jscomp.global.Symbol(T):$jscomp.POLYFILL_PREFIX+
T,T=$jscomp.propertyToPolyfillSymbol[T],$jscomp.defineProperty(ea,T,{configurable:!0,writable:!0,value:I})))};
$jscomp.getConstructImplementation=function(){function l(){function U(){}new U;Reflect.construct(U,[],function(){});return new U instanceof U}if($jscomp.TRUST_ES6_POLYFILLS&&"undefined"!=typeof Reflect&&Reflect.construct){if(l())return Reflect.construct;var I=Reflect.construct;return function(U,ea,T){U=I(U,ea);T&&Reflect.setPrototypeOf(U,T.prototype);return U}}return function(U,ea,T){void 0===T&&(T=U);T=$jscomp.objectCreate(T.prototype||Object.prototype);return Function.prototype.apply.call(U,T,ea)||
T}};$jscomp.construct={valueOf:$jscomp.getConstructImplementation}.valueOf();$jscomp.underscoreProtoCanBeSet=function(){var l={a:!0},I={};try{return I.__proto__=l,I.a}catch(U){}return!1};$jscomp.setPrototypeOf=$jscomp.TRUST_ES6_POLYFILLS&&"function"==typeof Object.setPrototypeOf?Object.setPrototypeOf:$jscomp.underscoreProtoCanBeSet()?function(l,I){l.__proto__=I;if(l.__proto__!==I)throw new TypeError(l+" is not extensible");return l}:null;
$jscomp.inherits=function(l,I){l.prototype=$jscomp.objectCreate(I.prototype);l.prototype.constructor=l;if($jscomp.setPrototypeOf){var U=$jscomp.setPrototypeOf;U(l,I)}else for(U in I)if("prototype"!=U)if(Object.defineProperties){var ea=Object.getOwnPropertyDescriptor(I,U);ea&&Object.defineProperty(l,U,ea)}else l[U]=I[U];l.superClass_=I.prototype};$jscomp.generator={};
$jscomp.generator.ensureIteratorResultIsObject_=function(l){if(!(l instanceof Object))throw new TypeError("Iterator result "+l+" is not an object");};$jscomp.generator.Context=function(){this.isRunning_=!1;this.yieldAllIterator_=null;this.yieldResult=void 0;this.nextAddress=1;this.finallyAddress_=this.catchAddress_=0;this.finallyContexts_=this.abruptCompletion_=null};
$jscomp.generator.Context.prototype.start_=function(){if(this.isRunning_)throw new TypeError("Generator is already running");this.isRunning_=!0};$jscomp.generator.Context.prototype.stop_=function(){this.isRunning_=!1};$jscomp.generator.Context.prototype.jumpToErrorHandler_=function(){this.nextAddress=this.catchAddress_||this.finallyAddress_};$jscomp.generator.Context.prototype.next_=function(l){this.yieldResult=l};
$jscomp.generator.Context.prototype.throw_=function(l){this.abruptCompletion_={exception:l,isException:!0};this.jumpToErrorHandler_()};$jscomp.generator.Context.prototype.return=function(l){this.abruptCompletion_={return:l};this.nextAddress=this.finallyAddress_};$jscomp.generator.Context.prototype.jumpThroughFinallyBlocks=function(l){this.abruptCompletion_={jumpTo:l};this.nextAddress=this.finallyAddress_};$jscomp.generator.Context.prototype.yield=function(l,I){this.nextAddress=I;return{value:l}};
$jscomp.generator.Context.prototype.yieldAll=function(l,I){l=$jscomp.makeIterator(l);var U=l.next();$jscomp.generator.ensureIteratorResultIsObject_(U);if(U.done)this.yieldResult=U.value,this.nextAddress=I;else return this.yieldAllIterator_=l,this.yield(U.value,I)};$jscomp.generator.Context.prototype.jumpTo=function(l){this.nextAddress=l};$jscomp.generator.Context.prototype.jumpToEnd=function(){this.nextAddress=0};
$jscomp.generator.Context.prototype.setCatchFinallyBlocks=function(l,I){this.catchAddress_=l;void 0!=I&&(this.finallyAddress_=I)};$jscomp.generator.Context.prototype.setFinallyBlock=function(l){this.catchAddress_=0;this.finallyAddress_=l||0};$jscomp.generator.Context.prototype.leaveTryBlock=function(l,I){this.nextAddress=l;this.catchAddress_=I||0};
$jscomp.generator.Context.prototype.enterCatchBlock=function(l){this.catchAddress_=l||0;l=this.abruptCompletion_.exception;this.abruptCompletion_=null;return l};$jscomp.generator.Context.prototype.enterFinallyBlock=function(l,I,U){U?this.finallyContexts_[U]=this.abruptCompletion_:this.finallyContexts_=[this.abruptCompletion_];this.catchAddress_=l||0;this.finallyAddress_=I||0};
$jscomp.generator.Context.prototype.leaveFinallyBlock=function(l,I){I=this.finallyContexts_.splice(I||0)[0];if(I=this.abruptCompletion_=this.abruptCompletion_||I){if(I.isException)return this.jumpToErrorHandler_();void 0!=I.jumpTo&&this.finallyAddress_<I.jumpTo?(this.nextAddress=I.jumpTo,this.abruptCompletion_=null):this.nextAddress=this.finallyAddress_}else this.nextAddress=l};$jscomp.generator.Context.prototype.forIn=function(l){return new $jscomp.generator.Context.PropertyIterator(l)};
$jscomp.generator.Context.PropertyIterator=function(l){this.object_=l;this.properties_=[];for(var I in l)this.properties_.push(I);this.properties_.reverse()};$jscomp.generator.Context.PropertyIterator.prototype.getNext=function(){for(;0<this.properties_.length;){var l=this.properties_.pop();if(l in this.object_)return l}return null};$jscomp.generator.Engine_=function(l){this.context_=new $jscomp.generator.Context;this.program_=l};
$jscomp.generator.Engine_.prototype.next_=function(l){this.context_.start_();if(this.context_.yieldAllIterator_)return this.yieldAllStep_(this.context_.yieldAllIterator_.next,l,this.context_.next_);this.context_.next_(l);return this.nextStep_()};
$jscomp.generator.Engine_.prototype.return_=function(l){this.context_.start_();var I=this.context_.yieldAllIterator_;if(I)return this.yieldAllStep_("return"in I?I["return"]:function(U){return{value:U,done:!0}},l,this.context_.return);this.context_.return(l);return this.nextStep_()};
$jscomp.generator.Engine_.prototype.throw_=function(l){this.context_.start_();if(this.context_.yieldAllIterator_)return this.yieldAllStep_(this.context_.yieldAllIterator_["throw"],l,this.context_.next_);this.context_.throw_(l);return this.nextStep_()};
$jscomp.generator.Engine_.prototype.yieldAllStep_=function(l,I,U){try{var ea=l.call(this.context_.yieldAllIterator_,I);$jscomp.generator.ensureIteratorResultIsObject_(ea);if(!ea.done)return this.context_.stop_(),ea;var T=ea.value}catch(ua){return this.context_.yieldAllIterator_=null,this.context_.throw_(ua),this.nextStep_()}this.context_.yieldAllIterator_=null;U.call(this.context_,T);return this.nextStep_()};
$jscomp.generator.Engine_.prototype.nextStep_=function(){for(;this.context_.nextAddress;)try{var l=this.program_(this.context_);if(l)return this.context_.stop_(),{value:l.value,done:!1}}catch(I){this.context_.yieldResult=void 0,this.context_.throw_(I)}this.context_.stop_();if(this.context_.abruptCompletion_){l=this.context_.abruptCompletion_;this.context_.abruptCompletion_=null;if(l.isException)throw l.exception;return{value:l.return,done:!0}}return{value:void 0,done:!0}};
$jscomp.generator.Generator_=function(l){this.next=function(I){return l.next_(I)};this.throw=function(I){return l.throw_(I)};this.return=function(I){return l.return_(I)};this[Symbol.iterator]=function(){return this}};$jscomp.generator.createGenerator=function(l,I){I=new $jscomp.generator.Generator_(new $jscomp.generator.Engine_(I));$jscomp.setPrototypeOf&&l.prototype&&$jscomp.setPrototypeOf(I,l.prototype);return I};
$jscomp.asyncExecutePromiseGenerator=function(l){function I(ea){return l.next(ea)}function U(ea){return l.throw(ea)}return new Promise(function(ea,T){function ua(Z){Z.done?ea(Z.value):Promise.resolve(Z.value).then(I,U).then(ua,T)}ua(l.next())})};$jscomp.asyncExecutePromiseGeneratorFunction=function(l){return $jscomp.asyncExecutePromiseGenerator(l())};$jscomp.asyncExecutePromiseGeneratorProgram=function(l){return $jscomp.asyncExecutePromiseGenerator(new $jscomp.generator.Generator_(new $jscomp.generator.Engine_(l)))};
$jscomp.polyfill("Reflect",function(l){return l?l:{}},"es6","es3");$jscomp.polyfill("Reflect.construct",function(l){return $jscomp.construct},"es6","es3");$jscomp.polyfill("Reflect.setPrototypeOf",function(l){if(l)return l;if($jscomp.setPrototypeOf){var I=$jscomp.setPrototypeOf;return function(U,ea){try{return I(U,ea),!0}catch(T){return!1}}}return null},"es6","es5");$jscomp.initSymbol=function(){};
$jscomp.polyfill("Symbol",function(l){if(l)return l;var I=function(T,ua){this.$jscomp$symbol$id_=T;$jscomp.defineProperty(this,"description",{configurable:!0,writable:!0,value:ua})};I.prototype.toString=function(){return this.$jscomp$symbol$id_};var U=0,ea=function(T){if(this instanceof ea)throw new TypeError("Symbol is not a constructor");return new I("jscomp_symbol_"+(T||"")+"_"+U++,T)};return ea},"es6","es3");
$jscomp.polyfill("Symbol.iterator",function(l){if(l)return l;l=Symbol("Symbol.iterator");for(var I="Array Int8Array Uint8Array Uint8ClampedArray Int16Array Uint16Array Int32Array Uint32Array Float32Array Float64Array".split(" "),U=0;U<I.length;U++){var ea=$jscomp.global[I[U]];"function"===typeof ea&&"function"!=typeof ea.prototype[l]&&$jscomp.defineProperty(ea.prototype,l,{configurable:!0,writable:!0,value:function(){return $jscomp.iteratorPrototype($jscomp.arrayIteratorImpl(this))}})}return l},"es6",
"es3");$jscomp.iteratorPrototype=function(l){l={next:l};l[Symbol.iterator]=function(){return this};return l};
$jscomp.polyfill("Promise",function(l){function I(){this.batch_=null}function U(Z){return Z instanceof T?Z:new T(function(pa,aa){pa(Z)})}if(l&&(!($jscomp.FORCE_POLYFILL_PROMISE||$jscomp.FORCE_POLYFILL_PROMISE_WHEN_NO_UNHANDLED_REJECTION&&"undefined"===typeof $jscomp.global.PromiseRejectionEvent)||!$jscomp.global.Promise||-1===$jscomp.global.Promise.toString().indexOf("[native code]")))return l;I.prototype.asyncExecute=function(Z){if(null==this.batch_){this.batch_=[];var pa=this;this.asyncExecuteFunction(function(){pa.executeBatch_()})}this.batch_.push(Z)};
var ea=$jscomp.global.setTimeout;I.prototype.asyncExecuteFunction=function(Z){ea(Z,0)};I.prototype.executeBatch_=function(){for(;this.batch_&&this.batch_.length;){var Z=this.batch_;this.batch_=[];for(var pa=0;pa<Z.length;++pa){var aa=Z[pa];Z[pa]=null;try{aa()}catch(ca){this.asyncThrow_(ca)}}}this.batch_=null};I.prototype.asyncThrow_=function(Z){this.asyncExecuteFunction(function(){throw Z;})};var T=function(Z){this.state_=0;this.result_=void 0;this.onSettledCallbacks_=[];this.isRejectionHandled_=
!1;var pa=this.createResolveAndReject_();try{Z(pa.resolve,pa.reject)}catch(aa){pa.reject(aa)}};T.prototype.createResolveAndReject_=function(){function Z(ca){return function(ia){aa||(aa=!0,ca.call(pa,ia))}}var pa=this,aa=!1;return{resolve:Z(this.resolveTo_),reject:Z(this.reject_)}};T.prototype.resolveTo_=function(Z){if(Z===this)this.reject_(new TypeError("A Promise cannot resolve to itself"));else if(Z instanceof T)this.settleSameAsPromise_(Z);else{a:switch(typeof Z){case "object":var pa=null!=Z;break a;
case "function":pa=!0;break a;default:pa=!1}pa?this.resolveToNonPromiseObj_(Z):this.fulfill_(Z)}};T.prototype.resolveToNonPromiseObj_=function(Z){var pa=void 0;try{pa=Z.then}catch(aa){this.reject_(aa);return}"function"==typeof pa?this.settleSameAsThenable_(pa,Z):this.fulfill_(Z)};T.prototype.reject_=function(Z){this.settle_(2,Z)};T.prototype.fulfill_=function(Z){this.settle_(1,Z)};T.prototype.settle_=function(Z,pa){if(0!=this.state_)throw Error("Cannot settle("+Z+", "+pa+"): Promise already settled in state"+
this.state_);this.state_=Z;this.result_=pa;2===this.state_&&this.scheduleUnhandledRejectionCheck_();this.executeOnSettledCallbacks_()};T.prototype.scheduleUnhandledRejectionCheck_=function(){var Z=this;ea(function(){if(Z.notifyUnhandledRejection_()){var pa=$jscomp.global.console;"undefined"!==typeof pa&&pa.error(Z.result_)}},1)};T.prototype.notifyUnhandledRejection_=function(){if(this.isRejectionHandled_)return!1;var Z=$jscomp.global.CustomEvent,pa=$jscomp.global.Event,aa=$jscomp.global.dispatchEvent;
if("undefined"===typeof aa)return!0;"function"===typeof Z?Z=new Z("unhandledrejection",{cancelable:!0}):"function"===typeof pa?Z=new pa("unhandledrejection",{cancelable:!0}):(Z=$jscomp.global.document.createEvent("CustomEvent"),Z.initCustomEvent("unhandledrejection",!1,!0,Z));Z.promise=this;Z.reason=this.result_;return aa(Z)};T.prototype.executeOnSettledCallbacks_=function(){if(null!=this.onSettledCallbacks_){for(var Z=0;Z<this.onSettledCallbacks_.length;++Z)ua.asyncExecute(this.onSettledCallbacks_[Z]);
this.onSettledCallbacks_=null}};var ua=new I;T.prototype.settleSameAsPromise_=function(Z){var pa=this.createResolveAndReject_();Z.callWhenSettled_(pa.resolve,pa.reject)};T.prototype.settleSameAsThenable_=function(Z,pa){var aa=this.createResolveAndReject_();try{Z.call(pa,aa.resolve,aa.reject)}catch(ca){aa.reject(ca)}};T.prototype.then=function(Z,pa){function aa(Oa,ta){return"function"==typeof Oa?function(sb){try{ca(Oa(sb))}catch(pb){ia(pb)}}:ta}var ca,ia,za=new T(function(Oa,ta){ca=Oa;ia=ta});this.callWhenSettled_(aa(Z,
ca),aa(pa,ia));return za};T.prototype.catch=function(Z){return this.then(void 0,Z)};T.prototype.callWhenSettled_=function(Z,pa){function aa(){switch(ca.state_){case 1:Z(ca.result_);break;case 2:pa(ca.result_);break;default:throw Error("Unexpected state: "+ca.state_);}}var ca=this;null==this.onSettledCallbacks_?ua.asyncExecute(aa):this.onSettledCallbacks_.push(aa);this.isRejectionHandled_=!0};T.resolve=U;T.reject=function(Z){return new T(function(pa,aa){aa(Z)})};T.race=function(Z){return new T(function(pa,
aa){for(var ca=$jscomp.makeIterator(Z),ia=ca.next();!ia.done;ia=ca.next())U(ia.value).callWhenSettled_(pa,aa)})};T.all=function(Z){var pa=$jscomp.makeIterator(Z),aa=pa.next();return aa.done?U([]):new T(function(ca,ia){function za(sb){return function(pb){Oa[sb]=pb;ta--;0==ta&&ca(Oa)}}var Oa=[],ta=0;do Oa.push(void 0),ta++,U(aa.value).callWhenSettled_(za(Oa.length-1),ia),aa=pa.next();while(!aa.done)})};return T},"es6","es3");
$jscomp.checkStringArgs=function(l,I,U){if(null==l)throw new TypeError("The 'this' value for String.prototype."+U+" must not be null or undefined");if(I instanceof RegExp)throw new TypeError("First argument to String.prototype."+U+" must not be a regular expression");return l+""};
$jscomp.polyfill("String.prototype.startsWith",function(l){return l?l:function(I,U){var ea=$jscomp.checkStringArgs(this,I,"startsWith");I+="";var T=ea.length,ua=I.length;U=Math.max(0,Math.min(U|0,ea.length));for(var Z=0;Z<ua&&U<T;)if(ea[U++]!=I[Z++])return!1;return Z>=ua}},"es6","es3");
$jscomp.iteratorFromArray=function(l,I){l instanceof String&&(l+="");var U=0,ea=!1,T={next:function(){if(!ea&&U<l.length){var ua=U++;return{value:I(ua,l[ua]),done:!1}}ea=!0;return{done:!0,value:void 0}}};T[Symbol.iterator]=function(){return T};return T};$jscomp.polyfill("Array.prototype.keys",function(l){return l?l:function(){return $jscomp.iteratorFromArray(this,function(I){return I})}},"es6","es3");
$jscomp.polyfill("Array.from",function(l){return l?l:function(I,U,ea){U=null!=U?U:function(pa){return pa};var T=[],ua="undefined"!=typeof Symbol&&Symbol.iterator&&I[Symbol.iterator];if("function"==typeof ua){I=ua.call(I);for(var Z=0;!(ua=I.next()).done;)T.push(U.call(ea,ua.value,Z++))}else for(ua=I.length,Z=0;Z<ua;Z++)T.push(U.call(ea,I[Z],Z));return T}},"es6","es3");
$jscomp.checkEs6ConformanceViaProxy=function(){try{var l={},I=Object.create(new $jscomp.global.Proxy(l,{get:function(U,ea,T){return U==l&&"q"==ea&&T==I}}));return!0===I.q}catch(U){return!1}};$jscomp.USE_PROXY_FOR_ES6_CONFORMANCE_CHECKS=!1;$jscomp.ES6_CONFORMANCE=$jscomp.USE_PROXY_FOR_ES6_CONFORMANCE_CHECKS&&$jscomp.checkEs6ConformanceViaProxy();$jscomp.owns=function(l,I){return Object.prototype.hasOwnProperty.call(l,I)};
$jscomp.polyfill("WeakMap",function(l){function I(){if(!l||!Object.seal)return!1;try{var ca=Object.seal({}),ia=Object.seal({}),za=new l([[ca,2],[ia,3]]);if(2!=za.get(ca)||3!=za.get(ia))return!1;za.delete(ca);za.set(ia,4);return!za.has(ca)&&4==za.get(ia)}catch(Oa){return!1}}function U(){}function ea(ca){var ia=typeof ca;return"object"===ia&&null!==ca||"function"===ia}function T(ca){if(!$jscomp.owns(ca,Z)){var ia=new U;$jscomp.defineProperty(ca,Z,{value:ia})}}function ua(ca){if(!$jscomp.ISOLATE_POLYFILLS){var ia=
Object[ca];ia&&(Object[ca]=function(za){if(za instanceof U)return za;Object.isExtensible(za)&&T(za);return ia(za)})}}if($jscomp.USE_PROXY_FOR_ES6_CONFORMANCE_CHECKS){if(l&&$jscomp.ES6_CONFORMANCE)return l}else if(I())return l;var Z="$jscomp_hidden_"+Math.random();ua("freeze");ua("preventExtensions");ua("seal");var pa=0,aa=function(ca){this.id_=(pa+=Math.random()+1).toString();if(ca){ca=$jscomp.makeIterator(ca);for(var ia;!(ia=ca.next()).done;)ia=ia.value,this.set(ia[0],ia[1])}};aa.prototype.set=function(ca,
ia){if(!ea(ca))throw Error("Invalid WeakMap key");T(ca);if(!$jscomp.owns(ca,Z))throw Error("WeakMap key fail: "+ca);ca[Z][this.id_]=ia;return this};aa.prototype.get=function(ca){return ea(ca)&&$jscomp.owns(ca,Z)?ca[Z][this.id_]:void 0};aa.prototype.has=function(ca){return ea(ca)&&$jscomp.owns(ca,Z)&&$jscomp.owns(ca[Z],this.id_)};aa.prototype.delete=function(ca){return ea(ca)&&$jscomp.owns(ca,Z)&&$jscomp.owns(ca[Z],this.id_)?delete ca[Z][this.id_]:!1};return aa},"es6","es3");$jscomp.MapEntry=function(){};
$jscomp.polyfill("Map",function(l){function I(){if($jscomp.ASSUME_NO_NATIVE_MAP||!l||"function"!=typeof l||!l.prototype.entries||"function"!=typeof Object.seal)return!1;try{var aa=Object.seal({x:4}),ca=new l($jscomp.makeIterator([[aa,"s"]]));if("s"!=ca.get(aa)||1!=ca.size||ca.get({x:4})||ca.set({x:4},"t")!=ca||2!=ca.size)return!1;var ia=ca.entries(),za=ia.next();if(za.done||za.value[0]!=aa||"s"!=za.value[1])return!1;za=ia.next();return za.done||4!=za.value[0].x||"t"!=za.value[1]||!ia.next().done?
!1:!0}catch(Oa){return!1}}if($jscomp.USE_PROXY_FOR_ES6_CONFORMANCE_CHECKS){if(l&&$jscomp.ES6_CONFORMANCE)return l}else if(I())return l;var U=new WeakMap,ea=function(aa){this.data_={};this.head_=Z();this.size=0;if(aa){aa=$jscomp.makeIterator(aa);for(var ca;!(ca=aa.next()).done;)ca=ca.value,this.set(ca[0],ca[1])}};ea.prototype.set=function(aa,ca){aa=0===aa?0:aa;var ia=T(this,aa);ia.list||(ia.list=this.data_[ia.id]=[]);ia.entry?ia.entry.value=ca:(ia.entry={next:this.head_,previous:this.head_.previous,
head:this.head_,key:aa,value:ca},ia.list.push(ia.entry),this.head_.previous.next=ia.entry,this.head_.previous=ia.entry,this.size++);return this};ea.prototype.delete=function(aa){aa=T(this,aa);return aa.entry&&aa.list?(aa.list.splice(aa.index,1),aa.list.length||delete this.data_[aa.id],aa.entry.previous.next=aa.entry.next,aa.entry.next.previous=aa.entry.previous,aa.entry.head=null,this.size--,!0):!1};ea.prototype.clear=function(){this.data_={};this.head_=this.head_.previous=Z();this.size=0};ea.prototype.has=
function(aa){return!!T(this,aa).entry};ea.prototype.get=function(aa){return(aa=T(this,aa).entry)&&aa.value};ea.prototype.entries=function(){return ua(this,function(aa){return[aa.key,aa.value]})};ea.prototype.keys=function(){return ua(this,function(aa){return aa.key})};ea.prototype.values=function(){return ua(this,function(aa){return aa.value})};ea.prototype.forEach=function(aa,ca){for(var ia=this.entries(),za;!(za=ia.next()).done;)za=za.value,aa.call(ca,za[1],za[0],this)};ea.prototype[Symbol.iterator]=
ea.prototype.entries;var T=function(aa,ca){var ia=ca&&typeof ca;"object"==ia||"function"==ia?U.has(ca)?ia=U.get(ca):(ia=""+ ++pa,U.set(ca,ia)):ia="p_"+ca;var za=aa.data_[ia];if(za&&$jscomp.owns(aa.data_,ia))for(aa=0;aa<za.length;aa++){var Oa=za[aa];if(ca!==ca&&Oa.key!==Oa.key||ca===Oa.key)return{id:ia,list:za,index:aa,entry:Oa}}return{id:ia,list:za,index:-1,entry:void 0}},ua=function(aa,ca){var ia=aa.head_;return $jscomp.iteratorPrototype(function(){if(ia){for(;ia.head!=aa.head_;)ia=ia.previous;for(;ia.next!=
ia.head;)return ia=ia.next,{done:!1,value:ca(ia)};ia=null}return{done:!0,value:void 0}})},Z=function(){var aa={};return aa.previous=aa.next=aa.head=aa},pa=0;return ea},"es6","es3");$jscomp.findInternal=function(l,I,U){l instanceof String&&(l=String(l));for(var ea=l.length,T=0;T<ea;T++){var ua=l[T];if(I.call(U,ua,T,l))return{i:T,v:ua}}return{i:-1,v:void 0}};$jscomp.polyfill("Array.prototype.findIndex",function(l){return l?l:function(I,U){return $jscomp.findInternal(this,I,U).i}},"es6","es3");
var svManager={getInstance:function(){var l=window.$rdp;return l&&l.running&&l.running()?l:null}};svGlobal.getInstance=svManager.getInstance;
function connvertServer(l){var I={};I.id=l.id;I.server=l.id;I.displayName=l.displayName||l.id;if(l=l.rdp){for(var U in l)I[U]=l[U];I.user=l.username||"";I.pwd=l.password||"";I.useConsole=l.console||!1;I.legacyMode=l.leagacyMode||l.legacyMode||!1;I.server_bpp=l.color||16;I.exe=l.remoteProgram||"";I.args=l.remoteArgs||"";I.startProgram=0<I.exe.length?"app":I.command&&0<I.command.length?"shell":"noapp"}return I}
function Rdp2(l){l=svGlobal.util.getServerArgs(l);if(!l||!l.gateway)return hi5.notifications.notify({msg:__svi18n.noauth}),null;var I=l.gateway||"",U=0,ea=0,T=16,ua=1==l.useSSL||"true"==l.useSSL||"on"==l.useSSL||null;l.width&&(U=parseInt(l.width,10));l.height&&(ea=parseInt(l.height,10));l.color&&(T=parseInt(l.color,10));l.server_bpp&&(T=parseInt(l.server_bpp,10));l=hi5.browser.obj2url(l);null===ua&&(ua="https:"==location.protocol);return new Rdp((ua?"wss://":"ws://")+I+"/RDP?"+l,U,ea,T)}
svGlobal.Rdp2||(svGlobal.Rdp2=Rdp2);
function Rdp(l,I,U,ea){function T(a){return"on"==a||"true"==a||1==a}function ua(){var a=m.gateway;m.ongetgatewayaddress&&(a=m.ongetgatewayaddress(a));return a}function Z(){var a=hi5.storage.get("SV_CONN_SHARE_ID");a||(a=hi5.tool.uuid(),hi5.storage.set("SV_CONN_SHARE_ID",a));return a}function pa(a,b){a=da[a]||b;a.startsWith("/")||a.toLowerCase().startsWith("http")||(a=hi5.libPath+a);return a}function aa(){return P.displayName||P.server||P.symlink||P.id||"undefined"}function ca(a){m.loadbalanceToken||
(m.loadbalanceToken=da.loadbalanceTokenName?da.loadbalanceTokenName+"="+a:"")}function ia(a,b,d){m.ontitlechange&&(a=m.ontitlechange(a,d));m.setTitle&&a&&(b=b||window,b.document.title=a)}function za(a,b){switch(a){case 16:case 8:case 24:case 32:break;case 15:return P.invitation||m.showMessage("15 bit color is not supported anymore."),!1;default:return!1}fb=a;b&&(Ma?Ma.postMessage({type:0,cmd:1,data:a}):Ba&&Ba.setColor(a));return!0}function Oa(a,b,d,e){Ja=a;Ka=b;Vb=Wb=0;Xb=Ja-1;Yb=Ka-1;Va&&(Ja=(P.waWidth||
hi5.browser.getScreenWidth())|0,Ka=(P.waHeight||hi5.browser.getScreenHeight())|0);P.minWidth&&Ja<P.minWidth&&(Ja=P.minWidth|0);P.minHeight&&Ka<P.minHeight&&(Ka=P.minHeight|0);Ja&=-4;Ka&=-4;svGlobal.logger.warn("resolution changed, w:"+Ja+" h:"+Ka);var c=Ja,f=Ka;ma?ma.resize(c,f):ma=new xc(c,f);ba.setSize(Ja,Ka,Va?"hidden":null);if(d||Ja!=a||Ka!=b)Ma?Ma.postMessage({type:0,cmd:2,data:{w:Ja,h:Ka}}):Ba&&Ba.setResolution(Ja,Ka);if(m.onresolutionchange&&!e)m.onresolutionchange(a,b)}function ta(a){!bb&&
Ia&&(Ma?(Zb.data=a,"string"!=typeof a?Ma.postMessage(Zb,[a]):Ma.postMessage(Zb)):Ba.writeRawInput(a))}function sb(a){switch(a){case "\r":break;case "\n":m.writeScancode(28);break;case "\t":m.writeScancode(15);break;default:ta("86"+a)}}function pb(a){var b=this;a||(a=143);this.send=function(d){var e=!!d.buffer,c=e?d:d.getData(),f=64==a;d=e?c.length:d.getEnd()||c.length;d<c.length&&(c=e?c.subarray(0,d):c.slice(0,d));e=f?5:9;d=new Uint8Array(e+d);d[0]=a;if(f)d[1]=b.id,d[2]=b.id>>8,d[3]=b.id>>16,d[4]=
b.id>>24;else{f=b.name;for(var n=Math.min(f.length,8),J=0;J<n;J++)d[1+J]=f.charCodeAt(J)}d.set(c,e);ta(d.buffer)};this.name="";this.count=this.id=this.flags=0}function Hb(a){if(m){var b=__svi18n.errorCode[a];a={name:a,message:b,msg:b};m.displayMsg&&m.showMessage(a);0<svGlobal.log&&console.error&&console.error(a);if(m.onerror)m.onerror(a)}}function yc(a){if(m){var b=__svi18n.info[a];b||(b="info "+a);m.displayMsg&&m.showMessage(b);svGlobal.logger.info(b)}}function $b(){var a=Ia;qb=Ia=!1;Ma?Ma.postMessage({type:0,
cmd:3}):Ba&&Ba.resetStatus();a&&(Ia=a)}function ac(a){Na||(Na=new hi5.file.UploadManager(new hi5.file.WsFileService(ta)),Na.addEvent("beforeupload",function(b,d,e){if(m.beforeupload)return m.beforeupload(b,d,e)}),Na.addEvent("fileuploaded",function(b,d,e){if(m.onfileuploaded)m.onfileuploaded(b,d,e)}),Na.addEvent("uploaded",function(b,d){if(m.onuploaded)m.onuploaded(b,d)}),Na.addEvent("uploadingCancelled",function(){if(m.onuploadingCancelled)m.onuploadingCancelled()}));a.setFileHandler(Na)}function zc(a,
b,d){var e=!1;this.exe=a;this.args=b||"";this._dir=d||"";var c=this;this.close=function(){!e&&Ia&&(e=!0,ta("8C5"+c.exe+"\t"+c.args+"\t"+m.sessionInfo.appInfo.session))}}function wd(){var a=window.opener;if(a)try{if(a.__sparkUser&&a.__sparkUser.session)return a.__sparkUser;if(a.opener&&a.opener.__sparkUser.session)return a.opener.__sparkUser}catch(b){}return null}function Ac(){var a;return void 0!==(null==(a=window)?void 0:a.PublicKeyCredential)&&"function"===typeof window.PublicKeyCredential}function Ib(a){a=
(new Uint8Array(a)).buffer;return CBOR.decode(a)}function xd(a,b,d){var e={};if(b&&b.attachment)switch(b.attachment){case 1:var c="platform";break;case 2:c="cross-platform"}c&&(e.authenticatorAttachment=c);c={};b&&(b.requireResident?b.requireResident&&(c.requireResidentKey=!0,c.residentKey="required"):b.preferResident&&b.preferResident&&(c.requireResidentKey=!0,c.residentKey="preferred"));d&&d.rk&&(d.rk?(c.requireResidentKey=!0,c.residentKey="required"):(c.requireResidentKey=!1,c.residentKey=void 0));
c&&(c.requireResidentKey&&(e.requireResidentKey=c.requireResidentKey),c.residentKey&&(e.residentKey=c.residentKey));if(a=Bc(a,b,d))e.userVerification=a;if(Object.keys(e).length)return e}function Cc(a){var b=[];if(a){a=$jscomp.makeIterator(a);for(var d=a.next();!d.done;d=a.next()){var e=d.value;d={};e.id&&(d.id=e.id);e.type&&(d.type=e.type);if(e.transports){var c=d;e=e.transports;var f=[];e&1?f.push("usb"):e&2?f.push("nfc"):e&4?f.push("ble"):e&16?f.push("internal"):e&32&&f.push("hybrid");c.transports=
f}b.push(d)}}return b}function Bc(a,b,d){var e;a&&(a&4194304?e="required":a&8388608?e="preferred":a&16777216&&(e="discouraged"));if(b&&b.userVerification)switch(b.userVerification){case 1:e="required";break;case 2:e="preferred";break;case 3:e="discouraged"}d&&d.uv&&("FALSE"==d.uv.toUpperCase()?e="discouraged":"TRUE"==d.uv.toUpperCase()&&(e="required"));return e}function yd(a){var b={};if(a&&a.attestationPreference)switch(a.attestationPreference){case 0:b.attestation="direct";break;case 1:b.attestation=
"direct";break;case 2:b.attestation="indirect";break;case 3:b.attestation="direct"}if(a&&a.enterpriseAttestation)switch(a.enterpriseAttestation){case 1:b.attestation="enterprise";break;case 2:b.attestation="enterprise"}b.attestationFormats=["packed"];return b}function zd(a,b){var d,e,c,f,n,J,A,H,N,v,x,u,r,w,t,L,z,E,C,S;return $jscomp.asyncExecutePromiseGeneratorProgram(function(X){if(1==X.nextAddress){d=a.getPublicKeyAlgorithm();console.log("==== publicKeyAlgorithms = "+d);if((e=a.getTransports())&&
0<e.length)for(var Q=$jscomp.makeIterator(e),fa=Q.next();!fa.done;fa=Q.next())fa=fa.value,"USB"==fa.toUpperCase()||"NFC"==fa.toUpperCase()||"BLE"==fa.toUpperCase()||"INTERNAL"==fa.toUpperCase()||fa.toUpperCase();if(c=a.attestationObject)console.log("==== attestationObj bytes: "+tb(new Uint8Array(c))),n=Ib(c),f=n.attStmt;if(J=a.clientDataJSON)console.log("==== clientDataJson bytes: "+tb(new Uint8Array(J))),A=window.origin,H=(new TextDecoder).decode(J),N=JSON.parse(H),N.origin&&(N.origin=A);v=a.getAuthenticatorData();
if(!v)return X.jumpTo(0);x=new Uint8Array(v);console.log("==== authenticatorData bytes: "+tb(x));return b?(u=b.id)?X.yield(Ad(u),5):X.jumpTo(0):X.jumpTo(0)}r=X.yieldResult;w=new Uint8Array(r);console.log("==== hash of realRpID: "+tb(w));t=new hi5.DataBuffer(new Uint8Array(x.byteLength));t.setBytes(w);L=x.slice?x.slice(32,x.length):x.subarray(32,x.length);t.setBytes(L);t.markEnd();z=t.getData();console.log("==== newAuthDataBytes: "+tb(new Uint8Array(z)));E={1:"packed",2:z,3:f};C=CBOR.encode(E);S=new hi5.DataBuffer(new Uint8Array(C.byteLength+
1));S.setByte(0);S.setBytes(C);S.markEnd();return X.return(S.getData())})}function Ad(a){var b;return $jscomp.asyncExecutePromiseGeneratorProgram(function(d){b=(new TextEncoder).encode(a);return d.return(Bd(b))})}function Bd(a){var b;return $jscomp.asyncExecutePromiseGeneratorProgram(function(d){if(1==d.nextAddress)return d.yield(crypto.subtle.digest("SHA-256",a),2);b=d.yieldResult;return d.return(b)})}function tb(a){return Array.from(a,function(b){return("0"+(b&255).toString(16)).slice(-2)}).join(", ")}
function Cd(){var a=0,b=0,d=new m.GatewayChannel;d.name="MESSGSTB";d.onopen=function(){svGlobal.logger.info("Message Channel open")};d.process=function(e){if(0==e.getByte())e.getByte(),e.getByte(),e.getByte();else{var c=e.getByte(),f=e.getLittleEndian16(),n=e.getLittleEndian16();if(0!=c)svGlobal.logger.warn("Invalid AUTODETECT_REQUEST");else switch(n){case 1:case 4097:n=new RdpBuffer(new Uint8Array(6),0,6);n.setByte(6);n.setByte(1);n.setLittleEndian16(f);n.setLittleEndian16(0);n.markEnd();d.send(n);
break;case 20:case 276:case 4116:a=6;b=Date.now();break;case 2:f=e.getLittleEndian16();a+=f;break;case 43:case 1065:case 1577:43==n&&(c=e.getLittleEndian16(),a=a+c+8,e.skipPosition(c));e=e.has(4)?e.getLittleEndian32():0;a+=e;e=Date.now()-b;c=new RdpBuffer(new Uint8Array(14),0,14);c.setByte(14);c.setByte(1);c.setLittleEndian16(f);c.setLittleEndian16(43==n?3:11);c.setLittleEndian32(e);c.setLittleEndian32(a);c.markEnd();d.send(c);break;case 2112:case 2176:case 2240:f=e.getLittleEndian32();n=e.getLittleEndian32();
e=e.getLittleEndian32();Jb={baseRTT:f,bandwidth:n,averageRTT:e};if(m.onnetworkresult)m.onnetworkresult(Jb);svGlobal.logger.warn("Network Characteristics Result:");svGlobal.logger.warn(Jb);break;default:svGlobal.logger.warn("Invalid network detect PDU",e)}}};d.onclose=function(){svGlobal.logger.info("MSG channel close")};m.addGatewayChannel(d)}function Dd(a,b,d,e,c){bc.set(a,b);cc.set(a,e);b="<b>User:&nbsp;</b>"+d+"&nbsp;("+e+")&nbsp;&nbsp;&nbsp;&nbsp;<b>Expire Date:</b> "+c;d=document.createElement("div");
e=document.createElement("input");e.type="radio";e.name="scard_name";e.value=a;0==a&&(e.defaultChecked=!0);d.appendChild(e);d.innerHTML+=b;d.innerHTML+="<br>";return d}function Ed(a,b){var d=document.createElement("div"),e=document.createElement("input");e.type="radio";e.name="ds_name";e.value=a;0==a&&(e.defaultChecked=!0);d.appendChild(e);d.innerHTML+=b;d.innerHTML+="<br>";return d}function Dc(){var a="";P&&T(P.connectif)&&P.symlink&&"sessionStorage"in window&&(a="SV_"+P.symlink,P.domain&&(a+=P.domain),
P.user&&(a+=P.user));return a}function Fd(){var a=hi5.appcfg.persistentId?window.localStorage:window.sessionStorage;if(!a)return"";var b=a.getItem("appInfo.session");if(!b)return"";b="&_session="+b;(a=a.getItem("appInfo.numericId"))&&(b+="&_numericId="+a);return b}function dc(){if(!Ia){qb=!1;var a="";bb?Fa.init(!1,!0,!1,0,!1,!1):a=m.getRuntimeURL();void 0==da.wsPost&&(da.wsPost=!1);m.oncreatewebsocket&&(Ma=null);Ma?(bb&&(bb.onopen=ec,bb.onclose=zb,bb.onmessage=function(d){fc.data=d.data;Ma.postMessage(fc,
[fc.data])}),Ma.postMessage({type:0,cmd:0,data:{addr:a,width:Ja,height:Ka,server_bpp:fb,libPath:hi5.libPath,libMin:hi5.libMin,wsPost:da.wsPost}})):(Ba=new RdpGeneral(bb||a,Ja,Ka,fb,ma,!1,da.wsPost),Ba.oncreatewebsocket=m.oncreatewebsocket,Ba.run());Ma?Ma.addEventListener("message",Ec,!1):(Ba.onopen=ec,Ba.onmessage=Fc,Ba.onclose=zb,Ba.onerror=Hb,Ba.oninfo=yc,Ba.onloggedin=gc,Ba.onresolutionchange=function(d,e){Oa(d,e,!1,P.monitorDef&&0<=P.monitor?!0:!1)},Ba.onAltSecWindows=Gc,Ba.onMoveCursor=hc,Ba.onCloseSurface=
Hc,Ba.onColorChange=za,Ba.onHistoryReceived=function(){ic()},Ba.onLockKeyState=function(d){if(m.onLockKeyState)m.onLockKeyState(d)});if(a=ba.getSurface(ba.size()-1))Va?a&&(a.remoteApp=new zc(P.exe,P.args,"")):ia(aa(),a.getWindow());if(P.invitation&&!T(P.shadow)){var b=null;a&&(b=a.initChat(P.expert));Ab=new m.GatewayChannel;Ab.name="C_H_A_T";Ab.process=function(d){d=d.getUnicodeString(d.getEnd()-d.getPosition(),!0);b&&b.add(d,P.novice)};b&&(b.onchat=function(d){if(Ia){var e=Array(2*d.length);e=new hi5.DataBuffer(e,
0,e.length);e.setUnicodeString(d);e.markEnd();Ab.send(e)}});m.addGatewayChannel(Ab)}}}function Ec(a){a=a.data;switch(a.type){case 1:switch(a.event){case 0:ec();break;case 1:zb(a.expected);break;case 2:Hb(a.code);break;case 3:yc(a.code);break;case 4:gc();break;case 5:Oa(a.w,a.h,!1,P.monitorDef&&0<=P.monitor?!0:!1);break;case 6:hc(a.x,a.y,!0);break;case 7:Hc();break;case 8:0==a.id&&ic();Qa&&Qa.check(1<a.id?15555:0);break;case 9:za(a.color);break;case 10:if(m.onLockKeyState)m.onLockKeyState(a.state);
break;default:svGlobal.logger.warn("Invalid worker event "+a.type)}break;case 2:ma.setRGBs(a.x,a.y,a.w,a.h,a.pixel,a.offset,a.scansize);break;case 3:ma.moveArea(a.srcx,a.srcy,a.cx,a.cy,a.dx,a.dy);break;case 5:ma.fillRect(a.l,a.t,a.w,a.h,a.color);break;case 6:ma.drawLine(a.x1,a.y1,a.x2,a.y2,a.color);break;case 7:ma.bitBlt(a.opcode,a.dstwidth,a.x,a.y,a.cx,a.cy,a.src,a.srcwidth,a.srcx,a.srcy);break;case 8:ma.drawLineExt(a.x1,a.y1,a.x2,a.y2,a.color,a.opcode);break;case 9:Ic(a);break;case 10:Fc(a);break;
case 11:Ua.attach(a.data,0,a.data.length);Gc(Ua,a.size);break;case 12:ma.drawText(a.font,a.flags,a.mixmode,a.foregroundColor,a.backgroundColor,a.clipLeft,a.clipTop,a.clipcx,a.clipcy,a.boxLeft,a.boxTop,a.boxcx,a.boxcy,a.x,a.y,a.length,a.text,a._left,a._top,a._right,a._bottom);break;case 13:ma.drawBitmap(a.cacheID,a.cacheIDX,a.x,a.y,a.cx,a.cy,a.srcx,a.srcy,a.opcode);break;case 14:ma.saveDesktop(a.x,a.y,a.cx,a.cy,a.offset);break;case 15:ma.restoreDesktop(a.x,a.y,a.cx,a.cy,a.offset);break;case 16:ma.putFont(a.font,
a.character,a.glyph);break;case 17:ma.putCursor(a.idx,a.cursor);break;case 18:ma.setCursor(a.idx);break;case 19:ma.getHistory(ta,function(){Ma.postMessage({type:0,cmd:7})});Qa&&Qa.check(15555);break;case 20:Ua.attach(a.data,a.off,a.data.length-a.off);ma.setHistory(a.order,Ua);break;case 21:ma.putBitmap(a.id,a.idx,a.bitmap);break;default:svGlobal.logger.warn("Invalid worker msg "+a.type)}}function Jc(a){Qa&&Qa.check(a)}function ec(){Ia=!0;var a="87"+navigator.userAgent+"\t";Kb=hi5.tool.uuid();document.cookie=
Kb+"=sv";ta(a+Kb);if(m.onopen)m.onopen();da.joinCloseMode&&m.setJoinCloseMode(da.joinCloseMode)}function Hc(){ba&&ba.close()}function Fc(a){var b=a.data;if("string"!=typeof b){a=new Uint8Array(b);Ua.attach(a,0,b.byteLength);var d=Ua.getLittleEndian16();switch(d){case 28:a=Ua;b=a.getAscllString(8);d=jb[b];null!=d?d.process(a):svGlobal.logger.warn("Channel "+b+" not found");break;case 55:a=Ua;switch(a.getByte()){case 0:Ca.tag=a.getLittleEndian16();Ca.channels=a.getLittleEndian16();Ca.samplePerSec=a.getLittleEndian32();
a.skipPosition(6);Ca.bitsPerSample=a.getLittleEndian16();svGlobal.logger.info("Audio Format, tag="+Ca.tag+" channels="+Ca.channels+" bitsPerSample="+Ca.bitsPerSample+" samplePerSec="+Ca.samplePerSec);Ma&&Ma.postMessage({type:0,cmd:5,data:{tag:Ca.tag,channels:Ca.channels,samplePerSec:Ca.samplePerSec,bitsPerSample:Ca.bitsPerSample}});41222==Ca.tag&&(Ca.sampleRate=Ca.samplePerSec,Ta.initMediaPlayer(Ta,Ca,!1));break;case 1:b=a.getByte();d=a.getLittleEndian16();var e=Date.now();a.skipPosition(8);jc(a,
b,d,0);kb||(d+=Date.now()-e,ta("8A"+b+","+d))}Qa&&Qa.check();break;case 56:Kc(Ua.getUnicodeString(Ua.getEnd()-Ua.getPosition(),!1));break;case 60:Lc(Ua);break;case 62:Mc(Ua.getUnicodeString(Ua.getEnd()-Ua.getPosition(),!1));break;case 63:Nc(Ua);Qa&&Qa.check();break;case 64:b=Ua;d=b.getByte();a=b.getLittleEndian32();switch(d){case 1:b=b.getAscllString();if(Fa[b]){if(svGlobal.logger.info("DVC create, name:"+b+" id:"+a),Fa[b].newInstance?(Fa[a]=Fa[b].newInstance(),Fa[a].id=a):(Fa[b].id=a,Fa[a]=Fa[b]),
Fa[a].onopen)Fa[a].onopen()}else svGlobal.logger.info("DVC create, name not found:"+b+" id:"+a);break;case 3:Fa[a]&&Fa[a].process(b);break;case 4:if(Fa[a]&&Fa[a].onclose)Fa[a].onclose();svGlobal.logger.info("close DVC, id:"+a)}Qa&&Qa.check();break;case 146:a:switch(a=Ua,b=a.getByte(),b){case 0:a=new Uint8Array(2);a[0]=146;a[1]=1;ta(a.buffer);break;case 1:break;case 5:b=a.getByte();a=a.getLittleEndian32();0!=b||a&4||(cb^=65536,ba.execute("setFeature",[cb]));break;case 6:Ra.remoteLockFlags=a.getLittleEndian32();
Ra.checkLockFlags=!0;if(m.onLockKeyState)m.onLockKeyState({capsLock:0!=(Ra.remoteLockFlags&4),numLock:0!=(Ra.remoteLockFlags&2),scrollLock:0!=(Ra.remoteLockFlags&1)},{capsLock:0!=(Ra.localLockFlags&4),numLock:0!=(Ra.localLockFlags&2),scrollLock:0!=(Ra.localLockFlags&1)});svGlobal.logger.info("remoteLockFlags: "+Ra.remoteLockFlags);break;case 7:b=a.getByte();m.sessionInfo.appInfo.twoFAEnabled=0<b;switch(b){case 0:b=a.getByte();d=a.getLittleEndian32();a=a.getBytes(d);m.sessionInfo.appInfo.twoFAQR=a;
m.ontwofaqr&&m.ontwofaqr(a)||2==b&&ba.execute("showTwoFAQR");break;case 1:ma.pause(!0,!0);if(m.ontwofacode&&m.ontwofacode())break a;(a=ba.getFocused())&&a.showTwoFACode();break;case 2:if(b=a.getByte(),a=1==a.getByte(),(!m.ontwofaresult||!m.ontwofaresult(b,a))&&Ra.onauthcoderesult)Ra.onauthcoderesult(b,a)}break;default:svGlobal.logger.warn("Invalid Client Control: "+b)}break;default:if(m.onunknownmessage)m.onunknownmessage(d,Ua);else svGlobal.logger.warn("@TODO:"+d+"\n")}}else switch(d=parseInt(b.substring(0,
2),16),a=b.substring(2),d){case 0:ta("87"+navigator.userAgent);break;case 15:if(m){kc=!1;ub=m.reconnectTimes;(m&&0==m.mode||T(P.connectif))&&ic();b="";for(b in lb)if((d=lb[b])&&d.onopen)d.onopen();for(b in jb)if((d=jb[b])&&d.onopen)d.onopen();a&&(a=JSON.parse(a),a.capability&&m&&(m.sessionInfo.suppressOutput=!!a.capability.suppressOutput))}break;case 26:b=JSON.parse(a);if(b.name){isNaN(b.name)||(b.name="S"+b.name);b.message||(b.message=b.msg);if(m.onnotify)m.onnotify(b);svGlobal.logger.info("msg="+
a);if(2==b.type&&m.onerror)m.onerror(b);if(a=__svi18n.errorCode[b.name])b.msg=a+" "+b.msg;m.showMessage(b)}else 0<svGlobal.log&&console.erro("No error code for message:"+a);break;case 27:ba.drawLicense(a);break;case 50:if(Ia)switch(b=parseInt(a.substring(0,1),10),a=a.substring(1),b){case 1:Gd(a);break;case 2:Bb?(Bb.type==a?m.writeRawInput("881"+a+"\t"+Bb.text):m.writeRawInput("881ERROR\t"),Bb=null):!(b=ba.getFocused())||b.processClipReq(a)||!da.clipWarnAlways&&Oc||!P||P.leagacyMode||(m.showMessage(__svi18n.info.menucopy,
null,5E3),Oc=!0);break;case 5:(b=ba.getFocused())&&"0"!=a&&b.setIgnorePaste(!0)}break;case 51:ba.setReadOnly("1"==a);break;case 54:b=a.split("\t");a=ua()+b[0];a=m.modifyURL(a);svGlobal.logger.info("Downloading file:"+a+" name:"+b[1]+" driver:"+b[2]);m.onprintingready&&m.onprintingready({link:a,printerName:b[1],pinterDriver:b[2]})||(b=ba.getFocused())&&b.showPDF(a);break;case 56:Kc(a);break;case 57:b=a.split("\t");svGlobal.logger.debug(a);if(a=ba.getWinById(parseInt(b[0]))){if(!ba.hasApp(b[1])){(d=
ba.getOwnerSurface(a))&&d.railWin&&(d.railWin.appId=b[1],d.railWin.addApp(b[1]));if(m.onremoteappstart)m.onremoteappstart({id:b[1]});if(a.isVisible()&&a.titleInfo&&m.ontitlechange)m.ontitlechange(d.railWin.getFullTitle(a.id),b[1])}a.appId=b[1]}break;case 58:Hd(a);break;case 59:a=hi5.Base64.dec(a,0);cb=(new RdpBuffer(a,0,a.length)).getLittleEndian32();kb||!(cb&16||cb&65536)?(Lb=!1,Na=null):(cb&16&&(Lb=!0),Na||(a=ba.getFocused())&&ac(a));cb&64&&m.showMessage(__svi18n.info.recording);Na&&(Na.setUpload(!(cb&
128)),Na.setDownload(!(cb&131072)),Na.canCopyFile=0!=(cb&65536));ba.execute("setFeature",[cb]);break;case 60:Lc(b64ToBuffer(a));break;case 61:a=JSON.parse(a);switch(a.type){case 0:Oa(a.width,a.height,!0,!1);za(a.color);(b=a.server)&&m&&(m.server=a.server);Pc=a.length;d=ba.getFocused();Va=1==a.isRail;d&&(1!=m.mode&&d.setAutoScale(!Va),b&&ia(aa(),d.getWindow()),b=a.keyboard,"undefined"!=typeof b&&0==b&&d.setUnicode(!0),b=a.mapDisk)&&(Lb=!0,ac(d));if(m.onopened)m.onopened(a);break;case 1:a=a.duration;
if(m.onprogress)m.onprogress(a,Pc);break;case 2:2==a.status?($b(),Ia=!0):(b=0==a.status,b==ma.isPaused()||m.onsessionpause&&m.onsessionpause(b,a)||(ma.pause(b),b||ba.repaint(0,0,ma.width-1,ma.height-1),a.warn&&m.showMessage(b?__svi18n.info.sessionPaused:__svi18n.info.sessionResumed)))}break;case 62:Mc(a);break;case 63:Nc(b64ToBuffer(a));break;default:if(m.onunknownmessage)m.onunknownmessage(d,a);else svGlobal.logger.warn("@TODO:"+b+"\n")}}function ic(){if(!kb&&!Wa&&(Wa=!0,m&&(da.pingInterval&&m.startPing(da.pingInterval),
m.onready)))m.onready()}function Id(a,b){var d=0,e=!1;this.width=a;this.interval=b;var c=0;this.start=function(){e||(e=!0,d=setInterval(function(){var f=ba.getFocused();f&&Ia&&(f=f.getThumbnail(a))&&f.length!=c&&(ta("8E7"+f),c=f.length)},b))};this.stop=function(){clearInterval(d)}}function Jd(a,b){!Ya||Ya.width==a&&Ya.interval==b||(Ya.stop(),Ya=null);Ya||(Ya=new Id(a,b));Ya.start()}function Nc(a){var b=a.getAscllString(8);(b=lb[b])&&b.process&&b.process(a)}function Mc(a){var b=parseInt(a.substring(0,
1),16),d=a.substring(1);a=!1;var e=m.sessionInfo.appInfo;switch(b){case 0:var c=JSON.parse(d);$b();Ia=!0;a=c.width;e=c.height;if(a==Ja&&e==Ka)break;Oa(a,e,!1,!1);break;case 1:c=JSON.parse(d);m.sessionInfo.joinedSessions.push(c.numericId);m.sessionInfo.joiners.push(c);e.sessions[c.numericId]=c.name||c.__ip;if(!e.joined||da.alertJoin)m.onsessionjoin&&(a=m.onsessionjoin(c)),!a&&__svi18n.info.joinsession&&m.showMessage(__svi18n.info.joinsession.applyArgs([c.numericId,c.__ip,c.name]));break;case 2:c=JSON.parse(d);
m.sessionInfo.joinedSessions.removeElm(c.numericId);delete e.sessions[c.numericId];b=m.sessionInfo.joiners;d=0;for(var f=b.length;d<f;d++)if(b[d].numericId==c.numericId){b.splice(d,1);break}if(!e.joined||da.alertJoin)m.onsessionexit&&(a=m.onsessionexit(c)),!a&&__svi18n.info.exitsession&&m.showMessage(__svi18n.info.exitsession.applyArgs([c.numericId,c.__ip,c.name]));break;case 3:c=JSON.parse(d);e.joinMode!=c.mode&&(e.joinMode=c.mode,b=hi5.$("joinSelect"))&&(b.value=c.mode);if(e.hasControl)break;e.hasControl=
!0;ba.setReadOnly(!1,2==c.mode);if(e=hi5.$("requestControl"))e.disabled=!0;m.ongivecontrol&&(a=m.ongivecontrol());if(a)break;m.showMessage(__svi18n.info.givecontrol,null,5E3);break;case 4:c=JSON.parse(d);ba.setReadOnly(!0,2==c.mode);e.hasControl=!1;if(e=hi5.$("requestControl"))e.disabled=!1;m.ontakebackcontrol&&(a=m.ontakebackcontrol());if(a)break;m.showMessage(__svi18n.info.nocontrol,null,5E3);break;case 5:c=JSON.parse(d);m.onrequirecontrol&&(a=m.onrequirecontrol(c));if(a)break;a=__svi18n.info.title.applyArgs([c.name,
c.numericId,c.__ip]);e=__svi18n.info.recontrol;ma.isPaused&&(e+="<br><br>"+(__svi18n.info.autoresume||""));m.showMessage({title:a,msg:e,cbYes:function(){m.giveControl(c.numericId);this.destroy();ma.isPaused()&&m.pauseSession(m.sessionInfo.appInfo.numericId,!1)},cbNo:function(){m.refuseControl(c.numericId);this.destroy()}});break;case 6:ba.execute("setTouchRemoting",[!0]);break;case 7:c=JSON.parse(d);c.width&&c.height&&Oa(c.width,c.height,!0,P.monitorDef&&0<=P.monitor?!0:!1);c.color&&(za(c.color,!0),
svGlobal.logger.warn("Color depth changed to:"+c.color));c.version&&(m.sessionInfo.protocolVersion=c.version);break;case 8:c=JSON.parse(d);kc=!0;if(m.onrequestcredential&&m.onrequestcredential(c,Ra.reconnect))break;if(m.onautherror&&m.onautherror(c,Ra.reconnect))break;ba.getFocused().requestCredential(c,Ra.reconnect);break;case 9:c=JSON.parse(d);0<c.interval&&0<c.width?Jd(c.width,c.interval):Ya&&(Ya.stop(),Ya=null);break;case 11:c=JSON.parse(d);m.onrequirejoin&&(a=m.onrequirejoin(c));if(a)break;a=
__svi18n.info.title.applyArgs([c.name,c.numericId,c.__ip]);m.showMessage({title:a,msg:__svi18n.info.reqjoin,cbYes:function(){m.allowJoin(c.numericId,!0);this.destroy()},cbNo:function(){m.allowJoin(c.numericId,!1);this.destroy()}});break;case 13:c=JSON.parse(d);"login"==c.type&&gc();break;case 14:if(c=JSON.parse(d),m.oncontrolchange)m.oncontrolchange(c)}}function Lc(a){switch(a.getByte()){case 32:if(!ma.isPaused()){var b=a.getLittleEndian16(),d=a.getLittleEndian16(),e=a.getLittleEndian16(),c=void 0,
f=void 0;da.noCursorName||(c=a.getLittleEndian32(),m.sessionInfo.appInfo&&(f=m.sessionInfo.appInfo.sessions[c]));hc(d,e,!0,f,c,b)}}}function hc(a,b,d,e,c,f){ma.isPaused()||ba.getFocused().moveCursor(a,b,d,e,c,f)}function Ic(a){ba.setCursor(a)}function Kd(a){var b=da.page&&da.page.join||"";if(b.startsWith("http://")||b.startsWith("https://"))return b;if(b.startsWith("/"))return location.origin+b;var d=location.href,e=d.lastIndexOf("/");if(b)return d.substring(0,e+1)+b;b=ua();d.toLowerCase().startsWith(b.toLowerCase())&&
(b=d.substring(0,e));return b+"/"+a}function Kc(a){a=JSON.parse(a);lc=a.session;var b=a.numericId,d=hi5.appcfg.persistentId?window.localStorage:window.sessionStorage;d&&(d.setItem("appInfo.session",lc),d.setItem("appInfo.numericId",b));ca(a.appId);a.server||(a.server=aa());if(b=hi5.$("joinSelect"))b.value=a.joinMode;if(b=hi5.$("requestControl"))b.disabled=a.hasControl;a.joined?1!=m.mode&&ba.execute("setAutoScale",[!0]):(m.mode=0,T(P.connectif)&&ba.setSize(Ja,Ka),da.disableJoinedAppResize&&(m.windowState=
0));var e=ua();b=Kd("join.html")+"?id="+(a.joined||a.numericId);(d=a.webAddress)&&0<d.length&&d.toLowerCase()!=e.toLowerCase()&&(e=d.indexOf("://"),m.protocol="http"==d.substring(0,e)?"ws":"wss",m.gateway=d,b+="&gateway="+encodeURIComponent(d));b=m.modifyURL(b);a.joinLink=b;m.sessionInfo.appInfo=a;"isApp"in a&&Va!==a.isApp&&(Va=a.isApp,Oa(Ja,Ka,!0,!0),qb||1==m.mode||ba.execute("setAutoScale",[!0]));a.ver&&a.ver!=svGlobal.version&&svGlobal.logger.warn("Client:"+svGlobal.version+" server:"+a.ver);da.cursorNameOnly=
a.isAssistance;if(m.onsessionstart)m.onsessionstart(m.sessionInfo)}function Hd(a){if(Na){var b=parseInt(a.charAt(0),10);a=a.substring(1);if(5==b)Na.notifyFiles(JSON.parse(a));else{var d=a.split("\t");switch(b){case 1:Na.confirmId(d[0],d[1],d[2]);break;case 2:Na.read(d[0],parseInt(d[1],10),parseInt(d[2],10));break;case 4:Na.close(d[0]);break;case 9:a='<a href="'+m.modifyURL(ua()+d[0])+'" download="'+d[1]+'" target="_blank">'+__svi18n.info.fileReady+": "+d[1]+"</a>",__svi18n.info.download&&ba.getFocused().showMessage({msg:a,
title:__svi18n.info.download,cbNo:function(){Na.removeFile(d[0],!0);this.destroy()},onclick:function(e){"A"==e.target.tagName&&this.destroy()}})}}}}function jc(a,b,d,e){if(!Ld||ma.isPaused())return 0;var c=a.getPosition();b=a.getData();e||(e=a.getEnd()-c);if(41222==Ca.tag)return Ta.onaudioframe(b.slice(c)),0;if(a=1!=Ca.tag)mc||(mc=new MSGSM),b=mc.decode(b,c,e),c=0,e=b.length;var f=Ca.bitsPerSample;var n=Math.floor(e/(f>>3));var J=d=e=0;a||(e=Math.pow(2,f-1)-1,d=-e-1,J=Math.pow(2,f));f=Ca.channels;
var A=Math.floor(n/f),H=Ta.getBuffer(A),N=H.getChannelData(0),v=H.getChannelData(1);n=0;if(a)for(;n<A;)1==f?v[n]=N[n]=b[c++]:(N[n]=b[c++],v[n]=b[c++]),n++;else for(;n<A;)a=b[c++]|b[c++]<<8,a>e?(a-=J,a/=-d):a/=e,1==f?N[n]=a:(N[n]=a,a=b[c++]|b[c++]<<8,a>e?(a-=J,a/=-d):a/=e),v[n]=a,n++;return Ta.playBuffer(H)}function Qc(a){if(!m.openLink||2E3<a.length)return!1;var b=a.indexOf(";");0<b&&(a=a.substring(b+1));b=a;a=a.toLowerCase();var d=0==a.indexOf("http://")||0==a.indexOf("https://")||0==a.indexOf("ftp://")||
0==a.indexOf("mailto:")||0==a.indexOf("tel:")||0==a.indexOf("callto:");d||(0==a.indexOf("www.")?(d=!0,a="http://"+a):0==a.indexOf("ftp.")&&(d=!0,a="ftp://"+a));return d?0<a.indexOf("\r")||0<a.indexOf("\n")?!1:m.onurlredirection&&m.onurlredirection(b)?!0:(a=ba.getFocused())?a.processLink(b):!1:!1}function Md(a){if(a.startsWith("text/html;<img data-sv-img")){var b=a.indexOf('src="');if(0<b){b+=5;var d=a.indexOf('"',b),e=a.substring(b,d);e=m.modifyURL(e);a=a.substring(0,b)+e+a.substring(d)}}return a}
function Gd(a){if("text/plain;"!=a){if(1666<Date.now()-Ra.reqCopyTime&&!(m.onservercopy&&m.onservercopy(a)||Qc(a))){var b=ba.getFocused();b&&b.copyToClip(Md(a))}setTimeout(function(){ta("883")},999)}}function gc(){if(!qb&&(setTimeout(function(){Ia&&ta("884")},333),m.onloggedin))m.onloggedin();nc=qb=!0;Va&&1!=m.mode&&ba.execute("setAutoScale",[!1]);Na&&(Na.enabled=!0);Mb&&!Va&&(ma.setContext(ba.getFocused().context),ba.repaint(0,0,ma.width-1,ma.height-1))}function zb(a){if(m){hi5.browser.cookie.delete(Kb);
svGlobal.logger.warn("closed "+(m.sessionInfo.appInfo?m.sessionInfo.appInfo.numericId:0));m.onagentmessage&&(m.onagentmessage=null);if(m.onagentclose)m.onagentclose();var b=Dc();b&&m.sessionInfo.appInfo&&0==m.mode&&(sessionStorage[b]=m.sessionInfo.appInfo.session);if(m&&(b=1!=m.mode,!Ia&&b&&Hb("connection"),b=b&&(Ia||ub<m.reconnectTimes)&&0<ub&&!a,Wa=Ia=!1,b)){ub--;__svi18n.info.reconnecting&&m.showMessage(__svi18n.info.reconnecting+" "+(m.reconnectTimes-ub)+"/"+m.reconnectTimes,null,3E3);setTimeout(dc,
da.reconnectInterval||5E3);svGlobal.logger.info("Reconnecting..."+ub);return}if(kc)svGlobal.logger.info("Req credential");else{Qa&&(m.stopPing(),Qa=null);Ma&&(Ma.removeEventListener("message",Ec,!1),Ma.postMessage({type:0,cmd:4}),Ma.terminate(),Ma=null);Na&&(Na.release(),Na=null);Sa=l=null;Fa&&(Fa.close(),Fa=null);lb&&hi5.Arrays.release(lb);jb&&hi5.Arrays.release(jb);Ya&&(Ya.stop(),Ya=null);Ta&&(Ta.close(),Ta=null);m.player&&(m.player=null);Cb=null;try{if(m.onclose)m.onclose(a);else if(svGlobal.logger.info("onclose: null"),
hi5.appcfg&&hi5.appcfg.returnUrl){window.location.href=hi5.appcfg.returnUrl;return}ba&&(ba.close(),ba=null)}catch(d){svGlobal.logger.warn(d)}Ua=null;Ba&&(Ba.onopen=null,Ba.onmessage=null,Ba.onclose=null,Ba.onerror=null,Ba.close(),Ba=null);ba=Ra=null;ma&&(ma.release(),ma=null);hi5.browser.isChromeApp?chrome.runtime.onSuspend.removeListener(m.close):window.removeEventListener("unload",m.close,!1);window&&window.$rdp==m&&(window.$rdp=null);m=null}}}function Rc(){Ba&&Ia?Ba.close():zb(!0)}function Gc(a,
b){var d=a.getLittleEndian32();if(0!=(d&16777216))if(b=a.getLittleEndian32(),0!=(d&1073741824)){a.getLittleEndian16();a.getByte();d=a.getByte();var e=a.getLittleEndian16(),c=a.getLittleEndian16(),f=0;16>d&&(f=a.getLittleEndian16());var n=a.getLittleEndian16(),J=a.getLittleEndian16();a.getBytes(n);f&&a.getBytes(f);if(8<=d&&(f=ba.getFocused())&&f.onremoteappicon){n=new hi5.graphic.Bitmap(e,c,32);a.getPosition();e=new Uint8Array(e*c*4);c=a.getPosition();J=c+J;var A;a=a.getData();for(var H=0,N,v;c<J;)switch(d){case 16:(A=
a[c++]|a[c++]<<8)?(v=A>>7&248,N=A>>2&248,A=A<<3&248,v|=v>>5,N|=N>>5,A|=A>>5,e[H++]=A,e[H++]=N,e[H++]=v,e[H++]=255):H+=4;break;case 32:e[H++]=a[c++],e[H++]=a[c++],e[H++]=a[c++],e[H++]=a[c++]}n.putPixels(e,0,e.length);a=ba.getWinById(b);f.onremoteappicon(a,n)}}else 0!=(d&2147483648)?svGlobal.logger.info("XXX rail cache icon, winId="+b):0!=(d&536870912)?(svGlobal.logger.info("***** delete winId="+b),ba.delWin(b)):Nd(a,d,b);else if(0!=(d&33554432))svGlobal.logger.info("XXX Alt Sec window Notify="+d);
else if(0!=(d&67108864))if(svGlobal.logger.info("*** -- Alt Sec window Desktop, flags:"+d),0!=(d&1))svGlobal.logger.info("Desktop non monitored flags="+d);else{if(0!=(d&32)&&(b=a.getLittleEndian32(),svGlobal.logger.info("Desktop monitored flags="+d+" winId="+b),0<b&&((f=ba.getOwnerSurfaceById(b))&&f.railWin&&f.railWin.setActiveWinId(b,3==da.windowState),ba.setTitle(b),ma.getContext()||(b=ba.getFocused())&&ma.setContext(b.context))),0!=(d&16)&&(b=a.getByte(),0<b))for(d=ba.zOrders,d.length=b,f=0;f<
b;f++)d[f]=a.getLittleEndian32(),svGlobal.logger.info("---zorders:"+d[f])}else svGlobal.logger.info("XXX Alt Sec window order flgas="+d)}function Sc(a){var b=ba.getFocused();if(b&&b.railWin){var d=a||b.railWin.mainWin;if(d&&2<d.showState){var e=b.getFreeSpace();a=Math.max(Math.abs(d.winHeight-e.height),Math.abs(d.winWidth-e.width));svGlobal.logger.info("--- fitMainWin offset:"+a+" _hOffset:"+d._hOffset+" appId:"+d.appId+" spaceH:"+e.height);0<a?(b=a==d._hOffset,d._hOffset&&b||(d._hOffset=a,setTimeout(function(){d.resize(0,
0,e.width,e.height)},333))):d._hOffset=0}}}function Nd(a,b,d){Va||(Va=!0);var e=0==(b&268435456),c=ba.getWinById(d);c?e=!0:c=new ba.LocalWin(d);svGlobal.logger.info("\n\n=========== winId="+d+" existed="+e);if(c){0!=(b&2)&&(c.ownerWinid=a.getLittleEndian32(),svGlobal.logger.info("***** ownerWinid="+c.ownerWinid));0!=(b&8)&&(c.style=a.getLittleEndian32(),c.extStyle=a.getLittleEndian32(),svGlobal.logger.info("***** winId="+d+" style="+c.style+" extStyle="+c.extStyle),svGlobal.logger.info("*****--- WS_POPUP="+
(0!=(c.style&2147483648))),svGlobal.logger.info("*****--- WS_DLGFRAME="+(0!=(c.style&4194304))),svGlobal.logger.info("*****--- DS_MODALFRAME="+(0!=(c.style&128))),svGlobal.logger.info("*****--- WS_EX_DLGMODALFRAME="+(0!=(c.extStyle&1))),svGlobal.logger.info("*****--- WS_EX_TOOLWINDOW="+(0!=(c.extStyle&128))),svGlobal.logger.info("*****--- WS_BORDER="+(0!=(c.style&8388608))),svGlobal.logger.info("*****--- WS_CAPTION="+(0!=(c.style&12582912))),svGlobal.logger.info("*****--- WS_OVERLAPPED="+(0!=(c.style&
0))),svGlobal.logger.info("*****--- WS_OVERLAPPEDWINDOW="+(0!=(c.style&13565952))),svGlobal.logger.info("*****--- WS_POPUPWINDOW="+(0!=(c.style&2156396544))),svGlobal.logger.info("*****--- WS_SIZEBOX="+(0!=(c.style&262144))),svGlobal.logger.info("*****--- WS_CHILD="+(0!=(c.style&1073741824))),svGlobal.logger.info("*****--- WS_SIZEBOX="+(0!=(c.style&262144))),svGlobal.logger.info("*****--- WS_EX_MDICHILD="+(0!=(c.extStyle&64))),svGlobal.logger.info("*****--- WS_EX_LAYERED="+(0!=(c.extStyle&524288))));
if(0!=(b&16)){c.setShowState(a.getByte());svGlobal.logger.info("***** winId="+d+" showState="+c.showState);var f=c.showState;(2==f&&0!=da.noMinimize||!e&&3==f&&5==da.windowState)&&setTimeout(function(){c.exeCommand(61728)},50)}if(f=0!=(b&4)){var n=a.getLittleEndian16();c.titleInfo=a.getUnicodeString(n,!1);svGlobal.logger.info("***** winId="+d+" title="+c.titleInfo)}0!=(b&16384)&&(c.clientOffsetX=a.getLittleEndian32(),c.clientOffsetY=a.getLittleEndian32(),svGlobal.logger.info("***** winId="+d+" coffX"+
c.clientOffsetX+" coffY="+c.clientOffsetY));0!=(b&65536)&&(c.clientAreaWidth=a.getLittleEndian32(),c.clientAreaHeight=a.getLittleEndian32(),svGlobal.logger.info("***** winId="+d+" cw"+c.clientAreaWidth+" ch="+c.clientAreaHeight));0!=(b&131072)&&(c.rpContent=a.getLittleEndian32());0!=(b&262144)&&(c.rootParentHandle=a.getLittleEndian32());if(0!=(b&2048)){n=a.getLittleEndian32();var J=a.getLittleEndian32();c.winOffsetX=n;c.winOffsetY=J;svGlobal.logger.info("***** winId="+d+" offX"+c.winOffsetX+" offY="+
c.winOffsetY)}0!=(b&32768)&&(c.winClientDeltaX=a.getLittleEndian32(),c.winClientDeltaY=a.getLittleEndian32(),svGlobal.logger.info("***** winId="+d+" dX"+c.winClientDeltaX+" dY="+c.winClientDeltaY));0!=(b&1024)&&(c.winWidth=a.getLittleEndian32(),c.winHeight=a.getLittleEndian32(),svGlobal.logger.info("***** winId="+d+" w"+c.winWidth+" h="+c.winHeight));if(!e)if(c.isMainWin())3==m.windowState?Sc(c):setTimeout(function(){c.activate(1)},666);else if(2<c.showState&&(n=ba.getFocused())){n=n.getFreeSpace();
var A=c.winWidth,H=c.winHeight;if(c.winOffsetX>n.width||c.winOffsetY>n.height||0>A+c.winOffsetX||0>H+c.winOffsetY){var N=(n.width-c.winWidth)/2|0,v=(n.height-c.winHeight)/2|0;0>N&&(N=0);0>v&&(v=0);setTimeout(function(){c.resize(N,v,A,H)},50)}}0!=(b&256)&&(n=a.getLittleEndian16(),0<n&&a.skipPosition(8*n));0!=(b&4096)&&(c.visibleOffsetX=a.getLittleEndian32(),c.visibleOffsetY=a.getLittleEndian32());0!=(b&512)&&(b=a.getLittleEndian16(),c.numVisibilityRects=b,0<b&&a.skipPosition(8*b));if(e)ba.onWinChange(c);
else ba.addWin(c);f&&ba.setTitle(d);d==ba.zOrders[0]?svGlobal.logger.info("zzz zorders win: "+d):svGlobal.logger.info("zzz win: "+d,ba.zOrders)}else svGlobal.logger.warn("XXX, No win with id:"+d)}function xc(a,b){function d(g,p,k,q,y){0<y.width?y.union(g,p,k,q):(y.x=g,y.y=p,y.width=k,y.height=q)}function e(g,p,k,q){for(qa=0;qa<ha;qa++){var y=Q[qa];if(g>=y[0]&&p>=y[1]&&k<=y[2]&&q<=y[3])return fa[qa]}return null}function c(g,p,k,q){if(ha){var y=e(g,p,g+k-1,p+q-1);y&&d(g,p,k,q,y)}else d(g,p,k,q,w)}function f(g,
p,k,q,y,B,D){for(var F=y*k+q,G=g.setRGB,V=g.getRGB,M=0;M<D;M++){for(var h=0;h<B;h++){if(g){var K=V(q+h,y+M);G(q+h,y+M,~K&16777215)}else p[F]=~p[F]&16777215;F++}F+=k-B}}function n(g,p,k,q,y,B,D,F,G,V){p=V*F+G;null==D&&(D=g);for(g=0;g<B;g++){for(G=0;G<y;G++)u[q+g][k+G]=u[q+g][k+G]&D[p]&16777215|4278190080,p++;p+=F-y}}function J(g,p,k,q,y,B,D,F,G,V){p=V*F+G;G=g.setRGB;V=g.getRGB;null==D&&(D=g);for(g=0;g<B;g++){for(var M=0;M<y;M++){var h=V(k+M,q+g);G(k+M,q+g,h|D[p]&16777215);p++}p+=F-y}}function A(g,
p,k,q){var y=oa;if(y){var B=y.getRGB(p,k);switch(g){case 0:y.setRGB(p,k,0);break;case 1:y.setRGB(p,k,~(B|q)&16777215);break;case 2:y.setRGB(p,k,B&~q&16777215);break;case 3:y.setRGB(p,k,~q&16777215);break;case 4:y.setRGB(p,k,16777215*(~B&q));break;case 5:y.setRGB(p,k,~B&16777215);break;case 6:y.setRGB(p,k,B^q&16777215);break;case 7:y.setRGB(p,k,~B&q&16777215);break;case 8:y.setRGB(p,k,B&q&16777215);break;case 9:y.setRGB(p,k,B^~q&16777215);break;case 10:break;case 11:y.setRGB(p,k,B|~q&16777215);break;
case 12:y.setRGB(p,k,q);break;case 13:y.setRGB(p,k,(~B|q)&16777215);break;case 14:y.setRGB(p,k,B|q&16777215);break;case 15:y.setRGB(p,k,16777215);break;default:svGlobal.logger.warn("unsupported pixel opcode: "+g),y.setRGB(p,k,q)}}}function H(g,p,k,q,y,B,D,F,G){g>F||p>G||(k=g+k-1,k>F&&(k=F),g<B&&(g=B),k=k-g+1,q=p+q-1,q>G&&(q=G),p<D&&(p=D),q=q-p+1,1>k||1>q||oa.fillRect(g,p,k,q,y))}function N(g,p,k,q,y,B,D,F,G,V,M,h){if(!(p>M||k>h)){var K=p+q-1;K>M&&(K=M);G=p<G?G:p;K=K-p+1;M=k+y-1;M>h&&(M=h);V=k<V?V:
k;h=M-k+1;if(!(1>K||1>h)){M=128;var O=0;D|=4278190080;F|=4278190080;if(G==p&&V==k&&K==q&&h==y)if(0==g)for(var R=0;R<y;R++){g=k+R;for(var Y=0;Y<q;Y++)0==M&&(O++,M=128),0!=(B[O]&M)&&(u[g][p+Y]=F),M>>=1;O++;M=128;O==B.length&&(O=0)}else for(R=0;R<y;R++){g=k+R;for(Y=0;Y<q;Y++)0==M&&(O++,M=128),u[g][p+Y]=0!=(B[O]&M)?F:D,M>>=1;O++;M=128;O==B.length&&(O=0)}else if(0==g)for(R=0;R<h;R++){g=k+R;for(Y=0;Y<K;Y++)0==M&&(O++,M=128),p+Y>=G&&g>=V&&0!=(B[O]&M)&&(u[g][p+Y]=F),M>>=1;O++;M=128;O==B.length&&(O=0)}else for(R=
0;R<h;R++){g=k+R;for(Y=0;Y<K;Y++)0==M&&(O++,M=128),p+Y>=G&&k+R>=V&&(u[g][p+Y]=0!=(B[O]&M)?F:D),M>>=1;O++;M=128;O==B.length&&(O=0)}}}}function v(g,p,k,q,y){this.offset=g;this.baseLine=p;this.width=k;this.height=q;this.fontData=y}function x(g,p,k,q,y,B,D,F,G){this.cache_idx=g;this.rawData=p;this.none=!p;this.hotX=k;this.hotY=q;this.width=y;this.height=B;this.xorSize=F;this.andSize=G;this.result="";this.distance=0;this.bpp=D;this.system="";if(p){if(!this.distance){g=0;if(p){D=0;for(var V=p.length;D<
V;D++)0!=p[D]&&(g+=D%y+(D/y|0))}this.distance=g}if(!this.system){a:switch(this.distance){case 507:g="text";break a;case 2046:case 4359:g="default";break a;default:g=""}this.system=g}}g="";if(!this.system&&p){D=y*B*4;g=62+D+F+G;V=new Uint8Array(g);g=new hi5.DataBuffer(V,0,g);g.setLittleEndian16(0);g.setLittleEndian16(2);g.setLittleEndian16(1);g.setByte(y);g.setByte(B);g.setByte(0);g.setByte(0);g.setLittleEndian16(k);g.setLittleEndian16(q);g.setLittleEndian32(40+D+F+G);g.setLittleEndian32(22);g.setLittleEndian32(40);
g.setLittleEndian32(y);g.setLittleEndian32(2*B);g.setLittleEndian16(1);g.setLittleEndian16(32);g.setLittleEndian32(0);g.setLittleEndian32(F+G);g.setLittleEndian32(0);g.setLittleEndian32(0);g.setLittleEndian32(0);g.setLittleEndian32(0);for(k=B-1;0<=k;k--)for(q=0;q<y;q++)B=p[y*k+q],g.setByte(B&255),g.setByte(B>>8&255),g.setByte(B>>16&255),g.setByte(B>>24&255);g="data:image/x-icon;base64,"+hi5.Base64.enc(g.getData())}this.url=g}var u=[],r=null,w=new hi5.graphic.Rectangle(0,0,0,0),t="Uint8ClampedArray"in
window,L=null,z=0,E=0,C=0,S=0,X=null,Q,fa,qa=0,ha=0;this.width=a;this.height=b;var ja=!1,oa=this,sa={imgData:null,left:0,top:0,width:0,height:0};this.setProfiler=function(g){L=g};this.getDirtyArea=function(){return w};this.setImgRect=function(g,p,k,q){z=g;E=p;C=k;S=q};this.parseMonitorDef=function(g){var p=g.split(","),k=p.length,q=[];if(1<k){for(var y=!1,B=0;B<k;B++){var D=p[B].split(":");if(4==D.length)q[B]=Array(5),q[B][0]=parseInt(D[0]),q[B][1]=parseInt(D[1]),q[B][2]=parseInt(D[2]),q[B][3]=parseInt(D[3]),
q[B][4]=0==q[B][0]&&0==q[B][1]?1:0;else{y=!0;break}}y&&(svGlobal.logger.warn("invaiid monitorDef:"+g),q.length=0)}return q};this.setMonitorLayout=function(g){var p=g.length,k=0;Q=g;for(fa=Array(p);k<p;k++)fa[k]=new hi5.graphic.Rectangle(0,0,0,0);ha=p};this.setMonitorCount=function(g){ha=g};this.addImg=function(g){C&&(X&&URL.revokeObjectURL(X.src),X=g)};this.flushImgs=function(){X&&(URL.revokeObjectURL(X.src),X=null,C=0)};this.getData=function(){return u};this.pause=function(g,p){ja=g;p&&r&&r.fillRect(0,
0,a,b)};this.release=function(){w=null;hi5.Arrays.release(fa);oa.flushImgs();u=r=oa=null;sa=sa.imgData=null};this.isPaused=function(){return ja};this.setContext=function(g){g!=r&&(r||!g||g.createImageData(1,1).data.buffer||(t=!1),r=g,null!=r&&(sa.imgData=r.createImageData(a,b)))};this.getContext=function(){return r};this.resize=function(g,p){if(u.length!=p||u[0].length!=g){for(var k=0;k<p;k++)u[k]=new Uint32Array(g);u.length=p;oa.width=a=g;oa.height=b=p;null!=r&&(sa.imgData=r.createImageData(a,b))}};
oa.resize(a,b);this.getBuffer=function(){return u};this.setRGB=function(g,p,k){u[p][g]=k|4278190080};this.getRGB=function(g,p){return u[p][g]};this.setRGBs=function(g,p,k,q,y,B,D){var F=g+k,G=p+q;G>b&&(G=b);if(!(g>=a)){F>a&&(k-=F-a);for(F=p;F<G;F++,B+=D)u[F].set(y.subarray(B,B+k),g);c(g,p,k,q)}};this.moveArea=function(g,p,k,q,y,B){if(0<B){var D=g+y,F=p+B,G;for(G=q-1;0<=G;G--)u[F+G].set(u[p+G].subarray(g,g+k),D)}else if(0>B)for(D=g+y,F=p+B,G=0;G<q;G++)u[F+G].set(u[p+G].subarray(g,g+k),D);else if(0<
y){D=g+y;F=p+B;var V;for(G=k-1;0<=G;G--){var M=D+G;var h=g+G;for(V=0;V<q;V++)u[F+V][M]=u[p+V][h]}}else for(D=g+y,F=p+B,G=0;G<k;G++)for(M=D+G,h=g+G,V=0;V<q;V++)u[F+V][M]=u[p+V][h];c(g+y,p+B,k,q)};this.getRGBs=function(g,p,k,q,y){var B=new Uint32Array(k*q),D=g+k;q=p+q;for(var F=0;p<q;p++)B.set(u[p].subarray(g,D),F),F+=k;return y?(y(B),null):B};this.repaint=function(g,p,k,q){var y=sa.imgData.data,B=0,D,F;L&&L.begin("paint");0>g&&(k+=g,g=0);0>p&&(q+=p,p=0);g+k>a&&(k=a-g);p+q>b&&(q=b-p);var G=g+k;var V=
p+q;if(t)for(y=new Uint32Array(y.buffer),F=p;F<V;F++)y.set(u[F].subarray(g,G),B),B+=a;else{var M=4*(a-k)|0;for(F=p;F<V;F++){for(D=g;D<G;D++){var h=u[F][D];y[B++]=h&255;y[B++]=h>>8&255;y[B++]=h>>16&255;y[B++]=255}B+=M}}sa.left=g;sa.top=p;sa.width=k;sa.height=q;L&&L.end("paint");return sa};this.postPaint=c;this.draw=function(g,p,k,q){if(!ja&&r)if(X&&X.complete&&(r.drawImage(X,z,E,C,S),URL.revokeObjectURL(X.src),X=null),ha){if(g=e(g,p,k,q),g.width)return oa.repaint(g.x,g.y,g.width,g.height),g.width=
0,sa}else if(w.width)return oa.repaint(w.x,w.y,w.width,w.height),w.width=0,sa;return null};this.fillRect=function(g,p,k,q,y){var B=g+k,D=p+q;if(u[0].fill)for(var F,G=p;G<D;G++)u[G].fill(y,g,B);else for(G=p;G<D;G++)for(F=g;F<B;F++)u[G][F]=y;c(g,p,k,q)};this.drawLine=function(g,p,k,q,y){if(p==q){if(g>k){var B=g;g=k;k=B}var D=u[p];k++;if(D.fill)D.fill(y,g,k);else for(B=g;B<k;B++)D[B]=y}else if(g==k)for(p>q&&(B=p,p=q,q=B),q++,B=p;B<q;B++)u[B][g]=y;else{var F=Math.abs(k-g),G=Math.abs(q-p);B=g;D=p;k=k>=
g?g=1:g=-1;p=q>=p?q=1:q=-1;if(F>=G){p=g=0;var V=F;var M=F/2|0;var h=G}else q=k=0,V=G,M=G/2|0,h=F,F=G;if(!(1>F))for(F++,G=0;G<F;G++)u[D][B]=y,M+=h,M>=V&&(M-=V,B+=g,D+=q),B+=k,D+=p}};this.bitBlt=function(g,p,k,q,y,B,D,F,G,V){var M=oa;switch(g){case 0:F=M.setRGB;for(M=k;M<k+y;M++)for(G=q;G<q+B;G++)F(M,G,0);break;case 1:g=D;G=V*F+G;V=M.setRGB;p=M.getRGB;null==g&&(g=M);for(M=0;M<B;M++){for(D=0;D<y;D++)V(k+y,q+B,~(p(k+y,q+B)|g[G])&16777215);G+=F-y}break;case 2:g=D;G=V*F+G;V=M.setRGB;p=M.getRGB;null==g&&
(g=M);for(M=0;M<B;M++){for(D=0;D<y;D++){var h=p(k+y,q+B);V(k+y,q+B,h&~g[G]&16777215);G++}G+=F-y}break;case 3:f(M,D,F,G,V,y,B);D?M.setRGBs(k,q,y,B,D,V*F+G,F):M.moveArea(G,V,y,B,k-G,q-V);break;case 4:f(M,null,p,k,q,y,B);n(M,p,k,q,y,B,D,F,G,V);break;case 5:f(M,null,p,k,q,y,B);break;case 6:g=D;G=V*F+G;null==g&&(g=M);for(M=0;M<B;M++){for(V=0;V<y;V++)u[q+M][k+V]=u[q+M][k+V]^g[G]&16777215|4278190080,G++;G+=F-y}break;case 7:g=D;G=V*F+G;V=M.setRGB;p=M.getRGB;null==g&&(g=M);for(M=0;M<B;M++){for(D=0;D<y;D++)h=
p(k+D,q+M),V(k+D,q+M,~(h&g[G])&16777215),G++;G+=F-y}break;case 8:n(M,p,k,q,y,B,D,F,G,V);break;case 9:g=D;G=V*F+G;V=M.setRGB;p=M.getRGB;null==g&&(g=M);for(M=0;M<B;M++){for(D=0;D<y;D++)h=p(k+D,q+M),V(k+D,q+M,h^~g[G]&16777215),G++;G+=F-y}break;case 10:break;case 11:g=D;G=V*F+G;V=M.setRGB;p=M.getRGB;null==g&&(g=M);for(M=0;M<B;M++){for(D=0;D<y;D++)h=p(k+D,q+M),V(k+D,q+M,h|~g[G]&16777215),G++;G+=F-y}break;case 12:D?M.setRGBs(k,q,y,B,D,V*F+G,F):M.moveArea(G,V,y,B,k-G,q-V);break;case 13:f(M,null,p,k,q,y,
B);J(M,p,k,q,y,B,D,F,G,V);break;case 14:J(M,p,k,q,y,B,D,F,G,V);break;case 15:F=M.setRGB;for(M=k;M<k+y;M++)for(G=q;G<q+B;G++)F(M,G,16777215);break;default:svGlobal.logger.warn("unsupported opcode: "+g)}c(k,q,y,B)};this.drawLineExt=function(g,p,k,q,y,B){if(g==k||p==q){var D;if(p==q)if(k>g){var F=k-g;if(!(1>F))for(D=0;D<F;D++)A(B,g+D,p,y)}else{if(F=g-k,!(1>F))for(D=0;D<F;D++)A(B,k+D,p,y)}else if(q>p){if(F=q-p,!(1>F))for(D=0;D<F;D++)A(B,g,p+D,y)}else if(F=p-q,!(1>F))for(D=0;D<F;D++)A(B,g,q+D,y)}else{var G=
Math.abs(k-g),V=Math.abs(q-p);D=g;F=p;var M,h;var K=k>=g?M=1:M=-1;var O=q>=p?h=1:h=-1;if(G>=V){O=M=0;var R=G;var Y=G/2>>0;var la=V}else h=K=0,R=V,Y=V/2>>0,la=G,G=V;if(1>G)return;for(V=0;V<=G;V++)A(B,D,F,y),Y+=la,Y>=R&&(Y-=R,D+=M,F+=h),D+=K,F+=O}y=Math.min(g,k);g=Math.max(g,k);k=Math.min(p,q);p=Math.max(p,q);0>g-y||0>p-k||c(y,k,g-y+1,p-k+1)};this.drawText=function(g,p,k,q,y,B,D,F,G,V,M,h,K,O,R,Y,la,Aa,Ga,La,Da){var xa=0;1<h?H(V,M,h,K,y,Aa,Ga,La,Da):1==k&&H(B,D,F,G,y,Aa,Ga,La,Da);for(var Pa=Y,va=0;va<
Y;)switch(la[xa+va]){case 255:var ya=la[xa+va+2];if(ya>Pa-xa){va=Y=0;break}ya=la.slice?la.slice(xa,xa+ya):la.subarray(xa,xa+ya);W[la[xa+va+1]]=ya;va+=3;Y-=va;xa=va;va=0;break;case 254:var Ha=(ya=W[la[xa+va+1]])?ya:null;Ha&&0==Ha[1]&&0==(p&32)&&(0!=(p&4)?R+=la[xa+va+2]:O+=la[xa+va+2]);va=va+2<Y?va+3:va+2;Y-=va;xa=va;va=0;if(!Ha)break;for(var Za=Ha.length,$a=0;$a<Za;$a++){ya=na.getFont(g,Ha[$a]);if(0==(p&32)){var Xa=Ha[++$a];0!=(Xa&128)?(0!=(p&4)?R+=Ha[$a+1]|Ha[$a+2]<<8:O+=Ha[$a+1]|Ha[$a+2]<<8,$a+=
2):0!=(p&4)?R+=Xa:O+=Xa}ya&&(N(k,O+ya.offset&65535,R+ya.baseLine&65535,ya.width,ya.height,ya.fontData,y,q,Aa,Ga,La,Da),0!=(p&32)&&(O+=ya.width))}break;default:ya=na.getFont(g,la[xa+va]),0==(p&32)&&(Xa=la[xa+ ++va],0!=(Xa&128)?(0!=(p&4)?R+=la[xa+va+1]|la[xa+va+2]<<8:O+=la[xa+va+1]|la[xa+va+2]<<8,va+=2):0!=(p&4)?R+=Xa:O+=Xa),ya&&(N(k,O+ya.offset&65535,R+ya.baseLine&65535,ya.width,ya.height,ya.fontData,y,q,Aa,Ga,La,Da),0!=(p&32)&&(O+=ya.width)),va++}1<h?0<K&&c(V,M,h,K):0<F&&0<G&&c(B,D,F,G)};this.drawBitmap=
function(g,p,k,q,y,B,D,F,G){var V=wa.getBitmap(g,p);V?(g=V.width,p=V.height,y>g&&(y=g),B>p&&(B=p),12==G?oa.setRGBs(k,q,y,B,V.data,F*g+D,g):oa.bitBlt(G,a,k,q,y,B,V.data,g,D,F)):svGlobal.logger.warn("Failed to get bitmap from cache, id:"+g+" idx="+p)};this.saveDesktop=function(g,p,k,q,y){oa.getRGBs(g,p,k,q,function(B){ra.save(g,p,k,q,y,B)})};this.restoreDesktop=function(g,p,k,q,y){(y=ra.restore(g,p,k,q,y))?oa.setRGBs(g,p,k,q,y,0,k):svGlobal.logger.warn("XXX no matched desktop save.")};this.putFont=
function(g,p,k){na.putFont(g,p,k)};this.putBitmap=function(g,p,k){wa.putBitmap(g,p,k)};this.putCursor=function(g,p){ka.set(g,p)};this.setCursor=function(g){if(!ja&&-1!=g){var p=ka.get(g);if(p)oa.onSetCursor(p);else svGlobal.logger.warn("invalid cursor"+g)}};var Ea=0;this.isSendingHistory=function(){return 2E3>Date.now()-Ea};this.getHistory=function(g,p){var k=null;(k=ka.toPDU())&&g(k.buffer);if(oa.onGetGfxHistory)oa.onGetGfxHistory(g,p);else{L&&L.begin("his_bitmap");wa.forEach(function(F,G,V){if(F){var M=
0,h=0;V=0;for(var K=F.length;V<K;V++)F[V]&&F[V].data&&(M++,h+=F[V].raw?F[V].raw.length:4*F[V].data.length);if(M&&h){k=new Uint8Array(h+20*M+8);k[0]=29;k[2]=1;k[3]=4;h=new hi5.DataBuffer(k,4,k.length);h.setLittleEndian32(M);for(V=0;V<K;V++)(M=F[V])&&M.data&&(h.setLittleEndian16(G),h.setLittleEndian16(V),h.setLittleEndian16(M.left),h.setLittleEndian16(M.top),h.setLittleEndian16(M.width),h.setLittleEndian16(M.height),h.setLittleEndian16(M.bitsperpixel),h.setLittleEndian16(M.codec),h.setLittleEndian32(M.raw?
M.raw.length:4*M.data.length),h.setBytes(M.raw||new Uint8Array(M.data.buffer)));g(k.buffer)}}});L&&L.end("his_bitmap");L&&L.begin("his_font");(k=na.toPDU())&&g(k.buffer);L&&L.end("his_font");for(var q=4,y=0,B=W.length;y<B;y++)W[y]&&(q+=W[y].length+6);if(4<q){k=new Uint8Array(q);k[0]=29;k[2]=1;k[3]=7;var D=4;y=0;for(B=W.length;y<B;y++)W[y]&&W[y].length&&(k[D++]=y,k[D++]=y>>8,q=W[y].length,k[D++]=q,k[D++]=q>>8,k[D++]=q>>16,k[D++]=q>>24,k.set(W[y],D),D+=q);g(k.buffer)}(k=ra.toPDU())&&g(k.buffer);p();
Ea=Date.now()}};this.onHistoryDone=function(){oa.onGetGfxHistory&&m.reconnect(a,b,!0)};this.setHistory=function(g,p){svGlobal.logger.info("setHistory type:"+g);switch(g){case 4:L&&L.begin("his_bitmap_dec");var k=p.getLittleEndian32();for(g=0;g<k;g++){var q=p.getLittleEndian16(),y=p.getLittleEndian16(),B=p.getLittleEndian16(),D=p.getLittleEndian16(),F=p.getLittleEndian16(),G=p.getLittleEndian16(),V=p.getLittleEndian16(),M=p.getLittleEndian16(),h=p.getLittleEndian32(),K=new Uint8Array(p.getData().buffer,
p.getPosition(),h),O=new Uint8Array(h);O.set(K);K=rdpcodecs.bitmap;switch(M){case 0:var R=new Uint32Array(O.buffer);p.skipPosition(h);break;case 1:switch(V){case 16:R=K.decompressInt16(F,G,h,O,0);break;case 24:R=K.decompressInt24(F,G,h,O,0);break;case 32:R=K.decompressInt32(F,G,h,O,0)}p.skipPosition(h);break;case 2:R=new rdpcodecs.NSCodec,R.process(p,V,F,G),h=R.getData(),R=R.getDataSize(),R=new Uint32Array(R),rdpcodecs.flipimage(h,0,R,F,G,1)}wa.putBitmap(q,y,new rdpcodecs.Bitmap(R,F,G,B,D,V,0==M?
null:O,M))}L&&L.end("his_bitmap_dec");break;case 5:na.fromStream(p);break;case 6:ka.fromStream(p);break;case 7:for(;p.has(6);)if(g=p.getLittleEndian16(),h=p.getLittleEndian32())k=p.getData().subarray(p.getPosition(),p.getPosition()+h),W[g]=k,p.skipPosition(h);break;case 9:ra.fromStream(p);break;default:if(oa.onSetGfxHistory)oa.onSetGfxHistory(g,p)}};var ka=new function(){var g=[],p=!1;this.useRemoteCursor=function(k){p=k};this.set=function(k,q){p&&(q.system="");g[k]=q};this.get=function(k){return g[k]};
this.total=function(){return g.length};this.toPDU=function(){for(var k=2,q=2,y=0,B=0,D=g.length,F;B<D;B++)if(F=g[B])y++,q=q+7+(F.rawData?F.rawData.length:0);if(!y)return null;q=new Uint32Array(q);q[0]=100728861;q[1]=y;for(B=0;B<D;B++)if(F=g[B])if(y=F.rawData?F.rawData.length:0,q[k++]=F.cache_idx|F.bpp<<16,q[k++]=F.hotX|F.hotY<<16,q[k++]=F.width|F.height<<16,q[k++]=F.xorSize,q[k++]=F.andSize,q[k++]=F.distance,q[k++]=y)q.set(F.rawData,k),k+=y;return q};this.fromStream=function(k){var q=k.getPosition();
k=new Uint32Array(k.getData().buffer,q);var y=k[0],B=0;for(q=1;B<y;B++){var D=k[q]&65535;var F=k[q++]>>16;var G=k[q]&65535;var V=k[q++]>>16;var M=k[q]&65535;var h=k[q++]>>16;var K=k[q++];var O=k[q++];var R=k[q++];var Y=k[q++];var la=null;Y&&(la=new Uint32Array(Y),la.set(k.subarray(q,q+Y)),q+=Y);F=new x(D,la,G,V,M,h,F,K,O);R&&(F.distance=R);p&&(F.system="");g[D]=F}}};ka.useRemoteCursor(!!da.remoteCursor);var ra=new function(){function g(k,q,y,B,D,F){this.x=k;this.y=q;this.cx=y;this.cy=B;this.offset=
D;this.data=F}var p=[];this.save=function(k,q,y,B,D,F){k=new g(k,q,y,B,D,F);q=0;for(y=p.length;q<y;q++)if(!p[q]){p[q]=k;return}p.push(k)};this.restore=function(k,q,y,B,D){for(var F,G=0,V=p.length;G<V;G++)if((F=p[G])&&F.x==k&&F.y==q&&F.cx==y&&F.cy==B){if(F.offset==D)return k=F.data,p[G]=null,k;svGlobal.logger.warn("TODO: offset")}return null};this.toPDU=function(){for(var k=0,q=2,y=0,B=p.length;y<B;y++)p[y]&&(k++,q+=p[y].data.length+6);if(!k||!q)return null;q=new Uint32Array(q);var D=2;q[0]=151060509;
q[1]=k;for(y=0;y<B;y++)if(k=p[y])q[D++]=k.x,q[D++]=k.y,q[D++]=k.cx,q[D++]=k.cy,q[D++]=k.offset,q[D++]=k.data.length,q.set(k.data,D),D+=k.data.length;return q};this.fromStream=function(k){k=new Uint32Array(k.getData().buffer,k.getPosition());for(var q=1,y=k[0],B,D,F,G,V,M,h,K=0;K<y;K++)B=k[q++],D=k[q++],F=k[q++],G=k[q++],V=k[q++],M=k[q++],h=new Uint32Array(M),M=q+M,h.set(k.subarray(q,M)),q=M,this.save(B,D,F,G,V,h)}},W=[],na=new function(){var g=[];this.putFont=function(p,k,q){g[p]||(g[p]=[]);g[p][k]=
q};this.getFont=function(p,k){return g[p]?g[p][k]:null};this.toPDU=function(){var p=0,k,q,y;var B=4;for(var D,F=g.length;p<F;p++)if((y=g[p])&&y.length)for(D=y.length,k=0;k<D;k++)(q=y[k])&&(B+=15+q.fontData.length);if(5>B)return null;var G=new Uint8Array(B);B=new hi5.DataBuffer(G,0,B);G[0]=29;G[2]=1;G[3]=5;B.skipPosition(4);p=0;for(F=g.length;p<F;p++)if((y=g[p])&&y.length)for(D=y.length,k=0;k<D;k++)if(q=y[k])B.setByte(p),B.setLittleEndian16(k),B.setLittleEndian16(q.offset),B.setLittleEndian16(q.baseLine),
B.setLittleEndian16(q.width),B.setLittleEndian16(q.height),B.setLittleEndian32(q.fontData.length),B.setBytes(q.fontData);return G};this.fromStream=function(p){for(;p.has(15);){var k=p.getByte(),q=p.getLittleEndian16(),y=p.getLittleEndian16(),B=p.getLittleEndian16(),D=p.getLittleEndian16(),F=p.getLittleEndian16(),G=p.getLittleEndian32();G=p.getBytes(G);this.putFont(k,q,new v(y,B,D,F,G))}}},wa=new function(){var g=[],p=[];this.putBitmap=function(k,q,y){if(32767==q)p[k]&&(p[k].data=null,p[k]=null),p[k]=
y;else{var B=g[k];B?B[q]&&(B[q].data=null,B[q]=null):g[k]=B=[];B[q]=y}};this.getBitmap=function(k,q){return 32767==q?p[k]:g[k]?g[k][q]:null};this.forEach=function(k){for(var q=g.length,y=0;y<q;y++)k(g[y],y,g)}}}function oc(a){function b(h,K,O){K[O]=h>>24&255;K[O+1]=h>>16&255;K[O+2]=h>>8&255;K[O+3]=h&255}function d(h,K){var O=h.length;K=new Uint8Array(K?O+1:O);for(var R=0;R<O;R++)K[R]=h.charCodeAt(R);return K}var e=new Uint8Array([0,0,0,0]),c=new Uint8Array([255,255,255,255]),f={avc1:[],avcC:[],btrt:[],
dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],mvex:[],mvhd:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[],mehd:[]},n=this,J=1,A=a?48E3:9E4,H=1,N=!1,v=null;this.initTypes=function(){for(var h in f)f[h]=[h.charCodeAt(0),h.charCodeAt(1),h.charCodeAt(2),h.charCodeAt(3)];f.url=[117,114,108,32]};n.initTypes();this.reset=function(){N=!1;H=J=1};this.close=function(){n&&
(n.reset(),n=null)};this.remux=function(h){h.id=J;h.isAudio=a;h.timeScale=a?h.audioHeader.sampleRate:A;if(!N){var K=new u(a),O=new r(h);v=new Uint8Array(K.data.length+O.data.length);v.set(K.data,0);v.set(O.data,K.data.length);N=!0}h.sequenceNumber=H++;K=new y(h);O=new M(h);h=new Uint8Array(K.data.length+O.data.length);h.set(K.data,0);h.set(O.data,K.data.length);v&&(K=new Uint8Array(v.length+h.length),K.set(v,0),K.set(h,v.length),h=K,v=null);if(n.ondata)n.ondata(h)};var x=function(h){this.type=h;this.data=
null};x.prototype.setData=function(){var h=Array.prototype.slice.call(arguments,0),K=h.length,O=8,R;for(R=0;R<K;R++)O+=h[R].byteLength;this.data=new Uint8Array(O);b(O,this.data,0);this.data.set(this.type,4);O=8;for(R=0;R<K;R++)this.data.set(h[R],O),O+=h[R].byteLength};var u=function(h){var K=x.call(this,f.ftyp)||this;var O=d("mp42"),R=d("mp41"),Y=d("isom"),la=d("avc1"),Aa=d("iso5"),Ga=new Uint8Array([0,0,2,0]);h?K.setData(O,Ga,O,R,Y,Aa):K.setData(Y,Ga,Y,R,Aa,la);return K};$jscomp.inherits(u,x);var r=
function(h){var K=x.call(this,f.moov)||this;var O=new w(h),R=new t(h);h=new k(h);K.setData(O.data,R.data,h.data);return K};$jscomp.inherits(r,x);var w=function(h){h=x.call(this,f.mvhd)||this;var K=new Uint8Array([0]),O=new Uint8Array([0,0,0]),R=new Uint8Array([0,0,0,0]),Y=new Uint8Array([0,0,0,0]),la=new Uint8Array(4);b(1E3,la,0);var Aa=new Uint8Array([0,1,0,0]),Ga=new Uint8Array([1,0]),La=new Uint8Array(10),Da=new Uint8Array(36);Da[1]=1;Da[17]=1;Da[32]=64;var xa=new Uint8Array(24),Pa=new Uint8Array([255,
255,255,255]);h.setData(K,O,R,Y,la,e,Aa,Ga,La,Da,xa,Pa);return h};$jscomp.inherits(w,x);var t=function(h){var K=x.call(this,f.trak)||this;var O=new L(h);h=new z(h);K.setData(O.data,h.data);return K};$jscomp.inherits(t,x);var L=function(h){var K=x.call(this,f.tkhd)||this;var O=new Uint8Array([0]),R=new Uint8Array([0,0,7]),Y=new Uint8Array([0,0,0,0]),la=new Uint8Array([0,0,0,0]),Aa=new Uint8Array(4);b(h.id,Aa,0);var Ga=new Uint8Array(4),La=new Uint8Array(8),Da=new Uint8Array([0,0]),xa=new Uint8Array([0,
0]),Pa=h.isAudio?new Uint8Array([1,0]):new Uint8Array([0,0]),va=new Uint8Array(2),ya=new Uint8Array(36);ya[1]=1;ya[17]=1;ya[32]=64;var Ha=new Uint8Array(4);Ha[0]=h.width>>8&255;Ha[1]=h.width&255;Ha[2]=0;Ha[3]=0;var Za=new Uint8Array(4);Za[0]=h.height>>8&255;Za[1]=h.height&255;Za[2]=0;Za[3]=0;K.setData(O,R,Y,la,Aa,Ga,e,La,Da,xa,Pa,va,ya,Ha,Za);return K};$jscomp.inherits(L,x);var z=function(h){var K=x.call(this,f.mdia)||this;var O=new E(h),R=new C(h);h=new S(h);K.setData(O.data,R.data,h.data);return K};
$jscomp.inherits(z,x);var E=function(h){var K=x.call(this,f.mdhd)||this;var O=new Uint8Array([0]),R=new Uint8Array([0,0,0]),Y=new Uint8Array([0,0,0,0]),la=new Uint8Array([0,0,0,0]),Aa=new Uint8Array(4);b(h.timeScale,Aa,0);h=new Uint8Array([85,196]);var Ga=new Uint8Array(2);K.setData(O,R,Y,la,Aa,e,h,Ga);return K};$jscomp.inherits(E,x);var C=function(h){var K=x.call(this,f.hdlr)||this;var O=new Uint8Array([0]),R=new Uint8Array([0,0,0]),Y=new Uint8Array(4);h=h.isAudio?d("soun"):d("vide");var la=new Uint8Array(12),
Aa=d("Remote Spark Handler",!0);K.setData(O,R,Y,h,la,Aa);return K};$jscomp.inherits(C,x);var S=function(h){var K=x.call(this,f.minf)||this;var O=new fa,R=new ja(h);h.isAudio?(h=new Q,K.setData(h.data,O.data,R.data)):(h=new X,K.setData(h.data,O.data,R.data));return K};$jscomp.inherits(S,x);var X=function(){var h=x.call(this,f.vmhd)||this;var K=new Uint8Array([0]),O=new Uint8Array([0,0,1]),R=new Uint8Array([0,0]),Y=new Uint8Array(6);h.setData(K,O,R,Y);return h};$jscomp.inherits(X,x);var Q=function(){var h=
x.call(this,f.smhd)||this;var K=new Uint8Array([0]),O=new Uint8Array([0,0,0]),R=new Uint8Array([0,0]),Y=new Uint8Array(2);h.setData(K,O,R,Y);return h};$jscomp.inherits(Q,x);var fa=function(){var h=x.call(this,f.dinf)||this;var K=new qa;h.setData(K.data);return h};$jscomp.inherits(fa,x);var qa=function(){var h=x.call(this,f.dref)||this;var K=new Uint8Array([0]),O=new Uint8Array([0,0,0]),R=new Uint8Array([0,0,0,1]),Y=new ha;h.setData(K,O,R,Y.data);return h};$jscomp.inherits(qa,x);var ha=function(){var h=
x.call(this,f.url)||this;var K=new Uint8Array([0]),O=new Uint8Array([0,0,1]);h.setData(K,O);return h};$jscomp.inherits(ha,x);var ja=function(h){var K=x.call(this,f.stbl)||this;h=new oa(h);var O=new na,R=new wa,Y=new g,la=new p;K.setData(h.data,O.data,R.data,Y.data,la.data);return K};$jscomp.inherits(ja,x);var oa=function(h){var K=x.call(this,f.stsd)||this;var O=new Uint8Array([0]),R=new Uint8Array([0,0,0]),Y=new Uint8Array([0,0,0,1]);h.isAudio?(h=new sa(h),K.setData(O,R,Y,h.data)):(h=new ka(h),K.setData(O,
R,Y,h.data));return K};$jscomp.inherits(oa,x);var sa=function(h){var K=x.call(this,f.mp4a)||this;var O=new Uint8Array(6),R=new Uint8Array([0,1]),Y=new Uint8Array(8),la=new Uint8Array([0,2]),Aa=new Uint8Array([0,16]),Ga=new Uint8Array([0,0]),La=new Uint8Array(2),Da=h.audioHeader.sampleRate,xa=new Uint8Array(4);xa[0]=Da>>8&255;xa[1]=Da&255;xa[2]=0;xa[3]=0;h=new Ea(h);K.setData(O,R,Y,la,Aa,Ga,La,xa,h.data);return K};$jscomp.inherits(sa,x);var Ea=function(h){var K=x.call(this,f.esds)||this;var O=new Uint8Array([0]),
R=new Uint8Array([0,0,0]),Y=new Uint8Array([3]),la=new Uint8Array([25]),Aa=new Uint8Array([0,0]),Ga=new Uint8Array([0]),La=new Uint8Array([4]),Da=new Uint8Array([17]),xa=new Uint8Array([64]),Pa=new Uint8Array([21]),va=new Uint8Array(3),ya=h.bufferSizeDB;va[0]=ya>>16&255;va[1]=ya>>8&255;va[2]=ya&255;ya=new Uint8Array(4);b(h.bitRate,ya,0);var Ha=new Uint8Array(4);b(h.bitRate,Ha,0);var Za=new Uint8Array([5]),$a=new Uint8Array([2]),Xa=h.audioHeader.audioType||2,gb=h.audioHeader.frequencyIdx,mb=h.audioHeader.channelConfig;
h=new Uint8Array(2);h[0]=Xa<<3|gb>>1&7;h[1]=(gb&1)<<7|mb<<3;Xa=new Uint8Array([6]);gb=new Uint8Array([1]);mb=new Uint8Array([2]);K.setData(O,R,Y,la,Aa,Ga,La,Da,xa,Pa,va,ya,Ha,Za,$a,h,Xa,gb,mb);return K};$jscomp.inherits(Ea,x);var ka=function(h){var K=x.call(this,f.avc1)||this;var O=new Uint8Array(6),R=new Uint8Array([0,1]),Y=new Uint8Array([0,0]),la=new Uint8Array(2),Aa=new Uint8Array(12),Ga=new Uint8Array(2);Ga[0]=h.width>>8&255;Ga[1]=h.width&255;var La=new Uint8Array(2);La[0]=h.height>>8&255;La[1]=
h.height&255;var Da=new Uint8Array([0,72,0,0]),xa=new Uint8Array([0,72,0,0]),Pa=new Uint8Array(4),va=new Uint8Array([0,1]),ya=d("SparkStreamPlayer"),Ha=new Uint8Array(32);Ha[0]=ya.length;Ha.set(ya,1);ya=new Uint8Array([0,24]);var Za=new Uint8Array([255,255]);h=new ra(h);K.setData(O,R,Y,la,Aa,Ga,La,Da,xa,Pa,va,Ha,ya,Za,h.data);return K};$jscomp.inherits(ka,x);var ra=function(h){var K=x.call(this,f.avcC)||this;var O=new Uint8Array([1]),R=new Uint8Array([h.sps[1]]),Y=new Uint8Array([h.sps[2]]),la=new Uint8Array([h.sps[3]]),
Aa=new Uint8Array([255]),Ga=new Uint8Array([225]),La=new Uint8Array(2),Da=h.sps.byteLength;La[0]=Da>>8&255;La[1]=Da&255;Da=new Uint8Array(h.sps);var xa=new Uint8Array([1]),Pa=new Uint8Array(2),va=h.pps.byteLength;Pa[0]=va>>8&255;Pa[1]=va&255;h=new Uint8Array(h.pps);K.setData(O,R,Y,la,Aa,Ga,La,Da,xa,Pa,h);return K};$jscomp.inherits(ra,x);var W=function(){var h=x.call(this,f.btrt)||this;var K=new Uint8Array([0,28,156,128]),O=new Uint8Array([0,45,198,192]),R=new Uint8Array([0,45,198,192]);h.setData(K,
O,R);return h};$jscomp.inherits(W,x);var na=function(){var h=x.call(this,f.stts)||this;var K=new Uint8Array([0]),O=new Uint8Array([0,0,0]),R=new Uint8Array([0,0,0,0]);h.setData(K,O,R);return h};$jscomp.inherits(na,x);var wa=function(){var h=x.call(this,f.stsc)||this;var K=new Uint8Array([0]),O=new Uint8Array([0,0,0]),R=new Uint8Array([0,0,0,0]);h.setData(K,O,R);return h};$jscomp.inherits(wa,x);var g=function(){var h=x.call(this,f.stsz)||this;var K=new Uint8Array([0]),O=new Uint8Array([0,0,0]),R=new Uint8Array([0,
0,0,0]),Y=new Uint8Array([0,0,0,0]);h.setData(K,O,R,Y);return h};$jscomp.inherits(g,x);var p=function(){var h=x.call(this,f.stco)||this;var K=new Uint8Array([0]),O=new Uint8Array([0,0,0]),R=new Uint8Array([0,0,0,0]);h.setData(K,O,R);return h};$jscomp.inherits(p,x);var k=function(h){var K=x.call(this,f.mvex)||this;h=new q(h);K.setData(h.data);return K};$jscomp.inherits(k,x);W=function(h){h=x.call(this,f.mehd)||this;var K=new Uint8Array([0]),O=new Uint8Array([0,0,0]);h.setData(K,O,c);return h};$jscomp.inherits(W,
x);var q=function(h){var K=x.call(this,f.trex)||this;var O=new Uint8Array([0]),R=new Uint8Array([0,0,0]),Y=new Uint8Array(4);b(h.id,Y,0);h=new Uint8Array([0,0,0,1]);var la=new Uint8Array([0,0,0,0]),Aa=new Uint8Array([0,0,0,0]),Ga=new Uint8Array([0,0,0,0]);K.setData(O,R,Y,h,la,Aa,Ga);return K};$jscomp.inherits(q,x);var y=function(h){var K=x.call(this,f.moof)||this;B.setSequenceNumber(h.sequenceNumber);h=new D(h);K.setData(B.data,h.data);return K};$jscomp.inherits(y,x);W=function(h){var K=x.call(this,
f.mfhd)||this;var O=new Uint8Array([0]),R=new Uint8Array([0,0,0]),Y=new Uint8Array(4);b(h,Y,0);K.setData(O,R,Y);return K};$jscomp.inherits(W,x);W.prototype.setSequenceNumber=function(h){b(h,this.data,12)};var B=new W(1),D=function(h){var K=x.call(this,f.traf)||this;F.setTrackId(h.id);F.setSampleDuration(h.frameDuration);G.setBaseMediaDecodeTime(h.samples[0].timestamp);var O=32+F.data.length+G.data.length;if(h.isAudio)h=new V(h,null,O);else{for(var R=[],Y=0;Y<h.samples.length;Y++){var la=h.samples[Y];
R.push({size:la.unitsLength+4*la.units.length,duration:h.frameDuration||3E3,compositionTimeOffset:0,flags:{isLeading:0,dependsOn:la.hasIDR?2:1,isDependedOn:0,hasRedundancy:0,isNonSync:la.hasIDR?0:1,degradationPriority:0}})}h=new V(h,R,O)}K.setData(F.data,G.data,h.data);return K};$jscomp.inherits(D,x);W=function(h,K){var O=x.call(this,f.tfhd)||this;O.isAudio=K;var R=new Uint8Array([0]),Y=K?new Uint8Array([2,0,10]):new Uint8Array([2,0,40]),la=new Uint8Array(4);b(h,la,0);K?(h=new Uint8Array([0,0,0,1]),
K=new Uint8Array(4),b(1024,K,0),O.setData(R,Y,la,h,K)):(h=new Uint8Array([0,0,2,0,1,1,0,0]),O.setData(R,Y,la,h));return O};$jscomp.inherits(W,x);W.prototype.setTrackId=function(h){b(h,this.data,12)};W.prototype.setSampleDuration=function(h){this.isAudio||b(h,this.data,16)};var F=new W(0,a);W=function(h){var K=x.call(this,f.tfdt)||this;var O=new Uint8Array([0]),R=new Uint8Array([0,0,0]),Y=new Uint8Array(4);b(h,Y,0);K.setData(O,R,Y);return K};$jscomp.inherits(W,x);W.prototype.setBaseMediaDecodeTime=
function(h){b(h,this.data,12)};var G=new W(0),V=function(h,K,O){var R=x.call(this,f.trun)||this;var Y=new Uint8Array([0]),la=h.isAudio?new Uint8Array([0,2,1]):new Uint8Array([0,15,1]),Aa=h.isAudio?4:16;O+=Aa*(h.isAudio?h.samples.length:K.length)+28;var Ga=new Uint8Array(4);h.isAudio?b(h.samples.length,Ga,0):b(K.length,Ga,0);var La=new Uint8Array(4);b(O,La,0);if(h.isAudio){O=new Uint8Array(Aa*h.samples.length);for(var Da=0;Da<h.samples.length;Da++)b(h.samples[Da].aacData.byteLength,O,Aa*Da)}else for(O=
new Uint8Array(Aa*K.length),Da=0;Da<K.length;Da++){h=K[Da];var xa=Aa*Da;b(h.duration,O,xa);b(h.size,O,xa+4);var Pa=h.flags,va=new Uint8Array(4);va[0]=Pa.isLeading<<2|Pa.dependsOn;va[1]=Pa.isDependedOn<<6|Pa.hasRedundancy<<4|0|Pa.isNonSync;va[2]=Pa.degradationPriority&61440;va[3]=Pa.degradationPriority&15;O.set(va,xa+8);b(h.compositionTimeOffset,O,xa+12)}R.setData(Y,la,Ga,La,O);return R};$jscomp.inherits(V,x);W=function(h){var K=x.call(this,f.sdtp)||this;for(var O=new Uint8Array([0]),R=new Uint8Array([0,
0,0]),Y=new Uint8Array(h.length),la=0;la<h.length;la++){var Aa=h[la].flags;Y[la]=Aa.isLeading<<6|Aa.dependsOn<<4|R.isDependedOn<<2|R.hasRedundancy}K.setData(O,R,Y);return K};$jscomp.inherits(W,x);var M=function(h){var K=x.call(this,f.mdat)||this;if(h.isAudio){for(var O=new Uint8Array(h.totalByteLength),R=0,Y=0;Y<h.samples.length;Y++){var la=h.samples[Y].aacData;O.set(la,R);R+=la.byteLength}K.setData(O)}else{O=new Uint8Array(4*h.unitNum+h.totalByteLength);for(Y=R=0;Y<h.samples.length;Y++){la=h.samples[Y];
for(var Aa=0;Aa<la.units.length;Aa++){var Ga=la.units[Aa],La=Ga.data.byteLength;b(La,O,R);R+=4;O.set(Ga.data,R);R+=La}}K.setData(O)}return K};$jscomp.inherits(M,x)}function pc(a){function b(H,N){this.aacData=H;this.timestamp=N}function d(H,N,v,x){this.audioType=H;this.frequencyIdx=N;this.sampleRate=v;this.channelConfig=x}var e=pc.SAMPLING_FREQUENCY,c=null,f=!0,n=this,J=0;this.reset=function(){J=0;c=null;A.audioHeader=null;a&&a.reset()};var A=new function(){this.samples=[];this.duration=0;this.audioHeader=
null;this.height=this.width=0;this.bufferSizeDB=1536;this.totalByteLength=this.bitRate=0;this.clear=function(){this.samples=[];this.totalByteLength=this.bitRate=this.duration=0}};this.setMediaFormat=function(H,N){var v=H.frequencyIdx;v||(v=e.indexOf(H.sampleRate));-1==v&&console.error("Invalid AAC sampel rate: "+H.sampleRate);c=new d(H.audioType||2,v,H.sampleRate,H.channels||H.channelConfig);A.audioHeader=c;f=!N;if(n.oncodec)n.oncodec("mp4a.40.2",c)};this.parseAACData=this.parse=function(H){if(f){var N=
n.readADTSHeader(H);H=H.subarray(N)}N=new b(H,J);J+=1024;A.samples.push(N);A.totalByteLength+=H.byteLength;H=1/(c.sampleRate/1024);A.duration=H;A.samples[0]&&(A.bitRate=8*A.samples[0].aacData.length/H|0);a&&a.remux(A);A.clear()};this.readADTSHeader=function(H){var N=H[1]&0?9:7,v=(H[2]>>6&3)+1,x=H[2]>>2&15,u=e[x];u||console.error("Invalid Sampling Frequency Index: "+x);var r=((H[2]&1)<<2)+(H[3]>>6&3),w=H[1]>>1&3;0!=w&&console.error("Invalid data format: layer is not 0x00: "+w.toString(16));H.length!=
((H[3]&3)<<11)+(H[4]<<3)+(H[5]>>5&7)&&console.error("No enough data in one ADTS frame, length= "+H.length);if(c){if(x!=c.frequencyIdx&&(c.frequencyIdx=x,c.sampleRate=u,n.oncodec))n.oncodec("mp4a.40.2",c)}else if(c=new d(v,x,u,r),A.audioHeader=c,n.oncodec)n.oncodec("mp4a.40.2",c);return N}}function Od(a){function b(){0==J&&console.error("no data available");var N=0,v=n-J;for(A=0;v<n;){var x=a[v];if(3!=x||0!=a[v-1]||0!=a[v-2])A=A<<8|x,N++;v++;if(4<=N)break}4>N&&(A<<=4-N);H=8*N;J=n-v}function d(N){if(!(H>
N)){N-=H;var v=N>>3;N-=v>>3;J-=v;b()}A<<=N;H-=N}function e(N){var v=Math.min(H,N),x=A>>>32-v;32<N&&logger.error("Read more than 32 bits:"+N);H-=v;0<H?A<<=v:0<J&&b();v=N-v;return 0<v?x<<v|e(v):x}function c(){var N;for(N=0;N<H;++N)if(0!==(A&2147483648>>>N))return A<<=N,H-=N,N;b();return N+c()}function f(){d(1+c())}var n=a.byteLength,J=n,A=0,H=0;this.readUEG=function(){var N=c();return e(N+1)-1};this.readEG=function(){var N=this.readUEG();return 1&N?1+N>>>1:-1*(N>>>1)};this.readBool=function(){return 1===
e(1)};this.readU8=function(){return e(8)};this.readU16=function(){return e(16)};this.readU32=function(){return e(32)};this.skipScalingList=function(N){var v=8,x=8,u;for(u=0;u<N;u++)0!==x&&(x=this.readEG(),x=(v+x+256)%256),v=0===x?v:x};this.readSPS=function(){var N=0,v=0,x=0,u=0,r=1,w,t=0,L=!0,z=this.readU8();var E=this.readU8();e(5);d(3);this.readU8();f();if(100===E||110===E||122===E||244===E||44===E||83===E||86===E||118===E||128===E||138===E||139===E||134===E||135===E){var C=this.readUEG();3===C&&
d(1);f();f();d(1);if(this.readBool()){var S=3!==C?8:12;for(w=0;w<S;w++)this.readBool()&&(6>w?this.skipScalingList(16):this.skipScalingList(64))}}f();w=this.readUEG();if(0===w)this.readUEG();else if(1===w)for(d(1),d(1+c()),d(1+c()),S=this.readUEG(),w=0;w<S;w++)d(1+c());f();d(1);w=this.readUEG();S=this.readUEG();var X=e(1);0===X&&d(1);d(1);this.readBool()&&(N=this.readUEG(),v=this.readUEG(),x=this.readUEG(),u=this.readUEG());if(this.readBool()){if(this.readBool()){switch(this.readU8()){case 1:var Q=
[1,1];break;case 2:Q=[12,11];break;case 3:Q=[10,11];break;case 4:Q=[16,11];break;case 5:Q=[40,33];break;case 6:Q=[24,11];break;case 7:Q=[20,11];break;case 8:Q=[32,11];break;case 9:Q=[80,33];break;case 10:Q=[18,11];break;case 11:Q=[15,11];break;case 12:Q=[64,33];break;case 13:Q=[160,99];break;case 14:Q=[4,3];break;case 15:Q=[3,2];break;case 16:Q=[2,1];break;case 255:Q=[this.readU8()<<8|this.readU8(),this.readU8()<<8|this.readU8()]}Q&&(r=Q[0]/Q[1])}this.readBool()&&d(1);this.readBool()&&(d(4),this.readBool()&&
d(24));this.readBool()&&(f(),f());this.readBool()&&(t=this.readU32(),Q=this.readU32(),L=this.readBool(),t=Q/(2*t))}return{width:Math.ceil((16*(w+1)-2*N-2*v)*r),height:(2-X)*(S+1)*16-(X?2:4)*(x+u),configVer:z,profileIdc:E,chromaFormatIdc:C,frameCropLeftOffset:N,frameCropRightOffset:v,frameCropTopOffset:x,frameCropBottomOffset:u,fps:t,fixedFrameRate:L}};this.readSliceType=function(){this.readU8();this.readUEG();return this.readUEG()}}function Pd(a){function b(){this.height=this.width=0;this.codec="";
this.pps=this.sps=null;this.frameDuration=3E3;this.samples=[];this.sequence=this.unitNum=this.totalByteLength=0;this.clear=function(){this.unitNum=this.totalByteLength=this.samples.length=0}}function d(){this.units=J;this.unitsLength=A;this.timestamp=c;this.hasIDR=f}function e(){var x=!1;if(n&&N.sps){var u=new d;c+=N.frameDuration||3E3;N.samples.push(u);N.totalByteLength+=A;N.unitNum+=J.length;N.sequence++;x=!0;if(u.hasIDR&&v.onkeyframe)v.onkeyframe(u)}n=f=!1;J=[];A=0;return x}var c=0,f=!1,n=!1,J=
[],A=0,H=oc.searchStartCode,N=null,v=this;N=new b;this.reset=function(){c=0;f=!1;J=[];A=0;N=new b;a&&a.reset()};this.close=function(){v&&(v.reset(),v=null)};this.parseH264Data=this.parse=function(x){for(var u=[],r=0,w,t,L,z=[0,0];r<x.byteLength;){z[0]=r;H(x,z);var E=z[0];if(-1==E)break;r=z[1];r=E+r;L=x[r];L&=31;w&&(w={type:t,data:x.subarray(w,E)},u.push(w));w=r;t=L}w&&(w={type:t,data:x.subarray(w,x.byteLength)},u.push(w));for(x=0;x<u.length;x++)switch(z=u[x],r=z.type,r){case 1:case 2:case 3:case 4:J.push(z);
A+=z.data.byteLength;n=!0;break;case 5:n=f=!0;J.push(z);A+=z.data.byteLength;break;case 6:break;case 7:w=z.data;r="avc1."+(0==w[1]?"00":w[1].toString(16));r+=0==w[2]?"00":w[2].toString(16);r+=0==w[3]?"00":w[3].toString(16);w=new Od(z.data);w=w.readSPS();N.width=w.width;N.height=w.height;N.codec=r;N.sps=z.data;w.fps&&(N.frameDuration=9E4/w.fps|0);J.push(z);A+=z.data.byteLength;if(v.oncodec)v.oncodec(r,w);break;case 8:N.pps=z.data;J.push(z);A+=z.data.byteLength;break;case 9:e();break;default:console.log("Ignore NAL unit with type = "+
r)}e()&&(a.remux(N),N.clear())}}function Nb(a,b,d){function e(){for(;A;){if(t.updating){A=!1;break}var E=J.shift();if(!E)break;try{t.appendBuffer(E),H=0}catch(C){J.unshift(E);if("QuotaExceededError"==C.name)if(n(!0))continue;else{if(N.onerror)N.onerror(C);else console.log("QuotaExceededError: not recoverable, isAudio: "+d),N.close();break}H++;console.error("Failed to append buffer, retry "+H,C);if(2<H){if(N.onerror)N.onerror(C);break}}}}function c(){A=!0;e()}function f(){t=w.addSourceBuffer(v);t.mode=
"sequence";t.addEventListener("updateend",c);t.addEventListener("error",function(E){console.error(E)});A=!0;N.play(!1);e()}function n(E){var C=Math.min(a.played.end(0),t.buffered.end(0)),S=0,X=r.length,Q=!1,fa=0;if(d)fa=C-180,0>fa&&console.warn("Not possible, time played secs: "+C);else if(1<X){var qa=X-2;for(C=9E4*C|0;S<X;){if(r[S]>C){qa=S-2;break}S++}0<=qa&&(fa=(r[qa]+1E3)/9E4)}if(0<fa)try{t.remove(0,fa),r.splice(0,qa+1),Q=!0,console.info("Buffer removed "+fa+" isAudio: "+d)}catch(ha){console.warn("Buffer removal "+
fa+" failed, retry, isAudio: "+d)}E||(u=setTimeout(n,18E4));return Q}var J=[],A=!1,H=0,N=this,v="",x=null,u=0,r=[],w=null,t=null,L=null,z=null;a.autoplay=!0;this.getKeyFrames=function(){return r};L=new oc(d);L.ondata=function(E){J.push(E);e()};z=d?new pc(L):new Pd(L);z.onkeyframe=function(E){r.push(E.timestamp)};z.oncodec=function(E,C){var S=d?"audio/mp4;codecs=":"video/mp4;codecs=";S+=E;if(S!=v||(d?x.sampleRate!=C.sampleRate:x.width!=C.width||x.height!=C.height))if(v=S,x=C,A=!1,t=null,w=new MediaSource,
w.addEventListener("sourceopen",f),a.src=URL.createObjectURL(w),N.onsps)N.onsps(C)};b.onvideoframe=function(E){z.parse(E)};b.onaudioframe=function(E){z.parse(E)};b.onendofstream=function(){N.reset()};this.play=function(E){a.play().catch(function(C){if(!E&&(console.error(C),N.onplayerror))N.onplayerror(C)})};this.reset=function(){console.log("Reset player");u&&(clearTimeout(u),u=0);r.length=0;A=!1;v="";x=null;z&&z.reset();J.length=0};this.close=function(){N&&(N.reset(),w&&(w.endOfStream(),a.src=null),
z&&z.close(),L&&L.close(),N=null)};this.setMediaFormat=function(E,C){z.setMediaFormat&&z.setMediaFormat(E,C)};this.getMediaSource=function(){return w};this.getMediaSourceBuffer=function(){return t};a.addEventListener("ended",function(E){console.warn(".... ended");u&&(clearTimeout(u),u=0)});a.addEventListener("emptied",function(E){A=!!t});a.addEventListener("pause",function(E){console.warn(".... paused");A=!!t;a.play().catch(function(C){console.error(C)})});a.addEventListener("waiting",function(E){A=
!!t})}this.displayMsg=this.reconnectOnResize=!0;this.appTimeout=1600;this.reconnectTimes=0;this.windowState=3;this.setTitle=this.openLink=!0;this.sessionInfo={domain:"",userName:"",sessionId:0,joinedSessions:[],suppressOutput:!1,appInfo:null,joiners:[]};this.mode=0;this.remoteAppLogin=!0;var Mb=!1,lb={},jb={},Ab=null,m=this,kc=!1,Wa=!1,cb=0,Bb=null,Tc=0;hi5.appcfg||(hi5.appcfg={img:{},toolbar:{fadable:!0},displayMsg:!0});var da=hi5.appcfg,Kb="";this.setConfig=function(a){da=a};var bb="object"==typeof l?
l:null,P=bb?{}:hi5.tool.queryToObj(l.substring(l.indexOf("?")+1));void 0==P.mapClipboard&&da.clipboard&&void 0!=da.clipboard.enabled&&(P.mapClipboard=da.clipboard.enabled);void 0==da.enableDVCAudio&&(da.enableDVCAudio=!0);var Ja=0,Ka=0,fb=(ea||P.color||P.server_bpp||16)|0,mc=null,Uc=null,Qa=null,Jb=null,Vc="/DOWNLOAD?",Wc="/CLIP?";24==fb&&(fb=16);var Va="app"==P.startProgram,Lb=T(P.mapDisk),nb=0;this.setLinks=function(a){a.download&&(Vc=a.download);a.clipboard&&(Wc=a.clipboard)};this.protocol=bb?
"":l.substring(0,l.indexOf("://")).toLowerCase();this.hasSmartCard=function(){return T(P.smartCard)||T(P.mapSmartCard)||T(P.passwordIsPin)};this.enableWebAuthn=function(){return T(P.enableWebAuthn)||T(P.useWebAuthn)};this.hasScanner=function(){return T(P.scanner)};this.hasUSB=function(){return T(P.mapUSB)&&!!navigator.usb};this.getUSB=function(){return P.usb||hi5.appcfg.usb||{filters:[{classCode:0},{classCode:2},{classCode:5},{classCode:6},{classCode:10},{classCode:13},{classCode:239},{classCode:220},
{classCode:239},{classCode:254},{classCode:255}]}};this.setProfiler=function(a){Uc=a};this.getProfiler=function(){return Uc};this.gateway=function(){if(bb)return"";var a=l.lastIndexOf("/RDP?");-1==a&&(a=l.lastIndexOf("/JOIN?"));-1==a&&(a=l.lastIndexOf("/PLAY?"));return l.substring(0,a).replace(/wss:\/\//ig,"https://").replace(/ws:\/\//ig,"http://")}();svGlobal.logger.warn("Ver:"+svGlobal.version+" build:"+svGlobal.build);this.getGatewayAddr=ua;var kb="object"==typeof l||0<l.indexOf("/PLAY?"),Xc=!kb&&
0<l.indexOf("invitation=");if(Xc){var qc=decodeURIComponent(l),Ob=qc.indexOf(' USERNAME="');if(0<Ob){Ob+=11;var Qd=qc.substring(Ob,qc.indexOf('"',Ob));l+="&novice="+Qd}l+="&mapClipboard=on";P.mapClipboard="on";this.reconnectOnResize=!1}if(kb)this.mode=1,bb?l="":(Ja=640,Ka=480),l+="&touchpad=on",P.touchpad="on",this.reconnectOnResize=!1;else if(0<l.indexOf("/JOIN?")||Xc)this.mode=2,this.reconnectOnResize=!1;var rc=T(P.gfx)||T(P.remotefx)||0<m.mode;rc&&(Va?rc=!1:fb=32);I?Ja=parseInt(I):P.width&&(Ja=
parseInt(P.width));U?Ka=parseInt(U):P.height&&(Ka=parseInt(P.height));-1==Ja&&(Ja=hi5.browser.getScreenWidth());-1==Ka&&(Ka=hi5.browser.getScreenHeight());P.symlink&&P.parameters&&hi5.tool.queryToObj(P.parameters,P);P.gateway||(l+="&gateway="+encodeURIComponent(m.gateway));!P.minWidth&&da.minWidth&&(P.minWidth=da.minWidth);!P.minHeight&&da.minHeight&&(P.minHeight=da.minHeight);P.minWidth&&(P.minWidth=parseInt(P.minWidth));P.minHeight&&(P.minHeight=parseInt(P.minHeight));P.waWidth=P.waWidth?parseInt(P.waWidth):
hi5.browser.isAndroid||hi5.browser.isiOS?Math.max(screen.width,screen.height):screen.width;P.waWidth&=-4;P.waHeight=P.waHeight?parseInt(P.waHeight):hi5.browser.isAndroid||hi5.browser.isiOS?Math.max(screen.width,screen.height):screen.height;P.waHeight&=-4;"useSSL"in P||(l+="&useSSL="+("wss"==m.protocol));hi5.storage.isAvailable&&(T(P.shareClipboard)||P.shareClipboardId)&&(l+="&shareClipboardId="+(P.shareClipboardId||Z()));da&&(void 0!=da.displayMsg?this.displayMsg=da.displayMsg:da.displayMsg=this.displayMsg,
da.appTimeout&&(this.appTimeout=da.appTimeout),void 0!=da.reconnectOnResize&&(this.reconnectOnResize=da.reconnectOnResize),da.reconnectTimes&&(this.reconnectTimes=da.reconnectTimes),void 0!=da.windowState&&(this.windowState=da.windowState),void 0!=da.openLink&&(this.openLink=da.openLink),void 0!=da.setTitle&&(this.setTitle=da.setTitle),"boolean"==typeof da.useWSS&&(l=(da.useWSS?"wss":"ws")+l.substring(l.indexOf("://"))),"boolean"==typeof da.remoteAppLogin&&(this.remoteAppLogin=da.remoteAppLogin,Mb=
!da.remoteAppLogin,svGlobal.logger.warn("remoteAppLogin deprecated, use hideLogin in appcfg.js instead")),"boolean"==typeof da.hideLogin&&(Mb=da.hideLogin),void 0!=da.localPrinter&&void 0==P.localPrinter&&(P.localPrinter=da.localPrinter));var Na=null;void 0==da.useWorker&&(da.useWorker=!1);da.useWorker&&(!window.Worker||hi5.browser.isFirefox||Va&&!hi5.browser.isIE||"file:"==location.protocol||0<navigator.userAgent.indexOf("MSIE 10."))&&(da.useWorker=!1);void 0==hi5.libMin&&(hi5.libMin=!0);var Ma=
da.useWorker?new Worker(pa("rdpworker",hi5.libMin?"rdpworker_min.js":"rdpworker.js")):null,ub=this.reconnectTimes,Zb=Ma?{type:5,data:null}:null;this.getDisplayName=aa;this.server=aa();this.port=parseInt(P.port,10);this.loadbalanceToken="";da.loadbalanceTokenName&&(P[da.loadbalanceTokenName]?ca(P[da.loadbalanceTokenName]):!1!==da.randomAppId?ca(hi5.tool.uuid()):svGlobal.logger.info("Using app.id as loadbalanceToken"));this.modifyURL=function(a){m.loadbalanceToken&&(a+=-1==a.indexOf("?")?"?"+m.loadbalanceToken:
"&"+m.loadbalanceToken,a+="&loadbalanceTokenName="+da.loadbalanceTokenName);return a};this.getURL=function(){return l};this.getRuntimeURL=function(){var a=l+"&width="+Ja+"&height="+Ka+"&server_bpp="+fb+"&audio="+(Ta.available||hi5.browser.isIE),b=Dc(),d="";b&&(d=sessionStorage[b]||"")&&(d="&preSymJoin="+d);a+=d;var e=P.monitorDef,c=P.monitor,f=0;b=ba.size();var n=Array(b);d=Array(b);var J=0,A=0,H=0,N=0,v=0,x=0,u="";if(e){d=ma.parseMonitorDef(e);for(b=d.length;f<b;f++){var r=d[f];r[0]<H&&(H=r[0]);
r[1]<N&&(N=r[1]);r[2]>v&&(v=r[2]);r[3]>x&&(x=r[3])}0>H&&(J=-H);0>N&&(A=-N);r=0>c?[H,N,v,x]:d[c];P.width=r[2]-r[0]+1;P.height=r[3]-r[1]+1;f=ba.getSurface(0);f.setMonitor(r[0],r[1],r[2],r[3]);if(J||A)for(r=f.getMousePosition(),r.left+=J,r.right+=J,r.top+=A,r.bottom+=A,f=0;f<b;f++)r=d[f],r[0]+=J,r[1]+=A,r[2]+=J,r[3]+=A;ma.setMonitorLayout(d);0>c&&ma.setMonitorCount(0);m.reconnectOnResize=!1;b="&monitorDef="+e+"&width="+P.width+"&height="+P.height}else{if(1<b&&!Va){for(ba.verifyMonitors();f<b;f++)e=ba.getSurface(f),
r=e.getMousePosition(),r.left<H&&(H=r.left),r.top<N&&(N=r.top),r.right>v&&(v=r.right),r.bottom>x&&(x=r.bottom),n[f]=r,u&&(u+=","),u+=r.left+":"+r.top+":"+r.right+":"+r.bottom;0>H&&(J=-H);0>N&&(A=-N);for(f=0;f<b;f++){r=ba.getSurface(f).getMousePosition();if(J||A)r.left+=J,r.right+=J,r.top+=A,r.bottom+=A;d[f]=[r.left,r.top,r.right,r.bottom,r.left==J&&r.top==A?1:0]}ma.setMonitorLayout(d);m.reconnectOnResize=!1}u&&(svGlobal.logger.warn("MonitorDef:"+u),P.width=v-H+1,P.height=x-N+1,u="&monitorDef="+u+
"&width="+P.width+"&height="+P.height);b=u}a+=b;0>l.indexOf("waWidth")&&(b=(b=ba.getFocused())?b.getWindow():window,a+="&waWidth="+P.waWidth+"&waHeight="+P.waHeight+"&dpWidth="+b.innerWidth+"&dpHeight="+b.innerHeight);b=new Date;P.tzOffset||(a+="&tzOffset="+b.getTimezoneOffset());P.timezone||(d=hi5.timezone.getTimeZone())&&(a+="&timezone="+encodeURIComponent(d.standardName));a+="&time="+b.getTime();void 0==P.soundPref&&(P.soundPref=0,a+="&soundPref=0");J=d=b="";for(J in lb)A=lb[J],"flags"in A&&(b&&
(b+=",",d+=","),b+=A.name,d+=A.flags);b&&(a=a+("&channelName="+b)+("&channelFlags="+d));b="";for(J in jb)A=jb[J],"flags"in A&&(b&&(b+=","),b+=A.name);b&&(a+="&gwChannelName="+b);if(d=wd())b=d.account,d=d.session,b&&(a+="&account="+b),d&&(a+="&session="+d);b=hi5.browser.isTouch&&(1024<=window.innerWidth||768<=window.innerHeight);P.audioRecord=T(P.audioRecord)&&hi5.audio.recordable;Fa.init(b,rc,P.audioRecord,P.soundPref,T(P.mapCamera)&&!!navigator.mediaDevices,T(P.mapUSB)&&!!navigator.usb);P.audioRecord&&
(a+="&audioRecord=on");P.decompressingRDP61&&(a+="&decompressingRDP61=on");0<Fa.count&&(a+="&dvcChannels="+Fa.names.join(","));a+="&binary=on";da.existingFile&&(a+="&existingFile="+da.existingFile);a+="&isTouch="+b+"&gatewayAddr="+encodeURIComponent(ua());a=m.modifyURL(a);da.copyTextOnly&&T(P.mapClipboard)&&(a+="&copyTextOnly=on");(b=hi5.browser.cookie.get("__SV_TOKEN_A"))&&(a+="&__SV_TOKEN_A="+encodeURIComponent(b));(b=svGlobal.Rdp.languageToKeyboard.detect())&&(a+="&_keyboard="+b);T(P.textPrinter)&&
(a+="&printerDriver="+encodeURIComponent("Generic / Text Only"));return a+=Fd()};this.getColor=function(){return fb};this.changeTitle=ia;hi5.browser.isTouch&&Math.max(Ja,Ka)>Math.max(window.innerWidth,window.innerHeight)&&(this.reconnectOnResize=!1);this.isRemoteApp=function(){return Va};var Ba=null,Ia=!1,qb=!1,nc=!1,Ta=new function(){function a(J){console.error("play error: ",J);m.showMessage({msg:"Please click Yes to continue.<br>"+J,cbYes:function(){n.play(!0);this.destroy()}})}var b=null;this.supportWebAudio=
this.available=!1;(0==P.playSound||0<m.mode)&&(b=hi5.audio.getAudioContext())&&hi5.audio.playable&&(this.supportWebAudio=this.available=!0);this.getContext=function(){return b};this.getBuffer=function(J){return b.createBuffer(2,J,Ca.samplePerSec)};var d=0,e=null,c=null;this.setVolume=function(J){1==J?e=null:(e||(e=b.createGain()),e.gain.value=J)};this.playBuffer=function(J){c=b.createBufferSource();c.buffer=J;e?(c.connect(e),e.connect(b.destination)):c.connect(b.destination);var A=b.currentTime,H=
0<d?d:A;H<A&&(H=A);d=H+J.duration;c.start?c.start(H):c.noteOn(H);return d-A};this.iOSFix=function(){if(b&&hi5.browser.isSafari){var J=this.getBuffer(1024),A=b.createBufferSource();A.buffer=J;A.connect(b.destination);A.start?A.start(0):A.noteOn(0)}};this.close=function(){b&&(e&&e.disconnect(),c&&c.disconnect(),hi5.audio.releaseAudioContext())};var f=null,n=null;this.onaudioframe=null;this.initMediaPlayer=function(J,A,H){f||(f=document.createElement("audio"));n||(n=new Nb(f,J,!0),n.onplayerror=a,n.onerror=
function(N){console.error("Not possible audio error",N)},svGlobal.logger.info("MediaPlayer init, headerless: "+H+" sampleRate:"+A.sampleRate));n.setMediaFormat(A,H);n.play(!1)}},Ld=Ta.available,ma=new xc(200,200);ma.onSetCursor=Ic;this.setVolume=function(a){Ta&&Ta.setVolume(a)};this.setAudioBuffer=function(a){};var Wb=0,Vb=0,Xb=Ja-1,Yb=Ka-1,lc="";window.$rdp||(window.$rdp=this);za(fb);this.setResolution=Oa;this.running=function(){return Ia};this.setJoinMode=function(a){Ia&&ta("8E1"+a)};this.setJoinCloseMode=
function(a){Ia&&ta("8EB3\t"+a)};this.refuseControl=function(a){Ia&&ta("8E3"+a)};this.giveControl=function(a){Ia&&ta("8E4"+a)};this.pauseSession=function(a,b){Ia&&ta("8EB"+(b?1:0)+"\t"+a)};this.closeSession=function(a){Ia&&ta("8EB2\t"+a)};this.requestControl=function(){Ia&&ta("8E2")};this.saveSession=function(a){Ia&&ta("8E9"+(a.save?1:0)+"\t"+(a.timeout||0)+"\t"+(a.id||0))};this.allowJoin=function(a,b){Ia&&ta("8EA"+a+"\t"+(b?1:0))};var Cb=new function(){function a(){if(d&&0<d.length){var f=d.shift();
f.key?Cb.sendSingleKey(f.down,f.key):f.char&&sb(f.char);0<d.length?setTimeout(a,e):(d=null,c&&c())}}var b={" ":57,space:57,pgup:201,pageup:201,pgdn:209,pagedown:209,end:207,home:199,left:203,up:200,right:205,down:208,printscreen:183,insert:210,del:211,"delete":211,altgr:184,windows:219,windowsright:220,context:221,esc:1,backspace:14,back:14,tab:15,enter:28,meta:29,command:29,ctrl:29,shift:42,alt:56,capslock:58,f1:59,f2:60,f3:61,f4:62,f5:63,f6:64,f7:65,f8:66,f9:67,f10:68,f11:87,f12:88,numlock:69,scrolllock:70,
add:78};this.sendSingleKey=function(f,n){var J=b[n.toLowerCase()];J?m.writeScancode(f,J):(J=n.length,0!=J&&(1==J?m.writeKeyCode(f,n.toUpperCase().charCodeAt(0)):f&&m.writeText(n)))};var d=null,e=0,c=null;this.sendKeyComb=function(f,n,J){if(Wa){f=f.split("+");var A=f.length,H;if(0!=A){var N=null,v=[];for(H=0;H<A;H++){var x=f[H];""==x&&""==N&&(x="Add");""!=x&&v.push({key:x,down:!0});N=x}A=v.length;for(H=A-1;0<=H;H--)v.push({key:v[H].key,down:!1});if(n)d=v,e=n,c=J,a();else for(H=0,A=v.length;H<A;H++)Cb.sendSingleKey(v[H].down,
v[H].key)}}};this.sendText=function(f,n,J){for(var A=[],H=0,N=f.length;H<N;H++)A.push({"char":f.charAt(H)});d=A;e=n;c=J;a()}};this.writeKeyComb=function(a,b,d){Wa&&Cb.sendKeyComb(a,b,d)};this.writeText=function(a,b,d){if(Wa)if(b)Cb.sendText(a,b,d);else for(b=0,d=a.length;b<d;b++)sb(a.charAt(b))};this.writeClipboard=function(a,b){a&&(b||(b="text/plain"),m.writeRawInput("880"+b+"\t"+a.hashCode()),Bb={type:b,text:a})};var ba=new function(a,b){function d(){function c(v){for(;0<v.ownerWinid;){var x=H.getWinById(v.ownerWinid);
if(x&&x.isVisible())v=x;else break}return v}function f(v){for(var x="";v;)v.titleInfo&&(x=v.titleInfo),v=H.getWinById(v.ownerWinid);return x}var n=[],J=[],A=0,H=this;this.mainWin=null;this.appId="";var N=0;this.getActiveWinId=function(){return N};this.setActiveWinId=function(v,x){svGlobal.logger.info("setActiveWinId: "+v+" old: "+N+" max: "+x);if(N!=v){var u=0==N;N=v;(v=H.getMainByWinId(v))&&v.isMainWin()&&H.mainWin!=v&&(H.mainWin=v);u&&x&&(x=ba.getFocused())&&(x=x.getFreeSpace(),v=x.width,m.resetSize(v,
x.height))}};this.onchange=function(v){v.isVisible()||v!=H.mainWin?v.isVisible()&&!H.mainWin&&v.isMainWin()&&(H.mainWin=v,3==a.windowState&&v.exeCommand(61488)):H.mainWin=null};this.addWin=function(v){for(var x=n.length,u=!1,r=0;r<x;r++)if(v.id==n[r].id){n[r]=v;u=!0;break}u||n.push(v);1==n.length&&(A=Date.now());x=v.isMainWin();svGlobal.logger.info("is mainwin:"+x+" id:"+v.id);x&&!H.mainWin&&(H.mainWin=v)};this.popWins=function(v){v=H.getWinById(v);var x=[];if(v){v=0<v.ownerWinid?v.ownerWinid:v.id;
for(var u=n.length-1;0<=u;u--)if(n[u].ownerWinid==v||n[u].id==v)x.push(n[u]),n.splice(u,1)}return x};this.hasApp=function(v){return-1!=J.indexOf(v)};this.addApp=function(v){return-1==J.indexOf(v)?(J.push(v),!0):!1};this.isNew=function(){return 3E4>Date.now()-A};this.getAll=function(){return n};this.hasWin=function(v){return 0<=n.indexOf(v)};this.close=function(){for(var v=0,x=n.length;v<x;v++)n[v].close()};this.clear=function(){n.length=0};this.delWin=function(v){for(var x=0,u=n.length;x<u;x++)if(n[x].id==
v)return n.splice(x,1),x;return-1};this.isRunning=function(){var v=n.length;if(1>v)return!1;var x=0;for(v=n.length;x<v;x++){var u=n[x];if(u.showState)return!0}return!1};this.getWinById=function(v){var x=n.length;if(1>x)return null;for(var u=0;u<x;u++){var r=n[u];if(r.id==v)return r}return null};this.getMainWinByAppId=function(v){var x=null,u=0;for(len=n.length;u<len;){x=n[u];if(x.appId==v&&x.isVisible()&&1>x.ownerWinid)break;u++}return x};this.getTopWin=function(v){var x=null,u,r=v.length;for(u=0;u<
r&&(!(x=H.getWinById(v[u]))||!x.isVisible());u++)x=null;if(!x)for(svGlobal.logger.warn("No win found"),r=n.length,u=r-1;0<=u&&(x=n[u],!x.isVisible());u--)x=null;return x};this.getMain=function(v){return(v=H.getTopWin(v))?c(v):null};this.getMainByWinId=function(v){return(v=H.getWinById(v))?c(v):null};this.getOtherApps=function(v,x,u){var r=n.length;if(0!=r&&n[r-1])if(r=n[r-1].appId,u||!r)setTimeout(function(){H.getOtherApps(v,x)},u||3E3);else{u=[];if(r=H.getTopWin(v)){var w=0<r.ownerWinid?r.ownerWinid:
r.id,t=[],L=0;for(r=n.length;L<r;L++)n[L].ownerWinid!=w&&n[L].id!=w&&n[L].isVisible()&&t.push(n[L]);L=0;for(r=t.length;L<r;L++)t[L].ownerWinid!=w&&t[L].id!=w&&(u.push({title:f(t[L]),win:c(t[L])}),w=0<t[L].ownerWinid?t[L].ownerWinid:t[L].id)}x(u)}};this.getFullTitle=function(v){for(var x,u="";;){x=H.getWinById(v);if(!x)break;x.titleInfo&&x.isVisible()&&(u&&(u=" > "+u),u=x.titleInfo+u);if(1>v)break;v=x.ownerWinid}return u}}var e=[];this.tryCloseRemoteApps=function(){if(a&&a.isRemoteApp())for(var c=
e.length,f=0;f<c;f++)e[f].railWin&&e[f].railWin.close()};this.verifyMonitors=function(){for(var c=e.length,f=Array(c),n=0;n<c;n++)e[n].configMonitor(),f[n]=e[n].getMousePosition();f.sort(function(H,N){var v=H.left-N.left;return 0!=v?v:H.top-N.top});var J=f.findIndex(function(H){return 0==H.left&&0==H.top});svGlobal.logger.info("monitor layout",f,J);-1==J&&(m.showMessage("* Primary monitor not found. Please make your browser window full screen."),svGlobal.logger.warn("Primary monitor not found (left=top=0)",
f));for(n=J-1;0<=n;){if(f[n].right<f[n+1].left){var A=f[n+1].left-f[n].right-1;0<A&&(f[n].right+=A,f[n].left+=A)}f[n].bottom<f[n+1].top&&(A=f[n+1].top-f[n].bottom-1,0<A&&(f[n].top+=A,f[n].bottom+=A));n--}for(n=J+1;n<c;)f[n-1].right<f[n].left&&(A=f[n].left-f[n-1].right-1,0<A&&(f[n].right-=A,f[n].left-=A)),f[n-1].bottom<f[n].top&&(A=f[n].top-f[n-1].bottom-1,0<A&&(f[n].top-=A,f[n].bottom-=A)),n++};this.repaint=function(c,f,n,J){for(var A=0,H=e.length;A<H;A++)e[A].repaint(c,f,n,J)};this.size=function(){return e.length};
this.getSurface=function(c){return e[c]};this.addSurface=function(c){e.push(c)};this.hasSurface=function(c){for(var f=e.length,n=0;n<f;n++)if(e[n].equals(c))return!0;return!1};this.getMonitorSurface=function(c,f,n,J){var A=e.length;if(1==A)return e[0];for(var H=0;H<A;H++)if(e[H].isMonitor(c,f,n,J))return e[H];return null};this.fromSyncedSurface=function(c){var f=e.length;Date.now();for(var n=0;n<f;n++)if(e[n].isClipSynced(c))return!0;return!1};this.setSize=function(c,f,n){for(var J=0,A=e.length;J<
A;J++)e[J].setSize(c,f,n)};this.zOrders=[];this.drawLicense=function(c){for(var f=0,n=e.length;f<n;f++)e[f].drawLicense(c)};this.setReadOnly=function(c,f){for(var n=0,J=e.length;n<J;n++)e[n].setReadOnly(c,f)};this.setVisible=function(c,f){svGlobal.logger.info("TODO: setVisible")};this.setCursor=function(c){for(var f=0,n=e.length;f<n;f++)e[f]&&e[f].setCursor(c)};this.hide=function(c){c=0;for(var f=e.length;c<f;c++)e[c]&&e[c].hide()};this.execute=function(c,f){for(var n=0,J=e.length;n<J;n++)e[n][c].apply(e[n],
f)};this.addWin=function(c){var f=this.getFocused();f||(svGlobal.logger.warn("Focused surface not found!"),f=e[e.length-1]);f?(Va=!0,f.railWin||(f.railWin=new d,f.onunload=function(){hi5.appcfg.closeRemoteApp&&f.railWin&&f.railWin.close();f.remoteApp&&f.remoteApp.close();f.railWin&&(f.railWin.clear(),f.railWin=null);e.removeElm(f)}),f.context&&b.setContext(f.context),f.railWin.addWin(c),f.railWin.mainWin==c&&(setTimeout(function(){var n=f.getFreeSpace();a.writeRawInput("8C661441\t"+n.width+"\t"+n.height);
svGlobal.logger.info("-- main win dp change:"+n.height);3==a.windowState?c.resizable()&&setTimeout(function(){c.exeCommand(61488);svGlobal.logger.info("-- max")},50):5==a.windowState&&3==c.showState&&setTimeout(function(){c.exeCommand(3856);svGlobal.logger.info("-- restor")},50)},111),Ra.sendKeyboardSyncFlags(Ra.localLockFlags,500)),hi5.browser.isIE&&f.focus()):svGlobal.logger.warn("No surface available!")};this.delWin=function(c){for(var f,n=e.length-1;0<=n;n--){var J=e[n];f=J.railWin;var A=f.getWinById(c),
H=A&&A.appId&&-1!=A.appId.toLowerCase().indexOf("runonce");if(0<=f.delWin(c)){A==f.mainWin&&(f.mainWin=null);if(J.toolbar){c="win"+c;var N=J.toolbar.querySelector("#"+c);N&&J.toolbar.removeChild(N)}if(!f.isRunning()&&0==m.mode){if(A.isMainWin()&&J.onremoteappclose)J.onremoteappclose(A);A=a.appTimeout;if(H||f.isNew())A*=10;svGlobal.logger.debug("Prepare del:"+Date.now());setTimeout(function(v){return function(){svGlobal.logger.info("Start del:"+Date.now());v.railWin&&v.railWin.isRunning()||(v.remoteApp&&
v.remoteApp.close(),ba&&ba.delSurface(v))}}(J),A)}}}};this.popWins=function(c){return e[0]&&e[0].railWin?e[0].railWin.popWins(c):[]};this.getWinById=function(c){for(var f,n=0,J=e.length;n<J;n++)if(e[n]&&e[n].railWin&&(f=e[n].railWin.getWinById(c)))return f;return null};this.getMainWinByAppId=function(c){for(var f,n=0,J=e.length;n<J;n++)if(e[n].railWin&&(f=e[n].railWin.getMainWinByAppId(c)))return f;return null};this.onWinChange=function(c){for(var f,n=0,J=e.length;n<J;n++)if(e[n].railWin&&(f=e[n].railWin.getWinById(c.id)))e[n].railWin.onchange(c)};
this.setTitle=function(c){for(var f,n=0,J=e.length;n<J;n++)if(e[n].railWin){f=e[n].railWin.getWinById(c);var A=e[n].railWin.getFullTitle(c);if(A){a.changeTitle(A,e[n].getWindow(),f.appId);break}}};this.hasApp=function(c){for(var f=0,n=e.length;f<n;f++)if(e[f].railWin.hasApp(c))return!0;return!1};this.delSurface=function(c){!c||c.railWin&&c.railWin.isRunning()||(svGlobal.logger.info("delete surface..."),e.removeElm(c),c.close(),0==e.length&&a._unload())};this.getOwnerSurface=function(c){for(var f=
0,n=e.length;f<n;f++)if(e[f].railWin&&e[f].railWin.hasWin(c))return e[f];return null};this.getOwnerSurfaceById=function(c){for(var f,n=0,J=e.length;n<J;n++)if(e[n].railWin&&(f=e[n].railWin.getWinById(c)))return e[n];return null};this.getFocused=function(){for(var c=e.length,f=0;f<c;f++)if(e[f].focused)return e[f];return e[c-1]};this.close=function(){for(var c=0,f=e.length;c<f;c++)e[c]&&(e[c].remoteApp&&e[c].remoteApp.close(),e[c].close(),e[c]=null)};this.LocalWin=function(c){function f(){a.writeRawInput("8C0"+
c)}this.id=c;this.appId="";var n=this;this.resizable=function(){return n.isVisible?0!=(n.style&262144)||0!=(n.style&65536)||0!=(n.style&16777216)||3==n.showState:!1};this.setShowState=function(J){n.showState=J};this.parent=function(){return ba.getWinById(n.ownerWinid)};this.resize=function(J,A,H,N){svGlobal.logger.info("www resize, l "+J+" w "+H);hi5.appcfg.disableJoinedAppResize&&2==a.mode||a.writeRawInput("8C1"+n.id+"\t"+J+"\t"+A+"\t"+H+"\t"+N)};this.exeCommand=function(J){svGlobal.logger.info("www exeCommand, cmd "+
J);a.writeRawInput("8C4"+c+"\t"+J)};this.activate=function(J){svGlobal.logger.info("www activate, enable "+J+" id:"+c);2==n.showState?(n.exeCommand(61728),setTimeout(function(){a.writeRawInput("8C3"+c+"\t"+J)},50)):a.writeRawInput("8C3"+c+"\t"+J)};this.close=function(){svGlobal.logger.info("www close");n.exeCommand(61536)};this.getAppId=f;this.isVisible=function(){return n.winWidth&&n.winHeight&&n.showState&&45<n.winHeight&&45<n.winWidth};this.isMainWin=function(){if(!(n.isVisible()&&n.winWidth&&
n.winHeight&&45<n.winHeight&&45<n.winWidth))return!1;var J=1>n.ownerWinid;if(!J)return J;var A=n.style;if(0!=(A&4194304))return!0;if(0!=(A&2147483648)&&(0==(A&8388608)||0==(A&12582912)))return!1;var H=0!=(n.extStyle&128);(J=J&&!H)&&0!=(A&2147483648)&&0==(A&2156396544)&&(J=!1);return J};f()}}(m,ma);this.getSurfaces=function(){return ba};this.hide=function(){ba&&ba.hide()};this.getFileUrl=function(a,b,d){var e=ua(),c=Vc,f=c.indexOf("://");e=(0<f&&11>f?c:e+c)+"s="+lc+"&f="+encodeURIComponent(a);b&&(e+=
"&src="+b);d&&(e+="&action="+d);return m.modifyURL(e)};this.listFiles=function(a,b){Na&&Wa&&Na.list(a,b)};this.writeRawInput=function(a){if(Wa){ta(a);if(m.onactivity)m.onactivity(a);return!0}return!1};this.authWithCode=function(a,b){var d=a.length,e=new Uint8Array(5+d);e[0]=146;e[1]=7;e[2]=b;e[3]=d&255;e[4]=d>>8&255;for(b=0;b<d;b++)e[5+b]=a.charCodeAt(b);ta(e.buffer)};var Yc=0;if(da.numLock||da.numlock||T(P.numLock)||hi5.browser.isMacOS||hi5.browser.isiOS||hi5.browser.isCrOS)Yc|=2;var Ra=new function(a,
b){this.setJoinMode=a.setJoinMode;this.requestControl=a.requestControl;this.writeKeyComb=a.writeKeyComb;this.writeText=a.writeText;this.localLockFlags=b||0;this.remoteLockFlags=0;this.checkLockFlags=!0;this.reqCopyTime=0;a.isRemoteApp();var d=void 0,e=a.getSurfaces();this.saveResize=function(c){d=a.reconnectOnResize;a.reconnectOnResize=c};this.restoreResize=function(){void 0!=d&&(a.reconnectOnResize=d)};this.getAppMode=function(){return a.mode};this.getAgentStatus=function(){return a.getAgentStatus()};
this.send=a.writeRawInput;this.saveSession=function(c){a.saveSession(c)};this.sendInput=a.writeRawInput;this.getAppInfo=function(){return a.sessionInfo.appInfo};this.resumeAudio=function(){Ta.supportWebAudio&&Ta.iOSFix()};this.onresize=function(c){if((c=c.target.svSurface)&&!document.hidden){var f=c.getFreeSpace(),n=f.width;f=f.height;Ra.checkLockFlags=!0;da.scale?c.scaleTo(n,f,!1):a.resetSize(n,f)}};this.onorientationchange=function(c){a.resetSize(c.innerWidth,c.innerHeight)};this.getClipData=function(c,
f){this.reqCopyTime=Date.now();var n=a.getGatewayAddr(),J=Wc,A=J.indexOf("://");n=(0<A&&11>A?J:n+J)+"s="+a.sessionInfo.appInfo.session+"&t="+Date.now()+"&type="+c;c=hi5.httpGet(a.modifyURL(n),f);this.reqCopyTime=Date.now();Qc(c);return c};this.getShareFiles=a.listFiles;this.getFile=function(c,f,n){a.reconnectOnResize=!1;var J=a.getFileUrl(c,f,n);m.ondownload&&m.ondownload({fileName:c,url:J,source:f,action:n})||window.open(J)};this.getFileLink=a.getFileUrl;this.getGateway=function(){return l};this.reconnect=
function(c,f,n){P.symlink?(c="user="+c+"&pwd="+f,n&&(c+="&domain="+n),l=hi5.tool.replaceQuery(l,"parameters",c)):(l=hi5.tool.replaceQuery(l,"user",c),l=hi5.tool.replaceQuery(l,"pwd",f),l=hi5.tool.replaceQuery(l,"domain",n));a.run()};this.sendKeyboardSyncFlags=function(c,f){return Wa?(this.remoteLockFlags=this.localLockFlags=c,setTimeout(function(){a.writeRawInput("8E5"+c)},f||333),!0):!1};this.sendKeyboardSynchronize=function(c,f,n){var J=0;n&&(J|=4);f&&(J|=2);c&&(J|=1);this.sendKeyboardSyncFlags(J)};
this.fromSyncedSurface=function(c){return e.fromSyncedSurface(c)};this.setWorkDir=function(c){a.writeKeyComb("Windows+R",20,function(){setTimeout(function(){a.writeText(c,10,function(){a.writeScancode(!0,28);a.writeScancode(!1,28)})},666)})};this.authWithCode=function(c,f){a.authWithCode(c,f)};this.getPrinters=function(c){a.getPrinters(c)};this.attachPrinter=function(c){a.attachPrinter(c)}}(m,Yc),Rd=new function(a,b){this.draw=a.draw;this.refresh=function(d,e,c,f){return a.repaint(d,e,c-d+1,f-e+1)};
this.onfocus=function(d){var e=b.getFocused();Va&&e&&e.railWin&&(d=e.railWin.mainWin)&&_core.running()&&(e=e.context)&&e!=a.getContext()&&(a.setContext(null),d.activate(1),svGlobal.logger.info("Activate win:"+d.id))}}(ma,ba);this.sendKeyboardSynchronize=function(a,b,d){Ra.sendKeyboardSynchronize(a,b,d)};this.VirtualChannel=function(){return new pb(143)};this.GatewayChannel=function(){return new pb(28)};this.DynamicChannel=function(){return new pb(64)};this.addChannel=function(a){lb[a.name]=a};this.addGatewayChannel=
function(a){jb[a.name]=a};this.addDynamicChannel=function(a){Fa.names.push(a.name);Fa[a.name]=a;Fa.count++};var Sa=null,Fa={count:0,names:[],usbChannel:null,close:function(){for(var a=Fa.names,b=0,d=a.length;b<d;b++)Fa[a[b]].onclose&&(Fa[a[b]].onclose(),Fa[a[b]]=null);a.length=0;Fa.usbChannel=null},init:function(a,b,d,e,c,f){function n(){this.WAVE_FORMAT_PCM=1;this.WAVE_FORMAT_ADPCM=2;this.WAVE_FORMAT_ALAW=6;this.WAVE_FORMAT_MULAW=7;this.WAVE_FORMAT_GSM=49;this.WAVE_FORMAT_MPEGLAYER3=85;this.WAVE_FORMAT_AAC=
41222;this.cbSize=this.bitsPerSample=this.nBlockAlign=this.nAvgBytesPerSec=this.nSamplesPerSec=this.nChannels=this.formatTag=0;this.extenstion=null;var u=this;this.fromBuffer=function(r,w){u.formatTag=r.getLittleEndian16();u.nChannels=r.getLittleEndian16();u.nSamplesPerSec=r.getLittleEndian32();u.nAvgBytesPerSec=r.getLittleEndian32();u.nBlockAlign=r.getLittleEndian16();u.bitsPerSample=r.getLittleEndian16();var t=r.getLittleEndian16();u.cbSize=t;0<t&&!0!==w&&(u.extenstion=Array(t),r.copyToByteArray(u.extenstion,
0,r.getPosition(),t),r.skipPosition(t))};this.toBuffer=function(r){r.setLittleEndian16(u.formatTag);r.setLittleEndian16(u.nChannels);r.setLittleEndian32(u.nSamplesPerSec);r.setLittleEndian32(u.nAvgBytesPerSec);r.setLittleEndian16(u.nBlockAlign);r.setLittleEndian16(u.bitsPerSample);r.setLittleEndian16(u.cbSize);0<u.cbSize&&r.setBytes(u.extenstion)};this.getSize=function(){return 18+u.cbSize};this.toString=function(){return"Audio Format, tag="+u.formatTag+" nChannels="+u.nChannels+" nSamplesPerSec="+
u.nSamplesPerSec+" nAvgBytesPerSec="+u.nAvgBytesPerSec+" nBlockAlign="+u.nBlockAlign+" bitsPerSample="+u.bitsPerSample+" cbSize="+u.cbSize}}function J(){Sa=new m.DynamicChannel;Sa.name="Microsoft::Windows::RDS::DisplayControl";Sa.enabled=!1;Sa.process=function(u){var r=u.getLittleEndian32();u.getLittleEndian32();switch(r){case 5:r=u.getLittleEndian32(),Sa.maxMonitorAreaFactorA=u.getLittleEndian32(),Sa.maxMonitorAreaFactorB=u.getLittleEndian32(),Sa.enabled=!0,svGlobal.logger.warn("Display control maxNumMonitors:"+
r+" factorA:"+Sa.maxMonitorAreaFactorA+" factorB:"+Sa.maxMonitorAreaFactorB),u=new Uint8Array(2),u[0]=146,u[1]=4,ta(u.buffer),Qa&&setTimeout(function(){Qa&&Qa.check(5E3)},1900)}};Sa.applyResolution=function(u,r){if(Sa.enabled){var w=new Uint8Array(56),t=new RdpBuffer(w,0,56);u=u>Sa.maxMonitorAreaFactorA?Sa.maxMonitorAreaFactorA:u&-4;r=r>Sa.maxMonitorAreaFactorB?Sa.maxMonitorAreaFactorB:r&-4;t.setLittleEndian32(2);t.setLittleEndian32(56);t.setLittleEndian32(40);t.setLittleEndian32(1);t.setLittleEndian32(1);
t.setLittleEndian32(0);t.setLittleEndian32(0);t.setLittleEndian32(u);t.setLittleEndian32(r);t.setLittleEndian32(.26458*u|0);t.setLittleEndian32(.26458*r|0);t.setLittleEndian32(u>r?0:90);t.setLittleEndian32(100);t.setLittleEndian32(100);Sa.send(w);svGlobal.logger.warn("Display control: "+u+"x"+r)}else svGlobal.logger.warn("Display control disabled.")};return Sa}if(!da.disableDVC){if(da.enableEcho){var A=new m.DynamicChannel;A.name="ECHO";A.process=function(u){var r=u.getPosition(),w=u.getEnd(),t=new Uint8Array(w-
r);t.set(u.getData().subarray(r,w));A.send(t)};m.addDynamicChannel(A)}if(a){var H=new m.DynamicChannel;H.name="Microsoft::Windows::RDS::Input";H.process=function(u){var r=u.getLittleEndian16();u.getLittleEndian32();switch(r){case 1:u.skipPosition(4),u=new RdpBuffer(new Uint8Array(16),0,16),u.setLittleEndian16(2),u.setLittleEndian32(16),u.setLittleEndian32(3),u.setLittleEndian32(65536),u.setLittleEndian16(256),u.markEnd(),H.send(u);case 5:ba.execute("setTouchRemoting",[!0]);Fa.isTouchReady=!0;svGlobal.logger.info("Touch remoting start");
break;case 4:ba.execute("setTouchRemoting",[!1]),Fa.isTouchReady=!1,svGlobal.logger.info("Touch remoting suspend")}};m.addDynamicChannel(H)}if(d){svGlobal.logger.warn("Audio input on");var N=new m.DynamicChannel;(function(){function u(Q){var fa=new RdpBuffer(new Uint8Array(5),0,5);fa.setByte(7);fa.setLittleEndian32(Q);fa.markEnd();N.send(fa)}function r(Q){var fa=Q.getLittleEndian32(),qa=Q.getLittleEndian32(),ha=new n;ha.fromBuffer(Q,!0);var ja=0,oa=0;0<ha.cbSize&&(22==ha.cbSize?(ja=Q.getLittleEndian16(),
oa=Q.getLittleEndian32(),Q.skipPosition(16)):(svGlobal.logger.warn("Wrong cbsize: "+ha.cbSize),Q.skipPosition(ha.cbSize)));Q=t[qa];svGlobal.logger.info("Selceted rec fmt, framesPerPacket: "+fa+" initial: "+qa+", "+Q.toString());svGlobal.logger.info("Open fmt: "+ha.toString()+" validBits:"+ja+" mask:"+oa);z=!0;E=m.reconnectOnResize;m.reconnectOnResize=!1;X.onopen||(X.onopen=function(sa){if(Ia){w=sa;m.reconnectOnResize=E;u(qa);var Ea=new RdpBuffer(new Uint8Array(5),0,5);Ea.setByte(4);Ea.setLittleEndian32(sa?
0:1);Ea.markEnd();N.send(Ea)}});X.ondata||(X.ondata=function(sa,Ea){w&&(C.length!=Ea+1&&(C=new Uint8Array(Ea+1),C[0]=6),N.send(L),C.set(sa,1),N.send(C))});X.start(Q,fa)}N.name="AUDIO_INPUT";N.process=function(Q){var fa=Q.getByte();switch(fa){case 1:Q=Q.getLittleEndian32();fa=new RdpBuffer(new Uint8Array(5),0,5);fa.setByte(1);fa.setLittleEndian32(Q);fa.markEnd();N.send(fa);break;case 2:var qa=Q.getLittleEndian32();Q.getLittleEndian32();var ha=Ta.getContext().sampleRate;for(fa=t.length=0;fa<qa;fa++){var ja=
new n;ja.fromBuffer(Q);svGlobal.logger.info("Server rec fmt "+fa+":"+ja.toString());0==e&&49==ja.formatTag&&22050==ja.nSamplesPerSec?t.push(ja):1==ja.formatTag&&ja.nSamplesPerSec<=ha&&t.push(ja)}N.send(L);qa=0;Q=t.length;for(fa=0;fa<Q;fa++)qa+=t[fa].getSize();ha=new RdpBuffer(new Uint8Array(1024),0,1024);ha.setByte(2);ha.setLittleEndian32(Q);ha.setLittleEndian32(qa+9);for(fa=0;fa<Q;fa++)t[fa].toBuffer(ha),svGlobal.logger.info("Client rec fmt: "+t[fa].toString());ha.skipPosition(1024-qa-9);ha.markEnd();
N.send(ha);break;case 3:r(Q);break;case 7:fa=Q.getLittleEndian32();svGlobal.logger.info("Rec fmt change, "+t[fa].toString()+" by client:"+z);z||(u(fa),z=!1);break;default:svGlobal.logger.warn("audioInput: invalid tag:"+fa)}};var w=!1,t=[];N.onclose=function(){w=!1;X&&X.close()};var L=new Uint8Array(1);L[0]=5;var z=!1,E=m.reconnectOnResize,C=new Uint8Array(0),S=pa("audiorecorder",hi5.libMin?"audiorecorder_min.js?v=0":"audiorecorder.js?v=0"),X=window.AudioWorkletNode?new hi5.audio.WorkletRecorder(Ta.getContext(),
S):new hi5.audio.Recorder(Ta.getContext())})();m.addDynamicChannel(N)}m.addDynamicChannel(function(){var u=new m.DynamicChannel;u.name="TSMF";var r={type:"image/jpeg"},w=Array(1);u.process=function(t){t.getPosition();var L=t.getLittleEndian32()&1073741823;var z=t.getLittleEndian32();var E=t.getLittleEndian32();switch(L){case 2:if(256==E){t.getLittleEndian32();E=new Uint8Array(16);var C=new RdpBuffer(E,0,16);C.setLittleEndian32(2);C.setLittleEndian32(z);C.setLittleEndian32(1);C.setLittleEndian32(0);
u.send(E)}break;case 0:switch(E){case 257:t.getBytes(16);t.getLittleEndian32();break;case 256:L=t.getPosition();C=t.getLittleEndian32();for(E=0;E<C;E++){t.getLittleEndian32();var S=t.getLittleEndian32();t.getLittleEndian32();t.skipPosition(S-4)}E=t.getPosition()-L;C=E+8+4;E=new Uint8Array(C);C=new RdpBuffer(E,0,C);C.setLittleEndian32(-2147483648);C.setLittleEndian32(z);E.set(t.getData().subarray(L,t.getPosition()),8);u.send(E);break;case 261:t.getBytes(16);t.getLittleEndian32();break;case 264:L=t.getLittleEndian32();
t.skipPosition(4);t.getLittleEndian32();S=t.getBytes(16);var X=t.getBytes(16);t.getLittleEndian32();t.getLittleEndian32();t.getLittleEndian32();var Q=t.getBytes(16);E=t.getLittleEndian32();t.skipPosition(E);E=new Uint8Array(20);C=new RdpBuffer(E,0,20);C.setLittleEndian32(-2147483648);C.setLittleEndian32(z);hi5.Arrays.equals([118,105,100,115,0,0,16,0,128,0,0,170,0,56,155,113],S)&&hi5.Arrays.equals([77,74,80,71,0,0,16,0,128,0,0,170,0,56,155,113],X)&&hi5.Arrays.equals([128,159,88,5,86,195,206,17,191,
1,0,170,0,85,89,90],Q)?C.setLittleEndian32(1):(C.setLittleEndian32(0),svGlobal.logger.warn("Format is not supported:"),svGlobal.logger.warn(S),svGlobal.logger.warn(X),svGlobal.logger.warn(Q));C.setLittleEndian32(L);u.send(E);break;case 258:t.getBytes(16);t.getLittleEndian32();L=t.getLittleEndian32();t.skipPosition(L);break;case 263:t.getBytes(16),E=new Uint8Array(16),C=new RdpBuffer(E,0,16),C.setLittleEndian32(-2147483648),C.setLittleEndian32(z),C.setLittleEndian32(1),u.send(E);case 277:t.getBytes(16);
t.getLittleEndian32();break;case 262:t.getBytes(16);ma.flushImgs();ma.setImgRect(0,0,0,0);E=new Uint8Array(12);C=new RdpBuffer(E,0,12);C.setLittleEndian32(-2147483648);C.setLittleEndian32(z);u.send(E);break;case 278:t.getBytes(16);z=t.getLittleEndian32();E=t.getLittleEndian32();L=t.getLittleEndian32();t=t.getLittleEndian32();ma.setImgRect(z,E,L-z,t-E);break;case 265:t.getBytes(16);t.getLittleEndian64();t.getLittleEndian32();break;case 266:t.getBytes(16);break;case 268:t.getBytes(16);break;case 267:t.getBytes(16);
break;case 269:t.getBytes(16);t.getLittleEndian32();break;case 274:break;case 275:break;case 259:t.getBytes(16);t.getLittleEndian32();t.getLittleEndian32();t.skipPosition(32);E=t.getLittleEndian32();z=new Image;L=t.getPosition();w[0]=t.getData().subarray(L,L+E);t=new Blob(w,r);z.src=URL.createObjectURL(t);ma.addImg(z);break;case 270:ma.flushImgs();break;case 273:break;case 260:break;case 276:t.getBytes(16);E=t.getLittleEndian32();L=t.getPosition()+E;t.skipPosition(8);z=t.getLittleEndian32();svGlobal.logger.info("window state:"+
z);C=t.getLittleEndian32();S=t.getLittleEndian32();z=t.getLittleEndian32();E=t.getLittleEndian32();t.skipPosition(8);X=t.getLittleEndian32();Q=t.getLittleEndian32();svGlobal.logger.info("Window rect, left:"+z+" top:"+E+" w:"+C+" h:"+S+" cl:"+X+" ct:"+Q);t.setPosition(L);L=t.getLittleEndian32();for(L=t.getPosition()+L;t.getPosition()<L;){X=t.getLittleEndian32();Q=t.getLittleEndian32();var fa=t.getLittleEndian32(),qa=t.getLittleEndian32();svGlobal.logger.info("visible region, l:"+Q+" t:"+X+" r:"+qa+
" b:"+fa)}ma.setImgRect(z,E,C,S);break;case 1:case 2:break;default:svGlobal.logger.warn("unknown function:"+E)}break;default:svGlobal.logger.warn("unkown interface:"+L)}};return u}());kb||m.addDynamicChannel(J());da.enableDVCAudio&&m.addDynamicChannel(function(u){var r=!1,w=0,t=0,L=0,z=0,E=[],C=new Uint8Array(4),S=new m.DynamicChannel;S.name="AUDIO_PLAYBACK_DVC";S.onclose=function(){};S.process=function(X){function Q(ka){ka.skipPosition(14);var ra=ka.getLittleEndian16();ka.getByte();var W=ka.getLittleEndian16();
ka.skipPosition(1);for(var na,wa=E.length=0;wa<ra;wa++){var g=new n;g.fromBuffer(ka);(na=22050<=g.nSamplesPerSec&&(1==g.formatTag||49==g.formatTag&&22050==g.nSamplesPerSec&&0==u||41222==g.formatTag))&&E.push(g)}g=20;ka=E.length;for(wa=0;wa<ka;wa++)g+=E[wa].getSize();wa=g+4;ra=new RdpBuffer(new Uint8Array(wa),0,wa);ra.setByte(7);ra.setByte(2);ra.setLittleEndian16(g);ra.setLittleEndian32(3);ra.setLittleEndian32(4294967295);ra.setLittleEndian32(0);ra.setLittleEndian16(0);ra.setLittleEndian16(ka);ra.skipPosition(1);
ra.setLittleEndian16(W);ra.setByte(124);for(wa=0;wa<ka;wa++)g=E[wa],g.toBuffer(ra);ra.markEnd();S.send(ra);5<W&&(ra=new RdpBuffer(new Uint8Array(8),0,8),ra.setByte(12),ra.skipPosition(1),ra.setLittleEndian16(4),ra.setLittleEndian16(0),ra.setLittleEndian16(0),ra.markEnd(),S.send(ra))}function fa(ka){var ra=ka.getLittleEndian16();ka=ka.getLittleEndian16();var W=new RdpBuffer(new Uint8Array(8),0,8);W.setByte(6);W.setByte(35);W.setLittleEndian16(4);W.setLittleEndian16(ra);W.setLittleEndian16(ka);W.markEnd();
S.send(W)}function qa(){var ka=E[L];if(ka.formatTag!=Ca.tag||ka.nSamplesPerSec!=Ca.samplePerSec||Ca.channels!=ka.nChannels)Ca.tag=ka.formatTag,Ca.channels=ka.nChannels,Ca.samplePerSec=ka.nSamplesPerSec,Ca.bitsPerSample=49==ka.formatTag?8:ka.bitsPerSample,svGlobal.logger.info("DVC Audio Format, tag="+Ca.tag+" channels="+Ca.channels+" bitsPerSample="+Ca.bitsPerSample+" samplePerSec="+Ca.samplePerSec),41222==Ca.tag&&(Ca.sampleRate=Ca.samplePerSec,Ta.initMediaPlayer(Ta,Ca,!0))}function ha(ka){t=ka.getLittleEndian16();
L=ka.getLittleEndian16();z=ka.getByte();ka.skipPosition(3);C.set(ka.getSubarray(4));r=!0;qa()}function ja(ka,ra){var W=new RdpBuffer(new Uint8Array(8),0,8);W.setByte(5);W.skipPosition(1);W.setLittleEndian16(4);W.setLittleEndian16(ka);W.setByte(ra);W.skipPosition(1);W.markEnd();S.send(W)}function oa(ka){r=!1;var ra=w-8,W=Date.now();ka.copyFromByteArray(C,0,ka.getPosition(),4);jc(ka,z,t,ra);ka=t+(Date.now()-W);ja(ka,z)}function sa(ka){var ra=Date.now();t=ka.getLittleEndian16();L=ka.getLittleEndian16();
z=ka.getByte();ka.skipPosition(7);qa();ka=jc(ka,z,t,0);ka*=1E3;ra=t+(Date.now()-ra)+ka;ja(ra,z)}if(r)oa(X);else{var Ea=X.getByte();X.skipPosition(1);w=X.getLittleEndian16();switch(Ea){case 7:Q(X);break;case 6:fa(X);break;case 2:ha(X);break;case 3:X.getLittleEndian16();X.getLittleEndian16();break;case 13:sa(X)}}};return S}(e));svGlobal.DCVC_EXTENSION||(svGlobal.DCVC_EXTENSION={});var v=svGlobal.DCVC_EXTENSION;v.videoMedia={video:null,track:null,canvas:null,ctx:null,resolutions:null,minFrameRate:16,
type:2,activate:function(u,r){svGlobal.logger.info("activate webcam");v.videoMedia.resolutions?u():hi5.video.resolutions(function(w){w.length?(v.videoMedia.resolutions=w,u()):r()})},deactivate:function(){var u=v.videoMedia;u.track&&(u.track.stop(),u.track=null);u.ctx=null;u.canvas=null;u.video=null;svGlobal.logger.info("deactivate cam")},startStream:function(u,r,w,t,L){svGlobal.logger.info("startStream, width:"+u+" height:"+r+" frameRate:"+w);var z=v.videoMedia,E=z.track;if(E){var C=E.getSettings();
if("live"==E.readyState)if(u!=C.width||r!=C.height||w!=C.frameRate&&2!=z.type)E.stop();else return}navigator.mediaDevices.getUserMedia({video:{frameRate:2==z.type?z.minFrameRate:w,width:{exact:u},height:{exact:r}}}).then(function(S){var X=document.createElement("video");X.srcObject=S;X.play();if(window.OffscreenCanvas)var Q=new OffscreenCanvas(100,100);else Q=document.createElement("canvas"),Q.style.position="absolute",Q.style.left=0,Q.style.top=0;z.track=S.getVideoTracks()[0];z.canvas=Q;z.ctx=Q.getContext("2d");
z.video=X;S=z.track.getSettings();z.canvas.width=S.width;z.canvas.height=S.height;t()}).catch(function(S){svGlobal.logger.warn(S);L()})},stopStream:function(){svGlobal.logger.info("stopStream");var u=v.videoMedia;u.track&&"live"==u.track.readyState&&u.track.stop()},grabFrame:function(u){function r(t){t.arrayBuffer().then(u)}var w=v.videoMedia;w.ctx.drawImage(w.video,0,0);w=w.canvas;w.convertToBlob?w.convertToBlob({type:"image/jpeg",quality:.6}).then(r):w.toBlob(r,"image/jpeg",.6)},propertyList:[[{propertyId:1,
capabilities:3,min:4294967286,max:4294967294,step:1,default:4294967291},null,{propertyId:3,capabilities:1,min:4294967280,max:16,step:1,default:0},{propertyId:4,capabilities:1,min:0,max:3,step:1,default:0},{propertyId:5,capabilities:1,min:4294967280,max:16,step:1,default:0},{propertyId:6,capabilities:1,min:100,max:400,step:10,default:100}],[{propertyId:1,capabilities:1,min:0,max:2,step:1,default:1},{propertyId:2,capabilities:1,min:4294967232,max:64,step:1,default:0},{propertyId:3,capabilities:1,min:0,
max:95,step:1,default:0},{propertyId:4,capabilities:1,min:4294965296,max:2E3,step:1,default:0},{propertyId:5,capabilities:3,min:2800,max:6500,step:1,default:4600}]]};v.WEBAUTHN=function(u){var r=new u;r.name="WebAuthN_Channel";r.newInstance=function(){return v.WEBAUTHN(u)};r.onopen=function(){svGlobal.logger.info("webAuthn open")};r.onclose=function(){svGlobal.logger.info("webAuthn close")};r.process=function(w){var t=w.getEnd()-w.getPosition();w=w.getBytes(t);var L=Ib(w),z=L.command;t=L.flags;w=
L.timeout;var E=L.webAuthNPara;if(z)switch(console.log("==== command: "+L.command),z){case 5:if(L.request)switch(z=L.request[0],console.log("==== webAuth cmdType = "+z),console.log("==== webAuth request bytes: "+tb(L.request.slice(1,L.request.length))),z){case 1:L=L.request.slice(1,L.request.length);var C=Ib(L);L=C[1];var S=C[2],X=C[3],Q=C[4],fa=C[5];z=C[6];var qa=C[7];C={};var ha=yd(E);ha&&(ha.attestation&&(C.attestation=ha.attestation),ha.attestationFormats&&(C.attestationFormats=ha.attestationFormats));
if(t=xd(t,E,qa))C.authenticatorSelection=t;C.challenge=L;fa&&(C.excludeCredentials=Cc(fa));z&&(C.extensions=z);Q&&(C.pubKeyCredParams=Q);C.rp={id:window.location.hostname,name:"RS_Gateway"};w&&(C.timeout=w);C.user=X;w={};w.signal=createNewAbortWebAuthnSignal();w.publicKey=C;navigator.credentials.create(w).then(function(ja){zd(ja.response,S).then(function(oa){var sa={},Ea={maxMsgSize:1200,maxSerializedLargeBlobArray:0,providerType:"Hid",providerName:"MicrosoftCtapHidProvider",devicePath:"\\\\?\\hid#vid_1050&pid_0407&mi_01#7&1dd131cc&0&0000#{4d1e55b2-f16f-11cf-88cb-001111000030}"},
ka=new Uint8Array([159,87,192,47,19,129,234,71,177,22,187,90,141,185,32,42]);Ea.aaGuid=ka.buffer;Ea.residentKey=!0;sa.deviceInfo=Ea;sa.status=0;sa.response=oa;oa=CBOR.encode(sa);sa=new hi5.DataBuffer(new Uint8Array(4+oa.byteLength));sa.setLittleEndian32(0);sa.setBytes(oa);sa.markEnd();r.send(sa)})}).catch(function(ja){console.log("WebAuthN MakeCredential failed with error code ["+ja.code+"], msg: "+ja.message);ja=new hi5.DataBuffer(new Uint8Array(4));ja.setLittleEndian32(1);ja.markEnd();r.send(ja)});
break;case 2:L=L.request.slice(1,L.request.length);C=Ib(L);L=C[2];X=C[3];z=C[4];qa=C[5];C={};X&&(C.allowCredentials=Cc(X));C.challenge=L;z&&(C.extensions=z);C.rp=window.location.hostname;w&&(C.timeout=w);if(w=Bc(t,E,qa))C.userVerification=w;w={};w.signal=createNewAbortWebAuthnSignal();w.publicKey=C;navigator.credentials.get(w).then(function(ja){ja=new hi5.DataBuffer(new Uint8Array(void 0));ja.markEnd();r.send(ja)}).catch(function(ja){console.log("WebAuthN GetAssertion failed with error code ["+ja.code+
"], msg: "+ja.message);ja=new hi5.DataBuffer(new Uint8Array(4));ja.setLittleEndian32(1);ja.markEnd();r.send(ja)});break;default:svGlobal.logger.error("Unknown WebAuthn command type: "+z)}else svGlobal.logger.error("Incorrect request content in WEB AUTH COMMAND");break;case 6:w=new hi5.DataBuffer(new Uint8Array(8));w.setLittleEndian32(0);t=Ac()?PublicKeyCredential.isUserVerifyingPlatformAuthenticatorAvailable():!1;t?w.setLittleEndian32(1):w.setLittleEndian32(0);w.markEnd();r.send(w);break;case 7:cancelWebAuthnOperations();
w=new hi5.DataBuffer(new Uint8Array(4));w.setLittleEndian32(0);w.markEnd();r.send(w);break;case 8:w=new hi5.DataBuffer(new Uint8Array(8));w.setLittleEndian32(0);w.setLittleEndian32(4);w.markEnd();r.send(w);break;default:svGlobal.logger.warn("Unknown command received in WebAuthN Channel: "+z)}else svGlobal.logger.warn("WebAuthN Channel, command missed")};return r};m.enableWebAuthn()&&Ac()&&(a=v.WEBAUTHN(m.DynamicChannel),m.addDynamicChannel(a));v.WEBCAM=function(u){var r=new u;r.name="RDCamera_Device_0";
r.version=2;r.newInstance=function(){return v.WEBCAM(u)};r.onopen=function(){svGlobal.logger.info("cam open")};r.onclose=function(){svGlobal.logger.info("cam close")};r.sendSucess=function(){var w=new hi5.DataBuffer(new Uint8Array(2));w.setByte(r.version);w.setByte(1);w.markEnd();r.send(w)};r.sendError=function(w){var t=new hi5.DataBuffer(new Uint8Array(6));t.setByte(r.version);t.setByte(2);t.setLittleEndian32(w||1);t.markEnd();r.send(t)};r.sendSteamListResp=function(){var w=new hi5.DataBuffer(new Uint8Array(7));
w.setByte(r.version);w.setByte(10);w.setLittleEndian16(1);w.setByte(1);w.setByte(1);w.setByte(0);w.markEnd();r.send(w)};r.sendMediaTypeListResp=function(w){var t=v.videoMedia.resolutions,L=t.length,z=new hi5.DataBuffer(new Uint8Array(2+26*L));z.setByte(r.version);z.setByte(12);for(var E=1==w,C=0;C<L;C++){z.setByte(w);var S=t[C];z.setLittleEndian32(S.width);z.setLittleEndian32(S.height);z.setLittleEndian32(E?S.frameRate:v.videoMedia.minFrameRate);z.setLittleEndian32(1);z.setLittleEndian32(1);z.setLittleEndian32(1);
z.setByte(1)}z.markEnd();r.send(z)};r.sendCurrentMediaType=function(w,t){var L=new hi5.DataBuffer(new Uint8Array(28));L.setByte(r.version);L.setByte(14);t=v.videoMedia.resolutions[t];L.setByte(w);L.setLittleEndian32(t.width);L.setLittleEndian32(t.height);L.setLittleEndian32(1==w?t.frameRate:v.videoMedia.minFrameRate);L.setLittleEndian32(1);L.setLittleEndian32(1);L.setLittleEndian32(1);L.setByte(1);L.markEnd();r.send(L)};r.sendSampleResp=function(w){v.videoMedia.grabFrame(function(t){var L=new hi5.DataBuffer(new Uint8Array(t.byteLength+
3));L.setByte(r.version);L.setByte(18);L.setByte(w);L.setBytes(new Uint8Array(t));L.markEnd();r.send(L)})};r.sendPropertyListResp=function(){for(var w=0,t,L,z=v.videoMedia.propertyList,E=0;2>E;E++){L=z[E];t=L.length;for(var C=0;C<t;C++)null!=L[C]&&w++}var S=new hi5.DataBuffer(new Uint8Array(2+19*w));S.setByte(r.version);S.setByte(21);for(E=0;2>E;E++)for(L=z[E],t=L.length,C=0;C<t;C++)w=L[C],null!=w&&(S.setByte(E+0),S.setByte(w.propertyId),S.setByte(w.capabilities),S.setLittleEndian32(w.min),S.setLittleEndian32(w.max),
S.setLittleEndian32(w.step),S.setLittleEndian32(w.default));S.markEnd();r.send(S)};r.sendPropertyValueResp=function(w,t){(w=v.videoMedia.propertyList[w][t-1])?(t=new hi5.DataBuffer(new Uint8Array(7)),t.setByte(r.version),t.setByte(23),t.setByte(1),t.setLittleEndian32(w.value||w.default),t.markEnd(),r.send(t)):r.sendError(8)};r.process=function(w){w.getByte();var t=w.getByte();switch(t){case 7:v.videoMedia.activate(r.sendSucess,r.sendError);break;case 8:v.videoMedia.deactivate();r.sendSucess();break;
case 9:r.sendSteamListResp();break;case 11:w=w.getByte();0!=w&&svGlobal.logger.warn("Invalid stream index: "+w);r.sendMediaTypeListResp(v.videoMedia.type);break;case 13:w=w.getByte();r.sendCurrentMediaType(v.videoMedia.type,w);break;case 15:w.getByte();t=w.getByte();if(t!=v.videoMedia.type){svGlobal.warn("Invalid video format req:"+t);r.sendError(6);break}t=w.getLittleEndian32();var L=w.getLittleEndian32();w=w.getLittleEndian32()/w.getLittleEndian32();v.videoMedia.startStream(t,L,w,r.sendSucess,r.sendError);
break;case 16:v.videoMedia.stopStream();r.sendSucess();break;case 17:w=w.getByte();0!=w&&svGlobal.logger.info("Invalid stream index for SampleRequest: "+w);r.sendSampleResp(w);break;case 20:r.sendPropertyListResp();break;case 22:t=w.getByte();w=w.getByte();r.sendPropertyValueResp(t,w);break;case 24:r.sendError(10);break;default:r.sendError(10),svGlobal.logger.warn("Invalid cam msg: "+t)}};return r};v.WEBCAM_ENUM=function(u,r){var w=new u;w.name="RDCamera_Device_Enumerator";w.onopen=function(){var t=
new hi5.DataBuffer(new Uint8Array(2));t.setByte(r.version);t.setByte(3);t.markEnd();w.send(t);svGlobal.logger.info("camEnum open")};w.onclose=function(){svGlobal.logger.info("camEnum closed");v.videoMedia.deactivate()};w.addDevice=function(t){t+="\x00";var L=r.name+"\x00",z=new hi5.DataBuffer(new Uint8Array(2+2*t.length+L.length));z.setByte(r.version);z.setByte(5);z.setUnicodeString(t);z.setAscllString(L);z.markEnd();w.send(z)};w.process=function(t){var L=t.getByte();t=t.getByte();switch(t){case 4:svGlobal.logger.info("camEnum ver resp: "+
L);r.version=L;w.addDevice(hi5.video.webcam&&hi5.video.webcam.label||"Web Camera");break;default:svGlobal.logger.warn("invalid messageId on camEnum: "+t)}};return w};c&&(c=v.WEBCAM(m.DynamicChannel),a=v.WEBCAM_ENUM(m.DynamicChannel,c),m.addDynamicChannel(a),m.addDynamicChannel(c));f&&(svGlobal.logger.info("Mapping USB..."),m.addDynamicChannel(Fa.usbChannel));if(b&&v.GFX){var x=v.GFX(m.DynamicChannel,T(P.remotefx)&&!T(P.gfx),0==m.mode,ma);x.onmessage=function(u){m.showMessage(u)};x.onfatalerror=function(u,
r){m.reconnect(u.width,u.height,!0)};x.onsps=function(u){u.fps&&m.setFPS(u.fps)};x.onresetgraphic=function(u){m.setResolution(u.width,u.height)};x.onmapsurface=function(u){var r=ba.getMonitorSurface(u.outputOriginX,u.outputOriginY,u.targetWidth+u.outputOriginX-1,u.targetHeight+u.outputOriginY-1);r?(r.setId(u.id),r.setSize(u.targetWidth,u.targetHeight)):svGlobal.logger.error("Failed to map surface, x:"+u.outputOriginX+" y:"+u.outputOriginY)};x.onconfirm=function(){svGlobal.logger.info("GFXDrawableController in us");
ba.execute("setDrawable",[x.controller])};m.addDynamicChannel(x)}}}},db=null;svGlobal.DCVC_EXTENSION&&!kb&&(m.hasUSB()&&svGlobal.DCVC_EXTENSION.WEBUSB&&(Fa.usbChannel=svGlobal.DCVC_EXTENSION.WEBUSB(m.DynamicChannel)),svGlobal.DCVC_EXTENSION.DRIVE&&(db=svGlobal.DCVC_EXTENSION.DRIVE(m.GatewayChannel),m.addGatewayChannel(db)));this.getPrinters=function(a){if(!m.onagentmessage||!db)return null;var b=new hi5.DataBuffer(new Uint8Array(2));b.setByte(6);b.setByte(1);b.markEnd();m.onagentmessage(b.getData());
db.listCallback=a};this.attachPrinter=function(a){db&&db.attachPrinter(a,m)};this.showError=Hb;this.resetStatus=$b;this.exeAppCmd=function(a){var b=ba.getFocused();b&&b.exeCommand(a)};this.activateApp=function(a){var b;(b=hi5.tool.isNumber(a)?ba.getWinById(a):ba.getMainWinByAppId(a))?b.activate(1):svGlobal.logger.warn("No window found in "+a)};this.reconnect=function(a,b,d){void 0==d&&(d=da.forceReconnect||!1);if(!Ia&&!d)return!1;P.minWidth&&a<P.minWidth&&(a<P.minWidth&&svGlobal.logger.warn("Width "+
a+" is samller than minWidth "+P.minWidth),a=P.minWidth);P.minHeight&&b<P.minHeight&&(b<P.minHeight&&svGlobal.logger.warn("Height "+b+" is samller than minHeight "+P.minHeight),b=P.minHeight);a&=-4;b&=-4;if(!d&&4>Math.abs(a-Ja)&&4>Math.abs(b-Ka))return!1;if(Sa&&Sa.enabled&&!1!==da.displayVC)Sa.applyResolution(a,b);else if(nc&&qb||d||Wa&&!nc)qb=!1,svGlobal.logger.info("reconnecting..."),ta("8E0"+a+"\t"+b),Ra&&(Ra.remoteLockFlags=0,Ra.checkLockFlags=!0);return!0};this.notify=function(a,b){a="8E6"+a;
b&&(a+="\t"+b.join(";"));ta(a)};this.getUploadManager=function(){return Na};this.setFPS=function(a){ba.execute("setFPS",[a])};this.addSurface=function(a){if(!ba.hasSurface(a)&&(Mb||ma.setContext(a.context),!ba.hasSurface(a)||!a.railWin)){kb&&a.setPlayerMode();P.mouseMoveEmu&&(a.mouseMoveEmu=T(P.mouseMoveEmu));a.setSize(50,50,"hidden");var b=a.getFreeSpace();0==Ja&&(Ja=b.width);0==Ka&&(Ka=b.height);a.setConfig(da);ba.addSurface(a);Oa(Ja,Ka,!0,P.monitorDef?!0:!1);a.setController(Ra);a.setDrawable(Rd);
a.setTouchpad(T(P.touchpad));var d=b=T(P.mapClipboard),e=b;void 0!=P.copyToLocal?d=T(P.copyToLocal):void 0!=da.copyToLocal&&(d=da.copyToLocal);void 0!=P.copyToRemote?e=T(P.copyToRemote):void 0!=da.copyToRemote&&(e=da.copyToRemote);a.setClipboard(b,d,e);Lb&&ac(a);P.invitation&&!T(P.control)&&(ba.setReadOnly(!0),b=hi5.$("requestControl"))&&(b.disabled=!1);b=void 0!=P.ctrlToWin?T(P.ctrlToWin):void 0!=da.ctrlToWin?da.ctrlToWin:!0;d=void 0!=P.cmdToCtrl?T(P.cmdToCtrl):void 0!=da.cmdToCtrl?da.cmdToCtrl:
!0;a.run(parseInt(P.keyboard||1033,10),b,!!da.noKeyStuck,d)}};this.getRunninApps=this.getRunningApps=function(){for(var a=[],b=0,d=ba.size();b<d;b++)ba.getSurface(b).railWin.getMain(ba.zOrders)&&a.push(ba.getSurface(b).railWin.getMain(ba.zOrders).titleInfo);return a};this.startApp=function(a,b,d){b=b||"";d=d||"";ta("8C2"+a+"\t"+b+"\t"+d);var e=ba.getSurface(ba.size()-1);e&&(e.remoteApp=new zc(a,b,d))};this.startExitingApp=function(a){a=ba.popWins(a);for(var b=a.length-1;0<=b;b--)ba.addWin(a[b])};
var vb=new m.DynamicChannel;vb.name="PNPDR";vb.onopen=function(){svGlobal.logger.info("PNPDR DVC onopen()")};vb.process=function(a){a.getLittleEndian32();var b=a.getLittleEndian32();switch(b){case 101:a.getLittleEndian32(),a.getLittleEndian32(),a.getLittleEndian32(),a=new RdpBuffer(new Uint8Array(20),0,20),a.setLittleEndian32(20),a.setLittleEndian32(b),a.setLittleEndian32(1),a.setLittleEndian32(5),a.setLittleEndian32(1),vb.send(a)}};vb.onclose=function(){svGlobal.logger.info("PNPDR DVC onclose()")};
m.addDynamicChannel(vb);var hb=null;T(P.scanner)&&(hb=new m.DynamicChannel,hb.name="SCANNERDVC",hb.onopen=function(){svGlobal.logger.info("scanner DVC onopen().")},hb.process=function(a){var b=a.getByte();switch(b){case 0:var d=a.getByte(),e=a.getByte();b=new Uint8Array(10);b[0]=4;b[1]=7;b[2]=d;b[3]=e;b.set(a.getBytes(2),4);b.set(a.getBytes(2),6);b.set(a.getBytes(2),8);if(m.onagentmessage)m.onagentmessage(b);break;case 1:break;case 2:d=a.getEnd()-a.getPosition();b=new Uint8Array(d+2);b[0]=4;b[1]=
3;b.set(a.getBytes(d),2);if(m.onagentmessage)m.onagentmessage(b);break;case 3:d=a.getEnd()-a.getPosition();b=new Uint8Array(d+3);b[0]=4;b[1]=9;b[2]=0;b.set(a.getBytes(d),3);if(m.onagentmessage)m.onagentmessage(b);break;default:svGlobal.logger.info('Warning: Unknown type "'+b+'" received from DVC, ignored.')}},hb.onclose=function(){var a=new Uint8Array(2);a[0]=4;a[1]=4;if(m.onagentmessage)m.onagentmessage(a)},m.addDynamicChannel(hb));var ab=null;m.hasSmartCard()&&(ab=new m.GatewayChannel,ab.name="SCARDSTB",
ab.onopen=function(){var a=new Uint8Array(2);a[0]=3;a[1]=1;if(m.onagentmessage)m.onagentmessage(a);T(P.passwordIsPin)&&m.onagentmessage&&!hi5.browser.isMacOS&&hi5.notifications.notify({msg:__svi18n.info.scardAuth||"Smart card authentication in progress. Please wait...",type:0,timeout:1E4})},ab.process=function(a){var b=a.getEnd()-a.getPosition(),d=a.getByte(),e=a.getByte();switch(d){case 1:switch(e){case 1:d=new Uint8Array(2);d[0]=3;d[1]=7;if(m.onagentmessage)m.onagentmessage(d);break;case 3:a=a.getBytes(b-
2);b=b+4+4+4;wb&&(b+=wb.length);eb&&(b+=eb.length);b=new hi5.DataBuffer(new Uint8Array(b));b.setByte(3);b.setByte(9);wb?(b.setLittleEndian32(wb.length),b.setBytes(wb)):b.setLittleEndian32(0);eb?(b.setLittleEndian32(eb.length),b.setBytes(eb)):b.setLittleEndian32(0);b.setLittleEndian32(a.length);b.setBytes(a);b.markEnd();if(m.onagentmessage)m.onagentmessage(b.getData());break;case 5:a=a.getBytes(b);d=new Uint8Array(b);d[0]=3;d[1]=11;d.set(a,2);if(m.onagentmessage)m.onagentmessage(d);break;case 2:case 4:break;
default:svGlobal.logger.warn("Invalid smart card channel auth data received: unknown sub-type ["+a[1]+"].")}break;case 2:if(ab)if(1==e){if(d=new Uint8Array(b),d[0]=3,d[1]=3,d.set(a.getBytes(b),2),m.onagentmessage)m.onagentmessage(d)}else svGlobal.logger.warn("Invalid smart card channel pcsc data received: unknown sub-type ["+a[1]+"].");break;default:svGlobal.logger.warn("Invalid smart card channel data received: unknown type ["+a[0]+"].")}},ab.onclose=function(){var a=new Uint8Array(2);a[0]=3;a[1]=
4;if(m.onagentmessage)m.onagentmessage(a)},m.addGatewayChannel(ab));da.detectNetwork&&(l+="&connectType=7",Cd());this.getNetworkResult=function(){return Jb};this.getAgentLink=function(){var a=navigator.userAgentData?navigator.userAgentData.platform:navigator.platform||navigator.appVersion;return-1!=a.indexOf("Win")?"agent_setup.exe":-1!=a.indexOf("macOS")||-1!=a.indexOf("Mac")?"agent_setup.pkg":""};var bc=new Map,cc=new Map;this.writeAgent=function(a){a.byteLength&&(a=new Uint8Array(a));switch(a[0]){case 3:if(ab){var b=
a.slice?new hi5.DataBuffer(a.slice(2,a.length)):new hi5.DataBuffer(a.subarray(2,a.length));switch(a[1]){case 1:case 4:case 5:case 6:case 7:case 9:case 11:break;case 2:break;case 3:a[0]=2;a[1]=1;ab.send(a);break;case 8:bc.clear();cc.clear();a=b.getLittleEndian32();if(0!=a)a=b.getLittleEndian32(),b=b.getAscllString(a,!1),hi5.notifications.notify({msg:b});else{var d=b.getLittleEndian32(),e=document.getElementById("scardSelection");e||(e=document.createElement("div"),e.id="scardSelection",e.className=
"appdlg",document.body.appendChild(e));if(e)if(0==d)e&&(e.innerHTML="<p>Error: Could not find any connected smart card. Please make check the connectivity and then refresh the page",b=new hi5.ui.Lightbox(e),b.onclose=function(){location.reload()},b.show());else{e.innerHTML=1<d?'<p><b>PLEASE SELECT A SMART CARD, ENTER YOUR CREDENTIAL AND CLICK "Continue".</b></p>':'<p><b>PLEASE ENTER YOUR CREDENTIAL AND CLICK "Continue".</b></p>';for(a=0;a<d;a++){var c=b.getLittleEndian32();c=b.getBytes(c);var f=b.getLittleEndian32();
f=b.getAscllString(f,!1);var n=b.getLittleEndian32();n=b.getAscllString(n,!1);var J=b.getLittleEndian32();b.getAscllString(J,!1);J=b.getLittleEndian64();J=(new Date(1E3*J)).toDateString();c=Dd(a,c,n,f,J);e.appendChild(c)}e.innerHTML+="<br>";b=document.createElement("div");b.innerHTML+="Smart card credential: ";a=document.createElement("input");a.type="text";a.id="userPin";a.placeholder="PIN";a.value="";a.required=!0;b.appendChild(a);e.appendChild(b);e.innerHTML+="<br>";b=new hi5.ui.LightboxWithBtn(e);
b.onclose=function(){var A,H=document.querySelector('input[name="scard_name"]:checked');H&&(A=parseInt(H.value));wb=bc.get(A);rb=cc.get(A);A=document.getElementById("userPin").value;eb=(new TextEncoder("utf-8")).encode(A);A=2;A=eb?A+4+eb.length:A+4;A=rb?A+4+rb.length:A+4;A=new Uint8Array(A);A=new hi5.DataBuffer(A);A.setByte(1);A.setByte(2);eb?(A.setLittleEndian32(eb.length),A.setBytes(eb)):A.setLittleEndian32(0);rb?(A.setLittleEndian32(rb.length),A.setAsciiString(rb,rb.length)):A.setLittleEndian32(0);
ab&&ab.send(A)};document.getElementById("userPin").addEventListener("keypress",function(A){"Enter"===A.key&&(A.preventDefault(),document.getElementById("continue_button").click())});b.show()}}break;case 10:a=b.getLittleEndian32();0!=a?(a=b.getLittleEndian32(),b=b.getAscllString(a,!1),hi5.notifications.notify({msg:b})):(a=b.getLittleEndian32(),a=b.getBytes(a),b=new Uint8Array(6+a.length),b=new hi5.DataBuffer(b),b.setByte(1),b.setByte(4),b.setLittleEndian32(a.length),b.setBytes(a),ab.send(b));break;
case 12:a[0]=1;a[1]=6;ab.send(a);break;default:svGlobal.logger.warn("Warning: Unknown smart card response header: [3 / "+a[1]+"], ignored.")}}break;case 4:if(hb)switch(a[1]){case 2:b=a.slice?new hi5.DataBuffer(a.slice(2,a.length)):new hi5.DataBuffer(a.subarray(2,a.length));e=document.getElementById("dsSelection");e||(e=document.createElement("div"),e.id="dsSelection",e.className="appdlg",document.body.appendChild(e));if(0!=b.getLittleEndian16())e&&(e.innerHTML="<p>Error on local: failed to get the list of connected scanners. Close to continue without scanning.</p>",
b=new hi5.ui.Lightbox(e),b.onclose=function(){m.run()},b.show());else if(d=(a.byteLength-4)/41,0==d)e&&(e.innerHTML="<p>Error: Could not find any connected scanner. Please:<ul><li>Power on or connect the scanner and then refresh the page; or</li><li>Close this dialog to connect to the machine without using scanner.</li></ul></p>",b=new hi5.ui.Lightbox(e),b.onclose=function(){m.run()},b.show());else if(1==d){if(b=new Uint8Array(3),b[0]=4,b[1]=5,b[2]=0,m.onagentmessage)m.onagentmessage(b)}else if(e){e.innerHTML=
'<p> Please choose a scanner &lt;DriverType: DeviceName&gt; and click "Continue".</a></p>';for(a=0;a<d;a++)c=b.getAscllString(41,!0),c=Ed(a,c),e.appendChild(c);e.innerHTML+="<br>";b=new hi5.ui.LightboxWithBtn(e);b.onclose=function(){var A=0,H=document.querySelector('input[name="ds_name"]:checked');H&&(A=H.value);H=new Uint8Array(3);H[0]=4;H[1]=5;H[2]=A;if(m.onagentmessage)m.onagentmessage(H)};b.show()}break;case 3:case 8:case 10:b=a.slice?new hi5.DataBuffer(a.slice(2,a.length)):new hi5.DataBuffer(a.subarray(2,
a.length));hb.send(b);break;case 4:b=a.slice?new hi5.DataBuffer(a.slice(2,a.length)):new hi5.DataBuffer(a.subarray(2,a.length));hb.send(b);hi5.notifications.notify({msg:__svi18n.info.TwainNotSupported,type:2});break;case 6:b=a.slice?new hi5.DataBuffer(a.slice(2,a.length)):new hi5.DataBuffer(a.subarray(2,a.length));b.getLittleEndian16();m.run();break;default:svGlobal.logger.warn("Warning: Unknown response header: [4 / "+a[1]+"], ignored.")}break;case 5:switch(a[1]){case 1:b=a[2]|a[3]<<8,a=a[4]|a[5]<<
8,svGlobal.logger.info("Agent version, major: "+b+" minor: "+a),(e=hi5.appcfg.agent&&hi5.appcfg.agent.version)&&(e.major>b||e.major==b&&e.minor>a)&&(b=__svi18n.info.newVersion||"New versoin available",a=__svi18n.info.updateAgent||"Please download and install the new gateway agent",e=m.getAgentLink(),hi5.notifications.notify({title:b,msg:a+(': <a href="'+e+'">'+e+"</a>")}))}break;case 6:switch(a[1]){case 1:b=new hi5.DataBuffer(a);b.skipPosition(2);e=b.getLittleEndian32();d=[];for(a=0;a<e;a++)f=b.getLittleEndian32(),
c=b.getUnicodeString(f),f=b.getLittleEndian32(),f=b.getUnicodeString(f),d.push({name:c,driver:f});db&&db.listCallback&&(db.listCallback(d),db.listCallback=null)}break;case 7:db.send(a.subarray(1));break;default:svGlobal.logger.warn("Invalid channel data received: unknown type ["+a[0]+"].")}};var wb,eb,rb,fc={type:6,data:null};this.setAgentStatus=function(a){Tc=a};this.getAgentStatus=function(){return Tc};this.run=function(){var a;if(a=null==m.onagentmessage)a=1==m.mode?!1:m.hasSmartCard()||m.hasScanner()||
T(P.localPrinter);a&&window.startGatewayAgent?startGatewayAgent(m):(m.hasUSB()?ba.getFocused().requestUsbDevices(m.getUSB(),function(b){Fa.usbChannel.openDevices(b);dc()}):dc(),Ta.supportWebAudio&&Ta.iOSFix())};this.getDesktop=function(){return ma};this.mouseDown=function(a,b,d){Wa&&ta("80"+a+"\t"+b+"\t"+d)};this.mouseMove=function(a,b){Wa&&ta("82"+a+"\t"+b)};this.mouseUp=function(a,b,d){Wa&&ta("81"+a+"\t"+b+"\t"+d)};this.writeKeyCode=function(a,b){Wa&&ta("8B"+(a?0:49152)+"\t"+b)};this.writeScancode=
function(a,b){Wa&&("number"==typeof a?(ta("840\t"+a),ta("8449152\t"+a)):ta("84"+(a?0:49152)+"\t"+b))};this.resetSize=function(a,b){m.reconnectOnResize&&(Va?(nb&&(clearTimeout(nb),nb=0),a&=-4,b&=-4,nb=setTimeout(function(){document.hidden||(Sa&&Sa.enabled&&Sa.applyResolution(a,b),setTimeout(function(){m.writeRawInput("8C661441\t"+a+"\t"+b);3==m.windowState&&Sc()},150),svGlobal.logger.info("-- displayChange, h:"+b))},777)):m.running()&&(nb&&(clearTimeout(nb),nb=0),nb=setTimeout(function(){document.hidden||
m.reconnect(a,b)},555)))};var Ua=new RdpBuffer([],0,0);this.suppressOutput=function(a){if(!m.sessionInfo.suppressOutput)return!1;void 0==a&&(a=!0);var b=new Uint8Array(a?3:11);b[0]=146;b[1]=3;b[2]=a?1:0;a||(b[3]=Wb,b[4]=Wb>>8,b[5]=Vb,b[6]=Vb>>8,b[7]=Xb,b[8]=Xb>>8,b[9]=Yb,b[10]=Yb>>8);ta(b.buffer);return!0};this.refreshOutput=function(a,b,d,e){var c=new Uint8Array(d?11:3);c[0]=146;c[1]=3;c[2]=2;d&&(c[3]=a,c[4]=a>>8,c[5]=b,c[6]=b>>8,c[7]=d,c[8]=d>>8,c[9]=e,c[10]=e>>8);ta(c.buffer)};this.sendPing=function(a){var b=
new Uint8Array(a?2+a.length:2);b[0]=146;b[1]=0;a&&b.set(a,2);ta(b.buffer)};this.startPing=function(a,b){b=b||0;Qa||(Qa=new hi5.tool.ResponseMonitor(function(){Wa&&m.sendPing()},function(){if(Wa&&m.onnoresponse)return m.onnoresponse()}));Qa.setInterval(a,b);var d=new Uint8Array(4);d[0]=146;d[1]=2;d[2]=a;d[3]=b;ta(d.buffer);setTimeout(function(){Qa&&Qa.check()},1E3*(a+b));Ma?Ma.postMessage({type:0,cmd:6,start:1}):(Ba.onSlowPath=Ba.onFastPath=Jc,Ba.onReqHistory=function(){Jc(15555)})};this.stopPing=
function(){Qa&&Qa.stop();Ma?Ma.postMessage({type:0,cmd:6,start:0}):Ba.onSlowPath=Ba.onFastPath=Ba.onReqHistory=null};var Ya=null,Pc=0;this.play=function(){ta("F3")};this.pause=function(){ta("F2")};this.scan=function(a){ta("F4"+(a?"1":"0"))};this.seek=function(a){var b=ba.getFocused();b&&Ia&&(ta("F4"+(a?"1":"0")+"\t"+(a/b.getScale().x|0)),ma.pause(!0))};var Ca={tag:0,channels:0,bitsPerSample:0,samplePerSec:22050,toStream:function(a){a.setLittleEndian16(this.tag);a.setLittleEndian16(this.channels);
a.setLittleEndian16(this.bitsPerSample);a.setLittleEndian32(this.samplePerSec)},fromStream:function(a){this.tag=a.getLittleEndian16();this.channels=a.getLittleEndian16();this.bitsPerSample=a.getLittleEndian16();this.samplePerSec=a.getLittleEndian32()}},Oc=!1;this.showMessage=function(a,b,d){m&&m.displayMsg&&a&&((b=b||ba.getFocused())?b.showMessage(a,d):("string"==typeof a&&(a={msg:a,timeout:d||0}),hi5.notifications.notify(a)))};this._unload=zb;this.close=function(){svGlobal.logger.info("closing...");
Ia&&Va&&ba&&da.closeRemoteApp&&ba.tryCloseRemoteApps();ma&&ma.isSendingHistory()?(svGlobal.logger.warn("In the middle of sending history, close delayed"),setTimeout(Rc,2222)):Rc()};hi5.browser.isChromeApp?chrome.runtime.onSuspend.addListener(m.close):window.addEventListener("unload",m.close,!1);oc.searchStartCode=function(a,b){for(var d=b[0]+2,e=a.length,c;d<e;)if(c=a[d],1==c){if(0==a[d-1]&&0==a[d-2]){b[1]=0==a[d-3]?4:3;b[0]=d-b[1]+1;return}d+=3}else 0==c?d++:d+=3;b[0]=-1};pc.SAMPLING_FREQUENCY=[96E3,
88200,64E3,48E3,44100,32E3,24E3,22050,16E3,12E3,11025,8E3,7350];Nb.isVideoSupported="MediaSource"in window&&MediaSource.isTypeSupported('video/mp4; codecs="avc1.42E01E, mp4a.40.2"');Nb.isAudioSupported="MediaSource"in window&&MediaSource.isTypeSupported('audio/mp4; codecs="mp4a.40.2"');svGlobal.DCVC_EXTENSION||(svGlobal.DCVC_EXTENSION={});svGlobal.DCVC_EXTENSION.GFX=function(a,b,d,e){function c(z,E,C,S){this.pixels=z;this.width=E;this.height=C;this.key=S}function f(z,E,C){this.width=z;this.height=
E;this.monitors=C}function n(){this.flags=this.bottom=this.right=this.top=this.left=0;this.read=function(z){this.left=z.getLittleEndian32();this.top=z.getLittleEndian32();this.right=z.getLittleEndian32();this.bottom=z.getLittleEndian32();this.flags=z.getLittleEndian32()};this.toString=function(){return"left: "+this.left+" top: "+this.top+" right: "+this.right+" bottom: "+this.bottom+" flags: "+this.flags}}function J(z,E,C){function S(){fa=!1;qa.drawable=document.createElement("video");X._player=new Nb(qa.drawable,
X,!1);X._player.onsps=function(ha){X.onsps&&X.onsps(ha)};X._player.onerror=function(ha){X.onfatalerror&&X.onfatalerror(X,ha)};X._player.onplayerror=function(ha){"AbortError"!=ha.name&&X.onmessage&&X.onmessage({msg:"Please click Yes to continue.<br>"+ha,cbYes:function(){X.player.play(!0);this.destroy()}})}}this.id=z;this.width=E;this.height=C;this.pixelFomrat=33;this.outputOriginY=this.outputOriginX=0;this.targetWidth=E;this.targetHeight=C;this._player=null;var X=this,Q=null,fa=!0,qa={drawable:null};
this.setDisplayBuffer=function(ha){Q=ha};this.draw=function(ha,ja,oa,sa){return fa?Q.draw(ha,ja,oa,sa):qa};this.processAvc=function(ha){fa&&S();X.onvideoframe(ha)};this.reset=function(ha,ja){X._player&&X._player.reset()};this.close=function(){X._player&&(X._player.close(),X._player=null);X=null};this.setRGBs=function(ha,ja,oa,sa,Ea,ka,ra){Q.setRGBs(ha,ja,oa,sa,Ea,ka,ra)};this.getRGBs=function(ha,ja,oa,sa){return Q.getRGBs(ha,ja,oa,sa)};this.moveArea=function(ha,ja,oa,sa,Ea,ka){Q.moveArea(ha,ja,oa,
sa,Ea,ka)};this.fillRect=function(ha,ja,oa,sa,Ea){Q.fillRect(ha,ja,oa,sa,Ea)};this.postPaint=function(ha,ja,oa,sa){fa&&Q.postPaint(ha,ja,oa,sa)}}function A(z,E){var C=z.getPosition(),S=z.getLittleEndian32();z.skipPosition(10*S);return z.getBytes(E-(z.getPosition()-C))}function H(z,E,C,S){C=z.getLittleEndian32();var X=C>>>30;C&=1073741823;switch(X){case 0:var Q=A(z,C);A(z,E-C-4);break;case 1:Q=A(z,C);break;case 2:E=z.getEnd()-z.getPosition();A(z,E);break;default:throw Error("Invalid LC: "+X);}Q&&L.processAvc(Q,
S)}var N=new function(){function z(W,na,wa,g,p){this.len=W;this.code=na;this.valueBits=wa;this.type=g;this.vbase=p}function E(W){var na=25E5-Q,wa=W.length;if(na>=wa)X.set(W,Q),Q=na>wa?Q+wa:0;else if(25E5>=wa)X.set(W.subarray(0,na),Q),X.set(W.subarray(na),0),Q=wa-na;else{na=(wa-na)%25E5;var g=wa-na,p=W.subarray(g);W=W.subarray(wa-25E5,g);X.set(W,25E5-W.length);X.set(p,0);Q=na}}function C(W){for(;oa<W;)ja<<=8,sa<ka?ja+=Ea[sa++]:console.log("--- end"),oa+=8;ha-=W;oa-=W;W=ja>>oa;ja&=(1<<oa)-1;return W}
var S=[new z(1,0,8,0,0),new z(5,17,5,1,0),new z(5,18,7,1,32),new z(5,19,9,1,160),new z(5,20,10,1,672),new z(5,21,12,1,1696),new z(5,24,0,0,0),new z(5,25,0,0,1),new z(6,44,14,1,5792),new z(6,45,15,1,22176),new z(6,52,0,0,2),new z(6,53,0,0,3),new z(6,54,0,0,255),new z(7,92,18,1,54944),new z(7,93,20,1,317088),new z(7,110,0,0,4),new z(7,111,0,0,5),new z(7,112,0,0,6),new z(7,113,0,0,7),new z(7,114,0,0,8),new z(7,115,0,0,9),new z(7,116,0,0,10),new z(7,117,0,0,11),new z(7,118,0,0,58),new z(7,119,0,0,59),
new z(7,120,0,0,60),new z(7,121,0,0,61),new z(7,122,0,0,62),new z(7,123,0,0,63),new z(7,124,0,0,64),new z(7,125,0,0,128),new z(8,188,20,1,1365664),new z(8,189,21,1,2414240),new z(8,252,0,0,12),new z(8,253,0,0,56),new z(8,254,0,0,57),new z(8,255,0,0,102),new z(9,380,22,1,4511392),new z(9,381,23,1,8705696),new z(9,382,24,1,17094304)],X=new Uint8Array(25E5),Q=0,fa=new Uint8Array(65536),qa=0,ha=0,ja=0,oa=0,sa=0,Ea=null,ka=0,ra=!0;this.toPDU=function(){if(ra)return null;var W=new Uint8Array(2500008);W[0]=
29;W[2]=1;W[3]=10;W[4]=Q;W[5]=Q>>8;W[6]=Q>>16;W[7]=Q>>24;W.set(X,8);return W};this.fromStream=function(W){Q=W.getLittleEndian32();X.set(W.getSubarray(25E5))};this.decompress=function(W,na){if(na){Ea=W;ra&&(ra=!1);ka=Ea.length-1;ha=8*ka-Ea[ka];for(qa=sa=oa=ja=0;0<ha;)for(var wa=na=0,g=0;g<S.length;g++){for(W=S[g];na<W.len;)wa=(wa<<1)+C(1),na++;0>wa&&console.log("xxx inPrefix");if(wa==W.code){if(0==W.type)W=W.vbase+C(W.valueBits),(0>W||255<W)&&console.log("xxx do c"),W&=255,X[Q]=W,25E5==++Q&&(Q=0),
fa[qa++]=W;else if(na=C(W.valueBits),na=W.vbase+na,0>na&&console.log("xxx distance"),0!=na){if(0==C(1))W=3;else{W=4;for(wa=2;1==C(1);)W*=2,wa++;W+=C(wa)}na=25E5-na+Q;na%=25E5;wa=na+W;if(Math.abs(Q-na)>=W&&25E5>wa&&25E5>Q+W)na=X.subarray(na,wa),X.set(na,Q),Q+=W,fa.set(na,qa),qa+=W;else for(;0<W;)wa=X[na],25E5==++na&&(na=0),X[Q]=wa,25E5==++Q&&(Q=0),fa[qa++]=wa,W--}else W=C(15),ha-=oa,ja=oa=0,na=Ea.subarray(sa,sa+W),E(na),fa.set(na,qa),sa+=W,qa+=W,ha-=8*W;break}}65536<qa&&console.error("xx outputIndex:"+
qa);return fa.subarray(0,qa)}E(W);return W}},v=new function(){this.process=function(z){var E=z.getByte();if(224==E){var C=0!=(z.getByte()&32);var S=z.getPosition(),X=z.getEnd();E=N.decompress(z.getData().subarray(S,X),C);z.setPosition(X)}else{225!=E&&console.log("Invalid descriptor:"+E);X=z.getLittleEndian16();var Q=z.getLittleEndian32();E=new Uint8Array(Q);for(var fa=0,qa,ha=0;ha<X;ha++)qa=z.getLittleEndian32(),C=0!=(z.getByte()&32),qa--,S=z.getPosition(),C=N.decompress(z.getData().subarray(S,S+
qa),C),E.set(C,fa),fa+=C.length,z.skipPosition(qa);fa!=Q&&console.error("wrong size, actual:"+fa+" expected:"+Q)}return new RdpBuffer(E,0,E.length)}},x=null,u=new rdpcodecs.RemoteFX(!1),r=0,w=[],t=new a;t.name="Microsoft::Windows::RDS::Graphics";var L=new function(z){var E=[];this.push=function(C){C.osps=z.onsps;C.onfatalerror=z.onfatalerror;C.onplayerror=z.onplayerror;E[C.id]=C};this.get=function(C){return E[C]};this.delete=function(C){var S=E[C];S.onsps=null;S.onfatalerror=null;S.onplayerror=null;
E[C]=null};this.reset=function(C){C=0;for(var S=E.length;C<S;C++)E[C]&&E[C].reset()};this.processAvc=function(C,S){E[S].processAvc(C)};this.close=function(){for(var C=0,S=E.length;C<S;C++)E[C]&&E[C].close()}}(t);t.controller=new function(){this.draw=function(z,E,C,S,X){return(X=L.get(X))?X.draw(z,E,C,S):null};this.onfocus=function(z){}};t.process=function(z){for(var E=v.process(z);E.has(8);){var C=E.getLittleEndian16();E.getLittleEndian16();var S=E.getLittleEndian32(),X=E.getPosition()+S-8;switch(C){case 1:var Q=
E,fa=Q.getLittleEndian16(),qa=Q.getLittleEndian16();Q.getByte();var ha=Q.getLittleEndian16(),ja=Q.getLittleEndian16(),oa=Q.getLittleEndian16(),sa=Q.getLittleEndian16(),Ea=oa-ha,ka=sa-ja,ra=Q.getLittleEndian32(),W=Q.getPosition()+ra,na=L.get(fa);switch(qa){case 0:var wa=rdpcodecs.bitmap.byte2int(Q.getData(),ra,Q.getPosition());na.setRGBs(ha,ja,Ea,ka,wa,0,Ea);break;case 3:for(var g=u.decode(Q,ra),p=g.getRects(),k=g.getTiles(),q=g.getTileSize(),y=g.getRectSize(),B=0;B<q;B++){var D=k[B];if(y)for(var F=
D.x+64,G=D.y+64,V=0;V<y;V++){var M=p[V],h=M.x+M.width,K=M.y+M.height;F<=h?G<=K?na.setRGBs(D.x+ha,D.y+ja,64,64,D.data,0,64):na.setRGBs(D.x+ha,D.y+ja,64,K-D.y,D.data,0,64):G<=K?na.setRGBs(D.x+ha,D.y+ja,h-D.x,64,D.data,0,64):na.setRGBs(D.x+ha,D.y+ja,h-D.x,K-D.y,D.data,0,64)}else na.setRGBs(D.x,D.y,64,64,D.data,0,4)}break;case 8:x||(x=new ClearDecoder);x.decode(Q,Ea,ka,na.getData(),ha,ja,na.width);break;case 10:svGlobal.logger.info("...PLANAR");break;case 11:var O=fa,R=A(Q,ra);L.processAvc(R,O);break;
case 12:svGlobal.logger.info("...ALPHA");break;case 14:H(Q,ra,!1,fa);break;case 15:H(Q,ra,!0,fa);break;default:svGlobal.logger.warn("Invalid codec:"+qa)}Q.setPosition(W);na.postPaint(ha,ja,Ea,ka);break;case 2:svGlobal.logger.info("RDPGFX_WIRE_TO_SURFACE_PDU_2");break;case 3:svGlobal.logger.info("RDPGFX_CMDID_DELETEENCODINGCONTEXT");break;case 4:var Y=E;svGlobal.logger.info("...soliFill");for(var la=Y.getLittleEndian16(),Aa=-16777216|Y.getByte()<<16|Y.getByte()<<8|Y.getByte()|Y.getByte()<<24,Ga=Y.getLittleEndian16(),
La=L.get(la),Da=0;Da<Ga;Da++){var xa=Y.getLittleEndian16(),Pa=Y.getLittleEndian16(),va=Y.getLittleEndian16()-xa,ya=Y.getLittleEndian16()-Pa;La.fillRect(xa,Pa,va,ya,Aa);La.postPaint(xa,Pa,va,ya)}break;case 5:var Ha=E;svGlobal.logger.info("...surfaceToSurface");for(var Za=Ha.getLittleEndian16(),$a=Ha.getLittleEndian16(),Xa=Ha.getLittleEndian16(),gb=Ha.getLittleEndian16(),mb=Ha.getLittleEndian16()-Xa,sc=Ha.getLittleEndian16()-gb,Sd=Ha.getLittleEndian16(),Zc=L.get(Za),Td=L.get($a),$c=Za==$a?null:Zc.getRGBs(Xa,
gb,mb,sc),ad=0;ad<Sd;ad++){var bd=Ha.getLittleEndian16(),cd=Ha.getLittleEndian16();$c?Td.setRGBs(bd,cd,mb,sc,$c,0,mb):Zc.moveArea(Xa,gb,mb,sc,bd-Xa,cd-gb)}break;case 6:var ob=E;svGlobal.logger.info("...surfaceToCache");var Ud=ob.getLittleEndian16(),tc=ob.getLittleEndian32().toString(16),dd=ob.getLittleEndian32();0<dd&&(tc=dd.toString(16)+tc);var Vd=ob.getLittleEndian16(),ed=ob.getLittleEndian16(),fd=ob.getLittleEndian16(),gd=ob.getLittleEndian16()-ed,hd=ob.getLittleEndian16()-fd,Wd=L.get(Ud).getRGBs(ed,
fd,gd,hd);w[Vd]=new c(Wd,gd,hd,tc);break;case 7:var Db=E;svGlobal.logger.info("...cacheToSurface");for(var Xd=Db.getLittleEndian16(),Yd=Db.getLittleEndian16(),Zd=Db.getLittleEndian16(),Pb=w[Xd],$d=L.get(Yd),id=0;id<Zd;id++){var ae=Db.getLittleEndian16(),be=Db.getLittleEndian16();$d.setRGBs(ae,be,Pb.width,Pb.height,Pb.pixels,0,Pb.width)}break;case 8:var ce=E.getLittleEndian16();w[ce]=null;break;case 9:var Qb=E,jd=Qb.getLittleEndian16(),kd=Qb.getLittleEndian16(),ld=Qb.getLittleEndian16(),Eb=new J(jd,
kd,ld);Eb.pixelFormat=Qb.getByte();Eb.setDisplayBuffer(e);L.push(Eb);t.oncreatesurface&&t.oncreatesurface(Eb);svGlobal.logger.info("create surface id:"+jd+" w:"+kd+" h:"+ld+" pixelFmt:"+Eb.pixelFormat);break;case 10:var md=E.getLittleEndian16();L.delete(md);svGlobal.logger.info("delete surface id:"+md);break;case 11:var nd=E;nd.getLittleEndian32();nd.getLittleEndian32();break;case 12:var de=E.getLittleEndian32();if(0==r){var od=new Uint8Array(20),xb=new RdpBuffer(od);xb.setLittleEndian16(13);xb.setLittleEndian16(0);
xb.setLittleEndian32(20);xb.setLittleEndian32(4294967295);xb.setLittleEndian32(de);r++;xb.setLittleEndian32(r);d&&t.send(od)}break;case 14:var Rb=E,pd=Rb.getLittleEndian32(),qd=Rb.getLittleEndian32(),uc=Rb.getLittleEndian32();svGlobal.logger.info("reset graphic, w:"+pd+" h:"+qd+" monitors:"+uc);for(var rd=Array(uc),Sb=0;Sb<uc;Sb++){var vc=new n;vc.read(Rb);rd[Sb]=vc;svGlobal.logger.info("MonitorDef "+Sb+": "+vc.toString())}var sd=new f(pd,qd,rd);L.reset(sd);t.onresetgraphic&&t.onresetgraphic(sd);
break;case 15:var Tb=E,td=Tb.getLittleEndian16();Tb.skipPosition(2);var Fb=L.get(td);Fb.outputOriginX=Tb.getLittleEndian32();Fb.outputOriginY=Tb.getLittleEndian32();t.onmapsurface&&t.onmapsurface(Fb);svGlobal.logger.info("mapSurfaceToScaledOutput, outputSurfaceId:"+td+" outX:"+Fb.outputOriginX+" outY:"+Fb.outputOriginY);break;case 17:svGlobal.logger.info("TODO: DPGFX_CACHE_IMPORT_REPLY_PDU");break;case 19:var wc=E,ud=wc.getLittleEndian32(),ee=wc.getLittleEndian32(),Gb=wc.getLittleEndian32(),Ub=!1;
switch(ud){case 524292:Ub=!1;0==(Gb&1)&&(x=new ClearDecoder);break;case 524549:(Ub=0!=(Gb&16))||0!=(Gb&1)||(x=new ClearDecoder);break;default:Ub=0==(Gb&32)}svGlobal.logger.info("Gfx Cap, Ver:"+ud.toString(16)+" len:"+ee+" flags:"+Gb+" h264:"+Ub);t.onconfirm&&t.onconfirm();break;case 21:svGlobal.logger.info("mapSurfaceToWin");break;case 22:break;case 23:var yb=E,vd=yb.getLittleEndian16();yb.skipPosition(2);var ib=L.get(vd);ib.outputOriginX=yb.getLittleEndian32();ib.outputOriginY=yb.getLittleEndian32();
ib.targetWidth=yb.getLittleEndian32();ib.targetHeight=yb.getLittleEndian32();svGlobal.logger.info("mapSurfaceToScaledOutput, outputSurfaceId:"+vd+" outX:"+ib.outputOriginX+" outY:"+ib.outputOriginY+" targetW:"+ib.targetWidth+" targetH:"+ib.targetHeight);t.onmapsurface&&t.onmapsurface(ib);break;case 24:svGlobal.logger.info("TODO: mapSurfaceToScaledWin");break;default:svGlobal.logger.warn("xxx gfx:"+C);return}E.setPosition(X)}};t.onopen=function(){svGlobal.logger.info("GFX Open, remotefx:"+b);var z=
b?2:8,E=120*z,C=new Uint8Array(E),S=new RdpBuffer(C);S.setLittleEndian16(18);S.setLittleEndian16(0);S.setLittleEndian32(E);S.setLittleEndian16(z);S.setLittleEndian32(524292);S.setLittleEndian32(4);S.setLittleEndian32(1);S.setLittleEndian32(524549);S.setLittleEndian32(4);S.setLittleEndian32(19);b||(S.setLittleEndian32(655362),S.setLittleEndian32(4),S.setLittleEndian32(0),S.setLittleEndian32(655872),S.setLittleEndian32(4),S.setLittleEndian32(0),S.setLittleEndian32(656129),S.setLittleEndian32(4),S.setLittleEndian32(0),
S.setLittleEndian32(656384),S.setLittleEndian32(4),S.setLittleEndian32(0),S.setLittleEndian32(656642),S.setLittleEndian32(4),S.setLittleEndian32(0),S.setLittleEndian32(656896),S.setLittleEndian32(4),S.setLittleEndian32(0));S.markEnd();d&&t.send(C)};t.onclose=function(){L.close()};e.onGetGfxHistory=function(z,E){var C=N.toPDU();C&&z(C);E();svGlobal.logger.info("Get GFX Histroy")};e.onSetGfxHistory=function(z,E){svGlobal.logger.info("Set GFX Histroy");10==z?N.fromStream(E):svGlobal.logger.error("Invalid GFX histroy type: "+
z)};return t}}
Rdp.languageToKeyboard={af:0,sq:0,ar:1025,"ar-SA":1025,"ar-IQ":0,"ar-EG":0,"ar-LY":0,"ar-DZ":0,"ar-MA":0,"ar-TN":0,"ar-OM":0,"ar-YE":0,"ar-SY":0,"ar-JO":0,"ar-LB":0,"ar-KW":0,"ar-AE":0,"ar-BH":0,"ar-QA":0,eu:0,bg:0,be:0,ca:0,zh:2052,"zh-TW":1028,"zh-CN":2052,"zh-HK":1028,"zh-SG":2052,hr:0,cs:0,da:0,nl:1043,"nl-BE":2067,en:1033,"en-US":1033,"en-GB":2057,"en-AU":0,"en-CA":4105,"en-NA":0,"en-IE":0,"en-ZA":0,"en-JM":0,"en-BZ":0,et:0,fo:0,fa:0,fi:0,fr:1036,"fr-BE":2060,"fr-CA":3084,"fr-CH":4108,"fr-LU":0,
gd:0,"gd-IE":0,de:1031,"de-CH":2055,"de-AT":0,"de-LU":0,"de-LI":0,el:0,he:1037,hi:0,hu:0,is:1039,id:0,it:1040,"it-CH":66576,ja:3758162961,ko:3758162962,lv:0,lt:0,mk:0,mt:0,nb:1044,nn:1083,no:1044,pl:1045,pt:2070,"pt-BR":1046,rm:0,ro:0,"ro-MO":0,ru:1049,"ru-MO":0,sr:0,sk:0,sl:0,sb:0,es:1034,"es-AR":0,"es-GT":0,"es-CR":0,"es-PA":0,"es-DO":0,"es-MX":2058,"es-VE":0,"es-CO":0,"es-PE":0,"es-EC":0,"es-CL":0,"es-UY":0,"es-PY":0,"es-BO":0,"es-SV":0,"es-HN":0,"es-NI":0,"es-PR":0,sx:0,sv:1053,"sv-FI":0,th:0,
ts:0,tn:0,tr:1055,uk:0,ur:0,ve:0,vi:0,xh:0,ji:0,zu:0,detect:function(){var l=navigator&&(navigator.language||navigator.userLanguage||""),I=Rdp.languageToKeyboard[l];if(!I){var U=l.indexOf("-");U&&(I=Rdp.languageToKeyboard[l.substring(0,U)])}I||(svGlobal.logger.info("No valid layout for "+l),I=1033);return I}};svGlobal.Rdp||(svGlobal.Rdp=Rdp);var RdpBuffer=hi5.DataBuffer;
