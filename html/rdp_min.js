var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.arrayIteratorImpl=function(n){var J=0;return function(){return J<n.length?{done:!1,value:n[J++]}:{done:!0}}};$jscomp.arrayIterator=function(n){return{next:$jscomp.arrayIteratorImpl(n)}};$jscomp.makeIterator=function(n){var J="undefined"!=typeof Symbol&&Symbol.iterator&&n[Symbol.iterator];return J?J.call(n):$jscomp.arrayIterator(n)};$jscomp.arrayFromIterator=function(n){for(var J,X=[];!(J=n.next()).done;)X.push(J.value);return X};
$jscomp.arrayFromIterable=function(n){return n instanceof Array?n:$jscomp.arrayFromIterator($jscomp.makeIterator(n))};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.SIMPLE_FROUND_POLYFILL=!1;$jscomp.ISOLATE_POLYFILLS=!1;$jscomp.FORCE_POLYFILL_PROMISE=!1;$jscomp.FORCE_POLYFILL_PROMISE_WHEN_NO_UNHANDLED_REJECTION=!1;$jscomp.objectCreate=$jscomp.ASSUME_ES5||"function"==typeof Object.create?Object.create:function(n){var J=function(){};J.prototype=n;return new J};
$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(n,J,X){if(n==Array.prototype||n==Object.prototype)return n;n[J]=X.value;return n};$jscomp.getGlobal=function(n){n=["object"==typeof globalThis&&globalThis,n,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof global&&global];for(var J=0;J<n.length;++J){var X=n[J];if(X&&X.Math==Math)return X}throw Error("Cannot find global object");};$jscomp.global=$jscomp.getGlobal(this);
$jscomp.IS_SYMBOL_NATIVE="function"===typeof Symbol&&"symbol"===typeof Symbol("x");$jscomp.TRUST_ES6_POLYFILLS=!$jscomp.ISOLATE_POLYFILLS||$jscomp.IS_SYMBOL_NATIVE;$jscomp.polyfills={};$jscomp.propertyToPolyfillSymbol={};$jscomp.POLYFILL_PREFIX="$jscp$";var $jscomp$lookupPolyfilledValue=function(n,J){var X=$jscomp.propertyToPolyfillSymbol[J];if(null==X)return n[J];X=n[X];return void 0!==X?X:n[J]};
$jscomp.polyfill=function(n,J,X,ha){J&&($jscomp.ISOLATE_POLYFILLS?$jscomp.polyfillIsolated(n,J,X,ha):$jscomp.polyfillUnisolated(n,J,X,ha))};$jscomp.polyfillUnisolated=function(n,J,X,ha){X=$jscomp.global;n=n.split(".");for(ha=0;ha<n.length-1;ha++){var V=n[ha];if(!(V in X))return;X=X[V]}n=n[n.length-1];ha=X[n];J=J(ha);J!=ha&&null!=J&&$jscomp.defineProperty(X,n,{configurable:!0,writable:!0,value:J})};
$jscomp.polyfillIsolated=function(n,J,X,ha){var V=n.split(".");n=1===V.length;ha=V[0];ha=!n&&ha in $jscomp.polyfills?$jscomp.polyfills:$jscomp.global;for(var ta=0;ta<V.length-1;ta++){var Z=V[ta];if(!(Z in ha))return;ha=ha[Z]}V=V[V.length-1];X=$jscomp.IS_SYMBOL_NATIVE&&"es6"===X?ha[V]:null;J=J(X);null!=J&&(n?$jscomp.defineProperty($jscomp.polyfills,V,{configurable:!0,writable:!0,value:J}):J!==X&&($jscomp.propertyToPolyfillSymbol[V]=$jscomp.IS_SYMBOL_NATIVE?$jscomp.global.Symbol(V):$jscomp.POLYFILL_PREFIX+
V,V=$jscomp.propertyToPolyfillSymbol[V],$jscomp.defineProperty(ha,V,{configurable:!0,writable:!0,value:J})))};
$jscomp.getConstructImplementation=function(){function n(){function X(){}new X;Reflect.construct(X,[],function(){});return new X instanceof X}if($jscomp.TRUST_ES6_POLYFILLS&&"undefined"!=typeof Reflect&&Reflect.construct){if(n())return Reflect.construct;var J=Reflect.construct;return function(X,ha,V){X=J(X,ha);V&&Reflect.setPrototypeOf(X,V.prototype);return X}}return function(X,ha,V){void 0===V&&(V=X);V=$jscomp.objectCreate(V.prototype||Object.prototype);return Function.prototype.apply.call(X,V,ha)||
V}};$jscomp.construct={valueOf:$jscomp.getConstructImplementation}.valueOf();$jscomp.underscoreProtoCanBeSet=function(){var n={a:!0},J={};try{return J.__proto__=n,J.a}catch(X){}return!1};$jscomp.setPrototypeOf=$jscomp.TRUST_ES6_POLYFILLS&&"function"==typeof Object.setPrototypeOf?Object.setPrototypeOf:$jscomp.underscoreProtoCanBeSet()?function(n,J){n.__proto__=J;if(n.__proto__!==J)throw new TypeError(n+" is not extensible");return n}:null;
$jscomp.inherits=function(n,J){n.prototype=$jscomp.objectCreate(J.prototype);n.prototype.constructor=n;if($jscomp.setPrototypeOf){var X=$jscomp.setPrototypeOf;X(n,J)}else for(X in J)if("prototype"!=X)if(Object.defineProperties){var ha=Object.getOwnPropertyDescriptor(J,X);ha&&Object.defineProperty(n,X,ha)}else n[X]=J[X];n.superClass_=J.prototype};$jscomp.generator={};
$jscomp.generator.ensureIteratorResultIsObject_=function(n){if(!(n instanceof Object))throw new TypeError("Iterator result "+n+" is not an object");};$jscomp.generator.Context=function(){this.isRunning_=!1;this.yieldAllIterator_=null;this.yieldResult=void 0;this.nextAddress=1;this.finallyAddress_=this.catchAddress_=0;this.finallyContexts_=this.abruptCompletion_=null};
$jscomp.generator.Context.prototype.start_=function(){if(this.isRunning_)throw new TypeError("Generator is already running");this.isRunning_=!0};$jscomp.generator.Context.prototype.stop_=function(){this.isRunning_=!1};$jscomp.generator.Context.prototype.jumpToErrorHandler_=function(){this.nextAddress=this.catchAddress_||this.finallyAddress_};$jscomp.generator.Context.prototype.next_=function(n){this.yieldResult=n};
$jscomp.generator.Context.prototype.throw_=function(n){this.abruptCompletion_={exception:n,isException:!0};this.jumpToErrorHandler_()};$jscomp.generator.Context.prototype.return=function(n){this.abruptCompletion_={return:n};this.nextAddress=this.finallyAddress_};$jscomp.generator.Context.prototype.jumpThroughFinallyBlocks=function(n){this.abruptCompletion_={jumpTo:n};this.nextAddress=this.finallyAddress_};$jscomp.generator.Context.prototype.yield=function(n,J){this.nextAddress=J;return{value:n}};
$jscomp.generator.Context.prototype.yieldAll=function(n,J){n=$jscomp.makeIterator(n);var X=n.next();$jscomp.generator.ensureIteratorResultIsObject_(X);if(X.done)this.yieldResult=X.value,this.nextAddress=J;else return this.yieldAllIterator_=n,this.yield(X.value,J)};$jscomp.generator.Context.prototype.jumpTo=function(n){this.nextAddress=n};$jscomp.generator.Context.prototype.jumpToEnd=function(){this.nextAddress=0};
$jscomp.generator.Context.prototype.setCatchFinallyBlocks=function(n,J){this.catchAddress_=n;void 0!=J&&(this.finallyAddress_=J)};$jscomp.generator.Context.prototype.setFinallyBlock=function(n){this.catchAddress_=0;this.finallyAddress_=n||0};$jscomp.generator.Context.prototype.leaveTryBlock=function(n,J){this.nextAddress=n;this.catchAddress_=J||0};
$jscomp.generator.Context.prototype.enterCatchBlock=function(n){this.catchAddress_=n||0;n=this.abruptCompletion_.exception;this.abruptCompletion_=null;return n};$jscomp.generator.Context.prototype.enterFinallyBlock=function(n,J,X){X?this.finallyContexts_[X]=this.abruptCompletion_:this.finallyContexts_=[this.abruptCompletion_];this.catchAddress_=n||0;this.finallyAddress_=J||0};
$jscomp.generator.Context.prototype.leaveFinallyBlock=function(n,J){J=this.finallyContexts_.splice(J||0)[0];if(J=this.abruptCompletion_=this.abruptCompletion_||J){if(J.isException)return this.jumpToErrorHandler_();void 0!=J.jumpTo&&this.finallyAddress_<J.jumpTo?(this.nextAddress=J.jumpTo,this.abruptCompletion_=null):this.nextAddress=this.finallyAddress_}else this.nextAddress=n};$jscomp.generator.Context.prototype.forIn=function(n){return new $jscomp.generator.Context.PropertyIterator(n)};
$jscomp.generator.Context.PropertyIterator=function(n){this.object_=n;this.properties_=[];for(var J in n)this.properties_.push(J);this.properties_.reverse()};$jscomp.generator.Context.PropertyIterator.prototype.getNext=function(){for(;0<this.properties_.length;){var n=this.properties_.pop();if(n in this.object_)return n}return null};$jscomp.generator.Engine_=function(n){this.context_=new $jscomp.generator.Context;this.program_=n};
$jscomp.generator.Engine_.prototype.next_=function(n){this.context_.start_();if(this.context_.yieldAllIterator_)return this.yieldAllStep_(this.context_.yieldAllIterator_.next,n,this.context_.next_);this.context_.next_(n);return this.nextStep_()};
$jscomp.generator.Engine_.prototype.return_=function(n){this.context_.start_();var J=this.context_.yieldAllIterator_;if(J)return this.yieldAllStep_("return"in J?J["return"]:function(X){return{value:X,done:!0}},n,this.context_.return);this.context_.return(n);return this.nextStep_()};
$jscomp.generator.Engine_.prototype.throw_=function(n){this.context_.start_();if(this.context_.yieldAllIterator_)return this.yieldAllStep_(this.context_.yieldAllIterator_["throw"],n,this.context_.next_);this.context_.throw_(n);return this.nextStep_()};
$jscomp.generator.Engine_.prototype.yieldAllStep_=function(n,J,X){try{var ha=n.call(this.context_.yieldAllIterator_,J);$jscomp.generator.ensureIteratorResultIsObject_(ha);if(!ha.done)return this.context_.stop_(),ha;var V=ha.value}catch(ta){return this.context_.yieldAllIterator_=null,this.context_.throw_(ta),this.nextStep_()}this.context_.yieldAllIterator_=null;X.call(this.context_,V);return this.nextStep_()};
$jscomp.generator.Engine_.prototype.nextStep_=function(){for(;this.context_.nextAddress;)try{var n=this.program_(this.context_);if(n)return this.context_.stop_(),{value:n.value,done:!1}}catch(J){this.context_.yieldResult=void 0,this.context_.throw_(J)}this.context_.stop_();if(this.context_.abruptCompletion_){n=this.context_.abruptCompletion_;this.context_.abruptCompletion_=null;if(n.isException)throw n.exception;return{value:n.return,done:!0}}return{value:void 0,done:!0}};
$jscomp.generator.Generator_=function(n){this.next=function(J){return n.next_(J)};this.throw=function(J){return n.throw_(J)};this.return=function(J){return n.return_(J)};this[Symbol.iterator]=function(){return this}};$jscomp.generator.createGenerator=function(n,J){J=new $jscomp.generator.Generator_(new $jscomp.generator.Engine_(J));$jscomp.setPrototypeOf&&n.prototype&&$jscomp.setPrototypeOf(J,n.prototype);return J};
$jscomp.asyncExecutePromiseGenerator=function(n){function J(ha){return n.next(ha)}function X(ha){return n.throw(ha)}return new Promise(function(ha,V){function ta(Z){Z.done?ha(Z.value):Promise.resolve(Z.value).then(J,X).then(ta,V)}ta(n.next())})};$jscomp.asyncExecutePromiseGeneratorFunction=function(n){return $jscomp.asyncExecutePromiseGenerator(n())};$jscomp.asyncExecutePromiseGeneratorProgram=function(n){return $jscomp.asyncExecutePromiseGenerator(new $jscomp.generator.Generator_(new $jscomp.generator.Engine_(n)))};
$jscomp.polyfill("Reflect",function(n){return n?n:{}},"es6","es3");$jscomp.polyfill("Reflect.construct",function(n){return $jscomp.construct},"es6","es3");$jscomp.polyfill("Reflect.setPrototypeOf",function(n){if(n)return n;if($jscomp.setPrototypeOf){var J=$jscomp.setPrototypeOf;return function(X,ha){try{return J(X,ha),!0}catch(V){return!1}}}return null},"es6","es5");$jscomp.initSymbol=function(){};
$jscomp.polyfill("Symbol",function(n){if(n)return n;var J=function(V,ta){this.$jscomp$symbol$id_=V;$jscomp.defineProperty(this,"description",{configurable:!0,writable:!0,value:ta})};J.prototype.toString=function(){return this.$jscomp$symbol$id_};var X=0,ha=function(V){if(this instanceof ha)throw new TypeError("Symbol is not a constructor");return new J("jscomp_symbol_"+(V||"")+"_"+X++,V)};return ha},"es6","es3");
$jscomp.polyfill("Symbol.iterator",function(n){if(n)return n;n=Symbol("Symbol.iterator");for(var J="Array Int8Array Uint8Array Uint8ClampedArray Int16Array Uint16Array Int32Array Uint32Array Float32Array Float64Array".split(" "),X=0;X<J.length;X++){var ha=$jscomp.global[J[X]];"function"===typeof ha&&"function"!=typeof ha.prototype[n]&&$jscomp.defineProperty(ha.prototype,n,{configurable:!0,writable:!0,value:function(){return $jscomp.iteratorPrototype($jscomp.arrayIteratorImpl(this))}})}return n},"es6",
"es3");$jscomp.iteratorPrototype=function(n){n={next:n};n[Symbol.iterator]=function(){return this};return n};
$jscomp.polyfill("Promise",function(n){function J(){this.batch_=null}function X(Z){return Z instanceof V?Z:new V(function(ra,aa){ra(Z)})}if(n&&(!($jscomp.FORCE_POLYFILL_PROMISE||$jscomp.FORCE_POLYFILL_PROMISE_WHEN_NO_UNHANDLED_REJECTION&&"undefined"===typeof $jscomp.global.PromiseRejectionEvent)||!$jscomp.global.Promise||-1===$jscomp.global.Promise.toString().indexOf("[native code]")))return n;J.prototype.asyncExecute=function(Z){if(null==this.batch_){this.batch_=[];var ra=this;this.asyncExecuteFunction(function(){ra.executeBatch_()})}this.batch_.push(Z)};
var ha=$jscomp.global.setTimeout;J.prototype.asyncExecuteFunction=function(Z){ha(Z,0)};J.prototype.executeBatch_=function(){for(;this.batch_&&this.batch_.length;){var Z=this.batch_;this.batch_=[];for(var ra=0;ra<Z.length;++ra){var aa=Z[ra];Z[ra]=null;try{aa()}catch(da){this.asyncThrow_(da)}}}this.batch_=null};J.prototype.asyncThrow_=function(Z){this.asyncExecuteFunction(function(){throw Z;})};var V=function(Z){this.state_=0;this.result_=void 0;this.onSettledCallbacks_=[];this.isRejectionHandled_=
!1;var ra=this.createResolveAndReject_();try{Z(ra.resolve,ra.reject)}catch(aa){ra.reject(aa)}};V.prototype.createResolveAndReject_=function(){function Z(da){return function(la){aa||(aa=!0,da.call(ra,la))}}var ra=this,aa=!1;return{resolve:Z(this.resolveTo_),reject:Z(this.reject_)}};V.prototype.resolveTo_=function(Z){if(Z===this)this.reject_(new TypeError("A Promise cannot resolve to itself"));else if(Z instanceof V)this.settleSameAsPromise_(Z);else{a:switch(typeof Z){case "object":var ra=null!=Z;break a;
case "function":ra=!0;break a;default:ra=!1}ra?this.resolveToNonPromiseObj_(Z):this.fulfill_(Z)}};V.prototype.resolveToNonPromiseObj_=function(Z){var ra=void 0;try{ra=Z.then}catch(aa){this.reject_(aa);return}"function"==typeof ra?this.settleSameAsThenable_(ra,Z):this.fulfill_(Z)};V.prototype.reject_=function(Z){this.settle_(2,Z)};V.prototype.fulfill_=function(Z){this.settle_(1,Z)};V.prototype.settle_=function(Z,ra){if(0!=this.state_)throw Error("Cannot settle("+Z+", "+ra+"): Promise already settled in state"+
this.state_);this.state_=Z;this.result_=ra;2===this.state_&&this.scheduleUnhandledRejectionCheck_();this.executeOnSettledCallbacks_()};V.prototype.scheduleUnhandledRejectionCheck_=function(){var Z=this;ha(function(){if(Z.notifyUnhandledRejection_()){var ra=$jscomp.global.console;"undefined"!==typeof ra&&ra.error(Z.result_)}},1)};V.prototype.notifyUnhandledRejection_=function(){if(this.isRejectionHandled_)return!1;var Z=$jscomp.global.CustomEvent,ra=$jscomp.global.Event,aa=$jscomp.global.dispatchEvent;
if("undefined"===typeof aa)return!0;"function"===typeof Z?Z=new Z("unhandledrejection",{cancelable:!0}):"function"===typeof ra?Z=new ra("unhandledrejection",{cancelable:!0}):(Z=$jscomp.global.document.createEvent("CustomEvent"),Z.initCustomEvent("unhandledrejection",!1,!0,Z));Z.promise=this;Z.reason=this.result_;return aa(Z)};V.prototype.executeOnSettledCallbacks_=function(){if(null!=this.onSettledCallbacks_){for(var Z=0;Z<this.onSettledCallbacks_.length;++Z)ta.asyncExecute(this.onSettledCallbacks_[Z]);
this.onSettledCallbacks_=null}};var ta=new J;V.prototype.settleSameAsPromise_=function(Z){var ra=this.createResolveAndReject_();Z.callWhenSettled_(ra.resolve,ra.reject)};V.prototype.settleSameAsThenable_=function(Z,ra){var aa=this.createResolveAndReject_();try{Z.call(ra,aa.resolve,aa.reject)}catch(da){aa.reject(da)}};V.prototype.then=function(Z,ra){function aa(Oa,sa){return"function"==typeof Oa?function(rb){try{da(Oa(rb))}catch(nb){la(nb)}}:sa}var da,la,Aa=new V(function(Oa,sa){da=Oa;la=sa});this.callWhenSettled_(aa(Z,
da),aa(ra,la));return Aa};V.prototype.catch=function(Z){return this.then(void 0,Z)};V.prototype.callWhenSettled_=function(Z,ra){function aa(){switch(da.state_){case 1:Z(da.result_);break;case 2:ra(da.result_);break;default:throw Error("Unexpected state: "+da.state_);}}var da=this;null==this.onSettledCallbacks_?ta.asyncExecute(aa):this.onSettledCallbacks_.push(aa);this.isRejectionHandled_=!0};V.resolve=X;V.reject=function(Z){return new V(function(ra,aa){aa(Z)})};V.race=function(Z){return new V(function(ra,
aa){for(var da=$jscomp.makeIterator(Z),la=da.next();!la.done;la=da.next())X(la.value).callWhenSettled_(ra,aa)})};V.all=function(Z){var ra=$jscomp.makeIterator(Z),aa=ra.next();return aa.done?X([]):new V(function(da,la){function Aa(rb){return function(nb){Oa[rb]=nb;sa--;0==sa&&da(Oa)}}var Oa=[],sa=0;do Oa.push(void 0),sa++,X(aa.value).callWhenSettled_(Aa(Oa.length-1),la),aa=ra.next();while(!aa.done)})};return V},"es6","es3");
$jscomp.checkStringArgs=function(n,J,X){if(null==n)throw new TypeError("The 'this' value for String.prototype."+X+" must not be null or undefined");if(J instanceof RegExp)throw new TypeError("First argument to String.prototype."+X+" must not be a regular expression");return n+""};
$jscomp.polyfill("String.prototype.startsWith",function(n){return n?n:function(J,X){var ha=$jscomp.checkStringArgs(this,J,"startsWith");J+="";var V=ha.length,ta=J.length;X=Math.max(0,Math.min(X|0,ha.length));for(var Z=0;Z<ta&&X<V;)if(ha[X++]!=J[Z++])return!1;return Z>=ta}},"es6","es3");
$jscomp.iteratorFromArray=function(n,J){n instanceof String&&(n+="");var X=0,ha=!1,V={next:function(){if(!ha&&X<n.length){var ta=X++;return{value:J(ta,n[ta]),done:!1}}ha=!0;return{done:!0,value:void 0}}};V[Symbol.iterator]=function(){return V};return V};$jscomp.polyfill("Array.prototype.keys",function(n){return n?n:function(){return $jscomp.iteratorFromArray(this,function(J){return J})}},"es6","es3");
$jscomp.polyfill("Array.from",function(n){return n?n:function(J,X,ha){X=null!=X?X:function(ra){return ra};var V=[],ta="undefined"!=typeof Symbol&&Symbol.iterator&&J[Symbol.iterator];if("function"==typeof ta){J=ta.call(J);for(var Z=0;!(ta=J.next()).done;)V.push(X.call(ha,ta.value,Z++))}else for(ta=J.length,Z=0;Z<ta;Z++)V.push(X.call(ha,J[Z],Z));return V}},"es6","es3");
$jscomp.checkEs6ConformanceViaProxy=function(){try{var n={},J=Object.create(new $jscomp.global.Proxy(n,{get:function(X,ha,V){return X==n&&"q"==ha&&V==J}}));return!0===J.q}catch(X){return!1}};$jscomp.USE_PROXY_FOR_ES6_CONFORMANCE_CHECKS=!1;$jscomp.ES6_CONFORMANCE=$jscomp.USE_PROXY_FOR_ES6_CONFORMANCE_CHECKS&&$jscomp.checkEs6ConformanceViaProxy();$jscomp.owns=function(n,J){return Object.prototype.hasOwnProperty.call(n,J)};
$jscomp.polyfill("WeakMap",function(n){function J(){if(!n||!Object.seal)return!1;try{var da=Object.seal({}),la=Object.seal({}),Aa=new n([[da,2],[la,3]]);if(2!=Aa.get(da)||3!=Aa.get(la))return!1;Aa.delete(da);Aa.set(la,4);return!Aa.has(da)&&4==Aa.get(la)}catch(Oa){return!1}}function X(){}function ha(da){var la=typeof da;return"object"===la&&null!==da||"function"===la}function V(da){if(!$jscomp.owns(da,Z)){var la=new X;$jscomp.defineProperty(da,Z,{value:la})}}function ta(da){if(!$jscomp.ISOLATE_POLYFILLS){var la=
Object[da];la&&(Object[da]=function(Aa){if(Aa instanceof X)return Aa;Object.isExtensible(Aa)&&V(Aa);return la(Aa)})}}if($jscomp.USE_PROXY_FOR_ES6_CONFORMANCE_CHECKS){if(n&&$jscomp.ES6_CONFORMANCE)return n}else if(J())return n;var Z="$jscomp_hidden_"+Math.random();ta("freeze");ta("preventExtensions");ta("seal");var ra=0,aa=function(da){this.id_=(ra+=Math.random()+1).toString();if(da){da=$jscomp.makeIterator(da);for(var la;!(la=da.next()).done;)la=la.value,this.set(la[0],la[1])}};aa.prototype.set=function(da,
la){if(!ha(da))throw Error("Invalid WeakMap key");V(da);if(!$jscomp.owns(da,Z))throw Error("WeakMap key fail: "+da);da[Z][this.id_]=la;return this};aa.prototype.get=function(da){return ha(da)&&$jscomp.owns(da,Z)?da[Z][this.id_]:void 0};aa.prototype.has=function(da){return ha(da)&&$jscomp.owns(da,Z)&&$jscomp.owns(da[Z],this.id_)};aa.prototype.delete=function(da){return ha(da)&&$jscomp.owns(da,Z)&&$jscomp.owns(da[Z],this.id_)?delete da[Z][this.id_]:!1};return aa},"es6","es3");$jscomp.MapEntry=function(){};
$jscomp.polyfill("Map",function(n){function J(){if($jscomp.ASSUME_NO_NATIVE_MAP||!n||"function"!=typeof n||!n.prototype.entries||"function"!=typeof Object.seal)return!1;try{var aa=Object.seal({x:4}),da=new n($jscomp.makeIterator([[aa,"s"]]));if("s"!=da.get(aa)||1!=da.size||da.get({x:4})||da.set({x:4},"t")!=da||2!=da.size)return!1;var la=da.entries(),Aa=la.next();if(Aa.done||Aa.value[0]!=aa||"s"!=Aa.value[1])return!1;Aa=la.next();return Aa.done||4!=Aa.value[0].x||"t"!=Aa.value[1]||!la.next().done?
!1:!0}catch(Oa){return!1}}if($jscomp.USE_PROXY_FOR_ES6_CONFORMANCE_CHECKS){if(n&&$jscomp.ES6_CONFORMANCE)return n}else if(J())return n;var X=new WeakMap,ha=function(aa){this.data_={};this.head_=Z();this.size=0;if(aa){aa=$jscomp.makeIterator(aa);for(var da;!(da=aa.next()).done;)da=da.value,this.set(da[0],da[1])}};ha.prototype.set=function(aa,da){aa=0===aa?0:aa;var la=V(this,aa);la.list||(la.list=this.data_[la.id]=[]);la.entry?la.entry.value=da:(la.entry={next:this.head_,previous:this.head_.previous,
head:this.head_,key:aa,value:da},la.list.push(la.entry),this.head_.previous.next=la.entry,this.head_.previous=la.entry,this.size++);return this};ha.prototype.delete=function(aa){aa=V(this,aa);return aa.entry&&aa.list?(aa.list.splice(aa.index,1),aa.list.length||delete this.data_[aa.id],aa.entry.previous.next=aa.entry.next,aa.entry.next.previous=aa.entry.previous,aa.entry.head=null,this.size--,!0):!1};ha.prototype.clear=function(){this.data_={};this.head_=this.head_.previous=Z();this.size=0};ha.prototype.has=
function(aa){return!!V(this,aa).entry};ha.prototype.get=function(aa){return(aa=V(this,aa).entry)&&aa.value};ha.prototype.entries=function(){return ta(this,function(aa){return[aa.key,aa.value]})};ha.prototype.keys=function(){return ta(this,function(aa){return aa.key})};ha.prototype.values=function(){return ta(this,function(aa){return aa.value})};ha.prototype.forEach=function(aa,da){for(var la=this.entries(),Aa;!(Aa=la.next()).done;)Aa=Aa.value,aa.call(da,Aa[1],Aa[0],this)};ha.prototype[Symbol.iterator]=
ha.prototype.entries;var V=function(aa,da){var la=da&&typeof da;"object"==la||"function"==la?X.has(da)?la=X.get(da):(la=""+ ++ra,X.set(da,la)):la="p_"+da;var Aa=aa.data_[la];if(Aa&&$jscomp.owns(aa.data_,la))for(aa=0;aa<Aa.length;aa++){var Oa=Aa[aa];if(da!==da&&Oa.key!==Oa.key||da===Oa.key)return{id:la,list:Aa,index:aa,entry:Oa}}return{id:la,list:Aa,index:-1,entry:void 0}},ta=function(aa,da){var la=aa.head_;return $jscomp.iteratorPrototype(function(){if(la){for(;la.head!=aa.head_;)la=la.previous;for(;la.next!=
la.head;)return la=la.next,{done:!1,value:da(la)};la=null}return{done:!0,value:void 0}})},Z=function(){var aa={};return aa.previous=aa.next=aa.head=aa},ra=0;return ha},"es6","es3");$jscomp.findInternal=function(n,J,X){n instanceof String&&(n=String(n));for(var ha=n.length,V=0;V<ha;V++){var ta=n[V];if(J.call(X,ta,V,n))return{i:V,v:ta}}return{i:-1,v:void 0}};$jscomp.polyfill("Array.prototype.findIndex",function(n){return n?n:function(J,X){return $jscomp.findInternal(this,J,X).i}},"es6","es3");
var svManager={getInstance:function(){var n=window.$rdp;return n&&n.running&&n.running()?n:null}};svGlobal.getInstance=svManager.getInstance;
function connvertServer(n){var J={};J.id=n.id;J.server=n.id;J.displayName=n.displayName||n.id;if(n=n.rdp){for(var X in n)J[X]=n[X];J.user=n.username||"";J.pwd=n.password||"";J.useConsole=n.console||!1;J.legacyMode=n.leagacyMode||n.legacyMode||!1;J.server_bpp=n.color||16;J.exe=n.remoteProgram||"";J.args=n.remoteArgs||"";J.startProgram=0<J.exe.length?"app":J.command&&0<J.command.length?"shell":"noapp"}return J}
function Rdp2(n){n=svGlobal.util.getServerArgs(n);if(!n||!n.gateway)return hi5.notifications.notify({msg:__svi18n.noauth}),null;var J=n.gateway||"",X=0,ha=0,V=16,ta=1==n.useSSL||"true"==n.useSSL||"on"==n.useSSL||null;n.width&&(X=parseInt(n.width,10));n.height&&(ha=parseInt(n.height,10));n.color&&(V=parseInt(n.color,10));n.server_bpp&&(V=parseInt(n.server_bpp,10));n=hi5.browser.obj2url(n);null===ta&&(ta="https:"==location.protocol);return new Rdp((ta?"wss://":"ws://")+J+"/RDP?"+n,X,ha,V)}
svGlobal.Rdp2||(svGlobal.Rdp2=Rdp2);
function Rdp(n,J,X,ha){function V(a){return"on"==a||"true"==a||1==a}function ta(){var a=p.gateway;p.ongetgatewayaddress&&(a=p.ongetgatewayaddress(a));return a}function Z(){var a=hi5.storage.get("SV_CONN_SHARE_ID");a||(a=hi5.tool.uuid(),hi5.storage.set("SV_CONN_SHARE_ID",a));return a}function ra(a,b){a=ea[a]||b;a.startsWith("/")||a.toLowerCase().startsWith("http")||(a=hi5.libPath+a);return a}function aa(){return P.displayName||P.server||P.symlink||P.id||"undefined"}function da(a){p.loadbalanceToken||
(p.loadbalanceToken=ea.loadbalanceTokenName?ea.loadbalanceTokenName+"="+a:"")}function la(a,b,c){p.ontitlechange&&(a=p.ontitlechange(a,c));p.setTitle&&a&&(b=b||window,b.document.title=a)}function Aa(a,b){switch(a){case 16:case 8:case 24:case 32:break;case 15:return P.invitation||p.showMessage("15 bit color is not supported anymore."),!1;default:return!1}fb=a;b&&(Ka?Ka.postMessage({type:0,cmd:1,data:a}):Da&&Da.setColor(a));return!0}function Oa(a,b,c,e){Ia=a;Ja=b;Wb=Xb=0;Yb=Ia-1;Zb=Ja-1;Wa&&(Ia=(P.waWidth||
hi5.browser.getScreenWidth())|0,Ja=(P.waHeight||hi5.browser.getScreenHeight())|0);P.minWidth&&Ia<P.minWidth&&(Ia=P.minWidth|0);P.minHeight&&Ja<P.minHeight&&(Ja=P.minHeight|0);Ia&=-4;Ja&=-4;svGlobal.logger.warn("resolution changed, w:"+Ia+" h:"+Ja);var d=Ia,f=Ja;qa?qa.resize(d,f):qa=new xc(d,f);ca.setSize(Ia,Ja,Wa?"hidden":null);if(c||Ia!=a||Ja!=b)Ka?Ka.postMessage({type:0,cmd:2,data:{w:Ia,h:Ja}}):Da&&Da.setResolution(Ia,Ja);if(p.onresolutionchange&&!e)p.onresolutionchange(a,b)}function sa(a){!bb&&
Ha&&(Ka?($b.data=a,"string"!=typeof a?Ka.postMessage($b,[a]):Ka.postMessage($b)):Da.writeRawInput(a))}function rb(a){switch(a){case "\r":break;case "\n":p.writeScancode(28);break;case "\t":p.writeScancode(15);break;default:sa("86"+a)}}function nb(a){var b=this;a||(a=143);this.send=function(c){var e=!!c.buffer,d=e?c:c.getData(),f=64==a;c=e?d.length:c.getEnd()||d.length;c<d.length&&(d=e?d.subarray(0,c):d.slice(0,c));e=f?5:9;c=new Uint8Array(e+c);c[0]=a;if(f)c[1]=b.id,c[2]=b.id>>8,c[3]=b.id>>16,c[4]=
b.id>>24;else{f=b.name;for(var m=Math.min(f.length,8),H=0;H<m;H++)c[1+H]=f.charCodeAt(H)}c.set(d,e);sa(c.buffer)};this.name="";this.count=this.id=this.flags=0}function Fb(a){if(p){var b=__svi18n.errorCode[a];a={name:a,message:b,msg:b};p.displayMsg&&p.showMessage(a);0<svGlobal.log&&console.error&&console.error(a);if(p.onerror)p.onerror(a)}}function yc(a){if(p){var b=__svi18n.info[a];b||(b="info "+a);p.displayMsg&&p.showMessage(b);svGlobal.logger.info(b)}}function ac(){var a=Ha;ob=Ha=!1;Ka?Ka.postMessage({type:0,
cmd:3}):Da&&Da.resetStatus();a&&(Ha=a)}function bc(a){Ma||(Ma=new hi5.file.UploadManager(new hi5.file.WsFileService(sa)),Ma.addEvent("beforeupload",function(b,c,e){if(p.beforeupload)return p.beforeupload(b,c,e)}),Ma.addEvent("fileuploaded",function(b,c,e){if(p.onfileuploaded)p.onfileuploaded(b,c,e)}),Ma.addEvent("uploaded",function(b,c){if(p.onuploaded)p.onuploaded(b,c)}),Ma.addEvent("uploadingCancelled",function(){if(p.onuploadingCancelled)p.onuploadingCancelled()}));a.setFileHandler(Ma)}function zc(a,
b,c){var e=!1;this.exe=a;this.args=b||"";this._dir=c||"";var d=this;this.close=function(){!e&&Ha&&(e=!0,sa("8C5"+d.exe+"\t"+d.args+"\t"+p.sessionInfo.appInfo.session))}}function sd(){var a=window.opener;if(a)try{if(a.__sparkUser&&a.__sparkUser.session)return a.__sparkUser;if(a.opener&&a.opener.__sparkUser.session)return a.opener.__sparkUser}catch(b){}return null}function Ac(){var a;return void 0!==(null==(a=window)?void 0:a.PublicKeyCredential)&&"function"===typeof window.PublicKeyCredential}function Gb(a){a=
(new Uint8Array(a)).buffer;return CBOR.decode(a)}function td(a,b,c){var e={};if(b&&b.attachment)switch(b.attachment){case 1:var d="platform";break;case 2:d="cross-platform"}d&&(e.authenticatorAttachment=d);d={};b&&(b.requireResident?b.requireResident&&(d.requireResidentKey=!0,d.residentKey="required"):b.preferResident&&b.preferResident&&(d.requireResidentKey=!0,d.residentKey="preferred"));c&&c.rk&&(c.rk?(d.requireResidentKey=!0,d.residentKey="required"):(d.requireResidentKey=!1,d.residentKey=void 0));
d&&(d.requireResidentKey&&(e.requireResidentKey=d.requireResidentKey),d.residentKey&&(e.residentKey=d.residentKey));if(a=Bc(a,b,c))e.userVerification=a;if(Object.keys(e).length)return e}function Cc(a){var b=[];if(a){a=$jscomp.makeIterator(a);for(var c=a.next();!c.done;c=a.next()){var e=c.value;c={};e.id&&(c.id=e.id);e.type&&(c.type=e.type);if(e.transports){var d=c;e=e.transports;var f=[];e&1?f.push("usb"):e&2?f.push("nfc"):e&4?f.push("ble"):e&16?f.push("internal"):e&32&&f.push("hybrid");d.transports=
f}b.push(c)}}return b}function Bc(a,b,c){var e;a&&(a&4194304?e="required":a&8388608?e="preferred":a&16777216&&(e="discouraged"));if(b&&b.userVerification)switch(b.userVerification){case 1:e="required";break;case 2:e="preferred";break;case 3:e="discouraged"}c&&c.uv&&("FALSE"==c.uv.toUpperCase()?e="discouraged":"TRUE"==c.uv.toUpperCase()&&(e="required"));return e}function ud(a){var b={};if(a&&a.attestationPreference)switch(a.attestationPreference){case 0:b.attestation="direct";break;case 1:b.attestation=
"direct";break;case 2:b.attestation="indirect";break;case 3:b.attestation="direct"}if(a&&a.enterpriseAttestation)switch(a.enterpriseAttestation){case 1:b.attestation="enterprise";break;case 2:b.attestation="enterprise"}b.attestationFormats=["packed"];return b}function vd(a,b){var c,e,d,f,m,H,y,C,E,u,v,Q,q,z,A,t,F,T,w,K;return $jscomp.asyncExecutePromiseGeneratorProgram(function(O){if(1==O.nextAddress){c=a.getPublicKeyAlgorithm();console.log("==== publicKeyAlgorithms = "+c);if((e=a.getTransports())&&
0<e.length)for(var U=$jscomp.makeIterator(e),W=U.next();!W.done;W=U.next())W=W.value,"USB"==W.toUpperCase()||"NFC"==W.toUpperCase()||"BLE"==W.toUpperCase()||"INTERNAL"==W.toUpperCase()||W.toUpperCase();if(d=a.attestationObject)console.log("==== attestationObj bytes: "+sb(new Uint8Array(d))),m=Gb(d),f=m.attStmt;if(H=a.clientDataJSON)console.log("==== clientDataJson bytes: "+sb(new Uint8Array(H))),y=window.origin,C=(new TextDecoder).decode(H),E=JSON.parse(C),E.origin&&(E.origin=y);u=a.getAuthenticatorData();
if(!u)return O.jumpTo(0);v=new Uint8Array(u);console.log("==== authenticatorData bytes: "+sb(v));return b?(Q=b.id)?O.yield(wd(Q),5):O.jumpTo(0):O.jumpTo(0)}q=O.yieldResult;z=new Uint8Array(q);console.log("==== hash of realRpID: "+sb(z));A=new hi5.DataBuffer(new Uint8Array(v.byteLength));A.setBytes(z);t=v.slice?v.slice(32,v.length):v.subarray(32,v.length);A.setBytes(t);A.markEnd();F=A.getData();console.log("==== newAuthDataBytes: "+sb(new Uint8Array(F)));T={1:"packed",2:F,3:f};w=CBOR.encode(T);K=new hi5.DataBuffer(new Uint8Array(w.byteLength+
1));K.setByte(0);K.setBytes(w);K.markEnd();return O.return(K.getData())})}function wd(a){var b;return $jscomp.asyncExecutePromiseGeneratorProgram(function(c){b=(new TextEncoder).encode(a);return c.return(xd(b))})}function xd(a){var b;return $jscomp.asyncExecutePromiseGeneratorProgram(function(c){if(1==c.nextAddress)return c.yield(crypto.subtle.digest("SHA-256",a),2);b=c.yieldResult;return c.return(b)})}function sb(a){return Array.from(a,function(b){return("0"+(b&255).toString(16)).slice(-2)}).join(", ")}
function yd(){var a=0,b=0,c=new p.GatewayChannel;c.name="MESSGSTB";c.onopen=function(){svGlobal.logger.info("Message Channel open")};c.process=function(e){if(0==e.getByte())e.getByte(),e.getByte(),e.getByte();else{var d=e.getByte(),f=e.getLittleEndian16(),m=e.getLittleEndian16();if(0!=d)svGlobal.logger.warn("Invalid AUTODETECT_REQUEST");else switch(m){case 1:case 4097:m=new RdpBuffer(new Uint8Array(6),0,6);m.setByte(6);m.setByte(1);m.setLittleEndian16(f);m.setLittleEndian16(0);m.markEnd();c.send(m);
break;case 20:case 276:case 4116:a=6;b=Date.now();break;case 2:f=e.getLittleEndian16();a+=f;break;case 43:case 1065:case 1577:43==m&&(d=e.getLittleEndian16(),a=a+d+8,e.skipPosition(d));e=e.has(4)?e.getLittleEndian32():0;a+=e;e=Date.now()-b;d=new RdpBuffer(new Uint8Array(14),0,14);d.setByte(14);d.setByte(1);d.setLittleEndian16(f);d.setLittleEndian16(43==m?3:11);d.setLittleEndian32(e);d.setLittleEndian32(a);d.markEnd();c.send(d);break;case 2112:case 2176:case 2240:f=e.getLittleEndian32();m=e.getLittleEndian32();
e=e.getLittleEndian32();Hb={baseRTT:f,bandwidth:m,averageRTT:e};if(p.onnetworkresult)p.onnetworkresult(Hb);svGlobal.logger.warn("Network Characteristics Result:");svGlobal.logger.warn(Hb);break;default:svGlobal.logger.warn("Invalid network detect PDU",e)}}};c.onclose=function(){svGlobal.logger.info("MSG channel close")};p.addGatewayChannel(c)}function zd(a,b,c,e,d){cc.set(a,b);dc.set(a,e);b="<b>User:&nbsp;</b>"+c+"&nbsp;("+e+")&nbsp;&nbsp;&nbsp;&nbsp;<b>Expire Date:</b> "+d;c=document.createElement("div");
e=document.createElement("input");e.type="radio";e.name="scard_name";e.value=a;0==a&&(e.defaultChecked=!0);c.appendChild(e);c.innerHTML+=b;c.innerHTML+="<br>";return c}function Ad(a,b){var c=document.createElement("div"),e=document.createElement("input");e.type="radio";e.name="ds_name";e.value=a;0==a&&(e.defaultChecked=!0);c.appendChild(e);c.innerHTML+=b;c.innerHTML+="<br>";return c}function Dc(){var a="";P&&V(P.connectif)&&P.symlink&&"sessionStorage"in window&&(a="SV_"+P.symlink,P.domain&&(a+=P.domain),
P.user&&(a+=P.user));return a}function Bd(){var a=hi5.appcfg.persistentId?window.localStorage:window.sessionStorage;if(!a)return"";var b=a.getItem("appInfo.session");if(!b)return"";b="&_session="+b;(a=a.getItem("appInfo.numericId"))&&(b+="&_numericId="+a);return b}function ec(){if(!Ha){ob=!1;var a="";bb?Fa.init(!1,!0,!1,0,!1,!1):a=p.getRuntimeURL();void 0==ea.wsPost&&(ea.wsPost=!1);p.oncreatewebsocket&&(Ka=null);Ka?(bb&&(bb.onopen=fc,bb.onclose=zb,bb.onmessage=function(c){gc.data=c.data;Ka.postMessage(gc,
[gc.data])}),Ka.postMessage({type:0,cmd:0,data:{addr:a,width:Ia,height:Ja,server_bpp:fb,libPath:hi5.libPath,libMin:hi5.libMin,wsPost:ea.wsPost}})):(Da=new RdpGeneral(bb||a,Ia,Ja,fb,qa,!1,ea.wsPost),Da.oncreatewebsocket=p.oncreatewebsocket,Da.run());Ka?Ka.addEventListener("message",Ec,!1):(Da.onopen=fc,Da.onmessage=Fc,Da.onclose=zb,Da.onerror=Fb,Da.oninfo=yc,Da.onloggedin=hc,Da.onresolutionchange=function(c,e){Oa(c,e,!1,P.monitorDef&&0<=P.monitor?!0:!1)},Da.onAltSecWindows=Gc,Da.onMoveCursor=ic,Da.onCloseSurface=
Hc,Da.onColorChange=Aa,Da.onHistoryReceived=function(){jc()},Da.onLockKeyState=function(c){if(p.onLockKeyState)p.onLockKeyState(c)});if(a=ca.getSurface(ca.size()-1))Wa?a&&(a.remoteApp=new zc(P.exe,P.args,"")):la(aa(),a.getWindow());if(P.invitation&&!V(P.shadow)){var b=null;a&&(b=a.initChat(P.expert));Ab=new p.GatewayChannel;Ab.name="C_H_A_T";Ab.process=function(c){c=c.getUnicodeString(c.getEnd()-c.getPosition(),!0);b&&b.add(c,P.novice)};b&&(b.onchat=function(c){if(Ha){var e=Array(2*c.length);e=new hi5.DataBuffer(e,
0,e.length);e.setUnicodeString(c);e.markEnd();Ab.send(e)}});p.addGatewayChannel(Ab)}}}function Ec(a){a=a.data;switch(a.type){case 1:switch(a.event){case 0:fc();break;case 1:zb(a.expected);break;case 2:Fb(a.code);break;case 3:yc(a.code);break;case 4:hc();break;case 5:Oa(a.w,a.h,!1,P.monitorDef&&0<=P.monitor?!0:!1);break;case 6:ic(a.x,a.y,!0);break;case 7:Hc();break;case 8:0==a.id&&jc();Pa&&Pa.check(1<a.id?15555:0);break;case 9:Aa(a.color);break;case 10:if(p.onLockKeyState)p.onLockKeyState(a.state);
break;default:svGlobal.logger.warn("Invalid worker event "+a.type)}break;case 2:qa.setRGBs(a.x,a.y,a.w,a.h,a.pixel,a.offset,a.scansize);break;case 3:qa.moveArea(a.srcx,a.srcy,a.cx,a.cy,a.dx,a.dy);break;case 5:qa.fillRect(a.l,a.t,a.w,a.h,a.color);break;case 6:qa.drawLine(a.x1,a.y1,a.x2,a.y2,a.color);break;case 7:qa.bitBlt(a.opcode,a.dstwidth,a.x,a.y,a.cx,a.cy,a.src,a.srcwidth,a.srcx,a.srcy);break;case 8:qa.drawLineExt(a.x1,a.y1,a.x2,a.y2,a.color,a.opcode);break;case 9:Ic(a);break;case 10:Fc(a);break;
case 11:Va.attach(a.data,0,a.data.length);Gc(Va,a.size);break;case 12:qa.drawText(a.font,a.flags,a.mixmode,a.foregroundColor,a.backgroundColor,a.clipLeft,a.clipTop,a.clipcx,a.clipcy,a.boxLeft,a.boxTop,a.boxcx,a.boxcy,a.x,a.y,a.length,a.text,a._left,a._top,a._right,a._bottom);break;case 13:qa.drawBitmap(a.cacheID,a.cacheIDX,a.x,a.y,a.cx,a.cy,a.srcx,a.srcy,a.opcode);break;case 14:qa.saveDesktop(a.x,a.y,a.cx,a.cy,a.offset);break;case 15:qa.restoreDesktop(a.x,a.y,a.cx,a.cy,a.offset);break;case 16:qa.putFont(a.font,
a.character,a.glyph);break;case 17:qa.putCursor(a.idx,a.cursor);break;case 18:qa.setCursor(a.idx);break;case 19:qa.getHistory(sa,function(){Ka.postMessage({type:0,cmd:7})});Pa&&Pa.check(15555);break;case 20:Va.attach(a.data,a.off,a.data.length-a.off);qa.setHistory(a.order,Va);break;case 21:qa.putBitmap(a.id,a.idx,a.bitmap);break;default:svGlobal.logger.warn("Invalid worker msg "+a.type)}}function Jc(a){Pa&&Pa.check(a)}function fc(){Ha=!0;var a="87"+navigator.userAgent+"\t";Ib=hi5.tool.uuid();document.cookie=
Ib+"=sv";sa(a+Ib);if(p.onopen)p.onopen();ea.joinCloseMode&&p.setJoinCloseMode(ea.joinCloseMode)}function Hc(){ca&&ca.close()}function Fc(a){var b=a.data;if("string"!=typeof b){a=new Uint8Array(b);Va.attach(a,0,b.byteLength);var c=Va.getLittleEndian16();switch(c){case 28:a=Va;b=a.getAscllString(8);c=ib[b];null!=c?c.process(a):svGlobal.logger.warn("Channel "+b+" not found");break;case 55:a=Va;switch(a.getByte()){case 0:Ea.tag=a.getLittleEndian16();Ea.channels=a.getLittleEndian16();Ea.samplePerSec=a.getLittleEndian32();
a.skipPosition(6);Ea.bitsPerSample=a.getLittleEndian16();svGlobal.logger.info("Audio Format, tag="+Ea.tag+" channels="+Ea.channels+" bitsPerSample="+Ea.bitsPerSample+" samplePerSec="+Ea.samplePerSec);Ka&&Ka.postMessage({type:0,cmd:5,data:{tag:Ea.tag,channels:Ea.channels,samplePerSec:Ea.samplePerSec,bitsPerSample:Ea.bitsPerSample}});41222==Ea.tag&&(Ea.sampleRate=Ea.samplePerSec,Ta.initMediaPlayer(Ta,Ea,!1));break;case 1:b=a.getByte();c=a.getLittleEndian16();var e=Date.now();a.skipPosition(8);kc(a,
b,c,0);jb||(c+=Date.now()-e,sa("8A"+b+","+c))}Pa&&Pa.check();break;case 56:Kc(Va.getUnicodeString(Va.getEnd()-Va.getPosition(),!1));break;case 60:Lc(Va);break;case 62:Mc(Va.getUnicodeString(Va.getEnd()-Va.getPosition(),!1));break;case 63:Nc(Va);Pa&&Pa.check();break;case 64:b=Va;c=b.getByte();a=b.getLittleEndian32();switch(c){case 1:b=b.getAscllString();if(Fa[b]){if(svGlobal.logger.info("DVC create, name:"+b+" id:"+a),Fa[b].newInstance?(Fa[a]=Fa[b].newInstance(),Fa[a].id=a):(Fa[b].id=a,Fa[a]=Fa[b]),
Fa[a].onopen)Fa[a].onopen()}else svGlobal.logger.info("DVC create, name not found:"+b+" id:"+a);break;case 3:Fa[a]&&Fa[a].process(b);break;case 4:if(Fa[a]&&Fa[a].onclose)Fa[a].onclose();svGlobal.logger.info("close DVC, id:"+a)}Pa&&Pa.check();break;case 146:Cd(Va);break;default:if(p.onunknownmessage)p.onunknownmessage(c,Va);else svGlobal.logger.warn("@TODO:"+c+"\n")}}else switch(c=parseInt(b.substring(0,2),16),a=b.substring(2),c){case 0:sa("87"+navigator.userAgent);break;case 15:if(p){lc=!1;tb=p.reconnectTimes;
(p&&0==p.mode||V(P.connectif))&&jc();b="";for(b in kb)if((c=kb[b])&&c.onopen)c.onopen();for(b in ib)if((c=ib[b])&&c.onopen)c.onopen();a&&(a=JSON.parse(a),a.capability&&p&&(p.sessionInfo.suppressOutput=!!a.capability.suppressOutput))}break;case 26:b=JSON.parse(a);if(b.name){isNaN(b.name)||(b.name="S"+b.name);b.message||(b.message=b.msg);if(p.onnotify)p.onnotify(b);svGlobal.logger.info("msg="+a);if(2==b.type&&p.onerror)p.onerror(b);if(a=__svi18n.errorCode[b.name])b.msg=a+" "+b.msg;p.showMessage(b)}else 0<
svGlobal.log&&console.erro("No error code for message:"+a);break;case 27:ca.drawLicense(a);break;case 50:if(Ha)switch(b=parseInt(a.substring(0,1),10),a=a.substring(1),b){case 1:Dd(a);break;case 2:Bb?(Bb.type==a?p.writeRawInput("881"+a+"\t"+Bb.text):p.writeRawInput("881ERROR\t"),Bb=null):!(b=ca.getFocused())||b.processClipReq(a)||!ea.clipWarnAlways&&Oc||!P||P.leagacyMode||(p.showMessage(__svi18n.info.menucopy,null,5E3),Oc=!0);break;case 5:(b=ca.getFocused())&&"0"!=a&&b.setIgnorePaste(!0)}break;case 51:ca.setReadOnly("1"==
a);break;case 54:b=a.split("\t");a=ta()+b[0];a=p.modifyURL(a);svGlobal.logger.info("Downloading file:"+a+" name:"+b[1]+" driver:"+b[2]);p.onprintingready&&p.onprintingready({link:a,printerName:b[1],pinterDriver:b[2]})||(b=ca.getFocused())&&b.showPDF(a);break;case 56:Kc(a);break;case 57:b=a.split("\t");svGlobal.logger.debug(a);if(a=ca.getWinById(parseInt(b[0]))){if(!ca.hasApp(b[1])){(c=ca.getOwnerSurface(a))&&c.railWin&&(c.railWin.appId=b[1],c.railWin.addApp(b[1]));if(p.onremoteappstart)p.onremoteappstart({id:b[1]});
if(a.isVisible()&&a.titleInfo&&p.ontitlechange)p.ontitlechange(c.railWin.getFullTitle(a.id),b[1])}a.appId=b[1]}break;case 58:Ed(a);break;case 59:a=hi5.Base64.dec(a,0);cb=(new RdpBuffer(a,0,a.length)).getLittleEndian32();jb||!(cb&16||cb&65536)?(Jb=!1,Ma=null):(cb&16&&(Jb=!0),Ma||(a=ca.getFocused())&&bc(a));cb&64&&p.showMessage(__svi18n.info.recording);Ma&&(Ma.setUpload(!(cb&128)),Ma.setDownload(!(cb&131072)),Ma.canCopyFile=0!=(cb&65536));ca.execute("setFeature",[cb]);break;case 60:Lc(b64ToBuffer(a));
break;case 61:a=JSON.parse(a);switch(a.type){case 0:Oa(a.width,a.height,!0,!1);Aa(a.color);(b=a.server)&&p&&(p.server=a.server);Pc=a.length;c=ca.getFocused();Wa=1==a.isRail;c&&(1!=p.mode&&c.setAutoScale(!Wa),b&&la(aa(),c.getWindow()),b=a.keyboard,"undefined"!=typeof b&&0==b&&c.setUnicode(!0),b=a.mapDisk)&&(Jb=!0,bc(c));if(p.onopened)p.onopened(a);break;case 1:a=a.duration;if(p.onprogress)p.onprogress(a,Pc);break;case 2:2==a.status?(ac(),Ha=!0):(b=0==a.status,b==qa.isPaused()||p.onsessionpause&&p.onsessionpause(b,
a)||(qa.pause(b),b||ca.repaint(0,0,qa.width-1,qa.height-1),a.warn&&p.showMessage(b?__svi18n.info.sessionPaused:__svi18n.info.sessionResumed)))}break;case 62:Mc(a);break;case 63:Nc(b64ToBuffer(a));break;default:if(p.onunknownmessage)p.onunknownmessage(c,a);else svGlobal.logger.warn("@TODO:"+b+"\n")}}function jc(){if(!jb&&!Xa&&(Xa=!0,p&&(ea.pingInterval&&p.startPing(ea.pingInterval),p.onready)))p.onready()}function Cd(a){var b=a.getByte();switch(b){case 0:a=new Uint8Array(2);a[0]=146;a[1]=1;sa(a.buffer);
break;case 1:break;case 5:b=a.getByte();a=a.getLittleEndian32();0!=b||a&4||(cb^=65536,ca.execute("setFeature",[cb]));break;case 6:Qa.remoteLockFlags=a.getLittleEndian32();Qa.checkLockFlags=!0;if(p.onLockKeyState)p.onLockKeyState({capsLock:0!=(Qa.remoteLockFlags&4),numLock:0!=(Qa.remoteLockFlags&2),scrollLock:0!=(Qa.remoteLockFlags&1)},{capsLock:0!=(Qa.localLockFlags&4),numLock:0!=(Qa.localLockFlags&2),scrollLock:0!=(Qa.localLockFlags&1)});svGlobal.logger.info("remoteLockFlags: "+Qa.remoteLockFlags);
break;case 7:b=a.getByte();p.sessionInfo.appInfo.twoFAEnabled=0<b;switch(b){case 0:b=a.getByte();var c=a.getLittleEndian32();a=a.getBytes(c);p.sessionInfo.appInfo.twoFAQR=a;p.ontwofaqr&&p.ontwofaqr(a)||2==b&&ca.execute("showTwoFAQR");break;case 1:qa.pause(!0,!0);if(p.ontwofacode&&p.ontwofacode())return;(a=ca.getFocused())&&a.showTwoFACode();break;case 2:if(b=a.getByte(),a=1==a.getByte(),(!p.ontwofaresult||!p.ontwofaresult(b,a))&&Qa.onauthcoderesult)Qa.onauthcoderesult(b,a)}break;case 8:b=a.getByte();
if(a=ca.getFocused()){c="image/png";switch(b){case 1:c="image/jpeg";break;case 2:c="image/webp"}a.getSnapshot(function(e){e.bytes().then(function(d){var f=new Uint8Array(2+d.length);f[0]=146;f[1]=8;f.set(d,2);sa(f.buffer)})},c)}break;default:svGlobal.logger.warn("Invalid Client Control: "+b)}}function Fd(a,b){var c=0,e=!1;this.width=a;this.interval=b;var d=0;this.start=function(){e||(e=!0,c=setInterval(function(){var f=ca.getFocused();f&&Ha&&(f=f.getThumbnail(a))&&f.length!=d&&(sa("8E7"+f),d=f.length)},
b))};this.stop=function(){clearInterval(c)}}function Gd(a,b){!Ya||Ya.width==a&&Ya.interval==b||(Ya.stop(),Ya=null);Ya||(Ya=new Fd(a,b));Ya.start()}function Nc(a){var b=a.getAscllString(8);(b=kb[b])&&b.process&&b.process(a)}function Mc(a){var b=parseInt(a.substring(0,1),16),c=a.substring(1);a=!1;var e=p.sessionInfo.appInfo;switch(b){case 0:var d=JSON.parse(c);ac();Ha=!0;a=d.width;e=d.height;if(a==Ia&&e==Ja)break;Oa(a,e,!1,!1);break;case 1:d=JSON.parse(c);p.sessionInfo.joinedSessions.push(d.numericId);
p.sessionInfo.joiners.push(d);e.sessions[d.numericId]=d.name||d.__ip;if(!e.joined||ea.alertJoin)p.onsessionjoin&&(a=p.onsessionjoin(d)),!a&&__svi18n.info.joinsession&&p.showMessage(__svi18n.info.joinsession.applyArgs([d.numericId,d.__ip,d.name]));break;case 2:d=JSON.parse(c);p.sessionInfo.joinedSessions.removeElm(d.numericId);delete e.sessions[d.numericId];b=p.sessionInfo.joiners;c=0;for(var f=b.length;c<f;c++)if(b[c].numericId==d.numericId){b.splice(c,1);break}if(!e.joined||ea.alertJoin)p.onsessionexit&&
(a=p.onsessionexit(d)),!a&&__svi18n.info.exitsession&&p.showMessage(__svi18n.info.exitsession.applyArgs([d.numericId,d.__ip,d.name]));break;case 3:d=JSON.parse(c);e.joinMode!=d.mode&&(e.joinMode=d.mode,b=hi5.$("joinSelect"))&&(b.value=d.mode);if(e.hasControl)break;e.hasControl=!0;ca.setReadOnly(!1,2==d.mode);if(e=hi5.$("requestControl"))e.disabled=!0;p.ongivecontrol&&(a=p.ongivecontrol());if(a)break;p.showMessage(__svi18n.info.givecontrol,null,5E3);break;case 4:d=JSON.parse(c);ca.setReadOnly(!0,2==
d.mode);e.hasControl=!1;if(e=hi5.$("requestControl"))e.disabled=!1;p.ontakebackcontrol&&(a=p.ontakebackcontrol());if(a)break;p.showMessage(__svi18n.info.nocontrol,null,5E3);break;case 5:d=JSON.parse(c);p.onrequirecontrol&&(a=p.onrequirecontrol(d));if(a)break;a=__svi18n.info.title.applyArgs([d.name,d.numericId,d.__ip]);e=__svi18n.info.recontrol;qa.isPaused&&(e+="<br><br>"+(__svi18n.info.autoresume||""));p.showMessage({title:a,msg:e,cbYes:function(){p.giveControl(d.numericId);this.destroy();qa.isPaused()&&
p.pauseSession(p.sessionInfo.appInfo.numericId,!1)},cbNo:function(){p.refuseControl(d.numericId);this.destroy()},html:!0});break;case 6:ca.execute("setTouchRemoting",[!0]);break;case 7:d=JSON.parse(c);d.width&&d.height&&Oa(d.width,d.height,!0,P.monitorDef&&0<=P.monitor?!0:!1);d.color&&(Aa(d.color,!0),svGlobal.logger.warn("Color depth changed to:"+d.color));d.version&&(p.sessionInfo.protocolVersion=d.version);break;case 8:d=JSON.parse(c);lc=!0;if(p.onrequestcredential&&p.onrequestcredential(d,Qa.reconnect))break;
if(p.onautherror&&p.onautherror(d,Qa.reconnect))break;ca.getFocused().requestCredential(d,Qa.reconnect);break;case 9:d=JSON.parse(c);0<d.interval&&0<d.width?Gd(d.width,d.interval):Ya&&(Ya.stop(),Ya=null);break;case 11:d=JSON.parse(c);p.onrequirejoin&&(a=p.onrequirejoin(d));if(a)break;a=__svi18n.info.title.applyArgs([d.name,d.numericId,d.__ip]);p.showMessage({title:a,msg:__svi18n.info.reqjoin,cbYes:function(){p.allowJoin(d.numericId,!0);this.destroy()},cbNo:function(){p.allowJoin(d.numericId,!1);this.destroy()}});
break;case 13:d=JSON.parse(c);"login"==d.type&&hc();break;case 14:if(d=JSON.parse(c),p.oncontrolchange)p.oncontrolchange(d)}}function Lc(a){switch(a.getByte()){case 32:if(!qa.isPaused()){var b=a.getLittleEndian16(),c=a.getLittleEndian16(),e=a.getLittleEndian16(),d=void 0,f=void 0;ea.noCursorName||(d=a.getLittleEndian32(),p.sessionInfo.appInfo&&(f=p.sessionInfo.appInfo.sessions[d]));ic(c,e,!0,f,d,b)}}}function ic(a,b,c,e,d,f){qa.isPaused()||ca.getFocused().moveCursor(a,b,c,e,d,f)}function Ic(a){ca.setCursor(a)}
function Hd(a){var b=ea.page&&ea.page.join||"";if(b.startsWith("http://")||b.startsWith("https://"))return b;if(b.startsWith("/"))return location.origin+b;var c=location.href,e=c.lastIndexOf("/");if(b)return c.substring(0,e+1)+b;b=ta();c.toLowerCase().startsWith(b.toLowerCase())&&(b=c.substring(0,e));return b+"/"+a}function Kc(a){a=JSON.parse(a);mc=a.session;var b=a.numericId,c=hi5.appcfg.persistentId?window.localStorage:window.sessionStorage;c&&(c.setItem("appInfo.session",mc),c.setItem("appInfo.numericId",
b));da(a.appId);a.server||(a.server=aa());if(b=hi5.$("joinSelect"))b.value=a.joinMode;if(b=hi5.$("requestControl"))b.disabled=a.hasControl;a.joined?1!=p.mode&&ca.execute("setAutoScale",[!0]):(p.mode=0,V(P.connectif)&&ca.setSize(Ia,Ja),ea.disableJoinedAppResize&&(p.windowState=0));var e=ta();b=Hd("join.html")+"?id="+(a.joined||a.numericId);(c=a.webAddress)&&0<c.length&&c.toLowerCase()!=e.toLowerCase()&&(e=c.indexOf("://"),p.protocol="http"==c.substring(0,e)?"ws":"wss",p.gateway=c,b+="&gateway="+encodeURIComponent(c));
b=p.modifyURL(b);a.joinLink=b;p.sessionInfo.appInfo=a;"isApp"in a&&Wa!==a.isApp&&(Wa=a.isApp,Oa(Ia,Ja,!0,!0),ob||1==p.mode||ca.execute("setAutoScale",[!0]));a.ver&&a.ver!=svGlobal.version&&svGlobal.logger.warn("Client:"+svGlobal.version+" server:"+a.ver);ea.cursorNameOnly=a.isAssistance;if(p.onsessionstart)p.onsessionstart(p.sessionInfo)}function Ed(a){if(Ma){var b=parseInt(a.charAt(0),10);a=a.substring(1);if(5==b)Ma.notifyFiles(JSON.parse(a));else{var c=a.split("\t");switch(b){case 1:Ma.confirmId(c[0],
c[1],c[2]);break;case 2:Ma.read(c[0],parseInt(c[1],10),parseInt(c[2],10));break;case 4:Ma.close(c[0]);break;case 9:a='<a href="'+p.modifyURL(ta()+c[0])+'" download="'+c[1]+'" target="_blank">'+__svi18n.info.fileReady+": "+c[1]+"</a>",__svi18n.info.download&&ca.getFocused().showMessage({msg:a,html:!0,title:__svi18n.info.download,cbNo:function(){Ma.removeFile(c[0],!0);this.destroy()},onclick:function(e){"A"==e.target.tagName&&this.destroy()}})}}}}function kc(a,b,c,e){if(!Id||qa.isPaused())return 0;
var d=a.getPosition();b=a.getData();e||(e=a.getEnd()-d);if(41222==Ea.tag)return Ta.onaudioframe(b.slice(d)),0;if(a=1!=Ea.tag)nc||(nc=new MSGSM),b=nc.decode(b,d,e),d=0,e=b.length;var f=Ea.bitsPerSample;var m=Math.floor(e/(f>>3));var H=c=e=0;a||(e=Math.pow(2,f-1)-1,c=-e-1,H=Math.pow(2,f));f=Ea.channels;var y=Math.floor(m/f),C=Ta.getBuffer(y),E=C.getChannelData(0),u=C.getChannelData(1);m=0;if(a)for(;m<y;)1==f?u[m]=E[m]=b[d++]:(E[m]=b[d++],u[m]=b[d++]),m++;else for(;m<y;)a=b[d++]|b[d++]<<8,a>e?(a-=H,
a/=-c):a/=e,1==f?E[m]=a:(E[m]=a,a=b[d++]|b[d++]<<8,a>e?(a-=H,a/=-c):a/=e),u[m]=a,m++;return Ta.playBuffer(C)}function Qc(a){if(!p.openLink||2E3<a.length)return!1;var b=a.indexOf(";");0<b&&(a=a.substring(b+1));b=a;a=a.toLowerCase();var c=0==a.indexOf("http://")||0==a.indexOf("https://")||0==a.indexOf("ftp://")||0==a.indexOf("mailto:")||0==a.indexOf("tel:")||0==a.indexOf("callto:");c||(0==a.indexOf("www.")?(c=!0,a="http://"+a):0==a.indexOf("ftp.")&&(c=!0,a="ftp://"+a));return c?0<a.indexOf("\r")||0<
a.indexOf("\n")?!1:p.onurlredirection&&p.onurlredirection(b)?!0:(a=ca.getFocused())?a.processLink(b):!1:!1}function Jd(a){if(a.startsWith("text/html;<img data-sv-img")){var b=a.indexOf('src="');if(0<b){b+=5;var c=a.indexOf('"',b),e=a.substring(b,c);e=p.modifyURL(e);a=a.substring(0,b)+e+a.substring(c)}}return a}function Dd(a){if("text/plain;"!=a){if(1666<Date.now()-Qa.reqCopyTime&&!(p.onservercopy&&p.onservercopy(a)||Qc(a))){var b=ca.getFocused();b&&b.copyToClip(Jd(a))}setTimeout(function(){sa("883")},
999)}}function hc(){if(!ob&&(setTimeout(function(){Ha&&sa("884")},333),p.onloggedin))p.onloggedin();oc=ob=!0;Wa&&1!=p.mode&&ca.execute("setAutoScale",[!1]);Ma&&(Ma.enabled=!0);Kb&&!Wa&&(qa.setContext(ca.getFocused().context),ca.repaint(0,0,qa.width-1,qa.height-1))}function zb(a){if(p){hi5.browser.cookie.delete(Ib);svGlobal.logger.warn("closed "+(p.sessionInfo.appInfo?p.sessionInfo.appInfo.numericId:0));p.onagentmessage&&(p.onagentmessage=null);if(p.onagentclose)p.onagentclose();var b=Dc();b&&p.sessionInfo.appInfo&&
0==p.mode&&(sessionStorage[b]=p.sessionInfo.appInfo.session);if(p&&(b=1!=p.mode,!Ha&&b&&Fb("connection"),b=b&&(Ha||tb<p.reconnectTimes)&&0<tb&&!a,Xa=Ha=!1,b)){tb--;__svi18n.info.reconnecting&&p.showMessage(__svi18n.info.reconnecting+" "+(p.reconnectTimes-tb)+"/"+p.reconnectTimes,null,3E3);setTimeout(ec,ea.reconnectInterval||5E3);svGlobal.logger.info("Reconnecting..."+tb);return}if(lc)svGlobal.logger.info("Req credential");else{Pa&&(p.stopPing(),Pa=null);Ka&&(Ka.removeEventListener("message",Ec,!1),
Ka.postMessage({type:0,cmd:4}),Ka.terminate(),Ka=null);Ma&&(Ma.release(),Ma=null);Ra=n=null;Fa&&(Fa.close(),Fa=null);kb&&hi5.Arrays.release(kb);ib&&hi5.Arrays.release(ib);Ya&&(Ya.stop(),Ya=null);Ta&&(Ta.close(),Ta=null);p.player&&(p.player=null);Cb=null;try{if(p.onclose)p.onclose(a);else if(svGlobal.logger.info("onclose: null"),hi5.appcfg&&hi5.appcfg.returnUrl){window.location.href=hi5.appcfg.returnUrl;return}ca&&(ca.close(),ca=null)}catch(c){svGlobal.logger.warn(c)}Va=null;Da&&(Da.onopen=null,Da.onmessage=
null,Da.onclose=null,Da.onerror=null,Da.close(),Da=null);ca=Qa=null;qa&&(qa.release(),qa=null);hi5.browser.isChromeApp?chrome.runtime.onSuspend.removeListener(p.close):window.removeEventListener("unload",p.close,!1);window&&window.$rdp==p&&(window.$rdp=null);p=null}}}function Rc(){Da&&Ha?Da.close():zb(!0)}function Gc(a,b){var c=a.getLittleEndian32();if(0!=(c&16777216))if(b=a.getLittleEndian32(),0!=(c&1073741824)){a.getLittleEndian16();a.getByte();c=a.getByte();var e=a.getLittleEndian16(),d=a.getLittleEndian16(),
f=0;16>c&&(f=a.getLittleEndian16());var m=a.getLittleEndian16(),H=a.getLittleEndian16();a.getBytes(m);f&&a.getBytes(f);if(8<=c&&(f=ca.getFocused())&&f.onremoteappicon){m=new hi5.graphic.Bitmap(e,d,32);a.getPosition();e=new Uint8Array(e*d*4);d=a.getPosition();H=d+H;var y;a=a.getData();for(var C=0,E,u;d<H;)switch(c){case 16:(y=a[d++]|a[d++]<<8)?(u=y>>7&248,E=y>>2&248,y=y<<3&248,u|=u>>5,E|=E>>5,y|=y>>5,e[C++]=y,e[C++]=E,e[C++]=u,e[C++]=255):C+=4;break;case 32:e[C++]=a[d++],e[C++]=a[d++],e[C++]=a[d++],
e[C++]=a[d++]}m.putPixels(e,0,e.length);a=ca.getWinById(b);f.onremoteappicon(a,m)}}else 0!=(c&2147483648)?svGlobal.logger.info("XXX rail cache icon, winId="+b):0!=(c&536870912)?(svGlobal.logger.info("***** delete winId="+b),ca.delWin(b)):Kd(a,c,b);else if(0!=(c&33554432))svGlobal.logger.info("XXX Alt Sec window Notify="+c);else if(0!=(c&67108864))if(svGlobal.logger.info("*** -- Alt Sec window Desktop, flags:"+c),0!=(c&1))svGlobal.logger.info("Desktop non monitored flags="+c);else{if(0!=(c&32)&&(b=
a.getLittleEndian32(),svGlobal.logger.info("Desktop monitored flags="+c+" winId="+b),0<b&&((f=ca.getOwnerSurfaceById(b))&&f.railWin&&f.railWin.setActiveWinId(b,3==ea.windowState),ca.setTitle(b),qa.getContext()||(b=ca.getFocused())&&qa.setContext(b.context))),0!=(c&16)&&(b=a.getByte(),0<b))for(c=ca.zOrders,c.length=b,f=0;f<b;f++)c[f]=a.getLittleEndian32(),svGlobal.logger.info("---zorders:"+c[f])}else svGlobal.logger.info("XXX Alt Sec window order flgas="+c)}function Sc(a){var b=ca.getFocused();if(b&&
b.railWin){var c=a||b.railWin.mainWin;if(c&&2<c.showState){var e=b.getFreeSpace();a=Math.max(Math.abs(c.winHeight-e.height),Math.abs(c.winWidth-e.width));svGlobal.logger.info("--- fitMainWin offset:"+a+" _hOffset:"+c._hOffset+" appId:"+c.appId+" spaceH:"+e.height);0<a?(b=a==c._hOffset,c._hOffset&&b||(c._hOffset=a,setTimeout(function(){c.resize(0,0,e.width,e.height)},333))):c._hOffset=0}}}function Kd(a,b,c){Wa||(Wa=!0);var e=0==(b&268435456),d=ca.getWinById(c);d?e=!0:d=new ca.LocalWin(c);svGlobal.logger.info("\n\n=========== winId="+
c+" existed="+e);if(d){0!=(b&2)&&(d.ownerWinid=a.getLittleEndian32(),svGlobal.logger.info("***** ownerWinid="+d.ownerWinid));0!=(b&8)&&(d.style=a.getLittleEndian32(),d.extStyle=a.getLittleEndian32(),svGlobal.logger.info("***** winId="+c+" style="+d.style+" extStyle="+d.extStyle),svGlobal.logger.info("*****--- WS_POPUP="+(0!=(d.style&2147483648))),svGlobal.logger.info("*****--- WS_DLGFRAME="+(0!=(d.style&4194304))),svGlobal.logger.info("*****--- DS_MODALFRAME="+(0!=(d.style&128))),svGlobal.logger.info("*****--- WS_EX_DLGMODALFRAME="+
(0!=(d.extStyle&1))),svGlobal.logger.info("*****--- WS_EX_TOOLWINDOW="+(0!=(d.extStyle&128))),svGlobal.logger.info("*****--- WS_BORDER="+(0!=(d.style&8388608))),svGlobal.logger.info("*****--- WS_CAPTION="+(0!=(d.style&12582912))),svGlobal.logger.info("*****--- WS_OVERLAPPED="+(0!=(d.style&0))),svGlobal.logger.info("*****--- WS_OVERLAPPEDWINDOW="+(0!=(d.style&13565952))),svGlobal.logger.info("*****--- WS_POPUPWINDOW="+(0!=(d.style&2156396544))),svGlobal.logger.info("*****--- WS_SIZEBOX="+(0!=(d.style&
262144))),svGlobal.logger.info("*****--- WS_CHILD="+(0!=(d.style&1073741824))),svGlobal.logger.info("*****--- WS_SIZEBOX="+(0!=(d.style&262144))),svGlobal.logger.info("*****--- WS_EX_MDICHILD="+(0!=(d.extStyle&64))),svGlobal.logger.info("*****--- WS_EX_LAYERED="+(0!=(d.extStyle&524288))));if(0!=(b&16)){d.setShowState(a.getByte());svGlobal.logger.info("***** winId="+c+" showState="+d.showState);var f=d.showState;(2==f&&0!=ea.noMinimize||!e&&3==f&&5==ea.windowState)&&setTimeout(function(){d.exeCommand(61728)},
50)}if(f=0!=(b&4)){var m=a.getLittleEndian16();d.titleInfo=a.getUnicodeString(m,!1);svGlobal.logger.info("***** winId="+c+" title="+d.titleInfo)}0!=(b&16384)&&(d.clientOffsetX=a.getLittleEndian32(),d.clientOffsetY=a.getLittleEndian32(),svGlobal.logger.info("***** winId="+c+" coffX"+d.clientOffsetX+" coffY="+d.clientOffsetY));0!=(b&65536)&&(d.clientAreaWidth=a.getLittleEndian32(),d.clientAreaHeight=a.getLittleEndian32(),svGlobal.logger.info("***** winId="+c+" cw"+d.clientAreaWidth+" ch="+d.clientAreaHeight));
0!=(b&131072)&&(d.rpContent=a.getLittleEndian32());0!=(b&262144)&&(d.rootParentHandle=a.getLittleEndian32());if(0!=(b&2048)){m=a.getLittleEndian32();var H=a.getLittleEndian32();d.winOffsetX=m;d.winOffsetY=H;svGlobal.logger.info("***** winId="+c+" offX"+d.winOffsetX+" offY="+d.winOffsetY)}0!=(b&32768)&&(d.winClientDeltaX=a.getLittleEndian32(),d.winClientDeltaY=a.getLittleEndian32(),svGlobal.logger.info("***** winId="+c+" dX"+d.winClientDeltaX+" dY="+d.winClientDeltaY));0!=(b&1024)&&(d.winWidth=a.getLittleEndian32(),
d.winHeight=a.getLittleEndian32(),svGlobal.logger.info("***** winId="+c+" w"+d.winWidth+" h="+d.winHeight));if(!e)if(d.isMainWin())3==p.windowState?Sc(d):setTimeout(function(){d.activate(1)},666);else if(2<d.showState&&(m=ca.getFocused())){m=m.getFreeSpace();var y=d.winWidth,C=d.winHeight;if(d.winOffsetX>m.width||d.winOffsetY>m.height||0>y+d.winOffsetX||0>C+d.winOffsetY){var E=(m.width-d.winWidth)/2|0,u=(m.height-d.winHeight)/2|0;0>E&&(E=0);0>u&&(u=0);setTimeout(function(){d.resize(E,u,y,C)},50)}}0!=
(b&256)&&(m=a.getLittleEndian16(),0<m&&a.skipPosition(8*m));0!=(b&4096)&&(d.visibleOffsetX=a.getLittleEndian32(),d.visibleOffsetY=a.getLittleEndian32());0!=(b&512)&&(b=a.getLittleEndian16(),d.numVisibilityRects=b,0<b&&a.skipPosition(8*b));if(e)ca.onWinChange(d);else ca.addWin(d);f&&ca.setTitle(c);c==ca.zOrders[0]?svGlobal.logger.info("zzz zorders win: "+c):svGlobal.logger.info("zzz win: "+c,ca.zOrders)}else svGlobal.logger.warn("XXX, No win with id:"+c)}function xc(a,b){function c(g,h,k,r,x){0<x.width?
x.union(g,h,k,r):(x.x=g,x.y=h,x.width=k,x.height=r)}function e(g,h,k,r){for(Y=0;Y<ja;Y++){var x=U[Y];if(g>=x[0]&&h>=x[1]&&k<=x[2]&&r<=x[3])return W[Y]}return null}function d(g,h,k,r){if(ja){var x=e(g,h,g+k-1,h+r-1);x&&c(g,h,k,r,x)}else c(g,h,k,r,z)}function f(g,h,k,r,x,B,I){for(var D=x*k+r,G=g.setRGB,R=g.getRGB,M=0;M<I;M++){for(var l=0;l<B;l++){if(g){var L=R(r+l,x+M);G(r+l,x+M,~L&16777215)}else h[D]=~h[D]&16777215;D++}D+=k-B}}function m(g,h,k,r,x,B,I,D,G,R){h=R*D+G;null==I&&(I=g);for(g=0;g<B;g++){for(G=
0;G<x;G++)Q[r+g][k+G]=Q[r+g][k+G]&I[h]&16777215|4278190080,h++;h+=D-x}}function H(g,h,k,r,x,B,I,D,G,R){h=R*D+G;G=g.setRGB;R=g.getRGB;null==I&&(I=g);for(g=0;g<B;g++){for(var M=0;M<x;M++){var l=R(k+M,r+g);G(k+M,r+g,l|I[h]&16777215);h++}h+=D-x}}function y(g,h,k,r){var x=ma;if(x){var B=x.getRGB(h,k);switch(g){case 0:x.setRGB(h,k,0);break;case 1:x.setRGB(h,k,~(B|r)&16777215);break;case 2:x.setRGB(h,k,B&~r&16777215);break;case 3:x.setRGB(h,k,~r&16777215);break;case 4:x.setRGB(h,k,16777215*(~B&r));break;
case 5:x.setRGB(h,k,~B&16777215);break;case 6:x.setRGB(h,k,B^r&16777215);break;case 7:x.setRGB(h,k,~B&r&16777215);break;case 8:x.setRGB(h,k,B&r&16777215);break;case 9:x.setRGB(h,k,B^~r&16777215);break;case 10:break;case 11:x.setRGB(h,k,B|~r&16777215);break;case 12:x.setRGB(h,k,r);break;case 13:x.setRGB(h,k,(~B|r)&16777215);break;case 14:x.setRGB(h,k,B|r&16777215);break;case 15:x.setRGB(h,k,16777215);break;default:svGlobal.logger.warn("unsupported pixel opcode: "+g),x.setRGB(h,k,r)}}}function C(g,
h,k,r,x,B,I,D,G){g>D||h>G||(k=g+k-1,k>D&&(k=D),g<B&&(g=B),k=k-g+1,r=h+r-1,r>G&&(r=G),h<I&&(h=I),r=r-h+1,1>k||1>r||ma.fillRect(g,h,k,r,x))}function E(g,h,k,r,x,B,I,D,G,R,M,l){if(!(h>M||k>l)){var L=h+r-1;L>M&&(L=M);G=h<G?G:h;L=L-h+1;M=k+x-1;M>l&&(M=l);R=k<R?R:k;l=M-k+1;if(!(1>L||1>l)){M=128;var N=0;I|=4278190080;D|=4278190080;if(G==h&&R==k&&L==r&&l==x)if(0==g)for(var S=0;S<x;S++){g=k+S;for(var ba=0;ba<r;ba++)0==M&&(N++,M=128),0!=(B[N]&M)&&(Q[g][h+ba]=D),M>>=1;N++;M=128;N==B.length&&(N=0)}else for(S=
0;S<x;S++){g=k+S;for(ba=0;ba<r;ba++)0==M&&(N++,M=128),Q[g][h+ba]=0!=(B[N]&M)?D:I,M>>=1;N++;M=128;N==B.length&&(N=0)}else if(0==g)for(S=0;S<l;S++){g=k+S;for(ba=0;ba<L;ba++)0==M&&(N++,M=128),h+ba>=G&&g>=R&&0!=(B[N]&M)&&(Q[g][h+ba]=D),M>>=1;N++;M=128;N==B.length&&(N=0)}else for(S=0;S<l;S++){g=k+S;for(ba=0;ba<L;ba++)0==M&&(N++,M=128),h+ba>=G&&k+S>=R&&(Q[g][h+ba]=0!=(B[N]&M)?D:I),M>>=1;N++;M=128;N==B.length&&(N=0)}}}}function u(g,h,k,r,x){this.offset=g;this.baseLine=h;this.width=k;this.height=r;this.fontData=
x}function v(g,h,k,r,x,B,I,D,G){this.cache_idx=g;this.rawData=h;this.none=!h;this.hotX=k;this.hotY=r;this.width=x;this.height=B;this.xorSize=D;this.andSize=G;this.result="";this.distance=0;this.bpp=I;this.system="";if(h){if(!this.distance){g=0;if(h){I=0;for(var R=h.length;I<R;I++)0!=h[I]&&(g+=I%x+(I/x|0))}this.distance=g}if(!this.system){a:switch(this.distance){case 507:g="text";break a;case 2046:case 4359:g="default";break a;default:g=""}this.system=g}}g="";if(!this.system&&h){I=x*B*4;g=62+I+D+G;
R=new Uint8Array(g);g=new hi5.DataBuffer(R,0,g);g.setLittleEndian16(0);g.setLittleEndian16(2);g.setLittleEndian16(1);g.setByte(x);g.setByte(B);g.setByte(0);g.setByte(0);g.setLittleEndian16(k);g.setLittleEndian16(r);g.setLittleEndian32(40+I+D+G);g.setLittleEndian32(22);g.setLittleEndian32(40);g.setLittleEndian32(x);g.setLittleEndian32(2*B);g.setLittleEndian16(1);g.setLittleEndian16(32);g.setLittleEndian32(0);g.setLittleEndian32(D+G);g.setLittleEndian32(0);g.setLittleEndian32(0);g.setLittleEndian32(0);
g.setLittleEndian32(0);for(k=B-1;0<=k;k--)for(r=0;r<x;r++)B=h[x*k+r],g.setByte(B&255),g.setByte(B>>8&255),g.setByte(B>>16&255),g.setByte(B>>24&255);g="data:image/x-icon;base64,"+hi5.Base64.enc(g.getData())}this.url=g}var Q=[],q=null,z=new hi5.graphic.Rectangle(0,0,0,0),A="Uint8ClampedArray"in window,t=null,F=0,T=0,w=0,K=0,O=null,U,W,Y=0,ja=0;this.width=a;this.height=b;var pa=!1,ma=this,wa={imgData:null,left:0,top:0,width:0,height:0};this.setProfiler=function(g){t=g};this.getDirtyArea=function(){return z};
this.setImgRect=function(g,h,k,r){F=g;T=h;w=k;K=r};this.parseMonitorDef=function(g){var h=g.split(","),k=h.length,r=[];if(1<k){for(var x=!1,B=0;B<k;B++){var I=h[B].split(":");if(4==I.length)r[B]=Array(5),r[B][0]=parseInt(I[0]),r[B][1]=parseInt(I[1]),r[B][2]=parseInt(I[2]),r[B][3]=parseInt(I[3]),r[B][4]=0==r[B][0]&&0==r[B][1]?1:0;else{x=!0;break}}x&&(svGlobal.logger.warn("invaiid monitorDef:"+g),r.length=0)}return r};this.setMonitorLayout=function(g){var h=g.length,k=0;U=g;for(W=Array(h);k<h;k++)W[k]=
new hi5.graphic.Rectangle(0,0,0,0);ja=h};this.setMonitorCount=function(g){ja=g};this.addImg=function(g){w&&(O&&URL.revokeObjectURL(O.src),O=g)};this.flushImgs=function(){O&&(URL.revokeObjectURL(O.src),O=null,w=0)};this.getData=function(){return Q};this.pause=function(g,h){pa=g;h&&q&&q.fillRect(0,0,a,b)};this.release=function(){z=null;hi5.Arrays.release(W);ma.flushImgs();Q=q=ma=null;wa=wa.imgData=null};this.isPaused=function(){return pa};this.setContext=function(g){g!=q&&(q||!g||g.createImageData(1,
1).data.buffer||(A=!1),q=g,null!=q&&(wa.imgData=q.createImageData(a,b)))};this.getContext=function(){return q};this.resize=function(g,h){if(Q.length!=h||Q[0].length!=g){for(var k=0;k<h;k++)Q[k]=new Uint32Array(g);Q.length=h;ma.width=a=g;ma.height=b=h;null!=q&&(wa.imgData=q.createImageData(a,b))}};ma.resize(a,b);this.getBuffer=function(){return Q};this.setRGB=function(g,h,k){Q[h][g]=k|4278190080};this.getRGB=function(g,h){return Q[h][g]};this.setRGBs=function(g,h,k,r,x,B,I){var D=g+k,G=h+r;G>b&&(G=
b);if(!(g>=a)){D>a&&(k-=D-a);for(D=h;D<G;D++,B+=I)Q[D].set(x.subarray(B,B+k),g);d(g,h,k,r)}};this.moveArea=function(g,h,k,r,x,B){if(0<B){var I=g+x,D=h+B,G;for(G=r-1;0<=G;G--)Q[D+G].set(Q[h+G].subarray(g,g+k),I)}else if(0>B)for(I=g+x,D=h+B,G=0;G<r;G++)Q[D+G].set(Q[h+G].subarray(g,g+k),I);else if(0<x){I=g+x;D=h+B;var R;for(G=k-1;0<=G;G--){var M=I+G;var l=g+G;for(R=0;R<r;R++)Q[D+R][M]=Q[h+R][l]}}else for(I=g+x,D=h+B,G=0;G<k;G++)for(M=I+G,l=g+G,R=0;R<r;R++)Q[D+R][M]=Q[h+R][l];d(g+x,h+B,k,r)};this.getRGBs=
function(g,h,k,r,x){var B=new Uint32Array(k*r),I=g+k;r=h+r;for(var D=0;h<r;h++)B.set(Q[h].subarray(g,I),D),D+=k;return x?(x(B),null):B};this.repaint=function(g,h,k,r){var x=wa.imgData.data,B=0,I,D;t&&t.begin("paint");0>g&&(k+=g,g=0);0>h&&(r+=h,h=0);g+k>a&&(k=a-g);h+r>b&&(r=b-h);var G=g+k;var R=h+r;if(A)for(x=new Uint32Array(x.buffer),D=h;D<R;D++)x.set(Q[D].subarray(g,G),B),B+=a;else{var M=4*(a-k)|0;for(D=h;D<R;D++){for(I=g;I<G;I++){var l=Q[D][I];x[B++]=l&255;x[B++]=l>>8&255;x[B++]=l>>16&255;x[B++]=
255}B+=M}}wa.left=g;wa.top=h;wa.width=k;wa.height=r;t&&t.end("paint");return wa};this.postPaint=d;this.draw=function(g,h,k,r){if(!pa&&q)if(O&&O.complete&&(q.drawImage(O,F,T,w,K),URL.revokeObjectURL(O.src),O=null),ja){if(g=e(g,h,k,r),g.width)return ma.repaint(g.x,g.y,g.width,g.height),g.width=0,wa}else if(z.width)return ma.repaint(z.x,z.y,z.width,z.height),z.width=0,wa;return null};this.fillRect=function(g,h,k,r,x){var B=g+k,I=h+r;if(Q[0].fill)for(var D,G=h;G<I;G++)Q[G].fill(x,g,B);else for(G=h;G<
I;G++)for(D=g;D<B;D++)Q[G][D]=x;d(g,h,k,r)};this.drawLine=function(g,h,k,r,x){if(h==r){if(g>k){var B=g;g=k;k=B}var I=Q[h];k++;if(I.fill)I.fill(x,g,k);else for(B=g;B<k;B++)I[B]=x}else if(g==k)for(h>r&&(B=h,h=r,r=B),r++,B=h;B<r;B++)Q[B][g]=x;else{var D=Math.abs(k-g),G=Math.abs(r-h);B=g;I=h;k=k>=g?g=1:g=-1;h=r>=h?r=1:r=-1;if(D>=G){h=g=0;var R=D;var M=D/2|0;var l=G}else r=k=0,R=G,M=G/2|0,l=D,D=G;if(!(1>D))for(D++,G=0;G<D;G++)Q[I][B]=x,M+=l,M>=R&&(M-=R,B+=g,I+=r),B+=k,I+=h}};this.bitBlt=function(g,h,k,
r,x,B,I,D,G,R){var M=ma;switch(g){case 0:D=M.setRGB;for(M=k;M<k+x;M++)for(G=r;G<r+B;G++)D(M,G,0);break;case 1:g=I;G=R*D+G;R=M.setRGB;h=M.getRGB;null==g&&(g=M);for(M=0;M<B;M++){for(I=0;I<x;I++)R(k+x,r+B,~(h(k+x,r+B)|g[G])&16777215);G+=D-x}break;case 2:g=I;G=R*D+G;R=M.setRGB;h=M.getRGB;null==g&&(g=M);for(M=0;M<B;M++){for(I=0;I<x;I++){var l=h(k+x,r+B);R(k+x,r+B,l&~g[G]&16777215);G++}G+=D-x}break;case 3:f(M,I,D,G,R,x,B);I?M.setRGBs(k,r,x,B,I,R*D+G,D):M.moveArea(G,R,x,B,k-G,r-R);break;case 4:f(M,null,
h,k,r,x,B);m(M,h,k,r,x,B,I,D,G,R);break;case 5:f(M,null,h,k,r,x,B);break;case 6:g=I;G=R*D+G;null==g&&(g=M);for(M=0;M<B;M++){for(R=0;R<x;R++)Q[r+M][k+R]=Q[r+M][k+R]^g[G]&16777215|4278190080,G++;G+=D-x}break;case 7:g=I;G=R*D+G;R=M.setRGB;h=M.getRGB;null==g&&(g=M);for(M=0;M<B;M++){for(I=0;I<x;I++)l=h(k+I,r+M),R(k+I,r+M,~(l&g[G])&16777215),G++;G+=D-x}break;case 8:m(M,h,k,r,x,B,I,D,G,R);break;case 9:g=I;G=R*D+G;R=M.setRGB;h=M.getRGB;null==g&&(g=M);for(M=0;M<B;M++){for(I=0;I<x;I++)l=h(k+I,r+M),R(k+I,r+
M,l^~g[G]&16777215),G++;G+=D-x}break;case 10:break;case 11:g=I;G=R*D+G;R=M.setRGB;h=M.getRGB;null==g&&(g=M);for(M=0;M<B;M++){for(I=0;I<x;I++)l=h(k+I,r+M),R(k+I,r+M,l|~g[G]&16777215),G++;G+=D-x}break;case 12:I?M.setRGBs(k,r,x,B,I,R*D+G,D):M.moveArea(G,R,x,B,k-G,r-R);break;case 13:f(M,null,h,k,r,x,B);H(M,h,k,r,x,B,I,D,G,R);break;case 14:H(M,h,k,r,x,B,I,D,G,R);break;case 15:D=M.setRGB;for(M=k;M<k+x;M++)for(G=r;G<r+B;G++)D(M,G,16777215);break;default:svGlobal.logger.warn("unsupported opcode: "+g)}d(k,
r,x,B)};this.drawLineExt=function(g,h,k,r,x,B){if(g==k||h==r){var I;if(h==r)if(k>g){var D=k-g;if(!(1>D))for(I=0;I<D;I++)y(B,g+I,h,x)}else{if(D=g-k,!(1>D))for(I=0;I<D;I++)y(B,k+I,h,x)}else if(r>h){if(D=r-h,!(1>D))for(I=0;I<D;I++)y(B,g,h+I,x)}else if(D=h-r,!(1>D))for(I=0;I<D;I++)y(B,g,r+I,x)}else{var G=Math.abs(k-g),R=Math.abs(r-h);I=g;D=h;var M,l;var L=k>=g?M=1:M=-1;var N=r>=h?l=1:l=-1;if(G>=R){N=M=0;var S=G;var ba=G/2>>0;var na=R}else l=L=0,S=R,ba=R/2>>0,na=G,G=R;if(1>G)return;for(R=0;R<=G;R++)y(B,
I,D,x),ba+=na,ba>=S&&(ba-=S,I+=M,D+=l),I+=L,D+=N}x=Math.min(g,k);g=Math.max(g,k);k=Math.min(h,r);h=Math.max(h,r);0>g-x||0>h-k||d(x,k,g-x+1,h-k+1)};this.drawText=function(g,h,k,r,x,B,I,D,G,R,M,l,L,N,S,ba,na,Ba,za,La,Ga){var Ca=0;1<l?C(R,M,l,L,x,Ba,za,La,Ga):1==k&&C(B,I,D,G,x,Ba,za,La,Ga);for(var Sa=ba,va=0;va<ba;)switch(na[Ca+va]){case 255:var xa=na[Ca+va+2];if(xa>Sa-Ca){va=ba=0;break}xa=na.slice?na.slice(Ca,Ca+xa):na.subarray(Ca,Ca+xa);fa[na[Ca+va+1]]=xa;va+=3;ba-=va;Ca=va;va=0;break;case 254:var Na=
(xa=fa[na[Ca+va+1]])?xa:null;Na&&0==Na[1]&&0==(h&32)&&(0!=(h&4)?S+=na[Ca+va+2]:N+=na[Ca+va+2]);va=va+2<ba?va+3:va+2;ba-=va;Ca=va;va=0;if(!Na)break;for(var Za=Na.length,$a=0;$a<Za;$a++){xa=ya.getFont(g,Na[$a]);if(0==(h&32)){var Ua=Na[++$a];0!=(Ua&128)?(0!=(h&4)?S+=Na[$a+1]|Na[$a+2]<<8:N+=Na[$a+1]|Na[$a+2]<<8,$a+=2):0!=(h&4)?S+=Ua:N+=Ua}xa&&(E(k,N+xa.offset&65535,S+xa.baseLine&65535,xa.width,xa.height,xa.fontData,x,r,Ba,za,La,Ga),0!=(h&32)&&(N+=xa.width))}break;default:xa=ya.getFont(g,na[Ca+va]),0==
(h&32)&&(Ua=na[Ca+ ++va],0!=(Ua&128)?(0!=(h&4)?S+=na[Ca+va+1]|na[Ca+va+2]<<8:N+=na[Ca+va+1]|na[Ca+va+2]<<8,va+=2):0!=(h&4)?S+=Ua:N+=Ua),xa&&(E(k,N+xa.offset&65535,S+xa.baseLine&65535,xa.width,xa.height,xa.fontData,x,r,Ba,za,La,Ga),0!=(h&32)&&(N+=xa.width)),va++}1<l?0<L&&d(R,M,l,L):0<D&&0<G&&d(B,I,D,G)};this.drawBitmap=function(g,h,k,r,x,B,I,D,G){var R=ia.getBitmap(g,h);R?(g=R.width,h=R.height,x>g&&(x=g),B>h&&(B=h),12==G?ma.setRGBs(k,r,x,B,R.data,D*g+I,g):ma.bitBlt(G,a,k,r,x,B,R.data,g,I,D)):svGlobal.logger.warn("Failed to get bitmap from cache, id:"+
g+" idx="+h)};this.saveDesktop=function(g,h,k,r,x){ma.getRGBs(g,h,k,r,function(B){ka.save(g,h,k,r,x,B)})};this.restoreDesktop=function(g,h,k,r,x){(x=ka.restore(g,h,k,r,x))?ma.setRGBs(g,h,k,r,x,0,k):svGlobal.logger.warn("XXX no matched desktop save.")};this.putFont=function(g,h,k){ya.putFont(g,h,k)};this.putBitmap=function(g,h,k){ia.putBitmap(g,h,k)};this.putCursor=function(g,h){ua.set(g,h)};this.setCursor=function(g){if(!pa&&-1!=g){var h=ua.get(g);if(h)ma.onSetCursor(h);else svGlobal.logger.warn("invalid cursor"+
g)}};var oa=0;this.isSendingHistory=function(){return 2E3>Date.now()-oa};this.getHistory=function(g,h){var k=null;(k=ua.toPDU())&&g(k.buffer);if(ma.onGetGfxHistory)ma.onGetGfxHistory(g,h);else{t&&t.begin("his_bitmap");ia.forEach(function(D,G,R){if(D){var M=0,l=0;R=0;for(var L=D.length;R<L;R++)D[R]&&D[R].data&&(M++,l+=D[R].raw?D[R].raw.length:4*D[R].data.length);if(M&&l){k=new Uint8Array(l+20*M+8);k[0]=29;k[2]=1;k[3]=4;l=new hi5.DataBuffer(k,4,k.length);l.setLittleEndian32(M);for(R=0;R<L;R++)(M=D[R])&&
M.data&&(l.setLittleEndian16(G),l.setLittleEndian16(R),l.setLittleEndian16(M.left),l.setLittleEndian16(M.top),l.setLittleEndian16(M.width),l.setLittleEndian16(M.height),l.setLittleEndian16(M.bitsperpixel),l.setLittleEndian16(M.codec),l.setLittleEndian32(M.raw?M.raw.length:4*M.data.length),l.setBytes(M.raw||new Uint8Array(M.data.buffer)));g(k.buffer)}}});t&&t.end("his_bitmap");t&&t.begin("his_font");(k=ya.toPDU())&&g(k.buffer);t&&t.end("his_font");for(var r=4,x=0,B=fa.length;x<B;x++)fa[x]&&(r+=fa[x].length+
6);if(4<r){k=new Uint8Array(r);k[0]=29;k[2]=1;k[3]=7;var I=4;x=0;for(B=fa.length;x<B;x++)fa[x]&&fa[x].length&&(k[I++]=x,k[I++]=x>>8,r=fa[x].length,k[I++]=r,k[I++]=r>>8,k[I++]=r>>16,k[I++]=r>>24,k.set(fa[x],I),I+=r);g(k.buffer)}(k=ka.toPDU())&&g(k.buffer);h();oa=Date.now()}};this.onHistoryDone=function(){ma.onGetGfxHistory&&p.reconnect(a,b,!0)};this.setHistory=function(g,h){svGlobal.logger.info("setHistory type:"+g);switch(g){case 4:t&&t.begin("his_bitmap_dec");var k=h.getLittleEndian32();for(g=0;g<
k;g++){var r=h.getLittleEndian16(),x=h.getLittleEndian16(),B=h.getLittleEndian16(),I=h.getLittleEndian16(),D=h.getLittleEndian16(),G=h.getLittleEndian16(),R=h.getLittleEndian16(),M=h.getLittleEndian16(),l=h.getLittleEndian32(),L=new Uint8Array(h.getData().buffer,h.getPosition(),l),N=new Uint8Array(l);N.set(L);L=rdpcodecs.bitmap;switch(M){case 0:var S=new Uint32Array(N.buffer);h.skipPosition(l);break;case 1:switch(R){case 16:S=L.decompressInt16(D,G,l,N,0);break;case 24:S=L.decompressInt24(D,G,l,N,
0);break;case 32:S=L.decompressInt32(D,G,l,N,0)}h.skipPosition(l);break;case 2:S=new rdpcodecs.NSCodec,S.process(h,R,D,G),l=S.getData(),S=S.getDataSize(),S=new Uint32Array(S),rdpcodecs.flipimage(l,0,S,D,G,1)}ia.putBitmap(r,x,new rdpcodecs.Bitmap(S,D,G,B,I,R,0==M?null:N,M))}t&&t.end("his_bitmap_dec");break;case 5:ya.fromStream(h);break;case 6:ua.fromStream(h);break;case 7:for(;h.has(6);)if(g=h.getLittleEndian16(),l=h.getLittleEndian32())k=h.getData().subarray(h.getPosition(),h.getPosition()+l),fa[g]=
k,h.skipPosition(l);break;case 9:ka.fromStream(h);break;default:if(ma.onSetGfxHistory)ma.onSetGfxHistory(g,h)}};var ua=new function(){var g=[],h=!1;this.useRemoteCursor=function(k){h=k};this.set=function(k,r){h&&(r.system="");g[k]=r};this.get=function(k){return g[k]};this.total=function(){return g.length};this.toPDU=function(){for(var k=2,r=2,x=0,B=0,I=g.length,D;B<I;B++)if(D=g[B])x++,r=r+7+(D.rawData?D.rawData.length:0);if(!x)return null;r=new Uint32Array(r);r[0]=100728861;r[1]=x;for(B=0;B<I;B++)if(D=
g[B])if(x=D.rawData?D.rawData.length:0,r[k++]=D.cache_idx|D.bpp<<16,r[k++]=D.hotX|D.hotY<<16,r[k++]=D.width|D.height<<16,r[k++]=D.xorSize,r[k++]=D.andSize,r[k++]=D.distance,r[k++]=x)r.set(D.rawData,k),k+=x;return r};this.fromStream=function(k){var r=k.getPosition();k=new Uint32Array(k.getData().buffer,r);var x=k[0],B=0;for(r=1;B<x;B++){var I=k[r]&65535;var D=k[r++]>>16;var G=k[r]&65535;var R=k[r++]>>16;var M=k[r]&65535;var l=k[r++]>>16;var L=k[r++];var N=k[r++];var S=k[r++];var ba=k[r++];var na=null;
ba&&(na=new Uint32Array(ba),na.set(k.subarray(r,r+ba)),r+=ba);D=new v(I,na,G,R,M,l,D,L,N);S&&(D.distance=S);h&&(D.system="");g[I]=D}}};ua.useRemoteCursor(!!ea.remoteCursor);var ka=new function(){function g(k,r,x,B,I,D){this.x=k;this.y=r;this.cx=x;this.cy=B;this.offset=I;this.data=D}var h=[];this.save=function(k,r,x,B,I,D){k=new g(k,r,x,B,I,D);r=0;for(x=h.length;r<x;r++)if(!h[r]){h[r]=k;return}h.push(k)};this.restore=function(k,r,x,B,I){for(var D,G=0,R=h.length;G<R;G++)if((D=h[G])&&D.x==k&&D.y==r&&
D.cx==x&&D.cy==B){if(D.offset==I)return k=D.data,h[G]=null,k;svGlobal.logger.warn("TODO: offset")}return null};this.toPDU=function(){for(var k=0,r=2,x=0,B=h.length;x<B;x++)h[x]&&(k++,r+=h[x].data.length+6);if(!k||!r)return null;r=new Uint32Array(r);var I=2;r[0]=151060509;r[1]=k;for(x=0;x<B;x++)if(k=h[x])r[I++]=k.x,r[I++]=k.y,r[I++]=k.cx,r[I++]=k.cy,r[I++]=k.offset,r[I++]=k.data.length,r.set(k.data,I),I+=k.data.length;return r};this.fromStream=function(k){k=new Uint32Array(k.getData().buffer,k.getPosition());
for(var r=1,x=k[0],B,I,D,G,R,M,l,L=0;L<x;L++)B=k[r++],I=k[r++],D=k[r++],G=k[r++],R=k[r++],M=k[r++],l=new Uint32Array(M),M=r+M,l.set(k.subarray(r,M)),r=M,this.save(B,I,D,G,R,l)}},fa=[],ya=new function(){var g=[];this.putFont=function(h,k,r){g[h]||(g[h]=[]);g[h][k]=r};this.getFont=function(h,k){return g[h]?g[h][k]:null};this.toPDU=function(){var h=0,k,r,x;var B=4;for(var I,D=g.length;h<D;h++)if((x=g[h])&&x.length)for(I=x.length,k=0;k<I;k++)(r=x[k])&&(B+=15+r.fontData.length);if(5>B)return null;var G=
new Uint8Array(B);B=new hi5.DataBuffer(G,0,B);G[0]=29;G[2]=1;G[3]=5;B.skipPosition(4);h=0;for(D=g.length;h<D;h++)if((x=g[h])&&x.length)for(I=x.length,k=0;k<I;k++)if(r=x[k])B.setByte(h),B.setLittleEndian16(k),B.setLittleEndian16(r.offset),B.setLittleEndian16(r.baseLine),B.setLittleEndian16(r.width),B.setLittleEndian16(r.height),B.setLittleEndian32(r.fontData.length),B.setBytes(r.fontData);return G};this.fromStream=function(h){for(;h.has(15);){var k=h.getByte(),r=h.getLittleEndian16(),x=h.getLittleEndian16(),
B=h.getLittleEndian16(),I=h.getLittleEndian16(),D=h.getLittleEndian16(),G=h.getLittleEndian32();G=h.getBytes(G);this.putFont(k,r,new u(x,B,I,D,G))}}},ia=new function(){var g=[],h=[];this.putBitmap=function(k,r,x){if(32767==r)h[k]&&(h[k].data=null,h[k]=null),h[k]=x;else{var B=g[k];B?B[r]&&(B[r].data=null,B[r]=null):g[k]=B=[];B[r]=x}};this.getBitmap=function(k,r){return 32767==r?h[k]:g[k]?g[k][r]:null};this.forEach=function(k){for(var r=g.length,x=0;x<r;x++)k(g[x],x,g)}}}function Lb(a){function b(l,
L,N){L[N]=l>>24&255;L[N+1]=l>>16&255;L[N+2]=l>>8&255;L[N+3]=l&255}function c(l,L){var N=l.length;L=new Uint8Array(L?N+1:N);for(var S=0;S<N;S++)L[S]=l.charCodeAt(S);return L}var e=new Uint8Array([0,0,0,0]),d=new Uint8Array([255,255,255,255]),f={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],mvex:[],mvhd:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],
smhd:[],mehd:[]},m=this,H=1,y=a?48E3:9E4,C=1,E=!1,u=null;this.initTypes=function(){for(var l in f)f[l]=[l.charCodeAt(0),l.charCodeAt(1),l.charCodeAt(2),l.charCodeAt(3)];f.url=[117,114,108,32]};m.initTypes();this.reset=function(){E=!1;C=H=1};this.close=function(){m&&(m.reset(),m=null)};this.remux=function(l){l.id=H;l.isAudio=a;l.timeScale=a?l.audioHeader.sampleRate:y;if(!E){var L=new Q(a),N=new q(l);u=new Uint8Array(L.data.length+N.data.length);u.set(L.data,0);u.set(N.data,L.data.length);E=!0}l.sequenceNumber=
C++;L=new x(l);N=new M(l);l=new Uint8Array(L.data.length+N.data.length);l.set(L.data,0);l.set(N.data,L.data.length);u&&(L=new Uint8Array(u.length+l.length),L.set(u,0),L.set(l,u.length),l=L,u=null);if(m.ondata)m.ondata(l)};var v=function(l){this.type=l;this.data=null};v.prototype.setData=function(){var l=Array.prototype.slice.call(arguments,0),L=l.length,N=8,S;for(S=0;S<L;S++)N+=l[S].byteLength;this.data=new Uint8Array(N);b(N,this.data,0);this.data.set(this.type,4);N=8;for(S=0;S<L;S++)this.data.set(l[S],
N),N+=l[S].byteLength};var Q=function(l){var L=v.call(this,f.ftyp)||this;var N=c("mp42"),S=c("mp41"),ba=c("isom"),na=c("avc1"),Ba=c("iso5"),za=new Uint8Array([0,0,2,0]);l?L.setData(N,za,N,S,ba,Ba):L.setData(ba,za,ba,S,Ba,na);return L};$jscomp.inherits(Q,v);var q=function(l){var L=v.call(this,f.moov)||this;var N=new z(l),S=new A(l);l=new k(l);L.setData(N.data,S.data,l.data);return L};$jscomp.inherits(q,v);var z=function(l){l=v.call(this,f.mvhd)||this;var L=new Uint8Array([0]),N=new Uint8Array([0,0,
0]),S=new Uint8Array([0,0,0,0]),ba=new Uint8Array([0,0,0,0]),na=new Uint8Array(4);b(1E3,na,0);var Ba=new Uint8Array([0,1,0,0]),za=new Uint8Array([1,0]),La=new Uint8Array(10),Ga=new Uint8Array(36);Ga[1]=1;Ga[17]=1;Ga[32]=64;var Ca=new Uint8Array(24),Sa=new Uint8Array([255,255,255,255]);l.setData(L,N,S,ba,na,e,Ba,za,La,Ga,Ca,Sa);return l};$jscomp.inherits(z,v);var A=function(l){var L=v.call(this,f.trak)||this;var N=new t(l);l=new F(l);L.setData(N.data,l.data);return L};$jscomp.inherits(A,v);var t=function(l){var L=
v.call(this,f.tkhd)||this;var N=new Uint8Array([0]),S=new Uint8Array([0,0,7]),ba=new Uint8Array([0,0,0,0]),na=new Uint8Array([0,0,0,0]),Ba=new Uint8Array(4);b(l.id,Ba,0);var za=new Uint8Array(4),La=new Uint8Array(8),Ga=new Uint8Array([0,0]),Ca=new Uint8Array([0,0]),Sa=l.isAudio?new Uint8Array([1,0]):new Uint8Array([0,0]),va=new Uint8Array(2),xa=new Uint8Array(36);xa[1]=1;xa[17]=1;xa[32]=64;var Na=new Uint8Array(4);Na[0]=l.width>>8&255;Na[1]=l.width&255;Na[2]=0;Na[3]=0;var Za=new Uint8Array(4);Za[0]=
l.height>>8&255;Za[1]=l.height&255;Za[2]=0;Za[3]=0;L.setData(N,S,ba,na,Ba,za,e,La,Ga,Ca,Sa,va,xa,Na,Za);return L};$jscomp.inherits(t,v);var F=function(l){var L=v.call(this,f.mdia)||this;var N=new T(l),S=new w(l);l=new K(l);L.setData(N.data,S.data,l.data);return L};$jscomp.inherits(F,v);var T=function(l){var L=v.call(this,f.mdhd)||this;var N=new Uint8Array([0]),S=new Uint8Array([0,0,0]),ba=new Uint8Array([0,0,0,0]),na=new Uint8Array([0,0,0,0]),Ba=new Uint8Array(4);b(l.timeScale,Ba,0);l=new Uint8Array([85,
196]);var za=new Uint8Array(2);L.setData(N,S,ba,na,Ba,e,l,za);return L};$jscomp.inherits(T,v);var w=function(l){var L=v.call(this,f.hdlr)||this;var N=new Uint8Array([0]),S=new Uint8Array([0,0,0]),ba=new Uint8Array(4);l=l.isAudio?c("soun"):c("vide");var na=new Uint8Array(12),Ba=c("Remote Spark Handler",!0);L.setData(N,S,ba,l,na,Ba);return L};$jscomp.inherits(w,v);var K=function(l){var L=v.call(this,f.minf)||this;var N=new W,S=new pa(l);l.isAudio?(l=new U,L.setData(l.data,N.data,S.data)):(l=new O,L.setData(l.data,
N.data,S.data));return L};$jscomp.inherits(K,v);var O=function(){var l=v.call(this,f.vmhd)||this;var L=new Uint8Array([0]),N=new Uint8Array([0,0,1]),S=new Uint8Array([0,0]),ba=new Uint8Array(6);l.setData(L,N,S,ba);return l};$jscomp.inherits(O,v);var U=function(){var l=v.call(this,f.smhd)||this;var L=new Uint8Array([0]),N=new Uint8Array([0,0,0]),S=new Uint8Array([0,0]),ba=new Uint8Array(2);l.setData(L,N,S,ba);return l};$jscomp.inherits(U,v);var W=function(){var l=v.call(this,f.dinf)||this;var L=new Y;
l.setData(L.data);return l};$jscomp.inherits(W,v);var Y=function(){var l=v.call(this,f.dref)||this;var L=new Uint8Array([0]),N=new Uint8Array([0,0,0]),S=new Uint8Array([0,0,0,1]),ba=new ja;l.setData(L,N,S,ba.data);return l};$jscomp.inherits(Y,v);var ja=function(){var l=v.call(this,f.url)||this;var L=new Uint8Array([0]),N=new Uint8Array([0,0,1]);l.setData(L,N);return l};$jscomp.inherits(ja,v);var pa=function(l){var L=v.call(this,f.stbl)||this;l=new ma(l);var N=new ya,S=new ia,ba=new g,na=new h;L.setData(l.data,
N.data,S.data,ba.data,na.data);return L};$jscomp.inherits(pa,v);var ma=function(l){var L=v.call(this,f.stsd)||this;var N=new Uint8Array([0]),S=new Uint8Array([0,0,0]),ba=new Uint8Array([0,0,0,1]);l.isAudio?(l=new wa(l),L.setData(N,S,ba,l.data)):(l=new ua(l),L.setData(N,S,ba,l.data));return L};$jscomp.inherits(ma,v);var wa=function(l){var L=v.call(this,f.mp4a)||this;var N=new Uint8Array(6),S=new Uint8Array([0,1]),ba=new Uint8Array(8),na=new Uint8Array([0,2]),Ba=new Uint8Array([0,16]),za=new Uint8Array([0,
0]),La=new Uint8Array(2),Ga=l.audioHeader.sampleRate,Ca=new Uint8Array(4);Ca[0]=Ga>>8&255;Ca[1]=Ga&255;Ca[2]=0;Ca[3]=0;l=new oa(l);L.setData(N,S,ba,na,Ba,za,La,Ca,l.data);return L};$jscomp.inherits(wa,v);var oa=function(l){var L=v.call(this,f.esds)||this;var N=new Uint8Array([0]),S=new Uint8Array([0,0,0]),ba=new Uint8Array([3]),na=new Uint8Array([25]),Ba=new Uint8Array([0,0]),za=new Uint8Array([0]),La=new Uint8Array([4]),Ga=new Uint8Array([17]),Ca=new Uint8Array([64]),Sa=new Uint8Array([21]),va=new Uint8Array(3),
xa=l.bufferSizeDB;va[0]=xa>>16&255;va[1]=xa>>8&255;va[2]=xa&255;xa=new Uint8Array(4);b(l.bitRate,xa,0);var Na=new Uint8Array(4);b(l.bitRate,Na,0);var Za=new Uint8Array([5]),$a=new Uint8Array([2]),Ua=l.audioHeader.audioType||2,pb=l.audioHeader.frequencyIdx,ub=l.audioHeader.channelConfig;l=new Uint8Array(2);l[0]=Ua<<3|pb>>1&7;l[1]=(pb&1)<<7|ub<<3;Ua=new Uint8Array([6]);pb=new Uint8Array([1]);ub=new Uint8Array([2]);L.setData(N,S,ba,na,Ba,za,La,Ga,Ca,Sa,va,xa,Na,Za,$a,l,Ua,pb,ub);return L};$jscomp.inherits(oa,
v);var ua=function(l){var L=v.call(this,f.avc1)||this;var N=new Uint8Array(6),S=new Uint8Array([0,1]),ba=new Uint8Array([0,0]),na=new Uint8Array(2),Ba=new Uint8Array(12),za=new Uint8Array(2);za[0]=l.width>>8&255;za[1]=l.width&255;var La=new Uint8Array(2);La[0]=l.height>>8&255;La[1]=l.height&255;var Ga=new Uint8Array([0,72,0,0]),Ca=new Uint8Array([0,72,0,0]),Sa=new Uint8Array(4),va=new Uint8Array([0,1]),xa=c("SparkStreamPlayer"),Na=new Uint8Array(32);Na[0]=xa.length;Na.set(xa,1);xa=new Uint8Array([0,
24]);var Za=new Uint8Array([255,255]);l=new ka(l);L.setData(N,S,ba,na,Ba,za,La,Ga,Ca,Sa,va,Na,xa,Za,l.data);return L};$jscomp.inherits(ua,v);var ka=function(l){var L=v.call(this,f.avcC)||this;var N=new Uint8Array([1]),S=new Uint8Array([l.sps[1]]),ba=new Uint8Array([l.sps[2]]),na=new Uint8Array([l.sps[3]]),Ba=new Uint8Array([255]),za=new Uint8Array([225]),La=new Uint8Array(2),Ga=l.sps.byteLength;La[0]=Ga>>8&255;La[1]=Ga&255;Ga=new Uint8Array(l.sps);var Ca=new Uint8Array([1]),Sa=new Uint8Array(2),va=
l.pps.byteLength;Sa[0]=va>>8&255;Sa[1]=va&255;l=new Uint8Array(l.pps);L.setData(N,S,ba,na,Ba,za,La,Ga,Ca,Sa,l);return L};$jscomp.inherits(ka,v);var fa=function(){var l=v.call(this,f.btrt)||this;var L=new Uint8Array([0,28,156,128]),N=new Uint8Array([0,45,198,192]),S=new Uint8Array([0,45,198,192]);l.setData(L,N,S);return l};$jscomp.inherits(fa,v);var ya=function(){var l=v.call(this,f.stts)||this;var L=new Uint8Array([0]),N=new Uint8Array([0,0,0]),S=new Uint8Array([0,0,0,0]);l.setData(L,N,S);return l};
$jscomp.inherits(ya,v);var ia=function(){var l=v.call(this,f.stsc)||this;var L=new Uint8Array([0]),N=new Uint8Array([0,0,0]),S=new Uint8Array([0,0,0,0]);l.setData(L,N,S);return l};$jscomp.inherits(ia,v);var g=function(){var l=v.call(this,f.stsz)||this;var L=new Uint8Array([0]),N=new Uint8Array([0,0,0]),S=new Uint8Array([0,0,0,0]),ba=new Uint8Array([0,0,0,0]);l.setData(L,N,S,ba);return l};$jscomp.inherits(g,v);var h=function(){var l=v.call(this,f.stco)||this;var L=new Uint8Array([0]),N=new Uint8Array([0,
0,0]),S=new Uint8Array([0,0,0,0]);l.setData(L,N,S);return l};$jscomp.inherits(h,v);var k=function(l){var L=v.call(this,f.mvex)||this;l=new r(l);L.setData(l.data);return L};$jscomp.inherits(k,v);fa=function(l){l=v.call(this,f.mehd)||this;var L=new Uint8Array([0]),N=new Uint8Array([0,0,0]);l.setData(L,N,d);return l};$jscomp.inherits(fa,v);var r=function(l){var L=v.call(this,f.trex)||this;var N=new Uint8Array([0]),S=new Uint8Array([0,0,0]),ba=new Uint8Array(4);b(l.id,ba,0);l=new Uint8Array([0,0,0,1]);
var na=new Uint8Array([0,0,0,0]),Ba=new Uint8Array([0,0,0,0]),za=new Uint8Array([0,0,0,0]);L.setData(N,S,ba,l,na,Ba,za);return L};$jscomp.inherits(r,v);var x=function(l){var L=v.call(this,f.moof)||this;B.setSequenceNumber(l.sequenceNumber);l=new I(l);L.setData(B.data,l.data);return L};$jscomp.inherits(x,v);fa=function(l){var L=v.call(this,f.mfhd)||this;var N=new Uint8Array([0]),S=new Uint8Array([0,0,0]),ba=new Uint8Array(4);b(l,ba,0);L.setData(N,S,ba);return L};$jscomp.inherits(fa,v);fa.prototype.setSequenceNumber=
function(l){b(l,this.data,12)};var B=new fa(1),I=function(l){var L=v.call(this,f.traf)||this;D.setTrackId(l.id);D.setSampleDuration(l.frameDuration);G.setBaseMediaDecodeTime(l.samples[0].timestamp);var N=32+D.data.length+G.data.length;if(l.isAudio)l=new R(l,null,N);else{for(var S=[],ba=0;ba<l.samples.length;ba++){var na=l.samples[ba];S.push({size:na.unitsLength+4*na.units.length,duration:l.frameDuration||3E3,compositionTimeOffset:0,flags:{isLeading:0,dependsOn:na.hasIDR?2:1,isDependedOn:0,hasRedundancy:0,
isNonSync:na.hasIDR?0:1,degradationPriority:0}})}l=new R(l,S,N)}L.setData(D.data,G.data,l.data);return L};$jscomp.inherits(I,v);fa=function(l,L){var N=v.call(this,f.tfhd)||this;N.isAudio=L;var S=new Uint8Array([0]),ba=L?new Uint8Array([2,0,10]):new Uint8Array([2,0,40]),na=new Uint8Array(4);b(l,na,0);L?(l=new Uint8Array([0,0,0,1]),L=new Uint8Array(4),b(1024,L,0),N.setData(S,ba,na,l,L)):(l=new Uint8Array([0,0,2,0,1,1,0,0]),N.setData(S,ba,na,l));return N};$jscomp.inherits(fa,v);fa.prototype.setTrackId=
function(l){b(l,this.data,12)};fa.prototype.setSampleDuration=function(l){this.isAudio||b(l,this.data,16)};var D=new fa(0,a);fa=function(l){var L=v.call(this,f.tfdt)||this;var N=new Uint8Array([0]),S=new Uint8Array([0,0,0]),ba=new Uint8Array(4);b(l,ba,0);L.setData(N,S,ba);return L};$jscomp.inherits(fa,v);fa.prototype.setBaseMediaDecodeTime=function(l){b(l,this.data,12)};var G=new fa(0),R=function(l,L,N){var S=v.call(this,f.trun)||this;var ba=new Uint8Array([0]),na=l.isAudio?new Uint8Array([0,2,1]):
new Uint8Array([0,15,1]),Ba=l.isAudio?4:16;N+=Ba*(l.isAudio?l.samples.length:L.length)+28;var za=new Uint8Array(4);l.isAudio?b(l.samples.length,za,0):b(L.length,za,0);var La=new Uint8Array(4);b(N,La,0);if(l.isAudio){N=new Uint8Array(Ba*l.samples.length);for(var Ga=0;Ga<l.samples.length;Ga++)b(l.samples[Ga].aacData.byteLength,N,Ba*Ga)}else for(N=new Uint8Array(Ba*L.length),Ga=0;Ga<L.length;Ga++){l=L[Ga];var Ca=Ba*Ga;b(l.duration,N,Ca);b(l.size,N,Ca+4);var Sa=l.flags,va=new Uint8Array(4);va[0]=Sa.isLeading<<
2|Sa.dependsOn;va[1]=Sa.isDependedOn<<6|Sa.hasRedundancy<<4|0|Sa.isNonSync;va[2]=Sa.degradationPriority&61440;va[3]=Sa.degradationPriority&15;N.set(va,Ca+8);b(l.compositionTimeOffset,N,Ca+12)}S.setData(ba,na,za,La,N);return S};$jscomp.inherits(R,v);fa=function(l){var L=v.call(this,f.sdtp)||this;for(var N=new Uint8Array([0]),S=new Uint8Array([0,0,0]),ba=new Uint8Array(l.length),na=0;na<l.length;na++){var Ba=l[na].flags;ba[na]=Ba.isLeading<<6|Ba.dependsOn<<4|S.isDependedOn<<2|S.hasRedundancy}L.setData(N,
S,ba);return L};$jscomp.inherits(fa,v);var M=function(l){var L=v.call(this,f.mdat)||this;if(l.isAudio){for(var N=new Uint8Array(l.totalByteLength),S=0,ba=0;ba<l.samples.length;ba++){var na=l.samples[ba].aacData;N.set(na,S);S+=na.byteLength}L.setData(N)}else{N=new Uint8Array(4*l.unitNum+l.totalByteLength);for(ba=S=0;ba<l.samples.length;ba++){na=l.samples[ba];for(var Ba=0;Ba<na.units.length;Ba++){var za=na.units[Ba],La=za.data.byteLength;b(La,N,S);S+=4;N.set(za.data,S);S+=La}}L.setData(N)}return L};
$jscomp.inherits(M,v)}function pc(a){function b(C,E){this.aacData=C;this.timestamp=E}function c(C,E,u,v){this.audioType=C;this.frequencyIdx=E;this.sampleRate=u;this.channelConfig=v}var e=pc.SAMPLING_FREQUENCY,d=null,f=!0,m=this,H=0;this.reset=function(){H=0;d=null;y.audioHeader=null;a&&a.reset()};var y=new function(){this.samples=[];this.duration=0;this.audioHeader=null;this.height=this.width=0;this.bufferSizeDB=1536;this.totalByteLength=this.bitRate=0;this.clear=function(){this.samples=[];this.totalByteLength=
this.bitRate=this.duration=0}};this.setMediaFormat=function(C,E){var u=C.frequencyIdx;u||(u=e.indexOf(C.sampleRate));-1==u&&console.error("Invalid AAC sampel rate: "+C.sampleRate);d=new c(C.audioType||2,u,C.sampleRate,C.channels||C.channelConfig);y.audioHeader=d;f=!E;if(m.oncodec)m.oncodec("mp4a.40.2",d)};this.parseAACData=this.parse=function(C){if(f){var E=m.readADTSHeader(C);C=C.subarray(E)}E=new b(C,H);H+=1024;y.samples.push(E);y.totalByteLength+=C.byteLength;C=1/(d.sampleRate/1024);y.duration=
C;y.samples[0]&&(y.bitRate=8*y.samples[0].aacData.length/C|0);a&&a.remux(y);y.clear()};this.readADTSHeader=function(C){var E=C[1]&0?9:7,u=(C[2]>>6&3)+1,v=C[2]>>2&15,Q=e[v];Q||console.error("Invalid Sampling Frequency Index: "+v);var q=((C[2]&1)<<2)+(C[3]>>6&3),z=C[1]>>1&3;0!=z&&console.error("Invalid data format: layer is not 0x00: "+z.toString(16));C.length!=((C[3]&3)<<11)+(C[4]<<3)+(C[5]>>5&7)&&console.error("No enough data in one ADTS frame, length= "+C.length);if(d){if(v!=d.frequencyIdx&&(d.frequencyIdx=
v,d.sampleRate=Q,m.oncodec))m.oncodec("mp4a.40.2",d)}else if(d=new c(u,v,Q,q),y.audioHeader=d,m.oncodec)m.oncodec("mp4a.40.2",d);return E}}function Tc(a){function b(){0==H&&console.error("no data available");var E=0,u=m-H;for(y=0;u<m;){var v=a[u];if(3!=v||0!=a[u-1]||0!=a[u-2])y=y<<8|v,E++;u++;if(4<=E)break}4>E&&(y<<=4-E);C=8*E;H=m-u}function c(E){if(!(C>E)){E-=C;var u=E>>3;E-=u>>3;H-=u;b()}y<<=E;C-=E}function e(E){var u=Math.min(C,E),v=y>>>32-u;32<E&&logger.error("Read more than 32 bits:"+E);C-=u;
0<C?y<<=u:0<H&&b();u=E-u;return 0<u?v<<u|e(u):v}function d(){var E;for(E=0;E<C;++E)if(0!==(y&2147483648>>>E))return y<<=E,C-=E,E;b();return E+d()}function f(){c(1+d())}var m=a.byteLength,H=m,y=0,C=0;this.readUEG=function(){var E=d();return e(E+1)-1};this.readEG=function(){var E=this.readUEG();return 1&E?1+E>>>1:-1*(E>>>1)};this.readBool=function(){return 1===e(1)};this.readU8=function(){return e(8)};this.readU16=function(){return e(16)};this.readU32=function(){return e(32)};this.skipScalingList=function(E){var u=
8,v=8,Q;for(Q=0;Q<E;Q++)0!==v&&(v=this.readEG(),v=(u+v+256)%256),u=0===v?u:v};this.readSPS=function(){var E=0,u=0,v=0,Q=0,q=1,z,A=0,t=!0;var F=this.readU8();7!=(F&31)&&console.error("Invalid SPS type: "+F);F=this.readU8();e(5);c(3);this.readU8();f();if(100===F||110===F||122===F||244===F||44===F||83===F||86===F||118===F||128===F||138===F||139===F||134===F||135===F){var T=this.readUEG();3===T&&c(1);f();f();c(1);if(this.readBool()){var w=3!==T?8:12;for(z=0;z<w;z++)this.readBool()&&(6>z?this.skipScalingList(16):
this.skipScalingList(64))}}f();z=this.readUEG();if(0===z)this.readUEG();else if(1===z)for(c(1),c(1+d()),c(1+d()),w=this.readUEG(),z=0;z<w;z++)c(1+d());f();c(1);var K=this.readUEG();z=this.readUEG();w=e(1);0===w&&c(1);c(1);this.readBool()&&(E=this.readUEG(),u=this.readUEG(),v=this.readUEG(),Q=this.readUEG());if(this.readBool()){if(this.readBool()){switch(this.readU8()){case 1:var O=[1,1];break;case 2:O=[12,11];break;case 3:O=[10,11];break;case 4:O=[16,11];break;case 5:O=[40,33];break;case 6:O=[24,
11];break;case 7:O=[20,11];break;case 8:O=[32,11];break;case 9:O=[80,33];break;case 10:O=[18,11];break;case 11:O=[15,11];break;case 12:O=[64,33];break;case 13:O=[160,99];break;case 14:O=[4,3];break;case 15:O=[3,2];break;case 16:O=[2,1];break;case 255:O=[this.readU8()<<8|this.readU8(),this.readU8()<<8|this.readU8()]}O&&(q=O[0]/O[1])}this.readBool()&&c(1);this.readBool()&&(c(4),this.readBool()&&c(24));this.readBool()&&(f(),f());this.readBool()&&(A=this.readU32(),O=this.readU32(),t=this.readBool(),A=
O/(2*A))}q=Math.ceil((16*(K+1)-2*E-2*u)*q);O=(2-w)*(z+1)*16-(w?2:4)*(v+Q);z="avc1."+(0==a[1]?"00":a[1].toString(16));z+=0==a[2]?"00":a[2].toString(16);z+=0==a[3]?"00":a[3].toString(16);return{width:q,height:O,profileIdc:F,chromaFormatIdc:T,frameCropLeftOffset:E,frameCropRightOffset:u,frameCropTopOffset:v,frameCropBottomOffset:Q,fps:A,fixedFrameRate:t,codec:z}};this.readSliceType=function(){this.readU8();this.readUEG();return this.readUEG()}}function Ld(a){function b(){this.height=this.width=0;this.codec=
"";this.pps=this.sps=null;this.frameDuration=3E3;this.samples=[];this.sequence=this.unitNum=this.totalByteLength=0;this.clear=function(){this.unitNum=this.totalByteLength=this.samples.length=0}}function c(){this.units=H;this.unitsLength=y;this.timestamp=d;this.hasIDR=f}function e(){var v=!1;if(m&&E.sps){var Q=new c;d+=E.frameDuration||3E3;E.samples.push(Q);E.totalByteLength+=y;E.unitNum+=H.length;E.sequence++;v=!0;if(Q.hasIDR&&u.onkeyframe)u.onkeyframe(Q)}m=f=!1;H=[];y=0;return v}var d=0,f=!1,m=!1,
H=[],y=0,C=Lb.searchStartCode,E=null,u=this;E=new b;this.reset=function(){d=0;f=!1;H=[];y=0;E=new b;a&&a.reset()};this.close=function(){u&&(u.reset(),u=null)};this.parseH264Data=this.parse=function(v){for(var Q=[],q=0,z,A,t,F=[0,0];q<v.byteLength;){F[0]=q;C(v,F);var T=F[0];if(-1==T)break;q=F[1];q=T+q;t=v[q];t&=31;z&&(z={type:A,data:v.subarray(z,T)},Q.push(z));z=q;A=t}z&&(z={type:A,data:v.subarray(z,v.byteLength)},Q.push(z));for(v=0;v<Q.length;v++)switch(F=Q[v],q=F.type,q){case 1:case 2:case 3:case 4:H.push(F);
y+=F.data.byteLength;m=!0;break;case 5:m=f=!0;H.push(F);y+=F.data.byteLength;break;case 6:break;case 7:z=F.data;q="avc1."+(0==z[1]?"00":z[1].toString(16));q+=0==z[2]?"00":z[2].toString(16);q+=0==z[3]?"00":z[3].toString(16);z=new Tc(F.data);z=z.readSPS();E.width=z.width;E.height=z.height;E.codec=q;E.sps=F.data;z.fps&&(E.frameDuration=9E4/z.fps|0);H.push(F);y+=F.data.byteLength;if(u.oncodec)u.oncodec(q,z);break;case 8:E.pps=F.data;H.push(F);y+=F.data.byteLength;break;case 9:e();break;default:console.log("Ignore NAL unit with type = "+
q)}e()&&E.sps&&(a.remux(E),E.clear())}}function Mb(a,b,c){function e(){for(;y;){if(A.updating){y=!1;break}var T=H.shift();if(!T)break;try{A.appendBuffer(T),C=0}catch(w){H.unshift(T);if("QuotaExceededError"==w.name)if(m(!0))continue;else{if(E.onerror)E.onerror(w);else console.log("QuotaExceededError: not recoverable, isAudio: "+c),E.close();break}C++;console.error("Failed to append buffer, retry "+C,w);if(2<C){if(E.onerror)E.onerror(w);break}}}}function d(){y=!0;e()}function f(){A=z.addSourceBuffer(u);
A.mode="sequence";A.addEventListener("updateend",d);A.addEventListener("error",function(T){console.error(T)});y=!0;E.play(!1);e()}function m(T){var w=Math.min(a.played.end(0),A.buffered.end(0)),K=0,O=q.length,U=!1,W=0;if(c)W=w-180,0>W&&console.warn("Not possible, time played secs: "+w);else if(1<O){var Y=O-2;for(w=9E4*w|0;K<O;){if(q[K]>w){Y=K-2;break}K++}0<=Y&&(W=(q[Y]+1E3)/9E4)}if(0<W)try{A.remove(0,W),q.splice(0,Y+1),U=!0,console.info("Buffer removed "+W+" isAudio: "+c)}catch(ja){console.warn("Buffer removal "+
W+" failed, retry, isAudio: "+c)}T||(Q=setTimeout(m,18E4));return U}var H=[],y=!1,C=0,E=this,u="",v=null,Q=0,q=[],z=null,A=null,t=null,F=null;a.autoplay=!0;this.getKeyFrames=function(){return q};t=new Lb(c);t.ondata=function(T){H.push(T);e()};F=c?new pc(t):new Ld(t);F.onkeyframe=function(T){q.push(T.timestamp)};F.oncodec=function(T,w){var K=c?"audio/mp4;codecs=":"video/mp4;codecs=";K+=T;if(K!=u||(c?v.sampleRate!=w.sampleRate:v.width!=w.width||v.height!=w.height))if(u=K,v=w,y=!1,A=null,z=new MediaSource,
z.addEventListener("sourceopen",f),a.src=URL.createObjectURL(z),E.onsps)E.onsps(w)};b.onvideoframe=function(T){F.parse(T)};b.onaudioframe=function(T){F.parse(T)};b.onendofstream=function(){E.reset()};this.play=function(T){a.play().catch(function(w){if(!T&&(console.error(w),E.onplayerror))E.onplayerror(w)})};this.reset=function(){console.log("Reset player");Q&&(clearTimeout(Q),Q=0);q.length=0;y=!1;u="";v=null;F&&F.reset();H.length=0};this.close=function(){E&&(E.reset(),z&&(z.endOfStream(),a.src=null),
F&&F.close(),t&&t.close(),E=null)};this.setMediaFormat=function(T,w){F.setMediaFormat&&F.setMediaFormat(T,w)};this.getMediaSource=function(){return z};this.getMediaSourceBuffer=function(){return A};a.addEventListener("ended",function(T){console.warn(".... ended");Q&&(clearTimeout(Q),Q=0)});a.addEventListener("emptied",function(T){y=!!A});a.addEventListener("pause",function(T){console.warn(".... paused");y=!!A;var w=a.currentTime;a.play().then(function(){console.warn("... played: "+a.currentTime+" t: "+
w)}).catch(function(K){console.error(K)})});a.addEventListener("waiting",function(T){y=!!A})}function Md(a,b){function c(E){var u=E.codec;if(u!=e||(b?m.sampleRate!=E.sampleRate:m.width!=E.width||m.height!=E.height))if(e=u,m=E,f||(f=new VideoDecoder({output:function(v){var Q=H.length;if(Q){for(var q=v.timestamp;Q&&H[0]<q;)H.shift(),Q--;if(Q&&H[0]==q){H.shift();v.close();return}}d.onframedecoded&&d.onframedecoded(v);v.close()},error:function(v){console.error("Decoder error:",v)}})),f.configure({codec:e,
codedWidth:E.width,codedHeight:E.height,hardwareAcceleration:"no-preference"}),d.onsps)d.onsps(E)}var e=null,d=this,f,m=null,H=[],y={type:"delta",data:null,timestamp:0},C=0;a.onvideoframe=function(E,u){var v;var Q=0;var q=[0,0],z=E.length,A=!1;for(v=null;Q<z;){q[0]=Q;Lb.searchStartCode(E,q);var t=q[0];if(-1==t)break;t+=q[1];Q=t+1;var F=E[t]&31;switch(F){case 1:case 2:case 3:case 4:break;case 5:A=!0;break;case 6:break;case 7:v=(new Tc(E.subarray(t))).readSPS();break;case 8:break;case 9:break;default:console.log("nal type:"+
F)}}Q=A;v&&c(v);m&&(y.type=Q?"key":"delta",y.data=E,y.timestamp=C,u&&H.push(C),C+=10,E=new EncodedVideoChunk(y),f.decode(E))};this.play=function(E){};this.reset=function(){console.log("Reset MediaDecoder");m=e=null;C=0;H.length=0;f&&f.reset()&&f.close();f=null};this.close=function(){d.reset();f&&(f.close(),f=null)}}this.displayMsg=this.reconnectOnResize=!0;this.appTimeout=1600;this.reconnectTimes=0;this.windowState=3;this.setTitle=this.openLink=!0;this.sessionInfo={domain:"",userName:"",sessionId:0,
joinedSessions:[],suppressOutput:!1,appInfo:null,joiners:[]};this.mode=0;this.remoteAppLogin=!0;var Kb=!1,kb={},ib={},Ab=null,p=this,lc=!1,Xa=!1,cb=0,Bb=null,Uc=0;hi5.appcfg||(hi5.appcfg={img:{},toolbar:{fadable:!0},displayMsg:!0});var ea=hi5.appcfg,Ib="";this.setConfig=function(a){ea=a};var bb="object"==typeof n?n:null,P=bb?{}:hi5.tool.queryToObj(n.substring(n.indexOf("?")+1));void 0==P.mapClipboard&&ea.clipboard&&void 0!=ea.clipboard.enabled&&(P.mapClipboard=ea.clipboard.enabled);void 0==ea.enableDVCAudio&&
(ea.enableDVCAudio=!0);var Ia=0,Ja=0,fb=(ha||P.color||P.server_bpp||16)|0,nc=null,Vc=null,Pa=null,Hb=null,Wc="/DOWNLOAD?",Xc="/CLIP?";24==fb&&(fb=16);var Wa="app"==P.startProgram,Jb=V(P.mapDisk),lb=0;this.setLinks=function(a){a.download&&(Wc=a.download);a.clipboard&&(Xc=a.clipboard)};this.protocol=bb?"":n.substring(0,n.indexOf("://")).toLowerCase();this.hasSmartCard=function(){return V(P.smartCard)||V(P.mapSmartCard)||V(P.passwordIsPin)};this.enableWebAuthn=function(){return V(P.enableWebAuthn)||
V(P.useWebAuthn)};this.hasScanner=function(){return V(P.scanner)};this.hasUSB=function(){return V(P.mapUSB)&&!!navigator.usb};this.getUSB=function(){return P.usb||hi5.appcfg.usb||{filters:[{classCode:0},{classCode:2},{classCode:5},{classCode:6},{classCode:10},{classCode:13},{classCode:239},{classCode:220},{classCode:239},{classCode:254},{classCode:255}]}};this.setProfiler=function(a){Vc=a};this.getProfiler=function(){return Vc};this.gateway=function(){if(bb)return"";var a=n.lastIndexOf("/RDP?");-1==
a&&(a=n.lastIndexOf("/JOIN?"));-1==a&&(a=n.lastIndexOf("/PLAY?"));return n.substring(0,a).replace(/wss:\/\//ig,"https://").replace(/ws:\/\//ig,"http://")}();svGlobal.logger.warn("Ver:"+svGlobal.version+" build:"+svGlobal.build);this.getGatewayAddr=ta;var jb="object"==typeof n||0<n.indexOf("/PLAY?"),qc=!jb&&0<n.indexOf("invitation=");if(qc){var rc=decodeURIComponent(n),Nb=rc.indexOf(' USERNAME="');if(0<Nb){Nb+=11;var Nd=rc.substring(Nb,rc.indexOf('"',Nb));n+="&novice="+Nd}n+="&mapClipboard=on";P.mapClipboard=
"on";this.reconnectOnResize=!1}if(jb)this.mode=1,bb?n="":(Ia=640,Ja=480),n+="&touchpad=on",P.touchpad="on",this.reconnectOnResize=!1;else if(0<n.indexOf("/JOIN?")||qc)this.mode=2,this.reconnectOnResize=!1;var sc=V(P.gfx)||V(P.remotefx)||0<p.mode;sc&&(Wa||qc?(sc=!1,P.remotefx=!1):fb=32);J?Ia=parseInt(J):P.width&&(Ia=parseInt(P.width));X?Ja=parseInt(X):P.height&&(Ja=parseInt(P.height));-1==Ia&&(Ia=hi5.browser.getScreenWidth());-1==Ja&&(Ja=hi5.browser.getScreenHeight());P.symlink&&P.parameters&&hi5.tool.queryToObj(P.parameters,
P);P.gateway||(n+="&gateway="+encodeURIComponent(p.gateway));!P.minWidth&&ea.minWidth&&(P.minWidth=ea.minWidth);!P.minHeight&&ea.minHeight&&(P.minHeight=ea.minHeight);P.minWidth&&(P.minWidth=parseInt(P.minWidth));P.minHeight&&(P.minHeight=parseInt(P.minHeight));P.waWidth=P.waWidth?parseInt(P.waWidth):hi5.browser.isAndroid||hi5.browser.isiOS?Math.max(screen.width,screen.height):screen.width;P.waWidth&=-4;P.waHeight=P.waHeight?parseInt(P.waHeight):hi5.browser.isAndroid||hi5.browser.isiOS?Math.max(screen.width,
screen.height):screen.height;P.waHeight&=-4;"useSSL"in P||(n+="&useSSL="+("wss"==p.protocol));hi5.storage.isAvailable&&(V(P.shareClipboard)||P.shareClipboardId)&&(n+="&shareClipboardId="+(P.shareClipboardId||Z()));ea&&(void 0!=ea.displayMsg?this.displayMsg=ea.displayMsg:ea.displayMsg=this.displayMsg,ea.appTimeout&&(this.appTimeout=ea.appTimeout),void 0!=ea.reconnectOnResize&&(this.reconnectOnResize=ea.reconnectOnResize),ea.reconnectTimes&&(this.reconnectTimes=ea.reconnectTimes),void 0!=ea.windowState&&
(this.windowState=ea.windowState),void 0!=ea.openLink&&(this.openLink=ea.openLink),void 0!=ea.setTitle&&(this.setTitle=ea.setTitle),"boolean"==typeof ea.useWSS&&(n=(ea.useWSS?"wss":"ws")+n.substring(n.indexOf("://"))),"boolean"==typeof ea.remoteAppLogin&&(this.remoteAppLogin=ea.remoteAppLogin,Kb=!ea.remoteAppLogin,svGlobal.logger.warn("remoteAppLogin deprecated, use hideLogin in appcfg.js instead")),"boolean"==typeof ea.hideLogin&&(Kb=ea.hideLogin),void 0!=ea.localPrinter&&void 0==P.localPrinter&&
(P.localPrinter=ea.localPrinter));var Ma=null;void 0==ea.useWorker&&(ea.useWorker=!1);ea.useWorker&&(!window.Worker||hi5.browser.isFirefox||Wa&&!hi5.browser.isIE||"file:"==location.protocol||0<navigator.userAgent.indexOf("MSIE 10."))&&(ea.useWorker=!1);void 0==hi5.libMin&&(hi5.libMin=!0);var Ka=ea.useWorker?new Worker(ra("rdpworker",hi5.libMin?"rdpworker_min.js":"rdpworker.js")):null,tb=this.reconnectTimes,$b=Ka?{type:5,data:null}:null;this.getDisplayName=aa;this.server=aa();this.port=parseInt(P.port,
10);this.loadbalanceToken="";ea.loadbalanceTokenName&&(P[ea.loadbalanceTokenName]?da(P[ea.loadbalanceTokenName]):!1!==ea.randomAppId?da(hi5.tool.uuid()):svGlobal.logger.info("Using app.id as loadbalanceToken"));this.modifyURL=function(a){p.loadbalanceToken&&(a+=-1==a.indexOf("?")?"?"+p.loadbalanceToken:"&"+p.loadbalanceToken,a+="&loadbalanceTokenName="+ea.loadbalanceTokenName);return a};this.getURL=function(){return n};this.getRuntimeURL=function(){var a=n+"&width="+Ia+"&height="+Ja+"&server_bpp="+
fb+"&audio="+(Ta.available||hi5.browser.isIE),b=Dc(),c="";b&&(c=sessionStorage[b]||"")&&(c="&preSymJoin="+c);a+=c;var e=P.monitorDef,d=P.monitor,f=0;b=ca.size();var m=Array(b);c=Array(b);var H=0,y=0,C=0,E=0,u=0,v=0,Q="";if(e){c=qa.parseMonitorDef(e);for(b=c.length;f<b;f++){var q=c[f];q[0]<C&&(C=q[0]);q[1]<E&&(E=q[1]);q[2]>u&&(u=q[2]);q[3]>v&&(v=q[3])}0>C&&(H=-C);0>E&&(y=-E);q=0>d?[C,E,u,v]:c[d];P.width=q[2]-q[0]+1;P.height=q[3]-q[1]+1;f=ca.getSurface(0);f.setMonitor(q[0],q[1],q[2],q[3]);if(H||y)for(q=
f.getMousePosition(),q.left+=H,q.right+=H,q.top+=y,q.bottom+=y,f=0;f<b;f++)q=c[f],q[0]+=H,q[1]+=y,q[2]+=H,q[3]+=y;qa.setMonitorLayout(c);0>d&&qa.setMonitorCount(0);p.reconnectOnResize=!1;b="&monitorDef="+e+"&width="+P.width+"&height="+P.height}else{if(1<b&&!Wa){for(ca.verifyMonitors();f<b;f++)e=ca.getSurface(f),q=e.getMousePosition(),q.left<C&&(C=q.left),q.top<E&&(E=q.top),q.right>u&&(u=q.right),q.bottom>v&&(v=q.bottom),m[f]=q,Q&&(Q+=","),Q+=q.left+":"+q.top+":"+q.right+":"+q.bottom;0>C&&(H=-C);0>
E&&(y=-E);for(f=0;f<b;f++){q=ca.getSurface(f).getMousePosition();if(H||y)q.left+=H,q.right+=H,q.top+=y,q.bottom+=y;c[f]=[q.left,q.top,q.right,q.bottom,q.left==H&&q.top==y?1:0]}qa.setMonitorLayout(c);p.reconnectOnResize=!1}Q&&(svGlobal.logger.warn("MonitorDef:"+Q),P.width=u-C+1,P.height=v-E+1,Q="&monitorDef="+Q+"&width="+P.width+"&height="+P.height);b=Q}a+=b;0>n.indexOf("waWidth")&&(b=(b=ca.getFocused())?b.getWindow():window,a+="&waWidth="+P.waWidth+"&waHeight="+P.waHeight+"&dpWidth="+b.innerWidth+
"&dpHeight="+b.innerHeight);b=new Date;P.tzOffset||(a+="&tzOffset="+b.getTimezoneOffset());P.timezone||(c=hi5.timezone.getTimeZone())&&(a+="&timezone="+encodeURIComponent(c.standardName));a+="&time="+b.getTime();void 0==P.soundPref&&(P.soundPref=0,a+="&soundPref=0");H=c=b="";for(H in kb)y=kb[H],"flags"in y&&(b&&(b+=",",c+=","),b+=y.name,c+=y.flags);b&&(a=a+("&channelName="+b)+("&channelFlags="+c));b="";for(H in ib)y=ib[H],"flags"in y&&(b&&(b+=","),b+=y.name);b&&(a+="&gwChannelName="+b);if(c=sd())b=
c.account,c=c.session,b&&(a+="&account="+b),c&&(a+="&session="+c);b=hi5.browser.isTouch&&(1024<=window.innerWidth||768<=window.innerHeight);P.audioRecord=V(P.audioRecord)&&hi5.audio.recordable;Fa.init(b,sc,P.audioRecord,P.soundPref,V(P.mapCamera)&&!!navigator.mediaDevices,V(P.mapUSB)&&!!navigator.usb);P.audioRecord&&(a+="&audioRecord=on");P.decompressingRDP61&&(a+="&decompressingRDP61=on");0<Fa.count&&(a+="&dvcChannels="+Fa.names.join(","));a+="&binary=on";ea.existingFile&&(a+="&existingFile="+ea.existingFile);
a+="&isTouch="+b+"&gatewayAddr="+encodeURIComponent(ta());a=p.modifyURL(a);ea.copyTextOnly&&V(P.mapClipboard)&&(a+="&copyTextOnly=on");(b=hi5.browser.cookie.get("__SV_TOKEN_A"))&&(a+="&__SV_TOKEN_A="+encodeURIComponent(b));(b=svGlobal.Rdp.languageToKeyboard.detect())&&(a+="&_keyboard="+b);V(P.textPrinter)&&(a+="&printerDriver="+encodeURIComponent("Generic / Text Only"));return a+=Bd()};this.getColor=function(){return fb};this.changeTitle=la;hi5.browser.isTouch&&Math.max(Ia,Ja)>Math.max(window.innerWidth,
window.innerHeight)&&(this.reconnectOnResize=!1);this.isRemoteApp=function(){return Wa};var Da=null,Ha=!1,ob=!1,oc=!1,Ta=new function(){function a(y){c&&(d&&d.disconnect(),f&&f.disconnect());hi5.audio.releaseAudioContext();y||(H&&(H.close(),H=null),m&&(m.pause(),m=null))}function b(y){console.error("play error: ",y)}var c=null;this.supportWebAudio=this.available=!1;(0==P.playSound||0<p.mode)&&(c=hi5.audio.getAudioContext())&&hi5.audio.playable&&(this.supportWebAudio=this.available=!0);this.getContext=
function(){return c};this.getBuffer=function(y){return c.createBuffer(2,y,Ea.samplePerSec)};var e=0,d=null,f=null;this.setVolume=function(y){1==y?d=null:(d||(d=c.createGain()),d.gain.value=y)};this.playBuffer=function(y){f=c.createBufferSource();f.buffer=y;d?(f.connect(d),d.connect(c.destination)):f.connect(c.destination);var C=c.currentTime,E=0<e?e:C;E<C&&(E=C);e=E+y.duration;f.start?f.start(E):f.noteOn(E);return e-C};this.iOSFix=function(){if(c){var y=this.getBuffer(1024),C=c.createBufferSource();
C.buffer=y;C.connect(c.destination);C.start?C.start(0):C.noteOn(0)}};this.close=a;var m=null,H=null;this.onaudioframe=null;this.initMediaPlayer=function(y,C,E){a(!0);m||(m=document.createElement("audio"));H||(H=new Mb(m,y,!0),H.onplayerror=b,H.onerror=function(u){console.error("Not possible audio error",u)},svGlobal.logger.info("MediaPlayer init, headerless: "+E+" sampleRate:"+C.sampleRate));H.setMediaFormat(C,E);H.play(!1)}},Id=Ta.available,qa=new xc(200,200);qa.onSetCursor=Ic;this.setVolume=function(a){Ta&&
Ta.setVolume(a)};this.setAudioBuffer=function(a){};var Xb=0,Wb=0,Yb=Ia-1,Zb=Ja-1,mc="";window.$rdp||(window.$rdp=this);Aa(fb);this.setResolution=Oa;this.running=function(){return Ha};this.setJoinMode=function(a){Ha&&sa("8E1"+a)};this.setJoinCloseMode=function(a){Ha&&sa("8EB3\t"+a)};this.refuseControl=function(a){Ha&&sa("8E3"+a)};this.giveControl=function(a){Ha&&sa("8E4"+a)};this.pauseSession=function(a,b){Ha&&sa("8EB"+(b?1:0)+"\t"+a)};this.closeSession=function(a){Ha&&sa("8EB2\t"+a)};this.requestControl=
function(){Ha&&sa("8E2")};this.saveSession=function(a){Ha&&sa("8E9"+(a.save?1:0)+"\t"+(a.timeout||0)+"\t"+(a.id||0))};this.allowJoin=function(a,b){Ha&&sa("8EA"+a+"\t"+(b?1:0))};var Cb=new function(){function a(){if(c&&0<c.length){var f=c.shift();f.key?Cb.sendSingleKey(f.down,f.key):f.char&&rb(f.char);0<c.length?setTimeout(a,e):(c=null,d&&d())}}var b={" ":57,space:57,pgup:201,pageup:201,pgdn:209,pagedown:209,end:207,home:199,left:203,up:200,right:205,down:208,printscreen:183,insert:210,del:211,"delete":211,
altgr:184,windows:219,windowsright:220,context:221,esc:1,backspace:14,back:14,tab:15,enter:28,meta:29,command:29,ctrl:29,shift:42,alt:56,capslock:58,f1:59,f2:60,f3:61,f4:62,f5:63,f6:64,f7:65,f8:66,f9:67,f10:68,f11:87,f12:88,numlock:69,scrolllock:70,add:78};this.sendSingleKey=function(f,m){var H=b[m.toLowerCase()];H?p.writeScancode(f,H):(H=m.length,0!=H&&(1==H?p.writeKeyCode(f,m.toUpperCase().charCodeAt(0)):f&&p.writeText(m)))};var c=null,e=0,d=null;this.sendKeyComb=function(f,m,H){if(Xa){f=f.split("+");
var y=f.length,C;if(0!=y){var E=null,u=[];for(C=0;C<y;C++){var v=f[C];""==v&&""==E&&(v="Add");""!=v&&u.push({key:v,down:!0});E=v}y=u.length;for(C=y-1;0<=C;C--)u.push({key:u[C].key,down:!1});if(m)c=u,e=m,d=H,a();else for(C=0,y=u.length;C<y;C++)Cb.sendSingleKey(u[C].down,u[C].key)}}};this.sendText=function(f,m,H){for(var y=[],C=0,E=f.length;C<E;C++)y.push({"char":f.charAt(C)});c=y;e=m;d=H;a()}};this.writeKeyComb=function(a,b,c){Xa&&Cb.sendKeyComb(a,b,c)};this.writeText=function(a,b,c){if(Xa)if(b)Cb.sendText(a,
b,c);else for(b=0,c=a.length;b<c;b++)rb(a.charAt(b))};this.writeClipboard=function(a,b){a&&(b||(b="text/plain"),p.writeRawInput("880"+b+"\t"+a.hashCode()),Bb={type:b,text:a})};var ca=new function(a,b){function c(){function d(u){for(;0<u.ownerWinid;){var v=C.getWinById(u.ownerWinid);if(v&&v.isVisible())u=v;else break}return u}function f(u){for(var v="";u;)u.titleInfo&&(v=u.titleInfo),u=C.getWinById(u.ownerWinid);return v}var m=[],H=[],y=0,C=this;this.mainWin=null;this.appId="";var E=0;this.getActiveWinId=
function(){return E};this.setActiveWinId=function(u,v){svGlobal.logger.info("setActiveWinId: "+u+" old: "+E+" max: "+v);if(E!=u){var Q=0==E;E=u;(u=C.getMainByWinId(u))&&u.isMainWin()&&C.mainWin!=u&&(C.mainWin=u);Q&&v&&(v=ca.getFocused())&&(v=v.getFreeSpace(),u=v.width,p.resetSize(u,v.height))}};this.onchange=function(u){u.isVisible()||u!=C.mainWin?u.isVisible()&&!C.mainWin&&u.isMainWin()&&(C.mainWin=u,3==a.windowState&&u.exeCommand(61488)):C.mainWin=null};this.addWin=function(u){for(var v=m.length,
Q=!1,q=0;q<v;q++)if(u.id==m[q].id){m[q]=u;Q=!0;break}Q||m.push(u);1==m.length&&(y=Date.now());v=u.isMainWin();svGlobal.logger.info("is mainwin:"+v+" id:"+u.id);v&&!C.mainWin&&(C.mainWin=u)};this.popWins=function(u){u=C.getWinById(u);var v=[];if(u){u=0<u.ownerWinid?u.ownerWinid:u.id;for(var Q=m.length-1;0<=Q;Q--)if(m[Q].ownerWinid==u||m[Q].id==u)v.push(m[Q]),m.splice(Q,1)}return v};this.hasApp=function(u){return-1!=H.indexOf(u)};this.addApp=function(u){return-1==H.indexOf(u)?(H.push(u),!0):!1};this.isNew=
function(){return 3E4>Date.now()-y};this.getAll=function(){return m};this.hasWin=function(u){return 0<=m.indexOf(u)};this.close=function(){for(var u=0,v=m.length;u<v;u++)m[u].close()};this.clear=function(){m.length=0};this.delWin=function(u){for(var v=0,Q=m.length;v<Q;v++)if(m[v].id==u)return m.splice(v,1),v;return-1};this.isRunning=function(){var u=m.length;if(1>u)return!1;var v=0;for(u=m.length;v<u;v++){var Q=m[v];if(Q.showState)return!0}return!1};this.getWinById=function(u){var v=m.length;if(1>
v)return null;for(var Q=0;Q<v;Q++){var q=m[Q];if(q.id==u)return q}return null};this.getMainWinByAppId=function(u){var v=null,Q=0;for(len=m.length;Q<len;){v=m[Q];if(v.appId==u&&v.isVisible()&&1>v.ownerWinid)break;Q++}return v};this.getTopWin=function(u){var v=null,Q,q=u.length;for(Q=0;Q<q&&(!(v=C.getWinById(u[Q]))||!v.isVisible());Q++)v=null;if(!v)for(svGlobal.logger.warn("No win found"),q=m.length,Q=q-1;0<=Q&&(v=m[Q],!v.isVisible());Q--)v=null;return v};this.getMain=function(u){return(u=C.getTopWin(u))?
d(u):null};this.getMainByWinId=function(u){return(u=C.getWinById(u))?d(u):null};this.getOtherApps=function(u,v,Q){var q=m.length;if(0!=q&&m[q-1])if(q=m[q-1].appId,Q||!q)setTimeout(function(){C.getOtherApps(u,v)},Q||3E3);else{Q=[];if(q=C.getTopWin(u)){var z=0<q.ownerWinid?q.ownerWinid:q.id,A=[],t=0;for(q=m.length;t<q;t++)m[t].ownerWinid!=z&&m[t].id!=z&&m[t].isVisible()&&A.push(m[t]);t=0;for(q=A.length;t<q;t++)A[t].ownerWinid!=z&&A[t].id!=z&&(Q.push({title:f(A[t]),win:d(A[t])}),z=0<A[t].ownerWinid?
A[t].ownerWinid:A[t].id)}v(Q)}};this.getFullTitle=function(u){for(var v,Q="";;){v=C.getWinById(u);if(!v)break;v.titleInfo&&v.isVisible()&&(Q&&(Q=" > "+Q),Q=v.titleInfo+Q);if(1>u)break;u=v.ownerWinid}return Q}}var e=[];this.tryCloseRemoteApps=function(){if(a&&a.isRemoteApp())for(var d=e.length,f=0;f<d;f++)e[f].railWin&&e[f].railWin.close()};this.verifyMonitors=function(){for(var d=e.length,f=Array(d),m=0;m<d;m++)e[m].configMonitor(),f[m]=e[m].getMousePosition();f.sort(function(C,E){var u=C.left-E.left;
return 0!=u?u:C.top-E.top});var H=f.findIndex(function(C){return 0==C.left&&0==C.top});svGlobal.logger.info("monitor layout",f,H);-1==H&&(p.showMessage("* Primary monitor not found. Please make your browser window full screen."),svGlobal.logger.warn("Primary monitor not found (left=top=0)",f));for(m=H-1;0<=m;){if(f[m].right<f[m+1].left){var y=f[m+1].left-f[m].right-1;0<y&&(f[m].right+=y,f[m].left+=y)}f[m].bottom<f[m+1].top&&(y=f[m+1].top-f[m].bottom-1,0<y&&(f[m].top+=y,f[m].bottom+=y));m--}for(m=
H+1;m<d;)f[m-1].right<f[m].left&&(y=f[m].left-f[m-1].right-1,0<y&&(f[m].right-=y,f[m].left-=y)),f[m-1].bottom<f[m].top&&(y=f[m].top-f[m-1].bottom-1,0<y&&(f[m].top-=y,f[m].bottom-=y)),m++};this.repaint=function(d,f,m,H){for(var y=0,C=e.length;y<C;y++)e[y].repaint(d,f,m,H)};this.size=function(){return e.length};this.getSurface=function(d){return e[d]};this.addSurface=function(d){e.push(d)};this.hasSurface=function(d){for(var f=e.length,m=0;m<f;m++)if(e[m].equals(d))return!0;return!1};this.getMonitorSurface=
function(d,f,m,H){var y=e.length;if(1==y)return e[0];for(var C=0;C<y;C++)if(e[C].isMonitor(d,f,m,H))return e[C];return null};this.fromSyncedSurface=function(d){var f=e.length;Date.now();for(var m=0;m<f;m++)if(e[m].isClipSynced(d))return!0;return!1};this.setSize=function(d,f,m){for(var H=0,y=e.length;H<y;H++)e[H].setSize(d,f,m)};this.zOrders=[];this.drawLicense=function(d){for(var f=0,m=e.length;f<m;f++)e[f].drawLicense(d)};this.setReadOnly=function(d,f){for(var m=0,H=e.length;m<H;m++)e[m].setReadOnly(d,
f)};this.setVisible=function(d,f){svGlobal.logger.info("TODO: setVisible")};this.setCursor=function(d){for(var f=0,m=e.length;f<m;f++)e[f]&&e[f].setCursor(d)};this.hide=function(d){d=0;for(var f=e.length;d<f;d++)e[d]&&e[d].hide()};this.execute=function(d,f){for(var m=0,H=e.length;m<H;m++)e[m][d].apply(e[m],f)};this.addWin=function(d){var f=this.getFocused();f||(svGlobal.logger.warn("Focused surface not found!"),f=e[e.length-1]);f?(Wa=!0,f.railWin||(f.railWin=new c,f.onunload=function(){hi5.appcfg.closeRemoteApp&&
f.railWin&&f.railWin.close();f.remoteApp&&f.remoteApp.close();f.railWin&&(f.railWin.clear(),f.railWin=null);e.removeElm(f)}),f.context&&b.setContext(f.context),f.railWin.addWin(d),f.railWin.mainWin==d&&(setTimeout(function(){var m=f.getFreeSpace();a.writeRawInput("8C661441\t"+m.width+"\t"+m.height);svGlobal.logger.info("-- main win dp change:"+m.height);3==a.windowState?d.resizable()&&setTimeout(function(){d.exeCommand(61488);svGlobal.logger.info("-- max")},50):5==a.windowState&&3==d.showState&&setTimeout(function(){d.exeCommand(3856);
svGlobal.logger.info("-- restor")},50)},111),Qa.sendKeyboardSyncFlags(Qa.localLockFlags,500)),hi5.browser.isIE&&f.focus()):svGlobal.logger.warn("No surface available!")};this.delWin=function(d){for(var f,m=e.length-1;0<=m;m--){var H=e[m];f=H.railWin;var y=f.getWinById(d),C=y&&y.appId&&-1!=y.appId.toLowerCase().indexOf("runonce");if(0<=f.delWin(d)){y==f.mainWin&&(f.mainWin=null);if(H.toolbar){d="win"+d;var E=H.toolbar.querySelector("#"+d);E&&H.toolbar.removeChild(E)}if(!f.isRunning()&&0==p.mode){if(y.isMainWin()&&
H.onremoteappclose)H.onremoteappclose(y);y=a.appTimeout;if(C||f.isNew())y*=10;svGlobal.logger.debug("Prepare del:"+Date.now());setTimeout(function(u){return function(){svGlobal.logger.info("Start del:"+Date.now());u.railWin&&u.railWin.isRunning()||(u.remoteApp&&u.remoteApp.close(),ca&&ca.delSurface(u))}}(H),y)}}}};this.popWins=function(d){return e[0]&&e[0].railWin?e[0].railWin.popWins(d):[]};this.getWinById=function(d){for(var f,m=0,H=e.length;m<H;m++)if(e[m]&&e[m].railWin&&(f=e[m].railWin.getWinById(d)))return f;
return null};this.getMainWinByAppId=function(d){for(var f,m=0,H=e.length;m<H;m++)if(e[m].railWin&&(f=e[m].railWin.getMainWinByAppId(d)))return f;return null};this.onWinChange=function(d){for(var f,m=0,H=e.length;m<H;m++)if(e[m].railWin&&(f=e[m].railWin.getWinById(d.id)))e[m].railWin.onchange(d)};this.setTitle=function(d){for(var f,m=0,H=e.length;m<H;m++)if(e[m].railWin){f=e[m].railWin.getWinById(d);var y=e[m].railWin.getFullTitle(d);if(y){a.changeTitle(y,e[m].getWindow(),f.appId);break}}};this.hasApp=
function(d){for(var f=0,m=e.length;f<m;f++)if(e[f].railWin.hasApp(d))return!0;return!1};this.delSurface=function(d){!d||d.railWin&&d.railWin.isRunning()||(svGlobal.logger.info("delete surface..."),e.removeElm(d),d.close(),0==e.length&&a._unload())};this.getOwnerSurface=function(d){for(var f=0,m=e.length;f<m;f++)if(e[f].railWin&&e[f].railWin.hasWin(d))return e[f];return null};this.getOwnerSurfaceById=function(d){for(var f,m=0,H=e.length;m<H;m++)if(e[m].railWin&&(f=e[m].railWin.getWinById(d)))return e[m];
return null};this.getFocused=function(){for(var d=e.length,f=0;f<d;f++)if(e[f].focused)return e[f];return e[d-1]};this.close=function(){for(var d=0,f=e.length;d<f;d++)e[d]&&(e[d].remoteApp&&e[d].remoteApp.close(),e[d].close(),e[d]=null)};this.LocalWin=function(d){function f(){a.writeRawInput("8C0"+d)}this.id=d;this.appId="";var m=this;this.resizable=function(){return m.isVisible?0!=(m.style&262144)||0!=(m.style&65536)||0!=(m.style&16777216)||3==m.showState:!1};this.setShowState=function(H){m.showState=
H};this.parent=function(){return ca.getWinById(m.ownerWinid)};this.resize=function(H,y,C,E){svGlobal.logger.info("www resize, l "+H+" w "+C);hi5.appcfg.disableJoinedAppResize&&2==a.mode||a.writeRawInput("8C1"+m.id+"\t"+H+"\t"+y+"\t"+C+"\t"+E)};this.exeCommand=function(H){svGlobal.logger.info("www exeCommand, cmd "+H);a.writeRawInput("8C4"+d+"\t"+H)};this.activate=function(H){svGlobal.logger.info("www activate, enable "+H+" id:"+d);2==m.showState?(m.exeCommand(61728),setTimeout(function(){a.writeRawInput("8C3"+
d+"\t"+H)},50)):a.writeRawInput("8C3"+d+"\t"+H)};this.close=function(){svGlobal.logger.info("www close");m.exeCommand(61536)};this.getAppId=f;this.isVisible=function(){return m.winWidth&&m.winHeight&&m.showState&&45<m.winHeight&&45<m.winWidth};this.isMainWin=function(){if(!(m.isVisible()&&m.winWidth&&m.winHeight&&45<m.winHeight&&45<m.winWidth))return!1;var H=1>m.ownerWinid;if(!H)return H;var y=m.style;if(0!=(y&4194304))return!0;if(0!=(y&2147483648)&&(0==(y&8388608)||0==(y&12582912)))return!1;var C=
0!=(m.extStyle&128);(H=H&&!C)&&0!=(y&2147483648)&&0==(y&2156396544)&&(H=!1);return H};f()}}(p,qa);this.getSurfaces=function(){return ca};this.hide=function(){ca&&ca.hide()};this.getFileUrl=function(a,b,c){var e=ta(),d=Wc,f=d.indexOf("://");e=(0<f&&11>f?d:e+d)+"s="+mc+"&f="+encodeURIComponent(a);b&&(e+="&src="+b);c&&(e+="&action="+c);return p.modifyURL(e)};this.listFiles=function(a,b){Ma&&Xa&&Ma.list(a,b)};this.writeRawInput=function(a){if(Xa){sa(a);if(p.onactivity)p.onactivity(a);return!0}return!1};
this.authWithCode=function(a,b){var c=a.length,e=new Uint8Array(5+c);e[0]=146;e[1]=7;e[2]=b;e[3]=c&255;e[4]=c>>8&255;for(b=0;b<c;b++)e[5+b]=a.charCodeAt(b);sa(e.buffer)};var Yc=0;if(ea.numLock||ea.numlock||V(P.numLock)||hi5.browser.isMacOS||hi5.browser.isiOS||hi5.browser.isCrOS)Yc|=2;var Qa=new function(a,b){this.setJoinMode=a.setJoinMode;this.requestControl=a.requestControl;this.writeKeyComb=a.writeKeyComb;this.writeText=a.writeText;this.localLockFlags=b||0;this.remoteLockFlags=0;this.checkLockFlags=
!0;this.reqCopyTime=0;a.isRemoteApp();var c=void 0,e=a.getSurfaces();this.saveResize=function(d){c=a.reconnectOnResize;a.reconnectOnResize=d};this.restoreResize=function(){void 0!=c&&(a.reconnectOnResize=c)};this.getAppMode=function(){return a.mode};this.getAgentStatus=function(){return a.getAgentStatus()};this.send=a.writeRawInput;this.saveSession=function(d){a.saveSession(d)};this.sendInput=a.writeRawInput;this.getAppInfo=function(){return a.sessionInfo.appInfo};this.resumePlay=function(){Ta.supportWebAudio&&
Ta.iOSFix()};this.onresize=function(d){if((d=d.target.svSurface)&&!document.hidden){var f=d.getFreeSpace(),m=f.width;f=f.height;Qa.checkLockFlags=!0;ea.scale?d.scaleTo(m,f,!1):a.resetSize(m,f)}};this.onorientationchange=function(d){a.resetSize(d.innerWidth,d.innerHeight)};this.getClipData=function(d,f){this.reqCopyTime=Date.now();var m=a.getGatewayAddr(),H=Xc,y=H.indexOf("://");m=(0<y&&11>y?H:m+H)+"s="+a.sessionInfo.appInfo.session+"&t="+Date.now()+"&type="+d;d=hi5.httpGet(a.modifyURL(m),f);this.reqCopyTime=
Date.now();Qc(d);return d};this.getShareFiles=a.listFiles;this.getFile=function(d,f,m){a.reconnectOnResize=!1;var H=a.getFileUrl(d,f,m);p.ondownload&&p.ondownload({fileName:d,url:H,source:f,action:m})||window.open(H)};this.getFileLink=a.getFileUrl;this.getGateway=function(){return n};this.reconnect=function(d,f,m){P.symlink?(d="user="+d+"&pwd="+f,m&&(d+="&domain="+m),n=hi5.tool.replaceQuery(n,"parameters",d)):(n=hi5.tool.replaceQuery(n,"user",d),n=hi5.tool.replaceQuery(n,"pwd",f),n=hi5.tool.replaceQuery(n,
"domain",m));a.run()};this.sendKeyboardSyncFlags=function(d,f){return Xa?(this.remoteLockFlags=this.localLockFlags=d,setTimeout(function(){a.writeRawInput("8E5"+d)},f||333),!0):!1};this.sendKeyboardSynchronize=function(d,f,m){var H=0;m&&(H|=4);f&&(H|=2);d&&(H|=1);this.sendKeyboardSyncFlags(H)};this.fromSyncedSurface=function(d){return e.fromSyncedSurface(d)};this.setWorkDir=function(d){a.writeKeyComb("Windows+R",20,function(){setTimeout(function(){a.writeText(d,10,function(){a.writeScancode(!0,28);
a.writeScancode(!1,28)})},666)})};this.authWithCode=function(d,f){a.authWithCode(d,f)};this.getPrinters=function(d){a.getPrinters(d)};this.attachPrinter=function(d){a.attachPrinter(d)}}(p,Yc),Od=new function(a,b){this.draw=a.draw;this.refresh=function(c,e,d,f){return a.repaint(c,e,d-c+1,f-e+1)};this.onfocus=function(c){var e=b.getFocused();Wa&&e&&e.railWin&&(c=e.railWin.mainWin)&&_core.running()&&(e=e.context)&&e!=a.getContext()&&(a.setContext(null),c.activate(1),svGlobal.logger.info("Activate win:"+
c.id))}}(qa,ca);this.sendKeyboardSynchronize=function(a,b,c){Qa.sendKeyboardSynchronize(a,b,c)};this.VirtualChannel=function(){return new nb(143)};this.GatewayChannel=function(){return new nb(28)};this.DynamicChannel=function(){return new nb(64)};this.addChannel=function(a){kb[a.name]=a};this.addGatewayChannel=function(a){ib[a.name]=a};this.addDynamicChannel=function(a){Fa.names.push(a.name);Fa[a.name]=a;Fa.count++};var Ra=null,Fa={count:0,names:[],usbChannel:null,close:function(){for(var a=Fa.names,
b=0,c=a.length;b<c;b++)Fa[a[b]].onclose&&(Fa[a[b]].onclose(),Fa[a[b]]=null);a.length=0;Fa.usbChannel=null},init:function(a,b,c,e,d,f){function m(){this.WAVE_FORMAT_PCM=1;this.WAVE_FORMAT_ADPCM=2;this.WAVE_FORMAT_ALAW=6;this.WAVE_FORMAT_MULAW=7;this.WAVE_FORMAT_GSM=49;this.WAVE_FORMAT_MPEGLAYER3=85;this.WAVE_FORMAT_AAC=41222;this.cbSize=this.bitsPerSample=this.nBlockAlign=this.nAvgBytesPerSec=this.nSamplesPerSec=this.nChannels=this.formatTag=0;this.extenstion=null;var q=this;this.fromBuffer=function(z,
A){q.formatTag=z.getLittleEndian16();q.nChannels=z.getLittleEndian16();q.nSamplesPerSec=z.getLittleEndian32();q.nAvgBytesPerSec=z.getLittleEndian32();q.nBlockAlign=z.getLittleEndian16();q.bitsPerSample=z.getLittleEndian16();var t=z.getLittleEndian16();q.cbSize=t;0<t&&!0!==A&&(q.extenstion=Array(t),z.copyToByteArray(q.extenstion,0,z.getPosition(),t),z.skipPosition(t))};this.toBuffer=function(z){z.setLittleEndian16(q.formatTag);z.setLittleEndian16(q.nChannels);z.setLittleEndian32(q.nSamplesPerSec);
z.setLittleEndian32(q.nAvgBytesPerSec);z.setLittleEndian16(q.nBlockAlign);z.setLittleEndian16(q.bitsPerSample);z.setLittleEndian16(q.cbSize);0<q.cbSize&&z.setBytes(q.extenstion)};this.getSize=function(){return 18+q.cbSize};this.toString=function(){return"Audio Format, tag="+q.formatTag+" nChannels="+q.nChannels+" nSamplesPerSec="+q.nSamplesPerSec+" nAvgBytesPerSec="+q.nAvgBytesPerSec+" nBlockAlign="+q.nBlockAlign+" bitsPerSample="+q.bitsPerSample+" cbSize="+q.cbSize}}function H(){Ra=new p.DynamicChannel;
Ra.name="Microsoft::Windows::RDS::DisplayControl";Ra.enabled=!1;Ra.process=function(q){var z=q.getLittleEndian32();q.getLittleEndian32();switch(z){case 5:z=q.getLittleEndian32(),Ra.maxMonitorAreaFactorA=q.getLittleEndian32(),Ra.maxMonitorAreaFactorB=q.getLittleEndian32(),Ra.enabled=!0,svGlobal.logger.warn("Display control maxNumMonitors:"+z+" factorA:"+Ra.maxMonitorAreaFactorA+" factorB:"+Ra.maxMonitorAreaFactorB),q=new Uint8Array(2),q[0]=146,q[1]=4,sa(q.buffer),Pa&&setTimeout(function(){Pa&&Pa.check(5E3)},
1900)}};Ra.applyResolution=function(q,z){if(Ra.enabled){var A=new Uint8Array(56),t=new RdpBuffer(A,0,56);q=q>Ra.maxMonitorAreaFactorA?Ra.maxMonitorAreaFactorA:q&-4;z=z>Ra.maxMonitorAreaFactorB?Ra.maxMonitorAreaFactorB:z&-4;t.setLittleEndian32(2);t.setLittleEndian32(56);t.setLittleEndian32(40);t.setLittleEndian32(1);t.setLittleEndian32(1);t.setLittleEndian32(0);t.setLittleEndian32(0);t.setLittleEndian32(q);t.setLittleEndian32(z);t.setLittleEndian32(.26458*q|0);t.setLittleEndian32(.26458*z|0);t.setLittleEndian32(q>
z?0:90);t.setLittleEndian32(100);t.setLittleEndian32(100);Ra.send(A);svGlobal.logger.warn("Display control: "+q+"x"+z)}else svGlobal.logger.warn("Display control disabled.")};return Ra}if(!ea.disableDVC){if(ea.enableEcho){var y=new p.DynamicChannel;y.name="ECHO";y.process=function(q){var z=q.getPosition(),A=q.getEnd(),t=new Uint8Array(A-z);t.set(q.getData().subarray(z,A));y.send(t)};p.addDynamicChannel(y)}if(a){var C=new p.DynamicChannel;C.name="Microsoft::Windows::RDS::Input";C.process=function(q){var z=
q.getLittleEndian16();q.getLittleEndian32();switch(z){case 1:q.skipPosition(4),q=new RdpBuffer(new Uint8Array(16),0,16),q.setLittleEndian16(2),q.setLittleEndian32(16),q.setLittleEndian32(3),q.setLittleEndian32(65536),q.setLittleEndian16(256),q.markEnd(),C.send(q);case 5:ca.execute("setTouchRemoting",[!0]);Fa.isTouchReady=!0;svGlobal.logger.info("Touch remoting start");break;case 4:ca.execute("setTouchRemoting",[!1]),Fa.isTouchReady=!1,svGlobal.logger.info("Touch remoting suspend")}};p.addDynamicChannel(C)}if(c){svGlobal.logger.warn("Audio input on");
var E=new p.DynamicChannel;(function(){function q(W){var Y=new RdpBuffer(new Uint8Array(5),0,5);Y.setByte(7);Y.setLittleEndian32(W);Y.markEnd();E.send(Y)}function z(W){var Y=W.getLittleEndian32(),ja=W.getLittleEndian32(),pa=new m;pa.fromBuffer(W,!0);var ma=0,wa=0;0<pa.cbSize&&(22==pa.cbSize?(ma=W.getLittleEndian16(),wa=W.getLittleEndian32(),W.skipPosition(16)):(svGlobal.logger.warn("Wrong cbsize: "+pa.cbSize),W.skipPosition(pa.cbSize)));W=t[ja];svGlobal.logger.info("Selceted rec fmt, framesPerPacket: "+
Y+" initial: "+ja+", "+W.toString());svGlobal.logger.info("Open fmt: "+pa.toString()+" validBits:"+ma+" mask:"+wa);T=!0;w=p.reconnectOnResize;p.reconnectOnResize=!1;U.onopen||(U.onopen=function(oa){if(Ha){A=oa;p.reconnectOnResize=w;q(ja);var ua=new RdpBuffer(new Uint8Array(5),0,5);ua.setByte(4);ua.setLittleEndian32(oa?0:1);ua.markEnd();E.send(ua)}});U.ondata||(U.ondata=function(oa,ua){A&&(K.length!=ua+1&&(K=new Uint8Array(ua+1),K[0]=6),E.send(F),K.set(oa,1),E.send(K))});U.start(W,Y)}E.name="AUDIO_INPUT";
E.process=function(W){var Y=W.getByte();switch(Y){case 1:W=W.getLittleEndian32();Y=new RdpBuffer(new Uint8Array(5),0,5);Y.setByte(1);Y.setLittleEndian32(W);Y.markEnd();E.send(Y);break;case 2:var ja=W.getLittleEndian32();W.getLittleEndian32();var pa=hi5.audio.getAudioContext().sampleRate;for(Y=t.length=0;Y<ja;Y++){var ma=new m;ma.fromBuffer(W);svGlobal.logger.info("Server rec fmt "+Y+":"+ma.toString());0==e&&49==ma.formatTag&&22050==ma.nSamplesPerSec?t.push(ma):1==ma.formatTag&&ma.nSamplesPerSec<=
pa&&t.push(ma)}E.send(F);ja=0;W=t.length;for(Y=0;Y<W;Y++)ja+=t[Y].getSize();pa=new RdpBuffer(new Uint8Array(1024),0,1024);pa.setByte(2);pa.setLittleEndian32(W);pa.setLittleEndian32(ja+9);for(Y=0;Y<W;Y++)t[Y].toBuffer(pa),svGlobal.logger.info("Client rec fmt: "+t[Y].toString());pa.skipPosition(1024-ja-9);pa.markEnd();E.send(pa);break;case 3:z(W);break;case 7:Y=W.getLittleEndian32();svGlobal.logger.info("Rec fmt change, "+t[Y].toString()+" by client:"+T);T||(q(Y),T=!1);break;default:svGlobal.logger.warn("audioInput: invalid tag:"+
Y)}};var A=!1,t=[];E.onclose=function(){A=!1;U&&U.close()};var F=new Uint8Array(1);F[0]=5;var T=!1,w=p.reconnectOnResize,K=new Uint8Array(0),O=ra("audiorecorder",hi5.libMin?"audiorecorder_min.js?v=0":"audiorecorder.js?v=0"),U=window.AudioWorkletNode?new hi5.audio.WorkletRecorder(hi5.audio.getAudioContext(),O):new hi5.audio.Recorder(hi5.audio.getAudioContext())})();p.addDynamicChannel(E)}p.addDynamicChannel(function(){var q=new p.DynamicChannel;q.name="TSMF";var z={type:"image/jpeg"},A=Array(1);q.process=
function(t){t.getPosition();var F=t.getLittleEndian32()&1073741823;var T=t.getLittleEndian32();var w=t.getLittleEndian32();switch(F){case 2:if(256==w){t.getLittleEndian32();w=new Uint8Array(16);var K=new RdpBuffer(w,0,16);K.setLittleEndian32(2);K.setLittleEndian32(T);K.setLittleEndian32(1);K.setLittleEndian32(0);q.send(w)}break;case 0:switch(w){case 257:t.getBytes(16);t.getLittleEndian32();break;case 256:F=t.getPosition();K=t.getLittleEndian32();for(w=0;w<K;w++){t.getLittleEndian32();var O=t.getLittleEndian32();
t.getLittleEndian32();t.skipPosition(O-4)}w=t.getPosition()-F;K=w+8+4;w=new Uint8Array(K);K=new RdpBuffer(w,0,K);K.setLittleEndian32(-2147483648);K.setLittleEndian32(T);w.set(t.getData().subarray(F,t.getPosition()),8);q.send(w);break;case 261:t.getBytes(16);t.getLittleEndian32();break;case 264:F=t.getLittleEndian32();t.skipPosition(4);t.getLittleEndian32();O=t.getBytes(16);var U=t.getBytes(16);t.getLittleEndian32();t.getLittleEndian32();t.getLittleEndian32();var W=t.getBytes(16);w=t.getLittleEndian32();
t.skipPosition(w);w=new Uint8Array(20);K=new RdpBuffer(w,0,20);K.setLittleEndian32(-2147483648);K.setLittleEndian32(T);hi5.Arrays.equals([118,105,100,115,0,0,16,0,128,0,0,170,0,56,155,113],O)&&hi5.Arrays.equals([77,74,80,71,0,0,16,0,128,0,0,170,0,56,155,113],U)&&hi5.Arrays.equals([128,159,88,5,86,195,206,17,191,1,0,170,0,85,89,90],W)?K.setLittleEndian32(1):(K.setLittleEndian32(0),svGlobal.logger.warn("Format is not supported:"),svGlobal.logger.warn(O),svGlobal.logger.warn(U),svGlobal.logger.warn(W));
K.setLittleEndian32(F);q.send(w);break;case 258:t.getBytes(16);t.getLittleEndian32();F=t.getLittleEndian32();t.skipPosition(F);break;case 263:t.getBytes(16),w=new Uint8Array(16),K=new RdpBuffer(w,0,16),K.setLittleEndian32(-2147483648),K.setLittleEndian32(T),K.setLittleEndian32(1),q.send(w);case 277:t.getBytes(16);t.getLittleEndian32();break;case 262:t.getBytes(16);qa.flushImgs();qa.setImgRect(0,0,0,0);w=new Uint8Array(12);K=new RdpBuffer(w,0,12);K.setLittleEndian32(-2147483648);K.setLittleEndian32(T);
q.send(w);break;case 278:t.getBytes(16);T=t.getLittleEndian32();w=t.getLittleEndian32();F=t.getLittleEndian32();t=t.getLittleEndian32();qa.setImgRect(T,w,F-T,t-w);break;case 265:t.getBytes(16);t.getLittleEndian64();t.getLittleEndian32();break;case 266:t.getBytes(16);break;case 268:t.getBytes(16);break;case 267:t.getBytes(16);break;case 269:t.getBytes(16);t.getLittleEndian32();break;case 274:break;case 275:break;case 259:t.getBytes(16);t.getLittleEndian32();t.getLittleEndian32();t.skipPosition(32);
w=t.getLittleEndian32();T=new Image;F=t.getPosition();A[0]=t.getData().subarray(F,F+w);t=new Blob(A,z);T.src=URL.createObjectURL(t);qa.addImg(T);break;case 270:qa.flushImgs();break;case 273:break;case 260:break;case 276:t.getBytes(16);w=t.getLittleEndian32();F=t.getPosition()+w;t.skipPosition(8);T=t.getLittleEndian32();svGlobal.logger.info("window state:"+T);K=t.getLittleEndian32();O=t.getLittleEndian32();T=t.getLittleEndian32();w=t.getLittleEndian32();t.skipPosition(8);U=t.getLittleEndian32();W=
t.getLittleEndian32();svGlobal.logger.info("Window rect, left:"+T+" top:"+w+" w:"+K+" h:"+O+" cl:"+U+" ct:"+W);t.setPosition(F);F=t.getLittleEndian32();for(F=t.getPosition()+F;t.getPosition()<F;){U=t.getLittleEndian32();W=t.getLittleEndian32();var Y=t.getLittleEndian32(),ja=t.getLittleEndian32();svGlobal.logger.info("visible region, l:"+W+" t:"+U+" r:"+ja+" b:"+Y)}qa.setImgRect(T,w,K,O);break;case 1:case 2:break;default:svGlobal.logger.warn("unknown function:"+w)}break;default:svGlobal.logger.warn("unkown interface:"+
F)}};return q}());jb||p.addDynamicChannel(H());ea.enableDVCAudio&&p.addDynamicChannel(function(q){var z=!1,A=0,t=0,F=0,T=0,w=[],K=new Uint8Array(4),O=new p.DynamicChannel;O.name="AUDIO_PLAYBACK_DVC";O.onclose=function(){};O.process=function(U){function W(ka){ka.skipPosition(14);var fa=ka.getLittleEndian16();ka.getByte();var ya=ka.getLittleEndian16();ka.skipPosition(1);for(var ia,g=w.length=0;g<fa;g++){var h=new m;h.fromBuffer(ka);(ia=22050<=h.nSamplesPerSec&&(1==h.formatTag||49==h.formatTag&&22050==
h.nSamplesPerSec&&0==q||41222==h.formatTag))&&w.push(h)}h=20;ka=w.length;for(g=0;g<ka;g++)h+=w[g].getSize();g=h+4;fa=new RdpBuffer(new Uint8Array(g),0,g);fa.setByte(7);fa.setByte(2);fa.setLittleEndian16(h);fa.setLittleEndian32(3);fa.setLittleEndian32(4294967295);fa.setLittleEndian32(0);fa.setLittleEndian16(0);fa.setLittleEndian16(ka);fa.skipPosition(1);fa.setLittleEndian16(ya);fa.setByte(124);for(g=0;g<ka;g++)h=w[g],h.toBuffer(fa);fa.markEnd();O.send(fa);5<ya&&(fa=new RdpBuffer(new Uint8Array(8),
0,8),fa.setByte(12),fa.skipPosition(1),fa.setLittleEndian16(4),fa.setLittleEndian16(0),fa.setLittleEndian16(0),fa.markEnd(),O.send(fa))}function Y(ka){var fa=ka.getLittleEndian16();ka=ka.getLittleEndian16();var ya=new RdpBuffer(new Uint8Array(8),0,8);ya.setByte(6);ya.setByte(35);ya.setLittleEndian16(4);ya.setLittleEndian16(fa);ya.setLittleEndian16(ka);ya.markEnd();O.send(ya)}function ja(){var ka=w[F];if(ka.formatTag!=Ea.tag||ka.nSamplesPerSec!=Ea.samplePerSec||Ea.channels!=ka.nChannels)Ea.tag=ka.formatTag,
Ea.channels=ka.nChannels,Ea.samplePerSec=ka.nSamplesPerSec,Ea.bitsPerSample=49==ka.formatTag?8:ka.bitsPerSample,svGlobal.logger.info("DVC Audio Format, tag="+Ea.tag+" channels="+Ea.channels+" bitsPerSample="+Ea.bitsPerSample+" samplePerSec="+Ea.samplePerSec),41222==Ea.tag&&(Ea.sampleRate=Ea.samplePerSec,Ta.initMediaPlayer(Ta,Ea,!0))}function pa(ka){t=ka.getLittleEndian16();F=ka.getLittleEndian16();T=ka.getByte();ka.skipPosition(3);K.set(ka.getSubarray(4));z=!0;ja()}function ma(ka,fa){var ya=new RdpBuffer(new Uint8Array(8),
0,8);ya.setByte(5);ya.skipPosition(1);ya.setLittleEndian16(4);ya.setLittleEndian16(ka);ya.setByte(fa);ya.skipPosition(1);ya.markEnd();O.send(ya)}function wa(ka){z=!1;var fa=A-8,ya=Date.now();ka.copyFromByteArray(K,0,ka.getPosition(),4);kc(ka,T,t,fa);ka=t+(Date.now()-ya);ma(ka,T)}function oa(ka){var fa=Date.now();t=ka.getLittleEndian16();F=ka.getLittleEndian16();T=ka.getByte();ka.skipPosition(7);ja();ka=kc(ka,T,t,0);ka*=1E3;fa=t+(Date.now()-fa)+ka;ma(fa,T)}if(z)wa(U);else{var ua=U.getByte();U.skipPosition(1);
A=U.getLittleEndian16();switch(ua){case 7:W(U);break;case 6:Y(U);break;case 2:pa(U);break;case 3:U.getLittleEndian16();U.getLittleEndian16();break;case 13:oa(U)}}};return O}(e));svGlobal.DCVC_EXTENSION||(svGlobal.DCVC_EXTENSION={});var u=svGlobal.DCVC_EXTENSION;u.videoMedia={video:null,track:null,canvas:null,ctx:null,resolutions:null,minFrameRate:16,type:2,activate:function(q,z){svGlobal.logger.info("activate webcam");u.videoMedia.resolutions?q():hi5.video.resolutions(function(A){A.length?(u.videoMedia.resolutions=
A,q()):z()})},deactivate:function(){var q=u.videoMedia;q.track&&(q.track.stop(),q.track=null);q.ctx=null;q.canvas=null;q.video=null;svGlobal.logger.info("deactivate cam")},startStream:function(q,z,A,t,F){svGlobal.logger.info("startStream, width:"+q+" height:"+z+" frameRate:"+A);var T=u.videoMedia,w=T.track;if(w){var K=w.getSettings();if("live"==w.readyState)if(q!=K.width||z!=K.height||A!=K.frameRate&&2!=T.type)w.stop();else return}navigator.mediaDevices.getUserMedia({video:{frameRate:2==T.type?T.minFrameRate:
A,width:{exact:q},height:{exact:z}}}).then(function(O){var U=document.createElement("video");U.srcObject=O;U.play();if(window.OffscreenCanvas)var W=new OffscreenCanvas(100,100);else W=document.createElement("canvas"),W.style.position="absolute",W.style.left=0,W.style.top=0;T.track=O.getVideoTracks()[0];T.canvas=W;T.ctx=W.getContext("2d");T.video=U;O=T.track.getSettings();T.canvas.width=O.width;T.canvas.height=O.height;t()}).catch(function(O){svGlobal.logger.warn(O);F()})},stopStream:function(){svGlobal.logger.info("stopStream");
var q=u.videoMedia;q.track&&"live"==q.track.readyState&&q.track.stop()},grabFrame:function(q){function z(t){t.arrayBuffer().then(q)}var A=u.videoMedia;A.ctx.drawImage(A.video,0,0);A=A.canvas;A.convertToBlob?A.convertToBlob({type:"image/jpeg",quality:.6}).then(z):A.toBlob(z,"image/jpeg",.6)},propertyList:[[{propertyId:1,capabilities:3,min:4294967286,max:4294967294,step:1,default:4294967291},null,{propertyId:3,capabilities:1,min:4294967280,max:16,step:1,default:0},{propertyId:4,capabilities:1,min:0,
max:3,step:1,default:0},{propertyId:5,capabilities:1,min:4294967280,max:16,step:1,default:0},{propertyId:6,capabilities:1,min:100,max:400,step:10,default:100}],[{propertyId:1,capabilities:1,min:0,max:2,step:1,default:1},{propertyId:2,capabilities:1,min:4294967232,max:64,step:1,default:0},{propertyId:3,capabilities:1,min:0,max:95,step:1,default:0},{propertyId:4,capabilities:1,min:4294965296,max:2E3,step:1,default:0},{propertyId:5,capabilities:3,min:2800,max:6500,step:1,default:4600}]]};u.WEBAUTHN=
function(q){var z=new q;z.name="WebAuthN_Channel";z.newInstance=function(){return u.WEBAUTHN(q)};z.onopen=function(){svGlobal.logger.info("webAuthn open")};z.onclose=function(){svGlobal.logger.info("webAuthn close")};z.process=function(A){var t=A.getEnd()-A.getPosition();A=A.getBytes(t);var F=Gb(A),T=F.command;t=F.flags;A=F.timeout;var w=F.webAuthNPara;if(T)switch(console.log("==== command: "+F.command),T){case 5:if(F.request)switch(T=F.request[0],console.log("==== webAuth cmdType = "+T),console.log("==== webAuth request bytes: "+
sb(F.request.slice(1,F.request.length))),T){case 1:F=F.request.slice(1,F.request.length);var K=Gb(F);F=K[1];var O=K[2],U=K[3],W=K[4],Y=K[5];T=K[6];var ja=K[7];K={};var pa=ud(w);pa&&(pa.attestation&&(K.attestation=pa.attestation),pa.attestationFormats&&(K.attestationFormats=pa.attestationFormats));if(t=td(t,w,ja))K.authenticatorSelection=t;K.challenge=F;Y&&(K.excludeCredentials=Cc(Y));T&&(K.extensions=T);W&&(K.pubKeyCredParams=W);K.rp={id:window.location.hostname,name:"RS_Gateway"};A&&(K.timeout=A);
K.user=U;A={};A.signal=createNewAbortWebAuthnSignal();A.publicKey=K;navigator.credentials.create(A).then(function(ma){vd(ma.response,O).then(function(wa){var oa={},ua={maxMsgSize:1200,maxSerializedLargeBlobArray:0,providerType:"Hid",providerName:"MicrosoftCtapHidProvider",devicePath:"\\\\?\\hid#vid_1050&pid_0407&mi_01#7&1dd131cc&0&0000#{4d1e55b2-f16f-11cf-88cb-001111000030}"},ka=new Uint8Array([159,87,192,47,19,129,234,71,177,22,187,90,141,185,32,42]);ua.aaGuid=ka.buffer;ua.residentKey=!0;oa.deviceInfo=
ua;oa.status=0;oa.response=wa;wa=CBOR.encode(oa);oa=new hi5.DataBuffer(new Uint8Array(4+wa.byteLength));oa.setLittleEndian32(0);oa.setBytes(wa);oa.markEnd();z.send(oa)})}).catch(function(ma){console.log("WebAuthN MakeCredential failed with error code ["+ma.code+"], msg: "+ma.message);ma=new hi5.DataBuffer(new Uint8Array(4));ma.setLittleEndian32(1);ma.markEnd();z.send(ma)});break;case 2:F=F.request.slice(1,F.request.length);K=Gb(F);F=K[2];U=K[3];T=K[4];ja=K[5];K={};U&&(K.allowCredentials=Cc(U));K.challenge=
F;T&&(K.extensions=T);K.rp=window.location.hostname;A&&(K.timeout=A);if(A=Bc(t,w,ja))K.userVerification=A;A={};A.signal=createNewAbortWebAuthnSignal();A.publicKey=K;navigator.credentials.get(A).then(function(ma){ma=new hi5.DataBuffer(new Uint8Array(void 0));ma.markEnd();z.send(ma)}).catch(function(ma){console.log("WebAuthN GetAssertion failed with error code ["+ma.code+"], msg: "+ma.message);ma=new hi5.DataBuffer(new Uint8Array(4));ma.setLittleEndian32(1);ma.markEnd();z.send(ma)});break;default:svGlobal.logger.error("Unknown WebAuthn command type: "+
T)}else svGlobal.logger.error("Incorrect request content in WEB AUTH COMMAND");break;case 6:A=new hi5.DataBuffer(new Uint8Array(8));A.setLittleEndian32(0);t=Ac()?PublicKeyCredential.isUserVerifyingPlatformAuthenticatorAvailable():!1;t?A.setLittleEndian32(1):A.setLittleEndian32(0);A.markEnd();z.send(A);break;case 7:cancelWebAuthnOperations();A=new hi5.DataBuffer(new Uint8Array(4));A.setLittleEndian32(0);A.markEnd();z.send(A);break;case 8:A=new hi5.DataBuffer(new Uint8Array(8));A.setLittleEndian32(0);
A.setLittleEndian32(4);A.markEnd();z.send(A);break;default:svGlobal.logger.warn("Unknown command received in WebAuthN Channel: "+T)}else svGlobal.logger.warn("WebAuthN Channel, command missed")};return z};p.enableWebAuthn()&&Ac()&&(a=u.WEBAUTHN(p.DynamicChannel),p.addDynamicChannel(a));u.WEBCAM=function(q){var z=new q;z.name="RDCamera_Device_0";z.version=2;z.newInstance=function(){return u.WEBCAM(q)};z.onopen=function(){svGlobal.logger.info("cam open")};z.onclose=function(){svGlobal.logger.info("cam close")};
z.sendSucess=function(){var A=new hi5.DataBuffer(new Uint8Array(2));A.setByte(z.version);A.setByte(1);A.markEnd();z.send(A)};z.sendError=function(A){var t=new hi5.DataBuffer(new Uint8Array(6));t.setByte(z.version);t.setByte(2);t.setLittleEndian32(A||1);t.markEnd();z.send(t)};z.sendSteamListResp=function(){var A=new hi5.DataBuffer(new Uint8Array(7));A.setByte(z.version);A.setByte(10);A.setLittleEndian16(1);A.setByte(1);A.setByte(1);A.setByte(0);A.markEnd();z.send(A)};z.sendMediaTypeListResp=function(A){var t=
u.videoMedia.resolutions,F=t.length,T=new hi5.DataBuffer(new Uint8Array(2+26*F));T.setByte(z.version);T.setByte(12);for(var w=1==A,K=0;K<F;K++){T.setByte(A);var O=t[K];T.setLittleEndian32(O.width);T.setLittleEndian32(O.height);T.setLittleEndian32(w?O.frameRate:u.videoMedia.minFrameRate);T.setLittleEndian32(1);T.setLittleEndian32(1);T.setLittleEndian32(1);T.setByte(1)}T.markEnd();z.send(T)};z.sendCurrentMediaType=function(A,t){var F=new hi5.DataBuffer(new Uint8Array(28));F.setByte(z.version);F.setByte(14);
t=u.videoMedia.resolutions[t];F.setByte(A);F.setLittleEndian32(t.width);F.setLittleEndian32(t.height);F.setLittleEndian32(1==A?t.frameRate:u.videoMedia.minFrameRate);F.setLittleEndian32(1);F.setLittleEndian32(1);F.setLittleEndian32(1);F.setByte(1);F.markEnd();z.send(F)};z.sendSampleResp=function(A){u.videoMedia.grabFrame(function(t){var F=new hi5.DataBuffer(new Uint8Array(t.byteLength+3));F.setByte(z.version);F.setByte(18);F.setByte(A);F.setBytes(new Uint8Array(t));F.markEnd();z.send(F)})};z.sendPropertyListResp=
function(){for(var A=0,t,F,T=u.videoMedia.propertyList,w=0;2>w;w++){F=T[w];t=F.length;for(var K=0;K<t;K++)null!=F[K]&&A++}var O=new hi5.DataBuffer(new Uint8Array(2+19*A));O.setByte(z.version);O.setByte(21);for(w=0;2>w;w++)for(F=T[w],t=F.length,K=0;K<t;K++)A=F[K],null!=A&&(O.setByte(w+0),O.setByte(A.propertyId),O.setByte(A.capabilities),O.setLittleEndian32(A.min),O.setLittleEndian32(A.max),O.setLittleEndian32(A.step),O.setLittleEndian32(A.default));O.markEnd();z.send(O)};z.sendPropertyValueResp=function(A,
t){(A=u.videoMedia.propertyList[A][t-1])?(t=new hi5.DataBuffer(new Uint8Array(7)),t.setByte(z.version),t.setByte(23),t.setByte(1),t.setLittleEndian32(A.value||A.default),t.markEnd(),z.send(t)):z.sendError(8)};z.process=function(A){A.getByte();var t=A.getByte();switch(t){case 7:u.videoMedia.activate(z.sendSucess,z.sendError);break;case 8:u.videoMedia.deactivate();z.sendSucess();break;case 9:z.sendSteamListResp();break;case 11:A=A.getByte();0!=A&&svGlobal.logger.warn("Invalid stream index: "+A);z.sendMediaTypeListResp(u.videoMedia.type);
break;case 13:A=A.getByte();z.sendCurrentMediaType(u.videoMedia.type,A);break;case 15:A.getByte();t=A.getByte();if(t!=u.videoMedia.type){svGlobal.warn("Invalid video format req:"+t);z.sendError(6);break}t=A.getLittleEndian32();var F=A.getLittleEndian32();A=A.getLittleEndian32()/A.getLittleEndian32();u.videoMedia.startStream(t,F,A,z.sendSucess,z.sendError);break;case 16:u.videoMedia.stopStream();z.sendSucess();break;case 17:A=A.getByte();0!=A&&svGlobal.logger.info("Invalid stream index for SampleRequest: "+
A);z.sendSampleResp(A);break;case 20:z.sendPropertyListResp();break;case 22:t=A.getByte();A=A.getByte();z.sendPropertyValueResp(t,A);break;case 24:z.sendError(10);break;default:z.sendError(10),svGlobal.logger.warn("Invalid cam msg: "+t)}};return z};u.WEBCAM_ENUM=function(q,z){var A=new q;A.name="RDCamera_Device_Enumerator";A.onopen=function(){var t=new hi5.DataBuffer(new Uint8Array(2));t.setByte(z.version);t.setByte(3);t.markEnd();A.send(t);svGlobal.logger.info("camEnum open")};A.onclose=function(){svGlobal.logger.info("camEnum closed");
u.videoMedia.deactivate()};A.addDevice=function(t){t+="\x00";var F=z.name+"\x00",T=new hi5.DataBuffer(new Uint8Array(2+2*t.length+F.length));T.setByte(z.version);T.setByte(5);T.setUnicodeString(t);T.setAscllString(F);T.markEnd();A.send(T)};A.process=function(t){var F=t.getByte();t=t.getByte();switch(t){case 4:svGlobal.logger.info("camEnum ver resp: "+F);z.version=F;A.addDevice(hi5.video.webcam&&hi5.video.webcam.label||"Web Camera");break;default:svGlobal.logger.warn("invalid messageId on camEnum: "+
t)}};return A};d&&(d=u.WEBCAM(p.DynamicChannel),a=u.WEBCAM_ENUM(p.DynamicChannel,d),p.addDynamicChannel(a),p.addDynamicChannel(d));f&&(svGlobal.logger.info("Mapping USB..."),p.addDynamicChannel(Fa.usbChannel));if(b&&u.GFX){var v=function(){Q.drawable.resumePlay||(Q.drawable.resumePlay=function(){Ta&&Ta.supportWebAudio&&Ta.iOSFix();Q.resumeVideo()})},Q=u.GFX(p.DynamicChannel,V(P.remotefx)&&!V(P.gfx),0==p.mode,qa);Q.onmessage=function(q){p.showMessage(q)};v();Q.onuserinteract=function(q){ca.execute("showPlay");
v();svGlobal.logger.info("resumePlay");return!0};Q.onfatalerror=function(q,z){p.reconnect(q.width,q.height,!0)};Q.onsps=function(q){q.fps&&p.setFPS(q.fps)};Q.onresetgraphic=function(q){p.setResolution(q.width,q.height)};Q.onmapsurface=function(q){Q.onconfirm();var z=ca.getMonitorSurface(q.outputOriginX,q.outputOriginY,q.targetWidth+q.outputOriginX-1,q.targetHeight+q.outputOriginY-1);z?(z.setId(q.id),z.setSize(q.targetWidth,q.targetHeight)):svGlobal.logger.error("Failed to map surface, x:"+q.outputOriginX+
" y:"+q.outputOriginY)};Q.onconfirm=function(){svGlobal.logger.info("GFXDrawableController in use");ca.execute("setDrawable",[Q.drawable])};p.addDynamicChannel(Q)}}}},db=null;svGlobal.DCVC_EXTENSION&&!jb&&(p.hasUSB()&&svGlobal.DCVC_EXTENSION.WEBUSB&&(Fa.usbChannel=svGlobal.DCVC_EXTENSION.WEBUSB(p.DynamicChannel)),svGlobal.DCVC_EXTENSION.DRIVE&&(db=svGlobal.DCVC_EXTENSION.DRIVE(p.GatewayChannel),p.addGatewayChannel(db)));this.getPrinters=function(a){if(!p.onagentmessage||!db)return null;var b=new hi5.DataBuffer(new Uint8Array(2));
b.setByte(6);b.setByte(1);b.markEnd();p.onagentmessage(b.getData());db.listCallback=a};this.attachPrinter=function(a){db&&db.attachPrinter(a,p)};this.showError=Fb;this.resetStatus=ac;this.exeAppCmd=function(a){var b=ca.getFocused();b&&b.exeCommand(a)};this.activateApp=function(a){var b;(b=hi5.tool.isNumber(a)?ca.getWinById(a):ca.getMainWinByAppId(a))?b.activate(1):svGlobal.logger.warn("No window found in "+a)};this.reconnect=function(a,b,c){void 0==c&&(c=ea.forceReconnect||!1);if(!Ha&&!c)return!1;
P.minWidth&&a<P.minWidth&&(a<P.minWidth&&svGlobal.logger.warn("Width "+a+" is samller than minWidth "+P.minWidth),a=P.minWidth);P.minHeight&&b<P.minHeight&&(b<P.minHeight&&svGlobal.logger.warn("Height "+b+" is samller than minHeight "+P.minHeight),b=P.minHeight);a&=-4;b&=-4;if(!c&&4>Math.abs(a-Ia)&&4>Math.abs(b-Ja))return!1;if(Ra&&Ra.enabled&&!1!==ea.displayVC)Ra.applyResolution(a,b);else if(oc&&ob||c||Xa&&!oc)ob=!1,svGlobal.logger.info("reconnecting..."),sa("8E0"+a+"\t"+b),Qa&&(Qa.remoteLockFlags=
0,Qa.checkLockFlags=!0);return!0};this.notify=function(a,b){a="8E6"+a;b&&(a+="\t"+b.join(";"));sa(a)};this.getUploadManager=function(){return Ma};this.setFPS=function(a){ca.execute("setFPS",[a])};this.addSurface=function(a){if(!ca.hasSurface(a)&&(Kb||qa.setContext(a.context),!ca.hasSurface(a)||!a.railWin)){jb&&a.setPlayerMode();P.mouseMoveEmu&&(a.mouseMoveEmu=V(P.mouseMoveEmu));a.setSize(50,50,"hidden");var b=a.getFreeSpace();0==Ia&&(Ia=b.width);0==Ja&&(Ja=b.height);a.setConfig(ea);ca.addSurface(a);
Oa(Ia,Ja,!0,P.monitorDef?!0:!1);a.setController(Qa);a.setDrawable(Od);a.setTouchpad(V(P.touchpad));var c=b=V(P.mapClipboard),e=b;void 0!=P.copyToLocal?c=V(P.copyToLocal):void 0!=ea.copyToLocal&&(c=ea.copyToLocal);void 0!=P.copyToRemote?e=V(P.copyToRemote):void 0!=ea.copyToRemote&&(e=ea.copyToRemote);a.setClipboard(b,c,e);Jb&&bc(a);P.invitation&&!V(P.control)&&(ca.setReadOnly(!0),b=hi5.$("requestControl"))&&(b.disabled=!1);b=void 0!=P.ctrlToWin?V(P.ctrlToWin):void 0!=ea.ctrlToWin?ea.ctrlToWin:!0;c=
void 0!=P.cmdToCtrl?V(P.cmdToCtrl):void 0!=ea.cmdToCtrl?ea.cmdToCtrl:!0;a.run(parseInt(P.keyboard||1033,10),b,!!ea.noKeyStuck,c)}};this.getRunninApps=this.getRunningApps=function(){for(var a=[],b=0,c=ca.size();b<c;b++)ca.getSurface(b).railWin.getMain(ca.zOrders)&&a.push(ca.getSurface(b).railWin.getMain(ca.zOrders).titleInfo);return a};this.startApp=function(a,b,c){b=b||"";c=c||"";sa("8C2"+a+"\t"+b+"\t"+c);var e=ca.getSurface(ca.size()-1);e&&(e.remoteApp=new zc(a,b,c))};this.startExitingApp=function(a){a=
ca.popWins(a);for(var b=a.length-1;0<=b;b--)ca.addWin(a[b])};var vb=new p.DynamicChannel;vb.name="PNPDR";vb.onopen=function(){svGlobal.logger.info("PNPDR DVC onopen()")};vb.process=function(a){a.getLittleEndian32();var b=a.getLittleEndian32();switch(b){case 101:a.getLittleEndian32(),a.getLittleEndian32(),a.getLittleEndian32(),a=new RdpBuffer(new Uint8Array(20),0,20),a.setLittleEndian32(20),a.setLittleEndian32(b),a.setLittleEndian32(1),a.setLittleEndian32(5),a.setLittleEndian32(1),vb.send(a)}};vb.onclose=
function(){svGlobal.logger.info("PNPDR DVC onclose()")};p.addDynamicChannel(vb);var gb=null;V(P.scanner)&&(gb=new p.DynamicChannel,gb.name="SCANNERDVC",gb.onopen=function(){svGlobal.logger.info("scanner DVC onopen().")},gb.process=function(a){var b=a.getByte();switch(b){case 0:var c=a.getByte(),e=a.getByte();b=new Uint8Array(10);b[0]=4;b[1]=7;b[2]=c;b[3]=e;b.set(a.getBytes(2),4);b.set(a.getBytes(2),6);b.set(a.getBytes(2),8);if(p.onagentmessage)p.onagentmessage(b);break;case 1:break;case 2:c=a.getEnd()-
a.getPosition();b=new Uint8Array(c+2);b[0]=4;b[1]=3;b.set(a.getBytes(c),2);if(p.onagentmessage)p.onagentmessage(b);break;case 3:c=a.getEnd()-a.getPosition();b=new Uint8Array(c+3);b[0]=4;b[1]=9;b[2]=0;b.set(a.getBytes(c),3);if(p.onagentmessage)p.onagentmessage(b);break;default:svGlobal.logger.info('Warning: Unknown type "'+b+'" received from DVC, ignored.')}},gb.onclose=function(){var a=new Uint8Array(2);a[0]=4;a[1]=4;if(p.onagentmessage)p.onagentmessage(a)},p.addDynamicChannel(gb));var ab=null;p.hasSmartCard()&&
(ab=new p.GatewayChannel,ab.name="SCARDSTB",ab.onopen=function(){var a=new Uint8Array(2);a[0]=3;a[1]=1;if(p.onagentmessage)p.onagentmessage(a);V(P.passwordIsPin)&&p.onagentmessage&&!hi5.browser.isMacOS&&hi5.notifications.notify({msg:__svi18n.info.scardAuth||"Smart card authentication in progress. Please wait...",type:0,timeout:1E4})},ab.process=function(a){var b=a.getEnd()-a.getPosition(),c=a.getByte(),e=a.getByte();switch(c){case 1:switch(e){case 1:c=new Uint8Array(2);c[0]=3;c[1]=7;if(p.onagentmessage)p.onagentmessage(c);
break;case 3:a=a.getBytes(b-2);b=b+4+4+4;wb&&(b+=wb.length);eb&&(b+=eb.length);b=new hi5.DataBuffer(new Uint8Array(b));b.setByte(3);b.setByte(9);wb?(b.setLittleEndian32(wb.length),b.setBytes(wb)):b.setLittleEndian32(0);eb?(b.setLittleEndian32(eb.length),b.setBytes(eb)):b.setLittleEndian32(0);b.setLittleEndian32(a.length);b.setBytes(a);b.markEnd();if(p.onagentmessage)p.onagentmessage(b.getData());break;case 5:a=a.getBytes(b);c=new Uint8Array(b);c[0]=3;c[1]=11;c.set(a,2);if(p.onagentmessage)p.onagentmessage(c);
break;case 2:case 4:break;default:svGlobal.logger.warn("Invalid smart card channel auth data received: unknown sub-type ["+a[1]+"].")}break;case 2:if(ab)if(1==e){if(c=new Uint8Array(b),c[0]=3,c[1]=3,c.set(a.getBytes(b),2),p.onagentmessage)p.onagentmessage(c)}else svGlobal.logger.warn("Invalid smart card channel pcsc data received: unknown sub-type ["+a[1]+"].");break;default:svGlobal.logger.warn("Invalid smart card channel data received: unknown type ["+a[0]+"].")}},ab.onclose=function(){var a=new Uint8Array(2);
a[0]=3;a[1]=4;if(p.onagentmessage)p.onagentmessage(a)},p.addGatewayChannel(ab));ea.detectNetwork&&(n+="&connectType=7",yd());this.getNetworkResult=function(){return Hb};this.getAgentLink=function(){var a=navigator.userAgentData?navigator.userAgentData.platform:navigator.platform||navigator.appVersion;return-1!=a.indexOf("Win")?"agent_setup.exe":-1!=a.indexOf("macOS")||-1!=a.indexOf("Mac")?"agent_setup.pkg":""};var cc=new Map,dc=new Map;this.writeAgent=function(a){a.byteLength&&(a=new Uint8Array(a));
switch(a[0]){case 3:if(ab){var b=a.slice?new hi5.DataBuffer(a.slice(2,a.length)):new hi5.DataBuffer(a.subarray(2,a.length));switch(a[1]){case 1:case 4:case 5:case 6:case 7:case 9:case 11:break;case 2:break;case 3:a[0]=2;a[1]=1;ab.send(a);break;case 8:cc.clear();dc.clear();a=b.getLittleEndian32();if(0!=a)a=b.getLittleEndian32(),b=b.getAscllString(a,!1),hi5.notifications.notify({msg:b});else{var c=b.getLittleEndian32(),e=document.getElementById("scardSelection");e||(e=document.createElement("div"),
e.id="scardSelection",e.className="appdlg",document.body.appendChild(e));if(e)if(0==c)e&&(e.innerHTML="<p>Error: Could not find any connected smart card. Please make check the connectivity and then refresh the page",b=new hi5.ui.Lightbox(e),b.onclose=function(){location.reload()},b.show());else{e.innerHTML=1<c?'<p><b>PLEASE SELECT A SMART CARD, ENTER YOUR CREDENTIAL AND CLICK "Continue".</b></p>':'<p><b>PLEASE ENTER YOUR CREDENTIAL AND CLICK "Continue".</b></p>';for(a=0;a<c;a++){var d=b.getLittleEndian32();
d=b.getBytes(d);var f=b.getLittleEndian32();f=b.getAscllString(f,!1);var m=b.getLittleEndian32();m=b.getAscllString(m,!1);var H=b.getLittleEndian32();b.getAscllString(H,!1);H=b.getLittleEndian64();H=(new Date(1E3*H)).toDateString();d=zd(a,d,m,f,H);e.appendChild(d)}e.innerHTML+="<br>";b=document.createElement("div");b.innerHTML+="Smart card credential: ";a=document.createElement("input");a.type="text";a.id="userPin";a.placeholder="PIN";a.value="";a.required=!0;b.appendChild(a);e.appendChild(b);e.innerHTML+=
"<br>";b=new hi5.ui.LightboxWithBtn(e);b.onclose=function(){var y,C=document.querySelector('input[name="scard_name"]:checked');C&&(y=parseInt(C.value));wb=cc.get(y);qb=dc.get(y);y=document.getElementById("userPin").value;eb=(new TextEncoder("utf-8")).encode(y);y=2;y=eb?y+4+eb.length:y+4;y=qb?y+4+qb.length:y+4;y=new Uint8Array(y);y=new hi5.DataBuffer(y);y.setByte(1);y.setByte(2);eb?(y.setLittleEndian32(eb.length),y.setBytes(eb)):y.setLittleEndian32(0);qb?(y.setLittleEndian32(qb.length),y.setAsciiString(qb,
qb.length)):y.setLittleEndian32(0);ab&&ab.send(y)};document.getElementById("userPin").addEventListener("keypress",function(y){"Enter"===y.key&&(y.preventDefault(),document.getElementById("continue_button").click())});b.show()}}break;case 10:a=b.getLittleEndian32();0!=a?(a=b.getLittleEndian32(),b=b.getAscllString(a,!1),hi5.notifications.notify({msg:b})):(a=b.getLittleEndian32(),a=b.getBytes(a),b=new Uint8Array(6+a.length),b=new hi5.DataBuffer(b),b.setByte(1),b.setByte(4),b.setLittleEndian32(a.length),
b.setBytes(a),ab.send(b));break;case 12:a[0]=1;a[1]=6;ab.send(a);break;default:svGlobal.logger.warn("Warning: Unknown smart card response header: [3 / "+a[1]+"], ignored.")}}break;case 4:if(gb)switch(a[1]){case 2:b=a.slice?new hi5.DataBuffer(a.slice(2,a.length)):new hi5.DataBuffer(a.subarray(2,a.length));e=document.getElementById("dsSelection");e||(e=document.createElement("div"),e.id="dsSelection",e.className="appdlg",document.body.appendChild(e));if(0!=b.getLittleEndian16())e&&(e.innerHTML="<p>Error on local: failed to get the list of connected scanners. Close to continue without scanning.</p>",
b=new hi5.ui.Lightbox(e),b.onclose=function(){p.run()},b.show());else if(c=(a.byteLength-4)/41,0==c)e&&(e.innerHTML="<p>Error: Could not find any connected scanner. Please:<ul><li>Power on or connect the scanner and then refresh the page; or</li><li>Close this dialog to connect to the machine without using scanner.</li></ul></p>",b=new hi5.ui.Lightbox(e),b.onclose=function(){p.run()},b.show());else if(1==c){if(b=new Uint8Array(3),b[0]=4,b[1]=5,b[2]=0,p.onagentmessage)p.onagentmessage(b)}else if(e){e.innerHTML=
'<p> Please choose a scanner &lt;DriverType: DeviceName&gt; and click "Continue".</a></p>';for(a=0;a<c;a++)d=b.getAscllString(41,!0),d=Ad(a,d),e.appendChild(d);e.innerHTML+="<br>";b=new hi5.ui.LightboxWithBtn(e);b.onclose=function(){var y=0,C=document.querySelector('input[name="ds_name"]:checked');C&&(y=C.value);C=new Uint8Array(3);C[0]=4;C[1]=5;C[2]=y;if(p.onagentmessage)p.onagentmessage(C)};b.show()}break;case 3:case 8:case 10:b=a.slice?new hi5.DataBuffer(a.slice(2,a.length)):new hi5.DataBuffer(a.subarray(2,
a.length));gb.send(b);break;case 4:b=a.slice?new hi5.DataBuffer(a.slice(2,a.length)):new hi5.DataBuffer(a.subarray(2,a.length));gb.send(b);hi5.notifications.notify({msg:__svi18n.info.TwainNotSupported,type:2});break;case 6:b=a.slice?new hi5.DataBuffer(a.slice(2,a.length)):new hi5.DataBuffer(a.subarray(2,a.length));b.getLittleEndian16();p.run();break;default:svGlobal.logger.warn("Warning: Unknown response header: [4 / "+a[1]+"], ignored.")}break;case 5:switch(a[1]){case 1:b=a[2]|a[3]<<8,a=a[4]|a[5]<<
8,svGlobal.logger.info("Agent version, major: "+b+" minor: "+a),(e=hi5.appcfg.agent&&hi5.appcfg.agent.version)&&(e.major>b||e.major==b&&e.minor>a)&&(b=__svi18n.info.newVersion||"New versoin available",a=__svi18n.info.updateAgent||"Please download and install the new gateway agent",e=p.getAgentLink(),hi5.notifications.notify({title:b,html:!0,msg:a+(': <a href="'+e+'">'+e+"</a>")}))}break;case 6:switch(a[1]){case 1:b=new hi5.DataBuffer(a);b.skipPosition(2);e=b.getLittleEndian32();c=[];for(a=0;a<e;a++)f=
b.getLittleEndian32(),d=b.getUnicodeString(f),f=b.getLittleEndian32(),f=b.getUnicodeString(f),c.push({name:d,driver:f});db&&db.listCallback&&(db.listCallback(c),db.listCallback=null)}break;case 7:db.send(a.subarray(1));break;default:svGlobal.logger.warn("Invalid channel data received: unknown type ["+a[0]+"].")}};var wb,eb,qb,gc={type:6,data:null};this.setAgentStatus=function(a){Uc=a};this.getAgentStatus=function(){return Uc};this.run=function(){var a;if(a=null==p.onagentmessage)a=1==p.mode?!1:p.hasSmartCard()||
p.hasScanner()||V(P.localPrinter);a&&window.startGatewayAgent?startGatewayAgent(p):(p.hasUSB()?ca.getFocused().requestUsbDevices(p.getUSB(),function(b){Fa.usbChannel.openDevices(b);ec()}):ec(),Ta.supportWebAudio&&Ta.iOSFix())};this.getDesktop=function(){return qa};this.mouseDown=function(a,b,c){Xa&&sa("80"+a+"\t"+b+"\t"+c)};this.mouseMove=function(a,b){Xa&&sa("82"+a+"\t"+b)};this.mouseUp=function(a,b,c){Xa&&sa("81"+a+"\t"+b+"\t"+c)};this.writeKeyCode=function(a,b){Xa&&sa("8B"+(a?0:49152)+"\t"+b)};
this.writeScancode=function(a,b){Xa&&("number"==typeof a?(sa("840\t"+a),sa("8449152\t"+a)):sa("84"+(a?0:49152)+"\t"+b))};this.resetSize=function(a,b){p.reconnectOnResize&&(Wa?(lb&&(clearTimeout(lb),lb=0),a&=-4,b&=-4,lb=setTimeout(function(){document.hidden||(Ra&&Ra.enabled&&Ra.applyResolution(a,b),setTimeout(function(){p.writeRawInput("8C661441\t"+a+"\t"+b);3==p.windowState&&Sc()},150),svGlobal.logger.info("-- displayChange, h:"+b))},777)):p.running()&&(lb&&(clearTimeout(lb),lb=0),lb=setTimeout(function(){document.hidden||
p.reconnect(a,b)},555)))};var Va=new RdpBuffer([],0,0);this.suppressOutput=function(a){if(!p.sessionInfo.suppressOutput)return!1;void 0==a&&(a=!0);var b=new Uint8Array(a?3:11);b[0]=146;b[1]=3;b[2]=a?1:0;a||(b[3]=Xb,b[4]=Xb>>8,b[5]=Wb,b[6]=Wb>>8,b[7]=Yb,b[8]=Yb>>8,b[9]=Zb,b[10]=Zb>>8);sa(b.buffer);return!0};this.refreshOutput=function(a,b,c,e){var d=new Uint8Array(c?11:3);d[0]=146;d[1]=3;d[2]=2;c&&(d[3]=a,d[4]=a>>8,d[5]=b,d[6]=b>>8,d[7]=c,d[8]=c>>8,d[9]=e,d[10]=e>>8);sa(d.buffer)};this.sendPing=function(a){var b=
new Uint8Array(a?2+a.length:2);b[0]=146;b[1]=0;a&&b.set(a,2);sa(b.buffer)};this.startPing=function(a,b){b=b||0;Pa||(Pa=new hi5.tool.ResponseMonitor(function(){Xa&&p.sendPing()},function(){if(Xa&&p.onnoresponse)return p.onnoresponse()}));Pa.setInterval(a,b);var c=new Uint8Array(4);c[0]=146;c[1]=2;c[2]=a;c[3]=b;sa(c.buffer);setTimeout(function(){Pa&&Pa.check()},1E3*(a+b));Ka?Ka.postMessage({type:0,cmd:6,start:1}):(Da.onSlowPath=Da.onFastPath=Jc,Da.onReqHistory=function(){Jc(15555)})};this.stopPing=
function(){Pa&&Pa.stop();Ka?Ka.postMessage({type:0,cmd:6,start:0}):Da.onSlowPath=Da.onFastPath=Da.onReqHistory=null};var Ya=null,Pc=0;this.play=function(){sa("F3")};this.pause=function(){sa("F2")};this.scan=function(a){sa("F4"+(a?"1":"0"))};this.seek=function(a){var b=ca.getFocused();b&&Ha&&(sa("F4"+(a?"1":"0")+"\t"+(a/b.getScale().x|0)),qa.pause(!0))};var Ea={tag:0,channels:0,bitsPerSample:0,samplePerSec:22050,toStream:function(a){a.setLittleEndian16(this.tag);a.setLittleEndian16(this.channels);
a.setLittleEndian16(this.bitsPerSample);a.setLittleEndian32(this.samplePerSec)},fromStream:function(a){this.tag=a.getLittleEndian16();this.channels=a.getLittleEndian16();this.bitsPerSample=a.getLittleEndian16();this.samplePerSec=a.getLittleEndian32()}},Oc=!1;this.showMessage=function(a,b,c){p&&p.displayMsg&&a&&((b=b||ca.getFocused())?b.showMessage(a,c):("string"==typeof a&&(a={msg:a,timeout:c||0}),hi5.notifications.notify(a)))};this._unload=zb;this.close=function(){svGlobal.logger.info("closing...");
Ha&&Wa&&ca&&ea.closeRemoteApp&&ca.tryCloseRemoteApps();qa&&qa.isSendingHistory()?(svGlobal.logger.warn("In the middle of sending history, close delayed"),setTimeout(Rc,2222)):Rc()};hi5.browser.isChromeApp?chrome.runtime.onSuspend.addListener(p.close):window.addEventListener("unload",p.close,!1);Lb.searchStartCode=function(a,b){for(var c=b[0]+2,e=a.length,d;c<e;)if(d=a[c],1==d){if(0==a[c-1]&&0==a[c-2]){b[1]=0==a[c-3]?4:3;b[0]=c-b[1]+1;return}c+=3}else 0==d?c++:c+=3;b[0]=-1};pc.SAMPLING_FREQUENCY=[96E3,
88200,64E3,48E3,44100,32E3,24E3,22050,16E3,12E3,11025,8E3,7350];Mb.isVideoSupported="MediaSource"in window&&MediaSource.isTypeSupported('video/mp4; codecs="avc1.42E01E, mp4a.40.2"');Mb.isAudioSupported="MediaSource"in window&&MediaSource.isTypeSupported('audio/mp4; codecs="mp4a.40.2"');svGlobal.DCVC_EXTENSION||(svGlobal.DCVC_EXTENSION={});svGlobal.DCVC_EXTENSION.GFX=function(a,b,c,e){function d(w,K,O,U){this.pixels=w;this.width=K;this.height=O;this.key=U}function f(w,K,O){this.width=w;this.height=
K;this.monitors=O}function m(){this.flags=this.bottom=this.right=this.top=this.left=0;this.read=function(w){this.left=w.getLittleEndian32();this.top=w.getLittleEndian32();this.right=w.getLittleEndian32();this.bottom=w.getLittleEndian32();this.flags=w.getLittleEndian32()};this.toString=function(){return"left: "+this.left+" top: "+this.top+" right: "+this.right+" bottom: "+this.bottom+" flags: "+this.flags}}function H(w,K,O){function U(){ma=!1;wa.drawable=ja._video;ja._player=W?new Md(ja,!1):new Mb(wa.drawable,
ja,!1);ja._player.onsps=function(oa){W&&(ja._video.width=oa.width,ja._video.height=oa.height);ja.onsps&&ja.onsps(oa)};ja._player.onerror=function(oa){ja.onfatalerror&&ja.onfatalerror(ja,oa)};ja._player.onplayerror=function(oa){function ua(){wa={drawable:ja._video};ja.player.play(!0)}wa=null;if((!ja.onuserinteract||!ja.onuserinteract(ua,"video"))&&ja.onmessage)ja.onmessage({msg:"Please click Yes to continue.<br>"+oa,cbYes:function(){ja.player.play(!0);this.destroy()}})};ja._player.onframedecoded=function(oa){Y.drawImage(oa,
0,0)}}this.id=w;this.width=K;this.height=O;this.pixelFomrat=33;this.outputOriginY=this.outputOriginX=0;this.targetWidth=K;this.targetHeight=O;this._player=null;var W=!!window.VideoDecoder;this._video=W?new OffscreenCanvas(K,O):document.createElement("video");var Y=W?this._video.getContext("2d"):null,ja=this,pa=null,ma=!0,wa={drawable:null};W&&svGlobal.logger.info("...MediaDecoder in use");this.resumeVideo=function(){ja._player&&ja._player.play(!0)};this.setDisplayBuffer=function(oa){pa=oa};this.draw=
function(oa,ua,ka,fa){return ma?pa.draw(oa,ua,ka,fa):wa};this.processAvc=function(oa,ua){ma&&U();if(!ua||W)ja.onvideoframe(oa,ua)};this.reset=function(oa,ua){ja&&ja._player&&ja._player.reset()};this.close=function(){ja&&ja._player&&(ja._player.close(),ja._player=null);ja=null};this.setRGBs=function(oa,ua,ka,fa,ya,ia,g){pa.setRGBs(oa,ua,ka,fa,ya,ia,g)};this.getRGBs=function(oa,ua,ka,fa){return pa.getRGBs(oa,ua,ka,fa)};this.moveArea=function(oa,ua,ka,fa,ya,ia){pa.moveArea(oa,ua,ka,fa,ya,ia)};this.fillRect=
function(oa,ua,ka,fa,ya){pa.fillRect(oa,ua,ka,fa,ya)};this.postPaint=function(oa,ua,ka,fa){ma&&pa.postPaint(oa,ua,ka,fa)}}function y(w,K,O,U){var W=new H(w,K,O);W.pixelFormat=U||33;W.setDisplayBuffer(e);T.push(W);F.oncreatesurface&&F.oncreatesurface(W);svGlobal.logger.info("create surface id:"+w+" w:"+K+" h:"+O+" pixelFmt:"+W.pixelFormat);return W}function C(w,K){var O=w.getPosition(),U=w.getLittleEndian32();w.skipPosition(10*U);return w.getBytes(K-(w.getPosition()-O))}function E(w,K,O,U){O=w.getLittleEndian32();
var W=O>>>30;O&=1073741823;switch(W){case 0:var Y=C(w,O);var ja=C(w,K-O-4);break;case 1:Y=C(w,O);break;case 2:K=w.getEnd()-w.getPosition();ja=C(w,K);break;default:throw Error("Invalid LC: "+W);}Y&&U.processAvc(Y,!1);ja&&U.processAvc(ja,!0)}function u(w){var K=w.getLittleEndian32(),O=w.getLittleEndian32();w=w.getLittleEndian32();var U=!1;switch(K){case 524292:U=!1;0==(w&1)&&(q=new ClearDecoder);break;case 524549:(U=0!=(w&16))||0!=(w&1)||(q=new ClearDecoder);break;default:U=0==(w&32)}e.onGetGfxHistory=
function(W,Y){var ja=v.toPDU();ja&&W(ja);Y();svGlobal.logger.info("Get GFX Histroy")};e.onSetGfxHistory=function(W,Y){svGlobal.logger.info("Set GFX Histroy");10==W?v.fromStream(Y):svGlobal.logger.error("Invalid GFX histroy type: "+W)};svGlobal.logger.info("Gfx Cap, Ver:"+K.toString(16)+" len:"+O+" flags:"+w+" h264:"+U);F.onconfirm&&F.onconfirm();return U}var v=new function(){function w(ia,g,h,k,r){this.len=ia;this.code=g;this.valueBits=h;this.type=k;this.vbase=r}function K(ia){var g=25E5-Y,h=ia.length;
if(g>=h)W.set(ia,Y),Y=g>h?Y+h:0;else if(25E5>=h)W.set(ia.subarray(0,g),Y),W.set(ia.subarray(g),0),Y=h-g;else{g=(h-g)%25E5;var k=h-g,r=ia.subarray(k);ia=ia.subarray(h-25E5,k);W.set(ia,25E5-ia.length);W.set(r,0);Y=g}}function O(ia){for(;oa<ia;)wa<<=8,ua<fa?wa+=ka[ua++]:console.log("--- end"),oa+=8;ma-=ia;oa-=ia;ia=wa>>oa;wa&=(1<<oa)-1;return ia}var U=[new w(1,0,8,0,0),new w(5,17,5,1,0),new w(5,18,7,1,32),new w(5,19,9,1,160),new w(5,20,10,1,672),new w(5,21,12,1,1696),new w(5,24,0,0,0),new w(5,25,0,0,
1),new w(6,44,14,1,5792),new w(6,45,15,1,22176),new w(6,52,0,0,2),new w(6,53,0,0,3),new w(6,54,0,0,255),new w(7,92,18,1,54944),new w(7,93,20,1,317088),new w(7,110,0,0,4),new w(7,111,0,0,5),new w(7,112,0,0,6),new w(7,113,0,0,7),new w(7,114,0,0,8),new w(7,115,0,0,9),new w(7,116,0,0,10),new w(7,117,0,0,11),new w(7,118,0,0,58),new w(7,119,0,0,59),new w(7,120,0,0,60),new w(7,121,0,0,61),new w(7,122,0,0,62),new w(7,123,0,0,63),new w(7,124,0,0,64),new w(7,125,0,0,128),new w(8,188,20,1,1365664),new w(8,189,
21,1,2414240),new w(8,252,0,0,12),new w(8,253,0,0,56),new w(8,254,0,0,57),new w(8,255,0,0,102),new w(9,380,22,1,4511392),new w(9,381,23,1,8705696),new w(9,382,24,1,17094304)],W=new Uint8Array(25E5),Y=0,ja=new Uint8Array(65536),pa=0,ma=0,wa=0,oa=0,ua=0,ka=null,fa=0,ya=!0;this.toPDU=function(){if(ya)return null;var ia=new Uint8Array(2500008);ia[0]=29;ia[2]=1;ia[3]=10;ia[4]=Y;ia[5]=Y>>8;ia[6]=Y>>16;ia[7]=Y>>24;ia.set(W,8);return ia};this.fromStream=function(ia){Y=ia.getLittleEndian32();W.set(ia.getSubarray(25E5))};
this.decompress=function(ia,g){if(g){ka=ia;ya&&(ya=!1);fa=ka.length-1;ma=8*fa-ka[fa];for(pa=ua=oa=wa=0;0<ma;)for(var h=g=0,k=0;k<U.length;k++){for(ia=U[k];g<ia.len;)h=(h<<1)+O(1),g++;0>h&&console.log("xxx inPrefix");if(h==ia.code){if(0==ia.type)ia=ia.vbase+O(ia.valueBits),(0>ia||255<ia)&&console.log("xxx do c"),ia&=255,W[Y]=ia,25E5==++Y&&(Y=0),ja[pa++]=ia;else if(g=O(ia.valueBits),g=ia.vbase+g,0>g&&console.log("xxx distance"),0!=g){if(0==O(1))ia=3;else{ia=4;for(h=2;1==O(1);)ia*=2,h++;ia+=O(h)}g=25E5-
g+Y;g%=25E5;h=g+ia;if(Math.abs(Y-g)>=ia&&25E5>h&&25E5>Y+ia)g=W.subarray(g,h),W.set(g,Y),Y+=ia,ja.set(g,pa),pa+=ia;else for(;0<ia;)h=W[g],25E5==++g&&(g=0),W[Y]=h,25E5==++Y&&(Y=0),ja[pa++]=h,ia--}else ia=O(15),ma-=oa,wa=oa=0,g=ka.subarray(ua,ua+ia),K(g),ja.set(g,pa),ua+=ia,pa+=ia,ma-=8*ia;break}}65536<pa&&console.error("xx outputIndex:"+pa);return ja.subarray(0,pa)}K(ia);return ia}},Q=new function(){this.process=function(w){var K=w.getByte();if(224==K){var O=0!=(w.getByte()&32);var U=w.getPosition(),
W=w.getEnd();K=v.decompress(w.getData().subarray(U,W),O);w.setPosition(W)}else{225!=K&&console.log("Invalid descriptor:"+K);W=w.getLittleEndian16();var Y=w.getLittleEndian32();K=new Uint8Array(Y);for(var ja=0,pa,ma=0;ma<W;ma++)pa=w.getLittleEndian32(),O=0!=(w.getByte()&32),pa--,U=w.getPosition(),O=v.decompress(w.getData().subarray(U,U+pa),O),K.set(O,ja),ja+=O.length,w.skipPosition(pa);ja!=Y&&console.error("wrong size, actual:"+ja+" expected:"+Y)}return new RdpBuffer(K,0,K.length)}},q=null,z=new rdpcodecs.RemoteFX(!1),
A=0,t=[],F=new a;F.name="Microsoft::Windows::RDS::Graphics";var T=new function(w,K){var O=[];this.push=function(U){U.osps=w.onsps;U.onfatalerror=w.onfatalerror;U.onplayerror=w.onplayerror;U.onuserinteract=w.onuserinteract;U.onmessage=w.onmessage;O[U.id]=U};this.get=function(U){return O[U]};this.getAll=function(){return O};this.delete=function(U){var W=O[U];W&&(W.onsps=null,W.onfatalerror=null,W.onplayerror=null,O[U]=null)};this.reset=function(U){U=0;for(var W=O.length;U<W;U++)O[U]&&O[U].reset()};
this.close=function(){for(var U=0,W=O.length;U<W;U++)O[U]&&O[U].close()};this.resumeVideo=function(){for(var U=0,W=O.length;U<W;U++)O[U]&&O[U].resumeVideo()}}(F,e);F.drawable=new function(){this.draw=function(w,K,O,U,W){return(W=T.get(W))?W.draw(w,K,O,U):null};this.getSurfaces=function(){return T};this.onfocus=function(w){};this.resumePlay=null};F.resumeVideo=function(){T.resumeVideo()};F.process=function(w){for(var K=Q.process(w);K.has(8);){var O=K.getLittleEndian16();K.getLittleEndian16();var U=
K.getLittleEndian32(),W=K.getPosition()+U-8;switch(O){case 1:var Y=K,ja=Y.getLittleEndian16(),pa=Y.getLittleEndian16(),ma=Y.getByte(),wa=Y.getLittleEndian16(),oa=Y.getLittleEndian16(),ua=Y.getLittleEndian16(),ka=Y.getLittleEndian16(),fa=ua-wa,ya=ka-oa,ia=Y.getLittleEndian32(),g=Y.getPosition()+ia,h=T.get(ja);h||(F.onconfirm&&F.onconfirm(),h=y(ja,e.width,e.height,ma));switch(pa){case 0:var k=rdpcodecs.bitmap.byte2int(Y.getData(),ia,Y.getPosition());h.setRGBs(wa,oa,fa,ya,k,0,fa);break;case 3:for(var r=
z.decode(Y,ia),x=r.getRects(),B=r.getTiles(),I=r.getTileSize(),D=r.getRectSize(),G=0;G<I;G++){var R=B[G];if(D)for(var M=R.x+64,l=R.y+64,L=0;L<D;L++){var N=x[L],S=N.x+N.width,ba=N.y+N.height;M<=S?l<=ba?h.setRGBs(R.x+wa,R.y+oa,64,64,R.data,0,64):h.setRGBs(R.x+wa,R.y+oa,64,ba-R.y,R.data,0,64):l<=ba?h.setRGBs(R.x+wa,R.y+oa,S-R.x,64,R.data,0,64):h.setRGBs(R.x+wa,R.y+oa,S-R.x,ba-R.y,R.data,0,64)}else h.setRGBs(R.x,R.y,64,64,R.data,0,4)}break;case 8:q||(q=new ClearDecoder);q.decode(Y,fa,ya,h.getData(),wa,
oa,h.width);break;case 10:svGlobal.logger.info("...PLANAR");break;case 11:var na=h,Ba=C(Y,ia);na.processAvc(Ba,!1);break;case 12:svGlobal.logger.info("...ALPHA");break;case 14:E(Y,ia,!1,h);break;case 15:E(Y,ia,!0,h);break;default:svGlobal.logger.warn("Invalid codec:"+pa)}Y.setPosition(g);h.postPaint(wa,oa,fa,ya);break;case 2:svGlobal.logger.info("RDPGFX_WIRE_TO_SURFACE_PDU_2");break;case 3:svGlobal.logger.info("RDPGFX_CMDID_DELETEENCODINGCONTEXT");break;case 4:var za=K;svGlobal.logger.info("...soliFill");
for(var La=za.getLittleEndian16(),Ga=-16777216|za.getByte()<<16|za.getByte()<<8|za.getByte()|za.getByte()<<24,Ca=za.getLittleEndian16(),Sa=T.get(La),va=0;va<Ca;va++){var xa=za.getLittleEndian16(),Na=za.getLittleEndian16(),Za=za.getLittleEndian16()-xa,$a=za.getLittleEndian16()-Na;Sa.fillRect(xa,Na,Za,$a,Ga);Sa.postPaint(xa,Na,Za,$a)}break;case 5:var Ua=K;svGlobal.logger.info("...surfaceToSurface");for(var pb=Ua.getLittleEndian16(),ub=Ua.getLittleEndian16(),Ob=Ua.getLittleEndian16(),Pb=Ua.getLittleEndian16(),
Qb=Ua.getLittleEndian16()-Ob,tc=Ua.getLittleEndian16()-Pb,Pd=Ua.getLittleEndian16(),Zc=T.get(pb),Qd=T.get(ub),$c=pb==ub?null:Zc.getRGBs(Ob,Pb,Qb,tc),ad=0;ad<Pd;ad++){var bd=Ua.getLittleEndian16(),cd=Ua.getLittleEndian16();$c?Qd.setRGBs(bd,cd,Qb,tc,$c,0,Qb):Zc.moveArea(Ob,Pb,Qb,tc,bd-Ob,cd-Pb)}break;case 6:var mb=K;svGlobal.logger.info("...surfaceToCache");var Rd=mb.getLittleEndian16(),uc=mb.getLittleEndian32().toString(16),dd=mb.getLittleEndian32();0<dd&&(uc=dd.toString(16)+uc);var Sd=mb.getLittleEndian16(),
ed=mb.getLittleEndian16(),fd=mb.getLittleEndian16(),gd=mb.getLittleEndian16()-ed,hd=mb.getLittleEndian16()-fd,Td=T.get(Rd).getRGBs(ed,fd,gd,hd);t[Sd]=new d(Td,gd,hd,uc);break;case 7:var Db=K;svGlobal.logger.info("...cacheToSurface");for(var Ud=Db.getLittleEndian16(),Vd=Db.getLittleEndian16(),Wd=Db.getLittleEndian16(),Rb=t[Ud],Xd=T.get(Vd),id=0;id<Wd;id++){var Yd=Db.getLittleEndian16(),Zd=Db.getLittleEndian16();Xd.setRGBs(Yd,Zd,Rb.width,Rb.height,Rb.pixels,0,Rb.width)}break;case 8:var $d=K.getLittleEndian16();
t[$d]=null;break;case 9:var Sb=K,ae=Sb.getLittleEndian16(),be=Sb.getLittleEndian16(),ce=Sb.getLittleEndian16(),de=Sb.getByte();y(ae,be,ce,de);break;case 10:var jd=K.getLittleEndian16();T.delete(jd);svGlobal.logger.info("delete surface id:"+jd);break;case 11:var kd=K;kd.getLittleEndian32();kd.getLittleEndian32();break;case 12:var ee=K.getLittleEndian32();if(0==A){var ld=new Uint8Array(20),xb=new RdpBuffer(ld);xb.setLittleEndian16(13);xb.setLittleEndian16(0);xb.setLittleEndian32(20);xb.setLittleEndian32(4294967295);
xb.setLittleEndian32(ee);A++;xb.setLittleEndian32(A);c&&F.send(ld)}break;case 14:var Tb=K,md=Tb.getLittleEndian32(),nd=Tb.getLittleEndian32(),vc=Tb.getLittleEndian32();svGlobal.logger.info("reset graphic, w:"+md+" h:"+nd+" monitors:"+vc);for(var od=Array(vc),Ub=0;Ub<vc;Ub++){var wc=new m;wc.read(Tb);od[Ub]=wc;svGlobal.logger.info("MonitorDef "+Ub+": "+wc.toString())}var pd=new f(md,nd,od);T.reset(pd);F.onresetgraphic&&F.onresetgraphic(pd);break;case 15:var Vb=K,qd=Vb.getLittleEndian16();Vb.skipPosition(2);
var Eb=T.get(qd);Eb.outputOriginX=Vb.getLittleEndian32();Eb.outputOriginY=Vb.getLittleEndian32();F.onmapsurface&&F.onmapsurface(Eb);svGlobal.logger.info("mapSurfaceToScaledOutput, outputSurfaceId:"+qd+" outX:"+Eb.outputOriginX+" outY:"+Eb.outputOriginY);break;case 17:svGlobal.logger.info("TODO: DPGFX_CACHE_IMPORT_REPLY_PDU");break;case 19:u(K);break;case 21:svGlobal.logger.info("mapSurfaceToWin");break;case 22:break;case 23:var yb=K,rd=yb.getLittleEndian16();yb.skipPosition(2);var hb=T.get(rd);hb.outputOriginX=
yb.getLittleEndian32();hb.outputOriginY=yb.getLittleEndian32();hb.targetWidth=yb.getLittleEndian32();hb.targetHeight=yb.getLittleEndian32();svGlobal.logger.info("mapSurfaceToScaledOutput, outputSurfaceId:"+rd+" outX:"+hb.outputOriginX+" outY:"+hb.outputOriginY+" targetW:"+hb.targetWidth+" targetH:"+hb.targetHeight);F.onmapsurface&&F.onmapsurface(hb);break;case 24:svGlobal.logger.info("TODO: mapSurfaceToScaledWin");break;default:svGlobal.logger.warn("xxx gfx:"+O);return}K.setPosition(W)}};F.onopen=
function(){svGlobal.logger.info("GFX Open, remotefx:"+b);var w=b?2:8,K=120*w,O=new Uint8Array(K),U=new RdpBuffer(O);U.setLittleEndian16(18);U.setLittleEndian16(0);U.setLittleEndian32(K);U.setLittleEndian16(w);U.setLittleEndian32(524292);U.setLittleEndian32(4);U.setLittleEndian32(1);U.setLittleEndian32(524549);U.setLittleEndian32(4);U.setLittleEndian32(19);b||(U.setLittleEndian32(655362),U.setLittleEndian32(4),U.setLittleEndian32(0),U.setLittleEndian32(655872),U.setLittleEndian32(4),U.setLittleEndian32(0),
U.setLittleEndian32(656129),U.setLittleEndian32(4),U.setLittleEndian32(0),U.setLittleEndian32(656384),U.setLittleEndian32(4),U.setLittleEndian32(0),U.setLittleEndian32(656642),U.setLittleEndian32(4),U.setLittleEndian32(0),U.setLittleEndian32(656896),U.setLittleEndian32(4),U.setLittleEndian32(0));U.markEnd();c&&F.send(O)};F.onclose=function(){T.close()};return F}}
Rdp.languageToKeyboard={af:0,sq:0,ar:1025,"ar-SA":1025,"ar-IQ":0,"ar-EG":0,"ar-LY":0,"ar-DZ":0,"ar-MA":0,"ar-TN":0,"ar-OM":0,"ar-YE":0,"ar-SY":0,"ar-JO":0,"ar-LB":0,"ar-KW":0,"ar-AE":0,"ar-BH":0,"ar-QA":0,eu:0,bg:0,be:0,ca:0,zh:2052,"zh-TW":1028,"zh-CN":2052,"zh-HK":1028,"zh-SG":2052,hr:0,cs:0,da:0,nl:1043,"nl-BE":2067,en:1033,"en-US":1033,"en-GB":2057,"en-AU":0,"en-CA":4105,"en-NA":0,"en-IE":0,"en-ZA":0,"en-JM":0,"en-BZ":0,et:0,fo:0,fa:0,fi:0,fr:1036,"fr-BE":2060,"fr-CA":3084,"fr-CH":4108,"fr-LU":0,
gd:0,"gd-IE":0,de:1031,"de-CH":2055,"de-AT":0,"de-LU":0,"de-LI":0,el:0,he:1037,hi:0,hu:0,is:1039,id:0,it:1040,"it-CH":66576,ja:3758162961,ko:3758162962,lv:0,lt:0,mk:0,mt:0,nb:1044,nn:1083,no:1044,pl:1045,pt:2070,"pt-BR":1046,rm:0,ro:0,"ro-MO":0,ru:1049,"ru-MO":0,sr:0,sk:0,sl:0,sb:0,es:1034,"es-AR":0,"es-GT":0,"es-CR":0,"es-PA":0,"es-DO":0,"es-MX":2058,"es-VE":0,"es-CO":0,"es-PE":0,"es-EC":0,"es-CL":0,"es-UY":0,"es-PY":0,"es-BO":0,"es-SV":0,"es-HN":0,"es-NI":0,"es-PR":0,sx:0,sv:1053,"sv-FI":0,th:0,
ts:0,tn:0,tr:1055,uk:0,ur:0,ve:0,vi:0,xh:0,ji:0,zu:0,detect:function(){var n=navigator&&(navigator.language||navigator.userLanguage||""),J=Rdp.languageToKeyboard[n];if(!J){var X=n.indexOf("-");X&&(J=Rdp.languageToKeyboard[n.substring(0,X)])}J||(svGlobal.logger.info("No valid layout for "+n),J=1033);return J}};svGlobal.Rdp||(svGlobal.Rdp=Rdp);var RdpBuffer=hi5.DataBuffer;
